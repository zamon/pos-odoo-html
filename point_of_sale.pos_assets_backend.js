
/* /base/static/src/js/res_config_settings.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('base.settings',function(require){"use strict";var BasicModel=require('web.BasicModel');var core=require('web.core');var FormView=require('web.FormView');var FormController=require('web.FormController');var FormRenderer=require('web.FormRenderer');var view_registry=require('web.view_registry');var QWeb=core.qweb;var _t=core._t;var BaseSettingRenderer=FormRenderer.extend({events:_.extend({},FormRenderer.prototype.events,{'click .tab':'_onSettingTabClick','keyup .searchInput':'_onKeyUpSearch',}),init:function(){this._super.apply(this,arguments);this.activeView=false;this.activeTab=false;},confirmChange:function(){var self=this;return this._super.apply(this,arguments).then(function(){if(!self.$(".o_dirty_warning").length){self.$('.o_statusbar_buttons').append($('<span/>',{text:_t("Unsaved changes"),class:'text-muted ml-2 o_dirty_warning'}))}});},on_attach_callback:function(){this._super.apply(this,arguments);this.searchInput.focus();},_initModules:function(){var self=this;this.modules=[];_.each(this.$('.app_settings_block'),function(settingView,index){var group=!$(settingView).hasClass('o_invisible_modifier');var isNotApp=$(settingView).hasClass('o_not_app');if(group&&!isNotApp){var data=$(settingView).data();data.string=$(settingView).attr('string')||data.string;self.modules.push({key:data.key,string:data.string,imgurl:self._getAppIconUrl(data.key),});}else{$(settingView).remove();}});},_initSearch:function(){this.searchInput=this.$('.searchInput');if(this.searchText){this.searchInput.val(this.searchText);this._onKeyUpSearch();}else{this.searchText="";}},_currentAppIndex:function(){var self=this;var index=_.findIndex(this.modules,function(module){return module.key===self.activeSettingTab;});return index;},_getAppIconUrl:function(module){return module==="general_settings"?"/base/static/description/settings.png":"/"+module+"/static/description/icon.png";},_getSearchHeader:function(imgurl,string){return $(QWeb.render('BaseSetting.SearchHeader',{imgurl:imgurl,string:string}));},_moveToTab:function(index){this.currentIndex=!index||index===-1?0:(index===this.modules.length?index-1:index);if(this.currentIndex!==-1){if(this.activeView){this.activeView.addClass("o_hidden");}
if(this.activeTab){this.activeTab.removeClass("selected");}
var view=this.modules[this.currentIndex].settingView;var tab=this.$(".tab[data-key='"+this.modules[this.currentIndex].key+"']");view.removeClass("o_hidden");this.activeView=view;this.activeTab=tab;tab.addClass("selected");}},_onSettingTabClick:function(event){this.searchInput.focus();if(this.searchText.length>0){this.searchInput.val('');this.searchText="";this._searchSetting();}
var settingKey=this.$(event.currentTarget).data('key');this._moveToTab(_.findIndex(this.modules,function(m){return m.key===settingKey;}));},_onKeyUpSearch:function(event){this.searchText=this.searchInput.val();this.activeTab.removeClass('selected');this._searchSetting();},_resetSearch:function(){this.searchInput.val("");_.each(this.modules,function(module){module.settingView.addClass('o_hidden');module.settingView.find('.o_setting_box').removeClass('o_hidden');module.settingView.find('h2').removeClass('o_hidden');module.settingView.find('.settingSearchHeader').addClass('o_hidden');module.settingView.find('.o_settings_container').addClass('mt16');});this.activeTab.removeClass('o_hidden').addClass('selected');this.activeView.removeClass('o_hidden');},_render:function(){var self=this;return this._super.apply(this,arguments).then(function(){self._initModules();self._renderLeftPanel();self._initSearch();});},_renderLeftPanel:function(){var self=this;_.each(this.modules,function(module){module.settingView=self.$('.app_settings_block[data-key="'+module.key+'"]');module.settingView.addClass("o_hidden");module.settingView.prepend(self._getSearchHeader(module.imgurl,module.string));});this._renderTabs();this._moveToTab(this.currentIndex||this._currentAppIndex());},_renderTabs:function(){var tabs=$(QWeb.render('BaseSetting.Tabs',{tabItems:this.modules}));tabs.appendTo(this.$(".settings_tab"));},_searchSetting:function(){var self=this;this.count=0;_.each(this.modules,function(module){self.inVisibleCount=0;module.settingView.find('.o_setting_box').addClass('o_hidden');module.settingView.find('h2').addClass('o_hidden');module.settingView.find('.settingSearchHeader').addClass('o_hidden');module.settingView.find('.o_settings_container').removeClass('mt16');var resultSetting=module.settingView.find(".o_form_label:containsTextLike('"+self.searchText+"')");if(resultSetting.length>0){resultSetting.each(function(){var settingBox=$(this).closest('.o_setting_box');if(!settingBox.hasClass('o_invisible_modifier')){settingBox.removeClass('o_hidden');$(this).html(self._wordHighlighter($(this).html(),self.searchText));}else{self.inVisibleCount++;}});if(self.inVisibleCount!==resultSetting.length){module.settingView.find('.settingSearchHeader').removeClass('o_hidden');module.settingView.removeClass('o_hidden');}}else{++self.count;}});this.count===_.size(this.modules)?this.$('.notFound').removeClass('o_hidden'):this.$('.notFound').addClass('o_hidden');if(this.searchText.length===0){this._resetSearch();}},_wordHighlighter:function(text,word){if(text.indexOf('highlighter')!==-1){text=text.replace('<span class="highlighter">',"");text=text.replace("</span>","");}
var match=text.search(new RegExp(word,"i"));word=text.substring(match,match+word.length);var highlightedWord="<span class='highlighter'>"+word+'</span>';return text.replace(word,highlightedWord);},});var BaseSettingController=FormController.extend({custom_events:_.extend({},FormController.prototype.custom_events,{button_clicked:'_onButtonClicked',}),init:function(){this._super.apply(this,arguments);this.disableAutofocus=true;this.renderer.activeSettingTab=this.initialState.context.module;},willRestore:function(){this.mode='edit';},_onButtonClicked:function(ev){var self=this;if(ev.data.attrs.name!=='execute'&&ev.data.attrs.name!=='cancel'){var recordID=ev.data.recordID;var _super=this._super;var args=arguments;this._discardChanges(recordID,{noAbandon:true}).then(function(){_super.apply(self,args);});}else{this._super.apply(this,arguments);}},});var BaseSettingsModel=BasicModel.extend({save:function(recordID){var self=this;return this._super.apply(this,arguments).then(function(result){delete self.localData[recordID].res_id;return result;});},});var BaseSettingView=FormView.extend({jsLibs:[],config:_.extend({},FormView.prototype.config,{Model:BaseSettingsModel,Renderer:BaseSettingRenderer,Controller:BaseSettingController,}),});view_registry.add('base_settings',BaseSettingView);return{Model:BaseSettingsModel,Renderer:BaseSettingRenderer,Controller:BaseSettingController,};});;

/* /web/static/lib/jquery.scrollTo/jquery.scrollTo.js defined in bundle 'point_of_sale.pos_assets_backend' */
;(function(define){'use strict';define(['jquery'],function($){var $scrollTo=$.scrollTo=function(target,duration,settings){return $(window).scrollTo(target,duration,settings);};$scrollTo.defaults={axis:'xy',duration:0,limit:true};$scrollTo.window=function(scope){return $(window)._scrollable();};$.fn._scrollable=function(){return this.map(function(){var elem=this,isWin=!elem.nodeName||$.inArray(elem.nodeName.toLowerCase(),['iframe','#document','html','body'])!=-1;if(!isWin)
return elem;var doc=(elem.contentWindow||elem).document||elem.ownerDocument||elem;return/webkit/i.test(navigator.userAgent)||doc.compatMode=='BackCompat'?doc.body:doc.documentElement;});};$.fn.scrollTo=function(target,duration,settings){if(typeof duration=='object'){settings=duration;duration=0;}
if(typeof settings=='function')
settings={onAfter:settings};if(target=='max')
target=9e9;settings=$.extend({},$scrollTo.defaults,settings);duration=duration||settings.duration;settings.queue=settings.queue&&settings.axis.length>1;if(settings.queue)
duration/=2;settings.offset=both(settings.offset);settings.over=both(settings.over);return this._scrollable().each(function(){if(target==null)return;var elem=this,$elem=$(elem),targ=target,toff,attr={},win=$elem.is('html,body');switch(typeof targ){case'number':case'string':if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(targ)){targ=both(targ);break;}
targ=win?$(targ):$(targ,this);if(!targ.length)return;case'object':if(targ.is||targ.style)
toff=(targ=$(targ)).offset();}
var offset=$.isFunction(settings.offset)&&settings.offset(elem,targ)||settings.offset;$.each(settings.axis.split(''),function(i,axis){var Pos=axis=='x'?'Left':'Top',pos=Pos.toLowerCase(),key='scroll'+Pos,old=elem[key],max=$scrollTo.max(elem,axis);if(toff){attr[key]=toff[pos]+(win?0:old-$elem.offset()[pos]);if(settings.margin){attr[key]-=parseInt(targ.css('margin'+Pos))||0;attr[key]-=parseInt(targ.css('border'+Pos+'Width'))||0;}
attr[key]+=offset[pos]||0;if(settings.over[pos])
attr[key]+=targ[axis=='x'?'width':'height']()*settings.over[pos];}else{var val=targ[pos];attr[key]=val.slice&&val.slice(-1)=='%'?parseFloat(val)/100*max:val;}
if(settings.limit&&/^\d+$/.test(attr[key]))
attr[key]=attr[key]<=0?0:Math.min(attr[key],max);if(!i&&settings.queue){if(old!=attr[key])
animate(settings.onAfterFirst);delete attr[key];}});animate(settings.onAfter);function animate(callback){$elem.animate(attr,duration,settings.easing,callback&&function(){callback.call(this,targ,settings);});}}).end();};$scrollTo.max=function(elem,axis){var Dim=axis=='x'?'Width':'Height',scroll='scroll'+Dim;if(!$(elem).is('html,body'))
return elem[scroll]-$(elem)[Dim.toLowerCase()]();var size='client'+Dim,html=elem.ownerDocument.documentElement,body=elem.ownerDocument.body;return Math.max(html[scroll],body[scroll])-Math.min(html[size],body[size]);};function both(val){return $.isFunction(val)||$.isPlainObject(val)?val:{top:val,left:val};}
return $scrollTo;})}(typeof define==='function'&&define.amd?define:function(deps,factory){if(typeof module!=='undefined'&&module.exports){module.exports=factory(require('jquery'));}else{factory(jQuery);}}));;

/* /web/static/lib/fuzzy-master/fuzzy.js defined in bundle 'point_of_sale.pos_assets_backend' */
(function(){var root=this;var fuzzy={};if(typeof exports!=='undefined'){module.exports=fuzzy;}else{root.fuzzy=fuzzy;}
fuzzy.simpleFilter=function(pattern,array){return array.filter(function(string){return fuzzy.test(pattern,string);});};fuzzy.test=function(pattern,string){return fuzzy.match(pattern,string)!==null;};fuzzy.match=function(pattern,string,opts){opts=opts||{};var patternIdx=0,result=[],len=string.length,totalScore=0,currScore=0,pre=opts.pre||'',post=opts.post||'',compareString=opts.caseSensitive&&string||string.toLowerCase(),ch,compareChar;pattern=opts.caseSensitive&&pattern||pattern.toLowerCase();for(var idx=0;idx<len;idx++){ch=string[idx];if(compareString[idx]===pattern[patternIdx]){if(pattern[patternIdx]===' '){currScore=1-idx/200;}else{currScore+=1+currScore-idx/200;}
ch=pre+ch+post;patternIdx+=1;}else{currScore=0;}
totalScore+=currScore;if(compareString[idx]===' '){currScore=0;}
result[result.length]=ch;}
if(patternIdx===pattern.length){return{rendered:result.join(''),score:totalScore};}
return null;};fuzzy.filter=function(pattern,arr,opts){if(!arr||arr.length===0){return[]}
if(typeof pattern!=='string'){return arr}
opts=opts||{};return arr.reduce(function(prev,element,idx,arr){var str=element;if(opts.extract){str=opts.extract(element);}
var rendered=fuzzy.match(pattern,str,opts);if(rendered!=null){prev[prev.length]={string:rendered.rendered,score:rendered.score,index:idx,original:element};}
return prev;},[]).sort(function(a,b){var compare=b.score-a.score;if(compare)return compare;return a.index-b.index;});};}());;

/* <inline asset> defined in bundle 'point_of_sale.pos_assets_backend' */
odoo._modules=["base","web","saas_worker","base_setup","bus","web_tour","mail","sales_team","product","web_editor","http_routing","auth_signup","portal","resource","digest","account","payment","utm","sale","sale_management","calendar","contacts","crm","website","barcodes","stock","web_enterprise","web_mobile","mail_enterprise","account_accountant","purchase","point_of_sale","rating","project","website_payment","website_mail","google_recaptcha","website_form","portal_rating","website_sale","mrp","web_kanban_gauge","mass_mailing","web_grid","hr","hr_timesheet","timer","timesheet_grid","hr_contract","hr_expense","base_automation","web_map","web_gantt","sms","web_studio","documents","hr_holidays","hr_recruitment","sign","helpdesk","web_cohort","sale_subscription","website_partner","gamification","website_profile","website_slides","hr_gantt","planning","event","website_event","sale_renting","project_enterprise","industry_fsm","iap","social","fleet","approvals","marketing_automation","website_blog","im_livechat","website_enterprise","website_calendar","survey","website_hr_recruitment","web_dashboard","hr_referral","note","website_forum","hr_skills","lunch","pos_epson_printer","pos_restaurant","pos_epson_printer_restaurant","pos_loyalty","account_reports","account_asset","project_forecast","project_timesheet_forecast","website_crm","website_sale_dashboard","purchase_stock","account_auto_transfer","account_bank_statement_import","base_import","account_bank_statement_import_csv","account_bank_statement_import_ofx","account_check_printing","account_followup","account_invoice_extract","account_online_sync","account_plaid","account_ponto","account_yodlee","approvals_purchase","auth_totp","auth_totp_portal","barcodes_mobile","crm_enterprise","crm_iap_lead","digest_enterprise","documents_account","documents_spreadsheet","documents_spreadsheet_account","documents_spreadsheet_crm","event_sale","hr_contract_salary","hr_expense_extract","hr_gamification","hr_mobile","hr_org_chart","hr_skills_slides","hr_skills_survey","industry_fsm_sale","l10n_generic_coa","mail_bot","mail_mobile","mrp_account_enterprise","odoo_referral","pad","pad_project","partner_autocomplete","payment_transfer","pos_hr","pos_hr_mobile","product_matrix","project_timesheet_synchro","website_event_sale","website_event_track","sale_stock","website_sale_stock","website_sale_delivery","sale_product_configurator","sale_product_matrix","saas_demo","sale_account_accountant","sale_enterprise","sale_expense","sale_stock_renting","sale_subscription_dashboard","sale_timesheet","snailmail","snailmail_account","snailmail_account_followup","social_facebook","social_linkedin","social_push_notifications","social_twitter","stock_enterprise","web_unsplash","website_form_project","website_links","website_livechat","website_mass_mailing","website_sale_management","website_sale_product_configurator","website_slides_forum","website_slides_survey","website_studio","mass_mailing_themes","website_event_social"];;

/* /web/static/lib/py.js/lib/py.js defined in bundle 'point_of_sale.pos_assets_backend' */
var py={};(function(py){var create=function(o,props){function F(){}
F.prototype=o;var inst=new F;if(props){for(var name in props){if(!props.hasOwnProperty(name)){continue;}
inst[name]=props[name];}}
return inst;};var symbols={};var comparators={};var Base={nud:function(){throw new Error(this.id+" undefined as prefix");},led:function(led){throw new Error(this.id+" undefined as infix");},toString:function(){if(this.id==='(constant)'||this.id==='(number)'||this.id==='(name)'||this.id==='(string)'){return[this.id.slice(0,this.id.length-1),' ',this.value,')'].join('');}else if(this.id==='(end)'){return'(end)';}else if(this.id==='(comparator)'){var repr=['(comparator',this.expressions[0]];for(var i=0;i<this.operators.length;++i){repr.push(this.operators[i],this.expressions[i+1]);}
return repr.join(' ')+')';}
var out=[this.id,this.first,this.second,this.third].filter(function(r){return r}).join(' ');return'('+out+')';}};function symbol(id,bp){bp=bp||0;var s=symbols[id];if(s){if(bp>s.lbp){s.lbp=bp;}
return s;}
return symbols[id]=create(Base,{id:id,lbp:bp});}
function constant(id){var s=symbol(id);s.id='(constant)';s.value=id;s.nud=function(){return this;};}
function prefix(id,bp,nud){symbol(id).nud=nud||function(){this.first=expression(bp);return this}}
function infix(id,bp,led){symbol(id,bp).led=led||function(left){this.first=left;this.second=expression(bp);return this;}}
function infixr(id,bp){symbol(id,bp).led=function(left){this.first=left;this.second=expression(bp-1);return this;}}
function comparator(id){comparators[id]=true;var bp=60;infix(id,bp,function(left){this.id='(comparator)';this.operators=[id];this.expressions=[left,expression(bp)];while(token.id in comparators){this.operators.push(token.id);advance();this.expressions.push(expression(bp));}
return this;});}
constant('None');constant('False');constant('True');symbol('(number)').nud=function(){return this;};symbol('(name)').nud=function(){return this;};symbol('(string)').nud=function(){return this;};symbol('(end)');symbol(':');symbol(')');symbol(']');symbol('}');symbol(',');symbol('else');infix('=',10,function(left){if(left.id!=='(name)'){throw new Error("Expected keyword argument name, got "+token.id);}
this.first=left;this.second=expression();return this;});symbol('lambda',20).nud=function(){this.first=[];if(token.id!==':'){for(;;){if(token.id!=='(name)'){throw new Error('Excepted an argument name');}
this.first.push(token);advance();if(token.id!==','){break;}
advance(',');}}
advance(':');this.second=expression();return this;};infix('if',20,function(left){this.ifTrue=left;this.condition=expression();advance('else');this.ifFalse=expression();return this;});infixr('or',30);infixr('and',40);prefix('not',50);comparator('in');comparator('not in');comparator('is');comparator('is not');comparator('<');comparator('<=');comparator('>');comparator('>=');comparator('<>');comparator('!=');comparator('==');infix('|',70);infix('^',80);infix('&',90);infix('<<',100);infix('>>',100);infix('+',110);infix('-',110);infix('*',120);infix('/',120);infix('//',120);infix('%',120);prefix('-',130);prefix('+',130);prefix('~',130);infixr('**',140);infix('.',150,function(left){if(token.id!=='(name)'){throw new Error('Expected attribute name, got '+token.id);}
this.first=left;this.second=token;advance();return this;});symbol('(',150).nud=function(){this.first=[];var comma=false;if(token.id!==')'){while(true){if(token.id===')'){break;}
this.first.push(expression());if(token.id!==','){break;}
comma=true;advance(',');}}
advance(')');if(!this.first.length||comma){return this;}else{return this.first[0];}};symbol('(').led=function(left){this.first=left;this.second=[];if(token.id!==")"){for(;;){this.second.push(expression());if(token.id!==','){break;}
advance(',');}}
advance(")");return this;};infix('[',150,function(left){this.first=left;this.second=expression();advance("]");return this;});symbol('[').nud=function(){this.first=[];if(token.id!==']'){for(;;){if(token.id===']'){break;}
this.first.push(expression());if(token.id!==','){break;}
advance(',');}}
advance(']');return this;};symbol('{').nud=function(){this.first=[];if(token.id!=='}'){for(;;){if(token.id==='}'){break;}
var key=expression();advance(':');var value=expression();this.first.push([key,value]);if(token.id!==','){break;}
advance(',');}}
advance('}');return this;};py.tokenize=(function(){function group(){return'('+Array.prototype.join.call(arguments,'|')+')';}
var Whitespace='[ \\f\\t]*';var Name='[a-zA-Z_]\\w*';var DecNumber='\\d+(L|l)?';var IntNumber=DecNumber;var PointFloat=group('\\d+\\.\\d*','\\.\\d+');var FloatNumber=PointFloat;var Number=group(FloatNumber,IntNumber);var Operator=group("\\*\\*=?",">>=?","<<=?","<>","!=","//=?","[+\\-*/%&|^=<>]=?","~");var Bracket='[\\[\\]\\(\\)\\{\\}]';var Special='[:;.,`@]';var Funny=group(Operator,Bracket,Special);var ContStr=group("([uU])?'([^\n'\\\\]*(?:\\\\.[^\n'\\\\]*)*)'",'([uU])?"([^\n"\\\\]*(?:\\\\.[^\n"\\\\]*)*)"');var PseudoToken=Whitespace+group(Number,Funny,ContStr,Name);var number_pattern=new RegExp('^'+Number+'$');var string_pattern=new RegExp('^'+ContStr+'$');var name_pattern=new RegExp('^'+Name+'$');var strip=new RegExp('^'+Whitespace);return function tokenize(s){var max=s.length,tokens=[],start,end;var pseudoprog=new RegExp(PseudoToken,'g');while(pseudoprog.lastIndex<max){var pseudomatch=pseudoprog.exec(s);if(!pseudomatch){if(/^\s+$/.test(s.slice(end))){break;}
throw new Error('Failed to tokenize <<'+s
+'>> at index '+(end||0)
+'; parsed so far: '+tokens);}
start=pseudomatch.index;end=pseudoprog.lastIndex;var token=s.slice(start,end).replace(strip,'');if(number_pattern.test(token)){tokens.push(create(symbols['(number)'],{value:parseFloat(token)}));}else if(string_pattern.test(token)){var m=string_pattern.exec(token);tokens.push(create(symbols['(string)'],{value:PY_decode_string_literal(m[3]!==undefined?m[3]:m[5],!!(m[2]||m[4]))}));}else if(token in symbols){var symbol;if(token==='in'&&tokens.length>1&&tokens[tokens.length-1].id==='not'){symbol=symbols['not in'];tokens.pop();}else if(token==='not'&&tokens.length>1&&tokens[tokens.length-1].id==='is'){symbol=symbols['is not'];tokens.pop();}else{symbol=symbols[token];}
tokens.push(create(symbol));}else if(name_pattern.test(token)){tokens.push(create(symbols['(name)'],{value:token}));}else{throw new Error("Tokenizing failure of <<"+s+">> at index "+start
+" for token [["+token+"]]"
+"; parsed so far: "+tokens);}}
tokens.push(create(symbols['(end)']));return tokens;}})();var token,next;function expression(rbp){rbp=rbp||0;var t=token;token=next();var left=t.nud();while(rbp<token.lbp){t=token;token=next();left=t.led(left);}
return left;}
function advance(id){if(id&&token.id!==id){throw new Error('Expected "'+id+'", got "'+token.id+'"');}
token=next();}
function PY_ensurepy(val,name){switch(val){case undefined:throw new Error("NameError: name '"+name+"' is not defined");case null:return py.None;case true:return py.True;case false:return py.False;}
var fn=function(){};fn.prototype=py.object;if(py.PY_isInstance(val,py.object)||py.PY_isSubclass(val,py.object)){return val;}
switch(typeof val){case'number':return py.float.fromJSON(val);case'string':return py.str.fromJSON(val);case'function':return py.PY_def.fromJSON(val);}
switch(val.constructor){case Object:var o=py.PY_call(py.object);for(var prop in val){if(val.hasOwnProperty(prop)){o[prop]=val[prop];}}
return o;case Array:return py.list.fromJSON(val);}
throw new Error("Could not convert "+val+" to a pyval");}
var typename=function(obj){if(obj.__class__){return obj.__class__.__name__;}else if(typeof obj!=='object'){return typeof obj;}else{return obj.constructor.name;}};py.py={};py.PY_parseArgs=function PY_parseArgs(argument,format){var out={};var args=argument[0];var kwargs={};for(var k in argument[1]){if(!argument[1].hasOwnProperty(k)){continue;}
kwargs[k]=argument[1][k];}
if(typeof format==='string'){format=format.split(/\s+/);}
var name=function(spec){if(typeof spec==='string'){return spec;}else if(spec instanceof Array&&spec.length===2){return spec[0];}
throw new Error("TypeError: unknown format specification "+
JSON.stringify(spec));};var spec;for(var i=0;i<args.length;++i){spec=format[i];if(!spec||spec==='*'){throw new Error("TypeError: function takes exactly "+(i-1)+" positional arguments ("+args.length+" given")}else if(/^\*\w/.test(spec)){out[name(spec.slice(1))]=args.slice(i);break;}
out[name(spec)]=args[i];}
for(var j=i;j<format.length;++j){spec=format[j];var n=name(spec);if(n in out){throw new Error("TypeError: function got multiple values "+"for keyword argument '"+kwarg+"'");}
if(/^\*\*\w/.test(n)){out[n.slice(2)]=kwargs;kwargs={};break;}
if(n in kwargs){out[n]=kwargs[n];delete kwargs[n];}}
for(var key in kwargs){throw new Error("TypeError: function got an unexpected keyword argument '"
+key+"'");}
var kwonly=0;for(var k=0;k<format.length;++k){if(/^\*/.test(format[k])){kwonly=1;break;}}
for(var k=0;k<format.length;++k){spec=format[k];var n=name(spec);if(/^\*/.test(n)||n in out){continue;}
if(!(spec instanceof Array)){throw new Error("TypeError: function takes exactly "+(format.length-kwonly)
+" arguments");}
out[n]=spec[1];}
return out;};py.PY_hasAttr=function(o,attr_name){try{py.PY_getAttr(o,attr_name);return true;}catch(e){return false;}};py.PY_getAttr=function(o,attr_name){return PY_ensurepy(o.__getattribute__(attr_name));};py.PY_str=function(o){var v=o.__str__();if(py.PY_isInstance(v,py.str)){return v;}
throw new Error('TypeError: __str__ returned non-string (type '
+typename(v)
+')');};py.PY_isInstance=function(inst,cls){var fn=function(){};fn.prototype=cls;return inst instanceof fn;};py.PY_isSubclass=function(derived,cls){var fn=function(){};fn.prototype=cls;return derived===cls||derived instanceof fn;};py.PY_call=function(callable,args,kwargs){if(!args){args=[];}
if(typeof args==='object'&&!(args instanceof Array)){kwargs=args;args=[];}
if(!kwargs){kwargs={};}
if(callable.__is_type){var instance=callable.__new__.call(callable,args,kwargs);var typ=function(){};typ.prototype=callable;if(instance instanceof typ){instance.__init__.call(instance,args,kwargs);}
return instance}
return callable.__call__(args,kwargs);};py.PY_isTrue=function(o){var res=o.__nonzero__();if(res===py.True){return true;}
if(res===py.False){return false;}
throw new Error("TypeError: __nonzero__ should return bool, returned "
+typename(res));};py.PY_not=function(o){return!py.PY_isTrue(o);};py.PY_size=function(o){if(!o.__len__){throw new Error("TypeError: object of type '"+
typename(o)+"' has no len()");}
var v=o.__len__();if(typeof v!=='number'){throw new Error("TypeError: a number is required");}
return v;};py.PY_getItem=function(o,key){if(!('__getitem__'in o)){throw new Error("TypeError: '"+typename(o)+"' object is unsubscriptable")}
if(!py.PY_isInstance(key,py.object)){throw new Error("TypeError: '"+typename(key)+"' is not a py.js object");}
var res=o.__getitem__(key);if(!py.PY_isInstance(key,py.object)){throw new Error("TypeError: __getitem__ must return a py.js object, got "
+typename(res));}
return res;};py.PY_setItem=function(o,key,v){if(!('__setitem__'in o)){throw new Error("TypeError: '"+typename(o)+"' object does not support item assignment");}
if(!py.PY_isInstance(key,py.object)){throw new Error("TypeError: '"+typename(key)+"' is not a py.js object");}
if(!py.PY_isInstance(v,py.object)){throw new Error("TypeError: '"+typename(v)+"' is not a py.js object");}
o.__setitem__(key,v);};py.PY_add=function(o1,o2){return PY_op(o1,o2,'+');};py.PY_subtract=function(o1,o2){return PY_op(o1,o2,'-');};py.PY_multiply=function(o1,o2){return PY_op(o1,o2,'*');};py.PY_divide=function(o1,o2){return PY_op(o1,o2,'/');};py.PY_negative=function(o){if(!o.__neg__){throw new Error("TypeError: bad operand for unary -: '"
+typename(o)
+"'");}
return o.__neg__();};py.PY_positive=function(o){if(!o.__pos__){throw new Error("TypeError: bad operand for unary +: '"
+typename(o)
+"'");}
return o.__pos__();};py.type=function type(name,bases,dict){if(typeof name!=='string'){throw new Error("ValueError: a class name should be a string");}
if(!bases||bases.length===0){bases=[py.object];}else if(bases.length>1){throw new Error("ValueError: can't provide multiple bases for a "
+"new type");}
var base=bases[0];var ClassObj=create(base);if(dict){for(var k in dict){if(!dict.hasOwnProperty(k)){continue;}
ClassObj[k]=dict[k];}}
ClassObj.__class__=ClassObj;ClassObj.__name__=name;ClassObj.__bases__=bases;ClassObj.__is_type=true;return ClassObj;};py.type.__call__=function(){var args=py.PY_parseArgs(arguments,['object']);return args.object.__class__;};var hash_counter=0;py.object=py.type('object',[{}],{__new__:function(){var inst=create(this);inst.__is_type=false;return inst;},__init__:function(){},__hash__:function(){if(this._hash){return this._hash;}
return this._hash='\0\0\0'+String(hash_counter++);},__eq__:function(other){return(this===other)?py.True:py.False;},__ne__:function(other){if(py.PY_isTrue(this.__eq__(other))){return py.False;}else{return py.True;}},__lt__:function(){return py.NotImplemented;},__le__:function(){return py.NotImplemented;},__ge__:function(){return py.NotImplemented;},__gt__:function(){return py.NotImplemented;},__str__:function(){return this.__unicode__();},__unicode__:function(){return py.str.fromJSON('<'+typename(this)+' object>');},__nonzero__:function(){return py.True;},__getattribute__:function(name){if(name in this){var val=this[name];if(typeof val==='object'&&'__get__'in val){return val.__get__(this,py.PY_call(py.type,[this]));}
if(typeof val==='function'&&!this.hasOwnProperty(name)){return PY_instancemethod.fromJSON(val,this);}
return val;}
if('__getattr__'in this){return this.__getattr__(name);}
throw new Error("AttributeError: object has no attribute '"+name+"'");},__setattr__:function(name,value){if(name in this&&'__set__'in this[name]){this[name].__set__(this,value);}
this[name]=value;},toJSON:function(){throw new Error(this.constructor.name+' can not be converted to JSON');}});var NoneType=py.type('NoneType',null,{__nonzero__:function(){return py.False;},toJSON:function(){return null;}});py.None=py.PY_call(NoneType);var NotImplementedType=py.type('NotImplementedType',null,{});py.NotImplemented=py.PY_call(NotImplementedType);var booleans_initialized=false;py.bool=py.type('bool',null,{__new__:function(){if(!booleans_initialized){return py.object.__new__.apply(this);}
var ph={};var args=py.PY_parseArgs(arguments,[['value',ph]]);if(args.value===ph){return py.False;}
return py.PY_isTrue(args.value)?py.True:py.False;},__str__:function(){return py.str.fromJSON((this===py.True)?"True":"False");},__nonzero__:function(){return this;},fromJSON:function(val){return val?py.True:py.False},toJSON:function(){return this===py.True;}});py.True=py.PY_call(py.bool);py.False=py.PY_call(py.bool);booleans_initialized=true;py.float=py.type('float',null,{__init__:function(){var placeholder={};var args=py.PY_parseArgs(arguments,[['value',placeholder]]);var value=args.value;if(value===placeholder){this._value=0;return;}
if(py.PY_isInstance(value,py.float)){this._value=value._value;}
if(py.PY_isInstance(value,py.object)&&'__float__'in value){var res=value.__float__();if(py.PY_isInstance(res,py.float)){this._value=res._value;return;}
throw new Error('TypeError: __float__ returned non-float (type '+
typename(res)+')');}
throw new Error('TypeError: float() argument must be a string or a number');},__str__:function(){return py.str.fromJSON(String(this._value));},__eq__:function(other){return this._value===other._value?py.True:py.False;},__lt__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value<other._value?py.True:py.False;},__le__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value<=other._value?py.True:py.False;},__gt__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value>other._value?py.True:py.False;},__ge__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return this._value>=other._value?py.True:py.False;},__abs__:function(){return py.float.fromJSON(Math.abs(this._value));},__add__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value+other._value);},__mod__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value%other._value);},__neg__:function(){return py.float.fromJSON(-this._value);},__sub__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value-other._value);},__mul__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value*other._value);},__pow__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value**other._value);},__div__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
return py.float.fromJSON(this._value/other._value);},__nonzero__:function(){return this._value?py.True:py.False;},fromJSON:function(v){if(!(typeof v==='number')){throw new Error('py.float.fromJSON can only take numbers');}
var instance=py.PY_call(py.float);instance._value=v;return instance;},toJSON:function(){return this._value;}});py.str=py.type('str',null,{__init__:function(){var placeholder={};var args=py.PY_parseArgs(arguments,[['value',placeholder]]);var s=args.value;if(s===placeholder){this._value='';return;}
this._value=py.PY_str(s)._value;},__hash__:function(){return'\1\0\1'+this._value;},__str__:function(){return this;},__eq__:function(other){if(py.PY_isInstance(other,py.str)&&this._value===other._value){return py.True;}
return py.False;},__lt__:function(other){if(py.PY_not(py.PY_call(py.isinstance,[other,py.str]))){return py.NotImplemented;}
return this._value<other._value?py.True:py.False;},__le__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return this._value<=other._value?py.True:py.False;},__gt__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return this._value>other._value?py.True:py.False;},__ge__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return this._value>=other._value?py.True:py.False;},__add__:function(other){if(!py.PY_isInstance(other,py.str)){return py.NotImplemented;}
return py.str.fromJSON(this._value+other._value);},__nonzero__:function(){return this._value.length?py.True:py.False;},__contains__:function(s){return(this._value.indexOf(s._value)!==-1)?py.True:py.False;},fromJSON:function(s){if(typeof s==='string'){var instance=py.PY_call(py.str);instance._value=s;return instance;}
throw new Error("str.fromJSON can only take strings");},toJSON:function(){return this._value;}});py.tuple=py.type('tuple',null,{__init__:function(){this._values=[];},__len__:function(){return this._values.length;},__nonzero__:function(){return py.PY_size(this)>0?py.True:py.False;},__contains__:function(value){for(var i=0,len=this._values.length;i<len;++i){if(py.PY_isTrue(this._values[i].__eq__(value))){return py.True;}}
return py.False;},__getitem__:function(index){return this._values[index.toJSON()];},toJSON:function(){var out=[];for(var i=0;i<this._values.length;++i){out.push(this._values[i].toJSON());}
return out;},fromJSON:function(ar){if(!(ar instanceof Array)){throw new Error("Can only create a py.tuple from an Array");}
var t=py.PY_call(py.tuple);for(var i=0;i<ar.length;++i){t._values.push(PY_ensurepy(ar[i]));}
return t;}});py.list=py.type('list',null,{__nonzero__:function(){return this.__len__>0?py.True:py.False;},});_.defaults(py.list,py.tuple)
py.dict=py.type('dict',null,{__init__:function(){this._store={};},__getitem__:function(key){var h=key.__hash__();if(!(h in this._store)){throw new Error("KeyError: '"+key.toJSON()+"'");}
return this._store[h][1];},__setitem__:function(key,value){this._store[key.__hash__()]=[key,value];},__len__:function(){return Object.keys(this._store).length},__nonzero__:function(){return py.PY_size(this)>0?py.True:py.False;},get:function(){var args=py.PY_parseArgs(arguments,['k',['d',py.None]]);var h=args.k.__hash__();if(!(h in this._store)){return args.d;}
return this._store[h][1];},fromJSON:function(d){var instance=py.PY_call(py.dict);for(var k in(d||{})){if(!d.hasOwnProperty(k)){continue;}
instance.__setitem__(py.str.fromJSON(k),PY_ensurepy(d[k]));}
return instance;},toJSON:function(){var out={};for(var k in this._store){var item=this._store[k];out[item[0].toJSON()]=item[1].toJSON();}
return out;}});py.PY_def=py.type('function',null,{__call__:function(){return this._func.apply(this._inst,arguments);},fromJSON:function(nativefunc){var instance=py.PY_call(py.PY_def);instance._inst=null;instance._func=nativefunc;return instance;},toJSON:function(){return this._func;}});py.classmethod=py.type('classmethod',null,{__init__:function(){var args=py.PY_parseArgs(arguments,'function');this._func=args['function'];},__get__:function(obj,type){return PY_instancemethod.fromJSON(this._func,type);},fromJSON:function(func){return py.PY_call(py.classmethod,[func]);}});var PY_instancemethod=py.type('instancemethod',[py.PY_def],{fromJSON:function(nativefunc,instance){var inst=py.PY_call(PY_instancemethod);inst._inst=instance;inst._func=nativefunc;return inst;}});py.abs=new py.PY_def.fromJSON(function abs(){var args=py.PY_parseArgs(arguments,['number']);if(!args.number.__abs__){throw new Error("TypeError: bad operand type for abs(): '"
+typename(args.number)
+"'");}
return args.number.__abs__();});py.len=new py.PY_def.fromJSON(function len(){var args=py.PY_parseArgs(arguments,['object']);return py.float.fromJSON(py.PY_size(args.object));});py.isinstance=new py.PY_def.fromJSON(function isinstance(){var args=py.PY_parseArgs(arguments,['object','class']);return py.PY_isInstance(args.object,args['class'])?py.True:py.False;});py.issubclass=new py.PY_def.fromJSON(function issubclass(){var args=py.PY_parseArgs(arguments,['C','B']);return py.PY_isSubclass(args.C,args.B)?py.True:py.False;});var PY_decode_string_literal=function(str,unicode){var out=[],code;var direct_map={'\\':'\\','"':'"',"'":"'",'a':'\x07','b':'\x08','f':'\x0c','n':'\n','r':'\r','t':'\t','v':'\v'};for(var i=0;i<str.length;++i){if(str[i]!=='\\'){out.push(str[i]);continue;}
var escape=str[i+1];if(escape in direct_map){out.push(direct_map[escape]);++i;continue;}
switch(escape){case'\n':++i;continue;case'N':if(!unicode){break;}
throw Error("SyntaxError: \\N{} escape not implemented");case'u':if(!unicode){break;}
var uni=str.slice(i+2,i+6);if(!/[0-9a-f]{4}/i.test(uni)){throw new Error(["SyntaxError: (unicode error) 'unicodeescape' codec"," can't decode bytes in position ",i,"-",i+4,": truncated \\uXXXX escape"].join(''));}
code=parseInt(uni,16);out.push(String.fromCharCode(code));i+=5;continue;case'U':if(!unicode){break;}
throw Error("SyntaxError: \\U escape not implemented");case'x':var hex=str.slice(i+2,i+4);if(!/[0-9a-f]{2}/i.test(hex)){if(!unicode){throw new Error('ValueError: invalid \\x escape');}
throw new Error(["SyntaxError: (unicode error) 'unicodeescape'"," codec can't decode bytes in position ",i,'-',i+2,": truncated \\xXX escape"].join(''))}
code=parseInt(hex,16);out.push(String.fromCharCode(code));i+=3;continue;default:if(!/[0-8]/.test(escape)){break;}
var r=/[0-8]{1,3}/g;r.lastIndex=i+1;var m=r.exec(str);var oct=m[0];code=parseInt(oct,8);out.push(String.fromCharCode(code));i+=oct.length;continue;}
out.push('\\');}
return out.join('');};var PY_operators={'==':['eq','eq',function(a,b){return a===b;}],'!=':['ne','ne',function(a,b){return a!==b;}],'<>':['ne','ne',function(a,b){return a!==b;}],'<':['lt','gt',function(a,b){return a.__class__.__name__<b.__class__.__name__;}],'<=':['le','ge',function(a,b){return a.__class__.__name__<=b.__class__.__name__;}],'>':['gt','lt',function(a,b){return a.__class__.__name__>b.__class__.__name__;}],'>=':['ge','le',function(a,b){return a.__class__.__name__>=b.__class__.__name__;}],'+':['add','radd'],'-':['sub','rsub'],'*':['mul','rmul'],'/':['div','rdiv'],'//':['floordiv','rfloordiv'],'%':['mod','rmod'],'**':['pow','rpow'],'<<':['lshift','rlshift'],'>>':['rshift','rrshift'],'&':['and','rand'],'^':['xor','rxor'],'|':['or','ror']};var PY_op=function(o1,o2,op){var r;var methods=PY_operators[op];var forward='__'+methods[0]+'__',reverse='__'+methods[1]+'__';var otherwise=methods[2];if(forward in o1&&(r=o1[forward](o2))!==py.NotImplemented){return r;}
if(reverse in o2&&(r=o2[reverse](o1))!==py.NotImplemented){return r;}
if(otherwise){return PY_ensurepy(otherwise(o1,o2));}
throw new Error("TypeError: unsupported operand type(s) for "+op+": '"
+typename(o1)+"' and '"+typename(o2)+"'");};var PY_builtins={type:py.type,None:py.None,True:py.True,False:py.False,NotImplemented:py.NotImplemented,object:py.object,bool:py.bool,float:py.float,str:py.str,unicode:py.unicode,tuple:py.tuple,list:py.list,dict:py.dict,abs:py.abs,len:py.len,isinstance:py.isinstance,issubclass:py.issubclass,classmethod:py.classmethod,};py.parse=function(toks){var index=0;token=toks[0];next=function(){return toks[++index];};return expression();};var evaluate_operator=function(operator,a,b){switch(operator){case'is':return a===b?py.True:py.False;case'is not':return a!==b?py.True:py.False;case'in':return b.__contains__(a);case'not in':return py.PY_isTrue(b.__contains__(a))?py.False:py.True;case'==':case'!=':case'<>':case'<':case'<=':case'>':case'>=':return PY_op(a,b,operator);}
throw new Error('SyntaxError: unknown comparator [['+operator+']]');};py.evaluate=function(expr,context){context=context||{};switch(expr.id){case'(name)':var val=context[expr.value];if(val===undefined&&expr.value in PY_builtins){return PY_builtins[expr.value];}
return PY_ensurepy(val,expr.value);case'(string)':return py.str.fromJSON(expr.value);case'(number)':return py.float.fromJSON(expr.value);case'(constant)':switch(expr.value){case'None':return py.None;case'False':return py.False;case'True':return py.True;}
throw new Error("SyntaxError: unknown constant '"+expr.value+"'");case'(comparator)':var result,left=py.evaluate(expr.expressions[0],context);for(var i=0;i<expr.operators.length;++i){result=evaluate_operator(expr.operators[i],left,left=py.evaluate(expr.expressions[i+1],context));if(py.PY_not(result)){return py.False;}}
return py.True;case'not':return py.PY_isTrue(py.evaluate(expr.first,context))?py.False:py.True;case'and':var and_first=py.evaluate(expr.first,context);if(py.PY_isTrue(and_first.__nonzero__())){return py.evaluate(expr.second,context);}
return and_first;case'or':var or_first=py.evaluate(expr.first,context);if(py.PY_isTrue(or_first.__nonzero__())){return or_first}
return py.evaluate(expr.second,context);case'if':var cond=py.evaluate(expr.condition,context);if(py.PY_isTrue(cond)){return py.evaluate(expr.ifTrue,context);}else{return py.evaluate(expr.ifFalse,context);}
case'(':if(expr.second){var callable=py.evaluate(expr.first,context);var args=[],kwargs={};for(var jj=0;jj<expr.second.length;++jj){var arg=expr.second[jj];if(arg.id!=='='){args.push(py.evaluate(arg,context));}else{kwargs[arg.first.value]=py.evaluate(arg.second,context);}}
return py.PY_call(callable,args,kwargs);}
var tuple_exprs=expr.first,tuple_values=[];for(var j=0,len=tuple_exprs.length;j<len;++j){tuple_values.push(py.evaluate(tuple_exprs[j],context));}
return py.tuple.fromJSON(tuple_values);case'[':if(expr.second){return py.PY_getItem(py.evaluate(expr.first,context),py.evaluate(expr.second,context));}
var list_exprs=expr.first,list_values=[];for(var k=0;k<list_exprs.length;++k){list_values.push(py.evaluate(list_exprs[k],context));}
return py.list.fromJSON(list_values);case'{':var dict_exprs=expr.first,dict=py.PY_call(py.dict);for(var l=0;l<dict_exprs.length;++l){py.PY_setItem(dict,py.evaluate(dict_exprs[l][0],context),py.evaluate(dict_exprs[l][1],context));}
return dict;case'.':if(expr.second.id!=='(name)'){throw new Error('SyntaxError: '+expr);}
return py.PY_getAttr(py.evaluate(expr.first,context),expr.second.value);case'~':return(py.evaluate(expr.first,context)).__invert__();case'+':if(!expr.second){return py.PY_positive(py.evaluate(expr.first,context));}
case'-':if(!expr.second){return py.PY_negative(py.evaluate(expr.first,context));}
case'*':case'/':case'//':case'%':case'**':case'<<':case'>>':case'&':case'^':case'|':return PY_op(py.evaluate(expr.first,context),py.evaluate(expr.second,context),expr.id);default:throw new Error('SyntaxError: Unknown node [['+expr.id+']]');}};py.eval=function(str,context){return py.evaluate(py.parse(py.tokenize(str)),context).toJSON();}})(typeof exports==='undefined'?py:exports);;

/* /web/static/lib/py.js/lib/py_extras.js defined in bundle 'point_of_sale.pos_assets_backend' */
(function(py){"use strict";function divmod(a,b,fn){var mod=a%b;if(mod>0&&b<0||mod<0&&b>0){mod+=b;}
return fn(Math.floor(a/b),mod);}
function modf(x,fn){var mod=x%1;if(mod<0){mod+=1;}
return fn(mod,Math.floor(x));}
function assert(bool){if(!bool){throw new Error("AssertionError");}}
var obj=function(){};obj.prototype=py.object;var asJS=function(arg){if(arg instanceof obj){return arg.toJSON();}
return arg;};var datetime=py.PY_call(py.object);var zero=py.float.fromJSON(0);var DAYS_IN_MONTH=[null,31,28,31,30,31,30,31,31,30,31,30,31];var DAYS_BEFORE_MONTH=[null];var dbm=0;for(var i=1;i<DAYS_IN_MONTH.length;++i){DAYS_BEFORE_MONTH.push(dbm);dbm+=DAYS_IN_MONTH[i];}
function is_leap(year){return year%4===0&&(year%100!==0||year%400===0);}
function days_before_year(year){var y=year-1;return y*365+Math.floor(y/4)-Math.floor(y/100)+Math.floor(y/400);}
function days_in_month(year,month){if(month===2&&is_leap(year)){return 29;}
return DAYS_IN_MONTH[month];}
function days_before_month(year,month){var post_leap_feb=month>2&&is_leap(year);return DAYS_BEFORE_MONTH[month]+(post_leap_feb?1:0);}
function ymd2ord(year,month,day){var dim=days_in_month(year,month);if(!(1<=day&&day<=dim)){throw new Error("ValueError: day must be in 1.."+dim);}
return days_before_year(year)+
days_before_month(year,month)+
day;}
function get_quarter_number(month){return Math.ceil(month/3);}
function get_quarter(year,month){var quarter_number=get_quarter_number(month);var month_from=((quarter_number-1)*3)+1
var date_from={year:year,month:month_from,day:1}
var date_to={year:year,month:month_from+2,day:days_in_month(year,month)}
return[date_from,date_to];}
function get_day_of_week(year,month,day){var d=new Date(year,month-1,day);return(d.getDay()+6)%7;}
var DI400Y=days_before_year(401);var DI100Y=days_before_year(101);var DI4Y=days_before_year(5);function ord2ymd(n){--n;var n400,n100,n4,n1,n0;divmod(n,DI400Y,function(_n400,n){n400=_n400;divmod(n,DI100Y,function(_n100,n){n100=_n100;divmod(n,DI4Y,function(_n4,n){n4=_n4;divmod(n,365,function(_n1,n){n1=_n1;n0=n;});});});});n=n0;var year=n400*400+1+n100*100+n4*4+n1;if(n1==4||n100==100){assert(n0===0);return{year:year-1,month:12,day:31};}
var leapyear=n1===3&&(n4!==24||n100==3);assert(leapyear==is_leap(year));var month=(n+50)>>5;var preceding=DAYS_BEFORE_MONTH[month]+((month>2&&leapyear)?1:0);if(preceding>n){--month;preceding-=DAYS_IN_MONTH[month]+((month===2&&leapyear)?1:0);}
n-=preceding;return{year:year,month:month,day:n+1};}
function tmxxx(year,month,day,hour,minute,second,microsecond){hour=hour||0;minute=minute||0;second=second||0;microsecond=microsecond||0;if(microsecond<0||microsecond>999999){divmod(microsecond,1000000,function(carry,ms){microsecond=ms;second+=carry;});}
if(second<0||second>59){divmod(second,60,function(carry,s){second=s;minute+=carry;});}
if(minute<0||minute>59){divmod(minute,60,function(carry,m){minute=m;hour+=carry;});}
if(hour<0||hour>23){divmod(hour,24,function(carry,h){hour=h;day+=carry;});}
if(month<1||month>12){divmod(month-1,12,function(carry,m){month=m+1;year+=carry;});}
var dim=days_in_month(year,month);if(day<1||day>dim){if(day===0){--month;if(month>0){day=days_in_month(year,month);}else{--year;month=12;day=31;}}else if(day==dim+1){++month;day=1;if(month>12){month=1;++year;}}else{var r=ord2ymd(ymd2ord(year,month,1)+(day-1));year=r.year;month=r.month;day=r.day;}}
return{year:year,month:month,day:day,hour:hour,minute:minute,second:second,microsecond:microsecond};}
datetime.timedelta=py.type('timedelta',null,{__init__:function(){var args=py.PY_parseArgs(arguments,[['days',zero],['seconds',zero],['microseconds',zero],['milliseconds',zero],['minutes',zero],['hours',zero],['weeks',zero]]);var d=0,s=0,m=0;var days=args.days.toJSON()+args.weeks.toJSON()*7;var seconds=args.seconds.toJSON()
+args.minutes.toJSON()*60
+args.hours.toJSON()*3600;var microseconds=args.microseconds.toJSON()
+args.milliseconds.toJSON()*1000;var daysecondsfrac=modf(days,function(dayfrac,days){d=days;if(dayfrac){return modf(dayfrac*24*3600,function(dsf,dsw){s=dsw;return dsf;});}
return 0;});var secondsfrac=modf(seconds,function(sf,s){seconds=s;return sf+daysecondsfrac;});divmod(seconds,24*3600,function(days,seconds){d+=days;s+=seconds;});microseconds+=secondsfrac*1e6;divmod(microseconds,1000000,function(seconds,microseconds){divmod(seconds,24*3600,function(days,seconds){d+=days;s+=seconds;m+=Math.round(microseconds);});});this.days=d;this.seconds=s;this.microseconds=m;},__str__:function(){var hh,mm,ss;divmod(this.seconds,60,function(m,s){divmod(m,60,function(h,m){hh=h;mm=m;ss=s;});});var s=_.str.sprintf("%d:%02d:%02d",hh,mm,ss);if(this.days){s=_.str.sprintf("%d day%s, %s",this.days,(this.days!=1&&this.days!=-1)?'s':'',s);}
if(this.microseconds){s=_.str.sprintf("%s.%06d",s,this.microseconds);}
return py.str.fromJSON(s);},__eq__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.False;}
return(this.days===other.days&&this.seconds===other.seconds&&this.microseconds===other.microseconds)?py.True:py.False;},__add__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
return py.PY_call(datetime.timedelta,[py.float.fromJSON(this.days+other.days),py.float.fromJSON(this.seconds+other.seconds),py.float.fromJSON(this.microseconds+other.microseconds)]);},__radd__:function(other){return this.__add__(other);},__sub__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
return py.PY_call(datetime.timedelta,[py.float.fromJSON(this.days-other.days),py.float.fromJSON(this.seconds-other.seconds),py.float.fromJSON(this.microseconds-other.microseconds)]);},__rsub__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
return this.__neg__().__add__(other);},__neg__:function(){return py.PY_call(datetime.timedelta,[py.float.fromJSON(-this.days),py.float.fromJSON(-this.seconds),py.float.fromJSON(-this.microseconds)]);},__pos__:function(){return this;},__mul__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
var n=other.toJSON();return py.PY_call(datetime.timedelta,[py.float.fromJSON(this.days*n),py.float.fromJSON(this.seconds*n),py.float.fromJSON(this.microseconds*n)]);},__rmul__:function(other){return this.__mul__(other);},__div__:function(other){if(!py.PY_isInstance(other,py.float)){return py.NotImplemented;}
var usec=((this.days*24*3600)+this.seconds)*1000000
+this.microseconds;return py.PY_call(datetime.timedelta,[zero,zero,py.float.fromJSON(usec/other.toJSON())]);},__floordiv__:function(other){return this.__div__(other);},total_seconds:function(){return py.float.fromJSON(this.days*86400
+this.seconds
+this.microseconds/1000000);},__nonzero__:function(){return(!!this.days||!!this.seconds||!!this.microseconds)?py.True:py.False;}});datetime.datetime=py.type('datetime',null,{__init__:function(){var zero=py.float.fromJSON(0);var args=py.PY_parseArgs(arguments,['year','month','day',['hour',zero],['minute',zero],['second',zero],['microsecond',zero],['tzinfo',py.None]]);for(var key in args){if(!args.hasOwnProperty(key)){continue;}
this[key]=asJS(args[key]);}},__eq__:function(other){return(this.year===other.year&&this.month===other.month&&this.day===other.day&&this.hour===other.hour&&this.minute===other.minute&&this.second===other.second&&this.microsecond===other.microsecond&&this.tzinfo===other.tzinfo)?py.True:py.False;},replace:function(){var args=py.PY_parseArgs(arguments,[['year',py.None],['month',py.None],['day',py.None],['hour',py.None],['minute',py.None],['second',py.None],['microsecond',py.None]]);var params={};for(var key in args){if(!args.hasOwnProperty(key)){continue;}
var arg=args[key];params[key]=(arg===py.None?this[key]:asJS(arg));}
return py.PY_call(datetime.datetime,params);},start_of:function(){var args=py.PY_parseArgs(arguments,'granularity');var granularity=args.granularity.toJSON();if(granularity==='year'){return py.PY_call(datetime.datetime,[this.year,1,1]);}else if(granularity==='quarter'){var quarter=get_quarter(this.year,this.month)[0];return py.PY_call(datetime.datetime,[quarter.year,quarter.month,quarter.day]);}else if(granularity==='month'){return py.PY_call(datetime.datetime,[this.year,this.month,1]);}else if(granularity==='week'){var dow=get_day_of_week(this.year,this.month,this.day);return py.PY_call(datetime.datetime,[this.year,this.month,this.day-dow]);}else if(granularity==='day'){return py.PY_call(datetime.datetime,[this.year,this.month,this.day]);}else if(granularity==='hour'){return py.PY_call(datetime.datetime,[this.year,this.month,this.day,this.hour]);}else{throw new Error('ValueError: '+granularity+' is not a supported granularity, supported '+' granularities are: year, quarter, month, week, day and hour.')}},end_of:function(){var args=py.PY_parseArgs(arguments,'granularity');var granularity=args.granularity.toJSON();var min=[23,59,59];if(granularity==='year'){return py.PY_call(datetime.datetime,[this.year,12,31].concat(min));}else if(granularity==='quarter'){var quarter=get_quarter(this.year,this.month)[1];return py.PY_call(datetime.datetime,[quarter.year,quarter.month,quarter.day].concat(min));}else if(granularity==='month'){var dom=days_in_month(this.year,this.month);return py.PY_call(datetime.datetime,[this.year,this.month,dom].concat(min));}else if(granularity==='week'){var dow=get_day_of_week(this.year,this.month,this.day);return py.PY_call(datetime.datetime,[this.year,this.month,this.day+(6-dow)].concat(min));}else if(granularity==='day'){return py.PY_call(datetime.datetime,[this.year,this.month,this.day].concat(min));}else if(granularity==='hour'){return py.PY_call(datetime.datetime,[this.year,this.month,this.day,this.hour,59,59]);}else{throw new Error('ValueError: '+granularity+' is not a supported granularity, supported '+' granularities are: year, quarter, month, week, day and hour.')}},add:function(){var args=py.PY_parseArgs(arguments,[['years',py.None],['months',py.None],['days',py.None],['hours',py.None],['minutes',py.None],['seconds',py.None],]);return py.PY_add(this,py.PY_call(relativedelta,{'years':args.years,'months':args.months,'days':args.days,'hours':args.hours,'minutes':args.minutes,'seconds':args.seconds,}));},subtract:function(){var args=py.PY_parseArgs(arguments,[['years',py.None],['months',py.None],['days',py.None],['hours',py.None],['minutes',py.None],['seconds',py.None],]);var params={};for(var key in args){params[key]=(args[key]===py.None?args[key]:py.float.fromJSON(-asJS(args[key])));}
return py.PY_add(this,py.PY_call(relativedelta,params));},strftime:function(){var self=this;var args=py.PY_parseArgs(arguments,'format');return py.str.fromJSON(args.format.toJSON().replace(/%([A-Za-z])/g,function(m,c){switch(c){case'Y':return _.str.sprintf('%04d',self.year);case'm':return _.str.sprintf('%02d',self.month);case'd':return _.str.sprintf('%02d',self.day);case'H':return _.str.sprintf('%02d',self.hour);case'M':return _.str.sprintf('%02d',self.minute);case'S':return _.str.sprintf('%02d',self.second);}
throw new Error('ValueError: No known conversion for '+m);}));},to_utc:function(){var d=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);var offset=d.getTimezoneOffset();var kwargs={minutes:py.float.fromJSON(offset)};var timedelta=py.PY_call(py.extras.datetime.timedelta,[],kwargs);var s=tmxxx(this.year,this.month,this.day+timedelta.days,this.hour,this.minute,this.second+timedelta.seconds);return datetime.datetime.fromJSON(s.year,s.month,s.day,s.hour,s.minute,s.second);},now:py.classmethod.fromJSON(function(){var d=new Date();return py.PY_call(datetime.datetime,[d.getFullYear(),d.getMonth()+1,d.getDate(),d.getHours(),d.getMinutes(),d.getSeconds(),d.getMilliseconds()*1000]);}),today:py.classmethod.fromJSON(function(){var dt_class=py.PY_getAttr(datetime,'datetime');return py.PY_call(py.PY_getAttr(dt_class,'now'));}),utcnow:py.classmethod.fromJSON(function(){var d=new Date();return py.PY_call(datetime.datetime,[d.getUTCFullYear(),d.getUTCMonth()+1,d.getUTCDate(),d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds()*1000]);}),combine:py.classmethod.fromJSON(function(){var args=py.PY_parseArgs(arguments,'date time');return py.PY_call(datetime.datetime,[py.PY_getAttr(args.date,'year'),py.PY_getAttr(args.date,'month'),py.PY_getAttr(args.date,'day'),py.PY_getAttr(args.time,'hour'),py.PY_getAttr(args.time,'minute'),py.PY_getAttr(args.time,'second')]);}),toJSON:function(){return new Date(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.microsecond/1000);},__add__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
var s=tmxxx(this.year,this.month,this.day+other.days,this.hour,this.minute,this.second+other.seconds);return datetime.datetime.fromJSON(s.year,s.month,s.day,s.hour,s.minute,s.second);},__sub__:function(other){if(py.PY_isInstance(other,datetime.timedelta)){return py.PY_add(this,py.PY_negative(other));}
return py.NotImplemented;},fromJSON:function(year,month,day,hour,minute,second){return py.PY_call(datetime.datetime,[year,month,day,hour,minute,second]);},});datetime.date=py.type('date',null,{__init__:function(){var args=py.PY_parseArgs(arguments,'year month day');this.year=asJS(args.year);this.month=asJS(args.month);this.day=asJS(args.day);},strftime:function(){var self=this;var args=py.PY_parseArgs(arguments,'format');return py.str.fromJSON(args.format.toJSON().replace(/%([A-Za-z])/g,function(m,c){switch(c){case'Y':return self.year;case'm':return _.str.sprintf('%02d',self.month);case'd':return _.str.sprintf('%02d',self.day);}
throw new Error('ValueError: No known conversion for '+m);}));},__eq__:function(other){return(this.year===other.year&&this.month===other.month&&this.day===other.day)?py.True:py.False;},replace:function(){var args=py.PY_parseArgs(arguments,[['year',py.None],['month',py.None],['day',py.None]]);var params={};for(var key in args){if(!args.hasOwnProperty(key)){continue;}
var arg=args[key];params[key]=(arg===py.None?this[key]:asJS(arg));}
return py.PY_call(datetime.date,params);},start_of:function(){var args=py.PY_parseArgs(arguments,'granularity');var granularity=args.granularity.toJSON();if(granularity==='year'){return py.PY_call(datetime.date,[this.year,1,1]);}else if(granularity==='quarter'){var quarter=get_quarter(this.year,this.month)[0];return py.PY_call(datetime.date,[quarter.year,quarter.month,quarter.day]);}else if(granularity==='month'){return py.PY_call(datetime.date,[this.year,this.month,1]);}else if(granularity==='week'){var dow=get_day_of_week(this.year,this.month,this.day);return py.PY_call(datetime.date,[this.year,this.month,this.day-dow]);}else if(granularity==='day'){return py.PY_call(datetime.date,[this.year,this.month,this.day]);}else{throw new Error('ValueError: '+granularity+' is not a supported granularity, supported '+' granularities are: year, quarter, month, week and day.')}},end_of:function(){var args=py.PY_parseArgs(arguments,'granularity');var granularity=args.granularity.toJSON();if(granularity==='year'){return py.PY_call(datetime.date,[this.year,12,31]);}else if(granularity==='quarter'){var quarter=get_quarter(this.year,this.month)[1];return py.PY_call(datetime.date,[quarter.year,quarter.month,quarter.day]);}else if(granularity==='month'){var dom=days_in_month(this.year,this.month);return py.PY_call(datetime.date,[this.year,this.month,dom]);}else if(granularity==='week'){var dow=get_day_of_week(this.year,this.month,this.day);return py.PY_call(datetime.date,[this.year,this.month,this.day+(6-dow)]);}else if(granularity==='day'){return py.PY_call(datetime.date,[this.year,this.month,this.day]);}else{throw new Error('ValueError: '+granularity+' is not a supported granularity, supported '+' granularities are: year, quarter, month, week and day.')}},add:function(){var args=py.PY_parseArgs(arguments,[['years',py.None],['months',py.None],['days',py.None],]);return py.PY_add(this,py.PY_call(relativedelta,{'years':args.years,'months':args.months,'days':args.days,}));},subtract:function(){var args=py.PY_parseArgs(arguments,[['years',py.None],['months',py.None],['days',py.None],]);var params={};for(var key in args){params[key]=(args[key]===py.None?args[key]:py.float.fromJSON(-asJS(args[key])));}
return py.PY_add(this,py.PY_call(relativedelta,params));},__add__:function(other){if(!py.PY_isInstance(other,datetime.timedelta)){return py.NotImplemented;}
var s=tmxxx(this.year,this.month,this.day+other.days);return datetime.date.fromJSON(s.year,s.month,s.day);},__radd__:function(other){return this.__add__(other);},__sub__:function(other){if(py.PY_isInstance(other,datetime.timedelta)){return py.PY_add(this,py.PY_negative(other));}
if(py.PY_isInstance(other,datetime.date)){return py.PY_call(datetime.timedelta,[py.PY_subtract(py.PY_call(py.PY_getAttr(this,'toordinal')),py.PY_call(py.PY_getAttr(other,'toordinal')))]);}
return py.NotImplemented;},toordinal:function(){return py.float.fromJSON(ymd2ord(this.year,this.month,this.day));},weekday:function(){return py.float.fromJSON((this.toordinal().toJSON()+6)%7);},fromJSON:function(year,month,day){return py.PY_call(datetime.date,[year,month,day]);},today:py.classmethod.fromJSON(function(){var d=new Date();return py.PY_call(datetime.date,[d.getFullYear(),d.getMonth()+1,d.getDate()]);}),});datetime.time=py.type('time',null,{__init__:function(){var zero=py.float.fromJSON(0);var args=py.PY_parseArgs(arguments,[['hour',zero],['minute',zero],['second',zero],['microsecond',zero],['tzinfo',py.None]]);for(var k in args){if(!args.hasOwnProperty(k)){continue;}
this[k]=asJS(args[k]);}}});var time=py.PY_call(py.object);time.strftime=py.PY_def.fromJSON(function(){var args=py.PY_parseArgs(arguments,'format');var dt_class=py.PY_getAttr(datetime,'datetime');var d=py.PY_call(py.PY_getAttr(dt_class,'utcnow'));return py.PY_call(py.PY_getAttr(d,'strftime'),[args.format]);});var args=_.map(('year month day hour minute second '
+'years months weeks days hours minutes seconds '
+'weekday leapdays yearday nlyearday').split(' '),function(arg){switch(arg){case'years':case'months':case'days':case'leapdays':case'weeks':case'hours':case'minutes':case'seconds':return[arg,zero];case'year':case'month':case'day':case'weekday':case'hour':case'minute':case'second':case'yearday':case'nlyearday':return[arg,null];default:throw new Error("Unknown relativedelta argument "+arg);}});args.unshift('*');var _utils={monthrange:function(year,month){if(month<1||month>12){throw new Error("Illegal month "+month);}
var day1=this.weekday(year,month,1);var ndays=this.mdays[month]+(month==this.February&&this.isleap(year));return[day1,ndays];},weekday:function(year,month,day){var date=py.PY_call(datetime.date,[year,month,day]);return py.PY_call(py.PY_getAttr(date,'weekday'));},isleap:function(year){return year%4===0&&(year%100!==0||year%400===0);},mdays:[0,31,28,31,30,31,30,31,31,30,31,30,31],January:1,February:2};var relativedelta=py.type('relativedelta',null,{__init__:function(){this.ops=py.PY_parseArgs(arguments,args);this.ops.days=py.float.fromJSON(asJS(this.ops.days)+asJS(this.ops.weeks)*7);var yday=zero;if(this.ops.nlyearday){yday=this.ops.nlyearday;}else if(this.ops.yearday){yday=this.ops.yearday;if(asJS(this.ops.yearday)>59){this.ops.leapdays=py.float.fromJS(-1);}}
if(py.PY_isTrue(yday)){var ydayidx=[31,59,90,120,151,181,212,243,273,304,334,366];for(var idx=0;idx<ydayidx.length;++idx){var ydays=ydayidx[idx];if(asJS(yday)<=ydays){this.ops.month=py.float.fromJSON(idx+1);if(!idx){this.ops.day=yday;}else{this.ops.day=py.PY_subtract(yday,py.float.fromJSON(ydayidx[idx-1]));}
break;}}
if(idx===ydayidx.length){throw new Error("Invalid year day ("+asJS(yday)+")");}}
this._fix();},_fix:function(){var self=this;var months=asJS(this.ops.months);if(Math.abs(months)>11){var s=months>0?1:-1;divmod(months*s,12,function(years,months){self.ops.months=py.float.fromJSON(months*s);self.ops.years=py.float.fromJSON(asJS(self.ops.years)+years*s);});}
this._has_time=0;},__add__:function(other){if(!(py.PY_isInstance(other,datetime.date)||py.PY_isInstance(other,datetime.datetime))){return py.NotImplemented;}
var year=(asJS(this.ops.year)||asJS(other.year))+asJS(this.ops.years);var month=asJS(this.ops.month)||asJS(other.month);var months;if(months=asJS(this.ops.months)){if(Math.abs(months)<1||Math.abs(months)>12){throw new Error("Can only use relative months between -12 and +12");}
month+=months;if(month>12){year+=1;month-=12;}
if(month<1){year-=1;month+=12;}}
var day=Math.min(_utils.monthrange(year,month)[1],asJS(this.ops.day)||asJS(other.day));var repl={year:py.float.fromJSON(year),month:py.float.fromJSON(month),day:py.float.fromJSON(day)};if(py.PY_isInstance(other,datetime.datetime)){repl.hour=py.float.fromJSON(asJS(this.ops.hour)||asJS(other.hour));repl.minute=py.float.fromJSON(asJS(this.ops.minute)||asJS(other.minute));repl.second=py.float.fromJSON(asJS(this.ops.second)||asJS(other.second));}
var days=asJS(this.ops.days);if(py.PY_isTrue(this.ops.leapdays)&&month>2&&_utils.isleap(year)){days+=asJS(this.ops.leapdays);}
var ret=py.PY_add(py.PY_call(py.PY_getAttr(other,'replace'),repl),py.PY_call(datetime.timedelta,{days:py.float.fromJSON(days),hours:py.float.fromJSON(asJS(this.ops.hours)),minutes:py.float.fromJSON(asJS(this.ops.minutes)),seconds:py.float.fromJSON(asJS(this.ops.seconds))}));if(this.ops.weekday){var weekday=asJS(this.ops.weekday),nth=1;var jumpdays=(Math.abs(nth)-1)*7;var ret_weekday=asJS(py.PY_call(py.PY_getAttr(ret,'weekday')));if(nth>0){jumpdays+=(7-ret_weekday+weekday)%7;}else{jumpdays+=(ret_weekday-weekday)%7;jumpdays*=-1;}
ret=py.PY_add(ret,py.PY_call(datetime.timedelta,{days:py.float.fromJSON(jumpdays)}));}
return ret;},__radd__:function(other){return this.__add__(other);},__rsub__:function(other){return this.__neg__().__radd__(other);},__neg__:function(){return py.PY_call(relativedelta,{years:py.PY_negative(this.ops.years),months:py.PY_negative(this.ops.months),days:py.PY_negative(this.ops.days),leapdays:this.ops.leapdays,hours:py.PY_negative(this.ops.hours),minutes:py.PY_negative(this.ops.minutes),seconds:py.PY_negative(this.ops.seconds),year:this.ops.year,month:this.ops.month,day:this.ops.day,weekday:this.ops.weekday,hour:this.ops.hour,minute:this.ops.minute,second:this.ops.second});}});py.extras={datetime:datetime,time:time,relativedelta:relativedelta,};})(typeof exports==='undefined'?py:exports);;

/* /web/static/lib/jquery.ba-bbq/jquery.ba-bbq.js defined in bundle 'point_of_sale.pos_assets_backend' */
(function($,window){'$:nomunge';var undefined,aps=Array.prototype.slice,decode=decodeURIComponent,jq_param=$.param,jq_param_sorted,jq_param_fragment,jq_deparam,jq_deparam_fragment,jq_bbq=$.bbq=$.bbq||{},jq_bbq_pushState,jq_bbq_getState,jq_elemUrlAttr,special=$.event.special,str_hashchange='hashchange',str_querystring='querystring',str_fragment='fragment',str_elemUrlAttr='elemUrlAttr',str_href='href',str_src='src',re_params_querystring=/^.*\?|#.*$/g,re_params_fragment,re_fragment,re_no_escape,ajax_crawlable,fragment_prefix,elemUrlAttr_cache={};function is_string(arg){return typeof arg==='string';};function curry(func){var args=aps.call(arguments,1);return function(){return func.apply(this,args.concat(aps.call(arguments)));};};function get_fragment(url){return url.replace(re_fragment,'$2');};function get_querystring(url){return url.replace(/(?:^[^?#]*\?([^#]*).*$)?.*/,'$1');};function jq_param_sub(is_fragment,get_func,url,params,merge_mode){var result,qs,matches,url_params,hash;if(params!==undefined){matches=url.match(is_fragment?re_fragment:/^([^#?]*)\??([^#]*)(#?.*)/);hash=matches[3]||'';if(merge_mode===2&&is_string(params)){qs=params.replace(is_fragment?re_params_fragment:re_params_querystring,'');}else{url_params=jq_deparam(matches[2]);params=is_string(params)?jq_deparam[is_fragment?str_fragment:str_querystring](params):params;qs=merge_mode===2?params:merge_mode===1?$.extend({},params,url_params):$.extend({},url_params,params);qs=jq_param_sorted(qs);if(is_fragment){qs=qs.replace(re_no_escape,decode);}}
result=matches[1]+(is_fragment?fragment_prefix:qs||!matches[1]?'?':'')+qs+hash;}else{result=get_func(url!==undefined?url:location.href);}
return result;};jq_param[str_querystring]=curry(jq_param_sub,0,get_querystring);jq_param[str_fragment]=jq_param_fragment=curry(jq_param_sub,1,get_fragment);jq_param.sorted=jq_param_sorted=function(a,traditional){var arr=[],obj={};$.each(jq_param(a,traditional).split('&'),function(i,v){var key=v.replace(/(?:%5B|=).*$/,''),key_obj=obj[key];if(!key_obj){key_obj=obj[key]=[];arr.push(key);}
key_obj.push(v);});return $.map(arr.sort(),function(v){return obj[v];}).join('&');};jq_param_fragment.noEscape=function(chars){chars=chars||'';var arr=$.map(chars.split(''),encodeURIComponent);re_no_escape=new RegExp(arr.join('|'),'g');};jq_param_fragment.noEscape(',/');jq_param_fragment.ajaxCrawlable=function(state){if(state!==undefined){if(state){re_params_fragment=/^.*(?:#!|#)/;re_fragment=/^([^#]*)(?:#!|#)?(.*)$/;fragment_prefix='#!';}else{re_params_fragment=/^.*#/;re_fragment=/^([^#]*)#?(.*)$/;fragment_prefix='#';}
ajax_crawlable=!!state;}
return ajax_crawlable;};jq_param_fragment.ajaxCrawlable(0);$.deparam=jq_deparam=function(params,coerce){var obj={},coerce_types={'true':!0,'false':!1,'null':null};$.each(params.replace(/\+/g,' ').split('&'),function(j,v){var param=v.split('='),key=decode(param[0]),val,cur=obj,i=0,keys=key.split(']['),keys_last=keys.length-1;if(/\[/.test(keys[0])&&/\]$/.test(keys[keys_last])){keys[keys_last]=keys[keys_last].replace(/\]$/,'');keys=keys.shift().split('[').concat(keys);keys_last=keys.length-1;}else{keys_last=0;}
if(param.length===2){val=decode(param[1]);if(coerce){val=val&&!isNaN(val)?+val:val==='undefined'?undefined:coerce_types[val]!==undefined?coerce_types[val]:val;}
if(keys_last){for(;i<=keys_last;i++){key=keys[i]===''?cur.length:keys[i];cur=cur[key]=i<keys_last?cur[key]||(keys[i+1]&&isNaN(keys[i+1])?{}:[]):val;}}else{if($.isArray(obj[key])){obj[key].push(val);}else if(obj[key]!==undefined){obj[key]=[obj[key],val];}else{obj[key]=val;}}}else if(key){obj[key]=coerce?undefined:'';}});return obj;};function jq_deparam_sub(is_fragment,url_or_params,coerce){if(url_or_params===undefined||typeof url_or_params==='boolean'){coerce=url_or_params;url_or_params=jq_param[is_fragment?str_fragment:str_querystring]();}else{url_or_params=is_string(url_or_params)?url_or_params.replace(is_fragment?re_params_fragment:re_params_querystring,''):url_or_params;}
return jq_deparam(url_or_params,coerce);};jq_deparam[str_querystring]=curry(jq_deparam_sub,0);jq_deparam[str_fragment]=jq_deparam_fragment=curry(jq_deparam_sub,1);$[str_elemUrlAttr]||($[str_elemUrlAttr]=function(obj){return $.extend(elemUrlAttr_cache,obj);})({a:str_href,base:str_href,iframe:str_src,img:str_src,input:str_src,form:'action',link:str_href,script:str_src});jq_elemUrlAttr=$[str_elemUrlAttr];function jq_fn_sub(mode,force_attr,params,merge_mode){if(!is_string(params)&&typeof params!=='object'){merge_mode=params;params=force_attr;force_attr=undefined;}
return this.each(function(){var that=$(this),attr=force_attr||jq_elemUrlAttr()[(this.nodeName||'').toLowerCase()]||'',url=attr&&that.attr(attr)||'';that.attr(attr,jq_param[mode](url,params,merge_mode));});};$.fn[str_querystring]=curry(jq_fn_sub,str_querystring);$.fn[str_fragment]=curry(jq_fn_sub,str_fragment);jq_bbq.pushState=jq_bbq_pushState=function(params,merge_mode){if(is_string(params)&&/^#/.test(params)&&merge_mode===undefined){merge_mode=2;}
var has_args=params!==undefined,url=jq_param_fragment(location.href,has_args?params:{},has_args?merge_mode:2);location.href=url;};jq_bbq.getState=jq_bbq_getState=function(key,coerce){return key===undefined||typeof key==='boolean'?jq_deparam_fragment(key):jq_deparam_fragment(coerce)[key];};jq_bbq.removeState=function(arr){var state={};if(arr!==undefined){state=jq_bbq_getState();$.each($.isArray(arr)?arr:arguments,function(i,v){delete state[v];});}
jq_bbq_pushState(state,2);};special[str_hashchange]=$.extend(special[str_hashchange],{add:function(handleObj){var old_handler;function new_handler(e){var hash=e[str_fragment]=jq_param_fragment();e.getState=function(key,coerce){return key===undefined||typeof key==='boolean'?jq_deparam(hash,key):jq_deparam(hash,coerce)[key];};old_handler.apply(this,arguments);};if($.isFunction(handleObj)){old_handler=handleObj;return new_handler;}else{old_handler=handleObj.handler;handleObj.handler=new_handler;}}});})(jQuery,this);(function($,window,undefined){'$:nomunge';var str_hashchange='hashchange',doc=document,fake_onhashchange,special=$.event.special,doc_mode=doc.documentMode,supports_onhashchange='on'+str_hashchange in window&&(doc_mode===undefined||doc_mode>7);function get_fragment(url){url=url||location.href;return'#'+url.replace(/^[^#]*#?(.*)$/,'$1');};$.fn[str_hashchange]=function(fn){return fn?this.bind(str_hashchange,fn):this.trigger(str_hashchange);};$.fn[str_hashchange].delay=50;special[str_hashchange]=$.extend(special[str_hashchange],{setup:function(){if(supports_onhashchange){return false;}
$(fake_onhashchange.start);},teardown:function(){if(supports_onhashchange){return false;}
$(fake_onhashchange.stop);}});fake_onhashchange=(function(){var self={},timeout_id,last_hash=get_fragment(),fn_retval=function(val){return val;},history_set=fn_retval,history_get=fn_retval;self.start=function(){timeout_id||poll();};self.stop=function(){timeout_id&&clearTimeout(timeout_id);timeout_id=undefined;};function poll(){var hash=get_fragment(),history_hash=history_get(last_hash);if(hash!==last_hash){history_set(last_hash=hash,history_hash);$(window).trigger(str_hashchange);}else if(history_hash!==last_hash){location.href=location.href.replace(/#.*/,'')+history_hash;}
timeout_id=setTimeout(poll,$.fn[str_hashchange].delay);};$.browser.msie&&!supports_onhashchange&&(function(){var iframe,iframe_src;self.start=function(){if(!iframe){iframe_src=$.fn[str_hashchange].src;iframe_src=iframe_src&&iframe_src+get_fragment();iframe=$('<iframe tabindex="-1" title="empty"/>').hide().one('load',function(){iframe_src||history_set(get_fragment());poll();}).attr('src',iframe_src||'javascript:0').insertAfter('body')[0].contentWindow;doc.onpropertychange=function(){try{if(event.propertyName==='title'){iframe.document.title=doc.title;}}catch(e){}};}};self.stop=fn_retval;history_get=function(){return get_fragment(iframe.location.href);};history_set=function(hash,history_hash){var iframe_doc=iframe.document,domain=$.fn[str_hashchange].domain;if(hash!==history_hash){iframe_doc.title=doc.title;iframe_doc.open();domain&&iframe_doc.write('<script>document.domain="'+domain+'"</script>');iframe_doc.close();iframe.location.hash=hash;}};})();return self;})();})(jQuery,this);;

/* /web/static/src/js/core/domain.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("web.Domain",function(require){"use strict";var collections=require("web.collections");var pyUtils=require("web.py_utils");var py=window.py;const TRUE_LEAF=[1,'=',1];const FALSE_LEAF=[0,'=',1];const TRUE_DOMAIN=[TRUE_LEAF];const FALSE_DOMAIN=[FALSE_LEAF];function compare(a,b){return JSON.stringify(a)===JSON.stringify(b);}
var Domain=collections.Tree.extend({init:function(domain,evalContext){this._super.apply(this,arguments);if(_.isArray(domain)||_.isString(domain)){this._parse(this.normalizeArray(_.clone(this.stringToArray(domain,evalContext))));}else{this._data=!!domain;}},compute:function(values){if(this._data===true||this._data===false){return this._data;}else if(_.isArray(this._data)){var isParentField=false;var fieldName=this._data[0];let fieldValue;if(compare(this._data,FALSE_LEAF)||compare(this._data,TRUE_LEAF)){fieldValue=this._data[0];}else{var parentField=this._data[0].split('.');if('parent'in values&&parentField.length===2){fieldName=parentField[1];isParentField=parentField[0]==='parent'&&fieldName in values.parent;}
if(!(this._data[0]in values)&&!(isParentField)){throw new Error(_.str.sprintf("Unknown field %s in domain",this._data[0]));}
fieldValue=isParentField?values.parent[fieldName]:values[fieldName];}
switch(this._data[1]){case"=":case"==":return _.isEqual(fieldValue,this._data[2]);case"!=":case"<>":return!_.isEqual(fieldValue,this._data[2]);case"<":return(fieldValue<this._data[2]);case">":return(fieldValue>this._data[2]);case"<=":return(fieldValue<=this._data[2]);case">=":return(fieldValue>=this._data[2]);case"in":return _.intersection(_.isArray(this._data[2])?this._data[2]:[this._data[2]],_.isArray(fieldValue)?fieldValue:[fieldValue],).length!==0;;case"not in":return _.intersection(_.isArray(this._data[2])?this._data[2]:[this._data[2]],_.isArray(fieldValue)?fieldValue:[fieldValue],).length===0;case"like":return(fieldValue.toLowerCase().indexOf(this._data[2].toLowerCase())>=0);case"=like":var regExp=new RegExp(this._data[2].toLowerCase().replace(/([.\[\]\{\}\+\*])/g,'\\\$1').replace(/%/g,'.*'));return regExp.test(fieldValue.toLowerCase());case"ilike":return(fieldValue.indexOf(this._data[2])>=0);case"=ilike":return new RegExp(this._data[2].replace(/%/g,'.*'),'i').test(fieldValue);default:throw new Error(_.str.sprintf("Domain %s uses an unsupported operator",this._data));}}else{switch(this._data){case"&":return _.every(this._children,function(child){return child.compute(values);});case"|":return _.some(this._children,function(child){return child.compute(values);});case"!":return!this._children[0].compute(values);}}},toArray:function(){if(this._data===false){throw new Error("'false' domain cannot be converted to array");}else if(this._data===true){return[];}else{var arr=[this._data];return arr.concat.apply(arr,_.map(this._children,function(child){return child.toArray();}));}},toString:function(){return Domain.prototype.arrayToString(this.toArray());},_parse:function(domain){this._data=(domain.length===0?true:domain[0]);if(domain.length<=1)return;var expected=1;for(var i=1;i<domain.length;i++){if(domain[i]==="&"||domain[i]==="|"){expected++;}else if(domain[i]!=="!"){expected--;}
if(!expected){i++;this._addSubdomain(domain.slice(1,i));this._addSubdomain(domain.slice(i));break;}}},_addSubdomain:function(domain){if(!domain.length)return;var subdomain=new Domain(domain);if(!subdomain._children.length||subdomain._data!==this._data){this._children.push(subdomain);}else{var self=this;_.each(subdomain._children,function(childDomain){self._children.push(childDomain);});}},arrayToString:function(domain){if(_.isString(domain))return domain;return JSON.stringify(domain||[]).replace(/null/g,"None").replace(/false/g,"False").replace(/true/g,"True");},stringToArray:function(domain,evalContext){if(!_.isString(domain))return _.clone(domain);return pyUtils.eval("domain",domain?domain.replace(/%%/g,'%'):"[]",evalContext);},normalizeArray:function(domain){if(domain.length===0){return domain;}
var expected=1;_.each(domain,function(item){if(item==="&"||item==="|"){expected++;}else if(item!=="!"){expected--;}});if(expected<0){domain.unshift.apply(domain,_.times(Math.abs(expected),_.constant("&")));}else if(expected>0){throw new Error(_.str.sprintf("invalid domain %s (missing %d segment(s))",JSON.stringify(domain),expected));}
return domain;},domainToCondition:function(domain){if(!domain.length){return'True';}
var self=this;function consume(stack){var len=stack.length;if(len<=1){return stack;}else if(stack[len-1]==='|'||stack[len-1]==='&'||stack[len-2]==='|'||stack[len-2]==='&'){return stack;}else if(len==2){stack.splice(-2,2,stack[len-2]+' and '+stack[len-1]);}else if(stack[len-3]=='|'){if(len===3){stack.splice(-3,3,stack[len-2]+' or '+stack[len-1]);}else{stack.splice(-3,3,'('+stack[len-2]+' or '+stack[len-1]+')');}}else{stack.splice(-3,3,stack[len-2]+' and '+stack[len-1]);}
consume(stack);}
var stack=[];_.each(domain,function(dom){if(dom==='|'||dom==='&'){stack.push(dom);}else{var operator=dom[1]==='='?'==':dom[1];if(!operator){throw new Error('Wrong operator for this domain');}
if(operator==='!='&&dom[2]===false){stack.push(dom[0]);}else if(dom[2]===null||dom[2]===true||dom[2]===false){stack.push(dom[0]+' '+(operator==='!='?'is not ':'is ')+(dom[2]===null?'None':(dom[2]?'True':'False')));}else{stack.push(dom[0]+' '+operator+' '+JSON.stringify(dom[2]));}
consume(stack);}});if(stack.length!==1){throw new Error('Wrong domain');}
return stack[0];},conditionToDomain:function(condition){if(!condition||condition.match(/^\s*(True)?\s*$/)){return[];}
var ast=py.parse(py.tokenize(condition));function astToStackValue(node){switch(node.id){case'(name)':return node.value;case'.':return astToStackValue(node.first)+'.'+astToStackValue(node.second);case'(string)':return node.value;case'(number)':return node.value;case'(constant)':return node.value==='None'?null:node.value==='True'?true:false;case'[':return _.map(node.first,function(node){return astToStackValue(node);});}}
function astToStack(node){switch(node.id){case'(name)':return[[astToStackValue(node),'!=',false]];case'.':return[[astToStackValue(node.first)+'.'+astToStackValue(node.second),'!=',false]];case'not':return[[astToStackValue(node.first),'=',false]];case'or':return['|'].concat(astToStack(node.first)).concat(astToStack(node.second));case'and':return['&'].concat(astToStack(node.first)).concat(astToStack(node.second));case'(comparator)':if(node.operators.length!==1){throw new Error('Wrong condition to convert in domain');}
var right=astToStackValue(node.expressions[0]);var left=astToStackValue(node.expressions[1]);var operator=node.operators[0];switch(operator){case'is':operator='=';break;case'is not':operator='!=';break;case'==':operator='=';break;}
return[[right,operator,left]];default:throw"Condition cannot be transformed into domain";}}
return astToStack(ast);},});Domain.TRUE_LEAF=TRUE_LEAF;Domain.FALSE_LEAF=FALSE_LEAF;Domain.TRUE_DOMAIN=TRUE_DOMAIN;Domain.FALSE_DOMAIN=FALSE_DOMAIN;return Domain;});;

/* /web/static/src/js/core/mvc.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.mvc',function(require){"use strict";var ajax=require('web.ajax');var Class=require('web.Class');var mixins=require('web.mixins');var ServicesMixin=require('web.ServicesMixin');var Widget=require('web.Widget');var Model=Class.extend(mixins.EventDispatcherMixin,ServicesMixin,{init:function(parent,params){mixins.EventDispatcherMixin.init.call(this);this.setParent(parent);},get:function(){},load:function(){return Promise.resolve();},});var Renderer=Widget.extend({init:function(parent,state,params){this._super(parent);this.state=state;},});var Controller=Widget.extend({init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.handle=params.handle||null;this.model=model;this.renderer=renderer;},start:function(){return Promise.all([this._super.apply(this,arguments),this._startRenderer()]);},_startRenderer:function(){return this.renderer.appendTo(this.$el);},});var Factory=Class.extend({config:{Model:Model,Renderer:Renderer,Controller:Controller,},init:function(){this.rendererParams={};this.controllerParams={};this.modelParams={};this.loadParams={};},getController:function(parent){var self=this;var model=this.getModel(parent);return Promise.all([this._loadData(model),ajax.loadLibs(this)]).then(function(result){const{state,handle}=result[0];var renderer=self.getRenderer(parent,state);var Controller=self.Controller||self.config.Controller;const initialState=model.get(handle);var controllerParams=_.extend({initialState,handle,},self.controllerParams);var controller=new Controller(parent,model,renderer,controllerParams);model.setParent(controller);renderer.setParent(controller);return controller;});},getModel:function(parent){var Model=this.config.Model;return new Model(parent,this.modelParams);},getRenderer:function(parent,state){var Renderer=this.config.Renderer;return new Renderer(parent,state,this.rendererParams);},_loadData:function(model,options={}){options.withSampleData='withSampleData'in options?options.withSampleData:true;return model.load(this.loadParams).then(function(handle){return{state:model.get(handle,options),handle};});},});return{Factory:Factory,Model:Model,Renderer:Renderer,Controller:Controller,};});;

/* /web/static/src/js/core/py_utils.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.py_utils',function(require){"use strict";var core=require('web.core');var _t=core._t;var py=window.py;function wrap(value){if(value===null){return py.None;}
switch(typeof value){case'undefined':throw new Error("No conversion for undefined");case'boolean':return py.bool.fromJSON(value);case'number':return py.float.fromJSON(value);case'string':return py.str.fromJSON(value);}
switch(value.constructor){case Object:return wrapping_dict.fromJSON(value);case Array:return wrapping_list.fromJSON(value);}
throw new Error("ValueError: unable to wrap "+value);}
var wrapping_dict=py.type('wrapping_dict',null,{__init__:function(){this._store={};},__getitem__:function(key){var k=key.toJSON();if(!(k in this._store)){throw new Error("KeyError: '"+k+"'");}
return wrap(this._store[k]);},__getattr__:function(key){return this.__getitem__(py.str.fromJSON(key));},__len__:function(){return Object.keys(this._store).length;},__nonzero__:function(){return py.PY_size(this)>0?py.True:py.False;},get:function(){var args=py.PY_parseArgs(arguments,['k',['d',py.None]]);if(!(args.k.toJSON()in this._store)){return args.d;}
return this.__getitem__(args.k);},fromJSON:function(d){var instance=py.PY_call(wrapping_dict);instance._store=d;return instance;},toJSON:function(){return this._store;},});var wrapping_list=py.type('wrapping_list',null,{__init__:function(){this._store=[];},__getitem__:function(index){return wrap(this._store[index.toJSON()]);},__len__:function(){return this._store.length;},__nonzero__:function(){return py.PY_size(this)>0?py.True:py.False;},fromJSON:function(ar){var instance=py.PY_call(wrapping_list);instance._store=ar;return instance;},toJSON:function(){return this._store;},});function wrap_context(context){for(var k in context){if(!context.hasOwnProperty(k)){continue;}
var val=context[k];if(val===null){continue;}
if(val.constructor===Array){context[k]=wrapping_list.fromJSON(val);}else if(val.constructor===Object&&!py.PY_isInstance(val,py.object)){context[k]=wrapping_dict.fromJSON(val);}}
return context;}
function eval_contexts(contexts,evaluation_context){evaluation_context=_.extend(pycontext(),evaluation_context||{});return _(contexts).reduce(function(result_context,ctx){if(_.isEmpty(ctx)){return result_context;}
if(_.isString(ctx)){ctx={__ref:'context',__debug:ctx};}
var evaluated=ctx;switch(ctx.__ref){case'context':evaluation_context.context=evaluation_context;evaluated=py.eval(ctx.__debug,wrap_context(evaluation_context));break;case'compound_context':var eval_context=eval_contexts([ctx.__eval_context]);evaluated=eval_contexts(ctx.__contexts,_.extend({},evaluation_context,eval_context));break;}
_.extend(evaluation_context,evaluated);return _.extend(result_context,evaluated);},{});}
function eval_domains(domains,evaluation_context){evaluation_context=_.extend(pycontext(),evaluation_context||{});var result_domain=[];var need_normalization=(domains&&domains.length>0&&domains[0].length===1&&(domains[0][0]==="|"||domains[0][0]==="!"));_(domains).each(function(domain){if(_.isString(domain)){domain={__ref:'domain',__debug:domain};}
var domain_array_to_combine;switch(domain.__ref){case'domain':evaluation_context.context=evaluation_context;domain_array_to_combine=py.eval(domain.__debug,wrap_context(evaluation_context));break;default:domain_array_to_combine=domain;}
if(need_normalization){domain_array_to_combine=get_normalized_domain(domain_array_to_combine);}
result_domain.push.apply(result_domain,domain_array_to_combine);});return result_domain;}
function get_normalized_domain(domain_array){var expected=1;_.each(domain_array,function(item){if(item==="&"||item==="|"){expected++;}else if(item!=="!"){expected--;}});var new_explicit_ands=_.times(-expected,_.constant("&"));return new_explicit_ands.concat(domain_array);}
function eval_groupbys(contexts,evaluation_context){evaluation_context=_.extend(pycontext(),evaluation_context||{});var result_group=[];_(contexts).each(function(ctx){if(_.isString(ctx)){ctx={__ref:'context',__debug:ctx};}
var group;var evaluated=ctx;switch(ctx.__ref){case'context':evaluation_context.context=evaluation_context;evaluated=py.eval(ctx.__debug,wrap_context(evaluation_context));break;case'compound_context':var eval_context=eval_contexts([ctx.__eval_context]);evaluated=eval_contexts(ctx.__contexts,_.extend({},evaluation_context,eval_context));break;}
group=evaluated.group_by;if(!group){return;}
if(typeof group==='string'){result_group.push(group);}else if(group instanceof Array){result_group.push.apply(result_group,group);}else{throw new Error('Got invalid groupby {{'
+JSON.stringify(group)+'}}');}
_.extend(evaluation_context,evaluated);});return result_group;}
function context_today(){var d=new Date();return py.PY_call(py.extras.datetime.date,[d.getFullYear(),d.getMonth()+1,d.getDate()]);}
function tz_offset(){var offset=new Date().getTimezoneOffset();var kwargs={minutes:py.float.fromJSON(offset)};return py.PY_call(py.extras.datetime.timedelta,[],kwargs);}
function pycontext(){const d=new Date();const today=`${
        String(d.getFullYear()).padStart(4, "0")}-${
        String(d.getMonth() + 1).padStart(2, "0")}-${
        String(d.getDate()).padStart(2, "0")}`;const now=`${
        String(d.getUTCFullYear()).padStart(4, "0")}-${
        String(d.getUTCMonth() + 1).padStart(2, "0")}-${
        String(d.getUTCDate()).padStart(2, "0")} ${
        String(d.getUTCHours()).padStart(2, "0")}:${
        String(d.getUTCMinutes()).padStart(2, "0")}:${
        String(d.getUTCSeconds()).padStart(2, "0")}`;const{datetime,relativedelta,time}=py.extras;return{current_date:today,datetime,time,now,today,relativedelta,context_today,tz_offset,};}
function pyeval(type,object,context){context=_.extend(pycontext(),context||{});switch(type){case'context':case'contexts':if(type==='context'){object=[object];}
return eval_contexts(object,context);case'domain':case'domains':if(type==='domain')
object=[object];return eval_domains(object,context);case'groupbys':return eval_groupbys(object,context);}
throw new Error("Unknow evaluation type "+type);}
function eval_arg(arg){if(typeof arg!=='object'||!arg.__ref){return arg;}
switch(arg.__ref){case'domain':return pyeval('domains',[arg]);case'context':case'compound_context':return pyeval('contexts',[arg]);default:throw new Error(_t("Unknown nonliteral type ")+' '+arg.__ref);}}
function ensure_evaluated(args,kwargs){for(var i=0;i<args.length;++i){args[i]=eval_arg(args[i]);}
for(var k in kwargs){if(!kwargs.hasOwnProperty(k)){continue;}
kwargs[k]=eval_arg(kwargs[k]);}}
function eval_domains_and_contexts(source){return{context:pyeval('contexts',source.contexts||[],source.eval_context),domain:pyeval('domains',source.domains,source.eval_context),group_by:pyeval('groupbys',source.group_by_seq||[],source.eval_context),};}
function py_eval(expr,context){return py.eval(expr,_.extend({},context||{},{"true":true,"false":false,"null":null}));}
function assembleDomains(domains,operator){var ASTs=domains.map(_getPyJSAST);if(operator==="OR"){operator=py.tokenize("'|'")[0];}else{operator=py.tokenize("'&'")[0];}
var result=_getPyJSAST("[]");var normalizedDomains=ASTs.filter(function(AST){return AST.first.length>0;}).map(_normalizeDomainAST);if(normalizedDomains.length>0){result.first=normalizedDomains.reduce(function(acc,ast){return acc.concat(ast.first);},_.times(normalizedDomains.length-1,_.constant(operator)));}
return _formatAST(result);}
function normalizeDomain(domain){return _formatAST(_normalizeDomainAST(_getPyJSAST(domain)));}
var BINDING_POWERS={or:30,and:40,not:50,};function _formatAST(ast,lbp){lbp=lbp||0;switch(ast.id){case"(number)":return String(ast.value);case"(string)":return JSON.stringify(ast.value);case"(constant)":return ast.value;case"(name)":return ast.value;case"[":if(ast.second){return _formatAST(ast.first)+'['+_formatAST(ast.second)+']';}else{var values=ast.first.map(_formatAST);return'['+values.join(', ')+']';}
case"{":var keyValues=ast.first.map(function(kv){return _formatAST(kv[0])+': '+_formatAST(kv[1]);});return'{'+keyValues.join(', ')+'}';case"=":return _formatAST(ast.first)+' '+ast.id+' '+_formatAST(ast.second);case"-":case"+":case"~":case"*":case"**":case"%":case"//":case"and":case"or":if(ast.second){var r=_formatAST(ast.first,ast.lbp)+' '+ast.id+' '+_formatAST(ast.second,ast.lbp);if(ast.lbp<lbp){r='('+r+')';}
return r;}
var actualBP=BINDING_POWERS[ast.id]||130;return ast.id+_formatAST(ast.first,actualBP);case"if":var t=_formatAST(ast.ifTrue)
+' if '+_formatAST(ast.condition)
+' else '+_formatAST(ast.ifFalse);return ast.lbp<lbp?'('+t+')':t;case".":return _formatAST(ast.first,ast.lbp)+'.'+_formatAST(ast.second);case"not":return"not "+_formatAST(ast.first);case"(comparator)":var operator=ast.operators[0];return _formatAST(ast.expressions[0])+' '+operator+' '+_formatAST(ast.expressions[1]);case"(":if(ast.second){return _formatAST(ast.first)+'('+ast.second.map(_formatAST).join(', ')+')';}else{return'('+ast.first.map(_formatAST).join(', ')+')';}}
throw new Error("Unimplemented python construct");}
function _getPyJSAST(domain){return py.parse(py.tokenize(domain));}
function _normalizeDomainAST(domain){var expected=1;for(var i=0;i<domain.first.length;i++){var value=domain.first[i].value;if(value==='&'||value==='|'){expected++;}else if(value!=='!'){expected--;}}
var andOperator=py.tokenize("'&'")[0];if(expected<0){domain.first.unshift.apply(domain.first,_.times(Math.abs(expected),_.constant(andOperator)));}
return domain;}
return{context:pycontext,ensure_evaluated:ensure_evaluated,eval:pyeval,eval_domains_and_contexts:eval_domains_and_contexts,py_eval:py_eval,normalizeDomain:normalizeDomain,assembleDomains:assembleDomains,_getPyJSAST:_getPyJSAST,_formatAST:_formatAST,_normalizeDomainAST:_normalizeDomainAST,};});;

/* /web/static/src/js/chrome/abstract_action.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.AbstractAction',function(require){"use strict";var ActionMixin=require('web.ActionMixin');const ActionModel=require('web/static/src/js/views/action_model.js');var ControlPanel=require('web.ControlPanel');var Widget=require('web.Widget');const{ComponentWrapper}=require('web.OwlCompatibility');var AbstractAction=Widget.extend(ActionMixin,{config:{ControlPanel:ControlPanel,},hasControlPanel:false,loadControlPanel:false,withSearchBar:false,searchMenuTypes:[],init:function(parent,action,options){this._super(parent);this._title=action.display_name||action.name;this.searchModelConfig={context:Object.assign({},action.context),domain:action.domain||[],env:owl.Component.env,searchMenuTypes:this.searchMenuTypes,};this.extensions={};if(this.hasControlPanel){this.extensions.ControlPanel={actionId:action.id,withSearchBar:this.withSearchBar,};this.viewId=action.search_view_id&&action.search_view_id[0];this.controlPanelProps={action,breadcrumbs:options&&options.breadcrumbs,withSearchBar:this.withSearchBar,searchMenuTypes:this.searchMenuTypes,};}},willStart:async function(){const superPromise=this._super(...arguments);if(this.hasControlPanel){if(this.loadControlPanel){const{context,modelName}=this.searchModelConfig;const options={load_filters:this.searchMenuTypes.includes('favorite')};const{arch,fields,favoriteFilters}=await this.loadFieldView(modelName,context||{},this.viewId,'search',options);const archs={search:arch};const{ControlPanel:controlPanelInfo}=ActionModel.extractArchInfo(archs);Object.assign(this.extensions.ControlPanel,{archNodes:controlPanelInfo.children,favoriteFilters,fields,});this.controlPanelProps.fields=fields;}}
this.searchModel=new ActionModel(this.extensions,this.searchModelConfig);if(this.hasControlPanel){this.controlPanelProps.searchModel=this.searchModel;}
return Promise.all([superPromise,this.searchModel.load(),]);},start:async function(){await this._super(...arguments);if(this.hasControlPanel){if('title'in this.controlPanelProps){this._setTitle(this.controlPanelProps.title);}
this.controlPanelProps.title=this.getTitle();this._controlPanelWrapper=new ComponentWrapper(this,this.config.ControlPanel,this.controlPanelProps);await this._controlPanelWrapper.mount(this.el,{position:'first-child'});}},destroy:function(){this._super.apply(this,arguments);ActionMixin.destroy.call(this);},on_attach_callback:function(){ActionMixin.on_attach_callback.call(this);this.searchModel.on('search',this,this._onSearch);if(this.hasControlPanel){this.searchModel.on('get-controller-query-params',this,this._onGetOwnedQueryParams);}},on_detach_callback:function(){ActionMixin.on_detach_callback.call(this);this.searchModel.off('search',this);if(this.hasControlPanel){this.searchModel.off('get-controller-query-params',this);}},_onSearch:function(){},});return AbstractAction;});;

/* /web/static/src/js/chrome/action_manager.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.ActionManager',function(require){"use strict";var AbstractAction=require('web.AbstractAction');var concurrency=require('web.concurrency');var Context=require('web.Context');var core=require('web.core');var Dialog=require('web.Dialog');var dom=require('web.dom');var framework=require('web.framework');var pyUtils=require('web.py_utils');var Widget=require('web.Widget');var _t=core._t;var ActionManager=Widget.extend({className:'o_action_manager',custom_events:{breadcrumb_clicked:'_onBreadcrumbClicked',history_back:'_onHistoryBack',push_state:'_onPushState',redirect:'_onRedirect',},init:function(parent,userContext){this._super.apply(this,arguments);this.userContext=userContext||{};this.dp=new concurrency.DropPrevious();this.actions={};this.controllers={};this.controllerStack=[];this.currentDialogController=null;},on_attach_callback:function(){this.isInDOM=true;var currentController=this.getCurrentController();if(currentController){currentController.widget.on_attach_callback();}},on_detach_callback:function(){this.isInDOM=false;var currentController=this.getCurrentController();if(currentController){currentController.widget.on_detach_callback();}},clearUncommittedChanges:function(){var currentController=this.getCurrentController();if(currentController){return currentController.widget.canBeRemoved();}
return Promise.resolve();},doAction:function(action,options){var self=this;options=_.defaults({},options,{additional_context:{},clear_breadcrumbs:false,on_close:function(){},on_reverse_breadcrumb:function(){},pushState:true,replace_last_action:false,});var def;if(_.isString(action)&&core.action_registry.contains(action)){action={type:'ir.actions.client',tag:action};}else if(_.isNumber(action)||_.isString(action)){def=this._loadAction(action,{active_id:options.additional_context.active_id,active_ids:options.additional_context.active_ids,active_model:options.additional_context.active_model,}).then(function(result){action=result;});}
return this.dp.add(Promise.resolve(def)).then(function(){options.clear_breadcrumbs=action.target==='main'||options.clear_breadcrumbs;self._preprocessAction(action,options);return self._handleAction(action,options).then(function(){action.pushState=true;return action;});}).then(function(action){self.trigger_up('webclient_started');return action;});},do_push_state:function(state){this.trigger_up('push_state',{state:state});},getCurrentAction:function(){var controller=this.getCurrentController();return controller?this.actions[controller.actionID]:null;},getCurrentController:function(){var currentControllerID=_.last(this.controllerStack);return currentControllerID?this.controllers[currentControllerID]:null;},loadState:function(state){var action;if(!state.action){return Promise.resolve();}
if(_.isString(state.action)&&core.action_registry.contains(state.action)){action={params:state,tag:state.action,type:'ir.actions.client',};}else{action=state.action;}
return this.doAction(action,{clear_breadcrumbs:true,pushState:false,});},_appendController:function(controller){dom.append(this.$el,controller.widget.$el,{in_DOM:this.isInDOM,callbacks:[{widget:controller.widget}],});if(controller.scrollPosition){this.trigger_up('scrollTo',controller.scrollPosition);}},_closeDialog:function(options){if(this.currentDialogController){this.currentDialogController.dialog.destroy(options);}},_detachCurrentController:function(){var currentController=this.getCurrentController();if(currentController){currentController.scrollPosition=this._getScrollPosition();dom.detach([{widget:currentController.widget}]);}},_executeAction:function(action,options){var self=this;this.actions[action.jsID]=action;if(action.target==='new'){return this._executeActionInDialog(action,options);}
var controller=self.controllers[action.controllerID];return this.clearUncommittedChanges().then(function(){return self.dp.add(self._startController(controller));}).then(function(){if(self.currentDialogController){self._closeDialog({silent:true});}
if(options.on_reverse_breadcrumb){var currentAction=self.getCurrentAction();if(currentAction){currentAction.on_reverse_breadcrumb=options.on_reverse_breadcrumb;}}
self._pushController(controller);self.call('session_storage','setItem','current_action',action._originalAction);return action;}).guardedCatch(function(){self._removeAction(action.jsID);});},_executeActionInDialog:function(action,options){var self=this;var controller=this.controllers[action.controllerID];var widget=controller.widget;return this._startController(controller).then(function(controller){var prevDialogOnClose;if(self.currentDialogController){prevDialogOnClose=self.currentDialogController.onClose;self._closeDialog({silent:true});}
controller.onClose=prevDialogOnClose||options.on_close;var dialog=new Dialog(self,_.defaults({},options,{buttons:[],dialogClass:controller.className,title:action.name,size:action.context.dialog_size,}));dialog.on('closed',self,function(options){options=options||{};self._removeAction(action.jsID);self.currentDialogController=null;if(options.silent!==true){controller.onClose(options.infos);}});controller.dialog=dialog;return dialog.open().opened(function(){self.currentDialogController=controller;widget.setParent(dialog);dom.append(dialog.$el,widget.$el,{in_DOM:true,callbacks:[{widget:dialog},{widget:controller.widget}],});widget.renderButtons(dialog.$footer);dialog.rebindButtonBehavior();return action;});}).guardedCatch(function(){self._removeAction(action.jsID);});},_executeClientAction:function(action,options){var self=this;var ClientAction=core.action_registry.get(action.tag);if(!ClientAction){console.error("Could not find client action "+action.tag,action);return Promise.reject();}
if(!(ClientAction.prototype instanceof Widget)){var next=ClientAction(this,action);if(next){return this.doAction(next,options);}
return Promise.resolve();}
if(!(ClientAction.prototype instanceof AbstractAction)){console.warn('The client action '+action.tag+' should be an instance of AbstractAction!');}
var controllerID=_.uniqueId('controller_');var index=this._getControllerStackIndex(options);options.breadcrumbs=this._getBreadcrumbs(this.controllerStack.slice(0,index));options.controllerID=controllerID;var widget=new ClientAction(this,action,options);var controller={actionID:action.jsID,index:index,jsID:controllerID,title:widget.getTitle(),widget:widget,};this.controllers[controllerID]=controller;action.controllerID=controllerID;var prom=this._executeAction(action,options);prom.then(function(){self._pushState(controllerID,{});});return prom;},_executeCloseAction:function(action,options){var result;if(!this.currentDialogController){result=options.on_close(action.infos);}
this._closeDialog({infos:action.infos});if(action.effect){this.trigger_up('show_effect',action.effect);}
return Promise.resolve(result);},_executeServerAction:function(action,options){var self=this;var runDef=this._rpc({route:'/web/action/run',params:{action_id:action.id,context:action.context||{},},});return this.dp.add(runDef).then(function(action){action=action||{type:'ir.actions.act_window_close'};return self.doAction(action,options);});},_executeURLAction:function(action,options){var url=action.url;if(action.target==='self'){framework.redirect(url);return Promise.resolve();}else{var w=window.open(url,'_blank');if(!w||w.closed||typeof w.closed==='undefined'){var message=_t('A popup window has been blocked. You '+'may need to change your browser settings to allow '+'popup windows for this page.');this.do_warn(false,message,true);}}
options.on_close();return Promise.resolve();},_getBreadcrumbs:function(controllerStack){var self=this;return _.map(controllerStack,function(controllerID){return{controllerID:controllerID,title:self.controllers[controllerID].title,};});},_getControllerStackIndex:function(options){var index;if('index'in options){index=options.index;}else if(options.clear_breadcrumbs){index=0;}else if(options.replace_last_action){index=this.controllerStack.length-1;}else{index=this.controllerStack.length;}
return index;},_getControllerState:function(controllerID){var controller=this.controllers[controllerID];var action=this.actions[controller.actionID];var state={title:controller.widget.getTitle(),};if(action.id){state.action=action.id;}else if(action.type==='ir.actions.client'){state.action=action.tag;var params=_.pick(action.params,function(v){return _.isString(v)||_.isNumber(v);});state=_.extend(params||{},state);}
if(action.context){var active_id=action.context.active_id;if(active_id){state.active_id=active_id;}
var active_ids=action.context.active_ids;if(active_ids&&!(active_ids.length===1&&active_ids[0]===active_id)){state.active_ids=action.context.active_ids.join(',');}}
state=_.extend({},controller.widget.getState(),state);return state;},_getScrollPosition:function(){var scrollPosition;this.trigger_up('getScrollPosition',{callback:function(_scrollPosition){scrollPosition=_scrollPosition;}});return scrollPosition;},_handleAction:function(action,options){if(!action.type){console.error("No type for action",action);return Promise.reject();}
switch(action.type){case'ir.actions.act_url':return this._executeURLAction(action,options);case'ir.actions.act_window_close':return this._executeCloseAction(action,options);case'ir.actions.client':return this._executeClientAction(action,options);case'ir.actions.server':return this._executeServerAction(action,options);default:console.error("The ActionManager can't handle actions of type "+
action.type,action);return Promise.reject();}},_pushController:function(controller){var self=this;this._detachCurrentController();var toDestroy=this.controllerStack.slice(controller.index);toDestroy=_.reject(toDestroy,function(controllerID){return controllerID===controller.jsID||self.controllers[controllerID].actionID===controller.actionID;});this._removeControllers(toDestroy);this.controllerStack=this.controllerStack.slice(0,controller.index);this.controllerStack.push(controller.jsID);this._appendController(controller);this.trigger_up('current_action_updated',{action:this.getCurrentAction(),controller:controller,});core.bus.trigger('close_dialogs');this._toggleFullscreen();},_pushState:function(controllerID,state){var controller=this.controllers[controllerID];if(controller){var action=this.actions[controller.actionID];if(action.target==='new'||action.pushState===false){return;}
state=_.extend({},state,this._getControllerState(controller.jsID));this.trigger_up('push_state',{state:state});}},_loadAction:function(actionID,context){var self=this;return new Promise(function(resolve,reject){self.trigger_up('load_action',{actionID:actionID,context:context,on_success:resolve,});});},_preprocessAction:function(action,options){var context=new Context(this.userContext,options.additional_context,action.context);action.context=pyUtils.eval('context',context);if(action.domain){action.domain=pyUtils.eval('domain',action.domain,action.context);}
action._originalAction=JSON.stringify(action);action.jsID=_.uniqueId('action_');action.pushState=options.pushState;},_removeAction:function(actionID){var action=this.actions[actionID];var controller=this.controllers[action.controllerID];delete this.actions[action.jsID];delete this.controllers[action.controllerID];controller.widget.destroy();},_removeControllers:function(controllerIDs){var self=this;var actionsToRemove=_.map(controllerIDs,function(controllerID){return self.controllers[controllerID].actionID;});_.each(_.uniq(actionsToRemove),this._removeAction.bind(this));},_restoreController:function(controllerID){var self=this;var controller=this.controllers[controllerID];var action=this.actions[controller.actionID];var def;if(action.on_reverse_breadcrumb){def=action.on_reverse_breadcrumb();}
return Promise.resolve(def).then(function(){return Promise.resolve(controller.widget.do_show()).then(function(){var index=_.indexOf(self.controllerStack,controllerID);self._pushController(controller,index);});});},_startController:function(controller){var fragment=document.createDocumentFragment();return controller.widget.appendTo(fragment).then(function(){return controller;});},_toggleFullscreen:function(){var self=this;var fullscreen=_.some(this.controllerStack,function(controllerID){var controller=self.controllers[controllerID];return self.actions[controller.actionID].target==='fullscreen';});this.trigger_up('toggle_fullscreen',{fullscreen:fullscreen});},_onBreadcrumbClicked:function(ev){ev.stopPropagation();this._restoreController(ev.data.controllerID);},_onHistoryBack:function(){if(this.currentDialogController){this._closeDialog();}else{var length=this.controllerStack.length;if(length>1){this._restoreController(this.controllerStack[length-2]);}}},_onPushState:function(ev){if(ev.target!==this){ev.stopPropagation();this._pushState(ev.data.controllerID,ev.data.state);}},_onRedirect:function(ev){this.do_action({type:'ir.actions.act_window',view_mode:'form',res_model:ev.data.res_model,views:[[false,'form']],res_id:ev.data.res_id,});},});return ActionManager;});;

/* /web/static/src/js/chrome/action_manager_act_window.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.ActWindowActionManager',function(require){"use strict";var ActionManager=require('web.ActionManager');var config=require('web.config');var Context=require('web.Context');var core=require('web.core');var pyUtils=require('web.py_utils');var view_registry=require('web.view_registry');ActionManager.include({custom_events:_.extend({},ActionManager.prototype.custom_events,{execute_action:'_onExecuteAction',switch_view:'_onSwitchView',}),getCurrentController:function(){var currentController=this._super.apply(this,arguments);var action=currentController&&this.actions[currentController.actionID];if(action&&action.type==='ir.actions.act_window'&&!currentController.widget){var lastControllerID=this.controllerStack.pop();currentController=this._super.apply(this,arguments);this.controllerStack.push(lastControllerID);}
return currentController;},loadState:function(state){var _super=this._super.bind(this);var action;var options={clear_breadcrumbs:true,pushState:false,};if(state.action){var currentController=this.getCurrentController();var currentAction=currentController&&this.actions[currentController.actionID];if(currentAction&&currentAction.id===state.action&&currentAction.type==='ir.actions.act_window'){this._closeDialog(true);var viewOptions={currentId:state.id};var viewType=state.view_type||currentController.viewType;return this._switchController(currentAction,viewType,viewOptions);}else if(!core.action_registry.contains(state.action)){var context={};if(state.active_id){context.active_id=state.active_id;}
if(state.active_ids){context.active_ids=state.active_ids.split(',').map(function(id){return parseInt(id,10)||id;});}else if(state.active_id){context.active_ids=[state.active_id];}
context.params=state;action=state.action;options=_.extend(options,{additional_context:context,resID:state.id||undefined,viewType:state.view_type,});}}else if(state.model&&state.id){action={res_model:state.model,res_id:state.id,type:'ir.actions.act_window',views:[[state.view_id||false,'form']],};}else if(state.model&&state.view_type){var storedAction=this.call('session_storage','getItem','current_action');var lastAction=JSON.parse(storedAction||'{}');if(lastAction.res_model===state.model){action=lastAction;options.viewType=state.view_type;}}
if(action){return this.doAction(action,options);}
return _super.apply(this,arguments);},_createViewController:function(action,viewType,viewOptions,options){var self=this;var viewDescr=_.findWhere(action.views,{type:viewType});if(!viewDescr){return Promise.reject();}
options=options||{};var index=options.index||0;var controllerID=options.controllerID||_.uniqueId('controller_');var controller={actionID:action.jsID,className:'o_act_window',index:index,jsID:controllerID,viewType:viewType,};Object.defineProperty(controller,'title',{get:function(){return controller.widget?controller.widget.getTitle():(action.display_name||action.name);},});this.controllers[controllerID]=controller;if(!options.lazy){var flags=action.flags||{};viewOptions=_.extend({},flags,flags[viewType],viewOptions,{action:action,breadcrumbs:this._getBreadcrumbs(this.controllerStack.slice(0,index)),controllerID:controllerID,});var rejection;var view=new viewDescr.Widget(viewDescr.fieldsView,viewOptions);var def=new Promise(function(resolve,reject){rejection=reject;view.getController(self).then(function(widget){if(def.rejected){widget.destroy();}else{controller.widget=widget;resolve(controller);}}).guardedCatch(reject);});def.reject=rejection;def.guardedCatch(function(){def.rejected=true;delete self.controllers[controllerID];});action.controllers[viewType]=def;}else{action.controllers[viewType]=Promise.resolve(controller);}
return action.controllers[viewType];},_destroyWindowAction:function(action){var self=this;for(var c in action.controllers){var controllerDef=action.controllers[c];controllerDef.then(function(controller){delete self.controllers[controller.jsID];if(controller.widget){controller.widget.destroy();}});if(controllerDef.reject){controllerDef.reject();}}},_executeWindowAction:function(action,options){var self=this;return this.dp.add(this._loadViews(action)).then(function(fieldsViews){var views=self._generateActionViews(action,fieldsViews);action._views=action.views;action.views=views;action.controlPanelFieldsView=fieldsViews.search;action.controllers={};var curView=options.viewType&&_.findWhere(views,{type:options.viewType});var lazyView;if(curView){if(!curView.multiRecord&&views[0].multiRecord){lazyView=views[0];}}else{curView=views[0];}
if(config.device.isMobile){if(!curView.isMobileFriendly){curView=self._findMobileView(views,curView.multiRecord)||curView;}
if(lazyView&&!lazyView.isMobileFriendly){lazyView=self._findMobileView(views,lazyView.multiRecord)||lazyView;}}
var lazyViewDef;var lazyControllerID;if(lazyView){options.clear_breadcrumbs=false;lazyViewDef=self._createViewController(action,lazyView.type,{},{lazy:true}).then(function(lazyLoadedController){lazyControllerID=lazyLoadedController.jsID;self.controllerStack.push(lazyLoadedController.jsID);});}
return self.dp.add(Promise.resolve(lazyViewDef)).then(function(){var viewOptions={controllerState:options.controllerState,currentId:options.resID,};var curViewDef=self._createViewController(action,curView.type,viewOptions,{index:self._getControllerStackIndex(options),});return self.dp.add(curViewDef);}).then(function(controller){action.controllerID=controller.jsID;return self._executeAction(action,options);}).guardedCatch(function(){if(lazyControllerID){var index=self.controllerStack.indexOf(lazyControllerID);self.controllerStack=self.controllerStack.slice(0,index);}
self._destroyWindowAction(action);});});},_findMobileView:function(views,multiRecord){return _.findWhere(views,{isMobileFriendly:true,multiRecord:multiRecord,});},_generateActionViews:function(action,fieldsViews){var views=[];_.each(action.views,function(view){var viewType=view[1];var fieldsView=fieldsViews[viewType];var parsedXML=new DOMParser().parseFromString(fieldsView.arch,"text/xml");var key=parsedXML.documentElement.getAttribute('js_class');var View=view_registry.get(key||viewType);if(View){views.push({accessKey:View.prototype.accessKey||View.prototype.accesskey,displayName:View.prototype.display_name,fieldsView:fieldsView,icon:View.prototype.icon,isMobileFriendly:View.prototype.mobile_friendly,multiRecord:View.prototype.multi_record,type:viewType,viewID:view[0],Widget:View,});}else if(config.isDebug('assets')){console.log("View type '"+viewType+"' is not present in the view registry.");}});return views;},_getControllerState:function(controllerID){var state=this._super.apply(this,arguments);var controller=this.controllers[controllerID];var action=this.actions[controller.actionID];if(action.type==='ir.actions.act_window'){state.model=action.res_model;state.view_type=controller.viewType;}
return state;},_handleAction:function(action,options){if(action.type==='ir.actions.act_window'){return this._executeWindowAction(action,options);}
return this._super.apply(this,arguments);},_loadViews:function(action){var inDialog=action.target==='new';var inline=action.target==='inline';var options={action_id:action.id,toolbar:!inDialog&&!inline,};var views=action.views.slice();if(!inline&&!(inDialog&&action.views[0][1]==='form')){options.load_filters=true;var searchviewID=action.search_view_id&&action.search_view_id[0];views.push([searchviewID||false,'search']);}
return this.loadViews(action.res_model,action.context,views,options);},_removeAction:function(actionID){var action=this.actions[actionID];if(action.type==='ir.actions.act_window'){delete this.actions[action.jsID];this._destroyWindowAction(action);}else{this._super.apply(this,arguments);}},_restoreController:function(controllerID){var self=this;var controller=this.controllers[controllerID];var action=this.actions[controller.actionID];if(action.type==='ir.actions.act_window'){return this.clearUncommittedChanges().then(function(){var def=Promise.resolve();if(action.on_reverse_breadcrumb){def=action.on_reverse_breadcrumb();}
return Promise.resolve(def).then(function(){return self._switchController(action,controller.viewType);});});}
return this._super.apply(this,arguments);},_switchController:function(action,viewType,viewOptions){var self=this;var view=_.findWhere(action.views,{type:viewType});if(!view){return Promise.reject();}
var currentController=this.getCurrentController();var index;if(currentController.actionID!==action.jsID){var controller=_.findWhere(this.controllers,{actionID:action.jsID,viewType:viewType,});index=_.indexOf(this.controllerStack,controller.jsID);}else{if(view.multiRecord){index=_.findIndex(this.controllerStack,function(controllerID){return self.controllers[controllerID].actionID===action.jsID;});}else if(!_.findWhere(action.views,{type:currentController.viewType}).multiRecord){index=this.controllerStack.length-1;}else{index=this.controllerStack.length;}}
var newController=function(controllerID){var options={controllerID:controllerID,index:index,};return self._createViewController(action,viewType,viewOptions,options).then(function(controller){return self._startController(controller);});};var controllerDef=action.controllers[viewType];if(controllerDef){controllerDef=controllerDef.then(function(controller){if(!controller.widget){return newController(controller.jsID);}else{return Promise.resolve(controller.widget.willRestore()).then(function(){viewOptions=_.extend({},viewOptions,{breadcrumbs:self._getBreadcrumbs(self.controllerStack.slice(0,index)),shouldUpdateSearchComponents:true,});return controller.widget.reload(viewOptions).then(function(){return controller;});});}},function(){return newController();});}else{controllerDef=newController();}
return this.dp.add(controllerDef).then(function(controller){return self._pushController(controller);});},_onExecuteAction:function(ev){ev.stopPropagation();var self=this;var actionData=ev.data.action_data;var env=ev.data.env;var context=new Context(env.context,actionData.context||{});var recordID=env.currentID||null;var def;if(actionData.special){def=Promise.resolve({type:'ir.actions.act_window_close',infos:{special:true},});}else if(actionData.type==='object'){var args=recordID?[[recordID]]:[env.resIDs];if(actionData.args){try{var additionalArgs=JSON.parse(actionData.args.replace(/'/g,'"'));args=args.concat(additionalArgs);}catch(e){console.error("Could not JSON.parse arguments",actionData.args);}}
def=this._rpc({route:'/web/dataset/call_button',params:{args:args,kwargs:{context:context.eval()},method:actionData.name,model:env.model,},});}else if(actionData.type==='action'){def=this._loadAction(actionData.name,_.extend(pyUtils.eval('context',context),{active_model:env.model,active_ids:env.resIDs,active_id:recordID,}));}else{def=Promise.reject();}
def.guardedCatch(ev.data.on_fail);this.dp.add(def).then(function(action){var effect=false;if(actionData.effect){effect=pyUtils.py_eval(actionData.effect);}
if(action&&action.constructor===Object){var ctx=new Context(_.object(_.reject(_.pairs(env.context),function(pair){return pair[0].match('^(?:(?:default_|search_default_|show_).+|'+'.+_view_ref|group_by|group_by_no_leaf|active_id|'+'active_ids|orderedBy)$')!==null;})));ctx.add(actionData.context||{});ctx.add({active_model:env.model});if(recordID){ctx.add({active_id:recordID,active_ids:[recordID],});}
ctx.add(action.context||{});action.context=ctx;action.effect=effect||action.effect;}else{action={effect:effect,type:'ir.actions.act_window_close',};}
var options={on_close:ev.data.on_closed};if(config.device.isMobile&&actionData.mobile){options=Object.assign({},options,actionData.mobile);}
return self.doAction(action,options).then(ev.data.on_success,ev.data.on_fail);});},_onSwitchView:function(ev){ev.stopPropagation();const viewType=ev.data.view_type;const currentController=this.getCurrentController();if(currentController.jsID===ev.data.controllerID){const action=this.actions[currentController.actionID];const currentControllerState=currentController.widget.exportState();action.controllerState=_.extend({},action.controllerState,currentControllerState);const options={controllerState:action.controllerState,currentId:ev.data.res_id,};if(ev.data.mode){options.mode=ev.data.mode;}
this._switchController(action,viewType,options);}},});});;

/* /web/static/src/js/chrome/action_manager_report.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.ReportActionManager',function(require){"use strict";var ActionManager=require('web.ActionManager');var core=require('web.core');var framework=require('web.framework');var session=require('web.session');var _t=core._t;var _lt=core._lt;var link='<br><br><a href="http://wkhtmltopdf.org/" target="_blank">wkhtmltopdf.org</a>';var WKHTMLTOPDF_MESSAGES={broken:_lt('Your installation of Wkhtmltopdf seems to be broken. The report will be shown '+'in html.')+link,install:_lt('Unable to find Wkhtmltopdf on this system. The report will be shown in '+'html.')+link,upgrade:_lt('You should upgrade your version of Wkhtmltopdf to at least 0.12.0 in order to '+'get a correct display of headers and footers as well as support for '+'table-breaking between pages.')+link,workers:_lt('You need to start Odoo with at least two workers to print a pdf version of '+'the reports.'),};ActionManager.include({_downloadReport:function(url){var self=this;framework.blockUI();return new Promise(function(resolve,reject){var type='qweb-'+url.split('/')[2];var blocked=!session.get_file({url:'/report/download',data:{data:JSON.stringify([url,type]),context:JSON.stringify(session.user_context),},success:resolve,error:(error)=>{self.call('crash_manager','rpc_error',error);reject();},complete:framework.unblockUI,});if(blocked){var message=_t('A popup window with your report was blocked. You '+'may need to change your browser settings to allow '+'popup windows for this page.');self.do_warn(_t('Warning'),message,true);}});},_triggerDownload:function(action,options,type){var self=this;var reportUrls=this._makeReportUrls(action);return this._downloadReport(reportUrls[type]).then(function(){if(action.close_on_report_download){var closeAction={type:'ir.actions.act_window_close'};return self.doAction(closeAction,_.pick(options,'on_close'));}else{return options.on_close();}});},_executeReportAction:function(action,options){var self=this;if(action.report_type==='qweb-html'){return this._executeReportClientAction(action,options);}else if(action.report_type==='qweb-pdf'){return this.call('report','checkWkhtmltopdf').then(function(state){if(state in WKHTMLTOPDF_MESSAGES){self.do_notify(_t('Report'),WKHTMLTOPDF_MESSAGES[state],true);}
if(state==='upgrade'||state==='ok'){return self._triggerDownload(action,options,'pdf');}else{return self._executeReportClientAction(action,options);}});}else if(action.report_type==='qweb-text'){return self._triggerDownload(action,options,'text');}else{console.error("The ActionManager can't handle reports of type "+
action.report_type,action);return Promise.reject();}},_executeReportClientAction:function(action,options){var urls=this._makeReportUrls(action);var clientActionOptions=_.extend({},options,{context:action.context,data:action.data,display_name:action.display_name,name:action.name,report_file:action.report_file,report_name:action.report_name,report_url:urls.html,});return this.doAction('report.client_action',clientActionOptions);},_handleAction:function(action,options){if(action.type==='ir.actions.report'){return this._executeReportAction(action,options);}
return this._super.apply(this,arguments);},_makeReportUrls:function(action){var reportUrls={html:'/report/html/'+action.report_name,pdf:'/report/pdf/'+action.report_name,text:'/report/text/'+action.report_name,};if(_.isUndefined(action.data)||_.isNull(action.data)||(_.isObject(action.data)&&_.isEmpty(action.data))){if(action.context.active_ids){var activeIDsPath='/'+action.context.active_ids.join(',');reportUrls=_.mapObject(reportUrls,function(value){return value+=activeIDsPath;});}
reportUrls.html+='?context='+encodeURIComponent(JSON.stringify(session.user_context));}else{var serializedOptionsPath='?options='+encodeURIComponent(JSON.stringify(action.data));serializedOptionsPath+='&context='+encodeURIComponent(JSON.stringify(action.context));reportUrls=_.mapObject(reportUrls,function(value){return value+=serializedOptionsPath;});}
return reportUrls;},});});;

/* /web/static/src/js/chrome/action_mixin.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.ActionMixin',function(require){"use strict";const core=require('web.core');const{WidgetAdapterMixin}=require('web.OwlCompatibility');const ActionMixin=Object.assign({},WidgetAdapterMixin,{template:'Action',contentTemplate:null,custom_events:{get_controller_query_params:'_onGetOwnedQueryParams',},_controlPanel:null,_title:'',renderElement:function(){this._super.apply(this,arguments);if(this.contentTemplate){const content=core.qweb.render(this.contentTemplate,{widget:this});this.$('.o_content').append(content);}},willRestore:function(){},canBeRemoved:function(){return Promise.resolve();},getOwnedQueryParams:function(){return{};},getState:function(){return{};},getTitle:function(){return this._title;},renderButtons:function($node){},updateButtons:function(){},updateControlPanel:async function(newProps={}){if(!this.withControlPanel&&!this.hasControlPanel){return;}
const props=Object.assign({},newProps);if('title'in props){this._setTitle(props.title);this.controlPanelProps.title=this.getTitle();delete props.title;}
if('cp_content'in props){this.controlPanelProps.cp_content=Object.assign({},this.controlPanelProps.cp_content,props.cp_content,);delete props.cp_content;}
Object.assign(this.controlPanelProps,props);return this._controlPanelWrapper.update(this.controlPanelProps);},_setTitle:function(title){this._title=title;},_onGetOwnedQueryParams:function(callback){const state=this.getOwnedQueryParams();callback(state||{});},});return ActionMixin;});;

/* /web/static/src/js/chrome/abstract_web_client.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.AbstractWebClient',function(require){"use strict";var ActionManager=require('web.ActionManager');var concurrency=require('web.concurrency');var core=require('web.core');var config=require('web.config');var WarningDialog=require('web.CrashManager').WarningDialog;var data_manager=require('web.data_manager');var dom=require('web.dom');var KeyboardNavigationMixin=require('web.KeyboardNavigationMixin');var Loading=require('web.Loading');var RainbowMan=require('web.RainbowMan');var session=require('web.session');var utils=require('web.utils');var Widget=require('web.Widget');const env=require('web.env');var _t=core._t;var AbstractWebClient=Widget.extend(KeyboardNavigationMixin,{dependencies:['notification'],events:_.extend({},KeyboardNavigationMixin.events),custom_events:{call_service:'_onCallService',clear_uncommitted_changes:function(e){this.clear_uncommitted_changes().then(e.data.callback);},toggle_fullscreen:function(event){this.toggle_fullscreen(event.data.fullscreen);},current_action_updated:function(ev){this.current_action_updated(ev.data.action,ev.data.controller);},warning:'_onDisplayWarning',load_action:'_onLoadAction',load_views:function(event){var params={model:event.data.modelName,context:event.data.context,views_descr:event.data.views,};return data_manager.load_views(params,event.data.options||{}).then(event.data.on_success);},load_filters:function(event){return data_manager.load_filters(event.data).then(event.data.on_success);},create_filter:'_onCreateFilter',delete_filter:'_onDeleteFilter',push_state:'_onPushState',show_effect:'_onShowEffect',get_session:function(event){if(event.data.callback){event.data.callback(session);}},do_action:function(event){const actionProm=this.do_action(event.data.action,event.data.options||{});this.menu_dp.add(actionProm).then(function(result){if(event.data.on_success){event.data.on_success(result);}}).guardedCatch(function(result){if(event.data.on_fail){event.data.on_fail(result);}});},getScrollPosition:'_onGetScrollPosition',scrollTo:'_onScrollTo',set_title_part:'_onSetTitlePart',webclient_started:'_onWebClientStarted',},init:function(parent){odoo.isReady=false;this.client_options={};this._super(parent);KeyboardNavigationMixin.init.call(this);this.origin=undefined;this._current_state=null;this.menu_dp=new concurrency.DropPrevious();this.action_mutex=new concurrency.Mutex();this.set('title_part',{"zopenerp":"Odoo"});this.env=env;this.env.bus.on('set_title_part',this,this._onSetTitlePart);},start:function(){KeyboardNavigationMixin.start.call(this);var self=this;this.$el.toggleClass('o_touch_device',config.device.touch);this.on("change:title_part",this,this._title_changed);this._title_changed();var state=$.bbq.getState();var current_company_id=session.user_companies.current_company[0]
if(!state.cids){state.cids=utils.get_cookie('cids')!==null?utils.get_cookie('cids'):String(current_company_id);}
const cids=Array.isArray(state.cids)?state.cids[0]:state.cids;let stateCompanyIDS=cids.split(',').map(cid=>parseInt(cid,10));var userCompanyIDS=_.map(session.user_companies.allowed_companies,function(company){return company[0]});if(!_.isEmpty(_.difference(stateCompanyIDS,userCompanyIDS))){state.cids=String(current_company_id);stateCompanyIDS=[current_company_id]}
session.user_context.allowed_company_ids=stateCompanyIDS;$.bbq.pushState(state);$("link[type='image/x-icon']").attr('href','/web/image/res.company/'+String(stateCompanyIDS[0])+'/favicon/')
return session.is_bound.then(function(){self.$el.toggleClass('o_rtl',_t.database.parameters.direction==="rtl");self.bind_events();return Promise.all([self.set_action_manager(),self.set_loading()]);}).then(function(){if(session.session_is_valid()){return self.show_application();}else{return Promise.resolve();}});},destroy:function(){KeyboardNavigationMixin.destroy.call(this);return this._super(...arguments);},bind_events:function(){var self=this;$('.oe_systray').show();this.$el.on('mouseenter','.oe_systray > div:not([data-toggle=tooltip])',function(){$(this).attr('data-toggle','tooltip').tooltip().trigger('mouseenter');});this.$el.on('click','.oe_dropdown_toggle',function(ev){ev.preventDefault();var $toggle=$(this);var doc_width=$(document).width();var $menu=$toggle.siblings('.oe_dropdown_menu');$menu=$menu.length>=1?$menu:$toggle.find('.oe_dropdown_menu');var state=$menu.is('.oe_opened');setTimeout(function(){$toggle.add($menu).toggleClass('oe_opened',!state);if(!state){var offset=$menu.offset();var menu_width=$menu.width();var x=doc_width-offset.left-menu_width-2;if(x<0){$menu.offset({left:offset.left+x}).width(menu_width);}}},0);});core.bus.on('click',this,function(ev){$('.tooltip').remove();if(!$(ev.target).is('input[type=file]')){$(this.el.getElementsByClassName('oe_dropdown_menu oe_opened')).removeClass('oe_opened');$(this.el.getElementsByClassName('oe_dropdown_toggle oe_opened')).removeClass('oe_opened');}});core.bus.on('connection_lost',this,this._onConnectionLost);core.bus.on('connection_restored',this,this._onConnectionRestored);},set_action_manager:function(){var self=this;this.action_manager=new ActionManager(this,session.user_context);this.env.bus.on('do-action',this,payload=>{this.do_action(payload.action,payload.options||{}).then(payload.on_success||(()=>{})).guardedCatch(payload.on_fail||(()=>{}));});var fragment=document.createDocumentFragment();return this.action_manager.appendTo(fragment).then(function(){dom.append(self.$el,fragment,{in_DOM:true,callbacks:[{widget:self.action_manager}],});});},set_loading:function(){this.loading=new Loading(this);return this.loading.appendTo(this.$el);},show_application:function(){},clear_uncommitted_changes:function(){return this.action_manager.clearUncommittedChanges();},destroy_content:function(){_.each(_.clone(this.getChildren()),function(el){el.destroy();});this.$el.children().remove();},set_title:function(title){this.set_title_part("action",title);},set_title_part:function(part,title){var tmp=_.clone(this.get("title_part"));tmp[part]=title;this.set("title_part",tmp);},_title_changed:function(){var parts=_.sortBy(_.keys(this.get("title_part")),function(x){return x;});var tmp="";_.each(parts,function(part){var str=this.get("title_part")[part];if(str){tmp=tmp?tmp+" - "+str:str;}},this);document.title=tmp;},do_action:function(){return this.action_manager.doAction.apply(this.action_manager,arguments);},do_reload:function(){var self=this;return session.session_reload().then(function(){session.load_modules(true).then(self.menu.proxy('do_reload'));});},do_push_state:function(state){if(!state.menu_id&&this.menu){state.menu_id=this.menu.getCurrentPrimaryMenu();}
if('title'in state){this.set_title(state.title);delete state.title;}
var url='#'+$.param(state);this._current_state=$.deparam($.param(state),false);$.bbq.pushState(url);this.trigger('state_pushed',state);},current_action_updated:function(action,controller){},toggle_fullscreen:function(fullscreen){this.$el.toggleClass('o_fullscreen',fullscreen);},getScrollPosition:function(){var scrollingEl=this.action_manager.el.getElementsByClassName('o_content')[0];return{left:scrollingEl?scrollingEl.scrollLeft:0,top:scrollingEl?scrollingEl.scrollTop:0,};},_onCallService:function(ev){const payload=ev.data;let args=payload.args||[];if(payload.service==='ajax'&&payload.method==='rpc'){args=args.concat(ev.target);}
const service=this.env.services[payload.service];const result=service[payload.method].apply(service,args);payload.callback(result);},_onConnectionLost:function(){this.connectionNotificationID=this.displayNotification({message:_t('Connection lost. Trying to reconnect...'),sticky:true});},_onConnectionRestored:function(){if(this.connectionNotificationID){this.call('notification','close',this.connectionNotificationID);this.displayNotification({type:'info',message:_t('Connection restored. You are back online.'),sticky:false});this.connectionNotificationID=false;}},_onCreateFilter:function(e){data_manager.create_filter(e.data.filter).then(e.data.on_success);},_onDeleteFilter:function(e){data_manager.delete_filter(e.data.filterId).then(e.data.on_success);},_onDisplayWarning:function(e){var data=e.data;if(data.type==='dialog'){new WarningDialog(this,{title:data.title,},data).open();}else{data.type='warning';this.call('notification','notify',data);}},_onGetScrollPosition:function(ev){ev.data.callback(this.getScrollPosition());},_onLoadAction:function(event){data_manager.load_action(event.data.actionID,event.data.context).then(event.data.on_success);},_onPushState:function(e){this.do_push_state(_.extend(e.data.state,{'cids':$.bbq.getState().cids}));},_onScrollTo:function(ev){var scrollingEl=this.action_manager.el.getElementsByClassName('o_content')[0];if(!scrollingEl){return;}
var offset={top:ev.data.top,left:ev.data.left||0};if(!offset.top){offset=dom.getPosition(document.querySelector(ev.data.selector));offset.top-=dom.getPosition(scrollingEl).top;}
scrollingEl.scrollTop=offset.top;scrollingEl.scrollLeft=offset.left;},_onSetTitlePart:function(payload){var part=payload.part;var title=payload.title;this.set_title_part(part,title);},_onShowEffect:function(e){var data=e.data||{};var type=data.type||'rainbow_man';if(type==='rainbow_man'){if(session.show_effect){new RainbowMan(data).appendTo(this.$el);}else{this.call('notification','notify',{title:"",message:data.message,sticky:false});}}else{throw new Error('Unknown effect type: '+type);}},_onWebClientStarted:function(){if(!this.isStarted){this.action_manager.$el.on('scroll',core.bus.trigger.bind(core.bus,'scroll'));odoo.isReady=true;core.bus.trigger('web_client_ready');if(session.uid===1){this.$el.addClass('o_is_superuser');}
this.isStarted=true;}}});return AbstractWebClient;});;

/* /web_enterprise/static/src/js/web_client.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.WebClient',function(require){"use strict";const AbstractWebClient=require('web.AbstractWebClient');const config=require('web.config');const core=require('web.core');const data_manager=require('web.data_manager');const dom=require('web.dom');const session=require('web.session');const HomeMenuWrapper=require('web_enterprise.HomeMenuWrapper');const Menu=require('web_enterprise.Menu');return AbstractWebClient.extend({events:_.extend({},AbstractWebClient.prototype.events,{'app-clicked':'on_app_clicked','hide-home-menu':'_onHideHomeMenu','menu-clicked':'on_menu_clicked',}),custom_events:_.extend({},AbstractWebClient.prototype.custom_events,{hide_home_menu:'_onHideHomeMenu',menu_clicked:'on_menu_clicked',show_home_menu:'_onShowHomeMenu',}),init:function(){this._super(...arguments);this.homeMenuManagerDisplayed=false;},start:function(){core.bus.on('change_menu_section',this,function(menu_id){this.do_push_state(Object.assign($.bbq.getState(),{menu_id}));});return this._super.apply(this,arguments);},bind_events:function(){var self=this;this._super.apply(this,arguments);this.$el.on('click','a',function(ev){var disable_anchor=ev.target.attributes.disable_anchor;if(disable_anchor&&disable_anchor.value==="true"){return;}
var href=ev.target.attributes.href;if(href){if(href.value[0]==='#'&&href.value.length>1){if(self.$("[id='"+href.value.substr(1)+"']").length){ev.preventDefault();self.trigger_up('scrollTo',{'selector':href.value});}}}});},load_menus:async function(){const menuData=await(odoo.loadMenusPromise||odoo.reloadMenus());for(let i=0;i<menuData.children.length;i++){let child=menuData.children[i];if(child.action===false){while(child.children&&child.children.length){child=child.children[0];if(child.action){menuData.children[i].action=child.action;break;}}}}
odoo.loadMenusPromise=null;return menuData;},show_application:function(){this.set_title();return this.menu_dp.add(this.instanciate_menu_widgets()).then(async()=>{$(window).bind('hashchange',this.on_hashchange);const state=$.bbq.getState(true);if(Object.keys(state).length===1&&Object.keys(state)[0]==="cids"){const result=await this.menu_dp.add(this._rpc({model:'res.users',method:'read',args:[session.uid,["action_id"]],}));const data=result[0];if(data.action_id){await this.do_action(data.action_id[0]);this.menu.change_menu_section(this.menu.action_id_to_primary_menu_id(data.action_id[0]));return this.toggleHomeMenu(false);}else{return this.toggleHomeMenu(true);}}else{return this.on_hashchange();}});},instanciate_menu_widgets:async function(){const menuData=await this.load_menus();this.homeMenuManager=this._instanciateHomeMenuWrapper(menuData);this.menu=await this._instanciateMenu(menuData);},on_hashchange:async function(ev){if(this._ignore_hashchange){this._ignore_hashchange=false;return Promise.resolve();}
try{await this.clear_uncommitted_changes();}catch(err){if(ev){this._ignore_hashchange=true;window.location=ev.originalEvent.oldURL;return;}}
const stringstate=$.bbq.getState(false);if(!_.isEqual(this._current_state,stringstate)){const state=$.bbq.getState(true);if(state.action||(state.model&&(state.view_type||state.id))){let menuDpRejected=false;const loadStateProm=this.action_manager.loadState(state,!!this._current_state).guardedCatch(()=>{if(!menuDpRejected){this.toggleHomeMenu(true);}});return this.menu_dp.add(loadStateProm).then(()=>{if(state.menu_id){if(state.menu_id!==this.menu.current_primary_menu){core.bus.trigger('change_menu_section',state.menu_id);}}else{const action=this.action_manager.getCurrentAction();if(action){const menu_id=this.menu.action_id_to_primary_menu_id(action.id);core.bus.trigger('change_menu_section',menu_id);}}
return this.toggleHomeMenu(false);}).guardedCatch(()=>{menuDpRejected=true;});}else if(state.menu_id){const action_id=this.menu.menu_id_to_action_id(state.menu_id);await this.menu_dp.add(this.do_action(action_id,{clear_breadcrumbs:true}));core.bus.trigger('change_menu_section',state.menu_id);return this.toggleHomeMenu(false);}else{return this.toggleHomeMenu(true);}}
this._current_state=stringstate;},on_app_clicked:async function(ev){const result=await this.menu_dp.add(data_manager.load_action(ev.detail.action_id));return this.action_mutex.exec(()=>new Promise((resolve,reject)=>{const options=Object.assign({},ev.detail.options,{clear_breadcrumbs:true,action_menu_id:ev.detail.menu_id,});Promise.resolve(this._openMenu(result,options)).then(()=>{this._on_app_clicked_done(ev).then(resolve).guardedCatch(reject);}).guardedCatch(async()=>{await this.toggleHomeMenu(true);resolve();});}));},_on_app_clicked_done:function(ev){core.bus.trigger('change_menu_section',ev.detail.menu_id);this.toggleHomeMenu(false);return Promise.resolve();},on_menu_clicked:async function(ev){const action_id=(ev.detail&&ev.detail.action_id)||ev.data.action_id;const result=await this.menu_dp.add(data_manager.load_action(action_id));const options=Object.assign({},ev.data&&ev.data.options,{clear_breadcrumbs:true});await this.action_mutex.exec(()=>this._openMenu(result,options));this.el.classList.remove('o_mobile_menu_opened');},_openMenu:function(action,options){return this.do_action(action,options);},toggleHomeMenu:async function(display){if(display===this.homeMenuManagerDisplayed){return;}
if(display){await this.clear_uncommitted_changes();core.bus.trigger('will_show_home_menu');this.homeMenuManagerDisplayed=true;this.scrollPosition=this.getScrollPosition();const $to_detach=this.$el.contents().not(this.menu.$el).not('.o_loading').not('.o_in_home_menu').not('.o_notification_manager');this.web_client_content=document.createDocumentFragment();dom.detach([{widget:this.action_manager}],{$to_detach:$to_detach}).appendTo(this.web_client_content);this.url=$.bbq.getState();if(location.hash){this._ignore_hashchange=true;$.bbq.pushState('#home',2);}
$.bbq.pushState({cids:this.url.cids},0);await this.homeMenuManager.mount(this.el);this.trigger_up('webclient_started');core.bus.trigger('show_home_menu');}else{this.homeMenuManagerDisplayed=false;this.homeMenuManager.unmount();core.bus.trigger('will_hide_home_menu');dom.append(this.$el,[this.web_client_content],{in_DOM:true,callbacks:[{widget:this.action_manager}],});delete this.web_client_content;this.trigger_up('scrollTo',this.scrollPosition);core.bus.trigger('hide_home_menu');}
this.menu.toggle_mode(display,this.action_manager.getCurrentAction()!==null);this.el.classList.toggle("o_home_menu_background",display);},current_action_updated:function(){this._super.apply(this,arguments);if(this.homeMenuManagerDisplayed){this.toggleHomeMenu(false);}},_onShowHomeMenu:function(){this.toggleHomeMenu(true);},_onHideHomeMenu:function(){if(this.menu.backbutton_displayed){$.bbq.pushState(this.url,2);this.toggleHomeMenu(false);}},getScrollPosition:function(){if(config.device.isMobile){return{left:$(window).scrollLeft(),top:$(window).scrollTop(),};}
return this._super.apply(this,arguments);},_instanciateMenu:async function(menuData){const menu=new Menu(this,menuData);await menu.appendTo(document.createDocumentFragment());menu.toggle_mode(this.homeMenuManagerDisplayed,false);dom.prepend(this.$el,menu.$el,{callbacks:[{widget:menu}],in_DOM:true,});return menu;},_instanciateHomeMenuWrapper:function(menuData){return new HomeMenuWrapper(null,{menuData});},_onScrollTo:function(ev){if(config.device.isMobile){var offset={top:ev.data.top,left:ev.data.left||0};if(!offset.top){offset=dom.getPosition(document.querySelector(ev.data.selector));}
$(window).scrollTop(offset.top);$(window).scrollLeft(offset.left);}
this._super.apply(this,arguments);},});});;

/* /web/static/src/js/chrome/root_widget.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('root.widget',function(require){"use strict";var webClient=require('web.web_client');return webClient;});;

/* /web/static/src/js/_deprecated/data.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.data',function(require){"use strict";var Class=require('web.Class');var Context=require('web.Context');var concurrency=require('web.concurrency');var mixins=require('web.mixins');var session=require('web.session');var translation=require('web.translation');var pyUtils=require('web.py_utils');var _t=translation._t;function serialize_sort(criterion){return _.map(criterion,function(criteria){if(criteria[0]==='-'){return criteria.slice(1)+' DESC';}
return criteria+' ASC';}).join(', ');}
function deserialize_sort(criterion){return _.map(criterion,function(criteria){var split=_.without(criteria.split(' '),'');return(split[1]&&split[1].toLowerCase()==='desc'?'-':'')+split[0];});}
var Query=Class.extend({init:function(model,fields){this._model=model;this._fields=fields;this._filter=[];this._context={};this._lazy=true;this._limit=false;this._offset=0;this._order_by=[];},clone:function(to_set){to_set=to_set||{};var q=new Query(this._model,this._fields);q._context=this._context;q._filter=this._filter;q._lazy=this._lazy;q._limit=this._limit;q._offset=this._offset;q._order_by=this._order_by;for(var key in to_set){if(!to_set.hasOwnProperty(key)){continue;}
switch(key){case'filter':q._filter=(q._filter||[]).concat(to_set.filter||[]);break;case'context':q._context=new Context(q._context,to_set.context);break;case'lazy':case'limit':case'offset':case'order_by':q['_'+key]=to_set[key];}}
return q;},_execute:function(options){var self=this;options=options||{};return session.rpc('/web/dataset/search_read',{model:this._model.name,fields:this._fields||false,domain:pyUtils.eval('domains',[this._model.domain(this._filter)]),context:pyUtils.eval('contexts',[this._model.context(this._context)]),offset:this._offset,limit:this._limit,sort:serialize_sort(this._order_by)},options).then(function(results){self._count=results.length;return results.records;},null);},first:function(options){var self=this;return this.clone({limit:1})._execute(options).then(function(records){delete self._count;if(records.length){return records[0];}
return null;});},all:function(options){return this._execute(options);},count:function(){if(this._count!==undefined){return Promise.resolve(this._count);}
return this._model.call('search_count',[this._filter],{context:this._model.context(this._context)});},group_by:function(grouping){var ctx=pyUtils.eval('context',this._model.context(this._context));if(_.isUndefined(grouping)){grouping=[];}
if(!(grouping instanceof Array)){grouping=_.toArray(arguments);}
if(_.isEmpty(grouping)&&!ctx.group_by_no_leaf){return null;}
var raw_fields=_.map(grouping.concat(this._fields||[]),function(field){return field.split(':')[0];});var self=this;return this._model.call('read_group',{groupby:grouping,fields:_.uniq(raw_fields),domain:this._model.domain(this._filter),context:ctx,offset:this._offset,lazy:this._lazy,limit:this._limit,orderby:serialize_sort(this._order_by)||false}).then(function(results){return _(results).map(function(result){result.__context=result.__context||{};result.__context.group_by=result.__context.group_by||[];_.defaults(result.__context,ctx);var grouping_fields=self._lazy?[grouping[0]]:grouping;return new QueryGroup(self._model.name,grouping_fields,result);});});},context:function(context){if(!context){return this;}
return this.clone({context:context});},filter:function(domain){if(!domain){return this;}
return this.clone({filter:domain});},lazy:function(lazy){return this.clone({lazy:lazy});},limit:function(limit){return this.clone({limit:limit});},offset:function(offset){return this.clone({offset:offset});},order_by:function(fields){if(fields===undefined){return this;}
if(!(fields instanceof Array)){fields=_.toArray(arguments);}
if(_.isEmpty(fields)){return this;}
return this.clone({order_by:fields});}});var QueryGroup=Class.extend({init:function(model,grouping_fields,read_group_group){var fixed_group=_.extend({__context:{group_by:[]},__domain:[]},read_group_group);var count_key=(grouping_fields[0]&&grouping_fields[0].split(':')[0])+'_count';var aggregates={};for(var key in fixed_group){if(fixed_group.hasOwnProperty(key)){if(!(key.indexOf('__')===0||_.contains(grouping_fields,key)||(key===count_key))){aggregates[key]=fixed_group[key]||0;}}}
this.model=new Model(model,fixed_group.__context,fixed_group.__domain);var group_size=fixed_group[count_key]||fixed_group.__count||0;var leaf_group=fixed_group.__context.group_by.length===0;var value=(grouping_fields.length===1)?fixed_group[grouping_fields[0]]:_.map(grouping_fields,function(field){return fixed_group[field];});var grouped_on=(grouping_fields.length===1)?grouping_fields[0]:grouping_fields;this.attributes={folded:!!(fixed_group.__fold),grouped_on:grouped_on,length:group_size,value:value,has_children:!(leaf_group&&fixed_group.__context.group_by_no_leaf),aggregates:aggregates};},get:function(key){return this.attributes[key];},subgroups:function(){return this.model.query().group_by(this.model.context().group_by);},query:function(){return this.model.query.apply(this.model,arguments);}});var DataSet=Class.extend(mixins.PropertiesMixin,{init:function(parent,model,context){mixins.PropertiesMixin.init.call(this);this.setParent(parent);this.model=model;this.context=context||{};this.index=null;this._sort=[];this._model=new Model(model,context);this.orderer=new concurrency.DropMisordered();},previous:function(){this.index-=1;if(!this.ids.length){this.index=null;}else if(this.index<0){this.index=this.ids.length-1;}
return this;},next:function(){this.index+=1;if(!this.ids.length){this.index=null;}else if(this.index>=this.ids.length){this.index=0;}
return this;},select_id:function(id){var idx=this.get_id_index(id);if(idx===null){return false;}else{this.index=idx;return true;}},get_id_index:function(id){for(var i=0,ii=this.ids.length;i<ii;i++){if(id==this.ids[i]){return i;}}
return null;},read_ids:function(ids,fields,options){if(_.isEmpty(ids)){return Promise.resolve([]);}
options=options||{};var method='read';var ids_arg=ids;var context=this.get_context(options.context);if(options.check_access_rule===true){method='search_read';ids_arg=[['id','in',ids]];context=new Context(context,{active_test:false});}
return this._model.call(method,[ids_arg,fields||false],{context:context}).then(function(records){if(records.length<=1){return records;}
var indexes={};for(var i=0;i<ids.length;i++){indexes[ids[i]]=i;}
records.sort(function(a,b){return indexes[a.id]-indexes[b.id];});return records;});},read_slice:function(fields,options){var self=this;options=options||{};var query=this._model.query(fields).limit(options.limit||false).offset(options.offset||0).all();var prom=this.orderer.add(query);prom.then(function(records){self.ids=_(records).pluck('id');});return prom;},read_index:function(fields,options){options=options||{};return this.read_ids([this.ids[this.index]],fields,options).then(function(records){if(_.isEmpty(records)){return Promise.reject();}
return records[0];});},default_get:function(fields,options){options=options||{};return this._model.call('default_get',[fields],{context:this.get_context(options.context)});},create:function(data,options){var self=this;var prom=this._model.call('create',[data],{context:this.get_context()});prom.then(function(){self.trigger('dataset_changed',data,options);});return prom;},write:function(id,data,options){options=options||{};var self=this;var prom=this._model.call('write',[[id],data],{context:this.get_context(options.context)});prom.then(function(){self.trigger('dataset_changed',id,data,options);});return prom;},unlink:function(ids){var self=this;var prom=this._model.call('unlink',[ids],{context:this.get_context()});prom.then(function(){self.trigger('dataset_changed',ids);});return prom;},call:function(method,args){return this._model.call(method,args);},call_button:function(method,args){return this._model.call_button(method,args);},name_get:function(ids){return this._model.call('name_get',[ids],{context:this.get_context()});},name_search:function(name,domain,operator,limit){return this._model.call('name_search',{name:name||'',args:domain||false,operator:operator||'ilike',context:this._model.context(),limit:limit||0});},name_create:function(name,context){return this._model.call('name_create',[name],{context:this.get_context(context)});},get_context:function(request_context){return this._model.context(request_context);},sort:function(field,force_reverse){if(!field){return serialize_sort(this._sort);}
var reverse=force_reverse||(this._sort[0]===field);this._sort.splice.apply(this._sort,[0,this._sort.length].concat(_.without(this._sort,field,'-'+field)));this._sort.unshift((reverse?'-':'')+field);return undefined;},set_sort:function(fields_list){this._sort=deserialize_sort(fields_list);},size:function(){return this.ids.length;},alter_ids:function(n_ids){this.ids=n_ids;},remove_ids:function(ids){this.alter_ids(_(this.ids).difference(ids));},add_ids:function(ids,at){var args=[at,0].concat(_.difference(ids,this.ids));this.ids.splice.apply(this.ids,args);},resequence:function(ids,options){options=options||{};return session.rpc('/web/dataset/resequence',{model:this.model,ids:ids,context:pyUtils.eval('context',this.get_context(options.context)),}).then(function(results){return results;});},});var DataSetStatic=DataSet.extend({init:function(parent,model,context,ids){this._super(parent,model,context);this.ids=ids||[];},read_slice:function(fields,options){options=options||{};fields=fields||{};var offset=options.offset||0,limit=options.limit||false;var end_pos=limit&&limit!==-1?offset+limit:this.ids.length;return this.read_ids(this.ids.slice(offset,end_pos),fields,options);},set_ids:function(ids){this.ids=ids;if(ids.length===0){this.index=null;}else if(this.index>=ids.length-1){this.index=ids.length-1;}},unlink:function(ids){this.set_ids(_.without.apply(null,[this.ids].concat(ids)));this.trigger('unlink',ids);return Promise.resolve({result:true});},});var DataSetSearch=DataSet.extend({init:function(parent,model,context,domain){this._super(parent,model,context);this.domain=domain||[];this._length=null;this.ids=[];this._model=new Model(model,context,domain);},read_slice:function(fields,options){options=options||{};var self=this;var q=this._model.query(fields||false).filter(options.domain).context(options.context).offset(options.offset||0).limit(options.limit||false);q=q.order_by.apply(q,this._sort);var prom=this.orderer.add(q.all());prom.then(function(records){q.count().then(function(count){self._length=count;});self.ids=_(records).pluck('id');});return prom;},get_domain:function(other_domain){return this._model.domain(other_domain);},alter_ids:function(ids){this._super(ids);if(this.index!==null&&this.index>=this.ids.length){this.index=this.ids.length>0?this.ids.length-1:0;}},remove_ids:function(ids){var before=this.ids.length;this._super(ids);if(this._length){this._length-=(before-this.ids.length);}},add_ids:function(ids,at){var before=this.ids.length;this._super(ids,at);if(this._length){this._length+=(this.ids.length-before);}},unlink:function(ids,callback,error_callback){var self=this;var prom=this._super(ids);prom.then(function(){self.remove_ids(ids);self.trigger("dataset_changed",ids,callback,error_callback);});return prom;},size:function(){if(this._length!==null){return this._length;}
return this._super();}});var data={Query:Query,DataSet:DataSet,DataSetStatic:DataSetStatic,DataSetSearch:DataSetSearch,noDisplayContent:"<em class=\"text-warning\">"+_t("Unnamed")+"</em>",};var Model=Class.extend({init:function(name,context,domain){this.name=name;this._context=context||{};this._domain=domain||[];},get_func:function(method_name){var self=this;return function(){return self.call(method_name,_.toArray(arguments));};},query:function(fields){return new data.Query(this,fields);},domain:function(domain){if(!domain){return this._domain;}
return this._domain.concat(domain);},context:function(context){return new Context(session.user_context,this._context,context||{});},call:function(method,args,kwargs,options){args=args||[];kwargs=kwargs||{};if(!_.isArray(args)){kwargs=args;args=[];}
pyUtils.ensure_evaluated(args,kwargs);var call_kw='/web/dataset/call_kw/'+this.name+'/'+method;return session.rpc(call_kw,{model:this.name,method:method,args:args,kwargs:kwargs},options);},call_button:function(method,args){pyUtils.ensure_evaluated(args,{});var context=(args||[]).length>0?args.pop():{};return session.rpc('/web/dataset/call_button',{model:this.name,method:method,args:args||[],kwargs:{context:context},});},});return data;});;

/* /web/static/src/js/core/context.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.Context',function(require){"use strict";var Class=require('web.Class');var pyUtils=require('web.py_utils');var Context=Class.extend({init:function(){this.__ref="compound_context";this.__contexts=[];this.__eval_context=null;var self=this;_.each(arguments,function(x){self.add(x);});},add:function(context){this.__contexts.push(context);return this;},eval:function(){return pyUtils.eval('context',this);},set_eval_context:function(evalContext){for(var key in evalContext){if(evalContext[key]instanceof moment){evalContext[key]=evalContext[key].toJSON();}}
this.__eval_context=evalContext;return this;},});return Context;});;

/* /web/static/src/js/core/data_comparison_utils.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.dataComparisonUtils',function(require){"use strict";var fieldUtils=require('web.field_utils');var Class=require('web.Class');var DateClasses=Class.extend({init:function(dateSets){this.dateSets=dateSets;this.referenceIndex=null;for(var i=0;i<dateSets.length;i++){var dateSet=dateSets[i];if(dateSet.length&&this.referenceIndex===null){this.referenceIndex=i;}}},dateClass:function(datesetIndex,date){return this.dateSets[datesetIndex].indexOf(date);},dateClassMembers:function(dateClass){return _.uniq(_.compact(this.dateSets.map(function(dateSet){return dateSet[dateClass];})));},representative:function(dateClass,index){index=index===undefined?this.referenceIndex:index;return this.dateSets[index][dateClass];},});function computeVariation(value,comparisonValue){if(isNaN(value)||isNaN(comparisonValue)){return NaN;}
if(comparisonValue===0){if(value===0){return 0;}else if(value>0){return 1;}else{return-1;}}
return(value-comparisonValue)/Math.abs(comparisonValue);}
function renderVariation(variation,field,options){var className='o_variation';var value;if(!isNaN(variation)){if(variation>0){className+=' o_positive';}else if(variation<0){className+=' o_negative';}else{className+=' o_null';}
value=fieldUtils.format.percentage(variation,field,options);}else{value='-';}
return $('<div>',{class:className,html:value});}
function renderComparison($node,value,comparisonValue,variation,formatter,field,options){var $variation=renderVariation(variation,field,options);$node.append($variation);if(!isNaN(variation)){$node.append($('<div>',{class:'o_comparison'}).html(formatter(value,field,options)+' <span>vs</span> '+formatter(comparisonValue,field,options)));}}
return{computeVariation:computeVariation,DateClasses:DateClasses,renderComparison:renderComparison,renderVariation:renderVariation,};});;

/* /web/static/src/js/core/math_utils.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.mathUtils',function(){"use strict";function _cartesian(){var args=Array.prototype.slice.call(arguments);if(args.length===0){return[undefined];}
var firstArray=args[0].map(function(elem){return[elem];});if(args.length===1){return firstArray;}
var productOfOtherArrays=_cartesian.apply(null,args.slice(1));var result=firstArray.reduce(function(acc,elem){return acc.concat(productOfOtherArrays.map(function(tuple){return elem.concat(tuple);}));},[]);return result;}
function cartesian(){var args=Array.prototype.slice.call(arguments);if(args.length===0){return[undefined];}else if(args.length===1){return args[0];}else{return _cartesian.apply(null,args);}}
function sections(array){var sections=[];for(var i=0;i<array.length+1;i++){sections.push(array.slice(0,i));}
return sections;}
return{cartesian:cartesian,sections:sections,};});;

/* /web/static/src/js/core/misc.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.framework',function(require){"use strict";var core=require('web.core');var ajax=require('web.ajax');var Widget=require('web.Widget');var disableCrashManager=require('web.CrashManager').disable;const{sprintf}=require('web.utils')
var _t=core._t;var messages_by_seconds=function(){return[[0,_t("Loading...")],[20,_t("Still loading...")],[60,_t("Still loading...<br />Please be patient.")],[120,_t("Don't leave yet,<br />it's still loading...")],[300,_t("You may not believe it,<br />but the application is actually loading...")],[420,_t("Take a minute to get a coffee,<br />because it's loading...")],[3600,_t("Maybe you should consider reloading the application by pressing F5...")]];};var Throbber=Widget.extend({template:"Throbber",start:function(){this.start_time=new Date().getTime();this.act_message();},act_message:function(){var self=this;setTimeout(function(){if(self.isDestroyed())
return;var seconds=(new Date().getTime()-self.start_time)/1000;var mes;_.each(messages_by_seconds(),function(el){if(seconds>=el[0])
mes=el[1];});self.$(".oe_throbber_message").html(mes);self.act_message();},1000);},});if($.blockUI){$.blockUI.defaults.baseZ=1100;$.blockUI.defaults.message='<div class="openerp oe_blockui_spin_container" style="background-color: transparent;">';$.blockUI.defaults.css.border='0';$.blockUI.defaults.css["background-color"]='';}
function blockAccessKeys(){var elementWithAccessKey=[];elementWithAccessKey=document.querySelectorAll('[accesskey]');_.each(elementWithAccessKey,function(elem){elem.setAttribute("data-accesskey",elem.getAttribute('accesskey'));elem.removeAttribute('accesskey');});}
function unblockAccessKeys(){var elementWithDataAccessKey=[];elementWithDataAccessKey=document.querySelectorAll('[data-accesskey]');_.each(elementWithDataAccessKey,function(elem){elem.setAttribute('accesskey',elem.getAttribute('data-accesskey'));elem.removeAttribute('data-accesskey');});}
var throbbers=[];function blockUI(){var tmp=$.blockUI.apply($,arguments);var throbber=new Throbber();throbbers.push(throbber);throbber.appendTo($(".oe_blockui_spin_container"));$(document.body).addClass('o_ui_blocked');blockAccessKeys();return tmp;}
function unblockUI(){_.invoke(throbbers,'destroy');throbbers=[];$(document.body).removeClass('o_ui_blocked');unblockAccessKeys();return $.unblockUI.apply($,arguments);}
function redirect(url,wait){disableCrashManager();var load=function(){var old=""+window.location;var old_no_hash=old.split("#")[0];var url_no_hash=url.split("#")[0];location.assign(url);if(old_no_hash===url_no_hash){location.reload(true);}};var wait_server=function(){ajax.rpc("/web/webclient/version_info",{}).then(load).guardedCatch(function(){setTimeout(wait_server,250);});};if(wait){setTimeout(wait_server,1000);}else{load();}}
function Reload(parent,action){var params=action.params||{};var menu_id=params.menu_id||false;var l=window.location;var sobj=$.deparam(l.search.substr(1));if(params.url_search){sobj=_.extend(sobj,params.url_search);}
var search='?'+$.param(sobj);var hash=l.hash;if(menu_id){hash="#menu_id="+menu_id;}
var url=l.protocol+"//"+l.host+l.pathname+search+hash;core.bus.trigger('clear_cache');redirect(url,params.wait);}
core.action_registry.add("reload",Reload);function Home(parent,action){var url='/'+(window.location.search||'');redirect(url,action&&action.params&&action.params.wait);}
core.action_registry.add("home",Home);function login(){redirect('/web/login');}
core.action_registry.add("login",login);function logout(){redirect('/web/session/logout');return new Promise();}
core.action_registry.add("logout",logout);function displayNotification(parent,action){let{title='',message='',links=[],type='info',sticky=false,next}=action.params||{};links=links.map(({url,label})=>`<a href="${_.escape(url)}" target="_blank">${_.escape(label)}</a>`)
parent.displayNotification({title:_.escape(title),message:sprintf(_.escape(message),...links),type,sticky});return next;}
core.action_registry.add("display_notification",displayNotification);function ReloadContext(parent,action){ajax.rpc("/web/session/get_session_info",{}).then(function(){Reload(parent,action);});}
core.action_registry.add("reload_context",ReloadContext);if(!document.contains){document.contains=function contains(node){if(!(0 in arguments)){throw new TypeError('1 argument is required');}
do{if(this===node){return true;}}while(node=node&&node.parentNode);return false;};}
return{blockUI:blockUI,unblockUI:unblockUI,redirect:redirect,};});;

/* /web/static/src/js/services/crash_manager_service.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('crash_manager.service',function(require){'use strict';const core=require('web.core');const CrashManager=require('web.CrashManager').CrashManager;core.serviceRegistry.add('crash_manager',CrashManager);});;

/* /web/static/src/js/services/data_manager.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.DataManager',function(require){"use strict";var config=require('web.config');var core=require('web.core');var rpc=require('web.rpc');var session=require('web.session');var utils=require('web.utils');return core.Class.extend({init:function(){this._init_cache();core.bus.on('clear_cache',this,this.invalidate.bind(this));},_init_cache:function(){this._cache={actions:{},filters:{},views:{},};},invalidate:function(){session.invalidateCacheKey('load_menus');this._init_cache();},load_action:function(action_id,additional_context){var self=this;var key=this._gen_key(action_id,additional_context||{});if(config.isDebug('assets')||!this._cache.actions[key]){this._cache.actions[key]=rpc.query({route:"/web/action/load",params:{action_id:action_id,additional_context:additional_context,},}).then(function(action){self._cache.actions[key]=action.no_cache?null:self._cache.actions[key];return action;}).guardedCatch(()=>this._invalidate('actions',key));}
return this._cache.actions[key].then(function(action){return $.extend(true,{},action);});},load_views:async function({model,context,views_descr},options={}){const viewsKey=this._gen_key(model,views_descr,options,context);const filtersKey=this._gen_key(model,options.action_id);const withFilters=Boolean(options.load_filters);const shouldLoadViews=config.isDebug('assets')||!this._cache.views[viewsKey];const shouldLoadFilters=config.isDebug('assets')||(withFilters&&!this._cache.filters[filtersKey]);if(shouldLoadViews){options.load_filters=shouldLoadFilters;this._cache.views[viewsKey]=rpc.query({args:[],kwargs:{context,options,views:views_descr},model,method:'load_views',}).then(result=>{utils.deepFreeze(result.fields);for(const[viewId,viewType]of views_descr){const fvg=result.fields_views[viewType];fvg.viewFields=fvg.fields;fvg.fields=result.fields;}
if(shouldLoadFilters){this._cache.filters[filtersKey]=Promise.resolve(result.filters);}
return result.fields_views;}).guardedCatch(()=>this._invalidate('views',viewsKey));}
const result=await this._cache.views[viewsKey];if(withFilters&&result.search){if(shouldLoadFilters){await this.load_filters({actionId:options.action_id,context,forceReload:false,modelName:model,});}
result.search.favoriteFilters=await this._cache.filters[filtersKey];}
return result;},load_filters:function(params){const key=this._gen_key(params.modelName,params.actionId);const forceReload=params.forceReload!==false&&config.isDebug('assets');if(forceReload||!this._cache.filters[key]){this._cache.filters[key]=rpc.query({args:[params.modelName,params.actionId],kwargs:{context:params.context||{},},model:'ir.filters',method:'get_filters',}).guardedCatch(()=>this._invalidate('filters',key));}
return this._cache.filters[key];},create_filter:function(filter){return rpc.query({args:[filter],model:'ir.filters',method:'create_or_replace',}).then(filterId=>{const filtersKey=this._gen_key(filter.model_id,filter.action_id);this._invalidate('filters',filtersKey);return filterId;});},delete_filter:function(filterId){return rpc.query({args:[filterId],model:'ir.filters',method:'unlink',}).then(()=>this._invalidate('filters'));},_gen_key:function(){return _.map(Array.prototype.slice.call(arguments),function(arg){if(!arg){return false;}
return _.isObject(arg)?JSON.stringify(arg):arg;}).join(',');},_invalidate(section,key){if(key){delete this._cache[section][key];}else{this._cache[section]={};}},});});odoo.define('web.data_manager',function(require){"use strict";var DataManager=require('web.DataManager');var data_manager=new DataManager();return data_manager;});;

/* /web/static/src/js/services/report_service.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.ReportService',function(require){"use strict";var AbstractService=require('web.AbstractService');var core=require('web.core');var ReportService=AbstractService.extend({dependencies:['ajax'],checkWkhtmltopdf:function(){if(!this.wkhtmltopdfState){this.wkhtmltopdfState=this._rpc({route:'/report/check_wkhtmltopdf'});}
return this.wkhtmltopdfState;},});core.serviceRegistry.add('report',ReportService);return ReportService;});;

/* /web/static/src/js/services/session.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.session',function(require){"use strict";var Session=require('web.Session');var modules=odoo._modules;var session=new Session(undefined,undefined,{modules:modules,use_cors:false});session.is_bound=session.session_bind();return session;});;

/* /web/static/src/js/widgets/change_password.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.ChangePassword',function(require){"use strict";var AbstractAction=require('web.AbstractAction');var core=require('web.core');var Dialog=require('web.Dialog');var web_client=require('web.web_client');var _t=core._t;var ChangePassword=AbstractAction.extend({template:"ChangePassword",start:function(){var self=this;web_client.set_title(_t("Change Password"));var $button=self.$('.oe_form_button');$button.appendTo(this.getParent().$footer);$button.eq(1).click(function(){self.$el.parents('.modal').modal('hide');});$button.eq(0).click(function(){self._rpc({route:'/web/session/change_password',params:{fields:$('form[name=change_password_form]').serializeArray()}}).then(function(result){if(result.error){self._display_error(result);}else{self.do_action('logout');}});});},_display_error:function(error){return new Dialog(this,{size:'medium',title:error.title,$content:$('<div>').html(error.error)}).open();},});core.action_registry.add("change_password",ChangePassword);return ChangePassword;});;

/* /web/static/src/js/tools/test_menus_loader.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.clickEverywhere',function(require){"use strict";var ajax=require('web.ajax');function startClickEverywhere(xmlId,appsMenusOnly){ajax.loadJS('web/static/src/js/tools/test_menus.js').then(function(){clickEverywhere(xmlId,appsMenusOnly);});}
return startClickEverywhere;});;

/* /web/static/src/js/tools/debug_manager_backend.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.DebugManager.Backend',function(require){"use strict";var ActionManager=require('web.ActionManager');var DebugManager=require('web.DebugManager');var dialogs=require('web.view_dialogs');var startClickEverywhere=require('web.clickEverywhere');var config=require('web.config');var core=require('web.core');var Dialog=require('web.Dialog');var field_utils=require('web.field_utils');var SystrayMenu=require('web.SystrayMenu');var utils=require('web.utils');var WebClient=require('web.WebClient');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;DebugManager.include({requests_clear:function(){if(!this._events){return;}
this._events=[];this.trigger('update-stats',this._events);},show_timelines:function(){if(this._overlay){this._overlay.destroy();this._overlay=null;return;}
this._overlay=new RequestsOverlay(this);this._overlay.appendTo(document.body);},update:function(tag,descriptor){return this._super().then(function(){this.$dropdown.find(".o_debug_split_assets").before(QWeb.render('WebClient.DebugManager.Backend',{manager:this,}));}.bind(this));},select_view:function(){var self=this;new dialogs.SelectCreateDialog(this,{res_model:'ir.ui.view',title:_t('Select a view'),disable_multiple_selection:true,domain:[['type','!=','qweb'],['type','!=','search']],on_selected:function(records){self._rpc({model:'ir.ui.view',method:'search_read',domain:[['id','=',records[0].id]],fields:['name','model','type'],limit:1,}).then(function(views){var view=views[0];view.type=view.type==='tree'?'list':view.type;self.do_action({type:'ir.actions.act_window',name:view.name,res_model:view.model,views:[[view.id,view.type]]});});}}).open();},perform_js_tests:function(){this.do_action({name:_t("JS Tests"),target:'new',type:'ir.actions.act_url',url:'/web/tests?mod=*'});},perform_js_mobile_tests:function(){this.do_action({name:_t("JS Mobile Tests"),target:'new',type:'ir.actions.act_url',url:'/web/tests/mobile?mod=*'});},perform_click_everywhere_test:function(){var $homeMenu=$("nav.o_main_navbar > a.o_menu_toggle.fa-th");$homeMenu.click();startClickEverywhere();},});DebugManager.include({async start(){const[_,canSeeRecordRules,canSeeModelAccess]=await Promise.all([this._super(...arguments),this._checkAccessRight('ir.rule','read'),this._checkAccessRight('ir.model.access','read'),])
this.canSeeRecordRules=canSeeRecordRules;this.canSeeModelAccess=canSeeModelAccess;},async getModelId(modelName){const[modelId]=await this._rpc({model:'ir.model',method:'search',args:[[['model','=',modelName]]],kwargs:{limit:1},});return modelId},update:function(tag,descriptor){if(tag==='action'){this._action=descriptor;}
return this._super().then(function(){this.$dropdown.find(".o_debug_leave_section").before(QWeb.render('WebClient.DebugManager.Action',{manager:this,action:this._action}));}.bind(this));},edit:function(params,evt){this.do_action({res_model:params.model,res_id:params.id,name:evt.target.text,type:'ir.actions.act_window',views:[[false,'form']],view_mode:'form',target:'new',flags:{action_buttons:true,headless:true}});},async get_view_fields(){const modelId=await this.getModelId(this._action.res_model);this.do_action({res_model:'ir.model.fields',name:_t('View Fields'),views:[[false,'list'],[false,'form']],domain:[['model_id','=',modelId]],type:'ir.actions.act_window',context:{'default_model_id':modelId}});},manage_filters:function(){this.do_action({res_model:'ir.filters',name:_t('Manage Filters'),views:[[false,'list'],[false,'form']],type:'ir.actions.act_window',context:{search_default_my_filters:true,search_default_model_id:this._action.res_model}});},translate:function(){this._rpc({model:'ir.translation',method:'get_technical_translations',args:[this._action.res_model],}).then(this.do_action);},async actionRecordRules(){const modelId=await this.getModelId(this._action.res_model);this.do_action({res_model:'ir.rule',name:_t('Model Record Rules'),views:[[false,'list'],[false,'form']],domain:[['model_id','=',modelId]],type:'ir.actions.act_window',context:{'default_model_id':modelId,},});},async actionModelAccess(){const modelId=await this.getModelId(this._action.res_model);this.do_action({res_model:'ir.model.access',name:_t('Model Access'),views:[[false,'list'],[false,'form']],domain:[['model_id','=',modelId]],type:'ir.actions.act_window',context:{'default_model_id':modelId,},});},});DebugManager.include({start:function(){this._can_edit_views=false;return Promise.all([this._super(),this._checkAccessRight('ir.ui.view','write').then(function(ar){this._can_edit_views=ar;}.bind(this))]);},update:function(tag,descriptor,widget){if(tag==='action'||tag==='view'){this._controller=widget;}
return this._super(tag,descriptor).then(function(){this.$dropdown.find(".o_debug_leave_section").before(QWeb.render('WebClient.DebugManager.View',{action:this._action,can_edit:this._can_edit_views,controller:this._controller,withControlPanel:this._controller&&this._controller.withControlPanel,manager:this,view:this._controller&&_.findWhere(this._action.views,{type:this._controller.viewType,}),}));}.bind(this));},get_attachments:function(){var selectedIDs=this._controller.getSelectedIds();if(!selectedIDs.length){console.warn(_t("No attachment available"));return;}
this.do_action({res_model:'ir.attachment',name:_t('Manage Attachments'),views:[[false,'list'],[false,'form']],type:'ir.actions.act_window',domain:[['res_model','=',this._action.res_model],['res_id','=',selectedIDs[0]]],context:{default_res_model:this._action.res_model,default_res_id:selectedIDs[0],},});},get_metadata:function(){var self=this;var selectedIDs=this._controller.getSelectedIds();if(!selectedIDs.length){console.warn(_t("No metadata available"));return;}
this._rpc({model:this._action.res_model,method:'get_metadata',args:[selectedIDs],}).then(function(result){var metadata=result[0];metadata.creator=field_utils.format.many2one(metadata.create_uid);metadata.lastModifiedBy=field_utils.format.many2one(metadata.write_uid);var createDate=field_utils.parse.datetime(metadata.create_date);metadata.create_date=field_utils.format.datetime(createDate);var modificationDate=field_utils.parse.datetime(metadata.write_date);metadata.write_date=field_utils.format.datetime(modificationDate);var dialog=new Dialog(this,{title:_.str.sprintf(_t("Metadata (%s)"),self._action.res_model),size:'medium',$content:QWeb.render('WebClient.DebugViewLog',{perm:metadata,})});dialog.open().opened(function(){dialog.$el.on('click','a[data-action="toggle_noupdate"]',function(ev){ev.preventDefault();self._rpc({model:'ir.model.data',method:'toggle_noupdate',args:[self._action.res_model,metadata.id]}).then(function(res){dialog.close();self.get_metadata();})});})});},set_defaults:function(){var self=this;var display=function(fieldInfo,value){var displayed=value;if(value&&fieldInfo.type==='many2one'){displayed=value.data.display_name;value=value.data.id;}else if(value&&fieldInfo.type==='selection'){displayed=_.find(fieldInfo.selection,function(option){return option[0]===value;})[1];}
return[value,displayed];};var renderer=this._controller.renderer;var state=renderer.state;var fields=state.fields;var fieldsInfo=state.fieldsInfo.form;var fieldNamesInView=state.getFieldNames();var fieldNamesOnlyOnView=['message_attachment_count'];var fieldsValues=state.data;var modifierDatas={};_.each(fieldNamesInView,function(fieldName){modifierDatas[fieldName]=_.find(renderer.allModifiersData,function(modifierdata){return modifierdata.node.attrs.name===fieldName;});});this.fields=_.chain(fieldNamesInView).difference(fieldNamesOnlyOnView).map(function(fieldName){var modifierData=modifierDatas[fieldName];var invisibleOrReadOnly;if(modifierData){var evaluatedModifiers=modifierData.evaluatedModifiers[state.id];invisibleOrReadOnly=evaluatedModifiers.invisible||evaluatedModifiers.readonly;}
var fieldInfo=fields[fieldName];var valueDisplayed=display(fieldInfo,fieldsValues[fieldName]);var value=valueDisplayed[0];var displayed=valueDisplayed[1];if(!value||invisibleOrReadOnly||fieldInfo.type==='one2many'||fieldInfo.type==='many2many'||fieldInfo.type==='binary'||fieldsInfo[fieldName].options.isPassword||!_.isEmpty(fieldInfo.depends)){return false;}
return{name:fieldName,string:fieldInfo.string,value:value,displayed:displayed,};}).compact().sortBy(function(field){return field.string;}).value();var conditions=_.chain(fieldNamesInView).filter(function(fieldName){var fieldInfo=fields[fieldName];return fieldInfo.change_default;}).map(function(fieldName){var fieldInfo=fields[fieldName];var valueDisplayed=display(fieldInfo,fieldsValues[fieldName]);var value=valueDisplayed[0];var displayed=valueDisplayed[1];return{name:fieldName,string:fieldInfo.string,value:value,displayed:displayed,};}).value();var d=new Dialog(this,{title:_t("Set Default"),buttons:[{text:_t("Close"),close:true},{text:_t("Save default"),click:function(){var $defaults=d.$el.find('#formview_default_fields');var fieldToSet=$defaults.val();if(!fieldToSet){$defaults.parent().addClass('o_form_invalid');return;}
var selfUser=d.$el.find('#formview_default_self').is(':checked');var condition=d.$el.find('#formview_default_conditions').val();var value=_.find(self.fields,function(field){return field.name===fieldToSet;}).value;self._rpc({model:'ir.default',method:'set',args:[self._action.res_model,fieldToSet,value,selfUser,true,condition||false,],}).then(function(){d.close();});}}]});d.args={fields:this.fields,conditions:conditions,};d.template='FormView.set_default';d.open();},fvg:function(){var self=this;var dialog=new Dialog(this,{title:_t("Fields View Get")});dialog.opened().then(function(){$('<pre>').text(utils.json_node_to_xml(self._controller.renderer.arch,true)).appendTo(dialog.$el);});dialog.open();},});function make_context(width,height,fn){var canvas=document.createElement('canvas');canvas.width=width;canvas.height=height;canvas.style.position='relative';var ctx=canvas.getContext('2d');ctx.imageSmoothingEnabled=false;ctx.mozImageSmoothingEnabled=false;ctx.oImageSmoothingEnabled=false;ctx.webkitImageSmoothingEnabled=false;fn&&fn(ctx);return ctx;}
var RequestsOverlay=Widget.extend({template:'WebClient.DebugManager.RequestsOverlay',TRACKS:8,TRACK_WIDTH:9,events:{mousemove:function(e){this.$tooltip.hide();}},init:function(){this._super.apply(this,arguments);this._render=_.throttle(this._render.bind(this),1000/15,{leading:false});},start:function(){var _super=this._super();this.$tooltip=this.$('div.o_debug_tooltip');this.getParent().on('update-stats',this,this._render);this._render();return _super;},tooltip:function(text,start,end,x,y){var top=y-this.el.offsetTop+this.el.scrollTop+1;var left=x-this.el.offsetLeft+this.el.scrollLeft+1;this.$tooltip.css({top:top,left:left}).show()[0].innerHTML=['<p>',text,' (',(end-start),'ms)','</p>'].join('');},_render:function(){var $summary=this.$('header'),w=$summary[0].clientWidth,$requests=this.$('.o_debug_requests');$summary.find('canvas').attr('width',w);var tracks=document.getElementById('o_debug_requests_summary');_.invoke(this.getChildren(),'destroy');var requests=this.getParent()._events;var bounds=this._get_bounds(requests);var scale=w/(bounds.high-bounds.low);var track_ends=_(this.TRACKS).times(_.constant(-Infinity));var ctx=tracks.getContext('2d');ctx.lineWidth=this.TRACK_WIDTH;for(var i=0;i<requests.length;i++){var request=requests[i];var rstart=Math.floor(request[0][3]*1e3);var rend=Math.ceil(request[request.length-1][3]*1e3);for(var track=0;track<track_ends.length;++track){if(track_ends[track]<rstart){break;}}
if(track>=track_ends.length){console.warn("could not find an empty summary track");continue;}
track_ends[track]=rend;ctx.save();ctx.translate(Math.floor((rstart-bounds.low)*scale),track*(this.TRACK_WIDTH+1));this._draw_request(request,ctx,0,scale);ctx.restore();new RequestDetails(this,request,scale).appendTo($requests);}},_draw_request:function(request,to_context,step,hscale,handle_event){var surfaces={request:make_context(to_context.canvas.width,to_context.canvas.height,function(ctx){ctx.strokeStyle='blue';ctx.fillStyle='#88f';ctx.lineJoin='round';ctx.lineWidth=1;}),sql:make_context(to_context.canvas.width,to_context.canvas.height,function(ctx){ctx.strokeStyle='red';ctx.fillStyle='#f88';ctx.lineJoin='round';ctx.lineWidth=1;}),template:make_context(to_context.canvas.width,to_context.canvas.height,function(ctx){ctx.strokeStyle='green';ctx.fillStyle='#8f8';ctx.lineJoin='round';ctx.lineWidth=1;})};var stacks={},start=Math.floor(request[0][3]*1e3*hscale);var event_idx=0;var rect_width=to_context.lineWidth;for(var i=0;i<request.length;i++){var type,m,event=request[i];var tag=event[0],timestamp=Math.floor(event[3]*1e3*hscale)-start;if(m=/(\w+)-start/.exec(tag)){type=m[1];if(!(type in stacks)){stacks[type]=[];}
handle_event&&handle_event(event_idx,timestamp,event);stacks[type].push({timestamp:timestamp,idx:event_idx++});}else if(m=/(\w+)-end/.exec(tag)){type=m[1];var stack=stacks[type];var estart=stack.pop(),duration=Math.ceil(timestamp-estart.timestamp);handle_event&&handle_event(estart.idx,timestamp,event);var surface=surfaces[type];if(!surface){continue;}
var y=step*estart.idx;surface.rect(estart.timestamp+0.5,y+0.5,duration||1,rect_width);}}
var keys=['request','template','sql'];for(var j=0;j<keys.length;++j){var ctx=surfaces[keys[j]];ctx.fill();ctx.stroke();to_context.drawImage(ctx.canvas,0,0);}},_get_bounds:function(requests){var low=+Infinity;var high=-+Infinity;for(var i=0;i<requests.length;i++){var request=requests[i];for(var j=0;j<request.length;j++){var event=request[j];var timestamp=event[3];low=Math.min(low,timestamp);high=Math.max(high,timestamp);}}
return{low:Math.floor(low*1e3),high:Math.ceil(high*1e3)};}});var RequestDetails=Widget.extend({events:{click:function(){this._open=!this._open;this.render();},'mousemove canvas':function(e){e.stopPropagation();var y=e.y||e.offsetY||e.layerY;if(!y){return;}
var event=this._payloads[Math.floor(y/this._REQ_HEIGHT)];if(!event){return;}
this.getParent().tooltip(event.payload,event.start,event.stop,e.clientX,e.clientY);}},init:function(parent,request,scale){this._super.apply(this,arguments);this._request=request;this._open=false;this._scale=scale;this._REQ_HEIGHT=20;},start:function(){this.el.style.borderBottom='1px solid black';this.render();return this._super();},render:function(){var request_cell_height=this._REQ_HEIGHT,TITLE_WIDTH=200;var request=this._request;var req_start=request[0][3]*1e3;var req_duration=request[request.length-1][3]*1e3-req_start;var height=request_cell_height*(this._open?request.length/2:1);var cell_center=request_cell_height/2;var ctx=make_context(210+Math.ceil(req_duration*this._scale),height,function(ctx){ctx.lineWidth=cell_center;});this.$el.empty().append(ctx.canvas);var payloads=this._payloads=[];var text_ctx=make_context(TITLE_WIDTH,height,function(ctx){ctx.font='12px sans-serif';ctx.textAlign='right';ctx.textBaseline='middle';ctx.translate(0,cell_center);});ctx.save();ctx.translate(TITLE_WIDTH+10,((request_cell_height/4)|0));this.getParent()._draw_request(request,ctx,this._open?request_cell_height:0,this._scale,function(idx,timestamp,event){if(/-start$/g.test(event[0])){payloads.push({payload:event[2],start:timestamp,stop:null});var title=event[2];title=title.replace(/\s+$/,'');title=title.length<=50?title:(''+title.slice(-49));while(text_ctx.measureText(title).width>200){title=''+title.slice(2);}
text_ctx.fillText(title,TITLE_WIDTH,request_cell_height*idx);}else if(/-end$/g.test(event[0])){payloads[idx].stop=timestamp;}});ctx.restore();ctx.drawImage(text_ctx.canvas,0,0);}});if(config.isDebug()){SystrayMenu.Items.push(DebugManager);WebClient.include({current_action_updated:function(action,controller){this._super.apply(this,arguments);this.update_debug_manager(action,controller);},update_debug_manager:function(action,controller){var debugManager=_.find(this.menu.systray_menu.widgets,function(item){return item instanceof DebugManager;});debugManager.update('action',action,controller&&controller.widget);}});ActionManager.include({getCurrentActionInDialog:function(){if(this.currentDialogController){return this.actions[this.currentDialogController.actionID];}
return null;},getCurrentControllerInDialog:function(){return this.currentDialogController;},});Dialog.include({open:function(){var self=this;this.opened(function(){setTimeout(function(){var parent=self.getParent();if(parent instanceof ActionManager){var action=parent.getCurrentActionInDialog();if(action){var controller=parent.getCurrentControllerInDialog();self.debugManager=new DebugManager(self);var $header=self.$modal.find('.modal-header:first');return self.debugManager.prependTo($header).then(function(){self.debugManager.update('action',action,controller.widget);});}}},0);});return this._super.apply(this,arguments);},});}
return DebugManager;});;

/* /web/static/src/js/tools/tools.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.tools',function(require){"use strict";function deprecated(fn,message){return function(){console.warn(message||(fn.name+' is deprecated.'));return fn.apply(this,arguments);};}
return{deprecated:deprecated,};});;

/* /web/static/src/js/env.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("web.env",function(require){"use strict";const commonEnv=require('web.commonEnv');const dataManager=require('web.data_manager');const{blockUI,unblockUI}=require("web.framework");const env=Object.assign(commonEnv,{dataManager});env.services=Object.assign(env.services,{blockUI,unblockUI});return env;});;

/* /web/static/src/js/widgets/data_export.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.DataExport',function(require){"use strict";var config=require('web.config');var core=require('web.core');var Dialog=require('web.Dialog');var data=require('web.data');var framework=require('web.framework');var pyUtils=require('web.py_utils');var QWeb=core.qweb;var _t=core._t;var DataExport=Dialog.extend({template:'ExportDialog',events:{'change .o_exported_lists_select':'_onChangeExportList','change .o_import_compat input':'_onChangeCompatibleInput','click .o_add_field':'_onClickAddField','click .o_delete_exported_list':'_onClickDeleteExportListBtn','click .o_expand':'_onClickExpand','click .o_remove_field':'_onClickRemoveField','click .o_save_list .o_save_list_btn':'_onClickSaveListBtn','click .o_save_list .o_cancel_list_btn':'_resetTemplateField','click .o_export_tree_item':'_onClickTreeItem','dblclick .o_export_tree_item:not(.haschild)':'_onDblclickTreeItem','keydown .o_export_tree_item':'_onKeydownTreeItem','keydown .o_save_list_name':'_onKeydownSaveList','input .o_export_search_input':'_onSearchInput',},init:function(parent,record,defaultExportFields,groupedBy,activeDomain,idsToExport){var options={title:_t("Export Data"),buttons:[{text:_t("Export"),click:this._onExportData,classes:'btn-primary'},{text:_t("Close"),close:true},],};this._super(parent,options);this.records={};this.record=record;this.defaultExportFields=defaultExportFields;this.groupby=groupedBy;this.exports=new data.DataSetSearch(this,'ir.exports',this.record.getContext());this.rowIndex=0;this.rowIndexLevel=0;this.isCompatibleMode=false;this.domain=activeDomain||this.record.domain;this.idsToExport=activeDomain?false:idsToExport;},start:function(){var self=this;var proms=[this._super.apply(this,arguments)];this.$modal.find('.modal-content').css('height','100%');this.$fieldsList=this.$('.o_fields_list');proms.push(this._rpc({route:'/web/export/formats'}).then(doSetupExportFormats));proms.push(this._onChangeCompatibleInput().then(function(){_.each(self.defaultExportFields,function(field){var record=self.records[field];self._addField(record.id,record.string);});}));proms.push(this._showExportsList());this.opened().then(function(){self.$('.o_fields_list').sortable({axis:'y',handle:'.o_short_field',forcePlaceholderSize:true,placeholder:'o-field-placeholder',update:self.proxy('_resetTemplateField'),});});return Promise.all(proms);function doSetupExportFormats(formats){var $fmts=self.$('.o_export_format');_.each(formats,function(format){var $radio=$('<input/>',{type:'radio',value:format.tag,name:'o_export_format_name',class:'form-check-input',id:'o_radio'+format.label});var $label=$('<label/>',{html:format.label,class:'form-check-label',for:'o_radio'+format.label});if(format.error){$radio.prop('disabled',true);$label.html(_.str.sprintf("%s  %s",format.label,format.error));}
$fmts.append($("<div class='radio form-check form-check-inline pl-4'></div>").append($radio,$label));});self.$exportFormatInputs=$fmts.find('input');self.$exportFormatInputs.filter(':enabled').first().prop('checked',true);}},export(){let exportedFields=this.defaultExportFields.map(field=>({name:field,label:this.record.fields[field].string,}));this._exportData(exportedFields,'xlsx',false);},_addField:function(fieldID,label){var $fieldList=this.$('.o_fields_list');if(!$fieldList.find(".o_export_field[data-field_id='"+fieldID+"']").length){$fieldList.append($('<li>',{'class':'o_export_field','data-field_id':fieldID}).append($('<span>',{'class':"fa fa-arrows o_short_field mx-1"}),label.trim(),$('<span>',{'class':'fa fa-trash m-1 pull-right o_remove_field','title':_t("Remove field")})));}},_exportData(exportedFields,exportFormat,idsToExport){if(_.isEmpty(exportedFields)){Dialog.alert(this,_t("Please select fields to export..."));return;}
if(this.isCompatibleMode){exportedFields.unshift({name:'id',label:_t('External ID')});}
framework.blockUI();this.getSession().get_file({url:'/web/export/'+exportFormat,data:{data:JSON.stringify({model:this.record.model,fields:exportedFields,ids:idsToExport,domain:this.domain,groupby:this.groupby,context:pyUtils.eval('contexts',[this.record.getContext()]),import_compat:this.isCompatibleMode,})},complete:framework.unblockUI,error:(error)=>this.call('crash_manager','rpc_error',error),});},_getFields:function(){var exportFields=this.$('.o_export_field').map(function(){return $(this).data('field_id');}).get();if(exportFields.length===0){Dialog.alert(this,_t("Please select fields to save export list..."));}
return exportFields;},_onExpandAction:function(record){var self=this;if(!record.children){return;}
var model=record.params.model;var prefix=record.params.prefix;var name=record.params.name;var excludeFields=[];if(record.relation_field){excludeFields.push(record.relation_field);}
if(!record.loaded){this._rpc({route:'/web/export/get_fields',params:{model:model,prefix:prefix,parent_name:name,import_compat:this.isCompatibleMode,parent_field_type:record.field_type,parent_field:record.params.parent_field,exclude:excludeFields,},}).then(function(results){record.loaded=true;self._onShowData(results,record.id);});}else{this._showContent(record.id);}},_onShowData:function(records,expansion){var self=this;if(expansion){this.$('.o_export_tree_item[data-id="'+expansion+'"]').addClass('show').find('.o_expand_parent').toggleClass('fa-chevron-right fa-chevron-down').next().after(QWeb.render('Export.TreeItems',{fields:records,debug:config.isDebug()}));}else{this.$('.o_left_field_panel').empty().append($('<div/>').addClass('o_field_tree_structure').append(QWeb.render('Export.TreeItems',{fields:records,debug:config.isDebug()})));}
_.extend(this.records,_.object(_.pluck(records,'id'),records));this.$records=this.$('.o_export_tree_item');this.$records.each(function(i,el){var $el=$(el);$el.find('.o_tree_column').first().toggleClass('o_required',!!self.records[$el.data('id')].required);});this.$('#o-export-search-filter').val('');},_addNewTemplate:function(){this.$('.o_exported_lists').addClass('d-none');this.$(".o_save_list").show().find(".o_save_list_name").val("").focus();},_resetTemplateField:function(){this.$('.o_exported_lists_select').val("");this.$('.o_delete_exported_list').addClass('d-none');this.$('.o_exported_lists').removeClass('d-none');this.$(".o_save_list").hide().find(".o_save_list_name").val("");},_showContent:function(fieldID){var $item=this.$('.o_export_tree_item[data-id="'+fieldID+'"]');$item.toggleClass('show');var isOpen=$item.hasClass('show');$item.children('.o_expand_parent').toggleClass('fa-chevron-down',!!isOpen).toggleClass('fa-chevron-right',!isOpen);var $childField=$item.find('.o_export_tree_item');var childLength=(fieldID.split('/')).length+1;for(var i=0;i<$childField.length;i++){var $child=$childField.eq(i);if(!isOpen){$child.hide();}else if(childLength===$childField.eq(i).data('id').split('/').length){if($child.hasClass('show')){$child.removeClass('show');$child.children('.o_expand_parent').removeClass('fa-chevron-down').addClass('fa-chevron-right');}
$child.show();}}
this.$('#o-export-search-filter').val('');},_showExportsList:function(){var self=this;if(this.$('.o_exported_lists_select').is(':hidden')){this.$('.o_exported_lists').show();return Promise.resolve();}
return this._rpc({model:'ir.exports',method:'search_read',fields:['name'],domain:[['resource','=',this.record.model]]}).then(function(exportList){self.$('.o_exported_lists').append(QWeb.render('Export.SavedList',{existing_exports:exportList,}));});},_onChangeExportList:function(){var self=this;var exportID=this.$('.o_exported_lists_select option:selected').val();this.$('.o_delete_exported_list').toggleClass('d-none',!exportID);if(exportID&&exportID!=='new_template'){this.$('.o_fields_list').empty();this._rpc({route:'/web/export/namelist',params:{model:this.record.model,export_id:parseInt(exportID,10),},}).then(function(fieldList){_.each(fieldList,function(field){self._addField(field.name,field.label);});});}else if(exportID==='new_template'){self._addNewTemplate();}},_onChangeCompatibleInput:function(){var self=this;this.isCompatibleMode=this.$('.o_import_compat input').is(':checked');this.$('.o_field_tree_structure').remove();this._resetTemplateField();return this._rpc({route:'/web/export/get_fields',params:{model:this.record.model,import_compat:this.isCompatibleMode,},}).then(function(records){var compatibleFields=_.map(records,function(record){return record.id;});self._onShowData(records);self.$('.o_fields_list').empty();_.chain(self.$fieldsList.find('.o_export_field')).map(function(field){return $(field).data('field_id');}).union(self.defaultExportFields).intersection(compatibleFields).each(function(field){var record=_.find(records,function(rec){return rec.id===field;});self._addField(record.id,record.string);});self.$('#o-export-search-filter').val('');});},_onClickAddField:function(ev){ev.stopPropagation();var $field=$(ev.currentTarget);this._resetTemplateField();this._addField($field.closest('.o_export_tree_item').data('id'),$field.closest('.o_tree_column').text());},_onClickDeleteExportListBtn:function(){var self=this;var selectExp=this.$('.o_exported_lists_select option:selected');var options={confirm_callback:function(){if(selectExp.val()){self.exports.unlink([parseInt(selectExp.val(),10)]);selectExp.remove();if(self.$('.o_exported_lists_select option').length<=1){self.$('.o_exported_lists').hide();}}}};Dialog.confirm(this,_t("Do you really want to delete this export template?"),options);},_onClickExpand:function(ev){this._onExpandAction(this.records[$(ev.target).closest('.o_export_tree_item').data('id')]);},_onClickRemoveField:function(ev){$(ev.currentTarget).closest('.o_export_field').remove();this._resetTemplateField();},_onClickSaveListBtn:function(){var self=this;var $saveList=this.$('.o_save_list');var value=$saveList.find('input').val();if(!value){Dialog.alert(this,_t("Please enter save field list name"));return;}
var fields=this._getFields();if(fields.length===0){return;}
$saveList.hide();this.exports.create({name:value,resource:this.record.model,export_fields:_.map(fields,function(field){return[0,0,{name:field}];}),}).then(function(exportListID){if(!exportListID){return;}
var $select=self.$('.o_exported_lists_select');if($select.length===0||$select.is(':hidden')){self._showExportsList();}
$select.append(new Option(value,exportListID));self.$('.o_exported_lists').removeClass('d-none');$select.val(exportListID);});},_onClickTreeItem:function(ev){ev.stopPropagation();var $elem=$(ev.currentTarget);var rowIndex=$elem.prevAll('.o_export_tree_item').length;var rowIndexLevel=$elem.parents('.o_export_tree_item').length;if(ev.shiftKey&&rowIndexLevel===this.rowIndexLevel){var minIndex=Math.min(rowIndex,this.rowIndex);var maxIndex=Math.max(rowIndex,this.rowIndex);this.$records.filter(function(){return($elem.parent()[0]===$(this).parent()[0]);}).slice(minIndex,maxIndex+1).addClass('o_selected').filter(':not(:last)').each(processChildren);}
this.rowIndex=rowIndex;this.rowIndexLevel=rowIndexLevel;if(ev.ctrlKey){$elem.toggleClass('o_selected').focus();}else if(ev.shiftKey){$elem.addClass('o_selected').focus();}else{this.$('.o_selected').removeClass('o_selected');$elem.addClass('o_selected').focus();}
function processChildren(){var $child=$(this);if($child.hasClass('show')){$child.children('.o_export_tree_item').addClass('o_selected').each(processChildren);}}},_onExportData(){let exportedFields=this.$('.o_export_field').map((i,field)=>({name:$(field).data('field_id'),label:field.textContent,})).get();let exportFormat=this.$exportFormatInputs.filter(':checked').val();this._exportData(exportedFields,exportFormat,this.idsToExport);},_onDblclickTreeItem:function(ev){var self=this;this._resetTemplateField();function addElement(el){self._addField(el.getAttribute('data-id'),el.querySelector('.o_tree_column').textContent);}
var target=ev.currentTarget;target.classList.remove('o_selected');[].reverse.call($(target).parents('.o_export_tree_item')).each(function(){addElement(this);});addElement(target);},_onKeydownSaveList:function(ev){if(ev.keyCode===$.ui.keyCode.ENTER){this._onClickSaveListBtn();}},_onKeydownTreeItem:function(ev){ev.stopPropagation();var $el=$(ev.currentTarget);var record=this.records[$el.data('id')];switch(ev.keyCode||ev.which){case $.ui.keyCode.LEFT:if($el.hasClass('show')){this._onExpandAction(record);}
break;case $.ui.keyCode.RIGHT:if(!$el.hasClass('show')){this._onExpandAction(record);}
break;case $.ui.keyCode.UP:var $prev=$el.prev('.o_export_tree_item');if($prev.length===1){while($prev.hasClass('show')){$prev=$prev.children('.o_export_tree_item').last();}}else{$prev=$el.parent('.o_export_tree_item');if($prev.length===0){break;}}
$el.removeClass('o_selected').blur();$prev.addClass("o_selected").focus();break;case $.ui.keyCode.DOWN:var $next;if($el.hasClass('show')){$next=$el.children('.o_export_tree_item').first();}else{$next=$el.next('.o_export_tree_item');if($next.length===0){$next=$el.parent('.o_export_tree_item').next('.o_export_tree_item');if($next.length===0){break;}}}
$el.removeClass('o_selected').blur();$next.addClass('o_selected').focus();break;}},_onSearchInput:function(ev){var searchText=$(ev.currentTarget).val().trim().toUpperCase();if(!searchText){this.$('.o_no_match').remove();this.$(".o_export_tree_item").show();this.$(".o_export_tree_item.haschild:not(.show) .o_export_tree_item").hide();return;}
var matchItems=this.$(".o_tree_column").filter(function(){var title=this.getAttribute('title');return this.innerText.toUpperCase().indexOf(searchText)>=0||title&&title.toUpperCase().indexOf(searchText)>=0;}).parent();this.$(".o_export_tree_item").hide();if(matchItems.length){this.$('.o_no_match').remove();_.each(matchItems,function(col){var $col=$(col);$col.show();$col.parents('.haschild.show').show();if(!$col.parent().hasClass('show')&&!$col.parent().hasClass('o_field_tree_structure')){$col.hide();}});}else if(!this.$('.o_no_match').length){this.$(".o_field_tree_structure").append($("<h3/>",{class:'text-center text-muted mt-5 o_no_match',text:_t("No match found.")}));}},});return DataExport;});;

/* /web/static/src/js/widgets/date_picker.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.datepicker',function(require){"use strict";var core=require('web.core');var field_utils=require('web.field_utils');var time=require('web.time');var Widget=require('web.Widget');var _t=core._t;var DateWidget=Widget.extend({template:"web.datepicker",type_of_date:"date",events:{'error.datetimepicker':'errorDatetime','change .o_datepicker_input':'changeDatetime','click input':'_onInputClicked','input input':'_onInput','keydown':'_onKeydown','show.datetimepicker':'_onDateTimePickerShow','hide.datetimepicker':'_onDateTimePickerHide',},init:function(parent,options){this._super.apply(this,arguments);this.name=parent.name;this.options=_.extend({locale:moment.locale(),format:this.type_of_date==='datetime'?time.getLangDatetimeFormat():time.getLangDateFormat(),minDate:moment({y:1}),maxDate:moment({y:9999,M:11,d:31}),useCurrent:false,icons:{time:'fa fa-clock-o',date:'fa fa-calendar',up:'fa fa-chevron-up',down:'fa fa-chevron-down',previous:'fa fa-chevron-left',next:'fa fa-chevron-right',today:'fa fa-calendar-check-o',clear:'fa fa-trash',close:'fa fa-check primary',},calendarWeeks:true,buttons:{showToday:false,showClear:false,showClose:false,},widgetParent:'body',keyBinds:null,},options||{});this.__libInput=0;this.__isOpen=false;},start:function(){this.$input=this.$('input.o_datepicker_input');this.__libInput++;this.$el.datetimepicker(this.options);this.__libInput--;this._setReadonly(false);},destroy:function(){if(this._onScroll){window.removeEventListener('wheel',this._onScroll,true);}
this.__libInput++;this.$el.datetimepicker('destroy');this.__libInput--;this._super.apply(this,arguments);},changeDatetime:function(){if(this.__libInput>0){if(this.options.warn_future){this._warnFuture(this.getValue());}
this.trigger("datetime_changed");return;}
var oldValue=this.getValue();if(this.isValid()){this._setValueFromUi();var newValue=this.getValue();var hasChanged=!oldValue!==!newValue;if(oldValue&&newValue){var formattedOldValue=oldValue.format(time.getLangDatetimeFormat());var formattedNewValue=newValue.format(time.getLangDatetimeFormat());if(formattedNewValue!==formattedOldValue){hasChanged=true;}}
if(hasChanged){if(this.options.warn_future){this._warnFuture(newValue);}
this.trigger("datetime_changed");}}else{var formattedValue=oldValue?this._formatClient(oldValue):null;this.$input.val(formattedValue);}},errorDatetime:function(e){return false;},focus:function(){this.__libInput++;this.$input.focus();this.__libInput--;},getValue:function(){var value=this.get('value');return value&&value.clone();},isValid:function(){var value=this.$input.val();if(value===""){return true;}else{try{this._parseClient(value);return true;}catch(e){return false;}}},maxDate:function(date){this.__libInput++;this.$el.datetimepicker('maxDate',date||null);this.__libInput--;},minDate:function(date){this.__libInput++;this.$el.datetimepicker('minDate',date||null);this.__libInput--;},setValue:function(value){this.set({'value':value});var formatted_value=value?this._formatClient(value):null;this.$input.val(formatted_value);this._setLibInputValue(value);},_warnFuture:function(currentDate){if(!this.$warning){this.$warning=$('<span>',{class:'fa fa-exclamation-triangle o_tz_warning o_datepicker_warning',});var title=_t("This date is in the future. Make sure this is what you expect.");this.$warning.attr('title',title);this.$input.after(this.$warning);}
if(currentDate&&currentDate.format('YYYY-MM-DD')>moment().format('YYYY-MM-DD')){this.$warning.show();}else{this.$warning.hide();}},_formatClient:function(v){return field_utils.format[this.type_of_date](v,null,{timezone:false});},_parseClient:function(v){return field_utils.parse[this.type_of_date](v,null,{timezone:false});},_setLibInputValue:function(value){this.__libInput++;this.$el.datetimepicker('date',value||null);this.__libInput--;},_setReadonly:function(readonly){this.readonly=readonly;this.$input.prop('readonly',this.readonly);},_setValueFromUi:function(){var value=this.$input.val()||false;this.setValue(this._parseClient(value));},_onDateTimePickerHide:function(){this.__isOpen=false;this.changeDatetime();if(this._onScroll){window.removeEventListener('wheel',this._onScroll,true);}
this.changeDatetime();},_onDateTimePickerShow:function(){this.__isOpen=true;if(this.$input.val().length!==0&&this.isValid()){this.$input.select();}
var self=this;this._onScroll=function(ev){if(ev.target!==self.$input.get(0)){self.__libInput++;self.$el.datetimepicker('hide');self.__libInput--;}};window.addEventListener('wheel',this._onScroll,true);},_onKeydown:function(ev){if(ev.which===$.ui.keyCode.ESCAPE){if(this.__isOpen){ev.stopImmediatePropagation();this.__libInput++;this.$el.datetimepicker('hide');this.__libInput--;this.focus();}}},_onInput:function(ev){if(this.__libInput>0){ev.stopImmediatePropagation();}},_onInputClicked:function(){this.__libInput++;this.$el.datetimepicker('toggle');this.__libInput--;this.focus();},});var DateTimeWidget=DateWidget.extend({type_of_date:"datetime",init:function(parent,options){this._super(parent,_.extend({buttons:{showToday:false,showClear:false,showClose:true,},},options||{}));},});return{DateWidget:DateWidget,DateTimeWidget:DateTimeWidget,};});;

/* /web/static/src/js/widgets/domain_selector_dialog.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("web.DomainSelectorDialog",function(require){"use strict";var core=require("web.core");var Dialog=require("web.Dialog");var DomainSelector=require("web.DomainSelector");var _t=core._t;return Dialog.extend({init:function(parent,model,domain,options){this.model=model;this.options=_.extend({readonly:true,debugMode:false,},options||{});var buttons;if(this.options.readonly){buttons=[{text:_t("Close"),close:true},];}else{buttons=[{text:_t("Save"),classes:"btn-primary",close:true,click:function(){this.trigger_up("domain_selected",{domain:this.domainSelector.getDomain()});}},{text:_t("Discard"),close:true},];}
this._super(parent,_.extend({},{title:_t("Domain"),buttons:buttons,},options||{}));this.domainSelector=new DomainSelector(this,model,domain,options);},start:function(){var self=this;this.opened().then(function(){self.$el.css('overflow','visible').closest('.modal-dialog').css('height','auto');});return Promise.all([this._super.apply(this,arguments),this.domainSelector.appendTo(this.$el)]);},});});;

/* /web/static/src/js/widgets/domain_selector.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("web.DomainSelector",function(require){"use strict";var core=require("web.core");var datepicker=require("web.datepicker");var Domain=require("web.Domain");var field_utils=require("web.field_utils");var ModelFieldSelector=require("web.ModelFieldSelector");var Widget=require("web.Widget");var _t=core._t;var _lt=core._lt;var operator_mapping={"=":"=","!=":_lt("is not ="),">":">","<":"<",">=":">=","<=":"<=","ilike":_lt("contains"),"not ilike":_lt("does not contain"),"in":_lt("in"),"not in":_lt("not in"),"child_of":_lt("child of"),"parent_of":_lt("parent of"),"like":"like","not like":"not like","=like":"=like","=ilike":"=ilike","set":_lt("is set"),"not set":_lt("is not set"),};var DomainNode=Widget.extend({events:{"click .o_domain_add_node_button":"_onAddButtonClick","click .o_domain_delete_node_button":"_onDeleteButtonClick","mouseenter button":"_onButtonEntered","mouseleave button":"_onButtonLeft",},init:function(parent,model,domain,options){this._super.apply(this,arguments);this.model=model;this.options=_.extend({readonly:true,operators:null,debugMode:false,},options||{});this.readonly=this.options.readonly;this.debug=this.options.debugMode;},isValid:function(){},getDomain:function(){},_onAddButtonClick:function(e){e.preventDefault();e.stopPropagation();this.trigger_up("add_node_clicked",{newBranch:!!$(e.currentTarget).data("branch"),child:this});},_onDeleteButtonClick:function(e){e.preventDefault();e.stopPropagation();this.trigger_up("delete_node_clicked",{child:this});},_onButtonEntered:function(e){e.preventDefault();e.stopPropagation();var $target=$(e.currentTarget);this.$el.toggleClass("o_hover_btns",$target.hasClass("o_domain_delete_node_button"));this.$el.toggleClass("o_hover_add_node",$target.hasClass("o_domain_add_node_button"));this.$el.toggleClass("o_hover_add_inset_node",!!$target.data("branch"));},_onButtonLeft:function(e){e.preventDefault();e.stopPropagation();this.$el.removeClass("o_hover_btns o_hover_add_node o_hover_add_inset_node");},});var DomainTree=DomainNode.extend({template:"DomainTree",events:_.extend({},DomainNode.prototype.events,{"click .o_domain_tree_operator_selector .dropdown-item":"_onOperatorChange",}),custom_events:{"add_node_clicked":"_onNodeAdditionAsk","delete_node_clicked":"_onNodeDeletionAsk",},init:function(parent,model,domain){this._super.apply(this,arguments);var parsedDomain=this._parseDomain(domain);if(parsedDomain){this._initialize(parsedDomain);}},start:function(){this._postRender();return Promise.all([this._super.apply(this,arguments),this._renderChildrenTo(this.$childrenContainer)]);},isValid:function(){for(var i=0;i<this.children.length;i++){var cValid=this.children[i].isValid();if(!cValid){return cValid;}}
return this._isValid;},getDomain:function(){var childDomains=[];var nbChildren=0;_.each(this.children,function(child){var childDomain=child.getDomain();if(childDomain.length){nbChildren++;childDomains=childDomains.concat(child.getDomain());}});var nbChildRequired=this.operator==="!"?1:2;var operators=_.times(nbChildren-nbChildRequired+1,_.constant(this.operator));return operators.concat(childDomains);},_addChild:function(domain,afterNode){var i=afterNode?_.indexOf(this.children,afterNode):this.children.length;if(i<0)return false;this.children.splice(i+1,0,instantiateNode(this,this.model,domain,this.options));this.trigger_up("domain_changed",{child:this});return true;},_addFlattenedChildren:function(domain){var node=instantiateNode(this,this.model,domain,this.options);if(node===null){return;}
if(!node.children||node.operator!==this.operator){this.children.push(node);return;}
_.each(node.children,(function(child){child.setParent(this);this.children.push(child);}).bind(this));node.destroy();},_changeOperator:function(operator,silent){this.operator=operator;if(!silent)this.trigger_up("domain_changed",{child:this});},_initialize:function(domain){this._isValid=true;this.operator=domain[0];this.children=[];if(domain.length<=1){return;}
var nbLeafsToFind=1;for(var i=1;i<domain.length;i++){if(domain[i]==="&"||domain[i]==="|"){nbLeafsToFind++;}else if(domain[i]!=="!"){nbLeafsToFind--;}
if(!nbLeafsToFind){var partLeft=domain.slice(1,i+1);var partRight=domain.slice(i+1);if(partLeft.length){this._addFlattenedChildren(partLeft);}
if(partRight.length){this._addFlattenedChildren(partRight);}
break;}}
this._isValid=(nbLeafsToFind===0);if(this.operator==="!"){this.children[0].noControlPanel=true;}},_postRender:function(){this.$childrenContainer=this.$("> .o_domain_node_children_container");},_removeChild:function(oldChild){var i=_.indexOf(this.children,oldChild);if(i<0)return false;this.children[i].destroy();this.children.splice(i,1);this.trigger_up("domain_changed",{child:this});return true;},_renderChildrenTo:function($to){var $div=$("<div/>");return Promise.all(_.map(this.children,(function(child){return child.appendTo($div);}).bind(this))).then((function(){_.each(this.children,function(child){child.$el.appendTo($to);});}).bind(this));},_parseDomain:function(domain){var parsedDomain=false;try{parsedDomain=Domain.prototype.stringToArray(domain);this.invalidDomain=false;}catch(err){this.invalidDomain=true;this.children=[];}
return parsedDomain;},_onOperatorChange:function(e){e.preventDefault();e.stopPropagation();this._changeOperator($(e.target).data("operator"));},_onNodeAdditionAsk:function(e){var domain=this.options.default||[["id","=",1]];if(e.data.newBranch){domain=[this.operator==="&"?"|":"&"].concat(domain).concat(domain);}
if(this._addChild(domain,e.data.child)){e.stopPropagation();}},_onNodeDeletionAsk:function(e){if(this._removeChild(e.data.child)){e.stopPropagation();}},});var DomainSelector=DomainTree.extend({template:"DomainSelector",events:_.extend({},DomainTree.prototype.events,{"click .o_domain_add_first_node_button":"_onAddFirstButtonClick","change .o_domain_debug_input":"_onDebugInputChange",}),custom_events:_.extend({},DomainTree.prototype.custom_events,{domain_changed:"_onDomainChange",}),start:function(){var self=this;return this._super.apply(this,arguments).then(function(){if(self.invalidDomain){var msg=_t("This domain is not supported.");self.$el.html(msg);}});},setDomain:function(domain){if(domain===Domain.prototype.arrayToString(this.getDomain())){return Promise.resolve();}
var parsedDomain=this._parseDomain(domain);if(parsedDomain){return this._redraw(parsedDomain);}},_initialize:function(domain){if(domain.length>1){Domain.prototype.normalizeArray(domain);}else{domain=["&"].concat(domain);}
return this._super(domain);},_postRender:function(){this._super.apply(this,arguments);this.$debugInput=this.$(".o_domain_debug_input");if(this.$debugInput.length){this.$debugInput.val(Domain.prototype.arrayToString(this.getDomain()));}
if(!this._isValid){this.do_warn(false,_t("Domain not supported"));}},_redraw:function(domain){var oldChildren=this.children.slice();this._initialize(domain||this.getDomain());return this._renderChildrenTo($("<div/>")).then((function(){_.each(oldChildren,function(child){child.destroy();});this.renderElement();this._postRender();_.each(this.children,(function(child){child.$el.appendTo(this.$childrenContainer);}).bind(this));}).bind(this));},_onAddFirstButtonClick:function(){this._addChild(this.options.default||[["id","=",1]]);},_onDebugInputChange:function(e){var domain;try{domain=Domain.prototype.stringToArray($(e.currentTarget).val());}catch(err){this.do_warn(_t("Syntax error"),_t("Domain not properly formed"));return;}
this._redraw(domain).then((function(){this.trigger_up("domain_changed",{child:this,alreadyRedrawn:true});}).bind(this));},_onDomainChange:function(e){if(!e.data.alreadyRedrawn){this._redraw();}},});var DomainLeaf=DomainNode.extend({template:"DomainLeaf",events:_.extend({},DomainNode.prototype.events,{"change .o_domain_leaf_operator_select":"_onOperatorSelectChange","change .o_domain_leaf_value_input":"_onValueInputChange","click .o_domain_leaf_value_add_tag_button":"on_add_tag","keyup .o_domain_leaf_value_tags input":"on_add_tag","click .o_domain_leaf_value_remove_tag_button":"on_remove_tag",}),custom_events:{"field_chain_changed":"_onFieldChainChange",},init:function(parent,model,domain,options){this._super.apply(this,arguments);var currentDomain=Domain.prototype.stringToArray(domain);this.chain=currentDomain[0][0];this.operator=currentDomain[0][1];this.value=currentDomain[0][2];this.operator_mapping=operator_mapping;},willStart:function(){var defs=[this._super.apply(this,arguments)];this.fieldSelector=new ModelFieldSelector(this,this.model,this.chain!==undefined?this.chain.toString().split("."):[],this.options);defs.push(this.fieldSelector.appendTo($("<div/>")).then((function(){var wDefs=[];if(!this.readonly){var selectedField=this.fieldSelector.getSelectedField()||{};this.operators=this._getOperatorsFromType(selectedField.type);if(_.contains(["child_of","parent_of","like","not like","=like","=ilike"],this.operator)){this.operators[this.operator]=operator_mapping[this.operator];}else if(!this.operators[this.operator]){this.operators[this.operator]="?";}
this.selectionChoices=null;if(selectedField.type==="boolean"){this.selectionChoices=[["1",_t("set (true)")],["0",_t("not set (false)")]];}else if(selectedField.type==="selection"){this.selectionChoices=selectedField.selection;}
this.displayValue=this.value;try{if(selectedField&&!selectedField.relation&&!_.isArray(this.value)){this.displayValue=field_utils.format[selectedField.type](this.value,selectedField);}}catch(err){}
this.displayOperator=this.operator;if(selectedField.type==="boolean"){this.displayValue=this.value?"1":"0";}else if((this.operator==="!="||this.operator==="=")&&this.value===false){this.displayOperator=this.operator==="!="?"set":"not set";}
if(_.contains(["date","datetime"],selectedField.type)){this.valueWidget=new(selectedField.type==="datetime"?datepicker.DateTimeWidget:datepicker.DateWidget)(this);wDefs.push(this.valueWidget.appendTo("<div/>").then((function(){this.valueWidget.$el.addClass("o_domain_leaf_value_input");this.valueWidget.setValue(moment(this.value));this.valueWidget.on("datetime_changed",this,function(){this._changeValue(this.valueWidget.getValue());});}).bind(this)));}
return Promise.all(wDefs);}}).bind(this)));return Promise.all(defs);},start:function(){this.fieldSelector.$el.prependTo(this.$("> .o_domain_leaf_info, > .o_domain_leaf_edition"));if(!this.readonly&&this.valueWidget){this.$(".o_domain_leaf_value_input").replaceWith(this.valueWidget.$el);}
return this._super.apply(this,arguments);},isValid:function(){return this.fieldSelector&&this.fieldSelector.isValid();},getDomain:function(){return[[this.chain,this.operator,this.value]];},_changeFieldChain:function(chain,silent){this.chain=chain.join(".");this.fieldSelector.setChain(chain).then((function(){if(!this.fieldSelector.isValid())return;var selectedField=this.fieldSelector.getSelectedField()||{};var operators=this._getOperatorsFromType(selectedField.type);if(operators[this.operator]===undefined){this._changeOperator("=",true);}
this._changeValue(this.value,true);if(!silent)this.trigger_up("domain_changed",{child:this});}).bind(this));},_changeOperator:function(operator,silent){this.operator=operator;if(_.contains(["set","not set"],this.operator)){this.operator=this.operator==="not set"?"=":"!=";this.value=false;}else if(_.contains(["in","not in"],this.operator)){this.value=_.isArray(this.value)?this.value:this.value?(""+this.value).split(","):[];}else{if(_.isArray(this.value)){this.value=this.value.join(",");}
this._changeValue(this.value,true);}
if(!silent)this.trigger_up("domain_changed",{child:this});},_changeValue:function(value,silent){var couldNotParse=false;var selectedField=this.fieldSelector.getSelectedField()||{};try{this.value=field_utils.parse[selectedField.type](value,selectedField);}catch(err){this.value=value;couldNotParse=true;}
if(selectedField.type==="boolean"){if(!_.isBoolean(this.value)){this.value=!!parseFloat(this.value);}}else if(selectedField.type==="selection"){if(!_.some(selectedField.selection,(function(option){return option[0]===this.value;}).bind(this))){this.value=selectedField.selection[0][0];}}else if(_.contains(["date","datetime"],selectedField.type)){if(couldNotParse||_.isBoolean(this.value)){this.value=field_utils.parse[selectedField.type](field_utils.format[selectedField.type](moment())).toJSON();}else{this.value=this.value.toJSON();}}else{if(_.isBoolean(this.value)){this.value="";}else if(_.isObject(this.value)&&!_.isArray(this.value)){this.value=this.value.id||value||"";}}
if(!silent)this.trigger_up("domain_changed",{child:this});},_getOperatorsFromType:function(type){var operators={};switch(type){case"boolean":operators={"=":_t("is"),"!=":_t("is not"),};break;case"char":case"text":case"html":operators=_.pick(operator_mapping,"=","!=","ilike","not ilike","set","not set","in","not in");break;case"many2many":case"one2many":case"many2one":operators=_.pick(operator_mapping,"=","!=","ilike","not ilike","set","not set");break;case"integer":case"float":case"monetary":operators=_.pick(operator_mapping,"=","!=",">","<",">=","<=","ilike","not ilike","set","not set");break;case"selection":operators=_.pick(operator_mapping,"=","!=","set","not set");break;case"date":case"datetime":operators=_.pick(operator_mapping,"=","!=",">","<",">=","<=","set","not set");break;default:operators=_.extend({},operator_mapping);break;}
if(this.options.operators){operators=_.pick.apply(_,[operators].concat(this.options.operators));}
return operators;},_onOperatorSelectChange:function(e){this._changeOperator($(e.currentTarget).val());},_onValueInputChange:function(e){if(e.currentTarget!==e.target)return;this._changeValue($(e.currentTarget).val());},_onFieldChainChange:function(e){this._changeFieldChain(e.data.chain);},on_add_tag:function(e){if(e.type==="keyup"&&e.which!==$.ui.keyCode.ENTER)return;if(!_.contains(["not in","in"],this.operator))return;var values=_.isArray(this.value)?this.value.slice():[];var $input=this.$(".o_domain_leaf_value_tags input");var val=$input.val().trim();if(val&&values.indexOf(val)<0){values.push(val);_.defer(this._changeValue.bind(this,values));$input.focus();}},on_remove_tag:function(e){var values=_.isArray(this.value)?this.value.slice():[];var val=this.$(e.currentTarget).data("value");var index=values.indexOf(val);if(index>=0){values.splice(index,1);_.defer(this._changeValue.bind(this,values));}},});function instantiateNode(parent,model,domain,options){if(domain.length>1){return new DomainTree(parent,model,domain,options);}else if(domain.length===1){return new DomainLeaf(parent,model,domain,options);}
return null;}
return DomainSelector;});;

/* /web/static/src/js/widgets/iframe_widget.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.IFrameWidget',function(require){"use strict";var Widget=require('web.Widget');var IFrameWidget=Widget.extend({tagName:'iframe',init:function(parent,url){this._super(parent);this.url=url;},start:function(){this.$el.css({height:'100%',width:'100%',border:0});this.$el.attr({src:this.url});this.$el.on("load",this._bindEvents.bind(this));return this._super();},_bindEvents:function(){this.$el.contents().click(this._onIFrameClicked.bind(this));},_onIFrameClicked:function(event){}});return IFrameWidget;});;

/* /web/static/src/js/chrome/loading.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.Loading',function(require){"use strict";var config=require('web.config');var core=require('web.core');var framework=require('web.framework');var Widget=require('web.Widget');var _t=core._t;var Loading=Widget.extend({template:"Loading",init:function(parent){this._super(parent);this.count=0;this.blocked_ui=false;},start:function(){core.bus.on('rpc_request',this,this.request_call);core.bus.on("rpc_response",this,this.response_call);core.bus.on("rpc_response_failed",this,this.response_call);},destroy:function(){this.on_rpc_event(-this.count);this._super();},request_call:function(){this.on_rpc_event(1);},response_call:function(){this.on_rpc_event(-1);},on_rpc_event:function(increment){var self=this;if(!this.count&&increment===1){this.long_running_timer=setTimeout(function(){self.blocked_ui=true;framework.blockUI();},3000);}
this.count+=increment;if(this.count>0){if(config.isDebug()){this.$el.text(_.str.sprintf(_t("Loading (%d)"),this.count));}else{this.$el.text(_t("Loading"));}
this.$el.show();this.getParent().$el.addClass('oe_wait');}else{this.count=0;clearTimeout(this.long_running_timer);if(self.blocked_ui){this.blocked_ui=false;framework.unblockUI();}
this.$el.fadeOut();this.getParent().$el.removeClass('oe_wait');}}});return Loading;});;

/* /web/static/src/js/widgets/model_field_selector.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("web.ModelFieldSelector",function(require){"use strict";var core=require("web.core");var Widget=require("web.Widget");var _t=core._t;var modelFieldsCache={cache:{},cacheDefs:{},};core.bus.on('clear_cache',null,function(){modelFieldsCache.cache={};modelFieldsCache.cacheDefs={};});var ModelFieldSelector=Widget.extend({template:"ModelFieldSelector",events:{},editionEvents:{"focusin":"_onFocusIn","focusout":"_onFocusOut","click .o_field_selector_close":"_onCloseClick","click .o_field_selector_prev_page":"_onPrevPageClick","click .o_field_selector_next_page":"_onNextPageClick","click li.o_field_selector_select_button":"_onLastFieldClick","change input.o_field_selector_debug":"_onDebugInputChange","keyup .o_field_selector_search > input":"_onSearchInputChange","mouseover li.o_field_selector_item":"_onItemHover","keydown":"_onKeydown",},init:function(parent,model,chain,options){this._super.apply(this,arguments);this.model=model;this.chain=chain;this.options=_.extend({order:'string',readonly:true,filters:{},fields:null,filter:function(){return true;},followRelations:true,debugMode:false,showSearchInput:true,},options||{});this.options.filters=_.extend({searchable:true,},this.options.filters);if(typeof this.options.followRelations!=='function'){this.options.followRelations=this.options.followRelations?function(){return true;}:function(){return false;};}
this.pages=[];this.dirty=false;if(!this.options.readonly){_.extend(this.events,this.editionEvents);}
this.searchValue='';},willStart:function(){return Promise.all([this._super.apply(this,arguments),this._prefill()]);},start:function(){this.$value=this.$(".o_field_selector_value");this.$popover=this.$(".o_field_selector_popover");this.$input=this.$popover.find(".o_field_selector_popover_footer > input");this.$searchInput=this.$popover.find(".o_field_selector_search > input");this.$valid=this.$(".o_field_selector_warning");this._render();return this._super.apply(this,arguments);},getSelectedField:function(){return _.findWhere(this.pages[this.chain.length-1],{name:_.last(this.chain)});},isValid:function(){return this.valid;},setChain:function(chain){if(_.isEqual(chain,this.chain)){return Promise.resolve();}
this.chain=chain;return this._prefill().then(this._render.bind(this));},_addChainNode:function(fieldName){this.dirty=true;this.chain=this.chain.slice(0,this.pages.length-1);this.chain.push(fieldName);this.searchValue='';this.$searchInput.val('');},_getLastPageField:function(name){return _.findWhere(_.last(this.pages),{name:name,});},_getModelFieldsFromCache:function(model,filters){var self=this;var def=modelFieldsCache.cacheDefs[model];if(!def){def=modelFieldsCache.cacheDefs[model]=this._rpc({model:model,method:'fields_get',args:[false,["store","searchable","type","string","relation","selection","related"]],context:this.getSession().user_context,}).then((function(fields){modelFieldsCache.cache[model]=sortFields(fields,model,self.options.order);}).bind(this));}
return def.then((function(){return _.filter(modelFieldsCache.cache[model],function(f){return(!filters.searchable||f.searchable)&&self.options.filter(f);});}).bind(this));},_goToNextPage:function(field){if(!_.isEqual(this._getLastPageField(field.name),field))return;this._validate(true);this._addChainNode(field.name);this._pushPageData(field.relation).then(this._render.bind(this));},_goToPrevPage:function(){if(this.pages.length<=0)return;this._validate(true);this._removeChainNode();if(this.pages.length>1){this.pages.pop();}
this._render();},_hidePopover:function(){if(!this._isOpen)return;this._isOpen=false;this.$popover.addClass('d-none');if(this.dirty){this.dirty=false;this.trigger_up("field_chain_changed",{chain:this.chain});}},_prefill:function(){this.pages=[];return this._pushPageData(this.model).then((function(){this._validate(true);return(this.chain.length?processChain.call(this,this.chain.slice().reverse()):Promise.resolve());}).bind(this));function processChain(chain){var fieldName=chain.pop();var field=this._getLastPageField(fieldName);if(field&&field.relation){if(chain.length){return this._pushPageData(field.relation).then(processChain.bind(this,chain));}else{return this._pushPageData(field.relation);}}else if(field&&chain.length===0){return Promise.resolve();}else if(!field&&fieldName==="1"){this._validate(true);}else if(!field&&fieldName==="0"){this._validate(true);}else{this._validate(false);}
return Promise.resolve();}},_pushPageData:function(model){var def;if(this.model===model&&this.options.fields){def=Promise.resolve(sortFields(this.options.fields,model,this.options.order));}else{def=this._getModelFieldsFromCache(model,this.options.filters);}
return def.then((function(fields){this.pages.push(fields);}).bind(this));},_removeChainNode:function(){this.dirty=true;this.chain=this.chain.slice(0,this.pages.length-1);this.chain.pop();},_render:function(){this.$value.html(core.qweb.render(this.template+".value",{chain:this.chain,pages:this.pages,}));this.$valid.toggleClass('d-none',!!this.isValid());var page=_.last(this.pages);var title="";if(this.pages.length>1){var prevField=_.findWhere(this.pages[this.pages.length-2],{name:(this.chain.length===this.pages.length)?this.chain[this.chain.length-2]:_.last(this.chain),});if(prevField)title=prevField.string;}
this.$(".o_field_selector_popover_header .o_field_selector_title").text(title);var lines=_.filter(page,this.options.filter);if(this.searchValue){var matches=fuzzy.filter(this.searchValue,_.pluck(lines,'string'));lines=_.map(_.pluck(matches,'index'),function(i){return lines[i];});}
this.$(".o_field_selector_page").replaceWith(core.qweb.render(this.template+".page",{lines:lines,followRelations:this.options.followRelations,debug:this.options.debugMode,}));this.$input.val(this.chain.join("."));},_selectField:function(field){if(!_.isEqual(this._getLastPageField(field.name),field))return;this._validate(true);this._addChainNode(field.name);this._render();this._hidePopover();},_showPopover:function(){if(this._isOpen)return;this._isOpen=true;this.$popover.removeClass('d-none');},_validate:function(valid){this.valid=!!valid;if(!this.valid){this.do_warn(false,_t("Invalid field chain. You may have used a non-existing field name or followed a non-relational field."));}},_onFocusIn:function(){clearTimeout(this._hidePopoverTimeout);this._showPopover();},_onFocusOut:function(){this._hidePopoverTimeout=_.defer(this._hidePopover.bind(this));},_onCloseClick:function(){this._hidePopover();},_onPrevPageClick:function(){this._goToPrevPage();},_onNextPageClick:function(e){e.stopPropagation();this._goToNextPage(this._getLastPageField($(e.currentTarget).data("name")));},_onLastFieldClick:function(e){this._selectField(this._getLastPageField($(e.currentTarget).data("name")));},_onDebugInputChange:function(){var userChainStr=this.$input.val();var userChain=userChainStr.split(".");if(!this.options.followRelations&&userChain.length>1){this.do_warn(_t("Relation not allowed"),_t("You cannot follow relations for this field chain construction"));userChain=[userChain[0]];}
this.setChain(userChain).then((function(){this.trigger_up("field_chain_changed",{chain:this.chain});}).bind(this));},_onSearchInputChange:function(){this.searchValue=this.$searchInput.val();this._render();},_onItemHover:function(e){this.$("li.o_field_selector_item").removeClass("active");$(e.currentTarget).addClass("active");},_onKeydown:function(e){if(!this.$popover.is(":visible"))return;var inputHasFocus=this.$input.is(":focus");var searchInputHasFocus=this.$searchInput.is(":focus");switch(e.which){case $.ui.keyCode.UP:case $.ui.keyCode.DOWN:e.preventDefault();var $active=this.$("li.o_field_selector_item.active");var $to=$active[e.which===$.ui.keyCode.DOWN?"next":"prev"](".o_field_selector_item");if($to.length){$active.removeClass("active");$to.addClass("active");this.$popover.focus();var $page=$to.closest(".o_field_selector_page");var full_height=$page.height();var el_position=$to.position().top;var el_height=$to.outerHeight();var current_scroll=$page.scrollTop();if(el_position<0){$page.scrollTop(current_scroll-el_height);}else if(full_height<el_position+el_height){$page.scrollTop(current_scroll+el_height);}}
break;case $.ui.keyCode.RIGHT:if(inputHasFocus)break;e.preventDefault();var name=this.$("li.o_field_selector_item.active").data("name");if(name){var field=this._getLastPageField(name);if(field.relation){this._goToNextPage(field);}}
break;case $.ui.keyCode.LEFT:if(inputHasFocus)break;e.preventDefault();this._goToPrevPage();break;case $.ui.keyCode.ESCAPE:e.stopPropagation();this._hidePopover();break;case $.ui.keyCode.ENTER:if(inputHasFocus||searchInputHasFocus)break;e.preventDefault();this._selectField(this._getLastPageField(this.$("li.o_field_selector_item.active").data("name")));break;}}});return ModelFieldSelector;function sortFields(fields,model,order){var array=_.chain(fields).pairs().sortBy(function(p){return p[1].string;});if(order!=='string'){array=array.sortBy(function(p){return p[1][order];});}
return array.map(function(p){return _.extend({name:p[0],model:model,},p[1]);}).value();}});;

/* /web/static/src/js/chrome/systray_menu.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.SystrayMenu',function(require){"use strict";var dom=require('web.dom');var Widget=require('web.Widget');var SystrayMenu=Widget.extend({init:function(parent){this._super(parent);this.items=[];this.widgets=[];},willStart:function(){var self=this;var proms=[];SystrayMenu.Items=_.sortBy(SystrayMenu.Items,function(item){return!_.isUndefined(item.prototype.sequence)?item.prototype.sequence:50;});SystrayMenu.Items.forEach(function(WidgetClass){var cur_systray_item=new WidgetClass(self);self.widgets.push(cur_systray_item);proms.push(cur_systray_item.appendTo($('<div>')));});return this._super.apply(this,arguments).then(function(){return Promise.all(proms);});},on_attach_callback(){this.widgets.filter(widget=>widget.on_attach_callback).forEach(widget=>widget.on_attach_callback());},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.widgets.forEach(function(widget){dom.prepend(self.$el,widget.$el);});});},});SystrayMenu.Items=[];return SystrayMenu;});;

/* /web/static/src/js/widgets/switch_company_menu.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.SwitchCompanyMenu',function(require){"use strict";var config=require('web.config');var core=require('web.core');var session=require('web.session');var SystrayMenu=require('web.SystrayMenu');var Widget=require('web.Widget');var _t=core._t;var SwitchCompanyMenu=Widget.extend({template:'SwitchCompanyMenu',events:{'click .dropdown-item[data-menu] div.log_into':'_onSwitchCompanyClick','keydown .dropdown-item[data-menu] div.log_into':'_onSwitchCompanyClick','click .dropdown-item[data-menu] div.toggle_company':'_onToggleCompanyClick','keydown .dropdown-item[data-menu] div.toggle_company':'_onToggleCompanyClick',},sequence:1,init:function(){this._super.apply(this,arguments);this.isMobile=config.device.isMobile;this._onSwitchCompanyClick=_.debounce(this._onSwitchCompanyClick,1500,true);},willStart:function(){var self=this;this.allowed_company_ids=String(session.user_context.allowed_company_ids).split(',').map(function(id){return parseInt(id);});this.user_companies=session.user_companies.allowed_companies;this.current_company=this.allowed_company_ids[0];this.current_company_name=_.find(session.user_companies.allowed_companies,function(company){return company[0]===self.current_company;})[1];return this._super.apply(this,arguments);},_onSwitchCompanyClick:function(ev){if(ev.type=='keydown'&&ev.which!=$.ui.keyCode.ENTER&&ev.which!=$.ui.keyCode.SPACE){return;}
ev.preventDefault();ev.stopPropagation();var dropdownItem=$(ev.currentTarget).parent();var dropdownMenu=dropdownItem.parent();var companyID=dropdownItem.data('company-id');var allowed_company_ids=this.allowed_company_ids;if(dropdownItem.find('.fa-square-o').length){if(this.allowed_company_ids.length===1){if(this.isMobile){dropdownMenu=dropdownMenu.parent();}
dropdownMenu.find('.fa-check-square').removeClass('fa-check-square').addClass('fa-square-o');dropdownItem.find('.fa-square-o').removeClass('fa-square-o').addClass('fa-check-square');allowed_company_ids=[companyID];}else{allowed_company_ids.push(companyID);dropdownItem.find('.fa-square-o').removeClass('fa-square-o').addClass('fa-check-square');}}
$(ev.currentTarget).attr('aria-pressed','true');session.setCompanies(companyID,allowed_company_ids);},_onToggleCompanyClick:function(ev){if(ev.type=='keydown'&&ev.which!=$.ui.keyCode.ENTER&&ev.which!=$.ui.keyCode.SPACE){return;}
ev.preventDefault();ev.stopPropagation();var dropdownItem=$(ev.currentTarget).parent();var companyID=dropdownItem.data('company-id');var allowed_company_ids=this.allowed_company_ids;var current_company_id=allowed_company_ids[0];if(dropdownItem.find('.fa-square-o').length){allowed_company_ids.push(companyID);dropdownItem.find('.fa-square-o').removeClass('fa-square-o').addClass('fa-check-square');$(ev.currentTarget).attr('aria-checked','true');}else{allowed_company_ids.splice(allowed_company_ids.indexOf(companyID),1);dropdownItem.find('.fa-check-square').addClass('fa-square-o').removeClass('fa-check-square');$(ev.currentTarget).attr('aria-checked','false');}
session.setCompanies(current_company_id,allowed_company_ids);},});if(session.display_switch_company_menu){SystrayMenu.Items.push(SwitchCompanyMenu);}
return SwitchCompanyMenu;});;

/* /web/static/src/js/chrome/user_menu.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.UserMenu',function(require){"use strict";var config=require('web.config');var core=require('web.core');var framework=require('web.framework');var Dialog=require('web.Dialog');var Widget=require('web.Widget');var _t=core._t;var QWeb=core.qweb;var UserMenu=Widget.extend({template:'UserMenu',start:function(){var self=this;var session=this.getSession();this.$el.on('click','[data-menu]',function(ev){ev.preventDefault();var menu=$(this).data('menu');self['_onMenu'+menu.charAt(0).toUpperCase()+menu.slice(1)]();});return this._super.apply(this,arguments).then(function(){var $avatar=self.$('.oe_topbar_avatar');if(!session.uid){$avatar.attr('src',$avatar.data('default-src'));return Promise.resolve();}
var topbar_name=session.name;if(config.isDebug()){topbar_name=_.str.sprintf("%s (%s)",topbar_name,session.db);}
self.$('.oe_topbar_name').text(topbar_name);var avatar_src=session.url('/web/image',{model:'res.users',field:'image_128',id:session.uid,});$avatar.attr('src',avatar_src);});},_onMenuAccount:function(){var self=this;this.trigger_up('clear_uncommitted_changes',{callback:function(){self._rpc({route:'/web/session/account'}).then(function(url){framework.redirect(url);}).guardedCatch(function(result,ev){ev.preventDefault();framework.redirect('https://accounts.odoo.com/account');});},});},_onMenuDocumentation:function(){window.open('https://www.odoo.com/documentation/user','_blank');},_onMenuLogout:function(){this.trigger_up('clear_uncommitted_changes',{callback:this.do_action.bind(this,'logout'),});},_onMenuSettings:function(){var self=this;var session=this.getSession();this.trigger_up('clear_uncommitted_changes',{callback:function(){self._rpc({model:"res.users",method:"action_get"}).then(function(result){result.res_id=session.uid;self.do_action(result);});},});},_onMenuSupport:function(){window.open('https://www.odoo.com/buy','_blank');},_onMenuShortcuts:function(){new Dialog(this,{size:'large',dialogClass:'o_act_window',title:_t("Keyboard Shortcuts"),$content:$(QWeb.render("UserMenu.shortcuts"))}).open();},});return UserMenu;});;

/* /web_enterprise/static/src/js/menu.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_enterprise.Menu',function(require){"use strict";var config=require('web.config');var core=require('web.core');var dom=require('web.dom');var Widget=require('web.Widget');var SystrayMenu=require('web.SystrayMenu');var UserMenu=require('web.UserMenu');UserMenu.prototype.sequence=0;SystrayMenu.Items.push(UserMenu);var QWeb=core.qweb;var Menu=Widget.extend({template:'Menu',menusTemplate:'Menu.sections',events:{'click .o_menu_toggle':'_onToggleHomeMenu','mouseover .o_menu_sections > li:not(.show)':'_onMouseOverMenu','click .o_menu_brand':'_onAppNameClicked',},init:function(parent,menu_data){var self=this;this._super.apply(this,arguments);this.homeMenuDisplayed=true;this.backbutton_displayed=false;this.$menu_sections={};this.menu_data=menu_data;var $menu_sections=$(QWeb.render(this.menusTemplate,{menu_data:this.menu_data,}));$menu_sections.filter('section').each(function(){self.$menu_sections[parseInt(this.className,10)]=$(this).children('li');});core.bus.on('change_menu_section',this,this.change_menu_section);},start:function(){var self=this;this.$menu_toggle=this.$('.o_menu_toggle');this.$menu_brand_placeholder=this.$('.o_menu_brand');this.$section_placeholder=this.$('.o_menu_sections');this._updateMenuBrand();var on_secondary_menu_click=function(ev){ev.preventDefault();var menu_id=$(ev.currentTarget).data('menu');var action_id=$(ev.currentTarget).data('action-id');self._on_secondary_menu_click(menu_id,action_id);};var menu_ids=_.keys(this.$menu_sections);var primary_menu_id,$section;for(var i=0;i<menu_ids.length;i++){primary_menu_id=menu_ids[i];$section=this.$menu_sections[primary_menu_id];$section.on('click','a[data-menu]',self,on_secondary_menu_click.bind(this));}
this.systray_menu=new SystrayMenu(this);var autoMoreMenu=this.systray_menu.attachTo(this.$('.o_menu_systray')).then(function(){dom.initAutoMoreMenu(self.$section_placeholder,{maxWidth:function(){return self.$el.width()-(self.$menu_toggle.outerWidth(true)+self.$menu_brand_placeholder.outerWidth(true)+self.systray_menu.$el.outerWidth(true));},});});return Promise.all([this._super.apply(this,arguments),autoMoreMenu]);},toggle_mode:function(home_menu,overapp){this.homeMenuDisplayed=!!home_menu;this.backbutton_displayed=this.homeMenuDisplayed&&!!overapp;this.$menu_toggle.toggleClass('fa-chevron-left',this.homeMenuDisplayed).toggleClass('fa-th',!this.homeMenuDisplayed);this.$menu_toggle.toggleClass('d-none',this.homeMenuDisplayed&&!this.backbutton_displayed);this.$menu_brand_placeholder.toggleClass('d-none',this.homeMenuDisplayed);this.$section_placeholder.toggleClass('d-none',this.homeMenuDisplayed);if(!home_menu){core.bus.trigger('resize');}},change_menu_section:function(primary_menu_id){if(!this.$menu_sections[primary_menu_id]){this._updateMenuBrand();return;}
if(this.current_primary_menu===primary_menu_id){return;}
if(this.current_primary_menu){this.$menu_sections[this.current_primary_menu].detach();}
for(var i=0;i<this.menu_data.children.length;i++){if(this.menu_data.children[i].id===primary_menu_id){this._updateMenuBrand(this.menu_data.children[i].name);break;}}
this.$menu_sections[primary_menu_id].appendTo(this.$section_placeholder);this.current_primary_menu=primary_menu_id;core.bus.trigger('resize');},on_attach_callback(){this.systray_menu.on_attach_callback();},_trigger_menu_clicked:function(menu_id,action_id){this.trigger_up('menu_clicked',{id:menu_id,action_id:action_id,previous_menu_id:this.current_secondary_menu||this.current_primary_menu,});},_updateMenuBrand:function(brandName){if(brandName){this.$menu_brand_placeholder.text(brandName).show();this.$section_placeholder.show();}else{this.$menu_brand_placeholder.hide()
this.$section_placeholder.hide();}},_on_secondary_menu_click:function(menu_id,action_id){var self=this;if(action_id){self._trigger_menu_clicked(menu_id,action_id);this.current_secondary_menu=menu_id;}},action_id_to_primary_menu_id:function(action_id){var primary_menu_id,found;for(var i=0;i<this.menu_data.children.length&&!primary_menu_id;i++){found=this._action_id_in_subtree(this.menu_data.children[i],action_id);if(found){primary_menu_id=this.menu_data.children[i].id;}}
return primary_menu_id;},_action_id_in_subtree:function(root,action_id){if(root.action&&root.action.split(',')[1]===String(action_id)){return true;}
var found;for(var i=0;i<root.children.length&&!found;i++){found=this._action_id_in_subtree(root.children[i],action_id);}
return found;},menu_id_to_action_id:function(menu_id,root){if(!root){root=$.extend(true,{},this.menu_data);}
if(root.id===menu_id){return root.action.split(',')[1];}
for(var i=0;i<root.children.length;i++){var action_id=this.menu_id_to_action_id(menu_id,root.children[i]);if(action_id!==undefined){return action_id;}}
return undefined;},getCurrentPrimaryMenu:function(){return this.current_primary_menu;},_onAppNameClicked:function(ev){ev.preventDefault();var actionID=this.menu_id_to_action_id(this.current_primary_menu);this._trigger_menu_clicked(this.current_primary_menu,actionID);},_onMouseOverMenu:function(ev){if(config.device.isMobile){return;}
var $target=$(ev.currentTarget);var $opened=$target.siblings('.show');if($opened.length){$opened.find('[data-toggle="dropdown"]:first').dropdown('toggle');$opened.removeClass('show');$target.find('[data-toggle="dropdown"]:first').dropdown('toggle');$target.addClass('show');}},_onToggleHomeMenu:function(ev){ev.preventDefault();this.trigger_up(this.homeMenuDisplayed?'hide_home_menu':'show_home_menu');this.$el.parent().removeClass('o_mobile_menu_opened');},});return Menu;});;

/* /web/static/src/js/chrome/apps_menu.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.AppsMenu',function(require){"use strict";var Widget=require('web.Widget');var AppsMenu=Widget.extend({template:'AppsMenu',events:{'click .o_app':'_onAppsMenuItemClicked',},init:function(parent,menuData){this._super.apply(this,arguments);this._activeApp=undefined;this._apps=_.map(menuData.children,function(appMenuData){return{actionID:parseInt(appMenuData.action.split(',')[1]),menuID:appMenuData.id,name:appMenuData.name,xmlID:appMenuData.xmlid,};});},getApps:function(){return this._apps;},openFirstApp:function(){if(!this._apps.length){return}
var firstApp=this._apps[0];this._openApp(firstApp);},_openApp:function(app){this._setActiveApp(app);this.trigger_up('app_clicked',{action_id:app.actionID,menu_id:app.menuID,});},_setActiveApp:function(app){var $oldActiveApp=this.$('.o_app.active');$oldActiveApp.removeClass('active');var $newActiveApp=this.$('.o_app[data-action-id="'+app.actionID+'"]');$newActiveApp.addClass('active');},_onAppsMenuItemClicked:function(ev){var $target=$(ev.currentTarget);var actionID=$target.data('action-id');var menuID=$target.data('menu-id');var app=_.findWhere(this._apps,{actionID:actionID,menuID:menuID});this._openApp(app);},});return AppsMenu;});;

/* /web/static/src/js/widgets/pie_chart.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.PieChart',function(require){"use strict";var core=require('web.core');var Domain=require('web.Domain');var viewRegistry=require('web.view_registry');var Widget=require('web.Widget');var widgetRegistry=require('web.widget_registry');var qweb=core.qweb;var PieChart=Widget.extend({className:'o_pie_chart',xmlDependencies:['/web/static/src/xml/chart.xml'],init:function(parent,record,node){this._super.apply(this,arguments);var modifiers=node.attrs.modifiers;var domain=record.domain.concat(Domain.prototype.stringToArray(modifiers.domain||'[]'));var arch=qweb.render('web.PieChart',{modifiers:modifiers,title:node.attrs.title||modifiers.title||modifiers.measure,});var pieChartContext=JSON.parse(JSON.stringify(record.context));delete pieChartContext.graph_mode;delete pieChartContext.graph_measure;delete pieChartContext.graph_groupbys;this.subViewParams={modelName:record.model,withButtons:false,withControlPanel:false,withSearchPanel:false,isEmbedded:true,useSampleModel:record.isSample,mode:'pie',};this.subViewParams.searchQuery={context:pieChartContext,domain:domain,groupBy:[],timeRanges:{},};this.viewInfo={arch:arch,fields:record.fields,viewFields:record.fieldsInfo.dashboard,};},willStart:function(){var self=this;var def1=this._super.apply(this,arguments);var SubView=viewRegistry.get('graph');var subView=new SubView(this.viewInfo,this.subViewParams);var def2=subView.getController(this).then(function(controller){self.controller=controller;return self.controller.appendTo(document.createDocumentFragment());});return Promise.all([def1,def2]);},start:function(){this.$el.append(this.controller.$el);return this._super.apply(this,arguments);},on_attach_callback:function(){this.controller.on_attach_callback();},});widgetRegistry.add('pie_chart',PieChart);return PieChart;});;

/* /web/static/src/js/widgets/ribbon.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.ribbon',function(require){'use strict';var widgetRegistry=require('web.widget_registry');var Widget=require('web.Widget');var RibbonWidget=Widget.extend({template:'web.ribbon',xmlDependencies:['/web/static/src/xml/ribbon.xml'],init:function(parent,data,options){this._super.apply(this,arguments);this.text=options.attrs.title||options.attrs.text;this.tooltip=options.attrs.tooltip;this.className=options.attrs.bg_color?options.attrs.bg_color:'bg-success';if(this.text.length>15){this.className+=' o_small';}else if(this.text.length>10){this.className+=' o_medium';}},});widgetRegistry.add('web_ribbon',RibbonWidget);return RibbonWidget;});;

/* /web/static/src/js/widgets/signature.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.signature_widget',function(require){"use strict";const framework=require('web.framework');const SignatureDialog=require('web.signature_dialog');const widgetRegistry=require('web.widget_registry');const Widget=require('web.Widget');const WidgetSignature=Widget.extend({custom_events:Object.assign({},Widget.prototype.custom_events,{upload_signature:'_onUploadSignature',}),events:Object.assign({},Widget.prototype.events,{'click .o_sign_label':'_onClickSignature',}),template:'SignButton',init:function(parent,record,nodeInfo){this._super.apply(this,arguments);this.res_id=record.res_id;this.res_model=record.model;this.state=record;this.node=nodeInfo;this.signature_field=this.node.attrs.signature_field||'signature';},_onClickSignature:function(){const nameAndSignatureOptions={displaySignatureRatio:3,mode:'draw',noInputName:true,signatureType:'signature',};if(this.node.attrs.full_name){let signName;const fieldFullName=this.state.data[this.node.attrs.full_name];if(fieldFullName&&fieldFullName.type==='record'){signName=fieldFullName.data.display_name;}else{signName=fieldFullName;}
nameAndSignatureOptions.defaultName=signName||undefined;}
nameAndSignatureOptions.defaultFont=this.node.attrs.default_font||'';this.signDialog=new SignatureDialog(this,{nameAndSignatureOptions:nameAndSignatureOptions,});this.signDialog.open();},_onUploadSignature:function(ev){const file=ev.data.signatureImage[1];const always=()=>{this.trigger_up('reload');framework.unblockUI();};framework.blockUI();const rpcProm=this._rpc({model:this.res_model,method:'write',args:[[this.res_id],{[this.signature_field]:file,}],});rpcProm.then(always).guardedCatch(always);return rpcProm;},});widgetRegistry.add('signature',WidgetSignature);});;

/* /web/static/src/js/components/action_menus.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.ActionMenus',function(require){"use strict";const Context=require('web.Context');const DropdownMenu=require('web.DropdownMenu');const Registry=require('web.Registry');const{Component}=owl;let registryActionId=1;class ActionMenus extends Component{async willStart(){this.actionItems=await this._setActionItems(this.props);this.printItems=await this._setPrintItems(this.props);}
async willUpdateProps(nextProps){this.actionItems=await this._setActionItems(nextProps);this.printItems=await this._setPrintItems(nextProps);}
mounted(){this._addTooltips();}
patched(){this._addTooltips();}
_addTooltips(){$(this.el.querySelectorAll('[title]')).tooltip({delay:{show:500,hide:0}});}
async _setActionItems(props){const callbackActions=(props.items.other||[]).map(action=>Object.assign({key:`action-${action.description}`},action));const actionActions=props.items.action||[];const relateActions=props.items.relate||[];const formattedActions=[...actionActions,...relateActions].map(action=>({action,description:action.name,key:action.id}));const registryActions=[];const rpc=this.rpc.bind(this);for(const{Component,getProps}of this.constructor.registry.values()){const itemProps=await getProps(props,this.env,rpc);if(itemProps){registryActions.push({Component,key:`registry-action-${registryActionId++}`,props:itemProps,});}}
return[...callbackActions,...formattedActions,...registryActions];}
async _setPrintItems(props){const printActions=props.items.print||[];const printItems=printActions.map(action=>({action,description:action.name,key:action.id}));return printItems;}
async _executeAction(action){let activeIds=this.props.activeIds;if(this.props.isDomainSelected){activeIds=await this.rpc({model:this.env.action.res_model,method:'search',args:[this.props.domain],kwargs:{limit:this.env.session.active_ids_limit,},});}
const activeIdsContext={active_id:activeIds[0],active_ids:activeIds,active_model:this.env.action.res_model,};if(this.props.domain){activeIdsContext.active_domain=this.props.domain;}
const context=new Context(this.props.context,activeIdsContext).eval();const result=await this.rpc({route:'/web/action/load',params:{action_id:action.id,context},});result.context=new Context(result.context||{},activeIdsContext).set_eval_context(context);result.flags=result.flags||{};result.flags.new_window=true;this.trigger('do-action',{action:result,options:{on_close:()=>this.trigger('reload'),},});}
_onItemSelected(ev){ev.stopPropagation();const{item}=ev.detail;if(item.callback){item.callback([item]);}else if(item.action){this._executeAction(item.action);}else if(item.url){this.env.services.navigate(item.url);}}}
ActionMenus.registry=new Registry();ActionMenus.components={DropdownMenu};ActionMenus.props={activeIds:{type:Array,element:[Number,String]},context:Object,domain:{type:Array,optional:1},isDomainSelected:{type:Boolean,optional:1},items:{type:Object,shape:{action:{type:Array,optional:1},print:{type:Array,optional:1},other:{type:Array,optional:1},},},};ActionMenus.template='web.ActionMenus';return ActionMenus;});;

/* /web/static/src/js/components/dropdown_menu.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.DropdownMenu',function(require){"use strict";const DropdownMenuItem=require('web.DropdownMenuItem');const{Component,hooks}=owl;const{useExternalListener,useRef,useState}=hooks;class DropdownMenu extends Component{constructor(){super(...arguments);this.dropdownMenu=useRef('dropdown');this.state=useState({open:false});useExternalListener(window,'click',this._onWindowClick,true);useExternalListener(window,'keydown',this._onWindowKeydown);}
get displayCaret(){return false;}
get displayChevron(){return this.env.device.isMobile;}
get icon(){return this.props.icon;}
get items(){return this.props.items;}
get title(){return this.props.title;}
_onButtonKeydown(ev){switch(ev.key){case'ArrowLeft':case'ArrowRight':case'ArrowUp':case'ArrowDown':const firstItem=this.el.querySelector('.dropdown-item');if(firstItem){ev.preventDefault();firstItem.focus();}}}
_onItemSelected(){if(this.props.closeOnSelected){this.state.open=false;}}
_onWindowClick(ev){if(this.state.open&&!this.el.contains(ev.target)&&!this.el.contains(document.activeElement)){if(document.body.classList.contains("modal-open")){const modal=document.querySelector('.modal:not(.o_inactive_modal)');if(!modal.contains(this.el)){return;}}
if(document.querySelector('body > .bootstrap-datetimepicker-widget')){return;}
this.state.open=false;}}
_onWindowKeydown(ev){if(this.state.open&&ev.key==='Escape'){this.state.open=false;}}}
DropdownMenu.components={DropdownMenuItem};DropdownMenu.defaultProps={items:[]};DropdownMenu.props={icon:{type:String,optional:1},items:{type:Array,element:Object,optional:1,},title:{type:String,optional:1},closeOnSelected:{type:Boolean,optional:1},};DropdownMenu.template='web.DropdownMenu';return DropdownMenu;});;

/* /web/static/src/js/components/dropdown_menu_item.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.DropdownMenuItem',function(require){"use strict";const{useListener}=require('web.custom_hooks');const{Component,hooks}=owl;const{useExternalListener,useRef,useState}=hooks;class DropdownMenuItem extends Component{constructor(){super(...arguments);this.canBeOpened=Boolean(this.props.options&&this.props.options.length);this.fallbackFocusRef=useRef('fallback-focus');this.state=useState({open:false});useExternalListener(window,'click',this._onWindowClick);useListener('keydown',this._onKeydown);}
_onKeydown(ev){if(['INPUT','TEXTAREA'].includes(document.activeElement.tagName)){return;}
switch(ev.key){case'ArrowLeft':if(this.canBeOpened&&this.state.open){ev.preventDefault();if(this.fallbackFocusRef.el){this.fallbackFocusRef.el.focus();}
this.state.open=false;}
break;case'ArrowRight':if(this.canBeOpened&&!this.state.open){ev.preventDefault();this.state.open=true;}
break;case'Escape':ev.target.blur();if(this.canBeOpened&&this.state.open){ev.preventDefault();ev.stopPropagation();if(this.fallbackFocusRef.el){this.fallbackFocusRef.el.focus();}
this.state.open=false;}}}
_onWindowClick(ev){if(this.state.open&&!this.el.contains(ev.target)&&!this.el.contains(document.activeElement)){this.state.open=false;}}}
DropdownMenuItem.template='web.DropdownMenuItem';return DropdownMenuItem;});;

/* /web/static/src/js/components/custom_checkbox.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.CustomCheckbox',function(require){"use strict";const utils=require('web.utils');const{Component}=owl;class CustomCheckbox extends Component{constructor(){super(...arguments);this._id=`checkbox-comp-${utils.generateID()}`;}}
CustomCheckbox.props={id:{type:[String,Number],optional:1,},disabled:{type:Boolean,optional:1,},value:{type:Boolean,optional:1,},text:{type:String,optional:1,},};CustomCheckbox.template='web.CustomCheckbox';return CustomCheckbox;});;

/* /web/static/src/js/components/custom_file_input.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.CustomFileInput',function(require){"use strict";const{Component,hooks}=owl;const{useRef}=hooks;class CustomFileInput extends Component{constructor(){super(...arguments);this.fileInputRef=useRef('file-input');}
async _onFileInputChange(){const{action,model,id}=this.props;const params={csrf_token:odoo.csrf_token,ufile:[...this.fileInputRef.el.files],};if(model){params.model=model;}
if(id){params.id=id;}
const fileData=await this.env.services.httpRequest(action,params,'text');const parsedFileData=JSON.parse(fileData);if(parsedFileData.error){throw new Error(parsedFileData.error);}
this.trigger('uploaded',{files:parsedFileData});}
_onTriggerClicked(){this.fileInputRef.el.click();}}
CustomFileInput.defaultProps={accepted_file_extensions:'*',action:'/web/binary/upload',multi_upload:false,};CustomFileInput.props={accepted_file_extensions:{type:String,optional:1},action:{type:String,optional:1},id:{type:Number,optional:1},model:{type:String,optional:1},multi_upload:{type:Boolean,optional:1},};CustomFileInput.template='web.CustomFileInput';return CustomFileInput;});;

/* /web/static/src/js/components/datepicker.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.DatePickerOwl',function(require){"use strict";const field_utils=require('web.field_utils');const time=require('web.time');const{useAutofocus}=require('web.custom_hooks');const{Component,hooks}=owl;const{useExternalListener,useRef,useState}=hooks;let datePickerId=0;class DatePicker extends Component{constructor(){super(...arguments);this.inputRef=useRef('input');this.state=useState({warning:false});this.datePickerId=`o_datepicker_${datePickerId++}`;this.typeOfDate='date';useAutofocus();useExternalListener(window,'scroll',this._onWindowScroll);}
mounted(){$(this.el).on('show.datetimepicker',this._onDateTimePickerShow.bind(this));$(this.el).on('hide.datetimepicker',this._onDateTimePickerHide.bind(this));$(this.el).on('error.datetimepicker',()=>false);const pickerOptions=Object.assign({format:this.defaultFormat},this.props);this._datetimepicker(pickerOptions);this.inputRef.el.value=this._formatDate(this.props.date);}
willUnmount(){this._datetimepicker('destroy');}
willUpdateProps(nextProps){for(const prop in nextProps){this._datetimepicker(prop,nextProps[prop]);}
if(nextProps.date){this.inputRef.el.value=this._formatDate(nextProps.date);}}
get defaultFormat(){return time.getLangDateFormat();}
_datetimepicker(...args){$(this.el).datetimepicker(...args);}
_formatDate(date){try{return field_utils.format[this.typeOfDate](date,null,{timezone:false});}catch(err){return false;}}
_parseInput(inputValue){try{return field_utils.parse[this.typeOfDate](inputValue,null,{timezone:false});}catch(err){return false;}}
_onDateTimePickerHide(){const date=this._parseInput(this.inputRef.el.value);this.state.warning=date.format('YYYY-MM-DD')>moment().format('YYYY-MM-DD');this.trigger('datetime-changed',{date});}
_onDateTimePickerShow(){this.inputRef.el.select();}
_onInputClick(){this._datetimepicker('toggle');}
_onInputChange(){const date=this._parseInput(this.inputRef.el.value);if(date){this.state.warning=date.format('YYYY-MM-DD')>moment().format('YYYY-MM-DD');this.trigger('datetime-changed',{date});}else{this.inputRef.el.value=this._formatDate(this.props.date);}}
_onWindowScroll(ev){if(ev.target!==this.inputRef.el){this._datetimepicker('hide');}}}
DatePicker.defaultProps={calendarWeeks:true,icons:{clear:'fa fa-delete',close:'fa fa-check primary',date:'fa fa-calendar',down:'fa fa-chevron-down',next:'fa fa-chevron-right',previous:'fa fa-chevron-left',time:'fa fa-clock-o',today:'fa fa-calendar-check-o',up:'fa fa-chevron-up',},locale:moment.locale(),maxDate:moment({y:9999,M:11,d:31}),minDate:moment({y:1}),useCurrent:false,widgetParent:'body',};DatePicker.props={date:moment,buttons:{type:Object,shape:{showClear:Boolean,showClose:Boolean,showToday:Boolean,},optional:1,},calendarWeeks:Boolean,format:{type:String,optional:1},icons:{type:Object,shape:{clear:String,close:String,date:String,down:String,next:String,previous:String,time:String,today:String,up:String,},},keyBinds:{validate:kb=>typeof kb==='object'||kb===null,optional:1},locale:String,maxDate:moment,minDate:moment,readonly:{type:Boolean,optional:1},useCurrent:Boolean,widgetParent:String,};DatePicker.template='web.DatePicker';class DateTimePicker extends DatePicker{constructor(){super(...arguments);this.typeOfDate='datetime';}
get defaultFormat(){return time.getLangDatetimeFormat();}}
DateTimePicker.defaultProps=Object.assign({},DatePicker.defaultProps,{buttons:{showClear:false,showClose:true,showToday:false,},});return{DatePicker,DateTimePicker,};});;

/* /web/static/src/js/components/pager.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.Pager',function(require){"use strict";const{useAutofocus}=require('web.custom_hooks');const{Component,hooks}=owl;const{useState}=hooks;class Pager extends Component{constructor(){super(...arguments);this.state=useState({disabled:false,editing:false,});useAutofocus();}
async willUpdateProps(){this.state.editing=false;this.state.disabled=false;}
get maximum(){return Math.min(this.props.currentMinimum+this.props.limit-1,this.props.size);}
get singlePage(){return(1===this.props.currentMinimum)&&(this.maximum===this.props.size);}
get value(){return this.props.currentMinimum+(this.props.limit>1?`-${this.maximum}`:'');}
async _changeSelection(direction){try{await this.props.validate();}catch(err){return;}
const{limit,size}=this.props;let currentMinimum=(this.props.currentMinimum+limit*direction);if(currentMinimum>size){currentMinimum=1;}else if((currentMinimum<1)&&(limit===1)){currentMinimum=size;}else if((currentMinimum<1)&&(limit>1)){currentMinimum=size-((size%limit)||limit)+1;}
this._updateAndDisable(currentMinimum,limit);}
async _saveValue(value){try{await this.props.validate();}catch(err){return;}
const[min,max]=value.trim().split(/\s*[\-\s,;]\s*/);let currentMinimum=Math.max(Math.min(parseInt(min,10),this.props.size),1);let maximum=max?Math.max(Math.min(parseInt(max,10),this.props.size),1):min;if(!isNaN(currentMinimum)&&!isNaN(maximum)&&currentMinimum<=maximum){const limit=Math.max(maximum-currentMinimum)+1;this._updateAndDisable(currentMinimum,limit);}}
_updateAndDisable(currentMinimum,limit){if(currentMinimum!==this.props.currentMinimum||limit!==this.props.limit){this.state.disabled=true;}else{this.state.editing=false;}
this.trigger('pager-changed',{currentMinimum,limit});}
_onEdit(){if(this.props.editable&&!this.state.editing&&!this.state.disabled){this.state.editing=true;}}
_onValueChange(ev){this._saveValue(ev.currentTarget.value);if(!this.state.disabled){ev.preventDefault();}}
_onValueKeydown(ev){switch(ev.key){case'Enter':ev.preventDefault();ev.stopPropagation();this._saveValue(ev.currentTarget.value);break;case'Escape':ev.preventDefault();ev.stopPropagation();this.state.editing=false;break;}}}
Pager.defaultProps={editable:true,validate:async()=>{},withAccessKey:true,};Pager.props={currentMinimum:{type:Number,optional:1},editable:Boolean,limit:{validate:l=>!isNaN(l),optional:1},size:{type:Number,optional:1},validate:Function,withAccessKey:Boolean,};Pager.template='web.Pager';return Pager;});;

/* /web/static/src/js/apps.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.Apps',function(require){"use strict";var AbstractAction=require('web.AbstractAction');var config=require('web.config');var core=require('web.core');var framework=require('web.framework');var session=require('web.session');var _t=core._t;var apps_client=null;var Apps=AbstractAction.extend({contentTemplate:'EmptyComponent',remote_action_tag:'loempia.embed',failback_action_id:'base.open_module_tree',init:function(parent,action){this._super(parent,action);var options=action.params||{};this.params=options;},get_client:function(){var check_client_available=function(client){var i=new Image();var def=new Promise(function(resolve,reject){i.onerror=function(){reject(client);};i.onload=function(){resolve(client);};});var ts=new Date().getTime();i.src=_.str.sprintf('%s/web/static/src/img/sep-a.gif?%s',client.origin,ts);return def;};if(apps_client){return check_client_available(apps_client);}else{return this._rpc({model:'ir.module.module',method:'get_apps_server'}).then(function(u){var link=$(_.str.sprintf('<a href="%s"></a>',u))[0];var host=_.str.sprintf('%s//%s',link.protocol,link.host);var dbname=link.pathname;if(dbname[0]==='/'){dbname=dbname.substr(1);}
var client={origin:host,dbname:dbname};apps_client=client;return check_client_available(client);});}},destroy:function(){$(window).off("message."+this.uniq);if(this.$ifr){this.$ifr.remove();this.$ifr=null;}
return this._super();},_on_message:function($e){var self=this,client=this.client,e=$e.originalEvent;if(e.origin!==client.origin){return;}
var dispatcher={'event':function(m){self.trigger('message:'+m.event,m);},'action':function(m){self.do_action(m.action).then(function(r){var w=self.$ifr[0].contentWindow;w.postMessage({id:m.id,result:r},client.origin);});},'rpc':function(m){return self._rpc({route:m.args[0],params:m.args[1]}).then(function(r){var w=self.$ifr[0].contentWindow;w.postMessage({id:m.id,result:r},client.origin);});},'Model':function(m){return self._rpc({model:m.model,method:m.args[0],args:m.args[1]}).then(function(r){var w=self.$ifr[0].contentWindow;w.postMessage({id:m.id,result:r},client.origin);});},};if(!_.isObject(e.data)){return;}
if(dispatcher[e.data.type]){dispatcher[e.data.type](e.data);}},start:function(){var self=this;return new Promise(function(resolve,reject){self.get_client().then(function(client){self.client=client;var qs={db:client.dbname};if(config.isDebug()){qs.debug=odoo.debug;}
var u=$.param.querystring(client.origin+"/apps/embed/client",qs);var css={width:'100%',height:'750px'};self.$ifr=$('<iframe>').attr('src',u);self.uniq=_.uniqueId('apps');$(window).on("message."+self.uniq,self.proxy('_on_message'));self.on('message:ready',self,function(m){var w=this.$ifr[0].contentWindow;var act={type:'ir.actions.client',tag:this.remote_action_tag,params:_.extend({},this.params,{db:session.db,origin:session.origin,})};w.postMessage({type:'action',action:act},client.origin);});self.on('message:set_height',self,function(m){this.$ifr.height(m.height);});self.on('message:blockUI',self,function(){framework.blockUI();});self.on('message:unblockUI',self,function(){framework.unblockUI();});self.on('message:warn',self,function(m){self.do_warn(m.title,m.message,m.sticky);});self.$ifr.appendTo(self.$('.o_content')).css(css).addClass('apps-client');resolve();},function(){self.do_warn(_t('Odoo Apps will be available soon'),_t('Showing locally available modules'),true);return self._rpc({route:'/web/action/load',params:{action_id:self.failback_action_id},}).then(function(action){return self.do_action(action);}).then(reject,reject);});});}});var AppsUpdates=Apps.extend({remote_action_tag:'loempia.embed.updates',});core.action_registry.add("apps",Apps);core.action_registry.add("apps.updates",AppsUpdates);return Apps;});;

/* /web/static/src/js/_deprecated/basic_fields.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.basic_fields.deprecated',function(require){"use strict";var AbstractField=require('web.AbstractField');var core=require('web.core');var _lt=core._lt;var FieldBoolean=AbstractField.extend({className:'o_field_boolean',description:_lt("Checkbox"),events:_.extend({},AbstractField.prototype.events,{change:'_onChange',}),supportedFieldTypes:['boolean'],activate:function(options){var activated=this._super.apply(this,arguments);if(activated&&options&&options.event&&$(options.event.target).closest('.custom-control.custom-checkbox').length){this._setValue(!this.value);}
return activated;},getFocusableElement:function(){return this.mode==='readonly'?$():this.$input;},isSet:function(){return true;},reset:function(record,event){var rendered=this._super.apply(this,arguments);if(event&&event.target.name===this.name){this.activate();}
return rendered;},setIDForLabel:function(id){this._super.apply(this,arguments);this.$('.custom-control-label').attr('for',id);},_render:function(){var $checkbox=this._formatValue(this.value);this.$input=$checkbox.find('input');this.$input.prop('disabled',this.mode==='readonly');this.$el.addClass($checkbox.attr('class'));this.$el.empty().append($checkbox.contents());},_onChange:function(){this._setValue(this.$input[0].checked);},_onKeydown:function(ev){switch(ev.which){case $.ui.keyCode.ENTER:ev.preventDefault();this.$input.prop('checked',!this.value);this._setValue(!this.value);return;case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:ev.preventDefault();}
this._super.apply(this,arguments);},});return{FieldBoolean:FieldBoolean,};});;

/* /web/static/src/js/fields/abstract_field.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.AbstractField',function(require){"use strict";var field_utils=require('web.field_utils');var Widget=require('web.Widget');var AbstractField=Widget.extend({events:{'keydown':'_onKeydown',},custom_events:{navigation_move:'_onNavigationMove',},fieldDependencies:{},resetOnAnyFieldChange:false,specialData:false,supportedFieldTypes:[],description:"",noLabel:false,label:'',init:function(parent,name,record,options){this._super(parent);options=options||{};this.name=name;this.record=record;this.field=record.fields[name];this.viewType=options.viewType||'default';var fieldsInfo=record.fieldsInfo[this.viewType];this.attrs=options.attrs||(fieldsInfo&&fieldsInfo[name])||{};this.additionalContext=options.additionalContext||{};this.value=record.data[name];this.recordData=record.data;this.string=this.attrs.string||this.field.string||this.name;this.nodeOptions=this.attrs.options||{};this.dataPointID=record.id;this.res_id=record.res_id;this.model=record.model;this.mode=options.mode||"readonly";this._isValid=true;this.lastSetValue=undefined;this.formatType=this.attrs.widget in field_utils.format?this.attrs.widget:this.field.type;this.formatOptions={};this.parseOptions={};if(this.attrs.decorations){this.resetOnAnyFieldChange=true;}},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.$el.attr('name',self.name);self.$el.addClass('o_field_widget');return self._render();});},activate:function(options){if(this.isFocusable()){var $focusable=this.getFocusableElement();$focusable.focus();if($focusable.is('input[type="text"], textarea')){$focusable[0].selectionStart=$focusable[0].selectionEnd=$focusable[0].value.length;if(options&&!options.noselect){$focusable.select();}}
return true;}
return false;},commitChanges:function(){},getFocusableElement:function(){return $();},isEmpty:function(){return!this.isSet();},isFocusable:function(){var $focusable=this.getFocusableElement();return $focusable.length&&$focusable.is(':visible');},isSet:function(){return!!this.value;},isValid:function(){return this._isValid;},reset:function(record,event){this._reset(record,event);return this._render()||Promise.resolve();},removeInvalidClass:function(){this.$el.removeClass('o_field_invalid');this.$el.removeAttr('aria-invalid');},setIDForLabel:function(id){this.getFocusableElement().attr('id',id);},setInvalidClass:function(){this.$el.addClass('o_field_invalid');this.$el.attr('aria-invalid','true');},updateModifiersValue:function(modifiers){this.attrs.modifiersValue=modifiers||{};},_applyDecorations:function(){var self=this;this.attrs.decorations.forEach(function(dec){var isToggled=py.PY_isTrue(py.evaluate(dec.expression,self.record.evalContext));const className=self._getClassFromDecoration(dec.name);self.$el.toggleClass(className,isToggled);});},_formatValue:function(value,formatType){var options=_.extend({},this.nodeOptions,{data:this.recordData},this.formatOptions);return field_utils.format[formatType||this.formatType](value,this.field,options);},_getClassFromDecoration:function(decoration){return`text-${decoration.split('-')[1]}`;},_isLastSetValue:function(value){return this.lastSetValue===value||(this.value===false&&value==='');},_isSameValue:function(value){return this.value===value;},_parseValue:function(value){return field_utils.parse[this.formatType](value,this.field,this.parseOptions);},_render:function(){if(this.attrs.decorations){this._applyDecorations();}
if(this.mode==='edit'){return this._renderEdit();}else if(this.mode==='readonly'){return this._renderReadonly();}},_renderEdit:function(){},_renderReadonly:function(){},_reset:function(record,event){this.lastSetValue=undefined;this.record=record;this.value=record.data[this.name];this.recordData=record.data;},_setValue:function(value,options){if(this._isLastSetValue(value)){return Promise.resolve();}
this.lastSetValue=value;try{value=this._parseValue(value);this._isValid=true;}catch(e){this._isValid=false;this.trigger_up('set_dirty',{dataPointID:this.dataPointID});return Promise.reject({message:"Value set is not valid"});}
if(!(options&&options.forceChange)&&this._isSameValue(value)){return Promise.resolve();}
var self=this;return new Promise(function(resolve,reject){var changes={};changes[self.name]=value;self.trigger_up('field_changed',{dataPointID:self.dataPointID,changes:changes,viewType:self.viewType,doNotSetDirty:options&&options.doNotSetDirty,notifyChange:!options||options.notifyChange!==false,allowWarning:options&&options.allowWarning,onSuccess:resolve,onFailure:reject,});});},_onKeydown:function(ev){switch(ev.which){case $.ui.keyCode.TAB:var event=this.trigger_up('navigation_move',{direction:ev.shiftKey?'previous':'next',});if(event.is_stopped()){ev.preventDefault();ev.stopPropagation();}
break;case $.ui.keyCode.ENTER:ev.preventDefault();ev.stopPropagation();this.trigger_up('navigation_move',{direction:'next_line'});break;case $.ui.keyCode.ESCAPE:this.trigger_up('navigation_move',{direction:'cancel',originalEvent:ev});break;case $.ui.keyCode.UP:ev.stopPropagation();this.trigger_up('navigation_move',{direction:'up'});break;case $.ui.keyCode.RIGHT:ev.stopPropagation();this.trigger_up('navigation_move',{direction:'right'});break;case $.ui.keyCode.DOWN:ev.stopPropagation();this.trigger_up('navigation_move',{direction:'down'});break;case $.ui.keyCode.LEFT:ev.stopPropagation();this.trigger_up('navigation_move',{direction:'left'});break;}},_onNavigationMove:function(ev){ev.data.target=this;},});return AbstractField;});;

/* /web/static/src/js/fields/basic_fields.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.basic_fields',function(require){"use strict";var AbstractField=require('web.AbstractField');var config=require('web.config');var core=require('web.core');var datepicker=require('web.datepicker');var deprecatedFields=require('web.basic_fields.deprecated');var dom=require('web.dom');var Domain=require('web.Domain');var DomainSelector=require('web.DomainSelector');var DomainSelectorDialog=require('web.DomainSelectorDialog');var framework=require('web.framework');var py_utils=require('web.py_utils');var session=require('web.session');var utils=require('web.utils');var view_dialogs=require('web.view_dialogs');var field_utils=require('web.field_utils');var time=require('web.time');const{ColorpickerDialog}=require('web.Colorpicker');let FieldBoolean=deprecatedFields.FieldBoolean;require("web.zoomodoo");var qweb=core.qweb;var _t=core._t;var _lt=core._lt;var TranslatableFieldMixin={_renderTranslateButton:function(){if(_t.database.multi_lang&&this.field.translate){var lang=_t.database.parameters.code.split('_')[0].toUpperCase();return $(`<span class="o_field_translate btn btn-link">${lang}</span>`).on('click',this._onTranslate.bind(this));}
return $();},_onTranslate:function(ev){ev.preventDefault();this.trigger_up('translate',{fieldName:this.name,id:this.dataPointID,isComingFromTranslationAlert:false,});},};var DebouncedField=AbstractField.extend({DEBOUNCE:1000000000,init:function(){this._super.apply(this,arguments);this._isDirty=false;if(this.mode==='edit'){if(this.DEBOUNCE){this._doDebouncedAction=_.debounce(this._doAction,this.DEBOUNCE);}else{this._doDebouncedAction=this._doAction;}
var self=this;var debouncedFunction=this._doDebouncedAction;this._doDebouncedAction=function(){self._isDirty=true;debouncedFunction.apply(self,arguments);};}},commitChanges:function(){if(this._isDirty&&this.mode==='edit'){return this._doAction();}},_doAction:function(){if(!this.isDestroyed()){return this._setValue(this._getValue());}},_getValue:function(){},_onBlur:function(){},});var InputField=DebouncedField.extend({custom_events:_.extend({},DebouncedField.prototype.custom_events,{field_changed:'_onFieldChanged',}),events:_.extend({},DebouncedField.prototype.events,{'input':'_onInput','change':'_onChange','blur':'_onBlur',}),init:function(){this._super.apply(this,arguments);this.nodeOptions.isPassword='password'in this.attrs;if(this.mode==='edit'){this.tagName='input';}
this.isDirty=false;this.lastChangeEvent=undefined;},getFocusableElement:function(){return this.$input||$();},reset:function(record,event){this._reset(record,event);if(!event||event===this.lastChangeEvent){this.isDirty=false;}
if(this.isDirty||(event&&event.target===this&&event.data.changes&&event.data.changes[this.name]===this.value)){if(this.attrs.decorations){this._applyDecorations();}
return Promise.resolve();}else{return this._render();}},_getValue:function(){return this.$input.val();},_prepareInput:function($input){this.$input=$input||$("<input/>");this.$input.addClass('o_input');var inputAttrs={placeholder:this.attrs.placeholder||""};var inputVal;if(this.nodeOptions.isPassword){inputAttrs=_.extend(inputAttrs,{type:'password',autocomplete:this.attrs.autocomplete||'new-password'});inputVal=this.value||'';}else{inputAttrs=_.extend(inputAttrs,{type:'text',autocomplete:this.attrs.autocomplete||'none'});inputVal=this._formatValue(this.value);}
this.$input.attr(inputAttrs);this.$input.val(inputVal);return this.$input;},_renderEdit:function(){this._prepareInput(this.$el);},_renderReadonly:function(){this.$el.text(this._formatValue(this.value));},_onChange:function(){this._doAction();},_onFieldChanged:function(event){this.lastChangeEvent=event;},_onInput:function(){this.isDirty=!this._isLastSetValue(this.$input.val());this._doDebouncedAction();},_onNavigationMove:function(ev){this._super.apply(this,arguments);if(this.mode==='edit'&&ev.data.direction!=='cancel'){var input=this.$input[0];var selecting=(input.selectionEnd!==input.selectionStart);if((ev.data.direction==="left"&&(selecting||input.selectionStart!==0))||(ev.data.direction==="right"&&(selecting||input.selectionStart!==input.value.length))){ev.stopPropagation();}
if(ev.data.direction==='next'&&this.attrs.modifiersValue&&this.attrs.modifiersValue.required&&this.viewType!=='list'){if(!this.$input.val()){this.setInvalidClass();ev.stopPropagation();}else{this.removeInvalidClass();}}}},});var NumericField=InputField.extend({tagName:'span',init(){this._super.apply(this,arguments);this.shouldFormat=Boolean(JSON.parse('format'in this.nodeOptions?this.nodeOptions.format:true));},isSet:function(){return this.value===0||this._super.apply(this,arguments);},_evalFormula:function(expr,context){var val=expr.replace(new RegExp(/( )/g),'');var safeEvalString='';for(let v of val.split(new RegExp(/([-+*/()^])/g))){if(!['+','-','*','/','(',')','^'].includes(v)&&v.length){v=field_utils.parse.float(v);}
if(v==='^'){v='**';}
safeEvalString+=v;};return py_utils.py_eval(safeEvalString,context);},_formatValue:function(value){if(!this.shouldFormat||(this.mode==='edit'&&this.nodeOptions.type==='number')){return value;}
return this._super.apply(this,arguments);},_parseValue:function(value){if(this.mode==='edit'&&this.nodeOptions.type==='number'){return Number(value);}
return this._super.apply(this,arguments);},_prepareInput:function($input){var result=this._super.apply(this,arguments);if(this.nodeOptions.type==='number'){this.$input.attr({type:'number'});}
if(this.nodeOptions.step){this.$input.attr({step:this.nodeOptions.step});}
return result;},_setValue:function(value,options){var originalValue=value;value=value.trim();if(value.startsWith('=')){try{value=this._evalFormula(value.substr(1));value=this._formatValue(value);this.$input.val(value);}catch(err){value=originalValue;}}
return this._super(value,options);},});var FieldChar=InputField.extend(TranslatableFieldMixin,{description:_lt("Text"),className:'o_field_char',tagName:'span',supportedFieldTypes:['char'],_renderEdit:function(){var def=this._super.apply(this,arguments);if(this.field.size&&this.field.size>0){this.$el.attr('maxlength',this.field.size);}
if(this.field.translate){this.$el=this.$el.add(this._renderTranslateButton());this.$el.addClass('o_field_translate');}
return def;},_setValue:function(value,options){if(this.field.trim){value=value.trim();}
return this._super(value,options);},});var LinkButton=AbstractField.extend({events:_.extend({},AbstractField.prototype.events,{'click':'_onClick'}),_render:function(){if(this.value){var className=this.attrs.icon||'fa-globe';this.$el.html("<span role='img'/>");this.$el.addClass("fa "+className);this.$el.attr('title',this.value);this.$el.attr('aria-label',this.value);}},_onClick:function(event){event.stopPropagation();window.open(this.value,'_blank');},});var FieldDateRange=InputField.extend({className:'o_field_date_range',tagName:'span',jsLibs:['/web/static/lib/daterangepicker/daterangepicker.js','/web/static/src/js/libs/daterangepicker.js',],cssLibs:['/web/static/lib/daterangepicker/daterangepicker.css',],supportedFieldTypes:['date','datetime'],init:function(){this._super.apply(this,arguments);this.isDateField=this.formatType==='date';this.dateRangePickerOptions=_.defaults({},this.nodeOptions.picker_options||{},{timePicker:!this.isDateField,timePicker24Hour:_t.database.parameters.time_format.search('%H')!==-1,autoUpdateInput:false,timePickerIncrement:5,locale:{format:this.isDateField?time.getLangDateFormat():time.getLangDatetimeFormat(),},});this.relatedEndDate=this.nodeOptions.related_end_date;this.relatedStartDate=this.nodeOptions.related_start_date;},destroy:function(){if(this.$pickerContainer){this.$pickerContainer.remove();}
if(this._onScroll){window.removeEventListener('scroll',this._onScroll,true);}
this._super.apply(this,arguments);},_getValue:function(){return field_utils.parse[this.formatType](this.$input.val(),this.field,{timezone:true});},_applyChanges:function(ev,picker){var changes={};var displayStartDate=field_utils.format[this.formatType](picker.startDate,{},{timezone:false});var displayEndDate=field_utils.format[this.formatType](picker.endDate,{},{timezone:false});var changedStartDate=picker.startDate;var changedEndDate=picker.endDate;if(this.isDateField){changedStartDate=picker.startDate.add(session.getTZOffset(picker.startDate),'minutes');changedEndDate=picker.endDate.startOf('day').add(session.getTZOffset(picker.endDate),'minutes');}
if(this.relatedEndDate){this.$el.val(displayStartDate);changes[this.name]=this._parseValue(changedStartDate);changes[this.relatedEndDate]=this._parseValue(changedEndDate);}
if(this.relatedStartDate){this.$el.val(displayEndDate);changes[this.name]=this._parseValue(changedEndDate);changes[this.relatedStartDate]=this._parseValue(changedStartDate);}
this.trigger_up('field_changed',{dataPointID:this.dataPointID,viewType:this.viewType,changes:changes,});},_renderEdit:function(){this._super.apply(this,arguments);var self=this;var startDate;var endDate;if(this.relatedEndDate){startDate=this._formatValue(this.value);endDate=this._formatValue(this.recordData[this.relatedEndDate]);}
if(this.relatedStartDate){startDate=this._formatValue(this.recordData[this.relatedStartDate]);endDate=this._formatValue(this.value);}
this.dateRangePickerOptions.startDate=startDate||moment();this.dateRangePickerOptions.endDate=endDate||moment();this.$el.daterangepicker(this.dateRangePickerOptions);this.$el.on('apply.daterangepicker',this._applyChanges.bind(this));this.$el.on('show.daterangepicker',this._onDateRangePickerShow.bind(this));this.$el.on('hide.daterangepicker',this._onDateRangePickerHide.bind(this));this.$el.off('keyup.daterangepicker');this.$pickerContainer=this.$el.data('daterangepicker').container;this.$pickerContainer.on('click',function(ev){ev.stopPropagation();if($(ev.target).hasClass('applyBtn')){self.$el.data('daterangepicker').hide();}});this.$pickerContainer.on('focusin.bs.modal','select',function(ev){ev.stopPropagation();});},_onDateRangePickerHide(){if(this._onScroll){window.removeEventListener('scroll',this._onScroll,true);}},_onDateRangePickerShow(){this._onScroll=ev=>{if(!this.$pickerContainer.get(0).contains(ev.target)){this.$el.data('daterangepicker').hide();}};window.addEventListener('scroll',this._onScroll,true);},});var FieldDate=InputField.extend({description:_lt("Date"),className:"o_field_date",tagName:"span",supportedFieldTypes:['date','datetime'],events:AbstractField.prototype.events,init:function(){this._super.apply(this,arguments);this.formatOptions.timezone=true;this.datepickerOptions=_.defaults({},this.nodeOptions.datepicker||{},{defaultDate:this.value});},start:function(){var self=this;var prom;if(this.mode==='edit'){this.datewidget=this._makeDatePicker();this.datewidget.on('datetime_changed',this,function(){var value=this._getValue();if((!value&&this.value)||(value&&!this._isSameValue(value))){this._setValue(value);}});prom=this.datewidget.appendTo('<div>').then(function(){self.datewidget.$el.addClass(self.$el.attr('class'));self._prepareInput(self.datewidget.$input);self._replaceElement(self.datewidget.$el);});}
return Promise.resolve(prom).then(this._super.bind(this));},activate:function(){if(this.isFocusable()&&this.datewidget){this.datewidget.$input.select();return true;}
return false;},_doDebouncedAction:function(){this.datewidget.changeDatetime();},_getValue:function(){return this.datewidget.getValue();},_isSameValue:function(value){if(value===false){return this.value===false;}
return value.isSame(this.value,'day');},_makeDatePicker:function(){return new datepicker.DateWidget(this,this.datepickerOptions);},_renderEdit:function(){this.datewidget.setValue(this.value);this.$input=this.datewidget.$input;},async _onKeydown(ev){this._super(...arguments);if(ev.which===$.ui.keyCode.ENTER){await this._setValue(this.$input.val());this._render();}},});var FieldDateTime=FieldDate.extend({description:_lt("Date & Time"),supportedFieldTypes:['datetime'],init:function(){this._super.apply(this,arguments);if(this.value){var offset=this.getSession().getTZOffset(this.value);var displayedValue=this.value.clone().add(offset,'minutes');this.datepickerOptions.defaultDate=displayedValue;}},_getValue:function(){var value=this.datewidget.getValue();return value&&value.add(-this.getSession().getTZOffset(value),'minutes');},_isSameValue:function(value){if(value===false){return this.value===false;}
return value.isSame(this.value);},_makeDatePicker:function(){return new datepicker.DateTimeWidget(this,this.datepickerOptions);},_renderEdit:function(){var value=this.value&&this.value.clone().add(this.getSession().getTZOffset(this.value),'minutes');this.datewidget.setValue(value);this.$input=this.datewidget.$input;},});const RemainingDays=AbstractField.extend({description:_lt("Remaining Days"),supportedFieldTypes:['date','datetime'],_render(){if(this.value===false){this.$el.removeClass('text-bf text-danger text-warning');return;}
const nowUTC=moment().utc();const nowUserTZ=nowUTC.clone().add(session.getTZOffset(nowUTC),'minutes');const valueUserTZ=this.value.clone().add(session.getTZOffset(this.value),'minutes');const diffDays=valueUserTZ.startOf('day').diff(nowUserTZ.startOf('day'),'days');let text;if(Math.abs(diffDays)>99){text=this._formatValue(this.value,'date');}else if(diffDays===0){text=_t("Today");}else if(diffDays<0){text=diffDays===-1?_t("Yesterday"):_t(`${-diffDays} days ago`);}else{text=diffDays===1?_t("Tomorrow"):_t(`In ${diffDays} days`);}
this.$el.text(text).attr('title',this._formatValue(this.value,'date'));this.$el.toggleClass('text-bf',diffDays<=0);this.$el.toggleClass('text-danger',diffDays<0);this.$el.toggleClass('text-warning',diffDays===0);},});var FieldMonetary=NumericField.extend({description:_lt("Monetary"),className:'o_field_monetary o_field_number',tagName:'span',supportedFieldTypes:['float','monetary'],resetOnAnyFieldChange:true,init:function(){this._super.apply(this,arguments);this._setCurrency();if(this.mode==='edit'){this.tagName='div';this.className+=' o_input';this.formatOptions.noSymbol=true;}
this.formatOptions.currency=this.currency;this.formatOptions.digits=[16,2];this.formatOptions.field_digits=this.nodeOptions.field_digits;},isSet:function(){return this.value===0||this._super.apply(this,arguments);},_renderEdit:function(){this.$el.empty();var def=this._prepareInput(this.$input).appendTo(this.$el);if(this.currency){var $currencySymbol=$('<span>',{text:this.currency.symbol});if(this.currency.position==="after"){this.$el.append($currencySymbol);}else{this.$el.prepend($currencySymbol);}}
return def;},_renderReadonly:function(){this.$el.html(this._formatValue(this.value));},_reset:function(){this._super.apply(this,arguments);this._setCurrency();},_setCurrency:function(){var currencyField=this.nodeOptions.currency_field||this.field.currency_field||'currency_id';var currencyID=this.record.data[currencyField]&&this.record.data[currencyField].res_id;this.currency=session.get_currency(currencyID);this.formatOptions.currency=this.currency;},});var FieldInteger=NumericField.extend({description:_lt("Integer"),className:'o_field_integer o_field_number',supportedFieldTypes:['integer'],_formatValue:function(value){if(typeof value==='string'){if(!/^[0-9]+-/.test(value)){throw new Error('"'+value+'" is not an integer or a virtual id');}
return value;}
return this._super.apply(this,arguments);},});var FieldFloat=NumericField.extend({description:_lt("Decimal"),className:'o_field_float o_field_number',supportedFieldTypes:['float'],init:function(){this._super.apply(this,arguments);if(this.attrs.digits){this.nodeOptions.digits=JSON.parse(this.attrs.digits);}},});var FieldFloatTime=FieldFloat.extend({description:_lt("Time"),formatType:'float_time',init:function(){this._super.apply(this,arguments);this.formatType='float_time';}});var FieldFloatFactor=FieldFloat.extend({supportedFieldTypes:['float'],className:'o_field_float_factor',formatType:'float_factor',init:function(){this._super.apply(this,arguments);if(!this.nodeOptions.factor){this.nodeOptions.factor=1;}
this.parseOptions=this.nodeOptions;}});var FieldFloatToggle=AbstractField.extend({supportedFieldTypes:['float'],formatType:'float_factor',className:'o_field_float_toggle',tagName:'span',events:{click:'_onClick'},init:function(){this._super.apply(this,arguments);this.formatType='float_factor';if(this.mode==='edit'){this.tagName='button';}
if(this.attrs.digits){this.nodeOptions.digits=JSON.parse(this.attrs.digits);}
if(!this.nodeOptions.factor){this.nodeOptions.factor=1;}
if(!this.nodeOptions.range){this.nodeOptions.range=[0.0,0.5,1.0];}
this.parseOptions=this.nodeOptions;},_getDisplayedValue:function(){var usrFormatValue=this._formatValue(this.value);return field_utils.parse['float'](usrFormatValue);},_renderEdit:function(){this.$el.text(this._formatValue(this.value));},_renderReadonly:function(){this.$el.text(this._formatValue(this.value));},_nextValue:function(){var range=this.nodeOptions.range;var val=utils.closestNumber(this._getDisplayedValue(),range);var index=_.indexOf(range,val);if(index!==-1){if(index+1<range.length){return range[index+1];}}
return range[0];},_onClick:function(ev){if(this.mode==='edit'){ev.stopPropagation();var next_val=this._nextValue();next_val=field_utils.format['float'](next_val);this._setValue(next_val);}},isSet:function(){return this.value===0||this._super(...arguments);},});var FieldPercentage=FieldFloat.extend({className:'o_field_float_percentage o_field_number',description:_lt("Percentage"),init(){this._super(...arguments);if(this.mode==='edit'){this.tagName='div';this.className+=' o_input';this.formatOptions.noSymbol=true;}},_renderEdit(){this.$el.empty();this._prepareInput(this.$input).appendTo(this.$el);const $percentageSymbol=$('<span>',{text:'%'});this.$el.append($percentageSymbol);},});var FieldText=InputField.extend(TranslatableFieldMixin,{description:_lt("Multiline Text"),className:'o_field_text',supportedFieldTypes:['text','html'],tagName:'span',init:function(){this._super.apply(this,arguments);if(this.mode==='edit'){this.tagName='textarea';}
this.autoResizeOptions={parent:this};},start:function(){if(this.mode==='edit'){dom.autoresize(this.$el,this.autoResizeOptions);if(this.field.translate){this.$el=this.$el.add(this._renderTranslateButton());this.$el.addClass('o_field_translate');}}
return this._super();},reset:function(){var self=this;return Promise.resolve(this._super.apply(this,arguments)).then(function(){if(self.mode==='edit'){self.$input.trigger('change');}});},_onKeydown:function(ev){if(ev.which===$.ui.keyCode.ENTER){ev.stopPropagation();return;}
this._super.apply(this,arguments);},});var ListFieldText=FieldText.extend({init:function(){this._super.apply(this,arguments);this.autoResizeOptions.min_height=0;},});var HandleWidget=AbstractField.extend({description:_lt("Handle"),noLabel:true,className:'o_row_handle fa fa-arrows ui-sortable-handle',widthInList:'33px',tagName:'span',supportedFieldTypes:['integer'],isSet:function(){return true;},});var FieldEmail=InputField.extend({description:_lt("Email"),className:'o_field_email',events:_.extend({},InputField.prototype.events,{'click':'_onClick',}),prefix:'mailto',supportedFieldTypes:['char'],init:function(){this._super.apply(this,arguments);this.tagName=this.mode==='readonly'?'a':'input';},getFocusableElement:function(){return this.mode==='readonly'?this.$el:this._super.apply(this,arguments);},_renderReadonly:function(){if(this.value){this.$el.text(this.value).addClass('o_form_uri o_text_overflow').attr('href',this.prefix+':'+this.value);}else{this.$el.text('');}},_setValue:function(value,options){if(this.field.trim){value=value.trim();}
return this._super(value,options);},_onClick:function(ev){ev.stopPropagation();},});var FieldPhone=FieldEmail.extend({description:_lt("Phone"),className:'o_field_phone',prefix:'tel',_renderReadonly:function(){this._super();this.$el.removeClass('o_text_overflow');},});var UrlWidget=InputField.extend({description:_lt("URL"),className:'o_field_url',events:_.extend({},InputField.prototype.events,{'click':'_onClick',}),supportedFieldTypes:['char'],init:function(){this._super.apply(this,arguments);this.tagName=this.mode==='readonly'?'a':'input';this.websitePath=this.nodeOptions.website_path||false;},getFocusableElement:function(){return this.mode==='readonly'?this.$el:this._super.apply(this,arguments);},_renderReadonly:function(){let href=this.value;if(this.value&&!this.websitePath){const regex=/^(?:[fF]|[hH][tT])[tT][pP][sS]?:\/\//;href=!regex.test(this.value)?`http://${href}`:href;}
this.$el.text(this.attrs.text||this.value).addClass('o_form_uri o_text_overflow').attr('target','_blank').attr('href',href);},_onClick:function(ev){ev.stopPropagation();},});var CopyClipboard={destroy:function(){this._super.apply(this,arguments);if(this.clipboard){this.clipboard.destroy();}},_initClipboard:function(){var self=this;var $clipboardBtn=this.$('.o_clipboard_button');$clipboardBtn.tooltip({title:_t('Copied !'),trigger:'manual',placement:'right'});this.clipboard=new ClipboardJS($clipboardBtn[0],{text:function(){return self.value.trim();},container:self.$el[0]});this.clipboard.on('success',function(){_.defer(function(){$clipboardBtn.tooltip('show');_.delay(function(){$clipboardBtn.tooltip('hide');},800);});});},_renderReadonly:function(){this._super.apply(this,arguments);if(this.value){this.$el.append($(qweb.render(this.clipboardTemplate)));this._initClipboard();}}};var TextCopyClipboard=FieldText.extend(CopyClipboard,{description:_lt("Copy to Clipboard"),clipboardTemplate:'CopyClipboardText',className:"o_field_copy",});var CharCopyClipboard=FieldChar.extend(CopyClipboard,{description:_lt("Copy to Clipboard"),clipboardTemplate:'CopyClipboardChar',className:'o_field_copy o_text_overflow',});var AbstractFieldBinary=AbstractField.extend({events:_.extend({},AbstractField.prototype.events,{'change .o_input_file':'on_file_change','click .o_select_file_button':function(){this.$('.o_input_file').click();},'click .o_clear_file_button':'_onClearClick',}),init:function(parent,name,record){this._super.apply(this,arguments);this.fields=record.fields;this.useFileAPI=!!window.FileReader;this.max_upload_size=64*1024*1024;this.accepted_file_extensions=(this.nodeOptions&&this.nodeOptions.accepted_file_extensions)||this.accepted_file_extensions||'*';if(!this.useFileAPI){var self=this;this.fileupload_id=_.uniqueId('o_fileupload');$(window).on(this.fileupload_id,function(){var args=[].slice.call(arguments).slice(1);self.on_file_uploaded.apply(self,args);});}},destroy:function(){if(this.fileupload_id){$(window).off(this.fileupload_id);}
this._super.apply(this,arguments);},on_file_change:function(e){var self=this;var file_node=e.target;if((this.useFileAPI&&file_node.files.length)||(!this.useFileAPI&&$(file_node).val()!=='')){if(this.useFileAPI){var file=file_node.files[0];if(file.size>this.max_upload_size){var msg=_t("The selected file exceed the maximum file size of %s.");this.do_warn(_t("File upload"),_.str.sprintf(msg,utils.human_size(this.max_upload_size)));return false;}
utils.getDataURLFromFile(file).then(function(data){data=data.split(',')[1];self.on_file_uploaded(file.size,file.name,file.type,data);});}else{this.$('form.o_form_binary_form').submit();}
this.$('.o_form_binary_progress').show();this.$('button').hide();}},on_file_uploaded:function(size,name){if(size===false){this.do_warn(false,_t("There was a problem while uploading your file"));console.warn("Error while uploading file : ",name);}else{this.on_file_uploaded_and_valid.apply(this,arguments);}
this.$('.o_form_binary_progress').hide();this.$('button').show();},on_file_uploaded_and_valid:function(size,name,content_type,file_base64){this.set_filename(name);this._setValue(file_base64);this._render();},set_filename:function(value){var filename=this.attrs.filename;if(filename&&filename in this.fields){var changes={};changes[filename]=value;this.trigger_up('field_changed',{dataPointID:this.dataPointID,changes:changes,viewType:this.viewType,});}},_clearFile:function(){var self=this;this.$('.o_input_file').val('');this.set_filename('');if(!this.isDestroyed()){this._setValue(false).then(function(){self._render();});}},_onClearClick:function(ev){this._clearFile();},});var FieldBinaryImage=AbstractFieldBinary.extend({description:_lt("Image"),fieldDependencies:_.extend({},AbstractFieldBinary.prototype.fieldDependencies,{__last_update:{type:'datetime'},}),template:'FieldBinaryImage',placeholder:"/web/static/src/img/placeholder.png",events:_.extend({},AbstractFieldBinary.prototype.events,{'click img':function(){if(this.mode==="readonly"){this.trigger_up('bounce_edit');}},}),supportedFieldTypes:['binary'],file_type_magic_word:{'/':'jpg','R':'gif','i':'png','P':'svg+xml',},accepted_file_extensions:'image/*',_getImageUrl:function(model,res_id,field,unique){return session.url('/web/image',{model:model,id:JSON.stringify(res_id),field:field,unique:field_utils.format.datetime(unique).replace(/[^0-9]/g,''),});},_render:function(){var self=this;var url=this.placeholder;if(this.value){if(!utils.is_bin_size(this.value)){url='data:image/'+(this.file_type_magic_word[this.value[0]]||'png')+';base64,'+this.value;}else{var field=this.nodeOptions.preview_image||this.name;var unique=this.recordData.__last_update;url=this._getImageUrl(this.model,this.res_id,field,unique);}}
var $img=$(qweb.render("FieldBinaryImage-img",{widget:this,url:url}));var width=this.nodeOptions.size?this.nodeOptions.size[0]:this.attrs.width;var height=this.nodeOptions.size?this.nodeOptions.size[1]:this.attrs.height;if(width){$img.attr('width',width);$img.css('max-width',width+'px');}
if(height){$img.attr('height',height);$img.css('max-height',height+'px');}
this.$('> img').remove();this.$el.prepend($img);$img.one('error',function(){$img.attr('src',self.placeholder);self.do_warn(false,_t("Could not display the selected image"));});return this._super.apply(this,arguments);},_renderReadonly:function(){this._super.apply(this,arguments);if(this.nodeOptions.zoom){var unique=this.recordData.__last_update;var url=this._getImageUrl(this.model,this.res_id,'image_1920',unique);var $img;var imageField=_.find(Object.keys(this.recordData),function(o){return o.startsWith('image_');});if(this.nodeOptions.background)
{if('tag'in this.nodeOptions){this.tagName=this.nodeOptions.tag;}
if('class'in this.attrs){this.$el.addClass(this.attrs.class);}
const image_field=this.field.manual?this.name:'image_128';var urlThumb=this._getImageUrl(this.model,this.res_id,image_field,unique);this.$el.empty();$img=this.$el;$img.css('backgroundImage','url('+urlThumb+')');}else{$img=this.$('img');}
var zoomDelay=0;if(this.nodeOptions.zoom_delay){zoomDelay=this.nodeOptions.zoom_delay;}
if(this.recordData[imageField]){$img.attr('data-zoom',1);$img.attr('data-zoom-image',url);$img.zoomOdoo({event:'mouseenter',timer:zoomDelay,attach:'.o_content',attachToTarget:true,onShow:function(){var zoomHeight=Math.ceil(this.$zoom.height());var zoomWidth=Math.ceil(this.$zoom.width());if(zoomHeight<128&&zoomWidth<128){this.hide();}
core.bus.on('keydown',this,this.hide);core.bus.on('click',this,this.hide);},beforeAttach:function(){this.$flyout.css({width:'512px',height:'512px'});},preventClicks:this.nodeOptions.preventClicks,});}}},});var CharImageUrl=AbstractField.extend({className:'o_field_image',description:_lt("Image"),supportedFieldTypes:['char'],placeholder:"/web/static/src/img/placeholder.png",_renderReadonly:function(){var self=this;const url=this.value;if(url){var $img=$(qweb.render("FieldBinaryImage-img",{widget:this,url:url}));const width=this.nodeOptions.size?this.nodeOptions.size[0]:this.attrs.width;const height=this.nodeOptions.size?this.nodeOptions.size[1]:this.attrs.height;if(width){$img.attr('width',width);$img.css('max-width',width+'px');}
if(height){$img.attr('height',height);$img.css('max-height',height+'px');}
this.$('> img').remove();this.$el.prepend($img);$img.one('error',function(){$img.attr('src',self.placeholder);self.displayNotification({type:'info',message:_t("Could not display the specified image url."),});});}
return this._super.apply(this,arguments);},});var KanbanFieldBinaryImage=FieldBinaryImage.extend({events:{},});var KanbanCharImageUrl=CharImageUrl.extend({events:{},});var FieldBinaryFile=AbstractFieldBinary.extend({description:_lt("File"),template:'FieldBinaryFile',events:_.extend({},AbstractFieldBinary.prototype.events,{'click':function(event){if(this.mode==='readonly'&&this.value&&this.recordData.id){this.on_save_as(event);}},'click .o_input':function(){this.$('.o_input_file').click();},}),supportedFieldTypes:['binary'],init:function(){this._super.apply(this,arguments);this.filename_value=this.recordData[this.attrs.filename];},_renderReadonly:function(){this.do_toggle(!!this.value);if(this.value){this.$el.empty().append($("<span/>").addClass('fa fa-download'));if(this.recordData.id){this.$el.css('cursor','pointer');}else{this.$el.css('cursor','not-allowed');}
if(this.filename_value){this.$el.append(" "+this.filename_value);}}
if(!this.res_id){this.$el.css('cursor','not-allowed');}else{this.$el.css('cursor','pointer');}},_renderEdit:function(){if(this.value){this.$el.children().removeClass('o_hidden');this.$('.o_select_file_button').first().addClass('o_hidden');this.$('.o_input').eq(0).val(this.filename_value||this.value);}else{this.$el.children().addClass('o_hidden');this.$('.o_select_file_button').first().removeClass('o_hidden');}},set_filename:function(value){this._super.apply(this,arguments);this.filename_value=value;this.$('.o_save_file_button').prop('disabled',true);},on_save_as:function(ev){if(!this.value){this.do_warn(false,_t("The field is empty, there's nothing to save."));ev.stopPropagation();}else if(this.res_id){framework.blockUI();var filename_fieldname=this.attrs.filename;this.getSession().get_file({complete:framework.unblockUI,data:{'model':this.model,'id':this.res_id,'field':this.name,'filename_field':filename_fieldname,'filename':this.recordData[filename_fieldname]||"",'download':true,'data':utils.is_bin_size(this.value)?null:this.value,},error:(error)=>this.call('crash_manager','rpc_error',error),url:'/web/content',});ev.stopPropagation();}},});var FieldPdfViewer=FieldBinaryFile.extend({description:_lt("PDF Viewer"),supportedFieldTypes:['binary'],template:'FieldPdfViewer',accepted_file_extensions:'application/pdf',init:function(){this._super.apply(this,arguments);this.PDFViewerApplication=false;},_disableButtons:function(iframe){$(iframe).contents().find('button#openFile').hide();},_getURI:function(fileURI){var page=this.recordData[this.name+'_page']||1;if(!fileURI){var queryObj={model:this.model,field:this.name,id:this.res_id,};var queryString=$.param(queryObj);fileURI='/web/content?'+queryString;}
fileURI=encodeURIComponent(fileURI);var viewerURL='/web/static/lib/pdfjs/web/viewer.html?file=';return viewerURL+fileURI+'#page='+page;},_render:function(){var self=this;var $pdfViewer=this.$('.o_form_pdf_controls').children().add(this.$('.o_pdfview_iframe'));var $selectUpload=this.$('.o_select_file_button').first();var $iFrame=this.$('.o_pdfview_iframe');$iFrame.on('load',function(){self.PDFViewerApplication=this.contentWindow.window.PDFViewerApplication;self._disableButtons(this);});if(this.mode==="readonly"&&this.value){$iFrame.attr('src',this._getURI());}else{if(this.value){var binSize=utils.is_bin_size(this.value);$pdfViewer.removeClass('o_hidden');$selectUpload.addClass('o_hidden');if(binSize){$iFrame.attr('src',this._getURI());}}else{$pdfViewer.addClass('o_hidden');$selectUpload.removeClass('o_hidden');}}},on_file_change:function(ev){this._super.apply(this,arguments);var files=ev.target.files;if(!files||files.length===0){return;}
var fileURI=URL.createObjectURL(files[0]);if(this.PDFViewerApplication){this.PDFViewerApplication.open(fileURI,0);}else{this.$('.o_pdfview_iframe').attr('src',this._getURI(fileURI));}},on_save_as:function(ev){ev.stopPropagation();},});var PriorityWidget=AbstractField.extend({description:_lt("Priority"),className:"o_priority",attributes:{'role':'radiogroup',},events:{'mouseover > a':'_onMouseOver','mouseout > a':'_onMouseOut','click > a':'_onClick','keydown > a':'_onKeydown',},supportedFieldTypes:['selection'],isSet:function(){return true;},getFocusableElement:function(){var checked=this.$("[aria-checked='true']");return checked.length?checked:this.$("[data-index='1']");},_render:function(){var self=this;var index_value=this.value?_.findIndex(this.field.selection,function(v){return v[0]===self.value;}):0;this.$el.empty();this.empty_value=this.field.selection[0][0];this.$el.attr('aria-label',this.string);const isReadonly=this.record.evalModifiers(this.attrs.modifiers).readonly;_.each(this.field.selection.slice(1),function(choice,index){const tag=isReadonly?'<span>':'<a href="#">';self.$el.append(self._renderStar(tag,index_value>=index+1,index+1,choice[1],index_value));});},_renderStar:function(tag,isFull,index,tip,indexValue){var isChecked=indexValue===index;var defaultFocus=indexValue===0&&index===1;return $(tag).attr('role','radio').attr('aria-checked',isChecked).attr('title',tip).attr('aria-label',tip).attr('tabindex',isChecked||defaultFocus?0:-1).attr('data-index',index).addClass('o_priority_star fa').toggleClass('fa-star',isFull).toggleClass('fa-star-o',!isFull);},_onClick:function(event){event.preventDefault();event.stopPropagation();var index=$(event.currentTarget).data('index');var newValue=this.field.selection[index][0];if(newValue===this.value){newValue=this.empty_value;}
this._setValue(newValue);},_onMouseOut:function(){clearTimeout(this.hoverTimer);var self=this;this.hoverTimer=setTimeout(function(){self._render();},200);},_onMouseOver:function(event){clearTimeout(this.hoverTimer);this.$('.o_priority_star').removeClass('fa-star-o').addClass('fa-star');$(event.currentTarget).nextAll().removeClass('fa-star').addClass('fa-star-o');},_onKeydown:function(event){if(event.which===$.ui.keyCode.ENTER){return;}
this._super.apply(this,arguments);},_onNavigationMove:function(ev){var $curControl=this.$('a:focus');var $nextControl;if(ev.data.direction==='right'||ev.data.direction==='down'){$nextControl=$curControl.next('a');}else if(ev.data.direction==='left'||ev.data.direction==='up'){$nextControl=$curControl.prev('a');}
if($nextControl&&$nextControl.length){ev.stopPropagation();$nextControl.focus();return;}
this._super.apply(this,arguments);},});var AttachmentImage=AbstractField.extend({className:'o_attachment_image',_render:function(){if(this.value){this.$el.empty().append($('<img>/',{src:"/web/image/"+this.value.data.id+"?unique=1",title:this.value.data.display_name,alt:_t("Image")}));}}});var StateSelectionWidget=AbstractField.extend({template:'FormSelection',events:{'click .dropdown-item':'_setSelection',},supportedFieldTypes:['selection'],getFocusableElement:function(){return this.$("a[data-toggle='dropdown']");},_prepareDropdownValues:function(){var self=this;var _data=[];var current_stage_id=self.recordData.stage_id&&self.recordData.stage_id[0];var stage_data={id:current_stage_id,legend_normal:this.recordData.legend_normal||undefined,legend_blocked:this.recordData.legend_blocked||undefined,legend_done:this.recordData.legend_done||undefined,};_.map(this.field.selection||[],function(selection_item){var value={'name':selection_item[0],'tooltip':selection_item[1],};if(selection_item[0]==='normal'){value.state_name=stage_data.legend_normal?stage_data.legend_normal:selection_item[1];}else if(selection_item[0]==='done'){value.state_class='o_status_green';value.state_name=stage_data.legend_done?stage_data.legend_done:selection_item[1];}else{value.state_class='o_status_red';value.state_name=stage_data.legend_blocked?stage_data.legend_blocked:selection_item[1];}
_data.push(value);});return _data;},_render:function(){var states=this._prepareDropdownValues();var currentState=_.findWhere(states,{name:this.value})||states[0];this.$('.o_status').removeClass('o_status_red o_status_green').addClass(currentState.state_class).prop('special_click',true).parent().attr('title',currentState.state_name).attr('aria-label',this.string+": "+currentState.state_name);var $items=$(qweb.render('FormSelection.items',{states:_.without(states,currentState)}));var $dropdown=this.$('.dropdown-menu');$dropdown.children().remove();$items.appendTo($dropdown);var isReadonly=this.record.evalModifiers(this.attrs.modifiers).readonly;this.$('a[data-toggle=dropdown]').toggleClass('disabled',isReadonly||false);},_setSelection:function(ev){ev.preventDefault();var $item=$(ev.currentTarget);var value=String($item.data('value'));this._setValue(value);if(this.mode==='edit'){this._render();}},});var FavoriteWidget=AbstractField.extend({className:'o_favorite',events:{'click':'_setFavorite'},supportedFieldTypes:['boolean'],isSet:function(){return true;},_render:function(){var tip=this.value?_t('Remove from Favorites'):_t('Add to Favorites');var template=this.attrs.nolabel?'<a href="#"><i class="fa %s" title="%s" aria-label="%s" role="img"></i></a>':'<a href="#"><i class="fa %s" role="img" aria-label="%s"></i> %s</a>';this.$el.empty().append(_.str.sprintf(template,this.value?'fa-star':'fa-star-o',tip,tip));},_setFavorite:function(event){event.preventDefault();event.stopPropagation();this._setValue(!this.value);},});var LabelSelection=AbstractField.extend({supportedFieldTypes:['selection'],_render:function(){this.classes=this.nodeOptions&&this.nodeOptions.classes||{};var labelClass=this.classes[this.value]||'primary';this.$el.addClass('badge badge-'+labelClass).text(this._formatValue(this.value));},});var BooleanToggle=FieldBoolean.extend({description:_lt("Toggle"),className:FieldBoolean.prototype.className+' o_boolean_toggle',events:{'click':'_onClick'},_onClick:function(event){event.stopPropagation();this._setValue(!this.value);},});var StatInfo=AbstractField.extend({supportedFieldTypes:['integer','float'],isSet:function(){return true;},_render:function(){var options={value:this._formatValue(this.value||0),};if(!this.attrs.nolabel){if(this.nodeOptions.label_field&&this.recordData[this.nodeOptions.label_field]){options.text=this.recordData[this.nodeOptions.label_field];}else{options.text=this.string;}}
this.$el.html(qweb.render("StatInfo",options));this.$el.addClass('o_stat_info');},});var FieldPercentPie=AbstractField.extend({description:_lt("Percentage Pie"),template:'FieldPercentPie',supportedFieldTypes:['integer','float'],start:function(){this.$leftMask=this.$('.o_mask').first();this.$rightMask=this.$('.o_mask').last();this.$pieValue=this.$('.o_pie_value');return this._super();},isSet:function(){return true;},_render:function(){var value=this.value||0;var degValue=360*value/100;this.$rightMask.toggleClass('o_full',degValue>=180);var leftDeg='rotate('+((degValue<180)?180:degValue)+'deg)';var rightDeg='rotate('+((degValue<180)?degValue:0)+'deg)';this.$leftMask.css({transform:leftDeg,msTransform:leftDeg,mozTransform:leftDeg,webkitTransform:leftDeg});this.$rightMask.css({transform:rightDeg,msTransform:rightDeg,mozTransform:rightDeg,webkitTransform:rightDeg});this.$pieValue.text(Math.round(value)+'%');},});var FieldProgressBar=AbstractField.extend({description:_lt("Progress Bar"),template:"ProgressBar",events:{'change input':'on_change_input','input input':'on_change_input','keyup input':function(e){if(e.which===$.ui.keyCode.ENTER){this.on_change_input(e);}},},supportedFieldTypes:['integer','float'],init:function(){this._super.apply(this,arguments);if(this.recordData[this.nodeOptions.current_value]){this.value=this.recordData[this.nodeOptions.current_value];}
this.editable_readonly=!!this.nodeOptions.editable_readonly;this.readonly=this.nodeOptions.readonly||!this.nodeOptions.editable;this.canWrite=!this.readonly&&(this.mode==='edit'||(this.editable_readonly&&this.mode==='readonly')||(this.viewType==='kanban'));this.edit_max_value=!!this.nodeOptions.edit_max_value;this.max_value=this.recordData[this.nodeOptions.max_value]||100;this.title=_t(this.attrs.title||this.nodeOptions.title)||'';this.enableBarAsInput=false;this.edit_on_click=this.enableBarAsInput&&this.mode==='readonly'&&!this.edit_max_value;this.write_mode=false;},_render:function(){var self=this;this._render_value();if(this.canWrite){if(this.edit_on_click){this.$el.on('click','.o_progress',function(e){var $target=$(e.currentTarget);var numValue=Math.floor((e.pageX-$target.offset().left)/$target.outerWidth()*self.max_value);self.on_update(numValue);self._render_value();});}else{this.$el.on('click',function(){if(!self.write_mode){var $input=$('<input>',{type:'text',class:'o_progressbar_value o_input'});$input.on('blur',self.on_change_input.bind(self));self.$('.o_progressbar_value').replaceWith($input);self.write_mode=true;self._render_value();}});}}
return this._super();},on_update:function(value){if(this.edit_max_value){this.max_value=value;this._isValid=true;var changes={};changes[this.nodeOptions.max_value]=this.max_value;this.trigger_up('field_changed',{dataPointID:this.dataPointID,changes:changes,});}else{var formattedValue=this._formatValue(value);this._setValue(formattedValue);}},on_change_input:function(e){var $input=$(e.target);if(e.type==='change'&&!$input.is(':focus')){return;}
var parsedValue;try{parsedValue=field_utils.parse.float($input.val());}catch(error){this.do_warn(false,_t("Please enter a numerical value"));}
if(parsedValue!==undefined){if(e.type==='input'){this._render_value(parsedValue);if(parsedValue===0){$input.select();}}else{if(this.edit_max_value){parsedValue=parsedValue||100;}
var $div=$('<div>',{class:'o_progressbar_value'});this.$('.o_progressbar_value').replaceWith($div);this.write_mode=false;this.on_update(parsedValue);this._render_value();}}},_render_value:function(v){var value=this.value;var max_value=this.max_value;if(!isNaN(v)){if(this.edit_max_value){max_value=v;}else{value=v;}}
value=value||0;max_value=max_value||0;var widthComplete;if(value<=max_value){widthComplete=value/max_value*100;}else{widthComplete=100;}
this.$('.o_progress').toggleClass('o_progress_overflow',value>max_value).attr('aria-valuemin','0').attr('aria-valuemax',max_value).attr('aria-valuenow',value);this.$('.o_progressbar_complete').css('width',widthComplete+'%');if(!this.write_mode){if(max_value!==100){this.$('.o_progressbar_value').text(utils.human_number(value)+" / "+utils.human_number(max_value));}else{this.$('.o_progressbar_value').text(utils.human_number(value)+"%");}}else if(isNaN(v)){this.$('.o_progressbar_value').val(this.edit_max_value?max_value:value);this.$('.o_progressbar_value').focus().select();}},_reset:function(){this._super.apply(this,arguments);var new_max_value=this.recordData[this.nodeOptions.max_value];this.max_value=new_max_value!==undefined?new_max_value:this.max_value;},isSet:function(){return true;},});var FieldToggleBoolean=AbstractField.extend({description:_lt("Button"),template:"toggle_button",events:{'click':'_onToggleButton'},supportedFieldTypes:['boolean'],isSet:function(){return true;},_render:function(){this.$('i').toggleClass('o_toggle_button_success',!!this.value).toggleClass('text-muted',!this.value);var title=this.value?this.attrs.options.active:this.attrs.options.inactive;this.$el.attr('title',title);this.$el.attr('aria-pressed',this.value);},_onToggleButton:function(event){event.stopPropagation();this._setValue(!this.value);},});var JournalDashboardGraph=AbstractField.extend({className:"o_dashboard_graph",jsLibs:['/web/static/lib/Chart/Chart.js',],init:function(){this._super.apply(this,arguments);this.graph_type=this.attrs.graph_type;this.data=JSON.parse(this.value);},on_attach_callback:function(){this._isInDOM=true;this._renderInDOM();},on_detach_callback:function(){this._isInDOM=false;},_render:function(){if(this._isInDOM){return this._renderInDOM();}
return Promise.resolve();},_renderInDOM:function(){this.$el.empty();var config,cssClass;if(this.graph_type==='line'){config=this._getLineChartConfig();cssClass='o_graph_linechart';}else if(this.graph_type==='bar'){config=this._getBarChartConfig();cssClass='o_graph_barchart';}
this.$canvas=$('<canvas/>');this.$el.addClass(cssClass);this.$el.empty();this.$el.append(this.$canvas);var context=this.$canvas[0].getContext('2d');this.chart=new Chart(context,config);},_getLineChartConfig:function(){var labels=this.data[0].values.map(function(pt){return pt.x;});var borderColor=this.data[0].is_sample_data?'#dddddd':'#875a7b';var backgroundColor=this.data[0].is_sample_data?'#ebebeb':'#dcd0d9';return{type:'line',data:{labels:labels,datasets:[{data:this.data[0].values,fill:'start',label:this.data[0].key,backgroundColor:backgroundColor,borderColor:borderColor,borderWidth:2,}]},options:{legend:{display:false},scales:{yAxes:[{display:false}],xAxes:[{display:false}]},maintainAspectRatio:false,elements:{line:{tension:0.000001}},tooltips:{intersect:false,position:'nearest',caretSize:0,},},};},_getBarChartConfig:function(){var data=[];var labels=[];var backgroundColor=[];this.data[0].values.forEach(function(pt){data.push(pt.value);labels.push(pt.label);var color=pt.type==='past'?'#ccbdc8':(pt.type==='future'?'#a5d8d7':'#ebebeb');backgroundColor.push(color);});return{type:'bar',data:{labels:labels,datasets:[{data:data,fill:'start',label:this.data[0].key,backgroundColor:backgroundColor,}]},options:{legend:{display:false},scales:{yAxes:[{display:false}],},maintainAspectRatio:false,tooltips:{intersect:false,position:'nearest',caretSize:0,},elements:{line:{tension:0.000001}},},};},});var FieldDomain=AbstractField.extend({specialData:"_fetchSpecialDomain",events:_.extend({},AbstractField.prototype.events,{"click .o_domain_show_selection_button":"_onShowSelectionButtonClick","click .o_field_domain_dialog_button":"_onDialogEditButtonClick",}),custom_events:_.extend({},AbstractField.prototype.custom_events,{domain_changed:"_onDomainSelectorValueChange",domain_selected:"_onDomainSelectorDialogValueChange",open_record:"_onOpenRecord",}),init:function(){this._super.apply(this,arguments);this.inDialog=!!this.nodeOptions.in_dialog;this.fsFilters=this.nodeOptions.fs_filters||{};this.className="o_field_domain";if(this.mode==="edit"){this.className+=" o_edit_mode";}
if(!this.inDialog){this.className+=" o_inline_mode";}
this._setState();},isSet:function(){return true;},isValid:function(){return(this._super.apply(this,arguments)&&(!this.domainSelector||this.domainSelector.isValid())&&this._isValidForModel);},_render:function(){if(!this._domainModel){this._replaceContent();return Promise.resolve();}
var value=this.value||"[]";var def;if(!this.domainSelector){this.domainSelector=new DomainSelector(this,this._domainModel,value,{readonly:this.mode==="readonly"||this.inDialog,filters:this.fsFilters,debugMode:config.isDebug(),});def=this.domainSelector.prependTo(this.$el);}else{def=this.domainSelector.setDomain(value);}
return def.then(this._replaceContent.bind(this));},_replaceContent:function(){if(this._$content){this._$content.remove();}
this._$content=$(qweb.render("FieldDomain.content",{hasModel:!!this._domainModel,isValid:!!this._isValidForModel,nbRecords:this.record.specialData[this.name].nbRecords||0,inDialogEdit:this.inDialog&&this.mode==="edit",}));this._$content.appendTo(this.$el);},_reset:function(){this._super.apply(this,arguments);var oldDomainModel=this._domainModel;this._setState();if(this.domainSelector&&this._domainModel!==oldDomainModel){this.domainSelector.destroy();this.domainSelector=null;}},_setState:function(){var specialData=this.record.specialData[this.name];this._domainModel=specialData.model;this._isValidForModel=(specialData.nbRecords!==false);},_onShowSelectionButtonClick:function(e){e.preventDefault();new view_dialogs.SelectCreateDialog(this,{title:_t("Selected records"),res_model:this._domainModel,context:this.record.getContext({fieldName:this.name,viewType:this.viewType}),domain:this.value||"[]",no_create:true,readonly:true,disable_multiple_selection:true,}).open();},_onDialogEditButtonClick:function(e){e.preventDefault();new DomainSelectorDialog(this,this._domainModel,this.value||"[]",{readonly:this.mode==="readonly",filters:this.fsFilters,debugMode:config.isDebug(),}).open();},_onDomainSelectorValueChange:function(e){if(this.inDialog)return;this._setValue(Domain.prototype.arrayToString(this.domainSelector.getDomain()));},_onDomainSelectorDialogValueChange:function(e){this._setValue(Domain.prototype.arrayToString(e.data.domain));},_onOpenRecord:function(event){event.stopPropagation();},});var AceEditor=DebouncedField.extend({template:"AceEditor",jsLibs:['/web/static/lib/ace/ace.js',['/web/static/lib/ace/mode-python.js','/web/static/lib/ace/mode-xml.js']],events:{},start:function(){this._startAce(this.$('.ace-view-editor')[0]);return this._super.apply(this,arguments);},destroy:function(){if(this.aceEditor){this.aceEditor.destroy();}
this._super.apply(this,arguments);},_formatValue:function(value){return this._super.apply(this,arguments)||'';},_getValue:function(){return this.aceSession.getValue();},_render:function(){var newValue=this._formatValue(this.value);if(this.aceSession.getValue()!==newValue){this.aceSession.setValue(newValue);}},_startAce:function(node){this.aceEditor=ace.edit(node);this.aceEditor.setOptions({maxLines:Infinity,showPrintMargin:false,});if(this.mode==='readonly'){this.aceEditor.renderer.setOptions({displayIndentGuides:false,showGutter:false,});this.aceEditor.setOptions({highlightActiveLine:false,highlightGutterLine:false,readOnly:true,});this.aceEditor.renderer.$cursorLayer.element.style.display="none";}
this.aceEditor.$blockScrolling=true;this.aceSession=this.aceEditor.getSession();this.aceSession.setOptions({useWorker:false,mode:"ace/mode/"+(this.nodeOptions.mode||'xml'),tabSize:2,useSoftTabs:true,});if(this.mode==="edit"){this.aceEditor.on("change",this._doDebouncedAction.bind(this));this.aceEditor.on("blur",this._doAction.bind(this));}},});var FieldColor=AbstractField.extend({template:'FieldColor',events:_.extend({},AbstractField.prototype.events,{'click .o_field_color':'_onColorClick',}),custom_events:_.extend({},AbstractField.prototype.custom_events,{'colorpicker:saved':'_onColorpickerSaved',}),getFocusableElement:function(){return this.$('.o_field_color');},_render:function(){this.$('.o_field_color').data('value',this.value).css('background-color',this.value).attr('title',this.value);return this._super.apply(this,arguments);},_onColorClick:function(){if(this.mode==='edit'){const dialog=new ColorpickerDialog(this,{defaultColor:this.value,noTransparency:true,}).open();dialog.on('closed',this,()=>{Promise.resolve().then(()=>{this.getFocusableElement().focus();});});}},_onColorpickerSaved:function(ev){this._setValue(ev.data.hex);},_onKeydown:function(ev){if(ev.which===$.ui.keyCode.ENTER){ev.preventDefault();ev.stopPropagation();this._onColorClick(ev);}else{this._super.apply(this,arguments);}},});var FieldColorPicker=FieldInteger.extend({RECORD_COLORS:[_t('No color'),_t('Red'),_t('Orange'),_t('Yellow'),_t('Light blue'),_t('Dark purple'),_t('Salmon pink'),_t('Medium blue'),_t('Dark blue'),_t('Fushia'),_t('Green'),_t('Purple'),],init:function(){this._super.apply(this,arguments);this.tagName='div';},_renderEdit:function(){this.$el.html(qweb.render('ColorPicker'));this._setupColorPicker();this._highlightSelectedColor();},_renderReadonly:function(){var selectedColorName=this.RECORD_COLORS[this.value];this.$el.html(qweb.render('ColorPickerReadonly',{active_color:this.value,name_color:selectedColorName}));this.$el.on('click','a',function(ev){ev.preventDefault();});},_setupColorPicker:function(){var $colorpicker=this.$('ul');if(!$colorpicker.length){return;}
$colorpicker.html(qweb.render('KanbanColorPicker',{colors:this.RECORD_COLORS}));$colorpicker.on('click','a',this._onColorChanged.bind(this));},_getValue:function(){return this.value;},_onColorChanged:function(ev){ev.preventDefault();var color=null;if(ev.currentTarget&&ev.currentTarget.dataset&&ev.currentTarget.dataset.color){color=ev.currentTarget.dataset.color;}
if(color){this.value=color;this._onChange();this._renderEdit();}},_highlightSelectedColor:function(){try{$(this.$('li')[parseInt(this.value)]).css('border','2px solid teal');}catch(err){}},});return{TranslatableFieldMixin:TranslatableFieldMixin,DebouncedField:DebouncedField,FieldEmail:FieldEmail,FieldBinaryFile:FieldBinaryFile,FieldPdfViewer:FieldPdfViewer,AbstractFieldBinary:AbstractFieldBinary,FieldBinaryImage:FieldBinaryImage,KanbanFieldBinaryImage:KanbanFieldBinaryImage,CharImageUrl:CharImageUrl,KanbanCharImageUrl:KanbanCharImageUrl,FieldBoolean:FieldBoolean,BooleanToggle:BooleanToggle,FieldChar:FieldChar,LinkButton:LinkButton,FieldDate:FieldDate,FieldDateTime:FieldDateTime,FieldDateRange:FieldDateRange,RemainingDays:RemainingDays,FieldDomain:FieldDomain,FieldFloat:FieldFloat,FieldFloatTime:FieldFloatTime,FieldFloatFactor:FieldFloatFactor,FieldFloatToggle:FieldFloatToggle,FieldPercentage:FieldPercentage,FieldInteger:FieldInteger,FieldMonetary:FieldMonetary,FieldPercentPie:FieldPercentPie,FieldPhone:FieldPhone,FieldProgressBar:FieldProgressBar,FieldText:FieldText,ListFieldText:ListFieldText,FieldToggleBoolean:FieldToggleBoolean,HandleWidget:HandleWidget,InputField:InputField,NumericField:NumericField,AttachmentImage:AttachmentImage,LabelSelection:LabelSelection,StateSelectionWidget:StateSelectionWidget,FavoriteWidget:FavoriteWidget,PriorityWidget:PriorityWidget,StatInfo:StatInfo,UrlWidget:UrlWidget,TextCopyClipboard:TextCopyClipboard,CharCopyClipboard:CharCopyClipboard,JournalDashboardGraph:JournalDashboardGraph,AceEditor:AceEditor,FieldColor:FieldColor,FieldColorPicker:FieldColorPicker,};});;

/* /web/static/src/js/fields/field_registry.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.field_registry',function(require){"use strict";const Registry=require('web.Registry');return new Registry(null,(value)=>!(value.prototype instanceof owl.Component));});odoo.define('web._field_registry',function(require){"use strict";var AbstractField=require('web.AbstractField');var basic_fields=require('web.basic_fields');var relational_fields=require('web.relational_fields');var registry=require('web.field_registry');var special_fields=require('web.special_fields');registry.add('abstract',AbstractField).add('input',basic_fields.InputField).add('integer',basic_fields.FieldInteger).add('boolean',basic_fields.FieldBoolean).add('date',basic_fields.FieldDate).add('datetime',basic_fields.FieldDateTime).add('daterange',basic_fields.FieldDateRange).add('remaining_days',basic_fields.RemainingDays).add('domain',basic_fields.FieldDomain).add('text',basic_fields.FieldText).add('list.text',basic_fields.ListFieldText).add('html',basic_fields.FieldText).add('float',basic_fields.FieldFloat).add('char',basic_fields.FieldChar).add('link_button',basic_fields.LinkButton).add('handle',basic_fields.HandleWidget).add('email',basic_fields.FieldEmail).add('phone',basic_fields.FieldPhone).add('url',basic_fields.UrlWidget).add('CopyClipboardText',basic_fields.TextCopyClipboard).add('CopyClipboardChar',basic_fields.CharCopyClipboard).add('image',basic_fields.FieldBinaryImage).add('image_url',basic_fields.CharImageUrl).add('kanban.image',basic_fields.KanbanFieldBinaryImage).add('kanban.image_url',basic_fields.KanbanCharImageUrl).add('binary',basic_fields.FieldBinaryFile).add('pdf_viewer',basic_fields.FieldPdfViewer).add('monetary',basic_fields.FieldMonetary).add('percentage',basic_fields.FieldPercentage).add('priority',basic_fields.PriorityWidget).add('attachment_image',basic_fields.AttachmentImage).add('label_selection',basic_fields.LabelSelection).add('kanban_label_selection',basic_fields.LabelSelection).add('state_selection',basic_fields.StateSelectionWidget).add('kanban_state_selection',basic_fields.StateSelectionWidget).add('boolean_favorite',basic_fields.FavoriteWidget).add('boolean_toggle',basic_fields.BooleanToggle).add('statinfo',basic_fields.StatInfo).add('percentpie',basic_fields.FieldPercentPie).add('float_time',basic_fields.FieldFloatTime).add('float_factor',basic_fields.FieldFloatFactor).add('float_toggle',basic_fields.FieldFloatToggle).add('progressbar',basic_fields.FieldProgressBar).add('toggle_button',basic_fields.FieldToggleBoolean).add('dashboard_graph',basic_fields.JournalDashboardGraph).add('ace',basic_fields.AceEditor).add('color',basic_fields.FieldColor).add('many2one_reference',basic_fields.FieldInteger).add('color_picker',basic_fields.FieldColorPicker);registry.add('selection',relational_fields.FieldSelection).add('radio',relational_fields.FieldRadio).add('selection_badge',relational_fields.FieldSelectionBadge).add('many2one',relational_fields.FieldMany2One).add('many2one_barcode',relational_fields.Many2oneBarcode).add('list.many2one',relational_fields.ListFieldMany2One).add('kanban.many2one',relational_fields.KanbanFieldMany2One).add('many2one_avatar',relational_fields.Many2OneAvatar).add('many2many',relational_fields.FieldMany2Many).add('many2many_binary',relational_fields.FieldMany2ManyBinaryMultiFiles).add('many2many_tags',relational_fields.FieldMany2ManyTags).add('many2many_tags_avatar',relational_fields.FieldMany2ManyTagsAvatar).add('form.many2many_tags',relational_fields.FormFieldMany2ManyTags).add('kanban.many2many_tags',relational_fields.KanbanFieldMany2ManyTags).add('many2many_checkboxes',relational_fields.FieldMany2ManyCheckBoxes).add('one2many',relational_fields.FieldOne2Many).add('statusbar',relational_fields.FieldStatus).add('reference',relational_fields.FieldReference).add('font',relational_fields.FieldSelectionFont);registry.add('timezone_mismatch',special_fields.FieldTimezoneMismatch).add('report_layout',special_fields.FieldReportLayout).add('iframe_wrapper',special_fields.IframeWrapper)});;

/* /web/static/src/js/fields/field_registry_owl.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.field_registry_owl',function(require){"use strict";const Registry=require('web.Registry');return new Registry(null,(value)=>value.prototype instanceof owl.Component);});odoo.define('web._field_registry_owl',function(require){"use strict";const basicFields=require('web.basic_fields_owl');const registry=require('web.field_registry_owl');registry.add('badge',basicFields.FieldBadge).add('boolean',basicFields.FieldBoolean);});;

/* /web/static/src/js/views/basic/widget_registry.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.widget_registry',function(require){"use strict";var Registry=require('web.Registry');return new Registry();});;

/* /web/static/src/js/fields/field_utils.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.field_utils',function(require){"use strict";var core=require('web.core');var dom=require('web.dom');var session=require('web.session');var time=require('web.time');var utils=require('web.utils');var _t=core._t;function formatBinary(value,field,options){if(!value){return'';}
return utils.binaryToBinsize(value);}
function formatBoolean(value,field,options){if(options&&options.forceString){return value?_t('True'):_t('False');}
return dom.renderCheckbox({prop:{checked:value,disabled:true,},});}
function formatChar(value,field,options){value=typeof value==='string'?value:'';if(options&&options.isPassword){return _.str.repeat('*',value?value.length:0);}
if(options&&options.escape){value=_.escape(value);}
return value;}
function formatDate(value,field,options){if(value===false||isNaN(value)){return"";}
if(field&&field.type==='datetime'){if(!options||!('timezone'in options)||options.timezone){value=value.clone().add(session.getTZOffset(value),'minutes');}}
var date_format=time.getLangDateFormat();return value.format(date_format);}
function formatDateTime(value,field,options){if(value===false){return"";}
if(!options||!('timezone'in options)||options.timezone){value=value.clone().add(session.getTZOffset(value),'minutes');}
return value.format(time.getLangDatetimeFormat());}
function formatFloat(value,field,options){options=options||{};if(value===false){return"";}
if(options.humanReadable&&options.humanReadable(value)){return utils.human_number(value,options.decimals,options.minDigits,options.formatterCallback);}
var l10n=core._t.database.parameters;var precision;if(options.digits){precision=options.digits[1];}else if(field&&field.digits){precision=field.digits[1];}else{precision=2;}
var formatted=_.str.sprintf('%.'+precision+'f',value||0).split('.');formatted[0]=utils.insert_thousand_seps(formatted[0]);return formatted.join(l10n.decimal_point);}
function formatFloatFactor(value,field,options){var factor=options.factor||1;return formatFloat(value*factor,field,options);}
function formatFloatTime(value,field,options){options=options||{};var pattern=options.noLeadingZeroHour?'%1d:%02d':'%02d:%02d';if(value<0){value=Math.abs(value);pattern='-'+pattern;}
var hour=Math.floor(value);var min=Math.round((value%1)*60);if(min===60){min=0;hour=hour+1;}
return _.str.sprintf(pattern,hour,min);}
function formatInteger(value,field,options){options=options||{};if(options.isPassword){return _.str.repeat('*',String(value).length);}
if(!value&&value!==0){return"";}
if(options.humanReadable&&options.humanReadable(value)){return utils.human_number(value,options.decimals,options.minDigits,options.formatterCallback);}
return utils.insert_thousand_seps(_.str.sprintf('%d',value));}
function formatMany2one(value,field,options){if(!value){value='';}else if(_.isArray(value)){value=value[1];}else{while(value.data){value=value.data.display_name||'';}}
if(options&&options.escape){value=_.escape(value);}
return value;}
function formatX2Many(value){if(value.data.length===0){return _t('No records');}else if(value.data.length===1){return _t('1 record');}else{return value.data.length+_t(' records');}}
function formatMonetary(value,field,options){if(value===false){return"";}
options=Object.assign({forceString:false},options);var currency=options.currency;if(!currency){var currency_id=options.currency_id;if(!currency_id&&options.data){var currency_field=options.currency_field||field.currency_field||'currency_id';currency_id=options.data[currency_field]&&options.data[currency_field].res_id;}
currency=session.get_currency(currency_id);}
var digits=(currency&&currency.digits)||options.digits;if(options.field_digits===true){digits=field.digits||digits;}
var formatted_value=formatFloat(value,field,_.extend({},options,{digits:digits}));if(!currency||options.noSymbol){return formatted_value;}
const ws=options.forceString?' ':'&nbsp;';if(currency.position==="after"){return formatted_value+ws+currency.symbol;}else{return currency.symbol+ws+formatted_value;}}
function formatPercentage(value,field,options){options=options||{};let result=formatFloat(value*100,field,options)||'0';if(!options.humanReadable||!options.humanReadable(value*100)){result=parseFloat(result).toString().replace('.',_t.database.parameters.decimal_point);}
return result+(options.noSymbol?'':'%');}
function formatSelection(value,field,options){var val=_.find(field.selection,function(option){return option[0]===value;});if(!val){return'';}
value=val[1];if(options&&options.escape){value=_.escape(value);}
return value;}
function parseSmartDateInput(value){const units={d:'days',m:'months',w:'weeks',y:'years',};const re=new RegExp(`^([+-])(\\d+)([${Object.keys(units).join('')}]?)$`);const match=re.exec(value);if(match){let date=moment();const offset=parseInt(match[2],10);const unit=units[match[3]||'d'];if(match[1]==='+'){date.add(offset,unit);}else{date.subtract(offset,unit);}
return date;}
return false;}
function parseDate(value,field,options){if(!value){return false;}
var datePattern=time.getLangDateFormat();var datePatternWoZero=datePattern.replace('MM','M').replace('DD','D');var date;const smartDate=parseSmartDateInput(value);if(smartDate){date=smartDate;}else{if(options&&options.isUTC){value=value.padStart(10,"0");date=moment.utc(value);}else{date=moment.utc(value,[datePattern,datePatternWoZero,moment.ISO_8601]);}}
if(date.isValid()){if(date.year()===0){date.year(moment.utc().year());}
date.toJSON=function(){return this.clone().locale('en').format('YYYY-MM-DD');};return date;}
throw new Error(_.str.sprintf(core._t("'%s' is not a correct date"),value));}
function parseDateTime(value,field,options){if(!value){return false;}
var datePattern=time.getLangDateFormat(),timePattern=time.getLangTimeFormat();var datePatternWoZero=datePattern.replace('MM','M').replace('DD','D'),timePatternWoZero=timePattern.replace('HH','H').replace('mm','m').replace('ss','s');var pattern1=datePattern+' '+timePattern;var pattern2=datePatternWoZero+' '+timePatternWoZero;var datetime;const smartDate=parseSmartDateInput(value);if(smartDate){datetime=smartDate;}else{if(options&&options.isUTC){datetime=moment.utc(value.replace(' ','T')+'Z');}else{datetime=moment.utc(value,[pattern1,pattern2,moment.ISO_8601]);if(options&&options.timezone){datetime.add(-session.getTZOffset(datetime),'minutes');}}}
if(datetime.isValid()){if(datetime.year()===0){datetime.year(moment.utc().year());}
datetime.toJSON=function(){return this.clone().locale('en').format('YYYY-MM-DD HH:mm:ss');};return datetime;}
throw new Error(_.str.sprintf(core._t("'%s' is not a correct datetime"),value));}
function parseNumber(value){if(core._t.database.parameters.thousands_sep){var escapedSep=_.str.escapeRegExp(core._t.database.parameters.thousands_sep);value=value.replace(new RegExp(escapedSep,'g'),'');}
if(core._t.database.parameters.decimal_point){value=value.replace(core._t.database.parameters.decimal_point,'.');}
return Number(value);}
function parseFloat(value){var parsed=parseNumber(value);if(isNaN(parsed)){throw new Error(_.str.sprintf(core._t("'%s' is not a correct float"),value));}
return parsed;}
function parseMonetary(value,field,options){var values=value.split('&nbsp;');if(values.length===1){return parseFloat(value);}
else if(values.length!==2){throw new Error(_.str.sprintf(core._t("'%s' is not a correct monetary field"),value));}
options=options||{};var currency=options.currency;if(!currency){var currency_id=options.currency_id;if(!currency_id&&options.data){var currency_field=options.currency_field||field.currency_field||'currency_id';currency_id=options.data[currency_field]&&options.data[currency_field].res_id;}
currency=session.get_currency(currency_id);}
return parseFloat(values[0]===currency.symbol?values[1]:values[0]);}
function parseFloatFactor(value,field,options){var parsed=parseFloat(value);var factor=options.factor||1.0;return parsed/factor;}
function parseFloatTime(value){var factor=1;if(value[0]==='-'){value=value.slice(1);factor=-1;}
var float_time_pair=value.split(":");if(float_time_pair.length!==2)
return factor*parseFloat(value);var hours=parseInteger(float_time_pair[0]);var minutes=parseInteger(float_time_pair[1]);return factor*(hours+(minutes/60));}
function parsePercentage(value){return parseFloat(value)/100;}
function parseInteger(value){var parsed=parseNumber(value);if(isNaN(parsed)||parsed%1||parsed<-2147483648||parsed>2147483647){throw new Error(_.str.sprintf(core._t("'%s' is not a correct integer"),value));}
return parsed;}
function parseMany2one(value){if(_.isArray(value)){return{id:value[0],display_name:value[1],};}
if(_.isNumber(value)||_.isString(value)){return{id:parseInt(value,10),};}
return value;}
return{format:{binary:formatBinary,boolean:formatBoolean,char:formatChar,date:formatDate,datetime:formatDateTime,float:formatFloat,float_factor:formatFloatFactor,float_time:formatFloatTime,html:_.identity,integer:formatInteger,many2many:formatX2Many,many2one:formatMany2one,many2one_reference:formatInteger,monetary:formatMonetary,one2many:formatX2Many,percentage:formatPercentage,reference:formatMany2one,selection:formatSelection,text:formatChar,},parse:{binary:_.identity,boolean:_.identity,char:_.identity,date:parseDate,datetime:parseDateTime,float:parseFloat,float_factor:parseFloatFactor,float_time:parseFloatTime,html:_.identity,integer:parseInteger,many2many:_.identity,many2one:parseMany2one,many2one_reference:parseInteger,monetary:parseMonetary,one2many:_.identity,percentage:parsePercentage,reference:parseMany2one,selection:_.identity,text:_.identity,},};});;

/* /web/static/src/js/fields/relational_fields.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.relational_fields',function(require){"use strict";var AbstractField=require('web.AbstractField');var basicFields=require('web.basic_fields');var concurrency=require('web.concurrency');const ControlPanelX2Many=require('web.ControlPanelX2Many');var core=require('web.core');var data=require('web.data');var Dialog=require('web.Dialog');var dialogs=require('web.view_dialogs');var dom=require('web.dom');const Domain=require('web.Domain');var KanbanRecord=require('web.KanbanRecord');var KanbanRenderer=require('web.KanbanRenderer');var ListRenderer=require('web.ListRenderer');const{ComponentWrapper,WidgetAdapterMixin}=require('web.OwlCompatibility');const{sprintf}=require("web.utils");const{escape}=owl.utils;var _t=core._t;var _lt=core._lt;var qweb=core.qweb;var M2ODialog=Dialog.extend({template:"M2ODialog",init:function(parent,name,value){this.name=name;this.value=value;this._super(parent,{title:_t(`New ${this.name}`),size:'medium',buttons:[{text:_t('Create'),classes:'btn-primary',close:true,click:function(){this.trigger_up('quick_create',{value:this.value});},},{text:_t('Create and edit'),classes:'btn-primary',close:true,click:function(){this.trigger_up('search_create_popup',{view_type:'form',value:this.value,});},},{text:_t('Cancel'),close:true,}],});},close:function(isSet){this.isSet=isSet;this._super.apply(this,arguments);},destroy:function(){if(!this.isSet){this.trigger_up('closed_unset');}
this._super.apply(this,arguments);},});var FieldMany2One=AbstractField.extend({description:_lt("Many2one"),supportedFieldTypes:['many2one'],template:'FieldMany2One',custom_events:_.extend({},AbstractField.prototype.custom_events,{'closed_unset':'_onDialogClosedUnset','field_changed':'_onFieldChanged','quick_create':'_onQuickCreate','search_create_popup':'_onSearchCreatePopup',}),events:_.extend({},AbstractField.prototype.events,{'click input':'_onInputClick','focusout input':'_onInputFocusout','keyup input':'_onInputKeyup','click .o_external_button':'_onExternalButtonClick','click':'_onClick',}),AUTOCOMPLETE_DELAY:200,SEARCH_MORE_LIMIT:320,init:function(parent,name,record,options){options=options||{};this._super.apply(this,arguments);this.limit=7;this.orderer=new concurrency.DropMisordered();const canCreate='can_create'in this.attrs?JSON.parse(this.attrs.can_create):true;this.can_create=canCreate&&!this.nodeOptions.no_create&&!options.noCreate;this.can_write='can_write'in this.attrs?JSON.parse(this.attrs.can_write):true;this.nodeOptions=_.defaults(this.nodeOptions,{quick_create:true,});this.noOpen='noOpen'in options?options.noOpen:this.nodeOptions.no_open;this.m2o_value=this._formatValue(this.value);this.recordParams={fieldName:this.name,viewType:this.viewType};this.isDirty=false;this.lastChangeEvent=undefined;this._autocompleteSources=[];this._addAutocompleteSource(this._search,{placeholder:_t('Loading...'),order:1});this.dp=new concurrency.DropPrevious();this.createDef=undefined;},start:function(){this.floating=false;this.$input=this.$('input');this.$external_button=this.$('.o_external_button');return this._super.apply(this,arguments);},destroy:function(){if(this._onScroll){window.removeEventListener('scroll',this._onScroll,true);}
this._super.apply(this,arguments);},commitChanges:function(){return Promise.resolve(this.createDef);},getFocusableElement:function(){return this.mode==='edit'&&this.$input||this.$el;},reinitialize:function(value){this.isDirty=false;this.floating=false;return this._setValue(value);},reset:function(record,event){this._reset(record,event);if(!event||event===this.lastChangeEvent){this.isDirty=false;}
if(this.isDirty){return Promise.resolve();}else{return this._render();}},_addAutocompleteSource:function(method,params){this._autocompleteSources.push({method:method,placeholder:(params.placeholder?_t(params.placeholder):_t('Loading...'))+'<i class="fa fa-spinner fa-spin pull-right"></i>',validation:params.validation,loading:false,order:params.order||999});this._autocompleteSources=_.sortBy(this._autocompleteSources,'order');},_bindAutoComplete:function(){var self=this;if($.browser.chrome&&this.$input.attr('placeholder')){this.$input.attr('placeholder',function(index,val){return val.split('').join('\ufeff');});}
this.$input.autocomplete({source:function(req,resp){_.each(self._autocompleteSources,function(source){source.results=[];const search=req.term.trim();if(!source.validation||source.validation.call(self,search)){source.loading=true;Promise.resolve(source.method.call(self,search)).then(function(results){source.results=results;source.loading=false;resp(self._concatenateAutocompleteResults());});}});},select:function(event,ui){event.stopImmediatePropagation();event.preventDefault();var item=ui.item;self.floating=false;if(item.id){self.reinitialize({id:item.id,display_name:item.name});}else if(item.action){item.action();}
return false;},focus:function(event){event.preventDefault();},open:function(event){self._onScroll=function(ev){if(ev.target!==self.$input.get(0)&&self.$input.hasClass('ui-autocomplete-input')){self.$input.autocomplete('close');}};window.addEventListener('scroll',self._onScroll,true);},close:function(event){if(event.which===$.ui.keyCode.ESCAPE){event.stopPropagation();}
if(self._onScroll){window.removeEventListener('scroll',self._onScroll,true);}},autoFocus:true,html:true,minLength:0,delay:this.AUTOCOMPLETE_DELAY,});this.$input.autocomplete("option","position",{my:"left top",at:"left bottom"});this.autocomplete_bound=true;},_concatenateAutocompleteResults:function(){var results=[];_.each(this._autocompleteSources,function(source){if(source.results&&source.results.length){results=results.concat(source.results);}else if(source.loading){results.push({label:source.placeholder});}});return results;},_createContext:function(name){var tmp={};var field=this.nodeOptions.create_name_field;if(field===undefined){field="name";}
if(field!==false&&name&&this.nodeOptions.quick_create!==false){tmp["default_"+field]=name;}
return tmp;},_getSearchBlacklist:function(){return[];},_getDisplayName:function(value){return value.split('\n')[0];},_getSearchCreatePopupOptions:function(view,ids,context,dynamicFilters){var self=this;return{res_model:this.field.relation,domain:this.record.getDomain({fieldName:this.name}),context:_.extend({},this.record.getContext(this.recordParams),context||{}),dynamicFilters:dynamicFilters||[],title:(view==='search'?_t("Search: "):_t("Create: "))+this.string,initial_ids:ids,initial_view:view,disable_multiple_selection:true,no_create:!self.can_create,kanban_view_ref:this.attrs.kanban_view_ref,on_selected:function(records){self.reinitialize(records[0]);},on_closed:function(){self.activate();},};},_manageSearchMore:function(values,search_val,domain,context){var self=this;values=values.slice(0,this.limit);values.push({label:_t("Search More..."),action:function(){var prom;if(search_val!==''){prom=self._rpc({model:self.field.relation,method:'name_search',kwargs:{name:search_val,args:domain,operator:"ilike",limit:self.SEARCH_MORE_LIMIT,context:context,},});}
Promise.resolve(prom).then(function(results){var dynamicFilters;if(results){var ids=_.map(results,function(x){return x[0];});dynamicFilters=[{description:_.str.sprintf(_t('Quick search: %s'),search_val),domain:[['id','in',ids]],}];}
self._searchCreatePopup("search",false,{},dynamicFilters);});},classname:'o_m2o_dropdown_option',});return values;},_onFieldChanged:function(event){this.lastChangeEvent=event;},_quickCreate:function(name){var self=this;var createDone;var def=new Promise(function(resolve,reject){self.createDef=new Promise(function(innerResolve){createDone=function(){innerResolve();resolve();self.createDef=undefined;};});var slowCreate=function(){var dialog=self._searchCreatePopup("form",false,self._createContext(name));dialog.on('closed',self,createDone);};if(self.nodeOptions.quick_create){const prom=self.reinitialize({id:false,display_name:name});prom.guardedCatch(reason=>{reason.event.preventDefault();slowCreate();});self.dp.add(prom).then(createDone).guardedCatch(reject);}else{slowCreate();}});return def;},_renderEdit:function(){var value=this.m2o_value;if(this.nodeOptions.always_reload){value=this._getDisplayName(value);}
this.$input.val(value);if(!this.autocomplete_bound){this._bindAutoComplete();}
this._updateExternalButton();},_renderReadonly:function(){var escapedValue=_.escape((this.m2o_value||"").trim());var value=escapedValue.split('\n').map(function(line){return'<span>'+line+'</span>';}).join('<br/>');this.$el.html(value);if(!this.noOpen&&this.value){this.$el.attr('href',_.str.sprintf('#id=%s&model=%s',this.value.res_id,this.field.relation));this.$el.addClass('o_form_uri');}},_reset:function(){this._super.apply(this,arguments);this.floating=false;this.m2o_value=this._formatValue(this.value);},_search:async function(searchValue=""){const value=searchValue.trim();const domain=this.record.getDomain(this.recordParams);const context=Object.assign(this.record.getContext(this.recordParams),this.additionalContext);const blackListedIds=this._getSearchBlacklist();if(blackListedIds.length){domain.push(['id','not in',blackListedIds]);}
const nameSearch=this._rpc({model:this.field.relation,method:"name_search",kwargs:{name:value,args:domain,operator:"ilike",limit:this.limit+1,context,}});const results=await this.orderer.add(nameSearch);let values=results.map((result)=>{const[id,fullName]=result;const displayName=this._getDisplayName(fullName).trim();result[1]=displayName;return{id,label:escape(displayName)||data.noDisplayContent,value:displayName,name:displayName,};});if(this.limit<values.length){values=this._manageSearchMore(values,value,domain,context);}
if(!this.can_create){return values;}
const canQuickCreate=!this.nodeOptions.no_quick_create;const canCreateEdit=!this.nodeOptions.no_create_edit;if(value.length){const nameExists=results.some((result)=>result[1]===value);if(canQuickCreate&&!nameExists){values.push({label:sprintf(_t(`Create "<strong>%s</strong>"`),escape(value)),action:()=>this._quickCreate(value),classname:'o_m2o_dropdown_option'});}
if(canCreateEdit){const valueContext=this._createContext(value);values.push({label:_t("Create and Edit..."),action:()=>{this.el.querySelector(':scope input').value="";return this._searchCreatePopup('form',false,valueContext);},classname:'o_m2o_dropdown_option',});}
if(!values.length){values.push({label:_t("No results to show..."),});}}else if(!this.value&&(canQuickCreate||canCreateEdit)){values.push({label:_t("Start typing..."),classname:'o_m2o_start_typing',});}
return values;},_searchCreatePopup:function(view,ids,context,dynamicFilters){var options=this._getSearchCreatePopupOptions(view,ids,context,dynamicFilters);return new dialogs.SelectCreateDialog(this,_.extend({},this.nodeOptions,options)).open();},_updateExternalButton:function(){var has_external_button=!this.noOpen&&!this.floating&&this.isSet();this.$external_button.toggle(has_external_button);this.$el.toggleClass('o_with_button',has_external_button);},_onClick:function(event){var self=this;if(this.mode==='readonly'&&!this.noOpen){event.preventDefault();event.stopPropagation();this._rpc({model:this.field.relation,method:'get_formview_action',args:[[this.value.res_id]],context:this.record.getContext(this.recordParams),}).then(function(action){self.trigger_up('do_action',{action:action});});}},_onDialogClosedUnset:function(){this.isDirty=false;this.floating=false;this._render();},_onExternalButtonClick:function(){if(!this.value){this.activate();return;}
var self=this;var context=this.record.getContext(this.recordParams);this._rpc({model:this.field.relation,method:'get_formview_id',args:[[this.value.res_id]],context:context,}).then(function(view_id){new dialogs.FormViewDialog(self,{res_model:self.field.relation,res_id:self.value.res_id,context:context,title:_t("Open: ")+self.string,view_id:view_id,readonly:!self.can_write,on_saved:function(record,changed){if(changed){const _setValue=self._setValue.bind(self,self.value.data,{forceChange:true,});self.trigger_up('reload',{db_id:self.value.id,onSuccess:_setValue,onFailure:_setValue,});}},}).open();});},_onInputClick:function(){if(this.$input.autocomplete("widget").is(":visible")){this.$input.autocomplete("close");}else if(this.floating){this.$input.autocomplete("search");}else{this.$input.autocomplete("search",'');}},_onInputFocusout:function(){if(this.can_create&&this.floating){new M2ODialog(this,this.string,this.$input.val()).open();}},_onInputKeyup:function(ev){if(ev.which===$.ui.keyCode.ENTER||ev.which===$.ui.keyCode.TAB){return;}
this.isDirty=true;if(this.$input.val()===""){this.reinitialize(false);}else if(this._getDisplayName(this.m2o_value)!==this.$input.val()){this.floating=true;this._updateExternalButton();}},_onKeydown:function(){this.floating=false;this._super.apply(this,arguments);},_onNavigationMove:function(ev){basicFields.InputField.prototype._onNavigationMove.apply(this,arguments);if(this.mode==='edit'&&$(this.$input.autocomplete('widget')).is(':visible')){ev.stopPropagation();}},_onQuickCreate:function(event){this._quickCreate(event.data.value);},_onSearchCreatePopup:function(event){var data=event.data;this._searchCreatePopup(data.view_type,false,this._createContext(data.value));},});var Many2oneBarcode=FieldMany2One.extend({});var ListFieldMany2One=FieldMany2One.extend({events:_.extend({},FieldMany2One.prototype.events,{'focusin input':'_onInputFocusin',}),init:function(){this._super.apply(this,arguments);this.mustSetValue=false;this.m2oDialogFocused=false;},activate:function(){if(this.mode==='readonly'){return false;}
return this._super.apply(this,arguments);},reinitialize:function(){this.mustSetValue=false;return this._super.apply(this,arguments);},_renderReadonly:function(){this.$el.text(this.m2o_value);},_searchCreatePopup:function(){this.m2oDialogFocused=true;return this._super.apply(this,arguments);},_onInputFocusin:function(){this.m2oDialogFocused=false;},_onInputFocusout:function(){if(this.can_create&&this.floating){var attachedEvents=['click','mousedown'];var stopNextClick=(function(ev){ev.stopPropagation();attachedEvents.forEach(function(eventName){window.removeEventListener(eventName,stopNextClick,true);});}).bind(this);attachedEvents.forEach(function(eventName){window.addEventListener(eventName,stopNextClick,true);});}
this._super.apply(this,arguments);if(!this.m2oDialogFocused&&this.$input.val()===""&&this.mustSetValue){this.reinitialize(false);}},_onInputKeyup:function(){if(this.$input.val()!==""){this._super.apply(this,arguments);}else{this.mustSetValue=true;}},});var KanbanFieldMany2One=AbstractField.extend({tagName:'span',init:function(){this._super.apply(this,arguments);this.m2o_value=this._formatValue(this.value);},_render:function(){this.$el.text(this.m2o_value);},});const Many2OneAvatar=FieldMany2One.extend({_template:'web.Many2OneAvatar',init(){this._super.apply(this,arguments);if(this.mode==='readonly'){this.template=null;this.tagName='div';this.className='o_field_many2one_avatar';this.noOpen=true;}},_renderReadonly(){this.$el.empty();if(this.value){this.$el.html(qweb.render(this._template,{url:`/web/image/${this.field.relation}/${this.value.res_id}/image_128`,value:this.m2o_value,}));}},});var FieldX2Many=AbstractField.extend(WidgetAdapterMixin,{tagName:'div',custom_events:_.extend({},AbstractField.prototype.custom_events,{add_record:'_onAddRecord',discard_changes:'_onDiscardChanges',edit_line:'_onEditLine',field_changed:'_onFieldChanged',open_record:'_onOpenRecord',kanban_record_delete:'_onRemoveRecord',list_record_remove:'_onRemoveRecord',resequence_records:'_onResequenceRecords',save_line:'_onSaveLine',toggle_column_order:'_onToggleColumnOrder',activate_next_widget:'_onActiveNextWidget',navigation_move:'_onNavigationMove',save_optional_fields:'_onSaveOrLoadOptionalFields',load_optional_fields:'_onSaveOrLoadOptionalFields',pager_changed:'_onPagerChanged',}),resetOnAnyFieldChange:true,useSubview:true,init:function(parent,name,record,options){this._super.apply(this,arguments);this.nodeOptions=_.defaults(this.nodeOptions,{create_text:_t('Add'),});this.operations=[];this.isReadonly=this.mode==='readonly';this.view=this.attrs.views[this.attrs.mode];this.isMany2Many=this.field.type==='many2many'||this.attrs.widget==='many2many';this.activeActions={};this.recordParams={fieldName:this.name,viewType:this.viewType};this.pagingState={currentMinimum:this.value.offset+1,limit:this.value.limit,size:this.value.count,validate:()=>{return this.view.arch.tag==='tree'?this.renderer.unselectRow():Promise.resolve();},withAccessKey:false,};var arch=this.view&&this.view.arch;if(arch){this.activeActions.create=arch.attrs.create?!!JSON.parse(arch.attrs.create):true;this.activeActions.delete=arch.attrs.delete?!!JSON.parse(arch.attrs.delete):true;this.editable=arch.attrs.editable;}
this._computeAvailableActions(record);if(this.attrs.columnInvisibleFields){this._processColumnInvisibleFields();}},start:async function(){const _super=this._super.bind(this);if(this.view){this._renderButtons();this._controlPanelWrapper=new ComponentWrapper(this,ControlPanelX2Many,{cp_content:{$buttons:this.$buttons},pager:this.pagingState,});await this._controlPanelWrapper.mount(this.el,{position:'first-child'});}
return _super(...arguments);},destroy:function(){WidgetAdapterMixin.destroy.call(this);this._super();},on_attach_callback:function(){this.isInDOM=true;WidgetAdapterMixin.on_attach_callback.call(this);if(this.renderer){this.renderer.on_attach_callback();}},on_detach_callback:function(){this.isInDOM=false;WidgetAdapterMixin.on_detach_callback.call(this);if(this.renderer){this.renderer.on_detach_callback();}},commitChanges:function(){var self=this;var inEditionRecordID=this.renderer&&this.renderer.viewType==="list"&&this.renderer.getEditableRecordID();if(inEditionRecordID){return this.renderer.commitChanges(inEditionRecordID).then(function(){return self._saveLine(inEditionRecordID);});}
return this._super.apply(this,arguments);},isSet:function(){return true;},reset:function(record,ev,fieldChanged){const oldCanCreate=this.canCreate;const oldCanDelete=this.canDelete;this._computeAvailableActions(record);const actionsChanged=this.canCreate!==oldCanCreate||this.canDelete!==oldCanDelete;if(!fieldChanged&&!actionsChanged){var newEval=this._evalColumnInvisibleFields();if(_.isEqual(this.currentColInvisibleFields,newEval)){return Promise.resolve();}}else if(ev&&ev.target===this&&ev.data.changes&&this.view.arch.tag==='tree'){var command=ev.data.changes[this.name];if(command&&command.operation==='UPDATE'&&command.data){var state=record.data[this.name];var fieldNames=state.getFieldNames({viewType:'list'});this._reset(record,ev);return this.renderer.confirmUpdate(state,command.id,fieldNames,ev.initialEvent);}}
return this._super.apply(this,arguments).then(()=>{if(this.view){this._renderButtons();this._updateControlPanel();}});},getFocusableElement:function(){return(this.mode==='edit'&&this.$input)||this.$el;},activate:function(options){if(!this.activeActions.create||this.isReadonly||!this.$el.is(":visible")){return false;}
if(this.view.type==='kanban'){this.$buttons.find(".o-kanban-button-new").focus();}
if(this.view.arch.tag==='tree'){if(options&&options.noAutomaticCreate){this.renderer.$('.o_field_x2many_list_row_add a:first').focus();}else{this.renderer.$('.o_field_x2many_list_row_add a:first').click();}}
return true;},_computeAvailableActions:function(record){const evalContext=record.evalContext;this.canCreate='create'in this.nodeOptions?new Domain(this.nodeOptions.create,evalContext).compute(evalContext):true;this.canDelete='delete'in this.nodeOptions?new Domain(this.nodeOptions.delete,evalContext).compute(evalContext):true;},_evalColumnInvisibleFields:function(){var self=this;return _.mapObject(this.columnInvisibleFields,function(domains){return self.record.evalModifiers({column_invisible:domains,}).column_invisible;});},_getButtonsRenderingContext(){return{btnClass:'btn-secondary',create_text:this.nodeOptions.create_text,};},_getRenderer:function(){if(this.view.arch.tag==='tree'){return ListRenderer;}
if(this.view.arch.tag==='kanban'){return KanbanRenderer;}},_hasCreateLine:function(){return!this.isReadonly&&((this.activeActions.create&&this.canCreate)||(this.isMany2Many));},_hasTrashIcon:function(){return!this.isReadonly&&((this.activeActions.delete&&this.canDelete)||(this.isMany2Many));},_render:function(){var self=this;if(!this.view){return this._super();}
if(this.renderer){this.currentColInvisibleFields=this._evalColumnInvisibleFields();return this.renderer.updateState(this.value,{addCreateLine:this._hasCreateLine(),addTrashIcon:this._hasTrashIcon(),columnInvisibleFields:this.currentColInvisibleFields,keepWidths:true,}).then(()=>{this._updateControlPanel({size:this.value.count});});}
var arch=this.view.arch;var viewType;var rendererParams={arch:arch,};if(arch.tag==='tree'){viewType='list';this.currentColInvisibleFields=this._evalColumnInvisibleFields();_.extend(rendererParams,{editable:this.mode==='edit'&&arch.attrs.editable,addCreateLine:this._hasCreateLine(),addTrashIcon:this._hasTrashIcon(),isMany2Many:this.isMany2Many,columnInvisibleFields:this.currentColInvisibleFields,});}
if(arch.tag==='kanban'){viewType='kanban';var record_options={editable:false,deletable:false,read_only_mode:this.isReadonly,};_.extend(rendererParams,{record_options:record_options,readOnlyMode:this.isReadonly,});}
_.extend(rendererParams,{viewType:viewType,});var Renderer=this._getRenderer();this.renderer=new Renderer(this,this.value,rendererParams);this.$el.addClass('o_field_x2many o_field_x2many_'+viewType);if(this.renderer){return this.renderer.appendTo(document.createDocumentFragment()).then(function(){dom.append(self.$el,self.renderer.$el,{in_DOM:self.isInDOM,callbacks:[{widget:self.renderer}],});});}else{return this._super();}},_renderButtons:function(){if(!this.isReadonly&&this.view.arch.tag==='kanban'){const renderingContext=this._getButtonsRenderingContext();this.$buttons=$(qweb.render('KanbanView.buttons',renderingContext));this.$buttons.on('click','button.o-kanban-button-new',this._onAddRecord.bind(this));}},_saveLine:function(recordID){var self=this;return new Promise(function(resolve,reject){var fieldNames=self.renderer.canBeSaved(recordID);if(fieldNames.length){self.trigger_up('discard_changes',{recordID:recordID,onSuccess:resolve,onFailure:reject,});}else{self.renderer.setRowMode(recordID,'readonly').then(resolve);}}).then(async function(){self._updateControlPanel({size:self.value.count});var newEval=self._evalColumnInvisibleFields();if(!_.isEqual(self.currentColInvisibleFields,newEval)){self.currentColInvisibleFields=newEval;self.renderer.updateState(self.value,{columnInvisibleFields:self.currentColInvisibleFields,});}});},_updateControlPanel:function(pagingState){if(this._controlPanelWrapper){const newProps={cp_content:{$buttons:this.$buttons},pager:Object.assign(this.pagingState,pagingState),};return this._controlPanelWrapper.update(newProps);}},_processColumnInvisibleFields:function(){var columnInvisibleFields={};_.each(this.attrs.columnInvisibleFields,function(domains,fieldName){if(_.isArray(domains)){columnInvisibleFields[fieldName]=_.map(domains,function(domain){if(_.isArray(domain)){return[domain[0].split('.')[1]].concat(domain.slice(1));}
return domain;});}});this.columnInvisibleFields=columnInvisibleFields;},_onAddRecord:function(){},_onRemoveRecord:function(ev){ev.stopPropagation();var operation=this.isMany2Many?'FORGET':'DELETE';this._setValue({operation:operation,ids:[ev.data.id],});},_onDiscardChanges:function(ev){if(ev.target!==this){ev.stopPropagation();this.trigger_up('discard_changes',_.extend({},ev.data,{fieldName:this.name}));}},_onEditLine:function(ev){ev.stopPropagation();this.trigger_up('edited_list',{id:this.value.id});this.renderer.setRowMode(ev.data.recordId,'edit').then(ev.data.onSuccess);},_onFieldChanged:function(ev){if(ev.target===this){ev.initialEvent=this.lastInitialEvent;return;}
ev.stopPropagation();var changes=ev.data.changes;this.lastInitialEvent=undefined;if(Object.keys(changes).length){this.lastInitialEvent=ev;this._setValue({operation:'UPDATE',id:ev.data.dataPointID,data:changes,}).then(function(){if(ev.data.onSuccess){ev.data.onSuccess();}}).guardedCatch(function(reason){if(ev.data.onFailure){ev.data.onFailure(reason);}});}},_onNavigationMove:function(ev){if(this.view.arch.tag==='tree'){var $curControl=this.renderer.$('.o_field_x2many_list_row_add a:focus');if($curControl.length){var $nextControl;if(ev.data.direction==='right'){$nextControl=$curControl.next('a');}else if(ev.data.direction==='left'){$nextControl=$curControl.prev('a');}
if($nextControl&&$nextControl.length){ev.stopPropagation();$nextControl.focus();return;}}}
this._super.apply(this,arguments);},_onOpenRecord:function(){},_onPagerChanged:function(ev){ev.stopPropagation();const{currentMinimum,limit}=ev.data;this._updateControlPanel({currentMinimum,limit});this.trigger_up('load',{id:this.value.id,limit,offset:currentMinimum-1,on_success:value=>{this.value=value;this.pagingState.limit=value.limit;this.pagingState.size=value.count;this._render();},});},_onSaveLine:function(ev){var self=this;ev.stopPropagation();this.renderer.commitChanges(ev.data.recordID).then(function(){self.trigger_up('mutexify',{action:function(){return self._saveLine(ev.data.recordID).then(ev.data.onSuccess).guardedCatch(ev.data.onFailure);},});});},_onSaveOrLoadOptionalFields:function(ev){ev.data.keyParts.relationalField=this.name;ev.data.keyParts.subViewId=this.view.view_id;ev.data.keyParts.subViewType=this.view.type;},_onResequenceRecords:function(ev){ev.stopPropagation();var self=this;if(this.view.arch.tag==='tree'){this.trigger_up('edited_list',{id:this.value.id});}
var handleField=ev.data.handleField;var offset=ev.data.offset;var recordIds=ev.data.recordIds.slice();var recordId=recordIds.pop();var proms=recordIds.map(function(recordId,index){var data={};data[handleField]=offset+index;return self._setValue({operation:'UPDATE',id:recordId,data:data,},{notifyChange:false,});});Promise.all(proms).then(function(){function always(){if(self.view.arch.tag==='tree'){self.trigger_up('toggle_column_order',{id:self.value.id,name:handleField,});}}
var data={};data[handleField]=offset+recordIds.length;self._setValue({operation:'UPDATE',id:recordId,data:data,}).then(always).guardedCatch(always);});},_onToggleColumnOrder:function(ev){ev.data.field=this.name;},_onActiveNextWidget:function(e){e.stopPropagation();this.renderer.unselectRow();this.trigger_up('navigation_move',{direction:e.data.direction||'next',});},});var One2ManyKanbanRecord=KanbanRecord.extend({_postProcessObjectButtons:function(){var self=this;if(!this.state.res_id){this.$('.oe_kanban_action[data-type=object]').each(function(index,button){var $button=$(button);if($button.attr('warn')){$button.on('click',function(e){e.stopPropagation();self.do_warn(false,_t('Please click on the "save" button first'));});}else{$button.attr('disabled','disabled');}});}},_render:function(){var self=this;return this._super.apply(this,arguments).then(function(){self._postProcessObjectButtons();});},});var One2ManyKanbanRenderer=KanbanRenderer.extend({config:_.extend({},KanbanRenderer.prototype.config,{KanbanRecord:One2ManyKanbanRecord,}),});var FieldOne2Many=FieldX2Many.extend({description:_lt("One2many"),className:'o_field_one2many',supportedFieldTypes:['one2many'],init:function(){this._super.apply(this,arguments);this.creatingRecord=false;},reset:function(record,ev){var self=this;return this._super.apply(this,arguments).then(()=>{if(ev&&ev.target===self&&ev.data.changes&&self.view.arch.tag==='tree'){if(ev.data.changes[self.name]&&ev.data.changes[self.name].operation==='CREATE'){var index=0;if(self.editable!=='top'){index=self.value.data.length-1;self._updateControlPanel({size:self.value.count-1});}
var newID=self.value.data[index].id;self.renderer.editRecord(newID);}}});},_getButtonsRenderingContext(){const renderingContext=this._super(...arguments);renderingContext.noCreate=!this.canCreate;return renderingContext;},_getRenderer:function(){if(this.view.arch.tag==='kanban'){return One2ManyKanbanRenderer;}
return this._super.apply(this,arguments);},_renderButtons:function(){if(this.activeActions.create){return this._super(...arguments);}},_openFormDialog:function(params){var context=this.record.getContext(_.extend({},this.recordParams,{additionalContext:params.context}));this.trigger_up('open_one2many_record',_.extend(params,{domain:this.record.getDomain(this.recordParams),context:context,field:this.field,fields_view:this.attrs.views&&this.attrs.views.form,parentID:this.value.id,viewInfo:this.view,deletable:this.activeActions.delete&&params.deletable&&this.canDelete,}));},_onAddRecord:function(ev){var self=this;var data=ev.data||{};ev.stopPropagation();if(this.editable||data.forceEditable){if(!this.activeActions.create){if(data.onFail){data.onFail();}}else if(!this.creatingRecord){this.creatingRecord=true;this.trigger_up('edited_list',{id:this.value.id});this._setValue({operation:'CREATE',position:this.editable||data.forceEditable,context:data.context,},{allowWarning:data.allowWarning}).then(function(){self.creatingRecord=false;}).then(function(){if(data.onSuccess){data.onSuccess();}}).guardedCatch(function(){self.creatingRecord=false;});}}else{this._openFormDialog({context:data.context&&data.context[0],on_saved:function(record){self._setValue({operation:'ADD',id:record.id});},});}},_onOpenRecord:function(ev){var self=this;ev.stopPropagation();var id=ev.data.id;var onSaved=function(record){if(_.some(self.value.data,{id:record.id})){self._setValue({operation:'UPDATE',id:record.id});}else{self._setValue({operation:'ADD',id:record.id});}};this._openFormDialog({id:id,on_saved:onSaved,on_remove:function(){self._setValue({operation:'DELETE',ids:[id]});},deletable:this.activeActions.delete&&this.view.arch.tag!=='tree'&&this.canDelete,readonly:this.mode==='readonly',});},});var FieldMany2Many=FieldX2Many.extend({description:_lt("Many2many"),className:'o_field_many2many',supportedFieldTypes:['many2many'],onAddRecordOpenDialog:function(){var self=this;var domain=this.record.getDomain({fieldName:this.name});new dialogs.SelectCreateDialog(this,{res_model:this.field.relation,domain:domain.concat(["!",["id","in",this.value.res_ids]]),context:this.record.getContext(this.recordParams),title:_t("Add: ")+this.string,no_create:this.nodeOptions.no_create||!this.activeActions.create||!this.canCreate,fields_view:this.attrs.views.form,kanban_view_ref:this.attrs.kanban_view_ref,on_selected:function(records){var resIDs=_.pluck(records,'id');var newIDs=_.difference(resIDs,self.value.res_ids);if(newIDs.length){var values=_.map(newIDs,function(id){return{id:id};});self._setValue({operation:'ADD_M2M',ids:values,});}}}).open();},_onAddRecord:function(ev){ev.stopPropagation();this.onAddRecordOpenDialog();},_onOpenRecord:function(ev){var self=this;_.extend(ev.data,{context:this.record.getContext(this.recordParams),domain:this.record.getDomain(this.recordParams),fields_view:this.attrs.views&&this.attrs.views.form,on_saved:function(){self._setValue({operation:'TRIGGER_ONCHANGE'},{forceChange:true}).then(function(){self.trigger_up('reload',{db_id:ev.data.id});});},on_remove:function(){self._setValue({operation:'FORGET',ids:[ev.data.id]});},readonly:this.mode==='readonly',deletable:this.activeActions.delete&&this.view.arch.tag!=='tree'&&this.canDelete,string:this.string,});},});var FieldMany2ManyBinaryMultiFiles=AbstractField.extend({template:"FieldBinaryFileUploader",template_files:"FieldBinaryFileUploader.files",supportedFieldTypes:['many2many'],fieldsToFetch:{name:{type:'char'},mimetype:{type:'char'},},events:{'click .o_attach':'_onAttach','click .o_attachment_delete':'_onDelete','change .o_input_file':'_onFileChanged',},init:function(){this._super.apply(this,arguments);if(this.field.type!=='many2many'||this.field.relation!=='ir.attachment'){var msg=_t("The type of the field '%s' must be a many2many field with a relation to 'ir.attachment' model.");throw _.str.sprintf(msg,this.field.string);}
this.uploadedFiles={};this.uploadingFiles=[];this.fileupload_id=_.uniqueId('oe_fileupload_temp');this.accepted_file_extensions=(this.nodeOptions&&this.nodeOptions.accepted_file_extensions)||this.accepted_file_extensions||'*';$(window).on(this.fileupload_id,this._onFileLoaded.bind(this));this.metadata={};},destroy:function(){this._super();$(window).off(this.fileupload_id);},_getFileUrl:function(attachment){return'/web/content/'+attachment.id+'?download=true';},_generatedMetadata:function(){var self=this;_.each(this.value.data,function(record){self.metadata[record.id]={allowUnlink:self.uploadedFiles[record.data.id]||false,url:self._getFileUrl(record.data),};});},_render:function(){this._generatedMetadata();this.$('.oe_placeholder_files, .o_attachments').replaceWith($(qweb.render(this.template_files,{widget:this,})));this.$('.oe_fileupload').show();this.$('.o_image[data-mimetype^="image"]').each(function(){var $img=$(this);if(/gif|jpe|jpg|png/.test($img.data('mimetype'))&&$img.data('src')){$img.css('background-image',"url('"+$img.data('src')+"')");}});},_onAttach:function(){this.$('.o_input_file').click();},_onDelete:function(ev){ev.preventDefault();ev.stopPropagation();var fileID=$(ev.currentTarget).data('id');var record=_.findWhere(this.value.data,{res_id:fileID});if(record){this._setValue({operation:'FORGET',ids:[record.id],});var metadata=this.metadata[record.id];if(!metadata||metadata.allowUnlink){this._rpc({model:'ir.attachment',method:'unlink',args:[record.res_id],});}}},_onFileChanged:function(ev){var self=this;ev.stopPropagation();var files=ev.target.files;var attachment_ids=this.value.res_ids;if(files.length===0)
return;_.each(files,function(file){var record=_.find(self.value.data,function(attachment){return attachment.data.name===file.name;});if(record){var metadata=self.metadata[record.id];if(!metadata||metadata.allowUnlink){attachment_ids=_.without(attachment_ids,record.res_id);self._rpc({model:'ir.attachment',method:'unlink',args:[record.res_id],});}}
self.uploadingFiles.push(file);});this._setValue({operation:'REPLACE_WITH',ids:attachment_ids,});this.$('form.o_form_binary_form').submit();this.$('.oe_fileupload').hide();ev.target.value="";},_onFileLoaded:function(){var self=this;var files=Array.prototype.slice.call(arguments,1);this.uploadingFiles=[];var attachment_ids=this.value.res_ids;_.each(files,function(file){if(file.error){self.do_warn(_t('Uploading Error'),file.error);}else{attachment_ids.push(file.id);self.uploadedFiles[file.id]=true;}});this._setValue({operation:'REPLACE_WITH',ids:attachment_ids,});},});var FieldMany2ManyTags=AbstractField.extend({description:_lt("Tags"),tag_template:"FieldMany2ManyTag",className:"o_field_many2manytags",supportedFieldTypes:['many2many'],custom_events:_.extend({},AbstractField.prototype.custom_events,{field_changed:'_onFieldChanged',}),events:_.extend({},AbstractField.prototype.events,{'click .o_delete':'_onDeleteTag',}),fieldsToFetch:{display_name:{type:'char'},},limit:1000,init:function(){this._super.apply(this,arguments);if(this.mode==='edit'){this.className+=' o_input';}
this.colorField=this.nodeOptions.color_field;this.hasDropdown=false;this._computeAvailableActions(this.record);this.resetOnAnyFieldChange=this.resetOnAnyFieldChange||'create'in this.nodeOptions;},activate:function(){return this.many2one?this.many2one.activate():false;},getFocusableElement:function(){return this.many2one?this.many2one.getFocusableElement():$();},isSet:function(){return!!this.value&&this.value.count;},reset:function(record,event){var self=this;this._computeAvailableActions(record);return this._super.apply(this,arguments).then(function(){if(event&&event.target===self){self.activate();}});},_addTag:function(data){if(!_.contains(this.value.res_ids,data.id)){return this._setValue({operation:'ADD_M2M',ids:data});}
return Promise.resolve();},_computeAvailableActions:function(record){const evalContext=record.evalContext;this.canCreate='create'in this.nodeOptions?new Domain(this.nodeOptions.create,evalContext).compute(evalContext):true;},_getRenderTagsContext:function(){var elements=this.value?_.pluck(this.value.data,'data'):[];return{colorField:this.colorField,elements:elements,hasDropdown:this.hasDropdown,readonly:this.mode==="readonly",};},_removeTag:function(id){var record=_.findWhere(this.value.data,{res_id:id});this._setValue({operation:'FORGET',ids:[record.id],});},_renderEdit:function(){var self=this;this._renderTags();if(this.many2one){this.many2one.destroy();}
this.many2one=new FieldMany2One(this,this.name,this.record,{mode:'edit',noOpen:true,noCreate:!this.canCreate,viewType:this.viewType,attrs:this.attrs,});this.many2one.value=false;this.many2one.m2o_value='';this.many2one._getSearchBlacklist=function(){return self.value.res_ids;};var _getSearchCreatePopupOptions=this.many2one._getSearchCreatePopupOptions;this.many2one._getSearchCreatePopupOptions=function(view,ids,context,dynamicFilters){var options=_getSearchCreatePopupOptions.apply(this,arguments);var domain=this.record.getDomain({fieldName:this.name});var m2mRecords=[];return _.extend({},options,{domain:domain.concat(["!",["id","in",self.value.res_ids]]),disable_multiple_selection:false,on_selected:function(records){m2mRecords.push(...records);},on_closed:function(){self.many2one.reinitialize(m2mRecords);},});};return this.many2one.appendTo(this.$el);},_renderReadonly:function(){this._renderTags();},_renderTags:function(){this.$el.html(qweb.render(this.tag_template,this._getRenderTagsContext()));},_onDeleteTag:function(event){event.preventDefault();event.stopPropagation();this._removeTag($(event.target).parent().data('id'));},_onFieldChanged:function(ev){if(ev.target!==this.many2one){return;}
ev.stopPropagation();var newValue=ev.data.changes[this.name];if(newValue){this._addTag(newValue).then(ev.data.onSuccess||function(){}).guardedCatch(ev.data.onFailure||function(){});this.many2one.reinitialize(false);}},_onKeydown:function(ev){if(ev.which===$.ui.keyCode.BACKSPACE&&this.$('input').val()===""){var $badges=this.$('.badge');if($badges.length){this._removeTag($badges.last().data('id'));return;}}
this._super.apply(this,arguments);},_onQuickCreate:function(event){this._quickCreate(event.data.value);},});var FieldMany2ManyTagsAvatar=FieldMany2ManyTags.extend({tag_template:'FieldMany2ManyTagAvatar',className:'o_field_many2manytags avatar',_getRenderTagsContext:function(){var result=this._super.apply(this,arguments);result.avatarModel=this.nodeOptions.avatarModel||this.field.relation;result.avatarField=this.nodeOptions.avatarField||'image_128';return result;},});var FormFieldMany2ManyTags=FieldMany2ManyTags.extend({events:_.extend({},FieldMany2ManyTags.prototype.events,{'click .dropdown-toggle':'_onOpenColorPicker','mousedown .o_colorpicker a':'_onUpdateColor','mousedown .o_colorpicker .o_hide_in_kanban':'_onUpdateColor',}),init:function(){this._super.apply(this,arguments);this.hasDropdown=!!this.colorField;},_onOpenColorPicker:function(ev){ev.preventDefault();if(this.nodeOptions.no_edit_color){ev.stopPropagation();return;}
var tagID=$(ev.currentTarget).parent().data('id');var tagColor=$(ev.currentTarget).parent().data('color');var tag=_.findWhere(this.value.data,{res_id:tagID});if(tag&&this.colorField in tag.data){this.$color_picker=$(qweb.render('FieldMany2ManyTag.colorpicker',{'widget':this,'tag_id':tagID,}));$(ev.currentTarget).after(this.$color_picker);this.$color_picker.dropdown();this.$color_picker.attr("tabindex",1).focus();if(!tagColor){this.$('.custom-checkbox input').prop('checked',true);}}},_onUpdateColor:function(ev){ev.preventDefault();var $target=$(ev.currentTarget);var color=$target.data('color');var id=$target.data('id');var $tag=this.$(".badge[data-id='"+id+"']");var currentColor=$tag.data('color');var changes={};if($target.is('.o_hide_in_kanban')){var $checkbox=$('.o_hide_in_kanban .custom-checkbox input');$checkbox.prop('checked',!$checkbox.prop('checked'));this.prevColors=this.prevColors?this.prevColors:{};if($checkbox.is(':checked')){this.prevColors[id]=currentColor;}else{color=this.prevColors[id]?this.prevColors[id]:1;}}else if($target.is('[class^="o_tag_color"]')){if(color===currentColor){return;}}
changes[this.colorField]=color;this.trigger_up('field_changed',{dataPointID:_.findWhere(this.value.data,{res_id:id}).id,changes:changes,force_save:true,});},});var KanbanFieldMany2ManyTags=FieldMany2ManyTags.extend({events:AbstractField.prototype.events,_render:function(){var self=this;if(this.$el){this.$el.empty().addClass('o_field_many2manytags o_kanban_tags');}
_.each(this.value.data,function(m2m){if(self.colorField in m2m.data&&!m2m.data[self.colorField]){return;}
$('<span>',{class:'o_tag o_tag_color_'+(m2m.data[self.colorField]||0),text:m2m.data.display_name,}).prepend('<span>').appendTo(self.$el);});},});var FieldMany2ManyCheckBoxes=AbstractField.extend({description:_lt("Checkboxes"),template:'FieldMany2ManyCheckBoxes',events:_.extend({},AbstractField.prototype.events,{change:'_onChange',}),specialData:"_fetchSpecialRelation",supportedFieldTypes:['many2many'],init:function(){this._super.apply(this,arguments);this.m2mValues=this.record.specialData[this.name];},isSet:function(){return true;},_renderCheckboxes:function(){var self=this;this.m2mValues=this.record.specialData[this.name];this.$el.html(qweb.render(this.template,{widget:this}));_.each(this.value.res_ids,function(id){self.$('input[data-record-id="'+id+'"]').prop('checked',true);});},_renderEdit:function(){this._renderCheckboxes();},_renderReadonly:function(){this._renderCheckboxes();this.$("input").prop("disabled",true);},_onChange:function(){var ids=_.map(this.$('input:checked'),function(input){return $(input).data("record-id");});this._setValue({operation:'REPLACE_WITH',ids:ids,});},});var FieldStatus=AbstractField.extend({className:'o_statusbar_status',events:{'click button:not(.dropdown-toggle)':'_onClickStage',},specialData:"_fetchSpecialStatus",supportedFieldTypes:['selection','many2one'],init:function(){this._super.apply(this,arguments);this._setState();this._onClickStage=_.debounce(this._onClickStage,300,true);try{this.isClickable=!!JSON.parse(this.attrs.clickable);}catch(_){this.isClickable=!!this.nodeOptions.clickable;}},isEmpty:function(){return false;},_reset:function(){this._super.apply(this,arguments);this._setState();},_setState:function(){var self=this;if(this.field.type==='many2one'){this.status_information=_.map(this.record.specialData[this.name],function(info){return _.extend({selected:info.id===self.value.res_id,},info);});}else{var selection=this.field.selection;if(this.attrs.statusbar_visible){var restriction=this.attrs.statusbar_visible.split(",");selection=_.filter(selection,function(val){return _.contains(restriction,val[0])||val[0]===self.value;});}
this.status_information=_.map(selection,function(val){return{id:val[0],display_name:val[1],selected:val[0]===self.value,fold:false};});}},_render:function(){var selections=_.partition(this.status_information,function(info){return(info.selected||!info.fold);});this.$el.html(qweb.render("FieldStatus.content",{selection_unfolded:selections[0],selection_folded:selections[1],clickable:this.isClickable,}));},_onClickStage:function(e){this._setValue($(e.currentTarget).data("value"));},});var FieldSelection=AbstractField.extend({description:_lt("Selection"),template:'FieldSelection',specialData:"_fetchSpecialRelation",supportedFieldTypes:['selection'],events:_.extend({},AbstractField.prototype.events,{'change':'_onChange',}),init:function(){this._super.apply(this,arguments);this._setValues();},getFocusableElement:function(){return this.$el&&this.$el.is('select')?this.$el:$();},isSet:function(){return this.value!==false;},updateModifiersValue:function(){this._super.apply(this,arguments);if(!this.attrs.modifiersValue.invisible&&this.mode!=='readonly'){this._setValues();this._renderEdit();}},_renderEdit:function(){this.$el.empty();var required=this.attrs.modifiersValue&&this.attrs.modifiersValue.required;for(var i=0;i<this.values.length;i++){var disabled=required&&this.values[i][0]===false;this.$el.append($('<option/>',{value:JSON.stringify(this.values[i][0]),text:this.values[i][1],style:disabled?"display: none":"",}));}
this.$el.val(JSON.stringify(this._getRawValue()));},_renderReadonly:function(){this.$el.empty().text(this._formatValue(this.value));this.$el.attr('raw-value',this._getRawValue());},_getRawValue:function(){var raw_value=this.value;if(this.field.type==='many2one'&&raw_value){raw_value=raw_value.data.id;}
return raw_value;},_reset:function(){this._super.apply(this,arguments);this._setValues();},_setValues:function(){if(this.field.type==='many2one'){this.values=this.record.specialData[this.name];this.formatType='many2one';}else{this.values=_.reject(this.field.selection,function(v){return v[0]===false&&v[1]==='';});}
this.values=[[false,this.attrs.placeholder||'']].concat(this.values);},_onChange:function(){var res_id=JSON.parse(this.$el.val());if(this.field.type==='many2one'){var value=_.find(this.values,function(val){return val[0]===res_id;});this._setValue({id:res_id,display_name:value[1]});}else{this._setValue(res_id);}},});var FieldRadio=FieldSelection.extend({description:_lt("Radio"),template:null,className:'o_field_radio',tagName:'span',specialData:"_fetchSpecialMany2ones",supportedFieldTypes:['selection','many2one'],events:_.extend({},AbstractField.prototype.events,{'click input':'_onInputClick',}),init:function(){this._super.apply(this,arguments);if(this.mode==='edit'){this.tagName='div';this.className+=this.nodeOptions.horizontal?' o_horizontal':' o_vertical';}
this.unique_id=_.uniqueId("radio");this._setValues();},getFocusableElement:function(){return this.mode==='edit'&&this.$input||this.$el;},isSet:function(){return true;},getFocusableElement:function(){var checked=this.$("[checked='true']");return checked.length?checked:this.$("[data-index='0']");},setIDForLabel:function(id){this.$el.attr('id',id);},_renderEdit:function(){var self=this;var currentValue;if(this.field.type==='many2one'){currentValue=this.value&&this.value.data.id;}else{currentValue=this.value;}
this.$el.empty();this.$el.attr('role','radiogroup').attr('aria-label',this.string);_.each(this.values,function(value,index){self.$el.append(qweb.render('FieldRadio.button',{checked:value[0]===currentValue,id:self.unique_id+'_'+value[0],index:index,name:self.unique_id,value:value,}));});},_reset:function(){this._super.apply(this,arguments);this._setValues();},_setValues:function(){if(this.field.type==='selection'){this.values=this.field.selection||[];}else if(this.field.type==='many2one'){this.values=_.map(this.record.specialData[this.name],function(val){return[val.id,val.display_name];});}},_onInputClick:function(event){var index=$(event.target).data('index');var value=this.values[index];if(this.field.type==='many2one'){this._setValue({id:value[0],display_name:value[1]});}else{this._setValue(value[0]);}},});var FieldSelectionBadge=FieldSelection.extend({description:_lt("Badges"),template:null,className:'o_field_selection_badge',tagName:'span',specialData:"_fetchSpecialMany2ones",events:_.extend({},AbstractField.prototype.events,{'click span.o_selection_badge':'_onBadgeClicked',}),_renderEdit:function(){this.currentValue=this.value;if(this.field.type==='many2one'){this.currentValue=this.value&&this.value.data.id;}
this.$el.empty();this.$el.html(qweb.render('FieldSelectionBadge',{'values':this.values,'current_value':this.currentValue}));},_setValues:function(){if(this.field.type==='selection'){this.values=this.field.selection||[];}else if(this.field.type==='many2one'){this.values=_.map(this.record.specialData[this.name],function(val){return[val.id,val.display_name];});}},_onBadgeClicked:function(event){var index=$(event.target).data('index');var value=this.values[index];if(value[0]!==this.currentValue){if(this.field.type==='many2one'){this._setValue({id:value[0],display_name:value[1]});}else{this._setValue(value[0]);}}else{this._setValue(false);}},});var FieldSelectionFont=FieldSelection.extend({_renderEdit:function(){this._super.apply(this,arguments);this.$('option').each(function(i,option){if(!option.label){$(option).remove();}
$(option).css('font-family',option.value);});this.$el.css('font-family',this.value);},});var FieldReference=FieldMany2One.extend({specialData:"_fetchSpecialReference",supportedFieldTypes:['reference'],template:'FieldReference',events:_.extend({},FieldMany2One.prototype.events,{'change select':'_onSelectionChange',}),init:function(){this._super.apply(this,arguments);this.field=_.extend({},this.field);this._setState();},start:function(){this.$('select').val(this.field.relation);return this._super.apply(this,arguments);},getFocusableElement:function(){if(this.mode==='edit'&&!this.field.relation){return this.$('select');}
return this._super.apply(this,arguments);},_formatValue:function(){var value;if(this.field.type==='char'){value=this.record.specialData[this.name];}else{value=this.value;}
return value&&value.data&&value.data.display_name||'';},_renderEdit:function(){this._super.apply(this,arguments);if(this.$('select').val()){this.$('.o_input_dropdown').show();this.$el.addClass('o_row');}else{this.$('.o_input_dropdown').hide();}},_reset:function(){this._super.apply(this,arguments);var value=this.$('select').val();this._setState();this.$('select').val(this.value&&this.value.model||value);},_setRelation:function(model){this.field.relation=model;},_setState:function(){if(this.field.type==='char'){this.value=this.record.specialData[this.name];}
if(this.value){this._setRelation(this.value.model);}},_setValue:function(value,options){value=value||{};value.model=this.$('select').val();return this._super(value,options);},_onSelectionChange:function(){var value=this.$('select').val();this.reinitialize(false);this._setRelation(value);},});return{FieldMany2One:FieldMany2One,Many2oneBarcode:Many2oneBarcode,KanbanFieldMany2One:KanbanFieldMany2One,ListFieldMany2One:ListFieldMany2One,Many2OneAvatar:Many2OneAvatar,FieldX2Many:FieldX2Many,FieldOne2Many:FieldOne2Many,FieldMany2Many:FieldMany2Many,FieldMany2ManyBinaryMultiFiles:FieldMany2ManyBinaryMultiFiles,FieldMany2ManyCheckBoxes:FieldMany2ManyCheckBoxes,FieldMany2ManyTags:FieldMany2ManyTags,FieldMany2ManyTagsAvatar:FieldMany2ManyTagsAvatar,FormFieldMany2ManyTags:FormFieldMany2ManyTags,KanbanFieldMany2ManyTags:KanbanFieldMany2ManyTags,FieldRadio:FieldRadio,FieldSelectionBadge:FieldSelectionBadge,FieldSelection:FieldSelection,FieldStatus:FieldStatus,FieldSelectionFont:FieldSelectionFont,FieldReference:FieldReference,};});;

/* /web/static/src/js/fields/special_fields.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.special_fields',function(require){"use strict";var core=require('web.core');var field_utils=require('web.field_utils');var relational_fields=require('web.relational_fields');var AbstractField=require('web.AbstractField');var FieldSelection=relational_fields.FieldSelection;var _t=core._t;var _lt=core._lt;var FieldTimezoneMismatch=FieldSelection.extend({start:function(){var interval=navigator.platform.toUpperCase().indexOf('MAC')>=0?60000:1000;this._datetime=setInterval(this._renderDateTimeTimezone.bind(this),interval);return this._super.apply(this,arguments);},destroy:function(){clearInterval(this._datetime);return this._super();},_render:function(){this._super.apply(this,arguments);this._renderTimezoneMismatch();},_renderDateTimeTimezone:function(){if(!this.mismatch||!this.$option.html()){return;}
var offset=this.recordData.tz_offset.match(/([+-])([0-9]{2})([0-9]{2})/);offset=(offset[1]==='-'?-1:1)*(parseInt(offset[2])*60+parseInt(offset[3]));var datetime=field_utils.format.datetime(moment.utc().add(offset,'minutes'),this.field,{timezone:false});var content=this.$option.html().split(' ')[0];content+='    ('+datetime+')';this.$option.html(content);},_renderTimezoneMismatch:function(){this.$el.last().filter('.o_tz_warning').remove();this.$el=this.$el.first();var value=this.$el.val();var $span=$('<span class="fa fa-exclamation-triangle o_tz_warning"/>');if(this.$option&&this.$option.html()){this.$option.html(this.$option.html().split(' ')[0]);}
var userOffset=this.recordData.tz_offset;this.mismatch=false;if(userOffset&&value!==""&&value!=="false"){var offset=-(new Date().getTimezoneOffset());var browserOffset=(offset<0)?"-":"+";browserOffset+=_.str.sprintf("%02d",Math.abs(offset/60));browserOffset+=_.str.sprintf("%02d",Math.abs(offset%60));this.mismatch=(browserOffset!==userOffset);}
if(this.mismatch){$span.insertAfter(this.$el);$span.attr('title',_t("Timezone Mismatch : This timezone is different from that of your browser.\nPlease, set the same timezone as your browser's to avoid time discrepancies in your system."));this.$el=this.$el.add($span);this.$option=this.$('option').filter(function(){return $(this).attr('value')===value;});this._renderDateTimeTimezone();}else if(value=="false"){$span.insertAfter(this.$el);$span.attr('title',_t("Set a timezone on your user"));this.$el=this.$el.add($span);}},_renderEdit:function(){var $otherEl=this.$el.not('select');this.$el=this.$el.first();this._super.apply(this,arguments);$otherEl.insertAfter(this.$el);this.$el=this.$el.add($otherEl);},});var FieldReportLayout=relational_fields.FieldMany2One.extend({events:_.extend({},relational_fields.FieldMany2One.prototype.events,{'click img':'_onImgClicked',}),willStart:function(){var self=this;this.previews={};return this._super().then(function(){return self._rpc({model:'report.layout',method:"search_read"}).then(function(values){self.previews=values;});});},_render:function(){var self=this;this.$el.empty();var value=_.isObject(this.value)?this.value.data.id:this.value;_.each(this.previews,function(val){var $container=$('<div>').addClass('col-3 text-center');var $img=$('<img>').addClass('img img-fluid img-thumbnail ml16').toggleClass('btn-info',val.view_id[0]===value).attr('src',val.image).data('key',val.view_id[0]);$container.append($img);if(val.pdf){var $previewLink=$('<a>').text('Example').attr('href',val.pdf).attr('target','_blank');$container.append($previewLink);}
self.$el.append($container);});},_onImgClicked:function(event){this._setValue($(event.currentTarget).data('key'));},});const IframeWrapper=AbstractField.extend({description:_lt("Wrap raw html within an iframe"),supportedFieldTypes:['text','html'],template:"web.IframeWrapper",_render(){const spinner=this.el.querySelector('.o_iframe_wrapper_spinner');const iframe=this.el.querySelector('.o_preview_iframe');iframe.style.display='none';spinner.style.display='block';let resolver;$(iframe).data('ready',new Promise((resolve)=>{resolver=resolve;}));const onloadReplacement=setInterval(()=>{const iframeDoc=iframe.contentDocument;if(iframeDoc&&(iframeDoc.readyState==='complete'||iframeDoc.readyState==='interactive')){iframeDoc.open();iframeDoc.write(this.value);iframeDoc.close();iframe.style.display='block';spinner.style.display='none';resolver();clearInterval(onloadReplacement);}},100);}});return{FieldTimezoneMismatch:FieldTimezoneMismatch,FieldReportLayout:FieldReportLayout,IframeWrapper,};});;

/* /web/static/src/js/fields/field_wrapper.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.FieldWrapper',function(require){"use strict";const{ComponentWrapper}=require('web.OwlCompatibility');const field_utils=require('web.field_utils');class FieldWrapper extends ComponentWrapper{constructor(){super(...arguments);this._data={};const options=this.props.options||{};const record=this.props.record;this._data.name=this.props.fieldName;this._data.record=record;this._data.field=record.fields[this._data.name];this._data.viewType=options.viewType||'default';const fieldsInfo=record.fieldsInfo[this._data.viewType];this._data.attrs=options.attrs||(fieldsInfo&&fieldsInfo[this._data.name])||{};this._data.additionalContext=options.additionalContext||{};this._data.value=record.data[this._data.name];this._data.recordData=record.data;this._data.string=this._data.attrs.string||this._data.field.string||this._data.name;this._data.nodeOptions=this._data.attrs.options||{};this._data.dataPointID=record.id;this._data.res_id=record.res_id;this._data.model=record.model;this._data.mode=options.mode||"readonly";this._data.formatType=this._data.attrs.widget in field_utils.format?this._data.attrs.widget:this._data.field.type;this._data.formatOptions={};this._data.parseOptions={};if(this._data.attrs.decorations){this._data.resetOnAnyFieldChange=true;}
for(let key in this._data){Object.defineProperty(this,key,{get:()=>{if(this.el){if(key==='dataPointID'){return this.componentRef.comp.dataPointId;}else if(key==='res_id'){return this.componentRef.comp.resId;}}
return(this.el?this.componentRef.comp:this._data)[key];},});}}
mounted(){super.mounted(...arguments);this.componentRef.comp.__node=this.__node;}
get $el(){return $(this.el);}
get fieldDependencies(){return this.Component.fieldDependencies;}
get specialData(){return this.Component.specialData;}
get supportedFieldTypes(){return this.Component.supportedFieldTypes;}
get description(){return this.Component.description;}
get noLabel(){return this.Component.noLabel;}
activate(){return this.componentRef.comp.activate(...arguments);}
commitChanges(){return this.componentRef.comp.commitChanges(...arguments);}
getFocusableElement(){return $(this.componentRef.comp.focusableElement);}
isEmpty(){return this.componentRef.comp.isEmpty;}
isFocusable(){return this.componentRef.comp.isFocusable;}
isSet(){if(this.componentRef.comp){return this.componentRef.comp.isSet;}
const c=new this.Component(null,this.props);const isSet=c.isSet;c.destroy();return isSet;}
isValid(){return this.componentRef.comp.isValid;}
removeInvalidClass(){return this.componentRef.comp.removeInvalidClass(...arguments);}
reset(record,event){return this.update({record,event});}
setIDForLabel(){return this.componentRef.comp.setIdForLabel(...arguments);}
setInvalidClass(){return this.componentRef.comp.setInvalidClass(...arguments);}
updateModifiersValue(modifiers){if(this.props.options.attrs){this.props.options.attrs.modifiersValue=modifiers||{};}else{const viewType=this.props.options.viewType||'default';const fieldsInfo=this.props.record.fieldsInfo[viewType];fieldsInfo[this.props.fieldName].modifiersValue=modifiers||{};}
this.componentRef.comp.props=this.props;}}
return FieldWrapper;});;

/* /web/static/src/js/fields/abstract_field_owl.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.AbstractFieldOwl',function(require){"use strict";const field_utils=require('web.field_utils');const{useListener}=require('web.custom_hooks');const{onMounted,onPatched}=owl.hooks;class AbstractField extends owl.Component{constructor(){super(...arguments);this._isValid=true;this._lastSetValue=undefined;useListener('keydown',this._onKeydown);useListener('navigation-move',this._onNavigationMove);onMounted(()=>this._applyDecorations());onPatched(()=>this._applyDecorations());}
__patch(){const res=super.__patch(...arguments);this.el.setAttribute('name',this.name);this.el.classList.add('o_field_widget');return res;}
async willUpdateProps(nextProps){this._lastSetValue=undefined;return super.willUpdateProps(nextProps);}
get additionalContext(){return this.options.additionalContext||{};}
get attrs(){const fieldsInfo=this.record.fieldsInfo[this.viewType];return this.options.attrs||(fieldsInfo&&fieldsInfo[this.name])||{};}
get dataPointId(){return this.record.id;}
get field(){return this.record.fields[this.name];}
get focusableElement(){return null;}
get formatOptions(){return{};}
get formatType(){return this.attrs.widget in field_utils.format?this.attrs.widget:this.field.type;}
get isEmpty(){return!this.isSet;}
get isFocusable(){const focusable=this.focusableElement;return focusable&&!!(focusable.offsetWidth||focusable.offsetHeight||focusable.getClientRects().length);}
get isSet(){return!!this.value;}
get isValid(){return this._isValid;}
get mode(){return this.options.mode||"readonly";}
get model(){return this.record.model;}
get name(){return this.props.fieldName;}
get nodeOptions(){return this.attrs.options||{};}
get options(){return this.props.options||{};}
get parseOptions(){return{};}
get record(){return this.props.record;}
get recordData(){return this.record.data;}
get resetOnAnyFieldChange(){return!!this.attrs.decorations;}
get resId(){return this.record.res_id;}
get string(){return this.attrs.string||this.field.string||this.name;}
get value(){return this.record.data[this.name];}
get viewType(){return this.options.viewType||'default';}
activate(options){if(this.isFocusable){const focusable=this.focusableElement;focusable.focus();if(focusable.matches('input[type="text"], textarea')){focusable.selectionStart=focusable.selectionEnd=focusable.value.length;if(options&&!options.noselect){focusable.select();}}
return true;}
return false;}
commitChanges(){}
removeInvalidClass(){this.el.classList.remove('o_field_invalid');this.el.removeAttribute('aria-invalid');}
setIdForLabel(id){if(this.focusableElement){this.focusableElement.setAttribute('id',id);}}
setInvalidClass(){this.el.classList.add('o_field_invalid');this.el.setAttribute('aria-invalid','true');}
_applyDecorations(){for(const dec of this.attrs.decorations||[]){const isToggled=py.PY_isTrue(py.evaluate(dec.expression,this.record.evalContext));const className=this._getClassFromDecoration(dec.name);this.el.classList.toggle(className,isToggled);}}
_formatValue(value){const options=Object.assign({},this.nodeOptions,{data:this.recordData},this.formatOptions);return field_utils.format[this.formatType](value,this.field,options);}
_getClassFromDecoration(decoration){return`text-${decoration.split('-')[1]}`;}
_isLastSetValue(value){return this._lastSetValue===value||(this.value===false&&value==='');}
_isSameValue(value){return this.value===value;}
_parseValue(value){return field_utils.parse[this.formatType](value,this.field,this.parseOptions);}
_setValue(value,options){if(this._isLastSetValue(value)){return Promise.resolve();}
this._lastSetValue=value;try{value=this._parseValue(value);this._isValid=true;}catch(e){this._isValid=false;this.trigger('set-dirty',{dataPointID:this.dataPointId});return Promise.reject({message:"Value set is not valid"});}
if(!(options&&options.forceChange)&&this._isSameValue(value)){return Promise.resolve();}
return new Promise((resolve,reject)=>{const changes={};changes[this.name]=value;this.trigger('field-changed',{dataPointID:this.dataPointId,changes:changes,viewType:this.viewType,doNotSetDirty:options&&options.doNotSetDirty,notifyChange:!options||options.notifyChange!==false,allowWarning:options&&options.allowWarning,onSuccess:resolve,onFailure:reject,});});}
_onKeydown(ev){switch(ev.which){case $.ui.keyCode.TAB:this.trigger('navigation-move',{direction:ev.shiftKey?'previous':'next',originalEvent:ev,});break;case $.ui.keyCode.ENTER:ev.preventDefault();ev.stopPropagation();this.trigger('navigation-move',{direction:'next_line'});break;case $.ui.keyCode.ESCAPE:this.trigger('navigation-move',{direction:'cancel',originalEvent:ev});break;case $.ui.keyCode.UP:ev.stopPropagation();this.trigger('navigation-move',{direction:'up'});break;case $.ui.keyCode.RIGHT:ev.stopPropagation();this.trigger('navigation-move',{direction:'right'});break;case $.ui.keyCode.DOWN:ev.stopPropagation();this.trigger('navigation-move',{direction:'down'});break;case $.ui.keyCode.LEFT:ev.stopPropagation();this.trigger('navigation-move',{direction:'left'});break;}}
_onNavigationMove(ev){ev.detail.target=this;}}
AbstractField.fieldDependencies={};AbstractField.specialData=false;AbstractField.supportedFieldTypes=[];AbstractField.description="";AbstractField.noLabel=false;AbstractField.label="";return AbstractField;});;

/* /web/static/src/js/fields/basic_fields_owl.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.basic_fields_owl',function(require){"use strict";const AbstractField=require('web.AbstractFieldOwl');const CustomCheckbox=require('web.CustomCheckbox');const{_lt}=require('web.translation');class FieldBadge extends AbstractField{_getClassFromDecoration(decoration){return`bg-${decoration.split('-')[1]}-light`;}}
FieldBadge.description=_lt("Badge");FieldBadge.supportedFieldTypes=['selection','many2one','char'];FieldBadge.template='web.FieldBadge';class FieldBoolean extends AbstractField{patched(){super.patched();if(this.props.event&&this.props.event.target===this){this.activate();}}
get focusableElement(){return this.mode==='readonly'?null:this.el.querySelector('input');}
get isSet(){return true;}
activate(options){const activated=super.activate(options);if(activated&&options&&options.event&&options.event.target.closest('.custom-control.custom-checkbox')){this._setValue(!this.value);}
return activated;}
setIdForLabel(id){super.setIdForLabel(id);this.el.querySelector('label').setAttribute('for',id);}
_onChange(ev){this._setValue(ev.target.checked);}
_onKeydown(ev){switch(ev.which){case $.ui.keyCode.ENTER:ev.preventDefault();this._setValue(!this.value);return;case $.ui.keyCode.UP:case $.ui.keyCode.RIGHT:case $.ui.keyCode.DOWN:case $.ui.keyCode.LEFT:ev.preventDefault();}
super._onKeydown(ev);}}
FieldBoolean.components={CustomCheckbox};FieldBoolean.description=_lt("Checkbox");FieldBoolean.supportedFieldTypes=['boolean'];FieldBoolean.template='web.FieldBoolean';return{FieldBadge,FieldBoolean,};});;

/* /web/static/src/js/views/abstract_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.AbstractView',function(require){"use strict";const ActionModel=require("web/static/src/js/views/action_model.js");var AbstractModel=require('web.AbstractModel');var AbstractRenderer=require('web.AbstractRenderer');var AbstractController=require('web.AbstractController');const ControlPanel=require('web.ControlPanel');const SearchPanel=require("web/static/src/js/views/search_panel.js");var mvc=require('web.mvc');var viewUtils=require('web.viewUtils');const{Component}=owl;var Factory=mvc.Factory;var AbstractView=Factory.extend({display_name:'',mobile_friendly:false,icon:'fa-question',multi_record:true,viewType:undefined,withSearchBar:true,searchMenuTypes:['filter','groupBy','favorite'],withControlPanel:true,withSearchPanel:true,config:_.extend({},Factory.prototype.config,{Model:AbstractModel,Renderer:AbstractRenderer,Controller:AbstractController,ControlPanel,SearchPanel,}),init:function(viewInfo,params){this._super.apply(this,arguments);var action=params.action||{};params=_.defaults(params,this._extractParamsFromAction(action));if(typeof viewInfo.arch==='string'){this.fieldsView=this._processFieldsView(viewInfo);}else{this.fieldsView=viewInfo;}
this.arch=this.fieldsView.arch;this.fields=this.fieldsView.viewFields;this.userContext=params.userContext||{};var isEmbedded=params.isEmbedded||false;var help=params.noContentHelp||"";var htmlHelp=document.createElement("div");htmlHelp.innerHTML=help;this.rendererParams={arch:this.arch,isEmbedded:isEmbedded,noContentHelp:htmlHelp.innerText.trim()?help:"",};this.controllerParams={actionViews:params.actionViews,activeActions:{edit:this.arch.attrs.edit?!!JSON.parse(this.arch.attrs.edit):true,create:this.arch.attrs.create?!!JSON.parse(this.arch.attrs.create):true,delete:this.arch.attrs.delete?!!JSON.parse(this.arch.attrs.delete):true,duplicate:this.arch.attrs.duplicate?!!JSON.parse(this.arch.attrs.duplicate):true,},bannerRoute:this.arch.attrs.banner_route,controllerID:params.controllerID,displayName:params.displayName,isEmbedded:isEmbedded,modelName:params.modelName,viewType:this.viewType,};var controllerState=params.controllerState||{};var currentId=controllerState.currentId||params.currentId;this.loadParams={context:params.context,count:params.count||((this.controllerParams.ids!==undefined)&&this.controllerParams.ids.length)||0,domain:params.domain,modelName:params.modelName,res_id:currentId,res_ids:controllerState.resIds||params.ids||(currentId?[currentId]:undefined),};const useSampleModel='useSampleModel'in params?params.useSampleModel:!!(this.arch.attrs.sample&&JSON.parse(this.arch.attrs.sample));this.modelParams={fields:this.fields,modelName:params.modelName,useSampleModel,};if(useSampleModel){this.modelParams.SampleModel=this.config.Model;}
var defaultOrder=this.arch.attrs.default_order;if(defaultOrder){this.loadParams.orderedBy=_.map(defaultOrder.split(','),function(order){order=order.trim().split(' ');return{name:order[0],asc:order[1]!=='desc'};});}
if(params.searchQuery){this._updateMVCParams(params.searchQuery);}
this.withControlPanel=this.withControlPanel&&params.withControlPanel;this.withSearchPanel=this.withSearchPanel&&this.multi_record&&params.withSearchPanel&&!('search_panel'in params.context&&!params.search_panel);const searchModelParams=Object.assign({},params,{action});if(this.withControlPanel||this.withSearchPanel){const{arch,fields,favoriteFilters}=params.controlPanelFieldsView||{};const archInfo=ActionModel.extractArchInfo({search:arch},this.viewType);const controlPanelInfo=archInfo[this.config.ControlPanel.modelExtension];const searchPanelInfo=archInfo[this.config.SearchPanel.modelExtension];this.withSearchPanel=this.withSearchPanel&&Boolean(searchPanelInfo);Object.assign(searchModelParams,{fields,favoriteFilters,controlPanelInfo,searchPanelInfo,});}
const searchModel=this._createSearchModel(searchModelParams);this.controllerParams.searchModel=searchModel;if(this.controllerParams.controlPanel){this.controllerParams.controlPanel.props.searchModel=searchModel;}
if(this.controllerParams.searchPanel){this.controllerParams.searchPanel.props.searchModel=searchModel;}},_createSearchModel:function(params,extraExtensions){const{fields,favoriteFilters,controlPanelInfo,searchPanelInfo}=params;const extensions=Object.assign({},extraExtensions);const importedState=params.controllerState||{};if(this.withControlPanel){const ControlPanelComponent=this.config.ControlPanel;extensions[ControlPanelComponent.modelExtension]={actionId:params.action.id,activateDefaultFavorite:params.activateDefaultFavorite,archNodes:controlPanelInfo.children,dynamicFilters:params.dynamicFilters,favoriteFilters,withSearchBar:params.withSearchBar,};this.controllerParams.withControlPanel=true;const controlPanelProps={action:params.action,breadcrumbs:params.breadcrumbs,fields,searchMenuTypes:params.searchMenuTypes,view:this.fieldsView,views:params.action.views&&params.action.views.filter(v=>v.multiRecord===this.multi_record),withBreadcrumbs:params.withBreadcrumbs,withSearchBar:params.withSearchBar,};this.controllerParams.controlPanel={Component:ControlPanelComponent,props:controlPanelProps,};}
if(this.withSearchPanel){const SearchPanelComponent=this.config.SearchPanel;extensions[SearchPanelComponent.modelExtension]={archNodes:searchPanelInfo.children,};this.controllerParams.withSearchPanel=true;this.rendererParams.withSearchPanel=true;const searchPanelProps={importedState:importedState.searchPanel,};if(searchPanelInfo.attrs.class){searchPanelProps.className=searchPanelInfo.attrs.class;}
this.controllerParams.searchPanel={Component:SearchPanelComponent,props:searchPanelProps,};}
const searchModel=new ActionModel(extensions,{env:Component.env,modelName:params.modelName,context:Object.assign({},this.loadParams.context),domain:this.loadParams.domain||[],importedState:importedState.searchModel,searchMenuTypes:params.searchMenuTypes,searchQuery:params.searchQuery,fields,});return searchModel;},getController:async function(){const _super=this._super.bind(this);const{searchModel}=this.controllerParams;await searchModel.load();this._updateMVCParams(searchModel.get("query"));const modelParent=this.model&&this.model.getParent();const[controller]=await Promise.all([_super(...arguments),searchModel.isReady(),]);if(modelParent){this.model.setParent(modelParent);}
return controller;},getModel:function(){if(!this.model){this.model=this._super.apply(this,arguments);}
return this.model;},setController:function(Controller){this.Controller=Controller;},_extractParamsFromAction:function(action){action=action||{};var context=action.context||{};var inline=action.target==='inline';const params={actionId:action.id||false,actionViews:action.views||[],activateDefaultFavorite:!context.active_id&&!context.active_ids,context:action.context||{},controlPanelFieldsView:action.controlPanelFieldsView,currentId:action.res_id?action.res_id:undefined,displayName:action.display_name||action.name,domain:action.domain||[],limit:action.limit,modelName:action.res_model,noContentHelp:action.help,searchMenuTypes:inline?[]:this.searchMenuTypes,withBreadcrumbs:'no_breadcrumbs'in context?!context.no_breadcrumbs:true,withControlPanel:this.withControlPanel,withSearchBar:inline?false:this.withSearchBar,withSearchPanel:this.withSearchPanel,};if('useSampleModel'in action){params.useSampleModel=action.useSampleModel;}
return params;},_processFieldsView:function(fieldsView){var fv=_.extend({},fieldsView);fv.arch=viewUtils.parseArch(fv.arch);fv.viewFields=_.defaults({},fv.viewFields,fv.fields);return fv;},_updateMVCParams:function(searchQuery){this.loadParams=_.extend(this.loadParams,{context:searchQuery.context,domain:searchQuery.domain,groupedBy:searchQuery.groupBy,});this.loadParams.orderedBy=Array.isArray(searchQuery.orderedBy)&&searchQuery.orderedBy.length?searchQuery.orderedBy:this.loadParams.orderedBy;if(searchQuery.timeRanges){this.loadParams.timeRanges=searchQuery.timeRanges;this.rendererParams.timeRanges=searchQuery.timeRanges;}},});return AbstractView;});;

/* /web/static/src/js/views/abstract_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.AbstractRenderer',function(require){"use strict";var mvc=require('web.mvc');const FOCUSABLE_ELEMENTS=['a','button','input','select','textarea','[tabindex="0"]'].map((sel)=>`:scope ${sel}`).join(', ');return mvc.Renderer.extend({sampleDataTargets:[],init:function(parent,state,params){this._super.apply(this,arguments);this.arch=params.arch;this.noContentHelp=params.noContentHelp;this.withSearchPanel=params.withSearchPanel;},async start(){this.$el.addClass(this.arch.attrs.class);if(this.withSearchPanel){this.$el.addClass('o_renderer_with_searchpanel');}
await Promise.all([this._render(),this._super()]);},on_attach_callback:function(){},on_detach_callback:function(){},getLocalState:function(){},giveFocus:function(){},setLocalState:function(localState){},async updateState(state,params){this._setState(state);if(!params.noRender){await this._render();}},async _render(){await this._renderView();this._suppressFocusableElements();},_renderNoContentHelper:function(context){let templateName;if(!context&&this.noContentHelp){templateName="web.ActionHelper";context={noContentHelp:this.noContentHelp};}else{templateName="web.NoContentHelper";}
const template=document.createElement('template');const owlQWeb=owl.Component.env.qweb;template.innerHTML=owlQWeb.renderToString(templateName,context);this.el.append(template.content.firstChild);},async _renderView(){},_setState(state=false){if(state!==false){this.state=state;}},_suppressFocusableElements(){if(!this.state.isSample||this.isEmbedded){return;}
const rootEls=[];for(const selector of this.sampleDataTargets){rootEls.push(...this.el.querySelectorAll(`:scope ${selector}`));}
const focusableEls=new Set(rootEls);for(const rootEl of rootEls){rootEl.classList.add('o_sample_data_disabled');for(const focusableEl of rootEl.querySelectorAll(FOCUSABLE_ELEMENTS)){focusableEls.add(focusableEl);}}
for(const focusableEl of focusableEls){focusableEl.setAttribute('tabindex',-1);if(focusableEl.classList.contains('dropdown-item')){focusableEl.classList.add('disabled');}}},});});;

/* /web/static/src/js/views/abstract_renderer_owl.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.AbstractRendererOwl',function(){"use strict";const FOCUSABLE_ELEMENTS=['a','button','input','select','textarea','[tabindex="0"]'].map((sel)=>`:scope ${sel}`).join(', ');class AbstractRenderer extends owl.Component{constructor(){super(...arguments);this.sampleDataTargets=[];}
mounted(){this._suppressFocusableElements();}
patched(){this._suppressFocusableElements();}
_suppressFocusableElements(){if(!this.props.isSample||this.props.isEmbedded){const disabledEls=this.el.querySelectorAll(`.o_sample_data_disabled`);disabledEls.forEach(el=>el.classList.remove('o_sample_data_disabled'));return;}
const rootEls=[];for(const selector of this.sampleDataTargets){rootEls.push(...this.el.querySelectorAll(`:scope ${selector}`));}
const focusableEls=new Set(rootEls);for(const rootEl of rootEls){rootEl.classList.add('o_sample_data_disabled');for(const focusableEl of rootEl.querySelectorAll(FOCUSABLE_ELEMENTS)){focusableEls.add(focusableEl);}}
for(const focusableEl of focusableEls){focusableEl.setAttribute('tabindex',-1);if(focusableEl.classList.contains('dropdown-item')){focusableEl.classList.add('disabled');}}}}
return AbstractRenderer;});;

/* /web/static/src/js/views/abstract_model.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.AbstractModel',function(require){"use strict";var fieldUtils=require('web.field_utils');var mvc=require('web.mvc');const SampleServer=require('web.SampleServer');var AbstractModel=mvc.Model.extend({init(parent,params={}){this._super(...arguments);this.useSampleModel=params.useSampleModel||false;if(params.isSampleModel){this.isSampleModel=true;this.sampleServer=new SampleServer(params.modelName,params.fields);}else if(this.useSampleModel){const sampleModelParams=Object.assign({},params,{isSampleModel:true,SampleModel:null,useSampleModel:false,});this.sampleModel=new params.SampleModel(this,sampleModelParams);this._isInSampleMode=false;}},get(_,options){let state;if(options&&options.withSampleData&&this._isInSampleMode){state=this.sampleModel.__get(...arguments);}else{state=this.__get(...arguments);}
return state;},isInSampleMode(){return!!this._isInSampleMode;},leaveSampleMode(){if(this.useSampleModel){this.useSampleModel=false;this._isInSampleMode=false;this.sampleModel.destroy();}},async load(params){this.loadParams=params;const handle=await this.__load(...arguments);await this._callSampleModel('__load',handle,...arguments);return handle;},async reload(_,params){const handle=await this.__reload(...arguments);if(this._isInSampleMode){if(!this._haveParamsChanged(params)){await this._callSampleModel('__reload',handle,...arguments);}else{this.leaveSampleMode();}}
return handle;},async _callSampleModel(method,handle,...args){if(this.useSampleModel&&this._isEmpty(handle)){try{if(method==='__load'){await this.sampleModel.__load(...args);}else if(method==='__reload'){await this.sampleModel.__reload(...args);}
this._isInSampleMode=true;}catch(error){if(error instanceof SampleServer.UnimplementedRouteError){this.leaveSampleMode();}else{throw error;}}}else{this.leaveSampleMode();}},__get(){return{};},_isEmpty(){return false;},async __load(){return Promise.resolve();},_parseServerValue:function(field,value){if(field.type==='date'||field.type==='datetime'){value=fieldUtils.parse[field.type](value,field,{isUTC:true});}else if(field.type==='selection'&&value===false){var hasKey0=_.find(field.selection,function(option){return option[0]===0;});value=hasKey0?0:value;}
return value;},async __reload(){return Promise.resolve();},_haveParamsChanged(params={}){for(const key of['context','domain','timeRanges']){if(key in params){const diff=JSON.stringify(params[key])!==JSON.stringify(this.loadParams[key]);if(diff){return true;}}}
if(this.useSampleModel&&'groupBy'in params){return JSON.stringify(params.groupBy)!==JSON.stringify(this.loadParams.groupedBy);}},async _rpc(){if(this.isSampleModel){return this.sampleServer.mockRpc(...arguments);}
return this._super(...arguments);},});return AbstractModel;});;

/* /web/static/src/js/model.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("web/static/src/js/model.js",function(require){"use strict";const{groupBy,partitionBy}=require("web.utils");const Registry=require("web.Registry");const{Component,core}=owl;const{EventBus,Observer}=core;const isNotNull=(val)=>val!==null&&val!==undefined;class ModelExtension{constructor(config){this.config=config;this.env=this.config.env;this.shouldLoad=true;this.state={};}
async callLoad(params){if(this.shouldLoad){this.shouldLoad=false;await this.load(params);}}
dispatch(method,...args){if(method in this){this[method](...args);}}
exportState(){return this.state;}
get(){return null;}
importState(state){this.shouldLoad=!state;if(this.shouldLoad){this.prepareState();}else{Object.assign(this.state,state);}}
async load(){}
prepareState(){}}
ModelExtension.layer=0;class Model extends EventBus{constructor(extensions={},globalConfig={}){super();this.config=globalConfig;this.env=this.config.env;this.dispatching=false;this.extensions=[];this.externalState={};this.mapping={};this.rev=1;const{name,registry}=this.constructor;if(!registry||!(registry instanceof Registry)){throw new Error(`Unimplemented registry on model "${name}".`);}
const registryExtensions=Object.entries(registry.entries());const extensionNameLayers=registryExtensions.map(([name,{layer}])=>({name,layer}));const groupedNameLayers=groupBy(extensionNameLayers,"layer");for(const groupNameLayers of Object.values(groupedNameLayers)){for(const{name}of groupNameLayers){if(name in extensions){this.addExtension(name,extensions[name]);}}}
this.importState(this.config.importedState);}
addExtension(extensionName,extensionConfig){const{name,registry}=this.constructor;const Extension=registry.get(extensionName);if(!Extension){throw new Error(`Unknown model extension "${extensionName}" in model "${name}"`);}
const get=this.__get.bind(this,Extension.name);const trigger=this.trigger.bind(this);const config=Object.assign({get,trigger},this.config,extensionConfig);const extension=new Extension(config);if(!(Extension.layer in this.extensions)){this.extensions[Extension.layer]=[];}
this.extensions[Extension.layer].push(extension);}
dispatch(method,...args){const isInitialDispatch=!this.dispatching;this.dispatching=true;for(const extension of this.extensions.flat()){extension.dispatch(method,...args);}
if(!isInitialDispatch){return;}
this.dispatching=false;let rev=this.rev;this._loadExtensions({isInitialLoad:false}).then(()=>{if(rev===this.rev){this._notifyComponents();}});}
exportState(){const exported={};for(const extension of this.extensions.flat()){exported[extension.constructor.name]=extension.exportState();}
const fullState=Object.assign({},this.externalState,exported);return JSON.stringify(fullState);}
get(property,...args){for(const extension of this.extensions.flat()){const result=extension.get(property,...args);if(isNotNull(result)){return result;}}
return null;}
importState(stringifiedState="null"){const state=JSON.parse(stringifiedState)||{};Object.assign(this.externalState,state);for(const extension of this.extensions.flat()){extension.importState(state[extension.constructor.name]);}}
async load(){await this._loadExtensions({isInitialLoad:true});}
__get(excluded,property,...args){const results=[];for(const extension of this.extensions.flat()){if(extension.constructor.name!==excluded){const result=extension.get(property,...args);if(isNotNull(result)){results.push(result);}}}
return results;}
async _loadExtensions(params){for(let layer=0;layer<this.extensions.length;layer++){await Promise.all(this.extensions[layer].map((extension)=>extension.callLoad(params)));}}
async _notifyComponents(){const rev=++this.rev;const subscriptions=this.subscriptions.update;const groups=partitionBy(subscriptions,(s)=>s.owner?s.owner.__owl__.depth:-1);for(let group of groups){const proms=group.map((sub)=>sub.callback.call(sub.owner,rev));Component.scheduler.flush();await Promise.all(proms);}}}
Model.Extension=ModelExtension;function useModel(modelName){const component=Component.current;const model=component.env[modelName];if(!(model instanceof Model)){throw new Error(`No Model found when connecting '${
                component.name
                }'`);}
const mapping=model.mapping;const __owl__=component.__owl__;const componentId=__owl__.id;if(!__owl__.observer){__owl__.observer=new Observer();__owl__.observer.notifyCB=component.render.bind(component);}
const currentCB=__owl__.observer.notifyCB;__owl__.observer.notifyCB=function(){if(model.rev>mapping[componentId]){return;}
currentCB();};mapping[componentId]=0;const renderFn=__owl__.renderFn;__owl__.renderFn=function(comp,params){mapping[componentId]=model.rev;return renderFn(comp,params);};model.on("update",component,async(modelRev)=>{if(mapping[componentId]<modelRev){mapping[componentId]=modelRev;await component.render();}});const __destroy=component.__destroy;component.__destroy=(parent)=>{model.off("update",component);__destroy.call(component,parent);};return model;}
return{Model,useModel,};});;

/* /web/static/src/js/views/abstract_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.AbstractController',function(require){"use strict";var ActionMixin=require('web.ActionMixin');var ajax=require('web.ajax');var concurrency=require('web.concurrency');const{ComponentWrapper}=require('web.OwlCompatibility');var mvc=require('web.mvc');var session=require('web.session');var AbstractController=mvc.Controller.extend(ActionMixin,{custom_events:_.extend({},ActionMixin.custom_events,{navigation_move:'_onNavigationMove',open_record:'_onOpenRecord',switch_view:'_onSwitchView',}),events:{'click a[type="action"]':'_onActionClicked',},init:function(parent,model,renderer,params){this._super.apply(this,arguments);this._title=params.displayName;this.modelName=params.modelName;this.activeActions=params.activeActions;this.controllerID=params.controllerID;this.initialState=params.initialState;this.bannerRoute=params.bannerRoute;this.actionViews=params.actionViews;this.viewType=params.viewType;this.dp=new concurrency.DropPrevious();this.withControlPanel=params.withControlPanel;this.withSearchPanel=params.withSearchPanel;if(params.searchModel){this.searchModel=params.searchModel;}
if(this.withControlPanel){const{Component,props}=params.controlPanel;this.ControlPanel=Component;this.controlPanelProps=props;}
if(this.withSearchPanel){const{Component,props}=params.searchPanel;this.SearchPanel=Component;this.searchPanelProps=props;}},start:async function(){this.$el.addClass('o_view_controller');this.renderButtons();const promises=[this._super(...arguments)];if(this.withControlPanel){this._updateControlPanelProps(this.initialState);this._controlPanelWrapper=new ComponentWrapper(this,this.ControlPanel,this.controlPanelProps);this._controlPanelWrapper.env.bus.on('focus-view',this,()=>this._giveFocus());promises.push(this._controlPanelWrapper.mount(this.el,{position:'first-child'}));}
if(this.withSearchPanel){this._searchPanelWrapper=new ComponentWrapper(this,this.SearchPanel,this.searchPanelProps);const content=this.el.querySelector(':scope .o_content');content.classList.add('o_controller_with_searchpanel');promises.push(this._searchPanelWrapper.mount(content,{position:'first-child'}));}
await Promise.all(promises);await this._update(this.initialState,{shouldUpdateSearchComponents:false});this.updateButtons();this.el.classList.toggle('o_view_sample_data',this.model.isInSampleMode());},destroy:function(){if(this.$buttons){this.$buttons.off();}
ActionMixin.destroy.call(this);this._super.apply(this,arguments);},on_attach_callback:function(){ActionMixin.on_attach_callback.call(this);this.searchModel.on('search',this,this._onSearch);if(this.withControlPanel){this.searchModel.on('get-controller-query-params',this,this._onGetOwnedQueryParams);}
if(!(this.renderer instanceof owl.Component)){this.renderer.on_attach_callback();}},on_detach_callback:function(){ActionMixin.on_detach_callback.call(this);this.searchModel.off('search',this);if(this.withControlPanel){this.searchModel.off('get-controller-query-params',this);}
if(!(this.renderer instanceof owl.Component)){this.renderer.on_detach_callback();}},canBeRemoved:function(){return this.discardChanges(undefined,{noAbandon:true,readonlyIfRealDiscard:true,});},discardChanges:function(recordID,options){return Promise.resolve();},exportState(){const exported={searchModel:this.searchModel.exportState(),};if(this.withSearchPanel){const searchPanel=this._searchPanelWrapper.componentRef.comp;exported.searchPanel=searchPanel.exportState();}
return exported;},importState(state){this.searchModel.importState(state.searchModel);if(this.withSearchPanel){const searchPanel=this._searchPanelWrapper.componentRef.comp;searchPanel.importState(state.searchPanel);}},is_action_enabled:function(action){return this.activeActions[action];},reload:async function(params={}){if(params.controllerState){this.importState(params.controllerState);Object.assign(params,this.searchModel.get('query'));}
return this.update(params,{});},async update(params,options={}){const shouldReload='reload'in options?options.reload:true;if(shouldReload){this.handle=await this.dp.add(this.model.reload(this.handle,params));}
const localState=this.renderer.getLocalState();const state=this.model.get(this.handle,{withSampleData:true});const promises=[this._updateRendererState(state,params).then(()=>{this.renderer.setLocalState(localState);}),this._update(this.model.get(this.handle),params)];await this.dp.add(Promise.all(promises));this.updateButtons();this.el.classList.toggle('o_view_sample_data',this.model.isInSampleMode());},_getPagingInfo:function(state){return null;},_getActionMenuItems:function(state){return null;},_giveFocus(){if(!this.model.isInSampleMode()){this.renderer.giveFocus();}},_pushState:function(){this.trigger_up('push_state',{controllerID:this.controllerID,state:this.getState(),});},async _removeSampleData(callback){this.model.leaveSampleMode();if(callback){await callback();}
this.el.classList.remove('o_view_sample_data');},_renderBanner:async function(){if(this.bannerRoute!==undefined){const response=await this._rpc({route:this.bannerRoute});if(!response.html){this.$el.removeClass('o_has_banner');return Promise.resolve();}
this.$el.addClass('o_has_banner');var $banner=$(response.html);if(this._$banner&&this._$banner.remove){this._$banner.remove();}
var defs=[];$('link[rel="stylesheet"]',$banner).each(function(i,link){defs.push(ajax.loadCSS(link.href));link.remove();});$('script[type="text/javascript"]',$banner).each(function(i,js){defs.push(ajax.loadJS(js.src));js.remove();});await Promise.all(defs);$banner.insertBefore(this.$('> .o_content'));this._$banner=$banner;}},_startRenderer:function(){if(this.renderer instanceof owl.Component){return this.renderer.mount(this.$('.o_content')[0]);}
return this.renderer.appendTo(this.$('.o_content'));},async _update(state,params){if(!this.$buttons){this.renderButtons();}
const promises=[this._renderBanner()];if(params.shouldUpdateSearchComponents!==false){if(this.withControlPanel){this._updateControlPanelProps(state);if(params.breadcrumbs){this.controlPanelProps.breadcrumbs=params.breadcrumbs;}
promises.push(this.updateControlPanel());}
if(this.withSearchPanel){this._updateSearchPanel();}}
this._pushState();await Promise.all(promises);},_updateControlPanelProps(state){if(!this.controlPanelProps.cp_content){this.controlPanelProps.cp_content={};}
if(this.$buttons){this.controlPanelProps.cp_content.$buttons=this.$buttons;}
Object.assign(this.controlPanelProps,{actionMenus:this._getActionMenuItems(state),pager:this._getPagingInfo(state),title:this.getTitle(),});},_updatePaging:async function(state,newProps){const pagingInfo=this._getPagingInfo(state);if(pagingInfo){Object.assign(pagingInfo,newProps);return this.updateControlPanel({pager:pagingInfo});}},_updateRendererState(state,params={}){if(this.renderer instanceof owl.Component){return this.renderer.update(state);}
return this.renderer.updateState(state,params);},async _updateSearchPanel(newProps){Object.assign(this.searchPanelProps,newProps);await this._searchPanelWrapper.update(this.searchPanelProps);},_onActionClicked:function(ev){ev.preventDefault();var $target=$(ev.currentTarget);var self=this;var data=$target.data();if(data.method!==undefined&&data.model!==undefined){var options={};if(data.reloadOnClose){options.on_close=function(){self.trigger_up('reload');};}
this.dp.add(this._rpc({model:data.model,method:data.method,context:session.user_context,})).then(function(action){if(action!==undefined){self.do_action(action,options);}});}else if($target.attr('name')){this.do_action($target.attr('name'),data.context&&{additional_context:data.context});}else{this.do_action({name:$target.attr('title')||_.str.strip($target.text()),type:'ir.actions.act_window',res_model:data.model||this.modelName,res_id:data.resId,target:'current',views:data.views||(data.resId?[[false,'form']]:[[false,'list'],[false,'form']]),domain:data.domain||[],},{additional_context:_.extend({},data.context)});}},_onNavigationMove:function(ev){switch(ev.data.direction){case'up':ev.stopPropagation();this.searchModel.trigger('focus-control-panel');break;case'down':ev.stopPropagation();this._giveFocus();break;}},_onOpenRecord:function(ev){ev.stopPropagation();var record=this.model.get(ev.data.id,{raw:true});this.trigger_up('switch_view',{view_type:'form',res_id:record.res_id,mode:ev.data.mode||'readonly',model:this.modelName,});},_onSearch:function(searchQuery){this.reload(_.extend({offset:0,groupsOffset:0},searchQuery));},_onSwitchView:function(ev){ev.data.controllerID=this.controllerID;},});return AbstractController;});;

/* /web/static/src/js/views/renderer_wrapper.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.RendererWrapper',function(require){"use strict";const{ComponentWrapper}=require('web.OwlCompatibility');class RendererWrapper extends ComponentWrapper{getLocalState(){}
setLocalState(){}
giveFocus(){}}
return RendererWrapper;});;

/* /web/static/src/js/views/basic/basic_model.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.BasicModel',function(require){"use strict";var AbstractModel=require('web.AbstractModel');var concurrency=require('web.concurrency');var Context=require('web.Context');var core=require('web.core');var Domain=require('web.Domain');const pyUtils=require('web.py_utils');var session=require('web.session');var utils=require('web.utils');var viewUtils=require('web.viewUtils');var localStorage=require('web.local_storage');var _t=core._t;const AGGREGATABLE_TYPES=['float','integer','monetary'];var x2ManyCommands={CREATE:0,create:function(virtualID,values){delete values.id;return[x2ManyCommands.CREATE,virtualID||false,values];},UPDATE:1,update:function(id,values){delete values.id;return[x2ManyCommands.UPDATE,id,values];},DELETE:2,delete:function(id){return[x2ManyCommands.DELETE,id,false];},FORGET:3,forget:function(id){return[x2ManyCommands.FORGET,id,false];},LINK_TO:4,link_to:function(id){return[x2ManyCommands.LINK_TO,id,false];},DELETE_ALL:5,delete_all:function(){return[5,false,false];},REPLACE_WITH:6,replace_with:function(ids){return[6,false,ids];}};var BasicModel=AbstractModel.extend({OPEN_GROUP_LIMIT:10,noCacheModels:['ir.actions.act_window','ir.filters','ir.ui.view',],init:function(){this.mutex=new concurrency.Mutex();this.batchedRPCsRequests=[];this.localData=Object.create(null);this.__id=0;this._super.apply(this,arguments);},addDefaultRecord:function(listID,options){var self=this;var list=this.localData[listID];var context=_.extend({},this._getDefaultContext(list),this._getContext(list));var position=(options&&options.position)||'top';var params={context:context,fields:list.fields,fieldsInfo:list.fieldsInfo,parentID:list.id,position:position,viewType:list.viewType,};return this._makeDefaultRecord(list.model,params).then(function(id){list.count++;if(position==='top'){list.data.unshift(id);}else{list.data.push(id);}
var record=self.localData[id];list._cache[record.res_id]=id;return id;});},addFieldsInfo:function(dataPointID,viewInfo){var dataPoint=this.localData[dataPointID];dataPoint.fields=_.extend({},dataPoint.fields,viewInfo.fields);dataPoint.fieldsInfo=dataPoint.fieldsInfo||{};const mainFieldInfo=dataPoint.fieldsInfo[dataPoint[viewInfo.viewType]];dataPoint.fieldsInfo[viewInfo.viewType]=_.defaults({},viewInfo.fieldInfo,mainFieldInfo);return this.applyRawChanges(dataPointID,viewInfo.viewType).then(()=>{const proms=[];const fieldInfo=dataPoint.fieldsInfo[viewInfo.viewType];if(dataPoint.type==='list'){Object.values(dataPoint._cache).forEach(subDataPointID=>{proms.push(this.addFieldsInfo(subDataPointID,{fields:dataPoint.fields,fieldInfo:dataPoint.fieldsInfo[viewInfo.viewType],viewType:viewInfo.viewType,}));});}else{const values=_.extend({},dataPoint.data,dataPoint._changes);Object.keys(fieldInfo).forEach(fieldName=>{const fieldType=dataPoint.fields[fieldName].type;if(fieldType==='one2many'||fieldType==='many2many'){const mode=fieldInfo[fieldName].mode;const views=fieldInfo[fieldName].views;const x2mDataPointID=values[fieldName];if(views[mode]&&x2mDataPointID){proms.push(this.addFieldsInfo(x2mDataPointID,{fields:views[mode].fields,fieldInfo:views[mode].fieldsInfo[mode],viewType:mode,}));}}});}
return Promise.all(proms);});},applyRawChanges:function(recordID,viewType){var record=this.localData[recordID];return this._applyOnChange(record._rawChanges,record,{viewType}).then(function(){return record.id;});},canBeAbandoned:function(id){if(this.localData[id]._noAbandon){return false;}
var record=this.localData[id];var parent=this.localData[record.parentID];if(parent){var entry=_.findWhere(parent._savePoint,{operation:'ADD',id:id});if(entry){if(!entry.isNew){return false;}
var lastEntry=_.last(parent._savePoint);if(lastEntry.operation==='UPDATE'&&lastEntry.id===id){return false;}}}
return this.isNew(id);},deleteRecords:function(recordIds,modelName){var self=this;var records=_.map(recordIds,function(id){return self.localData[id];});var context=_.extend(records[0].getContext(),session.user_context);return this._rpc({model:modelName,method:'unlink',args:[_.pluck(records,'res_id')],context:context,}).then(function(){_.each(records,function(record){var parent=record.parentID&&self.localData[record.parentID];if(parent&&parent.type==='list'){parent.data=_.without(parent.data,record.id);delete self.localData[record.id];}else{record.res_ids.splice(record.offset,1);record.offset=Math.min(record.offset,record.res_ids.length-1);record.res_id=record.res_ids[record.offset];record.count--;}});self._invalidateCache(records[0]);});},discardChanges:function(id,options){options=options||{};var element=this.localData[id];var isNew=this.isNew(id);var rollback='rollback'in options?options.rollback:isNew;var initialOffset=element.offset;element._domains={};this._visitChildren(element,function(elem){if(rollback&&elem._savePoint){if(elem._savePoint instanceof Array){elem._changes=elem._savePoint.slice(0);}else{elem._changes=_.extend({},elem._savePoint);}
elem._isDirty=!isNew;}else{elem._changes=null;elem._isDirty=false;}
elem.offset=0;if(elem.tempLimitIncrement){elem.limit-=elem.tempLimitIncrement;delete elem.tempLimitIncrement;}});element.offset=initialOffset;},duplicateRecord:function(recordID){var self=this;var record=this.localData[recordID];var context=this._getContext(record);return this._rpc({model:record.model,method:'copy',args:[record.data.id],context:context,}).then(function(res_id){var index=record.res_ids.indexOf(record.res_id);record.res_ids.splice(index+1,0,res_id);return self.load({fieldsInfo:record.fieldsInfo,fields:record.fields,modelName:record.model,res_id:res_id,res_ids:record.res_ids.slice(0),viewType:record.viewType,context:context,});});},freezeOrder:function(listID){var list=this.localData[listID];if(list.type==='record'){return;}
list=this._applyX2ManyOperations(list);this._sortList(list);this.localData[listID].orderedResIDs=list.res_ids;},__get:function(id,options){var self=this;options=options||{};if(!(id in this.localData)){return null;}
var element=this.localData[id];if(options.env){var env={ids:element.res_ids?element.res_ids.slice(0):[],};if(element.type==='record'){env.currentId=this.isNew(element.id)?undefined:element.res_id;}
return env;}
if(element.type==='record'){var data=_.extend({},element.data,element._changes);var relDataPoint;for(var fieldName in data){var field=element.fields[fieldName];if(data[fieldName]===null){data[fieldName]=false;}
if(!field){continue;}
if(field.type==='many2one'){if(options.raw){relDataPoint=this.localData[data[fieldName]];data[fieldName]=relDataPoint?relDataPoint.res_id:false;}else{data[fieldName]=this.__get(data[fieldName])||false;}}else if(field.type==='reference'){if(options.raw){relDataPoint=this.localData[data[fieldName]];data[fieldName]=relDataPoint?relDataPoint.model+','+relDataPoint.res_id:false;}else{data[fieldName]=this.__get(data[fieldName])||false;}}else if(field.type==='one2many'||field.type==='many2many'){if(options.raw){if(typeof data[fieldName]==='string'){relDataPoint=this.localData[data[fieldName]];relDataPoint=this._applyX2ManyOperations(relDataPoint);data[fieldName]=relDataPoint.res_ids;}else{data[fieldName]=data[fieldName]||[];}}else{data[fieldName]=this.__get(data[fieldName])||[];}}}
var record={context:_.extend({},element.context),count:element.count,data:data,domain:element.domain.slice(0),evalModifiers:element.evalModifiers,fields:element.fields,fieldsInfo:element.fieldsInfo,getContext:element.getContext,getDomain:element.getDomain,getFieldNames:element.getFieldNames,id:element.id,isDirty:element.isDirty,limit:element.limit,model:element.model,offset:element.offset,ref:element.ref,res_ids:element.res_ids.slice(0),specialData:_.extend({},element.specialData),type:'record',viewType:element.viewType,};if(!this.isNew(element.id)){record.res_id=element.res_id;}
var evalContext;Object.defineProperty(record,'evalContext',{get:function(){evalContext=evalContext||self._getEvalContext(element);return evalContext;},});return record;}
element=this._applyX2ManyOperations(element);this._sortList(element);if(!element.orderedResIDs&&element._changes){_.each(element._changes,function(change){if(change.operation==='ADD'&&change.isNew){element.data=_.without(element.data,change.id);if(change.position==='top'){element.data.unshift(change.id);}else{element.data.push(change.id);}}});}
var list={aggregateValues:_.extend({},element.aggregateValues),context:_.extend({},element.context),count:element.count,data:_.map(element.data,function(elemID){return self.__get(elemID,options);}),domain:element.domain.slice(0),fields:element.fields,getContext:element.getContext,getDomain:element.getDomain,getFieldNames:element.getFieldNames,groupedBy:element.groupedBy,groupsCount:element.groupsCount,groupsLimit:element.groupsLimit,groupsOffset:element.groupsOffset,id:element.id,isDirty:element.isDirty,isOpen:element.isOpen,isSample:this.isSampleModel,limit:element.limit,model:element.model,offset:element.offset,orderedBy:element.orderedBy,res_id:element.res_id,res_ids:element.res_ids.slice(0),type:'list',value:element.value,viewType:element.viewType,};if(element.fieldsInfo){list.fieldsInfo=element.fieldsInfo;}
return list;},generateDefaultValues(recordID,options={}){const record=this.localData[recordID];const viewType=options.viewType||record.viewType;const fieldNames=options.fieldNames||Object.keys(record.fieldsInfo[viewType]);const numericFields=['float','integer','monetary'];const proms=[];record._changes=record._changes||{};fieldNames.forEach(fieldName=>{record.data[fieldName]=null;if(!(fieldName in record._changes)){const field=record.fields[fieldName];if(numericFields.includes(field.type)){record._changes[fieldName]=0;}else if(field.type==='one2many'||field.type==='many2many'){proms.push(this._processX2ManyCommands(record,fieldName,[],options));}else{record._changes[fieldName]=null;}}});return Promise.all(proms);},getName:function(id){var record=this.localData[id];var returnValue='';if(record._changes&&'display_name'in record._changes){returnValue=record._changes.display_name;}
else if('display_name'in record.data){returnValue=record.data.display_name;}
return returnValue||_t("New");},isDirty:function(id){var isDirty=false;this._visitChildren(this.localData[id],function(r){if(r._isDirty){isDirty=true;}});return isDirty;},_isEmpty(dataPointID){const dataPoint=this.localData[dataPointID];if(dataPoint.type==='list'){const hasRecords=dataPoint.count===0;if(dataPoint.groupedBy.length){return dataPoint.data.length>0&&hasRecords;}else{return hasRecords;}}
return false;},isNew:function(id){var data=this.localData[id];if(data.type!=="record"){return false;}
var res_id=data.res_id;if(typeof res_id==='number'){return false;}else if(typeof res_id==='string'&&/^[0-9]+-/.test(res_id)){return false;}
return true;},__load:async function(params){await this._super(...arguments);params.type=params.type||(params.res_id!==undefined?'record':'list');params.viewType=params.viewType||'default';if(!params.fieldsInfo){var fieldsInfo={};for(var fieldName in params.fieldNames){fieldsInfo[params.fieldNames[fieldName]]={};}
params.fieldsInfo={};params.fieldsInfo[params.viewType]=fieldsInfo;}
if(params.type==='record'&&params.res_id===undefined){params.allowWarning=true;return this._makeDefaultRecord(params.modelName,params);}
var dataPoint=this._makeDataPoint(params);return this._load(dataPoint).then(function(){return dataPoint.id;});},localIdsToResIds:function(localIds){return localIds.map(localId=>this.localData[localId].res_id);},makeRecord:function(model,fields,fieldInfo){var self=this;var defs=[];var record_fields={};_.each(fields,function(field){record_fields[field.name]=_.pick(field,'type','relation','domain','selection');});fieldInfo=fieldInfo||{};var fieldsInfo={};fieldsInfo.default={};_.each(fields,function(field){fieldsInfo.default[field.name]=fieldInfo[field.name]||{};});var record=this._makeDataPoint({modelName:model,fields:record_fields,fieldsInfo:fieldsInfo,viewType:'default',});_.each(fields,function(field){var dataPoint;record.data[field.name]=null;if(field.type==='many2one'){if(field.value){var id=_.isArray(field.value)?field.value[0]:field.value;var display_name=_.isArray(field.value)?field.value[1]:undefined;dataPoint=self._makeDataPoint({modelName:field.relation,data:{id:id,display_name:display_name,},parentID:record.id,});record.data[field.name]=dataPoint.id;if(display_name===undefined){defs.push(self._fetchNameGet(dataPoint));}}}else if(field.type==='reference'&&field.value){const ref=field.value.split(',');dataPoint=self._makeDataPoint({context:record.context,data:{id:parseInt(ref[1],10)},modelName:ref[0],parentID:record.id,});defs.push(self._fetchNameGet(dataPoint));record.data[field.name]=dataPoint.id;}else if(field.type==='one2many'||field.type==='many2many'){var relatedFieldsInfo={};relatedFieldsInfo.default={};_.each(field.fields,function(field){relatedFieldsInfo.default[field.name]={};});var dpParams={fieldsInfo:relatedFieldsInfo,modelName:field.relation,parentID:record.id,static:true,type:'list',viewType:'default',};var needLoad=false;if(field.value&&field.value.length){if(_.isObject(field.value[0])){dpParams.res_ids=_.pluck(field.value,'id');dataPoint=self._makeDataPoint(dpParams);_.each(field.value,function(data){var recordDP=self._makeDataPoint({data:data,modelName:field.relation,parentID:dataPoint.id,type:'record',});dataPoint.data.push(recordDP.id);dataPoint._cache[recordDP.res_id]=recordDP.id;});}else{dpParams.res_ids=field.value;dataPoint=self._makeDataPoint(dpParams);needLoad=true;}}else{dpParams.res_ids=[];dataPoint=self._makeDataPoint(dpParams);}
if(needLoad){defs.push(self._load(dataPoint));}
record.data[field.name]=dataPoint.id;}else if(field.value){record.data[field.name]=field.value;}});return Promise.all(defs).then(function(){return record.id;});},notifyChanges:function(record_id,changes,options){return this.mutex.exec(this._applyChange.bind(this,record_id,changes,options));},__reload:async function(id,options){await this._super(...arguments);return this.mutex.exec(this._reload.bind(this,id,options));},removeLine:function(elementID){var record=this.localData[elementID];var parent=this.localData[record.parentID];if(parent.static){parent._changes=_.filter(parent._changes,function(change){if(change.id===elementID&&change.operation==='ADD'&&parent.tempLimitIncrement){parent.tempLimitIncrement--;parent.limit--;}
return change.id!==elementID;});}else{parent.data=_.without(parent.data,elementID);parent.count--;}},resequence:function(modelName,resIDs,parentID,options){options=options||{};if((resIDs.length<=1)){return Promise.resolve(parentID);}
var self=this;var data=this.localData[parentID];var params={model:modelName,ids:resIDs,};if(options.offset){params.offset=options.offset;}
if(options.field){params.field=options.field;}
return this._rpc({route:'/web/dataset/resequence',params:params,}).then(function(wasResequenced){if(!wasResequenced){return Promise.resolve();}
var field=params.field?params.field:'sequence';return self._rpc({model:modelName,method:'read',args:[resIDs,[field]],}).then(function(records){if(data.data.length){var dataType=self.localData[data.data[0]].type;if(dataType==='record'){_.each(data.data,function(dataPoint){var recordData=self.localData[dataPoint].data;var inRecords=_.findWhere(records,{id:recordData.id});if(inRecords){recordData[field]=inRecords[field];}});data.data=_.sortBy(data.data,function(d){return self.localData[d].data[field];});}
if(dataType==='list'){data.data=_.sortBy(data.data,function(d){return _.indexOf(resIDs,self.localData[d].res_id)});}}
data.res_ids=[];_.each(data.data,function(d){var dataPoint=self.localData[d];if(dataPoint.type==='record'){data.res_ids.push(dataPoint.res_id);}else{data.res_ids=data.res_ids.concat(dataPoint.res_ids);}});self._updateParentResIDs(data);return parentID;})});},save:function(recordID,options){var self=this;return this.mutex.exec(function(){options=options||{};var record=self.localData[recordID];if(options.savePoint){self._visitChildren(record,function(rec){var newValue=rec._changes||rec.data;if(newValue instanceof Array){rec._savePoint=newValue.slice(0);}else{rec._savePoint=_.extend({},newValue);}});_.each((record._changes||{}),function(value,fieldName){record._editionViewType[fieldName]=options.viewType;});}
var shouldReload='reload'in options?options.reload:true;var method=self.isNew(recordID)?'create':'write';if(record._changes){delete record._changes.id;}
var changes=self._generateChanges(record,{viewType:options.viewType,changesOnly:method!=='create'});delete changes.id;if(method==='create'){var fieldNames=record.getFieldNames();_.each(fieldNames,function(name){if(changes[name]===null){delete changes[name];}});}
var prom=new Promise(function(resolve,reject){var changedFields=Object.keys(changes);if(options.savePoint){resolve(changedFields);return;}
if(method==='create'||changedFields.length){var args=method==='write'?[[record.data.id],changes]:[changes];self._rpc({model:record.model,method:method,args:args,context:record.getContext(),}).then(function(id){if(method==='create'){record.res_id=id;record.data.id=id;record.offset=record.res_ids.length;record.res_ids.push(id);record.count++;}
var _changes=record._changes;record._changes={};self._invalidateCache(record);self.unfreezeOrder(record.id);if(shouldReload){self._fetchRecord(record).then(function(){resolve(changedFields);});}else{_.extend(record.data,_changes);resolve(changedFields);}}).guardedCatch(reject);}else{resolve(changedFields);}});prom.then(function(){record._isDirty=false;});return prom;});},setDirty:function(id){this.localData[id]._isDirty=true;},setSort:function(list_id,fieldName){var list=this.localData[list_id];if(list.type==='record'){return;}else if(list._changes){_.each(list._changes,function(change){delete change.isNew;});}
if(list.orderedBy.length===0){list.orderedBy.push({name:fieldName,asc:true});}else if(list.orderedBy[0].name===fieldName){if(!list.orderedResIDs){list.orderedBy[0].asc=!list.orderedBy[0].asc;}}else{var orderedBy=_.reject(list.orderedBy,function(o){return o.name===fieldName;});list.orderedBy=[{name:fieldName,asc:true}].concat(orderedBy);}
list.orderedResIDs=null;if(list.static){return this._fetchUngroupedList(list);}
return Promise.resolve();},getActiveField:function(record){const fields=Object.keys(record.fields);const has_active=fields.includes('active');if(has_active){return'active';}
const has_x_active=fields.includes('x_active');return has_x_active?'x_active':undefined},toggleActive:function(recordIDs,parentID){var self=this;var parent=this.localData[parentID];var resIDs=_.map(recordIDs,function(recordID){return self.localData[recordID].res_id;});return this._rpc({model:parent.model,method:'toggle_active',args:[resIDs],}).then(function(action){self._invalidateCache(parent);if(!_.isEmpty(action)){return self.do_action(action,{on_close:function(){return self.trigger_up('reload');}});}else{return self.reload(parentID);}});},actionArchive:function(resIDs,parentID){var self=this;var parent=this.localData[parentID];return this._rpc({model:parent.model,method:'action_archive',args:[resIDs],}).then(function(action){self._invalidateCache(parent);if(!_.isEmpty(action)){return self.do_action(action,{on_close:function(){return self.trigger_up('reload');}});}else{return self.reload(parentID);}});},actionUnarchive:function(resIDs,parentID){var self=this;var parent=this.localData[parentID];return this._rpc({model:parent.model,method:'action_unarchive',args:[resIDs],}).then(function(action){self._invalidateCache(parent);if(!_.isEmpty(action)){return self.do_action(action,{on_close:function(){return self.trigger_up('reload');}});}else{return self.reload(parentID);}});},toggleGroup:function(groupId){var self=this;var group=this.localData[groupId];if(group.isOpen){group.isOpen=false;group.data=[];group.res_ids=[];group.offset=0;this._updateParentResIDs(group);return Promise.resolve(groupId);}
if(!group.isOpen){group.isOpen=true;var def;if(group.count>0){def=this._load(group).then(function(){self._updateParentResIDs(group);});}
return Promise.resolve(def).then(function(){return groupId;});}},unfreezeOrder:function(elementID){var list=this.localData[elementID];if(list.type==='record'){var data=_.extend({},list.data,list._changes);for(var fieldName in data){var field=list.fields[fieldName];if(!field||!data[fieldName]){continue;}
if(field.type==='one2many'||field.type==='many2many'){var recordlist=this.localData[data[fieldName]];recordlist.orderedResIDs=null;for(var index in recordlist.data){this.unfreezeOrder(recordlist.data[index]);}}}
return;}
list.orderedResIDs=null;this._sortList(list);},_addX2ManyDefaultRecord:function(list,options){var self=this;var position=options&&options.position||'top';var params={fields:list.fields,fieldsInfo:list.fieldsInfo,parentID:list.id,position:position,viewType:list.viewType,allowWarning:options&&options.allowWarning};var additionalContexts=options&&options.context;var makeDefaultRecords=[];if(additionalContexts){_.each(additionalContexts,function(context){params.context=self._getContext(list,{additionalContext:context});makeDefaultRecords.push(self._makeDefaultRecord(list.model,params));});}else{params.context=self._getContext(list);makeDefaultRecords.push(self._makeDefaultRecord(list.model,params));}
return Promise.all(makeDefaultRecords).then(function(resultIds){var ids=[];_.each(resultIds,function(id){ids.push(id);list._changes.push({operation:'ADD',id:id,position:position,isNew:true});var record=self.localData[id];list._cache[record.res_id]=id;if(list.orderedResIDs){var index=list.offset+(position!=='top'?list.limit:0);list.orderedResIDs.splice(index,0,record.res_id);self.localData[list.id].orderedResIDs=list.orderedResIDs;}});return ids;});},_applyChange:function(recordID,changes,options){var self=this;var record=this.localData[recordID];var field;var defs=[];options=options||{};record._changes=record._changes||{};if(!options.doNotSetDirty){record._isDirty=true;}
var initialData={};this._visitChildren(record,function(elem){initialData[elem.id]=$.extend(true,{},_.pick(elem,'data','_changes'));});for(var fieldName in changes){field=record.fields[fieldName];if(field&&(field.type==='one2many'||field.type==='many2many')){defs.push(this._applyX2ManyChange(record,fieldName,changes[fieldName],options));}else if(field&&(field.type==='many2one'||field.type==='reference')){defs.push(this._applyX2OneChange(record,fieldName,changes[fieldName],options));}else{record._changes[fieldName]=changes[fieldName];}}
if(options.notifyChange===false){return Promise.all(defs).then(function(){return Promise.resolve(_.keys(changes));});}
return Promise.all(defs).then(function(){var onChangeFields=[];for(var fieldName in changes){field=record.fields[fieldName];if(field&&field.onChange){var isX2Many=field.type==='one2many'||field.type==='many2many';if(!isX2Many||(self._isX2ManyValid(record._changes[fieldName]||record.data[fieldName]))){onChangeFields.push(fieldName);}}}
return new Promise(function(resolve,reject){if(onChangeFields.length){self._performOnChange(record,onChangeFields,{viewType:options.viewType}).then(function(result){delete record._warning;resolve(_.keys(changes).concat(Object.keys(result&&result.value||{})));}).guardedCatch(function(){self._visitChildren(record,function(elem){_.extend(elem,initialData[elem.id]);});reject();});}else{resolve(_.keys(changes));}}).then(function(fieldNames){return self._fetchSpecialData(record).then(function(fieldNames2){return _.union(fieldNames,fieldNames2);});});});},_applyX2OneChange:async function(record,fieldName,data,options){options=options||{};var self=this;if(!data||(!data.id&&!data.display_name)){record._changes[fieldName]=false;return Promise.resolve();}
const field=record.fields[fieldName];const coModel=field.type==='reference'?data.model:field.relation;const allowedTypes=['many2one','reference'];if(allowedTypes.includes(field.type)&&!data.id&&data.display_name){const result=await this._rpc({model:coModel,method:'name_create',args:[data.display_name],context:this._getContext(record,{fieldName:fieldName,viewType:options.viewType}),});if(!result){record._changes[fieldName]=false;return Promise.resolve();}
data={id:result[0],display_name:result[1]};}
var relatedID;if(record._changes&&fieldName in record._changes){relatedID=record._changes[fieldName];}else{relatedID=record.data[fieldName];}
var relatedRecord=this.localData[relatedID];if(relatedRecord&&(data.id===this.localData[relatedID].res_id)){return Promise.resolve();}
var rel_data=_.pick(data,'id','display_name');var def;if(rel_data.display_name===undefined){def=this._rpc({model:coModel,method:'name_get',args:[data.id],context:record.context,}).then(function(result){rel_data.display_name=result[0][1];});}
return Promise.resolve(def).then(function(){var rec=self._makeDataPoint({context:record.context,data:rel_data,fields:{},fieldsInfo:{},modelName:coModel,parentID:record.id,});record._changes[fieldName]=rec.id;});},_applyOnChange:function(values,record,options={}){var self=this;var defs=[];var rec;const viewType=options.viewType||record.viewType;record._changes=record._changes||{};_.each(values,function(val,name){var field=record.fields[name];if(!field){record._rawChanges[name]=val;return;}
if(record._rawChanges[name]){delete record._rawChanges[name];}
var oldValue=name in record._changes?record._changes[name]:record.data[name];var id;if(field.type==='many2one'){id=false;if(val){var data=_.isArray(val)?{id:val[0],display_name:val[1]}:{id:val};if(!oldValue||(self.localData[oldValue].res_id!==data.id)){rec=self._makeDataPoint({context:record.context,data:data,modelName:field.relation,parentID:record.id,});id=rec.id;record._changes[name]=id;}}else{record._changes[name]=false;}}else if(field.type==='reference'){id=false;if(val){var ref=val.split(',');var modelName=ref[0];var resID=parseInt(ref[1]);if(!oldValue||self.localData[oldValue].res_id!==resID||self.localData[oldValue].model!==modelName){rec=self._makeDataPoint({context:record.context,data:{id:parseInt(ref[1])},modelName:modelName,parentID:record.id,});defs.push(self._fetchNameGet(rec));id=rec.id;record._changes[name]=id;}}else{record._changes[name]=id;}}else if(field.type==='one2many'||field.type==='many2many'){var listId=record._changes[name]||record.data[name];var list;if(listId){list=self.localData[listId];}else{var fieldInfo=record.fieldsInfo[viewType][name];if(!fieldInfo){return;}
var view=fieldInfo.views&&fieldInfo.views[fieldInfo.mode];list=self._makeDataPoint({fields:view?view.fields:fieldInfo.relatedFields,fieldsInfo:view?view.fieldsInfo:fieldInfo.fieldsInfo,limit:fieldInfo.limit,modelName:field.relation,parentID:record.id,static:true,type:'list',viewType:view?view.type:fieldInfo.viewType,});}
record._changes[name]=list.id;list._changes=list._changes||[];var oldChanges=list._changes;_.each(val,function(command){var rec,recID;if(command[0]===0||command[0]===1){if(command[0]===0&&command[1]){var previousChange=_.find(oldChanges,function(operation){var child=self.localData[operation.id];return child&&(child.ref===command[1]);});recID=previousChange&&previousChange.id;rec=self.localData[recID];}
if(command[0]===1&&command[1]){rec=self.localData[list._cache[command[1]]];}
if(!rec){var params={context:list.context,fields:list.fields,fieldsInfo:list.fieldsInfo,modelName:list.model,parentID:list.id,viewType:list.viewType,ref:command[1],};if(command[0]===1){params.res_id=command[1];}
rec=self._makeDataPoint(params);list._cache[rec.res_id]=rec.id;if(options.firstOnChange){rec.getFieldNames().forEach(fieldName=>{if(!(fieldName in rec.data)){rec.data[fieldName]=null;}});}}
rec._noAbandon=!list._savePoint;list._changes.push({operation:'ADD',id:rec.id});if(command[0]===1){list._changes.push({operation:'UPDATE',id:rec.id});}
defs.push(self._applyOnChange(command[2],rec,{firstOnChange:options.firstOnChange,}));}else if(command[0]===4){linkRecord(list,command[1]);}else if(command[0]===5){list._changes=[{operation:'REMOVE_ALL'}];}else if(command[0]===6){list._changes=[{operation:'REMOVE_ALL'}];_.each(command[2],function(resID){linkRecord(list,resID);});}});var def=self._readUngroupedList(list).then(function(){var x2ManysDef=self._fetchX2ManysBatched(list);var referencesDef=self._fetchReferencesBatched(list);return Promise.all([x2ManysDef,referencesDef]);});defs.push(def);}else{var newValue=self._parseServerValue(field,val);if(newValue!==oldValue){record._changes[name]=newValue;}}});return Promise.all(defs);function linkRecord(list,resID){rec=self.localData[list._cache[resID]];if(rec){self.discardChanges(rec.id);}
list._changes.push({operation:'ADD',id:rec?rec.id:null,resID:resID,});}},_applyX2ManyChange:async function(record,fieldName,command,options){if(command.operation==='TRIGGER_ONCHANGE'){return Promise.resolve();}
var self=this;var localID=(record._changes&&record._changes[fieldName])||record.data[fieldName];var list=this.localData[localID];var field=record.fields[fieldName];var viewType=(options&&options.viewType)||record.viewType;var fieldInfo=record.fieldsInfo[viewType][fieldName];var view=fieldInfo.views&&fieldInfo.views[fieldInfo.mode];var def,rec;var defs=[];list._changes=list._changes||[];switch(command.operation){case'ADD':var newRecord=this.localData[command.id];_.defaults(list.fields,newRecord.fields);_.defaults(list.fieldsInfo,newRecord.fieldsInfo);newRecord.fields=list.fields;newRecord.fieldsInfo=list.fieldsInfo;newRecord.viewType=list.viewType;list._cache[newRecord.res_id]=newRecord.id;list._changes.push(command);break;case'ADD_M2M':list._forceM2MLink=true;var data=_.isArray(command.ids)?command.ids:[command.ids];for(const r of data){if(!r.id&&r.display_name){const prom=this._rpc({model:field.relation,method:'name_create',args:[r.display_name],context:this._getContext(record,{fieldName:fieldName,viewType:options.viewType}),}).then(result=>{r.id=result[0];r.display_name=result[1];});defs.push(prom);}}
await Promise.all(defs);if(data.length+list.res_ids.length>list.limit){list.limit=data.length+list.res_ids.length;}
var list_records={};_.each(data,function(d){rec=self._makeDataPoint({context:record.context,modelName:field.relation,fields:view?view.fields:fieldInfo.relatedFields,fieldsInfo:view?view.fieldsInfo:fieldInfo.fieldsInfo,res_id:d.id,data:d,viewType:view?view.type:fieldInfo.viewType,parentID:list.id,});list_records[d.id]=rec;list._cache[rec.res_id]=rec.id;list._changes.push({operation:'ADD',id:rec.id});});var fieldNames=list.getFieldNames();if(fieldNames.length){def=this._rpc({model:list.model,method:'read',args:[_.pluck(data,'id'),fieldNames],context:_.extend({},record.context,field.context),}).then(function(records){_.each(records,function(record){list_records[record.id].data=record;self._parseServerData(fieldNames,list,record);});return Promise.all([self._fetchX2ManysBatched(list),self._fetchReferencesBatched(list)]);});defs.push(def);}
break;case'CREATE':var createOptions=_.extend({context:command.context,position:command.position},options||{});def=this._addX2ManyDefaultRecord(list,createOptions).then(function(ids){_.each(ids,function(id){if(command.position==='bottom'&&list.orderedResIDs&&list.orderedResIDs.length>=list.limit){list.tempLimitIncrement=(list.tempLimitIncrement||0)+1;list.limit+=1;}
if(command.data){return self._applyChange(id,command.data);}});});defs.push(def);break;case'UPDATE':list._changes.push({operation:'UPDATE',id:command.id});if(command.data){defs.push(this._applyChange(command.id,command.data,{viewType:view.type}));}
break;case'FORGET':list._forceM2MUnlink=true;case'DELETE':var idsToRemove=command.ids;list._changes=_.reject(list._changes,function(change,index){var idInCommands=_.contains(command.ids,change.id);if(idInCommands&&change.operation==='ADD'){idsToRemove=_.without(idsToRemove,change.id);}
return idInCommands;});_.each(idsToRemove,function(id){var operation=list._forceM2MUnlink?'FORGET':'DELETE';list._changes.push({operation:operation,id:id});});break;case'DELETE_ALL':list._changes=_.reject(list._changes,function(change){return change.operation==='ADD';});return this._applyX2ManyChange(record,fieldName,{operation:'DELETE',ids:list.res_ids},options);case'REPLACE_WITH':list._changes=[];var newIds=_.difference(command.ids,list.res_ids);var removedIds=_.difference(list.res_ids,command.ids);var addDef,removedDef,values;if(newIds.length){values=_.map(newIds,function(id){return{id:id};});addDef=this._applyX2ManyChange(record,fieldName,{operation:'ADD_M2M',ids:values},options);}
if(removedIds.length){var listData=_.map(list.data,function(localId){return self.localData[localId];});removedDef=this._applyX2ManyChange(record,fieldName,{operation:'DELETE',ids:_.map(removedIds,function(resID){if(resID in list._cache){return list._cache[resID];}
return _.findWhere(listData,{res_id:resID}).id;}),},options);}
return Promise.all([addDef,removedDef]);case'MULTI':_.each(command.commands,function(innerCommand){defs.push(self._applyX2ManyChange(record,fieldName,innerCommand,options));});break;}
return Promise.all(defs).then(function(){return self._readUngroupedList(list).then(function(){return self._fetchX2ManysBatched(list);});});},_applyX2ManyOperations:function(list,options){if(!list.static){return list;}
var self=this;list=_.extend({},list);list.res_ids=list.res_ids.slice(0);var changes=list._changes||[];if(options){var to=options.to===0?0:(options.to||changes.length);changes=changes.slice(options.from||0,to);}
_.each(changes,function(change){var relRecord;if(change.id){relRecord=self.localData[change.id];}
switch(change.operation){case'ADD':list.count++;var resID=relRecord?relRecord.res_id:change.resID;if(change.position==='top'&&(options?options.position!=='bottom':true)){list.res_ids.unshift(resID);}else{list.res_ids.push(resID);}
break;case'FORGET':case'DELETE':list.count--;var deletedResID=relRecord?relRecord.res_id:change.id;list.res_ids=_.without(list.res_ids,deletedResID);break;case'REMOVE_ALL':list.count=0;list.res_ids=[];break;case'UPDATE':break;}});this._setDataInRange(list);return list;},_buildOnchangeSpecs:function(record,viewType){let hasOnchange=false;const onchangeSpec={};var fieldsInfo=record.fieldsInfo[viewType||record.viewType];generateSpecs(fieldsInfo,record.fields);function generateSpecs(fieldsInfo,fields,prefix){prefix=prefix||'';_.each(Object.keys(fieldsInfo),function(name){var field=fields[name];var fieldInfo=fieldsInfo[name];var key=prefix+name;onchangeSpec[key]=(field.onChange)||"";if(field.onChange){hasOnchange=true;}
if(field.type==='one2many'||field.type==='many2many'){_.each(fieldInfo.views,function(view){generateSpecs(view.fieldsInfo[view.type],view.fields,key+'.');});}});}
return{hasOnchange,onchangeSpec};},async _callSampleModel(){await this._super(...arguments);if(this._isInSampleMode){this.__id=this.sampleModel.__id;}},_computeOverrideDefaultFields:function(listID,position){var list=this.localData[listID];var handleField;if(!list){return{};}
position=position||'bottom';if(!list.fieldsInfo){return{};}
for(var field in list.fieldsInfo.list){if(list.fieldsInfo.list[field].widget==='handle'){handleField=field;break;}}
if(!handleField){return{};}
var isOrderedByHandle=list.orderedBy&&list.orderedBy.length&&list.orderedBy[0].asc===true&&list.orderedBy[0].name===handleField;if(!isOrderedByHandle){return{};}
var computedList=this.get(list.id,{raw:true});if(!computedList||!computedList.data||!computedList.data.length){return{};}
var index=Math.min(computedList.data.length-1,position!=='top'?list.limit-1:0);var handleFieldValue=computedList.data[index].data[handleField];if(position==='top'){handleFieldValue--;}else if(list.count<=list.offset+list.limit-(list.tempLimitIncrement||0)){handleFieldValue++;}
return{field:handleField,value:handleFieldValue,};},_evalModifiers:function(element,modifiers){let evalContext=null;const evaluated={};for(const k of['invisible','column_invisible','readonly','required']){const mod=modifiers[k];if(mod===undefined||mod===false||mod===true){if(k in modifiers){evaluated[k]=!!mod;}
continue;}
try{evalContext=evalContext||this._getEvalContext(element);evaluated[k]=new Domain(mod,evalContext).compute(evalContext);}catch(e){throw new Error(_.str.sprintf('for modifier "%s": %s',k,e.message));}}
return evaluated;},_fetchNameGet:function(dataPoint){return this._rpc({model:dataPoint.model,method:'name_get',args:[dataPoint.res_id],context:dataPoint.getContext(),}).then(function(result){dataPoint.data.display_name=result[0][1];});},_fetchNameGets:function(list,fieldName){var self=this;var model=list.fields[fieldName].relation;var records=[];var ids=[];list=this._applyX2ManyOperations(list);_.each(list.data,function(localId){var record=self.localData[localId];var data=record._changes||record.data;var many2oneId=data[fieldName];if(!many2oneId){return;}
var many2oneRecord=self.localData[many2oneId];records.push(many2oneRecord);ids.push(many2oneRecord.res_id);model=many2oneRecord.model;});if(!ids.length){return Promise.resolve();}
return this._rpc({model:model,method:'name_get',args:[_.uniq(ids)],context:list.context,}).then(function(name_gets){_.each(records,function(record){var nameGet=_.find(name_gets,function(nameGet){return nameGet[0]===record.data.id;});record.data.display_name=nameGet[1];});});},_fetchRecord:function(record,options){var self=this;options=options||{};var fieldNames=options.fieldNames||record.getFieldNames(options);fieldNames=_.uniq(fieldNames.concat(['display_name']));return this._rpc({model:record.model,method:'read',args:[[record.res_id],fieldNames],context:_.extend({bin_size:true},record.getContext()),}).then(function(result){if(result.length===0){return Promise.reject();}
result=result[0];record.data=_.extend({},record.data,result);}).then(function(){self._parseServerData(fieldNames,record,record.data);}).then(function(){return Promise.all([self._fetchX2Manys(record,options),self._fetchReferences(record,options)]).then(function(){return self._postprocess(record,options);});});},_fetchReference:function(record,fieldName){var self=this;var def;var value=record._changes&&record._changes[fieldName]||record.data[fieldName];var model=value&&value.split(',')[0];var resID=value&&parseInt(value.split(',')[1]);if(model&&model!=='False'&&resID){def=self._rpc({model:model,method:'name_get',args:[resID],context:record.getContext({fieldName:fieldName}),}).then(function(result){return self._makeDataPoint({data:{id:result[0][0],display_name:result[0][1],},modelName:model,parentID:record.id,});});}
return Promise.resolve(def);},_fetchReferenceData:function(datapoints,model,fieldName){var self=this;var ids=_.map(Object.keys(datapoints),function(id){return parseInt(id);});var parent=datapoints[ids[0]][0];var def=self._rpc({model:model,method:'name_get',args:[ids],context:self.localData[parent].getContext({fieldName:fieldName}),}).then(function(result){_.each(result,function(el){var parentIDs=datapoints[el[0]];_.each(parentIDs,function(parentID){var parent=self.localData[parentID];var referenceDp=self._makeDataPoint({data:{id:el[0],display_name:el[1],},modelName:model,parentID:parent.id,});parent.data[fieldName]=referenceDp.id;});});});return def;},_fetchReferences:function(record,options){var self=this;var defs=[];var fieldNames=options&&options.fieldNames||record.getFieldNames();_.each(fieldNames,function(fieldName){var field=record.fields[fieldName];if(field.type==='reference'){var def=self._fetchReference(record,fieldName).then(function(dataPoint){if(dataPoint){record.data[fieldName]=dataPoint.id;}});defs.push(def);}});return Promise.all(defs);},_fetchReferenceBatched:function(list,fieldName){var self=this;list=this._applyX2ManyOperations(list);this._sortList(list);var toFetch=this._getDataToFetchByModel(list,fieldName);var defs=[];_.each(toFetch,function(datapoints,model){defs.push(self._fetchReferenceData(datapoints,model,fieldName));});return Promise.all(defs);},_fetchReferencesBatched:function(list){var defs=[];var fieldNames=list.getFieldNames();for(var i=0;i<fieldNames.length;i++){var field=list.fields[fieldNames[i]];if(field.type==='reference'){defs.push(this._fetchReferenceBatched(list,fieldNames[i]));}}
return Promise.all(defs);},_fetchReferenceSingleBatch:function(list,fieldName){var self=this;var toFetch={};_.each(list.data,function(groupIndex){var group=self.localData[groupIndex];self._getDataToFetchByModel(group,fieldName,toFetch);});var defs=[];_.each(toFetch,function(datapoints,model){defs.push(self._fetchReferenceData(datapoints,model,fieldName));});return Promise.all(defs);},_fetchReferencesSingleBatch:function(list){var defs=[];var fieldNames=list.getFieldNames();for(var fIndex in fieldNames){var field=list.fields[fieldNames[fIndex]];if(field.type==='reference'){defs.push(this._fetchReferenceSingleBatch(list,fieldNames[fIndex]));}}
return Promise.all(defs);},_fetchRelatedData:function(list,toFetch,fieldName){var self=this;var ids=_.keys(toFetch);for(var i=0;i<ids.length;i++){ids[i]=Number(ids[i]);}
var fieldInfo=list.fieldsInfo[list.viewType][fieldName];if(!ids.length||fieldInfo.__no_fetch){return Promise.resolve();}
var def;var fieldNames=_.keys(fieldInfo.relatedFields);if(fieldNames.length){var field=list.fields[fieldName];def=this._rpc({model:field.relation,method:'read',args:[ids,fieldNames],context:list.getContext()||{},});}else{def=Promise.resolve(_.map(ids,function(id){return{id:id};}));}
return def.then(function(result){var records=_.uniq(_.flatten(_.values(toFetch)));self._updateRecordsData(records,fieldName,result);});},_fetchSpecialData:function(record,options){var self=this;var specialFieldNames=[];var fieldNames=(options&&options.fieldNames)||record.getFieldNames();return Promise.all(_.map(fieldNames,function(name){var viewType=(options&&options.viewType)||record.viewType;var fieldInfo=record.fieldsInfo[viewType][name]||{};var Widget=fieldInfo.Widget;if(Widget&&Widget.prototype.specialData){return self[Widget.prototype.specialData](record,name,fieldInfo).then(function(data){if(data===undefined){return;}
record.specialData[name]=data;specialFieldNames.push(name);});}})).then(function(){return specialFieldNames;});},_fetchSpecialMany2ones:function(record,fieldName,fieldInfo,fieldsToRead){var field=record.fields[fieldName];if(field.type!=="many2one"){return Promise.resolve();}
var context=record.getContext({fieldName:fieldName});var domain=record.getDomain({fieldName:fieldName});if(domain.length){var localID=(record._changes&&fieldName in record._changes)?record._changes[fieldName]:record.data[fieldName];if(localID){var element=this.localData[localID];domain=["|",["id","=",element.data.id]].concat(domain);}}
var hasChanged=this._saveSpecialDataCache(record,fieldName,{context:context,domain:domain,});if(!hasChanged){return Promise.resolve();}
var self=this;return this._rpc({model:field.relation,method:'search_read',fields:["id"].concat(fieldsToRead||[]),context:context,domain:domain,}).then(function(records){var ids=_.pluck(records,'id');return self._rpc({model:field.relation,method:'name_get',args:[ids],context:context,}).then(function(name_gets){_.each(records,function(rec){var name_get=_.find(name_gets,function(n){return n[0]===rec.id;});rec.display_name=name_get[1];});return records;});});},_fetchSpecialRelation:function(record,fieldName){var field=record.fields[fieldName];if(!_.contains(["many2one","many2many","one2many"],field.type)){return Promise.resolve();}
var context=record.getContext({fieldName:fieldName});var domain=record.getDomain({fieldName:fieldName});var hasChanged=this._saveSpecialDataCache(record,fieldName,{context:context,domain:domain,});if(!hasChanged){return Promise.resolve();}
return this._rpc({model:field.relation,method:'name_search',args:["",domain],context:context});},_fetchSpecialReference:function(record,fieldName){var def;var field=record.fields[fieldName];if(field.type==='char'){def=this._fetchReference(record,fieldName);}
return Promise.resolve(def);},_fetchSpecialStatus:function(record,fieldName,fieldInfo){var foldField=fieldInfo.options.fold_field;var fieldsToRead=foldField?[foldField]:[];return this._fetchSpecialMany2ones(record,fieldName,fieldInfo,fieldsToRead).then(function(m2os){_.each(m2os,function(m2o){m2o.fold=foldField?m2o[foldField]:false;});return m2os;});},_fetchSpecialDomain:function(record,fieldName,fieldInfo){var self=this;var context=record.getContext({fieldName:fieldName});var domainModel=fieldInfo.options.model;if(record.data.hasOwnProperty(domainModel)){domainModel=record._changes&&record._changes[domainModel]||record.data[domainModel];}
var domainValue=record._changes&&record._changes[fieldName]||record.data[fieldName]||[];var hasChanged=this._saveSpecialDataCache(record,fieldName,{context:context,domainModel:domainModel,domainValue:domainValue,});if(!hasChanged){return Promise.resolve();}else if(!domainModel){return Promise.resolve({model:domainModel,nbRecords:0,});}
return new Promise(function(resolve){var evalContext=self._getEvalContext(record);self._rpc({model:domainModel,method:'search_count',args:[Domain.prototype.stringToArray(domainValue,evalContext)],context:context}).then(function(nbRecords){resolve({model:domainModel,nbRecords:nbRecords,});}).guardedCatch(function(reason){var e=reason.event;e.preventDefault();resolve({model:domainModel,nbRecords:0,});});});},_fetchUngroupedList:function(list,options){options=_.defaults(options||{},{enableRelationalFetch:true});var self=this;var def;if(list.static){def=this._readUngroupedList(list).then(function(){if(list.parentID&&self.isNew(list.parentID)){var many2ones=self._getMany2OneFieldNames(list);var defs=_.map(many2ones,function(name){return self._fetchNameGets(list,name);});return Promise.all(defs);}});}else{def=this._searchReadUngroupedList(list);}
return def.then(function(){if(options.enableRelationalFetch){return Promise.all([self._fetchX2ManysBatched(list),self._fetchReferencesBatched(list)]);}}).then(function(){return list;});},_fetchX2ManyBatched:function(list,fieldName){list=this._applyX2ManyOperations(list);this._sortList(list);var toFetch=this._getDataToFetch(list,fieldName);return this._fetchRelatedData(list,toFetch,fieldName);},_fetchX2Manys:function(record,options){var self=this;var defs=[];options=options||{};var fieldNames=options.fieldNames||record.getFieldNames(options);var viewType=options.viewType||record.viewType;_.each(fieldNames,function(fieldName){var field=record.fields[fieldName];if(field.type==='one2many'||field.type==='many2many'){var fieldInfo=record.fieldsInfo[viewType][fieldName];var rawContext=fieldInfo&&fieldInfo.context;var view=fieldInfo.views&&fieldInfo.views[fieldInfo.mode];var fieldsInfo=view?view.fieldsInfo:(fieldInfo.fieldsInfo||{});var ids=record.data[fieldName]||[];var list=self._makeDataPoint({count:ids.length,context:_.extend({},record.context,field.context),fieldsInfo:fieldsInfo,fields:view?view.fields:fieldInfo.relatedFields,limit:fieldInfo.limit,modelName:field.relation,res_ids:ids,static:true,type:'list',orderedBy:fieldInfo.orderedBy,parentID:record.id,rawContext:rawContext,relationField:field.relation_field,viewType:view?view.type:fieldInfo.viewType,});record.data[fieldName]=list.id;if(!fieldInfo.__no_fetch){var def=self._readUngroupedList(list).then(function(){return Promise.all([self._fetchX2ManysBatched(list),self._fetchReferencesBatched(list)]);});defs.push(def);}}});return Promise.all(defs);},_fetchX2ManysBatched:function(list){var defs=[];var fieldNames=list.getFieldNames();for(var i=0;i<fieldNames.length;i++){var field=list.fields[fieldNames[i]];if(field.type==='many2many'||field.type==='one2many'){defs.push(this._fetchX2ManyBatched(list,fieldNames[i]));}}
return Promise.all(defs);},_fetchX2ManySingleBatch:function(list,fieldName){var self=this;var toFetch={};_.each(list.data,function(groupIndex){var group=self.localData[groupIndex];var nextDataToFetch=self._getDataToFetch(group,fieldName);_.each(_.keys(nextDataToFetch),function(id){if(toFetch[id]){toFetch[id]=toFetch[id].concat(nextDataToFetch[id]);}else{toFetch[id]=nextDataToFetch[id];}});});return self._fetchRelatedData(list,toFetch,fieldName);},_fetchX2ManysSingleBatch:function(list){var defs=[];var fieldNames=list.getFieldNames();for(var i=0;i<fieldNames.length;i++){var field=list.fields[fieldNames[i]];if(field.type==='many2many'||field.type==='one2many'){defs.push(this._fetchX2ManySingleBatch(list,fieldNames[i]));}}
return Promise.all(defs);},_generateChanges:function(record,options){options=options||{};var viewType=options.viewType||record.viewType;var changes;if('changesOnly'in options&&!options.changesOnly){changes=_.extend({},record.data,record._changes);}else{changes=_.extend({},record._changes);}
var withReadonly=options.withReadonly||false;var commands=this._generateX2ManyCommands(record,{changesOnly:'changesOnly'in options?options.changesOnly:true,withReadonly:withReadonly,});for(var fieldName in record.fields){if(!withReadonly&&fieldName in changes||fieldName in commands){var editionViewType=record._editionViewType[fieldName]||viewType;if(this._isFieldProtected(record,fieldName,editionViewType)){delete changes[fieldName];continue;}}
var type=record.fields[fieldName].type;var value;if(type==='one2many'||type==='many2many'){if(commands[fieldName]&&commands[fieldName].length){changes[fieldName]=commands[fieldName];}else{delete changes[fieldName];}}else if(type==='many2one'&&fieldName in changes){value=changes[fieldName];changes[fieldName]=value?this.localData[value].res_id:false;}else if(type==='reference'&&fieldName in changes){value=changes[fieldName];changes[fieldName]=value?this.localData[value].model+','+this.localData[value].res_id:false;}else if(type==='char'&&changes[fieldName]===''){changes[fieldName]=false;}else if(changes[fieldName]===null){changes[fieldName]=false;}}
return changes;},_generateOnChangeData:function(record,options){options=_.extend({},options||{},{withReadonly:true});var data={};if(!options.firstOnChange){var commands=this._generateX2ManyCommands(record,options);data=_.extend(this.get(record.id,{raw:true}).data,commands);var hasDisplayName=_.some(record.fieldsInfo,function(fieldsInfo){return'display_name'in fieldsInfo;});if(!hasDisplayName){delete data.display_name;}}
if(record.parentID){var parent=this.localData[record.parentID];if(parent.parentID&&parent.relationField){var parentRecord=this.localData[parent.parentID];data[parent.relationField]=this._generateOnChangeData(parentRecord);}}
return data;},_generateX2ManyCommands:function(record,options){var self=this;options=options||{};var fields=record.fields;if(options.fieldNames){fields=_.pick(fields,options.fieldNames);}
var commands={};var data=_.extend({},record.data,record._changes);var type;for(var fieldName in fields){type=fields[fieldName].type;if(type==='many2many'||type==='one2many'){if(!data[fieldName]){continue;}
commands[fieldName]=[];var list=this.localData[data[fieldName]];if(options.changesOnly&&(!list._changes||!list._changes.length)){continue;}
var oldResIDs=list.res_ids.slice(0);var relRecordAdded=[];var relRecordUpdated=[];_.each(list._changes,function(change){if(change.operation==='ADD'&&change.id){relRecordAdded.push(self.localData[change.id]);}else if(change.operation==='UPDATE'&&!self.isNew(change.id)){relRecordUpdated.push(self.localData[change.id]);}});list=this._applyX2ManyOperations(list);this._sortList(list);if(type==='many2many'||list._forceM2MLink){var relRecordCreated=_.filter(relRecordAdded,function(rec){return typeof rec.res_id==='string';});var realIDs=_.difference(list.res_ids,_.pluck(relRecordCreated,'res_id'));commands[fieldName].push(x2ManyCommands.replace_with(realIDs));_.each(relRecordCreated,function(relRecord){var changes=self._generateChanges(relRecord,options);commands[fieldName].push(x2ManyCommands.create(relRecord.ref,changes));});_.each(relRecordUpdated,function(relRecord){var changes=self._generateChanges(relRecord,options);if(!_.isEmpty(changes)){var command=x2ManyCommands.update(relRecord.res_id,changes);commands[fieldName].push(command);}});}else if(type==='one2many'){var removedIds=_.difference(oldResIDs,list.res_ids);var addedIds=_.difference(list.res_ids,oldResIDs);var keptIds=_.intersection(oldResIDs,list.res_ids);var didChange=false;var changes,command,relRecord;for(var i=0;i<list.res_ids.length;i++){if(_.contains(keptIds,list.res_ids[i])){relRecord=_.findWhere(relRecordUpdated,{res_id:list.res_ids[i]});changes=relRecord?this._generateChanges(relRecord,options):{};if(!_.isEmpty(changes)){command=x2ManyCommands.update(relRecord.res_id,changes);didChange=true;}else{command=x2ManyCommands.link_to(list.res_ids[i]);}
commands[fieldName].push(command);}else if(_.contains(addedIds,list.res_ids[i])){relRecord=_.findWhere(relRecordAdded,{res_id:list.res_ids[i]});if(!relRecord){commands[fieldName].push(x2ManyCommands.link_to(list.res_ids[i]));continue;}
changes=this._generateChanges(relRecord,_.extend({},options,{changesOnly:true}));if(!this.isNew(relRecord.id)){commands[fieldName].push(x2ManyCommands.link_to(relRecord.res_id));delete changes.id;if(!_.isEmpty(changes)){commands[fieldName].push(x2ManyCommands.update(relRecord.res_id,changes));}}else{const rawChangesEntries=Object.entries(relRecord._rawChanges);for(const[fieldName,value]of rawChangesEntries){const isMany2OneValue=Array.isArray(value)&&value.length===2&&Number.isInteger(value[0])&&typeof value[1]==='string';changes[fieldName]=isMany2OneValue?value[0]:value;}
commands[fieldName].push(x2ManyCommands.create(relRecord.ref,changes));}}}
if(options.changesOnly&&!didChange&&addedIds.length===0&&removedIds.length===0){commands[fieldName]=[];}
for(i=0;i<removedIds.length;i++){if(list._forceM2MUnlink){commands[fieldName].push(x2ManyCommands.forget(removedIds[i]));}else{commands[fieldName].push(x2ManyCommands.delete(removedIds[i]));}}}}}
return commands;},_getContext:function(element,options){options=options||{};var context=new Context(session.user_context);context.set_eval_context(this._getEvalContext(element));if(options.full||!(options.fieldName||options.additionalContext)){context.add(element.context);}
if(options.fieldName){var viewType=options.viewType||element.viewType;var fieldInfo=element.fieldsInfo[viewType][options.fieldName];if(fieldInfo&&fieldInfo.context){context.add(fieldInfo.context);}else{var fieldParams=element.fields[options.fieldName];if(fieldParams.context){context.add(fieldParams.context);}}}
if(options.additionalContext){context.add(options.additionalContext);}
if(element.rawContext){var rawContext=new Context(element.rawContext);var evalContext=this._getEvalContext(this.localData[element.parentID]);evalContext.id=evalContext.id||false;rawContext.set_eval_context(evalContext);context.add(rawContext);}
return context.eval();},_getDataToFetch:function(list,fieldName){var self=this;var field=list.fields[fieldName];var fieldInfo=list.fieldsInfo[list.viewType][fieldName];var view=fieldInfo.views&&fieldInfo.views[fieldInfo.mode];var fieldsInfo=view?view.fieldsInfo:fieldInfo.fieldsInfo;var fields=view?view.fields:fieldInfo.relatedFields;var viewType=view?view.type:fieldInfo.viewType;var toFetch={};let dataPointIds=list.data;for(let i=0;i<list.groupedBy.length;i++){dataPointIds=dataPointIds.reduce((acc,groupId)=>acc.concat(this.localData[groupId].data),[]);}
dataPointIds.forEach(function(dataPoint){var record=self.localData[dataPoint];if(typeof record.data[fieldName]==='string'){return;}
_.each(record.data[fieldName],function(id){toFetch[id]=toFetch[id]||[];toFetch[id].push(record);});var m2mList=self._makeDataPoint({fieldsInfo:fieldsInfo,fields:fields,modelName:field.relation,parentID:record.id,res_ids:record.data[fieldName],static:true,type:'list',viewType:viewType,});record.data[fieldName]=m2mList.id;});return toFetch;},_getDataToFetchByModel:function(list,fieldName,toFetchAcc){var self=this;var toFetch=toFetchAcc||{};_.each(list.data,function(dataPoint){var record=self.localData[dataPoint];var value=record.data[fieldName];if(value&&!self.localData[value]){var model=value.split(',')[0];var resID=value.split(',')[1];if(!(model in toFetch)){toFetch[model]={};}
if(toFetch[model][resID]){toFetch[model][resID].push(dataPoint);}else{toFetch[model][resID]=[dataPoint];}}});return toFetch;},_getDefaultContext:function(dataPoint){var defaultContext={};while(dataPoint.parentID){var parent=this.localData[dataPoint.parentID];var groupByField=parent.groupedBy[0].split(':')[0];var value=viewUtils.getGroupValue(dataPoint,groupByField);if(value){defaultContext['default_'+groupByField]=value;}
dataPoint=parent;}
return defaultContext;},_getDomain:function(element,options){if(options&&options.fieldName){if(element._domains[options.fieldName]){return Domain.prototype.stringToArray(element._domains[options.fieldName],this._getEvalContext(element,true));}
var viewType=options.viewType||element.viewType;var fieldInfo=element.fieldsInfo[viewType][options.fieldName];if(fieldInfo&&fieldInfo.domain){return Domain.prototype.stringToArray(fieldInfo.domain,this._getEvalContext(element,true));}
var fieldParams=element.fields[options.fieldName];if(fieldParams.domain){return Domain.prototype.stringToArray(fieldParams.domain,this._getEvalContext(element,true));}
return[];}
return Domain.prototype.stringToArray(element.domain,this._getEvalContext(element,true));},_getEvalContext:function(element,forDomain){var evalContext=element.type==='record'?this._getRecordEvalContext(element,forDomain):{};if(element.parentID){var parent=this.localData[element.parentID];if(parent.type==='list'&&parent.parentID){parent=this.localData[parent.parentID];}
if(parent.type==='record'){evalContext.parent=this._getRecordEvalContext(parent,forDomain);}}
let current_company_id;if(session.user_context.allowed_company_ids){current_company_id=session.user_context.allowed_company_ids[0];}else{current_company_id=session.user_companies?session.user_companies.current_company[0]:false;}
return Object.assign({active_id:evalContext.id||false,active_ids:evalContext.id?[evalContext.id]:[],active_model:element.model,current_company_id,id:evalContext.id||false,},pyUtils.context(),session.user_context,element.context,evalContext,);},_getFieldNames:function(element,options){var fieldsInfo=element.fieldsInfo;var viewType=options&&options.viewType||element.viewType;return Object.keys(fieldsInfo&&fieldsInfo[viewType]||{});},_getMany2OneFieldNames:function(datapoint){var many2ones=[];_.each(datapoint.fields,function(field,name){if(field.type==='many2one'){many2ones.push(name);}});return many2ones;},_getRecordEvalContext:function(record,forDomain){var self=this;var relDataPoint;var context=_.extend({},record.data,record._changes);function _generateX2ManyCommands(fieldName){var commands=self._generateX2ManyCommands(record,{fieldNames:[fieldName]});return commands[fieldName];}
for(var fieldName in context){var field=record.fields[fieldName];if(context[fieldName]===null){context[fieldName]=false;}
if(!field||field.name==='id'){continue;}
if(field.type==='date'||field.type==='datetime'){if(context[fieldName]){context[fieldName]=JSON.parse(JSON.stringify(context[fieldName]));}
continue;}
if(field.type==='many2one'){relDataPoint=this.localData[context[fieldName]];context[fieldName]=relDataPoint?relDataPoint.res_id:false;continue;}
if(field.type==='one2many'||field.type==='many2many'){var ids;if(!context[fieldName]||_.isArray(context[fieldName])){ids=context[fieldName]?context[fieldName].slice(0):[];}else{relDataPoint=this._applyX2ManyOperations(this.localData[context[fieldName]]);ids=relDataPoint.res_ids.slice(0);}
if(!forDomain){ids.toJSON=_generateX2ManyCommands.bind(null,fieldName);}else if(field.type==='one2many'){ids=_.filter(ids,function(id){return typeof id!=='string';});}
context[fieldName]=ids;}}
return context;},_invalidateCache:function(dataPoint){while(dataPoint.parentID){dataPoint=this.localData[dataPoint.parentID];}
if(dataPoint.model==='res.currency'){session.reloadCurrencies();}
if(dataPoint.model==='res.company'&&!localStorage.getItem('running_tour')){this.do_action('reload_context');}
if(_.contains(this.noCacheModels,dataPoint.model)){core.bus.trigger('clear_cache');}},_isFieldProtected:function(record,fieldName,viewType){viewType=viewType||record.viewType;var fieldInfo=viewType&&record.fieldsInfo&&record.fieldsInfo[viewType][fieldName];if(fieldInfo){var rawModifiers=fieldInfo.modifiers||{};var modifiers=this._evalModifiers(record,_.pick(rawModifiers,'readonly'));return modifiers.readonly&&!fieldInfo.force_save;}else{return false;}},_isFieldSet:function(value,fieldType){switch(fieldType){case'boolean':return true;case'one2many':case'many2many':return value.length>0;default:return value!==false;}},_isX2ManyValid:function(id){var self=this;var isValid=true;var element=this.localData[id];_.each(element._changes,function(command){if(command.operation==='DELETE'||command.operation==='FORGET'||(command.operation==='ADD'&&!command.isNew)||command.operation==='REMOVE_ALL'){return;}
var recordData=self.get(command.id,{raw:true}).data;var record=self.localData[command.id];_.each(element.getFieldNames(),function(fieldName){var field=element.fields[fieldName];var fieldInfo=element.fieldsInfo[element.viewType][fieldName];var rawModifiers=fieldInfo.modifiers||{};var modifiers=self._evalModifiers(record,_.pick(rawModifiers,'required'));if(modifiers.required&&!self._isFieldSet(recordData[fieldName],field.type)){isValid=false;}});});return isValid;},_load:function(dataPoint,options){if(options&&options.onlyGroups&&!(dataPoint.type==='list'&&dataPoint.groupedBy.length)){return Promise.resolve(dataPoint);}
if(dataPoint.type==='record'){return this._fetchRecord(dataPoint,options);}
if(dataPoint.type==='list'&&dataPoint.groupedBy.length){return this._readGroup(dataPoint,options);}
if(dataPoint.type==='list'&&!dataPoint.groupedBy.length){return this._fetchUngroupedList(dataPoint,options);}},_makeDataPoint:function(params){var type=params.type||('domain'in params&&'list')||'record';var res_id,value;var res_ids=params.res_ids||[];var data=params.data||(type==='record'?{}:[]);var context=params.context;if(type==='record'){res_id=params.res_id||(params.data&&params.data.id);if(res_id){data.id=res_id;}else{res_id=_.uniqueId('virtual_');}
context=_.omit(context,['orderedBy','group_by']);}else{var isValueArray=params.value instanceof Array;res_id=isValueArray?params.value[0]:undefined;value=isValueArray?params.value[1]:params.value;}
var fields=_.extend({display_name:{type:'char'},id:{type:'integer'},},params.fields);var dataPoint={_cache:type==='list'?{}:undefined,_changes:null,_domains:{},_rawChanges:{},aggregateValues:params.aggregateValues||{},context:context,count:params.count||res_ids.length,data:data,domain:params.domain||[],fields:fields,fieldsInfo:params.fieldsInfo,groupedBy:params.groupedBy||[],groupsCount:0,groupsLimit:type==='list'&&params.groupsLimit||null,groupsOffset:0,id:`${params.modelName}_${++this.__id}`,isOpen:params.isOpen,limit:type==='record'?1:(params.limit||Number.MAX_SAFE_INTEGER),loadMoreOffset:0,model:params.modelName,offset:params.offset||(type==='record'?_.indexOf(res_ids,res_id):0),openGroupByDefault:params.openGroupByDefault,orderedBy:params.orderedBy||[],orderedResIDs:params.orderedResIDs,parentID:params.parentID,rawContext:params.rawContext,ref:params.ref||res_id,relationField:params.relationField,res_id:res_id,res_ids:res_ids,specialData:{},_specialDataCache:{},static:params.static||false,type:type,value:value,viewType:params.viewType,};dataPoint._editionViewType={};dataPoint.evalModifiers=this._evalModifiers.bind(this,dataPoint);dataPoint.getContext=this._getContext.bind(this,dataPoint);dataPoint.getDomain=this._getDomain.bind(this,dataPoint);dataPoint.getFieldNames=this._getFieldNames.bind(this,dataPoint);dataPoint.isDirty=this.isDirty.bind(this,dataPoint.id);this.localData[dataPoint.id]=dataPoint;return dataPoint;},async _makeDefaultRecord(modelName,params){var targetView=params.viewType;var fields=params.fields;var fieldsInfo=params.fieldsInfo;var fieldNames=Object.keys(fieldsInfo[targetView]);var parentRecord=params.parentID&&this.localData[params.parentID].type==='list'?this.localData[params.parentID]:null;if(parentRecord){var originView=parentRecord.viewType;fieldNames=_.union(fieldNames,Object.keys(parentRecord.fieldsInfo[originView]));fieldsInfo[targetView]=_.defaults({},fieldsInfo[targetView],parentRecord.fieldsInfo[originView]);fields=_.defaults({},fields,parentRecord.fields);}
var record=this._makeDataPoint({modelName:modelName,fields:fields,fieldsInfo:fieldsInfo,context:params.context,parentID:params.parentID,res_ids:params.res_ids,viewType:targetView,});await this.generateDefaultValues(record.id,{},{fieldNames});try{await this._performOnChange(record,[],{firstOnChange:true});}finally{if(record._warning&&params.allowWarning){delete record._warning;}}
if(record._warning){return Promise.reject();}
var overrideDefaultFields=this._computeOverrideDefaultFields(params.parentID,params.position);if(overrideDefaultFields.field){record._changes[overrideDefaultFields.field]=overrideDefaultFields.value;}
await this._postprocess(record);this.save(record.id,{savePoint:true});return record.id;},_parseServerData:function(fieldNames,element,data){var self=this;_.each(fieldNames,function(fieldName){var field=element.fields[fieldName];var val=data[fieldName];if(field.type==='many2one'){if(val!==false){var r=self._makeDataPoint({modelName:field.relation,fields:{display_name:{type:'char'},id:{type:'integer'},},data:{display_name:val[1],id:val[0],},parentID:element.id,});data[fieldName]=r.id;}else{data[fieldName]=false;}}else{data[fieldName]=self._parseServerValue(field,val);}});},async _performOnChange(record,fields,options={}){const firstOnChange=options.firstOnChange;let{hasOnchange,onchangeSpec}=this._buildOnchangeSpecs(record,options.viewType);if(!firstOnChange&&!hasOnchange){return;}
var idList=record.data.id?[record.data.id]:[];const ctxOptions={full:true,};if(fields.length===1){fields=fields[0];ctxOptions.fieldName=fields;}
var context=this._getContext(record,ctxOptions);var currentData=this._generateOnChangeData(record,{changesOnly:false,firstOnChange,});const result=await this._rpc({model:record.model,method:'onchange',args:[idList,currentData,fields,onchangeSpec],context:context,});if(!record._changes){return;}
if(result.warning){this.trigger_up('warning',result.warning);record._warning=true;}
if(result.domain){record._domains=Object.assign(record._domains,result.domain);}
await this._applyOnChange(result.value,record,{firstOnChange});return result;},_performRPC:function(params){var self=this;var request=_.extend({},params);var prom=new Promise(function(resolve,reject){request.resolve=resolve;request.reject=reject;});this.batchedRPCsRequests.push(request);Promise.resolve().then(function(){if(!self.batchedRPCsRequests.length){return;}
var batchedRPCsRequests=self.batchedRPCsRequests;self.batchedRPCsRequests=[];var batches={};var key;for(var i=0;i<batchedRPCsRequests.length;i++){var request=batchedRPCsRequests[i];key=request.model+','+JSON.stringify(request.context);if(!batches[key]){batches[key]=_.extend({},request,{requests:[request]});}else{batches[key].ids=_.uniq(batches[key].ids.concat(request.ids));batches[key].fieldNames=_.uniq(batches[key].fieldNames.concat(request.fieldNames));batches[key].requests.push(request);}}
function onSuccess(batch,results){for(var i=0;i<batch.requests.length;i++){var request=batch.requests[i];var fieldNames=request.fieldNames.concat(['id']);var filteredResults=results.filter(function(record){return request.ids.indexOf(record.id)>=0;}).map(function(record){return _.pick(record,fieldNames);});request.resolve(filteredResults);}}
function onFailure(batch,error){for(var i=0;i<batch.requests.length;i++){var request=batch.requests[i];request.reject(error);}}
for(key in batches){var batch=batches[key];self._rpc({model:batch.model,method:'read',args:[batch.ids,batch.fieldNames],context:batch.context,}).then(onSuccess.bind(null,batch)).guardedCatch(onFailure.bind(null,batch));}});return prom;},_postprocess:function(record,options){var self=this;var viewType=options&&options.viewType||record.viewType;var defs=[];_.each(record.getFieldNames(options),function(name){var field=record.fields[name];var fieldInfo=record.fieldsInfo[viewType][name]||{};var options=fieldInfo.options||{};if(options.always_reload){if(record.fields[name].type==='many2one'){const _changes=record._changes||{};const relRecordId=_changes[name]||record.data[name];if(!relRecordId){return;}
var relRecord=self.localData[relRecordId];defs.push(self._rpc({model:field.relation,method:'name_get',args:[relRecord.data.id],context:self._getContext(record,{fieldName:name,viewType:viewType}),}).then(function(result){relRecord.data.display_name=result[0][1];}));}}});defs.push(this._fetchSpecialData(record,options));return Promise.all(defs).then(function(){return record;});},_processX2ManyCommands:function(record,fieldName,commands,options){var self=this;options=options||{};var defs=[];var field=record.fields[fieldName];var fieldInfo=record.fieldsInfo[options.viewType||record.viewType][fieldName]||{};var view=fieldInfo.views&&fieldInfo.views[fieldInfo.mode];var fieldsInfo=view?view.fieldsInfo:fieldInfo.fieldsInfo;var fields=view?view.fields:fieldInfo.relatedFields;var viewType=view?view.type:fieldInfo.viewType;var parentContext=_.omit(record.context,function(val,key){return _.str.startsWith(key,'default_');});var x2manyList=self._makeDataPoint({context:parentContext,fieldsInfo:fieldsInfo,fields:fields,limit:fieldInfo.limit,modelName:field.relation,parentID:record.id,rawContext:fieldInfo&&fieldInfo.context,relationField:field.relation_field,res_ids:[],static:true,type:'list',viewType:viewType,});record._changes[fieldName]=x2manyList.id;x2manyList._changes=[];var many2ones={};var r;commands=commands||[];var isCommandList=commands.length&&_.isArray(commands[0]);if(!isCommandList){commands=[[6,false,commands]];}
_.each(commands,function(value){if(value[0]===0){r=self._makeDataPoint({modelName:x2manyList.model,context:x2manyList.context,fieldsInfo:fieldsInfo,fields:fields,parentID:x2manyList.id,viewType:viewType,});r._noAbandon=true;x2manyList._changes.push({operation:'ADD',id:r.id});x2manyList._cache[r.res_id]=r.id;_.each(r.getFieldNames(),function(fieldName){r.data[fieldName]=null;});r._changes=_.defaults(value[2],r.data);for(var fieldName in r._changes){if(!r._changes[fieldName]){continue;}
var isFieldInView=fieldName in r.fields;if(isFieldInView){var field=r.fields[fieldName];var fieldType=field.type;var rec;if(fieldType==='many2one'){rec=self._makeDataPoint({context:r.context,modelName:field.relation,data:{id:r._changes[fieldName]},parentID:r.id,});r._changes[fieldName]=rec.id;many2ones[fieldName]=true;}else if(fieldType==='reference'){var reference=r._changes[fieldName].split(',');rec=self._makeDataPoint({context:r.context,modelName:reference[0],data:{id:parseInt(reference[1])},parentID:r.id,});r._changes[fieldName]=rec.id;many2ones[fieldName]=true;}else if(_.contains(['one2many','many2many'],fieldType)){var x2mCommands=value[2][fieldName];defs.push(self._processX2ManyCommands(r,fieldName,x2mCommands));}else{r._changes[fieldName]=self._parseServerValue(field,r._changes[fieldName]);}}}}
if(value[0]===6){_.each(value[2],function(res_id){x2manyList._changes.push({operation:'ADD',resID:res_id});});var def=self._readUngroupedList(x2manyList).then(function(){return Promise.all([self._fetchX2ManysBatched(x2manyList),self._fetchReferencesBatched(x2manyList)]);});defs.push(def);}});_.each(_.keys(many2ones),function(name){defs.push(self._fetchNameGets(x2manyList,name));});return Promise.all(defs);},_readMissingFields:function(list,resIDs,fieldNames){var self=this;var missingIDs=[];for(var i=0,len=resIDs.length;i<len;i++){var resId=resIDs[i];var dataPointID=list._cache[resId];if(!dataPointID){missingIDs.push(resId);continue;}
var record=self.localData[dataPointID];var data=_.extend({},record.data,record._changes);if(_.difference(fieldNames,_.keys(data)).length){missingIDs.push(resId);}}
var def;if(missingIDs.length&&fieldNames.length){def=self._performRPC({context:list.getContext(),fieldNames:fieldNames,ids:missingIDs,method:'read',model:list.model,});}else{def=Promise.resolve(_.map(missingIDs,function(id){return{id:id};}));}
return def.then(function(records){_.each(resIDs,function(id){var dataPoint;var data=_.findWhere(records,{id:id});if(id in list._cache){dataPoint=self.localData[list._cache[id]];if(data){self._parseServerData(fieldNames,dataPoint,data);_.extend(dataPoint.data,data);}}else{dataPoint=self._makeDataPoint({context:list.getContext(),data:data,fieldsInfo:list.fieldsInfo,fields:list.fields,modelName:list.model,parentID:list.id,viewType:list.viewType,});self._parseServerData(fieldNames,dataPoint,dataPoint.data);list._cache[id]=dataPoint.id;}
_.each(list._changes,function(change){if(change.operation==='ADD'&&!change.id&&change.resID===id){change.id=dataPoint.id;}});});return list;});},_readGroup:function(list,options){var self=this;options=options||{};var groupByField=list.groupedBy[0];var rawGroupBy=groupByField.split(':')[0];var fields=_.uniq(list.getFieldNames().concat(rawGroupBy));var orderedBy=_.filter(list.orderedBy,function(order){return order.name===rawGroupBy||list.fields[order.name].group_operator!==undefined;});var openGroupsLimit=list.groupsLimit||self.OPEN_GROUP_LIMIT;var expand=list.openGroupByDefault&&options.fetchRecordsWithGroups;return this._rpc({model:list.model,method:'web_read_group',fields:fields,domain:list.domain,context:list.context,groupBy:list.groupedBy,limit:list.groupsLimit,offset:list.groupsOffset,orderBy:orderedBy,lazy:true,expand:expand,expand_limit:expand?list.limit:null,expand_orderby:expand?list.orderedBy:null,}).then(function(result){var groups=result.groups;list.groupsCount=result.length;var previousGroups=_.map(list.data,function(groupID){return self.localData[groupID];});list.data=[];list.count=0;var defs=[];var openGroupCount=0;_.each(groups,function(group){var aggregateValues={};_.each(group,function(value,key){if(_.contains(fields,key)&&key!==groupByField&&AGGREGATABLE_TYPES.includes(list.fields[key].type)){aggregateValues[key]=value;}});var value=group[groupByField];if(list.fields[rawGroupBy].type==="selection"){var choice=_.find(list.fields[rawGroupBy].selection,function(c){return c[0]===value;});value=choice?choice[1]:false;}
var newGroup=self._makeDataPoint({modelName:list.model,count:group[rawGroupBy+'_count'],domain:group.__domain,context:list.context,fields:list.fields,fieldsInfo:list.fieldsInfo,value:value,aggregateValues:aggregateValues,groupedBy:list.groupedBy.slice(1),orderedBy:list.orderedBy,orderedResIDs:list.orderedResIDs,limit:list.limit,openGroupByDefault:list.openGroupByDefault,parentID:list.id,type:'list',viewType:list.viewType,});var oldGroup=_.find(previousGroups,function(g){return g.res_id===newGroup.res_id&&g.value===newGroup.value;});if(oldGroup){delete self.localData[newGroup.id];var updatedProps=_.pick(oldGroup,'isOpen','offset','id');if(options.onlyGroups||oldGroup.isOpen&&newGroup.groupedBy.length){updatedProps.data=oldGroup.data;if(options.onlyGroups){updatedProps.res_ids=oldGroup.res_ids;updatedProps.count=oldGroup.count;}}
_.extend(newGroup,updatedProps);newGroup.limit=oldGroup.limit+oldGroup.loadMoreOffset;self.localData[newGroup.id]=newGroup;}else if(!newGroup.openGroupByDefault||openGroupCount>=openGroupsLimit){newGroup.isOpen=false;}else if('__fold'in group){newGroup.isOpen=!group.__fold;}else{newGroup.isOpen=!self.localData[newGroup.parentID].parentID;}
list.data.push(newGroup.id);list.count+=newGroup.count;if(newGroup.isOpen&&newGroup.count>0){openGroupCount++;if(group.__data){newGroup.__data=group.__data;}
options=_.defaults({enableRelationalFetch:false},options);defs.push(self._load(newGroup,options));}});if(options.keepEmptyGroups){var emptyGroupsIDs=_.difference(_.pluck(previousGroups,'id'),list.data);_.each(emptyGroupsIDs,function(groupID){list.data.push(groupID);var emptyGroup=self.localData[groupID];emptyGroup.aggregateValues={};});}
return Promise.all(defs).then(function(groups){if(!options.onlyGroups){list.res_ids=_.flatten(_.map(groups,function(group){return group?group.res_ids:[];}));}
return list;}).then(function(){return Promise.all([self._fetchX2ManysSingleBatch(list),self._fetchReferencesSingleBatch(list)]).then(function(){return list;});});});},_readUngroupedList:function(list){var self=this;var def=Promise.resolve();list=this._applyX2ManyOperations(list);if(list.res_ids.length>list.limit&&list.orderedBy.length){if(!list.orderedResIDs){var fieldNames=_.pluck(list.orderedBy,'name');def=this._readMissingFields(list,_.filter(list.res_ids,_.isNumber),fieldNames);}
def.then(function(){self._sortList(list);});}
return def.then(function(){var resIDs=[];var currentResIDs=list.res_ids;if(list.orderedResIDs){currentResIDs=list.orderedResIDs.filter(function(resID){return list.res_ids.indexOf(resID)>=0;});}
var currentCount=currentResIDs.length;var upperBound=list.limit?Math.min(list.offset+list.limit,currentCount):currentCount;var fieldNames=list.getFieldNames();for(var i=list.offset;i<upperBound;i++){var resId=currentResIDs[i];if(_.isNumber(resId)){resIDs.push(resId);}}
return self._readMissingFields(list,resIDs,fieldNames).then(function(){if(list.res_ids.length<=list.limit){self._sortList(list);}else{self._setDataInRange(list);}
return list;});});},_reload:function(id,options){options=options||{};var element=this.localData[id];if(element.type==='record'){if(!options.currentId&&(('currentId'in options)||this.isNew(id))){var params={context:element.context,fieldsInfo:element.fieldsInfo,fields:element.fields,viewType:element.viewType,};return this._makeDefaultRecord(element.model,params);}
if(!options.keepChanges){this.discardChanges(id,{rollback:false});}}else if(element._changes){delete element.tempLimitIncrement;_.each(element._changes,function(change){delete change.isNew;});}
if(options.context!==undefined){element.context=options.context;}
if(options.orderedBy!==undefined){element.orderedBy=(options.orderedBy.length&&options.orderedBy)||element.orderedBy;}
if(options.domain!==undefined){element.domain=options.domain;}
if(options.groupBy!==undefined){element.groupedBy=options.groupBy;}
if(options.limit!==undefined){element.limit=options.limit;}
if(options.offset!==undefined){this._setOffset(element.id,options.offset);}
if(options.groupsLimit!==undefined){element.groupsLimit=options.groupsLimit;}
if(options.groupsOffset!==undefined){element.groupsOffset=options.groupsOffset;}
if(options.loadMoreOffset!==undefined){element.loadMoreOffset=options.loadMoreOffset;}else{element.loadMoreOffset=0;}
if(options.currentId!==undefined){element.res_id=options.currentId;}
if(options.ids!==undefined){element.res_ids=options.ids;element.count=element.res_ids.length;}
if(element.type==='record'){element.offset=_.indexOf(element.res_ids,element.res_id);}
var loadOptions=_.pick(options,'fieldNames','viewType');return this._load(element,loadOptions).then(function(result){return result.id;});},async _rpc(params){const result=await this._super(...arguments);if(this.sampleModel&&params.method==='web_read_group'&&result.length){const sampleServer=this.sampleModel.sampleServer;sampleServer.setExistingGroups(result.groups);}
return result;},_saveSpecialDataCache:function(record,fieldName,value){if(_.isEqual(record._specialDataCache[fieldName],value)){return false;}
record._specialDataCache[fieldName]=value;return true;},_searchReadUngroupedList:function(list){var self=this;var fieldNames=list.getFieldNames();var prom;if(list.__data){prom=Promise.resolve(list.__data);}else{prom=this._rpc({route:'/web/dataset/search_read',model:list.model,fields:fieldNames,context:_.extend({},list.getContext(),{bin_size:true}),domain:list.domain||[],limit:list.limit,offset:list.loadMoreOffset+list.offset,orderBy:list.orderedBy,});}
return prom.then(function(result){delete list.__data;list.count=result.length;var ids=_.pluck(result.records,'id');var data=_.map(result.records,function(record){var dataPoint=self._makeDataPoint({context:list.context,data:record,fields:list.fields,fieldsInfo:list.fieldsInfo,modelName:list.model,parentID:list.id,viewType:list.viewType,});self._parseServerData(fieldNames,dataPoint,dataPoint.data);return dataPoint.id;});if(list.loadMoreOffset){list.data=list.data.concat(data);list.res_ids=list.res_ids.concat(ids);}else{list.data=data;list.res_ids=ids;}
self._updateParentResIDs(list);return list;});},_setDataInRange:function(list){var idsInRange;if(list.limit){idsInRange=list.res_ids.slice(list.offset,list.offset+list.limit);}else{idsInRange=list.res_ids;}
list.data=[];_.each(idsInRange,function(id){if(list._cache[id]){list.data.push(list._cache[id]);}});if(list.limit){for(var i=list.offset+list.limit;i<list.res_ids.length;i++){var id=list.res_ids[i];var dataPointID=list._cache[id];if(_.findWhere(list._changes,{isNew:true,id:dataPointID})){list.data.push(dataPointID);}else{break;}}}},_setOffset:function(elementId,offset){var element=this.localData[elementId];element.offset=offset;if(element.type==='record'&&element.res_ids.length){element.res_id=element.res_ids[offset];}},_sortList:function(list){if(!list.static){return;}
var self=this;if(list.orderedResIDs){var orderedResIDs={};for(var k=0;k<list.orderedResIDs.length;k++){orderedResIDs[list.orderedResIDs[k]]=k;}
utils.stableSort(list.res_ids,function compareResIdIndexes(resId1,resId2){if(!(resId1 in orderedResIDs)&&!(resId2 in orderedResIDs)){return 0;}
if(!(resId1 in orderedResIDs)){return Infinity;}
if(!(resId2 in orderedResIDs)){return-Infinity;}
return orderedResIDs[resId1]-orderedResIDs[resId2];});}else if(list.orderedBy.length){var compareRecords=function(resId1,resId2,level){if(!level){level=0;}
if(list.orderedBy.length<level+1){return 0;}
var order=list.orderedBy[level];var record1ID=list._cache[resId1];var record2ID=list._cache[resId2];if(!record1ID&&!record2ID){return 0;}
if(!record1ID){return Infinity;}
if(!record2ID){return-Infinity;}
var r1=self.localData[record1ID];var r2=self.localData[record2ID];var data1=_.extend({},r1.data,r1._changes);var data2=_.extend({},r2.data,r2._changes);var orderData1=data1[order.name];var orderData2=data2[order.name];if(list.fields[order.name].type==='many2one'){orderData1=orderData1?self.localData[orderData1].data.display_name:"";orderData2=orderData2?self.localData[orderData2].data.display_name:"";}
if(orderData1<orderData2){return order.asc?-1:1;}
if(orderData1>orderData2){return order.asc?1:-1;}
return compareRecords(resId1,resId2,level+1);};utils.stableSort(list.res_ids,compareRecords);}
this._setDataInRange(list);},_updateParentResIDs:function(element){var self=this;if(element.parentID){var parent=this.localData[element.parentID];parent.res_ids=_.flatten(_.map(parent.data,function(dataPointID){return self.localData[dataPointID].res_ids;}));this._updateParentResIDs(parent);}},_updateRecordsData:function(records,fieldName,values){if(!records.length||!values){return;}
var self=this;var field=records[0].fields[fieldName];var fieldInfo=records[0].fieldsInfo[records[0].viewType][fieldName];var view=fieldInfo.views&&fieldInfo.views[fieldInfo.mode];var fieldsInfo=view?view.fieldsInfo:fieldInfo.fieldsInfo;var fields=view?view.fields:fieldInfo.relatedFields;var viewType=view?view.type:fieldInfo.viewType;_.each(records,function(record){var x2mList=self.localData[record.data[fieldName]];x2mList.data=[];_.each(x2mList.res_ids,function(res_id){var dataPoint=self._makeDataPoint({modelName:field.relation,data:_.findWhere(values,{id:res_id}),fields:fields,fieldsInfo:fieldsInfo,parentID:x2mList.id,viewType:viewType,});x2mList.data.push(dataPoint.id);x2mList._cache[res_id]=dataPoint.id;});});},_visitChildren:function(element,fn){var self=this;fn(element);if(element.type==='record'){for(var fieldName in element.data){var field=element.fields[fieldName];if(!field){continue;}
if(_.contains(['one2many','many2one','many2many'],field.type)){var hasChange=element._changes&&fieldName in element._changes;var value=hasChange?element._changes[fieldName]:element.data[fieldName];var relationalElement=this.localData[value];if(relationalElement){self._visitChildren(relationalElement,fn);}}}}
if(element.type==='list'){element=this._applyX2ManyOperations(element);_.each(element.data,function(elemId){var elem=self.localData[elemId];self._visitChildren(elem,fn);});}},});return BasicModel;});;

/* /web/static/src/js/views/basic/basic_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.BasicView',function(require){"use strict";var AbstractView=require('web.AbstractView');var BasicController=require('web.BasicController');var BasicModel=require('web.BasicModel');var config=require('web.config');var fieldRegistry=require('web.field_registry');var fieldRegistryOwl=require('web.field_registry_owl');var pyUtils=require('web.py_utils');var utils=require('web.utils');var BasicView=AbstractView.extend({config:_.extend({},AbstractView.prototype.config,{Model:BasicModel,Controller:BasicController,}),viewType:undefined,init:function(viewInfo,params){this._super.apply(this,arguments);this.fieldsInfo={};this.fieldsInfo[this.viewType]=this.fieldsView.fieldsInfo[this.viewType];this.rendererParams.viewType=this.viewType;this.controllerParams.confirmOnDelete=true;this.controllerParams.archiveEnabled='active'in this.fields||'x_active'in this.fields;this.controllerParams.hasButtons='action_buttons'in params?params.action_buttons:true;this.controllerParams.viewId=viewInfo.view_id;this.loadParams.fieldsInfo=this.fieldsInfo;this.loadParams.fields=this.fields;this.loadParams.limit=parseInt(this.arch.attrs.limit,10)||params.limit;this.loadParams.parentID=params.parentID;this.loadParams.viewType=this.viewType;this.recordID=params.recordID;this.model=params.model;},_getFieldWidgetClass:function(viewType,field,attrs){var FieldWidget;if(attrs.widget){FieldWidget=fieldRegistryOwl.getAny([viewType+"."+attrs.widget,attrs.widget])||fieldRegistry.getAny([viewType+"."+attrs.widget,attrs.widget]);if(!FieldWidget){console.warn("Missing widget: ",attrs.widget," for field",attrs.name,"of type",field.type);}}else if(viewType==='kanban'&&field.type==='many2many'){FieldWidget=fieldRegistry.get('kanban.many2many_tags');}
return FieldWidget||fieldRegistryOwl.getAny([viewType+"."+field.type,field.type,"abstract"])||fieldRegistry.getAny([viewType+"."+field.type,field.type,"abstract"]);},_loadData:async function(model){if(this.recordID){await model.addFieldsInfo(this.recordID,{fields:this.fields,fieldInfo:this.fieldsInfo[this.viewType],viewType:this.viewType,});var record=model.get(this.recordID);var viewType=this.viewType;var viewFields=Object.keys(record.fieldsInfo[viewType]);var fieldNames=_.difference(viewFields,Object.keys(record.data));var fieldsInfo=record.fieldsInfo[viewType];_.each(viewFields,(name)=>{if(!_.contains(fieldNames,name)){var fieldType=record.fields[name].type;var fieldInfo=fieldsInfo[name];if(fieldInfo.Widget){var requiresSpecialData=fieldInfo.Widget.prototype.specialData;if(requiresSpecialData&&!(name in record.specialData)){fieldNames.push(name);return;}}
if((fieldType==='one2many'||fieldType==='many2many')){if(!('fieldsInfo'in record.data[name])){fieldNames.push(name);}else{var x2mFieldInfo=record.fieldsInfo[this.viewType][name];var viewType=x2mFieldInfo.viewType||x2mFieldInfo.mode;var knownFields=Object.keys(record.data[name].fieldsInfo[record.data[name].viewType]||{});var newFields=Object.keys(record.data[name].fieldsInfo[viewType]||{});if(_.difference(newFields,knownFields).length){fieldNames.push(name);}
if(record.data[name].viewType==='default'){var fieldViews=fieldInfo.views||fieldInfo.fieldsInfo||{};var defaultFieldInfo=record.data[name].fieldsInfo.default;_.each(fieldViews,function(fieldView){_.each(fieldView.fieldsInfo,function(x2mFieldInfo){_.defaults(x2mFieldInfo,defaultFieldInfo);});});}}}
if(fieldType==='many2one'){if(JSON.stringify(record.data[name].context)!==JSON.stringify(fieldInfo.context)){fieldNames.push(name);}}}});var def;if(fieldNames.length){if(model.isNew(record.id)){def=model.generateDefaultValues(record.id,{fieldNames:fieldNames,viewType:viewType,});}else{def=model.reload(record.id,{fieldNames:fieldNames,keepChanges:true,viewType:viewType,});}}
return Promise.resolve(def).then(function(){const handle=record.id;return{state:model.get(handle),handle};});}
return this._super.apply(this,arguments);},_processArch:function(arch,fv){var self=this;utils.traverse(arch,function(node){return self._processNode(node,fv);});},_processField:function(viewType,field,attrs){var self=this;attrs.Widget=this._getFieldWidgetClass(viewType,field,attrs);_.each(attrs,function(value,key){if(key.startsWith('decoration-')){attrs.decorations=attrs.decorations||[];attrs.decorations.push({name:key,expression:pyUtils._getPyJSAST(value),});}});if(!_.isObject(attrs.options)){attrs.options=attrs.options?pyUtils.py_eval(attrs.options):{};}
if(attrs.on_change&&attrs.on_change!=="0"&&!field.onChange){field.onChange="1";}
if(attrs.modifiers.invisible===true||attrs.modifiers.column_invisible===true){attrs.__no_fetch=true;}
if(!_.isEmpty(field.views)){attrs.views={};_.each(field.views,function(innerFieldsView,viewType){viewType=viewType==='tree'?'list':viewType;attrs.views[viewType]=self._processFieldsView(innerFieldsView,viewType);});}
attrs.views=attrs.views||{};attrs.mode=attrs.mode==='tree'?'list':attrs.mode;if(!attrs.views.list&&attrs.views.tree){attrs.views.list=attrs.views.tree;}
if(field.type==='one2many'||field.type==='many2many'){if(attrs.Widget.prototype.useSubview){var mode=attrs.mode;if(!mode){if(attrs.views.list&&!attrs.views.kanban){mode='list';}else if(!attrs.views.list&&attrs.views.kanban){mode='kanban';}else{mode='list,kanban';}}
if(mode.indexOf(',')!==-1){mode=config.device.isMobile?'kanban':'list';}
attrs.mode=mode;if(mode in attrs.views){var view=attrs.views[mode];this._processSubViewAttrs(view,attrs);}}
if(attrs.Widget.prototype.fieldsToFetch){attrs.viewType='default';attrs.relatedFields=_.extend({},attrs.Widget.prototype.fieldsToFetch);attrs.fieldsInfo={default:_.mapObject(attrs.Widget.prototype.fieldsToFetch,function(){return{};}),};if(attrs.options.color_field){attrs.relatedFields[attrs.options.color_field]={type:'integer'};attrs.fieldsInfo.default[attrs.options.color_field]={};}}}
if(attrs.Widget.prototype.fieldDependencies){attrs.fieldDependencies=attrs.Widget.prototype.fieldDependencies;}
return attrs;},_processFieldsView:function(fieldsView,viewType){var fv=this._super.apply(this,arguments);viewType=viewType||this.viewType;fv.type=viewType;fv.fieldsInfo=Object.create(null);fv.fieldsInfo[viewType]=Object.create(null);this._processArch(fv.arch,fv);return fv;},_processNode:function(node,fv){if(typeof node==='string'){return false;}
if(!_.isObject(node.attrs.modifiers)){node.attrs.modifiers=node.attrs.modifiers?JSON.parse(node.attrs.modifiers):{};}
if(!_.isObject(node.attrs.options)&&node.tag==='button'){node.attrs.options=node.attrs.options?JSON.parse(node.attrs.options):{};}
if(node.tag==='field'){var viewType=fv.type;var fieldsInfo=fv.fieldsInfo[viewType];var fields=fv.viewFields;fieldsInfo[node.attrs.name]=this._processField(viewType,fields[node.attrs.name],node.attrs?_.clone(node.attrs):{});if(fieldsInfo[node.attrs.name].fieldDependencies){var deps=fieldsInfo[node.attrs.name].fieldDependencies;for(var dependency_name in deps){var dependency_dict={name:dependency_name,type:deps[dependency_name].type};if(!(dependency_name in fieldsInfo)){fieldsInfo[dependency_name]=_.extend({},dependency_dict,{options:deps[dependency_name].options||{},});}
if(!(dependency_name in fields)){fields[dependency_name]=dependency_dict;}
if(fv.fields&&!(dependency_name in fv.fields)){fv.fields[dependency_name]=dependency_dict;}}}
return false;}
return node.tag!=='arch';},_processSubViewAttrs:function(view,attrs){var defaultOrder=view.arch.attrs.default_order;if(defaultOrder){attrs.orderedBy=_.map(defaultOrder.split(','),function(order){order=order.trim().split(' ');return{name:order[0],asc:order[1]!=='desc'};});}else{var handleField=_.find(view.arch.children,function(child){return child.attrs&&child.attrs.widget==='handle';});if(handleField){attrs.orderedBy=[{name:handleField.attrs.name,asc:true}];}}
attrs.columnInvisibleFields={};_.each(view.arch.children,function(child){if(child.attrs&&child.attrs.modifiers){attrs.columnInvisibleFields[child.attrs.name]=child.attrs.modifiers.column_invisible||false;}});},});return BasicView;});;

/* /web/static/src/js/views/basic/basic_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.BasicController',function(require){"use strict";var AbstractController=require('web.AbstractController');var core=require('web.core');var Dialog=require('web.Dialog');var FieldManagerMixin=require('web.FieldManagerMixin');var TranslationDialog=require('web.TranslationDialog');var _t=core._t;var BasicController=AbstractController.extend(FieldManagerMixin,{events:Object.assign({},AbstractController.prototype.events,{'click .o_content':'_onContentClicked',}),custom_events:_.extend({},AbstractController.prototype.custom_events,FieldManagerMixin.custom_events,{discard_changes:'_onDiscardChanges',pager_changed:'_onPagerChanged',reload:'_onReload',resequence_records:'_onResequenceRecords',set_dirty:'_onSetDirty',load_optional_fields:'_onLoadOptionalFields',save_optional_fields:'_onSaveOptionalFields',translate:'_onTranslate',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.archiveEnabled=params.archiveEnabled;this.confirmOnDelete=params.confirmOnDelete;this.hasButtons=params.hasButtons;FieldManagerMixin.init.call(this,this.model);this.mode=params.mode||'readonly';this.savingDef=Promise.resolve();this.discardingDef=null;this.viewId=params.viewId;},start:async function(){this.$el.toggleClass('o_cannot_create',!this.activeActions.create);await this._super(...arguments);},canBeDiscarded:function(recordID){var self=this;if(this.discardingDef){return this.discardingDef;}
if(!this.isDirty(recordID)){return Promise.resolve(false);}
var message=_t("The record has been modified, your changes will be discarded. Do you want to proceed?");this.discardingDef=new Promise(function(resolve,reject){var dialog=Dialog.confirm(self,message,{title:_t("Warning"),confirm_callback:()=>{resolve(true);self.discardingDef=null;},cancel_callback:()=>{reject();self.discardingDef=null;},});dialog.on('closed',self.discardingDef,reject);});return this.discardingDef;},canBeSaved:function(recordID){var fieldNames=this.renderer.canBeSaved(recordID||this.handle);if(fieldNames.length){this._notifyInvalidFields(fieldNames);return false;}
return true;},discardChanges:function(recordID,options){return Promise.all([this.mutex.getUnlockedDef(),this.savingDef]).then(this._discardChanges.bind(this,recordID||this.handle,options));},getSelectedIds:function(){return[];},isDirty:function(recordID){return this.model.isDirty(recordID||this.handle);},saveRecord:function(recordID,options){var self=this;var unlockedMutex=this.mutex.getUnlockedDef().then(function(){return self.renderer.commitChanges(recordID||self.handle);}).then(function(){return self.mutex.exec(self._saveRecord.bind(self,recordID,options));});this.savingDef=new Promise(function(resolve){unlockedMutex.then(resolve).guardedCatch(resolve);});return unlockedMutex;},update:async function(params,options){this.mode=params.mode||this.mode;return this._super(params,options);},reload:function(params){if(params&&params.controllerState){if(params.controllerState.currentId){params.currentId=params.controllerState.currentId;}
params.ids=params.controllerState.resIds;}
return this._super.apply(this,arguments);},_abandonRecord:function(recordID){recordID=recordID||this.handle;if(recordID===this.handle){this.trigger_up('history_back');}else{this.model.removeLine(recordID);}},_applyChanges:function(dataPointID,changes,event){var _super=FieldManagerMixin._applyChanges.bind(this);return this.mutex.exec(function(){return _super(dataPointID,changes,event);});},_archive:async function(ids,archive){if(ids.length===0){return Promise.resolve();}
if(archive){await this.model.actionArchive(ids,this.handle);}else{await this.model.actionUnarchive(ids,this.handle);}
return this.update({},{reload:false});},_callButtonAction:function(attrs,record){record=record||this.model.get(this.handle);const actionData=Object.assign({},attrs,{context:record.getContext({additionalContext:attrs.context||{}})});const recordData={context:record.getContext(),currentID:record.data.id,model:record.model,resIDs:record.res_ids,};return this._executeButtonAction(actionData,recordData);},_confirmChange:function(id,fields,e){if(e.name==='discard_changes'&&e.target.reset){return e.target.reset(this.model.get(e.target.dataPointID),e,true);}
var state=this.model.get(this.handle);return this.renderer.confirmChange(state,id,fields,e);},_confirmSaveNewRecord:function(){var self=this;var def=new Promise(function(resolve,reject){var message=_t("You need to save this new record before editing the translation. Do you want to proceed?");var dialog=Dialog.confirm(self,message,{title:_t("Warning"),confirm_callback:resolve.bind(self,true),cancel_callback:reject,});dialog.on('closed',self,reject);});return def;},_deleteRecords:function(ids){var self=this;function doIt(){return self.model.deleteRecords(ids,self.modelName).then(self._onDeletedRecords.bind(self,ids));}
if(this.confirmOnDelete){const message=ids.length>1?_t("Are you sure you want to delete these records?"):_t("Are you sure you want to delete this record?");Dialog.confirm(this,message,{confirm_callback:doIt});}else{doIt();}},_disableButtons:function(){if(this.$buttons){this.$buttons.find('button').attr('disabled',true);}},_discardChanges:function(recordID,options){var self=this;recordID=recordID||this.handle;options=options||{};return this.canBeDiscarded(recordID).then(function(needDiscard){if(options.readonlyIfRealDiscard&&!needDiscard){return;}
self.model.discardChanges(recordID);if(options.noAbandon){return;}
if(self.model.canBeAbandoned(recordID)){self._abandonRecord(recordID);return;}
return self._confirmSave(recordID);});},_enableButtons:function(){if(this.$buttons){this.$buttons.find('button').removeAttr('disabled');}},async _executeButtonAction(actionData,recordData){const prom=new Promise((resolve,reject)=>{this.trigger_up('execute_action',{action_data:actionData,env:recordData,on_closed:()=>this.isDestroyed()?Promise.resolve():this.reload(),on_success:resolve,on_fail:()=>this.update({},{reload:false}).then(reject).guardedCatch(reject)});});return this.alive(prom);},exportState:function(){var state=this._super.apply(this,arguments);var env=this.model.get(this.handle,{env:true});return _.extend(state,{currentId:env.currentId,resIds:env.ids,});},_getOptionalFieldsLocalStorageKey:function(keyParts){keyParts.model=this.modelName;keyParts.viewType=this.viewType;keyParts.viewId=this.viewId;var parts=['model','viewType','viewId','relationalField','subViewType','subViewId',];var viewIdentifier=parts.reduce(function(identifier,partName){if(partName in keyParts){return identifier+','+keyParts[partName];}
return identifier;},'optional_fields');viewIdentifier=keyParts.fields.sort(this._nameSortComparer).reduce(function(identifier,field){return identifier+','+field.name;},viewIdentifier);return viewIdentifier;},_getPagingInfo:function(state){const isGrouped=state.groupedBy&&state.groupedBy.length;return{currentMinimum:(isGrouped?state.groupsOffset:state.offset)+1,limit:isGrouped?state.groupsLimit:state.limit,size:isGrouped?state.groupsCount:state.count,};},_getActionMenuItems:function(state){return{activeIds:this.getSelectedIds(),context:state.getContext(),};},_nameSortComparer:function(left,right){return left.name<right.name?-1:1;},_notifyInvalidFields:function(invalidFields){var record=this.model.get(this.handle,{raw:true});var fields=record.fields;var warnings=invalidFields.map(function(fieldName){var fieldStr=fields[fieldName].string;return _.str.sprintf('<li>%s</li>',_.escape(fieldStr));});warnings.unshift('<ul>');warnings.push('</ul>');this.do_warn(_t("Invalid fields:"),warnings.join(''));},_onDeletedRecords:function(ids){this.update({});},_saveRecord:function(recordID,options){recordID=recordID||this.handle;options=_.defaults(options||{},{stayInEdit:false,reload:true,savePoint:false,});if(this.canBeSaved(recordID)){var self=this;var saveDef=this.model.save(recordID,{reload:options.reload,savePoint:options.savePoint,viewType:options.viewType,});if(!options.stayInEdit){saveDef=saveDef.then(function(fieldNames){var def=fieldNames.length?self._confirmSave(recordID):self._setMode('readonly',recordID);return def.then(function(){return fieldNames;});});}
return saveDef;}else{return Promise.reject("SaveRecord: this.canBeSave is false");}},_setMode:function(mode,recordID){if((recordID||this.handle)===this.handle){return this.update({mode:mode},{reload:false}).then(function(){core.bus.trigger('DOM_updated');});}
return Promise.resolve();},_shouldBounceOnClick:function(){return false;},_updateControlPanel:function(newProps={}){const state=this.model.get(this.handle);const props=Object.assign(newProps,{actionMenus:this._getActionMenuItems(state),pager:this._getPagingInfo(state),title:this.getTitle(),});return this.updateControlPanel(props);},_onContentClicked(ev){if(this.$buttons&&this._shouldBounceOnClick(ev.target)){this.$buttons.find('.btn-primary:visible:first').odooBounce();}},_onDiscardChanges:function(ev){var self=this;ev.stopPropagation();var recordID=ev.data.recordID;this._discardChanges(recordID).then(function(){self._confirmChange(recordID,[ev.data.fieldName],ev).then(ev.data.onSuccess).guardedCatch(ev.data.onSuccess);}).guardedCatch(ev.data.onFailure);},_onFieldChanged:function(ev){if(this.mode==='readonly'){ev.data.force_save=true;}
FieldManagerMixin._onFieldChanged.apply(this,arguments);},_onPagerChanged:async function(ev){ev.stopPropagation();const{currentMinimum,limit}=ev.data;const state=this.model.get(this.handle,{raw:true});const reloadParams=state.groupedBy&&state.groupedBy.length?{groupsLimit:limit,groupsOffset:currentMinimum-1,}:{limit,offset:currentMinimum-1,};await this.reload(reloadParams);if(state.limit===limit){this.trigger_up('scrollTo',{top:0});}},_onReload:function(ev){ev.stopPropagation();var data=ev&&ev.data||{};var handle=data.db_id;var prom;if(handle){prom=this.model.reload(handle).then(this._confirmSave.bind(this,handle));}else{prom=this.reload({fieldNames:data.fieldNames,keepChanges:data.keepChanges||false,});}
prom.then(ev.data.onSuccess).guardedCatch(ev.data.onFailure);},_onResequenceRecords:function(ev){ev.stopPropagation();this.trigger_up('mutexify',{action:async()=>{let state=this.model.get(this.handle);const resIDs=ev.data.recordIds.map(recordID=>state.data.find(d=>d.id===recordID).res_id);const options={offset:ev.data.offset,field:ev.data.handleField,};await this.model.resequence(this.modelName,resIDs,this.handle,options);this._updateControlPanel();state=this.model.get(this.handle);return this._updateRendererState(state,{noRender:true});},});},_onLoadOptionalFields:function(ev){var res=this.call('local_storage','getItem',this._getOptionalFieldsLocalStorageKey(ev.data.keyParts));ev.data.callback(res);},_onSaveOptionalFields:function(ev){this.call('local_storage','setItem',this._getOptionalFieldsLocalStorageKey(ev.data.keyParts),ev.data.optionalColumnsEnabled);},_onSetDirty:function(ev){ev.stopPropagation();this.model.setDirty(ev.data.dataPointID);},_onTranslate:async function(ev){ev.stopPropagation();if(this.model.isNew(ev.data.id)){await this._confirmSaveNewRecord();var updatedFields=await this.saveRecord(ev.data.id,{stayInEdit:true});await this._confirmChange(ev.data.id,updatedFields,ev);}
var record=this.model.get(ev.data.id,{raw:true});var res_id=record.res_id||record.res_ids[0];var result=await this._rpc({route:'/web/dataset/call_button',params:{model:'ir.translation',method:'translate_fields',args:[record.model,res_id,ev.data.fieldName],kwargs:{context:record.getContext()},}});this.translationDialog=new TranslationDialog(this,{domain:result.domain,searchName:result.context.search_default_name,fieldName:ev.data.fieldName,userLanguageValue:ev.target.value||'',dataPointID:record.id,isComingFromTranslationAlert:ev.data.isComingFromTranslationAlert,isText:result.context.translation_type==='text',showSrc:result.context.translation_show_src,});return this.translationDialog.open();},});return BasicController;});;

/* /web/static/src/js/views/basic/basic_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.BasicRenderer',function(require){"use strict";var AbstractRenderer=require('web.AbstractRenderer');var config=require('web.config');var core=require('web.core');var dom=require('web.dom');const session=require('web.session');const utils=require('web.utils');var widgetRegistry=require('web.widget_registry');const{WidgetAdapterMixin}=require('web.OwlCompatibility');const FieldWrapper=require('web.FieldWrapper');var qweb=core.qweb;const _t=core._t;var BasicRenderer=AbstractRenderer.extend(WidgetAdapterMixin,{custom_events:{navigation_move:'_onNavigationMove',},init:function(parent,state,params){this._super.apply(this,arguments);this.activeActions=params.activeActions;this.viewType=params.viewType;this.mode=params.mode||'readonly';this.widgets=[];this.handleField=null;},destroy:function(){this._super.apply(this,arguments);WidgetAdapterMixin.destroy.call(this);},on_attach_callback:function(){this._isInDom=true;for(const handle in this.allFieldWidgets){this.allFieldWidgets[handle].forEach(widget=>{if(!utils.isComponent(widget.constructor)&&widget.on_attach_callback){widget.on_attach_callback();}});}
this.widgets.forEach(widget=>{if(widget.on_attach_callback){widget.on_attach_callback();}});WidgetAdapterMixin.on_attach_callback.call(this);},on_detach_callback:function(){this._isInDom=false;for(const handle in this.allFieldWidgets){this.allFieldWidgets[handle].forEach(widget=>{if(!utils.isComponent(widget.constructor)&&widget.on_detach_callback){widget.on_detach_callback();}});}
this.widgets.forEach(widget=>{if(widget.on_detach_callback){widget.on_detach_callback();}});WidgetAdapterMixin.on_detach_callback.call(this);},canBeSaved:function(recordID){var self=this;var invalidFields=[];_.each(this.allFieldWidgets[recordID],function(widget){var canBeSaved=self._canWidgetBeSaved(widget);if(!canBeSaved){invalidFields.push(widget.name);}
if(widget.el){widget.$el.toggleClass('o_field_invalid',!canBeSaved);widget.$el.attr('aria-invalid',!canBeSaved);}});return invalidFields;},commitChanges:function(recordID){var defs=_.map(this.allFieldWidgets[recordID],function(widget){return widget.commitChanges();});return Promise.all(defs);},confirmChange:function(state,id,fields,ev){var self=this;this._setState(state);var record=this._getRecord(id);if(!record){return this._render().then(_.constant([]));}
_.invoke(this.widgets,'updateState',state);var defs=[];_.each(this.allFieldWidgets[id],function(widget){var fieldChanged=_.contains(fields,widget.name);if(fieldChanged||widget.resetOnAnyFieldChange){defs.push(widget.reset(record,ev,fieldChanged));}});defs.push(this._updateAllModifiers(record));return Promise.all(defs).then(function(){return _.filter(self.allFieldWidgets[id],function(widget){var fieldChanged=_.contains(fields,widget.name);return fieldChanged||widget.resetOnAnyFieldChange;});});},focusField:function(id,fieldName,offset){this.editRecord(id);if(typeof offset==="number"){var field=_.findWhere(this.allFieldWidgets[id],{name:fieldName});dom.setSelectionRange(field.getFocusableElement().get(0),{start:offset,end:offset});}},_activateFieldWidget:function(record,currentIndex,options){options=options||{};_.defaults(options,{inc:1,wrap:false});currentIndex=Math.max(0,currentIndex);var recordWidgets=this.allFieldWidgets[record.id]||[];for(var i=0;i<recordWidgets.length;i++){var activated=recordWidgets[currentIndex].activate({event:options.event,noAutomaticCreate:options.noAutomaticCreate||false});if(activated){return currentIndex;}
currentIndex+=options.inc;if(currentIndex>=recordWidgets.length){if(options.wrap){currentIndex-=recordWidgets.length;}else{return-1;}}else if(currentIndex<0){if(options.wrap){currentIndex+=recordWidgets.length;}else{return-1;}}}
return-1;},_activateNextFieldWidget:function(record,currentIndex,options){currentIndex=(currentIndex+1)%(this.allFieldWidgets[record.id]||[]).length;return this._activateFieldWidget(record,currentIndex,_.extend({inc:1},options));},_activatePreviousFieldWidget:function(record,currentIndex){currentIndex=currentIndex?(currentIndex-1):((this.allFieldWidgets[record.id]||[]).length-1);return this._activateFieldWidget(record,currentIndex,{inc:-1});},_addFieldTooltip:function(widget,$node){$node=$node.length?$node:widget.$el;$node.tooltip(this._getTooltipOptions(widget));},_applyModifiers:function(modifiersData,record,element){var self=this;var modifiers=modifiersData.evaluatedModifiers[record.id]||{};if(element){_apply(element);}else{_.each(_.clone(modifiersData.elementsByRecord[record.id]),_apply);}
function _apply(element){if('readonly'in modifiers&&element.widget){var mode=modifiers.readonly?'readonly':modifiersData.baseModeByRecord[record.id];if(mode!==element.widget.mode){self._rerenderFieldWidget(element.widget,record,{keepBaseMode:true,mode:mode,});return;}}
element.$el.toggleClass("o_invisible_modifier",!!modifiers.invisible);element.$el.toggleClass("o_readonly_modifier",!!modifiers.readonly);element.$el.toggleClass("o_required_modifier",!!modifiers.required);if(element.widget&&element.widget.updateModifiersValue){element.widget.updateModifiersValue(modifiers);}
if(element.callback){element.callback(element,modifiers,record);}}},_canWidgetBeSaved:function(widget){var modifiers=this._getEvaluatedModifiers(widget.__node,widget.record);return widget.isValid()&&(widget.isSet()||!modifiers.required);},_destroyFieldWidget:function(recordID,widget){var recordWidgets=this.allFieldWidgets[recordID];var index=recordWidgets.indexOf(widget);if(index>=0){recordWidgets.splice(index,1);}
this._unregisterModifiersElement(widget.__node,recordID,widget);widget.destroy();return index;},_getEvaluatedModifiers:function(node,record){var element=this._getModifiersData(node);if(!element){return{};}
return element.evaluatedModifiers[record.id]||{};},_getModifiersData:function(node){return _.findWhere(this.allModifiersData,{node:node});},_getRecord:function(recordId){return null;},_getTooltipOptions:function(widget){return{title:function(){let help=widget.attrs.help||widget.field.help||'';if(session.display_switch_company_menu&&widget.field.company_dependent){help+=(help?'\n\n':'')+_t('Values set here are company-specific.');}
const debug=config.isDebug();if(help||debug){return qweb.render('WidgetLabel.tooltip',{debug,help,widget});}}};},_handleAttributes:function($el,node){if($el.is('button')){return;}
if(node.attrs.class){$el.addClass(node.attrs.class);}
if(node.attrs.style){$el.attr('style',node.attrs.style);}
if(node.attrs.placeholder){$el.attr('placeholder',node.attrs.placeholder);}},_hasContent:function(){return this.state.count!==0&&(!('isSample'in this.state)||!this.state.isSample);},_moveRecord:function(recordId,toIndex){var self=this;var records=this.state.data;var record=_.findWhere(records,{id:recordId});var fromIndex=records.indexOf(record);var lowerIndex=Math.min(fromIndex,toIndex);var upperIndex=Math.max(fromIndex,toIndex)+1;var order=_.findWhere(this.state.orderedBy,{name:this.handleField});var asc=!order||order.asc;var reorderAll=false;var sequence=(asc?-1:1)*Infinity;_.each(records,function(record,index){if((index<lowerIndex||index>=upperIndex)&&((asc&&sequence>=record.data[self.handleField])||(!asc&&sequence<=record.data[self.handleField]))){reorderAll=true;}
sequence=record.data[self.handleField];});if(reorderAll){records=_.without(records,record);records.splice(toIndex,0,record);}else{records=records.slice(lowerIndex,upperIndex);records=_.without(records,record);if(fromIndex>toIndex){records.unshift(record);}else{records.push(record);}}
var sequences=_.pluck(_.pluck(records,'data'),this.handleField);var recordIds=_.pluck(records,'id');if(!asc){recordIds.reverse();}
this.trigger_up('resequence_records',{handleField:this.handleField,offset:_.min(sequences),recordIds:recordIds,});},_postProcessField:function(widget,node){this._handleAttributes(widget.$el,node);},_registerModifiers:function(node,record,element,options){options=options||{};var modifiersData=this._getModifiersData(node);if(!modifiersData){var modifiers=node.attrs.modifiers||{};modifiersData={node:node,modifiers:modifiers,evaluatedModifiers:{},elementsByRecord:{},baseModeByRecord:{},};if(!_.isEmpty(modifiers)){this.allModifiersData.push(modifiersData);}}
if(!modifiersData.baseModeByRecord[record.id]||!options.keepBaseMode){modifiersData.baseModeByRecord[record.id]=options.mode||this.mode;}
if(!modifiersData.evaluatedModifiers[record.id]){try{modifiersData.evaluatedModifiers[record.id]=record.evalModifiers(modifiersData.modifiers);}catch(e){throw new Error(_.str.sprintf("While parsing modifiers for %s%s: %s",node.tag,node.tag==='field'?' '+node.attrs.name:'',e.message));}}
if(element){var newElement={};if(element instanceof jQuery){newElement.$el=element;}else{newElement.widget=element;newElement.$el=element.$el;}
if(options&&options.callback){newElement.callback=options.callback;}
if(!modifiersData.elementsByRecord[record.id]){modifiersData.elementsByRecord[record.id]=[];}
modifiersData.elementsByRecord[record.id].push(newElement);this._applyModifiers(modifiersData,record,newElement);}
return modifiersData.evaluatedModifiers[record.id];},async _render(){const oldAllFieldWidgets=this.allFieldWidgets;this.allFieldWidgets={};this.allModifiersData=[];const oldWidgets=this.widgets;this.widgets=[];await this._super(...arguments);for(const id in oldAllFieldWidgets){for(const widget of oldAllFieldWidgets[id]){widget.destroy();}}
for(const widget of oldWidgets){widget.destroy();}
if(this._isInDom){for(const handle in this.allFieldWidgets){this.allFieldWidgets[handle].forEach(widget=>{if(widget.on_attach_callback){widget.on_attach_callback();}});}
this.widgets.forEach(widget=>{if(widget.on_attach_callback){widget.on_attach_callback();}});}},_renderFieldWidget:function(node,record,options){options=options||{};var fieldName=node.attrs.name;var mode=options.mode||this.mode;var modifiers=this._registerModifiers(node,record,null,options);var Widget=record.fieldsInfo[this.viewType][fieldName].Widget;const legacy=!(Widget.prototype instanceof owl.Component);const widgetOptions={mode:modifiers.readonly?'readonly':mode,viewType:this.viewType,};let widget;if(legacy){widget=new Widget(this,fieldName,record,widgetOptions);}else{widget=new FieldWrapper(this,Widget,{fieldName,record,options:widgetOptions,});}
if(this.allFieldWidgets[record.id]===undefined){this.allFieldWidgets[record.id]=[];}
this.allFieldWidgets[record.id].push(widget);widget.__node=node;var $el=$('<div>');let def;if(legacy){def=widget._widgetRenderAndInsert(function(){});}else{def=widget.mount(document.createDocumentFragment());}
this.defs.push(def);var self=this;def.then(function(){widget.$el.addClass($el.attr('class'));$el.replaceWith(widget.$el);self._registerModifiers(node,record,widget,{callback:function(element,modifiers,record){element.$el.toggleClass('o_field_empty',!!(record.data.id&&(modifiers.readonly||mode==='readonly')&&element.widget.isEmpty()));},keepBaseMode:!!options.keepBaseMode,mode:mode,});self._postProcessField(widget,node);});return $el;},_renderWidget:function(record,node){var Widget=widgetRegistry.get(node.attrs.name);var widget=new Widget(this,record,node);this.widgets.push(widget);var def=widget._widgetRenderAndInsert(function(){});this.defs.push(def);var $el=$('<div>');var self=this;def.then(function(){self._handleAttributes(widget.$el,node);self._registerModifiers(node,record,widget);widget.$el.addClass('o_widget');$el.replaceWith(widget.$el);});return $el;},_rerenderFieldWidget:function(widget,record,options){var $el=this._renderFieldWidget(widget.__node,record,options);const recordWidgets=this.allFieldWidgets[record.id];const newWidget=recordWidgets[recordWidgets.length-1];const def=this.defs[this.defs.length-1];const $div=$('<div>');$div.append($el);def.then(()=>{widget.$el.replaceWith($div.children());recordWidgets.splice(recordWidgets.indexOf(newWidget),1);var oldIndex=this._destroyFieldWidget(record.id,widget);recordWidgets.splice(oldIndex,0,newWidget);if(this._isInDom&&newWidget.on_attach_callback){newWidget.on_attach_callback();}});},_unregisterModifiersElement:function(node,recordID,element){var modifiersData=this._getModifiersData(node);if(modifiersData){var elements=modifiersData.elementsByRecord[recordID];var index=_.findIndex(elements,function(oldElement){return oldElement.widget===element||oldElement.$el[0]===element[0];});if(index>=0){elements.splice(index,1);}}},_updateAllModifiers:function(record){var self=this;var defs=[];this.defs=defs;_.each(this.allModifiersData,function(modifiersData){if(record.id in modifiersData.evaluatedModifiers){modifiersData.evaluatedModifiers[record.id]=record.evalModifiers(modifiersData.modifiers);self._applyModifiers(modifiersData,record);}});delete this.defs;return Promise.all(defs);},_onNavigationMove:function(ev){},});return BasicRenderer;});;

/* /web/static/src/js/control_panel/comparison_menu.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("web.ComparisonMenu",function(require){"use strict";const DropdownMenu=require("web.DropdownMenu");const{FACET_ICONS}=require("web.searchUtils");const{useModel}=require("web/static/src/js/model.js");class ComparisonMenu extends DropdownMenu{constructor(){super(...arguments);this.model=useModel('searchModel');}
get icon(){return FACET_ICONS.comparison;}
get items(){return this.model.get('filters',f=>f.type==='comparison');}
get title(){return this.env._t("Comparison");}
_onItemSelected(ev){ev.stopPropagation();const{item}=ev.detail;this.model.dispatch("toggleComparison",item.id);}}
return ComparisonMenu;});;

/* /web/static/src/js/control_panel/control_panel.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.ControlPanel',function(require){"use strict";const ActionMenus=require('web.ActionMenus');const ComparisonMenu=require('web.ComparisonMenu');const ActionModel=require('web/static/src/js/views/action_model.js');const FavoriteMenu=require('web.FavoriteMenu');const FilterMenu=require('web.FilterMenu');const GroupByMenu=require('web.GroupByMenu');const patchMixin=require('web.patchMixin');const Pager=require('web.Pager');const SearchBar=require('web.SearchBar');const{useModel}=require('web/static/src/js/model.js');const{Component,hooks}=owl;const{useRef,useSubEnv}=hooks;function getAdditionalContent(props){const additionalContent={};if('cp_content'in props){const content=props.cp_content||{};if('$buttons'in content){additionalContent.buttons=content.$buttons;}
if('$searchview'in content){additionalContent.searchView=content.$searchview;}
if('$pager'in content){additionalContent.pager=content.$pager;}
if('$searchview_buttons'in content){additionalContent.searchViewButtons=content.$searchview_buttons;}}
return additionalContent;}
class ControlPanel extends Component{constructor(){super(...arguments);this.additionalContent=getAdditionalContent(this.props);useSubEnv({action:this.props.action,searchModel:this.props.searchModel,view:this.props.view,});if(this.env.searchModel){this.model=useModel('searchModel');}
this.contentRefs={buttons:useRef('buttons'),pager:useRef('pager'),searchView:useRef('searchView'),searchViewButtons:useRef('searchViewButtons'),};this.fields=this._formatFields(this.props.fields);}
mounted(){this._attachAdditionalContent();}
patched(){this._attachAdditionalContent();}
async willUpdateProps(nextProps){if('view'in nextProps){this.env.view=nextProps.view;}
if('fields'in nextProps){this.fields=this._formatFields(nextProps.fields);}
this.additionalContent=getAdditionalContent(nextProps);}
_attachAdditionalContent(){for(const key in this.additionalContent){if(this.additionalContent[key]&&this.additionalContent[key].length){const target=this.contentRefs[key].el;if(target){target.innerHTML="";target.append(...this.additionalContent[key]);}}}}
_formatFields(fields){const formattedFields={};for(const fieldName in fields){formattedFields[fieldName]=Object.assign({description:fields[fieldName].string,name:fieldName,},fields[fieldName]);}
return formattedFields;}}
ControlPanel.modelExtension="ControlPanel";ControlPanel.components={SearchBar,ActionMenus,Pager,ComparisonMenu,FilterMenu,GroupByMenu,FavoriteMenu,};ControlPanel.defaultProps={breadcrumbs:[],fields:{},searchMenuTypes:[],views:[],withBreadcrumbs:true,withSearchBar:true,};ControlPanel.props={action:Object,breadcrumbs:Array,searchModel:ActionModel,cp_content:{type:Object,optional:1},fields:Object,pager:{validate:p=>typeof p==='object'||p===null,optional:1},searchMenuTypes:Array,actionMenus:{validate:s=>typeof s==='object'||s===null,optional:1},title:{type:String,optional:1},view:{type:Object,optional:1},views:Array,withBreadcrumbs:Boolean,withSearchBar:Boolean,};ControlPanel.template='web.ControlPanel';return patchMixin(ControlPanel);});;

/* /web/static/src/js/control_panel/control_panel_model_extension.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("web/static/src/js/control_panel/control_panel_model_extension.js",function(require){"use strict";const ActionModel=require("web/static/src/js/views/action_model.js");const Domain=require('web.Domain');const pyUtils=require('web.py_utils');const{DEFAULT_INTERVAL,DEFAULT_PERIOD,getComparisonOptions,getIntervalOptions,getPeriodOptions,constructDateDomain,rankInterval,yearSelected}=require('web.searchUtils');const FAVORITE_PRIVATE_GROUP=1;const FAVORITE_SHARED_GROUP=2;const DISABLE_FAVORITE="search_disable_custom_filters";let filterId=1;let groupId=1;let groupNumber=0;class ControlPanelModelExtension extends ActionModel.Extension{constructor(){super(...arguments);this.actionContext=Object.assign({},this.config.context);this.searchMenuTypes=this.config.searchMenuTypes||[];this.favoriteFilters=this.config.favoriteFilters||[];this.fields=this.config.fields||{};this.searchDefaults={};for(const key in this.actionContext){const match=/^search_default_(.*)$/.exec(key);if(match){const val=this.actionContext[key];if(val){this.searchDefaults[match[1]]=val;}
delete this.actionContext[key];}}
this.labelPromises=[];this.referenceMoment=moment();this.optionGenerators=getPeriodOptions(this.referenceMoment);this.intervalOptions=getIntervalOptions();this.comparisonOptions=getComparisonOptions();}
get(property,...args){switch(property){case"context":return this.getContext();case"domain":return this.getDomain();case"facets":return this._getFacets();case"filters":return this._getFilters(...args);case"groupBy":return this.getGroupBy();case"orderedBy":return this.getOrderedBy();case"timeRanges":return this.getTimeRanges();}}
async load(){await Promise.all(this.labelPromises);}
prepareState(){Object.assign(this.state,{filters:{},query:[],});if(this.config.withSearchBar!==false){this._addFilters();this._activateDefaultFilters();}}
get activeComparison(){return this.state.query.find(queryElem=>queryElem.type==='comparison');}
addAutoCompletionValues({filterId,label,value,operator}){const queryElem=this.state.query.find(queryElem=>queryElem.filterId===filterId&&queryElem.value===value&&queryElem.operator===operator);if(!queryElem){const{groupId}=this.state.filters[filterId];this.state.query.push({filterId,groupId,label,value,operator});}else{queryElem.label=label;}}
clearQuery(){this.state.query=[];}
async createNewFavorite(preFilter){const preFavorite=await this._saveQuery(preFilter);this.clearQuery();const filter=Object.assign(preFavorite,{groupId,id:filterId,});this.state.filters[filterId]=filter;this.state.query.push({groupId,filterId});groupId++;filterId++;}
createNewFilters(prefilters){if(!prefilters.length){return[];}
const newFilterIdS=[];prefilters.forEach(preFilter=>{const filter=Object.assign(preFilter,{groupId,groupNumber,id:filterId,type:'filter',});this.state.filters[filterId]=filter;this.state.query.push({groupId,filterId});newFilterIdS.push(filterId);filterId++;});groupId++;groupNumber++;return newFilterIdS;}
createNewGroupBy(field){const groupBy=Object.values(this.state.filters).find(f=>f.type==='groupBy');const filter={description:field.string||field.name,fieldName:field.name,fieldType:field.type,groupId:groupBy?groupBy.groupId:groupId++,groupNumber,id:filterId,type:'groupBy',};this.state.filters[filterId]=filter;if(['date','datetime'].includes(field.type)){filter.hasOptions=true;filter.defaultOptionId=DEFAULT_INTERVAL;this.toggleFilterWithOptions(filterId);}else{this.toggleFilter(filterId);}
groupNumber++;filterId++;}
deactivateGroup(groupId){this.state.query=this.state.query.filter(queryElem=>queryElem.groupId!==groupId);this._checkComparisonStatus();}
async deleteFavorite(filterId){const{serverSideId}=this.state.filters[filterId];await this.env.dataManager.delete_filter(serverSideId);const index=this.state.query.findIndex(queryElem=>queryElem.filterId===filterId);delete this.state.filters[filterId];if(index>=0){this.state.query.splice(index,1);}}
getContext(){const groups=this._getGroups();return this._getContext(groups);}
getDomain(){const groups=this._getGroups();const userContext=this.env.session.user_context;try{return Domain.prototype.stringToArray(this._getDomain(groups),userContext);}catch(err){throw new Error(`${this.env._t("Control panel model extension failed to evaluate domain")}:/n${JSON.stringify(err)}`);}}
getGroupBy(){const groups=this._getGroups();return this._getGroupBy(groups);}
getOrderedBy(){const groups=this._getGroups();return this._getOrderedBy(groups);}
getTimeRanges(){const requireEvaluation=true;return this._getTimeRanges(requireEvaluation);}
search(){}
toggleComparison(filterId){const{groupId,dateFilterId}=this.state.filters[filterId];const queryElem=this.state.query.find(queryElem=>queryElem.type==='comparison'&&queryElem.filterId===filterId);this.state.query=this.state.query.filter(queryElem=>queryElem.type!=='comparison');if(!queryElem){this.state.query.push({groupId,filterId,dateFilterId,type:'comparison',});}}
toggleFilter(filterId){const index=this.state.query.findIndex(queryElem=>queryElem.filterId===filterId);if(index>=0){this.state.query.splice(index,1);}else{const{groupId,type}=this.state.filters[filterId];if(type==='favorite'){this.state.query=[];}
this.state.query.push({groupId,filterId});}}
toggleFilterWithOptions(filterId,optionId){const filter=this.state.filters[filterId];optionId=optionId||filter.defaultOptionId;const option=this.optionGenerators.find(o=>o.id===optionId);const index=this.state.query.findIndex(queryElem=>queryElem.filterId===filterId&&queryElem.optionId===optionId);if(index>=0){this.state.query.splice(index,1);if(filter.type==='filter'&&!yearSelected(this._getSelectedOptionIds(filterId))){this.state.query=this.state.query.filter(queryElem=>queryElem.filterId!==filterId);}}else{this.state.query.push({groupId:filter.groupId,filterId,optionId});if(filter.type==='filter'&&!yearSelected(this._getSelectedOptionIds(filterId))){this.state.query.push({groupId:filter.groupId,filterId,optionId:option.defaultYearId,});}}
if(filter.type==='filter'){this._checkComparisonStatus();}}
_activateDefaultFilters(){if(this.defaultFavoriteId){this.toggleFilter(this.defaultFavoriteId);}else{Object.values(this.state.filters).filter((f)=>f.isDefault&&f.type!=='favorite').sort((f1,f2)=>(f1.defaultRank||100)-(f2.defaultRank||100)).forEach(f=>{if(f.hasOptions){this.toggleFilterWithOptions(f.id);}else if(f.type==='field'){let{operator,label,value}=f.defaultAutocompleteValue;this.addAutoCompletionValues({filterId:f.id,value,operator,label,});}else{this.toggleFilter(f.id);}});}}
_addFilters(){this._createGroupOfFavorites();this._createGroupOfFiltersFromArch();this._createGroupOfDynamicFilters();}
_checkComparisonStatus(){const activeComparison=this.activeComparison;if(!activeComparison){return;}
const{dateFilterId}=activeComparison;const dateFilterIsActive=this.state.query.some(queryElem=>queryElem.filterId===dateFilterId);if(!dateFilterIsActive){this.state.query=this.state.query.filter(queryElem=>queryElem.type!=='comparison');}}
_computeTimeRanges(comparisonFilter){const{filterId}=this.activeComparison;if(filterId!==comparisonFilter.id){return null;}
const{dateFilterId,comparisonOptionId}=comparisonFilter;const{fieldName,fieldType,description:dateFilterDescription,}=this.state.filters[dateFilterId];const selectedOptionIds=this._getSelectedOptionIds(dateFilterId);const{domain:range,description:rangeDescription}=constructDateDomain(this.referenceMoment,fieldName,fieldType,selectedOptionIds,);const{domain:comparisonRange,description:comparisonRangeDescription,}=constructDateDomain(this.referenceMoment,fieldName,fieldType,selectedOptionIds,comparisonOptionId);return{comparisonId:comparisonOptionId,fieldName,fieldDescription:dateFilterDescription,range,rangeDescription,comparisonRange,comparisonRangeDescription,};}
_createGroupOfComparisons(dateFilters){const preFilters=[];for(const dateFilter of dateFilters){for(const comparisonOption of this.comparisonOptions){const{id:dateFilterId,description}=dateFilter;const preFilter={type:'comparison',comparisonOptionId:comparisonOption.id,description:`${description}: ${comparisonOption.description}`,dateFilterId,};preFilters.push(preFilter);}}
this._createGroupOfFilters(preFilters);}
_createGroupOfDynamicFilters(){const dynamicFilters=this.config.dynamicFilters||[];const pregroup=dynamicFilters.map(filter=>{return{description:filter.description,domain:JSON.stringify(filter.domain),isDefault:true,type:'filter',};});this._createGroupOfFilters(pregroup);}
_createGroupOfFavorites(){const activateFavorite=DISABLE_FAVORITE in this.actionContext?!this.actionContext[DISABLE_FAVORITE]:true;this.favoriteFilters.forEach(irFilter=>{const favorite=this._irFilterToFavorite(irFilter);this._createGroupOfFilters([favorite]);if(activateFavorite&&favorite.isDefault){this.defaultFavoriteId=favorite.id;}});}
_createGroupOfFilters(pregroup){pregroup.forEach(preFilter=>{const filter=Object.assign(preFilter,{groupId,id:filterId});this.state.filters[filterId]=filter;if(!this.defaultFavoriteId&&filter.isDefault&&filter.type==='field'){this._prepareDefaultLabel(filter);}
filterId++;});groupId++;}
_createGroupOfFiltersFromArch(){const preFilters=this.config.archNodes.reduce((preFilters,child)=>{if(child.tag==='group'){return[...preFilters,...child.children.map(c=>this._evalArchChild(c))];}else{return[...preFilters,this._evalArchChild(child)];}},[]);preFilters.push({tag:'separator'});let currentTag;let currentGroup=[];let pregroupOfGroupBys=[];preFilters.forEach(preFilter=>{if(preFilter.tag!==currentTag||['separator','field'].includes(preFilter.tag)){if(currentGroup.length){if(currentTag==='groupBy'){pregroupOfGroupBys=[...pregroupOfGroupBys,...currentGroup];}else{this._createGroupOfFilters(currentGroup);}}
currentTag=preFilter.tag;currentGroup=[];groupNumber++;}
if(preFilter.tag!=='separator'){const filter={type:preFilter.tag,};if(preFilter.attrs&&JSON.parse(preFilter.attrs.modifiers||'{}').invisible){filter.invisible=true;let preFilterFieldName=null;if(preFilter.tag==='filter'&&preFilter.attrs.date){preFilterFieldName=preFilter.attrs.date;}else if(preFilter.tag==='groupBy'){preFilterFieldName=preFilter.attrs.fieldName;}
if(preFilterFieldName&&!this.fields[preFilterFieldName]){return;}}
if(filter.type==='filter'||filter.type==='groupBy'){filter.groupNumber=groupNumber;}
this._extractAttributes(filter,preFilter.attrs);currentGroup.push(filter);}});if(pregroupOfGroupBys.length){this._createGroupOfFilters(pregroupOfGroupBys);}
const dateFilters=Object.values(this.state.filters).filter((filter)=>filter.isDateFilter);if(dateFilters.length){this._createGroupOfComparisons(dateFilters);}}
_enrichFilterCopy(filter,filterQueryElements){const isActive=Boolean(filterQueryElements.length);const f=Object.assign({isActive},filter);function _enrichOptions(options){return options.map(o=>{const{description,id,groupNumber}=o;const isActive=filterQueryElements.some(a=>a.optionId===id);return{description,id,groupNumber,isActive};});}
switch(f.type){case'comparison':{const{dateFilterId}=filter;const dateFilterIsActive=this.state.query.some(queryElem=>queryElem.filterId===dateFilterId);if(!dateFilterIsActive){return null;}
break;}
case'filter':if(f.hasOptions){f.options=_enrichOptions(this.optionGenerators);}
break;case'groupBy':if(f.hasOptions){f.options=_enrichOptions(this.intervalOptions);}
break;case'field':f.autoCompleteValues=filterQueryElements.map(({label,value,operator})=>({label,value,operator}));break;}
return f;}
_evalArchChild(child){if(child.attrs.context){try{const context=pyUtils.eval('context',child.attrs.context);child.attrs.context=context;if(context.group_by){child.attrs.fieldName=context.group_by.split(':')[0];child.attrs.defaultInterval=context.group_by.split(':')[1];child.tag='groupBy';}}catch(e){}}
if(child.attrs.name in this.searchDefaults){child.attrs.isDefault=true;let value=this.searchDefaults[child.attrs.name];if(child.tag==='field'){child.attrs.defaultValue=Array.isArray(value)?value[0]:value;}else if(child.tag==='groupBy'){child.attrs.defaultRank=typeof value==='number'?value:100;}}
return child;}
_extractAttributes(filter,attrs){if(attrs.isDefault){filter.isDefault=attrs.isDefault;}
filter.description=attrs.string||attrs.help||attrs.name||attrs.domain||'';switch(filter.type){case'filter':if(attrs.context){filter.context=attrs.context;}
if(attrs.date){filter.isDateFilter=true;filter.hasOptions=true;filter.fieldName=attrs.date;filter.fieldType=this.fields[attrs.date].type;filter.defaultOptionId=attrs.default_period||DEFAULT_PERIOD;}else{filter.domain=attrs.domain||'[]';}
if(filter.isDefault){filter.defaultRank=-5;}
break;case'groupBy':filter.fieldName=attrs.fieldName;filter.fieldType=this.fields[attrs.fieldName].type;if(['date','datetime'].includes(filter.fieldType)){filter.hasOptions=true;filter.defaultOptionId=attrs.defaultInterval||DEFAULT_INTERVAL;}
if(filter.isDefault){filter.defaultRank=attrs.defaultRank;}
break;case'field':{const field=this.fields[attrs.name];filter.fieldName=attrs.name;filter.fieldType=field.type;if(attrs.domain){filter.domain=attrs.domain;}
if(attrs.filter_domain){filter.filterDomain=attrs.filter_domain;}else if(attrs.operator){filter.operator=attrs.operator;}
if(attrs.context){filter.context=attrs.context;}
if(filter.isDefault){let operator=filter.operator;if(!operator){const type=attrs.widget||filter.fieldType;if(["char","html","many2many","one2many","text"].includes(type)){operator="ilike";}else{operator="=";}}
filter.defaultRank=-10;filter.defaultAutocompleteValue={operator,value:attrs.defaultValue,};}
break;}}
if(filter.fieldName&&!attrs.string){const{string}=this.fields[filter.fieldName];filter.description=string;}}
_favoriteToIrFilter(favorite){const irFilter={action_id:this.config.actionId,model_id:this.config.modelName,};if('description'in favorite){irFilter.name=favorite.description;}
if('domain'in favorite){irFilter.domain=favorite.domain;}
if('isDefault'in favorite){irFilter.is_default=favorite.isDefault;}
if('orderedBy'in favorite){const sort=favorite.orderedBy.map(ob=>ob.name+(ob.asc===false?" desc":""));irFilter.sort=JSON.stringify(sort);}
if('serverSideId'in favorite){irFilter.id=favorite.serverSideId;}
if('userId'in favorite){irFilter.user_id=favorite.userId;}
const context=Object.assign({},favorite.context);if('groupBys'in favorite){context.group_by=favorite.groupBys;}
if('comparison'in favorite){context.comparison=favorite.comparison;}
if(Object.keys(context).length){irFilter.context=context;}
return irFilter;}
_getAutoCompletionFilterDomain(filter,filterQueryElements){const domains=filterQueryElements.map(({label,value,operator})=>{let domain;if(filter.filterDomain){domain=Domain.prototype.stringToArray(filter.filterDomain,{self:label,raw_value:value,});}else{domain=[[filter.fieldName,operator,value]];}
return Domain.prototype.arrayToString(domain);});return pyUtils.assembleDomains(domains,'OR');}
_getContext(groups){const types=['filter','favorite','field'];const contexts=groups.reduce((contexts,group)=>{if(types.includes(group.type)){contexts.push(...this._getGroupContexts(group));}
return contexts;},[]);const evaluationContext=this.env.session.user_context;try{return pyUtils.eval('contexts',contexts,evaluationContext);}catch(err){throw new Error(this.env._t("Failed to evaluate search context")+":\n"+
JSON.stringify(err));}}
_getDateFilterDomain(filter,filterQueryElements,key='domain'){const{fieldName,fieldType}=filter;const selectedOptionIds=filterQueryElements.map(queryElem=>queryElem.optionId);const dateFilterRange=constructDateDomain(this.referenceMoment,fieldName,fieldType,selectedOptionIds,);return dateFilterRange[key];}
_getDomain(groups){const types=['filter','favorite','field'];const domains=[];for(const group of groups){if(types.includes(group.type)){domains.push(this._getGroupDomain(group));}}
return pyUtils.assembleDomains(domains,'AND');}
_getFacetDescriptions(activities,type){const facetDescriptions=[];if(type==='field'){for(const queryElem of activities[0].filterQueryElements){facetDescriptions.push(queryElem.label);}}else if(type==='groupBy'){for(const{filter,filterQueryElements}of activities){if(filter.hasOptions){for(const queryElem of filterQueryElements){const option=this.intervalOptions.find(o=>o.id===queryElem.optionId);facetDescriptions.push(filter.description+': '+option.description);}}else{facetDescriptions.push(filter.description);}}}else{let facetDescription;for(const{filter,filterQueryElements}of activities){facetDescription=filter.description;if(filter.isDateFilter){const description=this._getDateFilterDomain(filter,filterQueryElements,'description');facetDescription+=`: ${description}`;}
facetDescriptions.push(facetDescription);}}
return facetDescriptions;}
_getFacets(){const facets=this._getGroups().map(({activities,type,id})=>{const values=this._getFacetDescriptions(activities,type);const title=activities[0].filter.description;return{groupId:id,title,type,values};});return facets;}
_getFilters(predicate){const filters=[];Object.values(this.state.filters).forEach(filter=>{if((!predicate||predicate(filter))&&!filter.invisible){const filterQueryElements=this.state.query.filter(queryElem=>queryElem.filterId===filter.id);const enrichedFilter=this._enrichFilterCopy(filter,filterQueryElements);if(enrichedFilter){filters.push(enrichedFilter);}}});if(filters.some(f=>f.type==='favorite')){filters.sort((f1,f2)=>f1.groupNumber-f2.groupNumber);}
return filters;}
_getFilterContext(filter,filterQueryElements){let context=filter.context||{};if(filter.type==='field'&&filter.context){context=pyUtils.eval('context',filter.context,{self:filterQueryElements.map(({value})=>value)},);}
if(filter.type==='field'&&filter.isDefault&&filter.fieldType==='many2one'){context[`default_${filter.fieldName}`]=filter.defaultAutocompleteValue.value;}
return context;}
_getFilterDomain(filter,filterQueryElements){if(filter.type==='filter'&&filter.hasOptions){const{dateFilterId}=this.activeComparison||{};if(this.searchMenuTypes.includes('comparison')&&dateFilterId===filter.id){return"[]";}
return this._getDateFilterDomain(filter,filterQueryElements);}else if(filter.type==='field'){return this._getAutoCompletionFilterDomain(filter,filterQueryElements);}
return filter.domain;}
_getFilterGroupBys(filter,filterQueryElements){if(filter.type==='groupBy'){const fieldName=filter.fieldName;if(filter.hasOptions){return filterQueryElements.map(({optionId})=>`${fieldName}:${optionId}`);}else{return[fieldName];}}else{return filter.groupBys;}}
_getGroupBy(groups){const groupBys=groups.reduce((groupBys,group)=>{if(['groupBy','favorite'].includes(group.type)){groupBys.push(...this._getGroupGroupBys(group));}
return groupBys;},[]);const groupBy=groupBys.length?groupBys:(this.actionContext.group_by||[]);return typeof groupBy==='string'?[groupBy]:groupBy;}
_getGroupContexts(group){const contexts=group.activities.reduce((ctx,qe)=>[...ctx,this._getFilterContext(qe.filter,qe.filterQueryElements)],[]);return contexts;}
_getGroupDomain(group){const domains=group.activities.map(({filter,filterQueryElements})=>{return this._getFilterDomain(filter,filterQueryElements);});return pyUtils.assembleDomains(domains,'OR');}
_getGroupGroupBys(group){const groupBys=group.activities.reduce((gb,qe)=>[...gb,...this._getFilterGroupBys(qe.filter,qe.filterQueryElements)],[]);return groupBys;}
_getGroups(){const groups=this.state.query.reduce((groups,queryElem)=>{const{groupId,filterId}=queryElem;let group=groups.find(group=>group.id===groupId);const filter=this.state.filters[filterId];if(!group){const{type}=filter;group={id:groupId,type,activities:[]};groups.push(group);}
group.activities.push(queryElem);return groups;},[]);groups.forEach(g=>this._mergeActivities(g));return groups;}
_getOrderedBy(groups){return groups.reduce((orderedBy,group)=>{if(group.type==='favorite'){const favoriteOrderedBy=group.activities[0].filter.orderedBy;if(favoriteOrderedBy){orderedBy=[...favoriteOrderedBy,...orderedBy];}}
return orderedBy;},[]);}
_getSelectedOptionIds(dateFilterId){const selectedOptionIds=[];for(const queryElem of this.state.query){if(queryElem.filterId===dateFilterId){selectedOptionIds.push(queryElem.optionId);}}
return selectedOptionIds;}
_getTimeRanges(evaluation){let timeRanges;for(const queryElem of this.state.query.slice().reverse()){const filter=this.state.filters[queryElem.filterId];if(filter.type==='comparison'){timeRanges=this._computeTimeRanges(filter);break;}else if(filter.type==='favorite'&&filter.comparison){timeRanges=filter.comparison;break;}}
if(timeRanges){if(evaluation){timeRanges.range=Domain.prototype.stringToArray(timeRanges.range);timeRanges.comparisonRange=Domain.prototype.stringToArray(timeRanges.comparisonRange);}
return timeRanges;}
return null;}
_irFilterToFavorite(irFilter){let userId=irFilter.user_id||false;if(Array.isArray(userId)){userId=userId[0];}
const groupNumber=userId?FAVORITE_PRIVATE_GROUP:FAVORITE_SHARED_GROUP;const context=pyUtils.eval('context',irFilter.context,this.env.session.user_context);let groupBys=[];if(context.group_by){groupBys=context.group_by;delete context.group_by;}
let comparison;if(context.comparison){comparison=context.comparison;delete context.comparison;}
let sort;try{sort=JSON.parse(irFilter.sort);}catch(err){if(err instanceof SyntaxError){sort=[];}else{throw err;}}
const orderedBy=sort.map(order=>{let fieldName;let asc;const sqlNotation=order.split(' ');if(sqlNotation.length>1){fieldName=sqlNotation[0];asc=sqlNotation[1]==='asc';}else{fieldName=order[0]==='-'?order.slice(1):order;asc=order[0]==='-'?false:true;}
return{asc:asc,name:fieldName,};});const favorite={context,description:irFilter.name,domain:irFilter.domain,groupBys,groupNumber,orderedBy,removable:true,serverSideId:irFilter.id,type:'favorite',userId,};if(irFilter.is_default){favorite.isDefault=irFilter.is_default;}
if(comparison){favorite.comparison=comparison;}
return favorite;}
_mergeActivities(group){const{activities,type}=group;let res=[];switch(type){case'filter':case'groupBy':{for(const activity of activities){const{filterId}=activity;let a=res.find(({filter})=>filter.id===filterId);if(!a){a={filter:this.state.filters[filterId],filterQueryElements:[]};res.push(a);}
a.filterQueryElements.push(activity);}
break;}
case'favorite':case'field':case'comparison':{const{filterId}=group.activities[0];const filter=this.state.filters[filterId];res.push({filter,filterQueryElements:group.activities});break;}}
if(type==='groupBy'){res.forEach(activity=>{activity.filterQueryElements.sort((qe1,qe2)=>rankInterval(qe1.optionId)-rankInterval(qe2.optionId));});}
group.activities=res;}
_prepareDefaultLabel(filter){const{id,fieldType,fieldName,defaultAutocompleteValue}=filter;const{selection,context,relation}=this.fields[fieldName];if(fieldType==='selection'){defaultAutocompleteValue.label=selection.find(sel=>sel[0]===defaultAutocompleteValue.value)[1];}else if(fieldType==='many2one'){const updateLabel=label=>{const queryElem=this.state.query.find(({filterId})=>filterId===id);if(queryElem){queryElem.label=label;defaultAutocompleteValue.label=label;}};const promise=this.env.services.rpc({args:[defaultAutocompleteValue.value],context:context,method:'name_get',model:relation,}).then(results=>updateLabel(results[0][1])).guardedCatch(()=>updateLabel(defaultAutocompleteValue.value));this.labelPromises.push(promise);}else{defaultAutocompleteValue.label=defaultAutocompleteValue.value;}}
async _saveQuery(preFilter){const groups=this._getGroups();const userContext=this.env.session.user_context;let controllerQueryParams;this.config.trigger("get-controller-query-params",params=>{controllerQueryParams=params;});controllerQueryParams=controllerQueryParams||{};controllerQueryParams.context=controllerQueryParams.context||{};const queryContext=this._getContext(groups);const context=pyUtils.eval('contexts',[userContext,controllerQueryParams.context,queryContext]);for(const key in userContext){delete context[key];}
const requireEvaluation=false;const domain=this._getDomain(groups);const groupBys=this._getGroupBy(groups);const timeRanges=this._getTimeRanges(requireEvaluation);const orderedBy=controllerQueryParams.orderedBy?controllerQueryParams.orderedBy:(this._getOrderedBy(groups)||[]);const userId=preFilter.isShared?false:this.env.session.uid;delete preFilter.isShared;Object.assign(preFilter,{context,domain,groupBys,groupNumber:userId?FAVORITE_PRIVATE_GROUP:FAVORITE_SHARED_GROUP,orderedBy,removable:true,userId,});if(timeRanges){preFilter.comparison=timeRanges;}
const irFilter=this._favoriteToIrFilter(preFilter);const serverSideId=await this.env.dataManager.create_filter(irFilter);preFilter.serverSideId=serverSideId;return preFilter;}
static extractArchInfo(archs){const{attrs,children}=archs.search;const controlPanelInfo={attrs,children:[],};for(const child of children){if(child.tag!=="searchpanel"){controlPanelInfo.children.push(child);}}
return controlPanelInfo;}}
ActionModel.registry.add("ControlPanel",ControlPanelModelExtension,10);return ControlPanelModelExtension;});;

/* /web/static/src/js/control_panel/control_panel_x2many.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.ControlPanelX2Many',function(require){const ControlPanel=require('web.ControlPanel');class ControlPanelX2Many extends ControlPanel{_shouldShowPager(){if(!this.props.pager||!this.props.pager.limit){return false;}
const{currentMinimum,limit,size}=this.props.pager;const maximum=Math.min(currentMinimum+limit-1,size);const singlePage=(1===currentMinimum)&&(maximum===size);return!singlePage;}}
ControlPanelX2Many.defaultProps={};ControlPanelX2Many.props={cp_content:{type:Object,optional:1},pager:Object,};ControlPanelX2Many.template='web.ControlPanelX2Many';return ControlPanelX2Many;});;

/* /web/static/src/js/control_panel/custom_favorite_item.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.CustomFavoriteItem',function(require){"use strict";const DropdownMenuItem=require('web.DropdownMenuItem');const FavoriteMenu=require('web.FavoriteMenu');const{useAutofocus}=require('web.custom_hooks');const{useModel}=require('web/static/src/js/model.js');const{useRef}=owl.hooks;let favoriteId=0;class CustomFavoriteItem extends DropdownMenuItem{constructor(){super(...arguments);const favId=favoriteId++;this.useByDefaultId=`o_favorite_use_by_default_${favId}`;this.shareAllUsersId=`o_favorite_share_all_users_${favId}`;this.descriptionRef=useRef('description');this.model=useModel('searchModel');this.interactive=true;Object.assign(this.state,{description:this.env.action.name||"",isDefault:false,isShared:false,});useAutofocus();}
_saveFavorite(){if(!this.state.description.length){this.env.services.notification.notify({message:this.env._t("A name for your favorite filter is required."),type:'danger',});return this.descriptionRef.el.focus();}
const favorites=this.model.get('filters',f=>f.type==='favorite');if(favorites.some(f=>f.description===this.state.description)){this.env.services.notification.notify({message:this.env._t("Filter with same name already exists."),type:'danger',});return this.descriptionRef.el.focus();}
this.model.dispatch('createNewFavorite',{type:'favorite',description:this.state.description,isDefault:this.state.isDefault,isShared:this.state.isShared,});Object.assign(this.state,{description:this.env.action.name||"",isDefault:false,isShared:false,open:false,});}
_onCheckboxChange(ev){const{checked,id}=ev.target;if(this.useByDefaultId===id){this.state.isDefault=checked;if(checked){this.state.isShared=false;}}else{this.state.isShared=checked;if(checked){this.state.isDefault=false;}}}
_onInputKeydown(ev){switch(ev.key){case'Enter':ev.preventDefault();this._saveFavorite();break;case'Escape':ev.preventDefault();ev.target.blur();break;}}
static shouldBeDisplayed(env){return true;}}
CustomFavoriteItem.props={};CustomFavoriteItem.template='web.CustomFavoriteItem';CustomFavoriteItem.groupNumber=3;FavoriteMenu.registry.add('favorite-generator-menu',CustomFavoriteItem,0);return CustomFavoriteItem;});;

/* /web/static/src/js/control_panel/favorite_menu.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.FavoriteMenu',function(require){"use strict";const Dialog=require('web.OwlDialog');const DropdownMenu=require('web.DropdownMenu');const{FACET_ICONS}=require("web.searchUtils");const Registry=require('web.Registry');const{useModel}=require('web/static/src/js/model.js');class FavoriteMenu extends DropdownMenu{constructor(){super(...arguments);this.model=useModel('searchModel');this.state.deletedFavorite=false;}
get icon(){return FACET_ICONS.favorite;}
get items(){const favorites=this.model.get('filters',f=>f.type==='favorite');const registryMenus=this.constructor.registry.values().reduce((menus,Component)=>{if(Component.shouldBeDisplayed(this.env)){menus.push({key:Component.name,groupNumber:Component.groupNumber,Component,});}
return menus;},[]);return[...favorites,...registryMenus];}
get title(){return this.env._t("Favorites");}
_onItemRemoved(ev){const favorite=this.items.find(fav=>fav.id===ev.detail.item.id);this.state.deletedFavorite=favorite;}
_onItemSelected(ev){ev.stopPropagation();this.model.dispatch('toggleFilter',ev.detail.item.id);}
async _onRemoveFavorite(){this.model.dispatch('deleteFavorite',this.state.deletedFavorite.id);this.state.deletedFavorite=false;}}
FavoriteMenu.registry=new Registry();FavoriteMenu.components=Object.assign({},DropdownMenu.components,{Dialog,});FavoriteMenu.template='web.FavoriteMenu';return FavoriteMenu;});;

/* /web/static/src/js/control_panel/custom_filter_item.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.CustomFilterItem',function(require){"use strict";const{DatePicker,DateTimePicker}=require('web.DatePickerOwl');const Domain=require('web.Domain');const DropdownMenuItem=require('web.DropdownMenuItem');const{FIELD_OPERATORS,FIELD_TYPES}=require('web.searchUtils');const field_utils=require('web.field_utils');const patchMixin=require('web.patchMixin');const{useModel}=require('web/static/src/js/model.js');class CustomFilterItem extends DropdownMenuItem{constructor(){super(...arguments);this.model=useModel('searchModel');this.canBeOpened=true;this.state.conditions=[];this.fields=Object.values(this.props.fields).filter(field=>this._validateField(field)).concat({string:'ID',type:'id',name:'id'}).sort(({string:a},{string:b})=>a>b?1:a<b?-1:0);this.DECIMAL_POINT=this.env._t.database.parameters.decimal_point;this.OPERATORS=FIELD_OPERATORS;this.FIELD_TYPES=FIELD_TYPES;this._addDefaultCondition();}
_addDefaultCondition(){const condition={field:0,operator:0,};this._setDefaultValue(condition);this.state.conditions.push(condition);}
_validateField(field){return!field.deprecated&&field.searchable&&FIELD_TYPES[field.type]&&field.name!=='id';}
_setDefaultValue(condition){const fieldType=this.fields[condition.field].type;const genericType=FIELD_TYPES[fieldType];const operator=FIELD_OPERATORS[genericType][condition.operator];switch(genericType){case'id':case'number':condition.value=0;break;case'date':condition.value=[moment()];if(operator.symbol==='between'){condition.value.push(moment());}
break;case'datetime':condition.value=[moment('00:00:00','hh:mm:ss')];if(operator.symbol==='between'){condition.value.push(moment('23:59:59','hh:mm:ss'));}
break;case'selection':const[firstValue]=this.fields[condition.field].selection[0];condition.value=firstValue;break;default:condition.value="";}}
_onApply(){const preFilters=this.state.conditions.map(condition=>{const field=this.fields[condition.field];const type=this.FIELD_TYPES[field.type];const operator=this.OPERATORS[type][condition.operator];const descriptionArray=[field.string,operator.description];const domainArray=[];let domainValue;if('value'in operator){domainValue=[operator.value];}else if(['date','datetime'].includes(type)){domainValue=condition.value.map(val=>field_utils.parse[type](val,{type},{timezone:true}));const dateValue=condition.value.map(val=>field_utils.format[type](val,{type},{timezone:false}));descriptionArray.push(`"${dateValue.join(" " + this.env._t("and") + " ")}"`);}else{domainValue=[condition.value];descriptionArray.push(`"${condition.value}"`);}
if(operator.symbol==='between'){domainArray.push([field.name,'>=',domainValue[0]],[field.name,'<=',domainValue[1]]);}else{domainArray.push([field.name,operator.symbol,domainValue[0]]);}
const preFilter={description:descriptionArray.join(" "),domain:Domain.prototype.arrayToString(domainArray),type:'filter',};return preFilter;});this.model.dispatch('createNewFilters',preFilters);this.state.open=false;this.state.conditions=[];this._addDefaultCondition();}
_onDateChanged(condition,valueIndex,ev){condition.value[valueIndex]=ev.detail.date;}
_onFieldSelect(condition,ev){Object.assign(condition,{field:ev.target.selectedIndex,operator:0,});this._setDefaultValue(condition);}
_onOperatorSelect(condition,ev){condition.operator=ev.target.selectedIndex;this._setDefaultValue(condition);}
_onRemoveCondition(conditionIndex){this.state.conditions.splice(conditionIndex,1);}
_onValueInput(condition,ev){const type=this.fields[condition.field].type;if(['float','integer','id'].includes(type)){const previousValue=condition.value;const parser=field_utils.parse[type==='float'?'float':'integer'];try{const parsed=parser(ev.target.value||0);ev.target.value=condition.value=(parsed||0);}catch(err){ev.target.value=previousValue||0;}}else{condition.value=ev.target.value||"";}}}
CustomFilterItem.components={DatePicker,DateTimePicker};CustomFilterItem.props={fields:Object,};CustomFilterItem.template='web.CustomFilterItem';return patchMixin(CustomFilterItem);});;

/* /web/static/src/js/control_panel/filter_menu.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.FilterMenu',function(require){"use strict";const CustomFilterItem=require('web.CustomFilterItem');const DropdownMenu=require('web.DropdownMenu');const{FACET_ICONS}=require("web.searchUtils");const{useModel}=require('web/static/src/js/model.js');class FilterMenu extends DropdownMenu{constructor(){super(...arguments);this.model=useModel('searchModel');}
get icon(){return FACET_ICONS.filter;}
get items(){return this.model.get('filters',f=>f.type==='filter');}
get title(){return this.env._t("Filters");}
_onItemSelected(ev){ev.stopPropagation();const{item,option}=ev.detail;if(option){this.model.dispatch('toggleFilterWithOptions',item.id,option.id);}else{this.model.dispatch('toggleFilter',item.id);}}}
FilterMenu.components=Object.assign({},DropdownMenu.components,{CustomFilterItem,});FilterMenu.props=Object.assign({},DropdownMenu.props,{fields:Object,});FilterMenu.template='web.FilterMenu';return FilterMenu;});;

/* /web/static/src/js/control_panel/groupby_menu.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.GroupByMenu',function(require){"use strict";const CustomGroupByItem=require('web.CustomGroupByItem');const DropdownMenu=require('web.DropdownMenu');const{FACET_ICONS,GROUPABLE_TYPES}=require('web.searchUtils');const{useModel}=require('web/static/src/js/model.js');class GroupByMenu extends DropdownMenu{constructor(){super(...arguments);this.fields=Object.values(this.props.fields).filter(field=>this._validateField(field)).sort(({string:a},{string:b})=>a>b?1:a<b?-1:0);this.model=useModel('searchModel');}
get icon(){return FACET_ICONS.groupBy;}
get items(){return this.model.get('filters',f=>f.type==='groupBy');}
get title(){return this.env._t("Group By");}
_validateField(field){return field.sortable&&field.name!=="id"&&GROUPABLE_TYPES.includes(field.type);}
_onItemSelected(ev){ev.stopPropagation();const{item,option}=ev.detail;if(option){this.model.dispatch('toggleFilterWithOptions',item.id,option.id);}else{this.model.dispatch('toggleFilter',item.id);}}}
GroupByMenu.components=Object.assign({},DropdownMenu.components,{CustomGroupByItem,});GroupByMenu.props=Object.assign({},DropdownMenu.props,{fields:Object,});GroupByMenu.template='web.GroupByMenu';return GroupByMenu;});;

/* /web/static/src/js/control_panel/custom_group_by_item.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.CustomGroupByItem',function(require){"use strict";const DropdownMenuItem=require('web.DropdownMenuItem');const{useModel}=require('web/static/src/js/model.js');class CustomGroupByItem extends DropdownMenuItem{constructor(){super(...arguments);this.canBeOpened=true;this.state.fieldName=this.props.fields[0].name;this.model=useModel('searchModel');}
_onApply(){const field=this.props.fields.find(f=>f.name===this.state.fieldName);this.model.dispatch('createNewGroupBy',field);this.state.open=false;}}
CustomGroupByItem.template='web.CustomGroupByItem';CustomGroupByItem.props={fields:Array,};return CustomGroupByItem;});;

/* /web/static/src/js/control_panel/search_bar.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.SearchBar',function(require){"use strict";const Domain=require('web.Domain');const field_utils=require('web.field_utils');const{useAutofocus}=require('web.custom_hooks');const{useModel}=require('web/static/src/js/model.js');const CHAR_FIELDS=['char','html','many2many','many2one','one2many','text'];const{Component,hooks}=owl;const{useExternalListener,useRef,useState}=hooks;let sourceId=0;class SearchBar extends Component{constructor(){super(...arguments);this.focusOnUpdate=useAutofocus();this.inputRef=useRef('search-input');this.model=useModel('searchModel');this.state=useState({sources:[],focusedItem:0,inputValue:"",});this.autoCompleteSources=this.model.get('filters',f=>f.type==='field').map(filter=>this._createSource(filter));this.noResultItem=[null,this.env._t("(no result)")];useExternalListener(window,'click',this._onWindowClick);useExternalListener(window,'keydown',this._onWindowKeydown);}
mounted(){this.env.searchModel.on('search',this,this.focusOnUpdate);this.env.searchModel.on('focus-control-panel',this,()=>{this.inputRef.el.focus();});}
willUnmount(){this.env.searchModel.off('search',this);this.env.searchModel.off('focus-control-panel',this);}
_closeAutoComplete(){this.state.sources=[];this.state.focusedItem=0;this.state.inputValue="";this.inputRef.el.value="";this.focusOnUpdate();}
_createSource(filter){const field=this.props.fields[filter.fieldName];const type=field.type==="reference"?"char":field.type;const source={active:true,description:filter.description,filterId:filter.id,filterOperator:filter.operator,id:sourceId++,operator:CHAR_FIELDS.includes(type)?'ilike':'=',parent:false,type,};switch(type){case'selection':{source.active=false;source.selection=field.selection||[];break;}
case'boolean':{source.active=false;source.selection=[[true,this.env._t("Yes")],[false,this.env._t("No")],];break;}
case'many2one':{source.expand=true;source.expanded=false;source.context=field.context;source.relation=field.relation;if(filter.domain){source.domain=filter.domain;}}}
return source;}
_createSubSource(source,[value,label],active=true){const subSource={active,filterId:source.filterId,filterOperator:source.filterOperator,id:sourceId++,label,operator:'=',parent:source,value,};return subSource;}
async _expandSource(source,shouldExpand){source.expanded=shouldExpand;if(shouldExpand){let args=source.domain;if(typeof args==='string'){try{args=Domain.prototype.stringToArray(args);}catch(err){args=[];}}
const results=await this.rpc({kwargs:{args,context:source.context,limit:8,name:this.state.inputValue.trim(),},method:'name_search',model:source.relation,});const options=results.map(result=>this._createSubSource(source,result));const parentIndex=this.state.sources.indexOf(source);if(!options.length){options.push(this._createSubSource(source,this.noResultItem,false));}
this.state.sources.splice(parentIndex+1,0,...options);}else{this.state.sources=this.state.sources.filter(src=>src.parent!==source);}}
_filterSources(query){return this.autoCompleteSources.reduce((sources,source)=>{if(source.selection){const options=[];source.selection.forEach(result=>{if(fuzzy.test(query,result[1].toLowerCase())){options.push(this._createSubSource(source,result));}});if(options.length){sources.push(source,...options);}}else if(this._validateSource(query,source)){sources.push(source);}
if(source.expanded){source.expanded=false;}
return sources;},[]);}
_focusFacet(index){const facets=this.el.getElementsByClassName('o_searchview_facet');if(facets.length){facets[index].focus();}}
_parseWithSource(rawValue,{type}){const parser=field_utils.parse[type];let parsedValue;switch(type){case'date':case'datetime':{const parsedDate=parser(rawValue,{type},{timezone:true});const dateFormat=type==='datetime'?'YYYY-MM-DD HH:mm:ss':'YYYY-MM-DD';const momentValue=moment(parsedDate,dateFormat);if(!momentValue.isValid()){throw new Error('Invalid date');}
parsedValue=parsedDate.toJSON();break;}
case'many2one':{parsedValue=rawValue;break;}
default:{parsedValue=parser(rawValue);}}
return parsedValue;}
_selectSource(source){if(source.active){const labelValue=source.label||this.state.inputValue;this.model.dispatch('addAutoCompletionValues',{filterId:source.filterId,value:source.value||this._parseWithSource(labelValue,source),label:labelValue,operator:source.filterOperator||source.operator,});}
this._closeAutoComplete();}
_validateSource(query,source){try{this._parseWithSource(query,source);}catch(err){return false;}
return true;}
_onFacetKeydown(facet,facetIndex,ev){switch(ev.key){case'ArrowLeft':if(facetIndex===0){this.inputRef.el.focus();}else{this._focusFacet(facetIndex-1);}
break;case'ArrowRight':const facets=this.el.getElementsByClassName('o_searchview_facet');if(facetIndex===facets.length-1){this.inputRef.el.focus();}else{this._focusFacet(facetIndex+1);}
break;case'Backspace':this._onFacetRemove(facet);break;}}
_onFacetRemove(facet){this.model.dispatch('deactivateGroup',facet.groupId);}
_onSearchKeydown(ev){if(ev.isComposing){return;}
const currentItem=this.state.sources[this.state.focusedItem]||{};switch(ev.key){case'ArrowDown':ev.preventDefault();if(Object.keys(this.state.sources).length){let nextIndex=this.state.focusedItem+1;if(nextIndex>=this.state.sources.length){nextIndex=0;}
this.state.focusedItem=nextIndex;}else{this.env.bus.trigger('focus-view');}
break;case'ArrowLeft':if(currentItem.expanded){ev.preventDefault();this._expandSource(currentItem,false);}else if(currentItem.parent){ev.preventDefault();this.state.focusedItem=this.state.sources.indexOf(currentItem.parent);}else if(ev.target.selectionStart===0){this._focusFacet(this.model.get("facets").length-1);}
break;case'ArrowRight':if(ev.target.selectionStart===this.state.inputValue.length){if(currentItem.expand){ev.preventDefault();if(currentItem.expanded){this.state.focusedItem++;}else{this._expandSource(currentItem,true);}}else if(ev.target.selectionStart===this.state.inputValue.length){this._focusFacet(0);}}
break;case'ArrowUp':ev.preventDefault();let previousIndex=this.state.focusedItem-1;if(previousIndex<0){previousIndex=this.state.sources.length-1;}
this.state.focusedItem=previousIndex;break;case'Backspace':if(!this.state.inputValue.length){const facets=this.model.get("facets");if(facets.length){this._onFacetRemove(facets[facets.length-1]);}}
break;case'Enter':if(!this.state.inputValue.length){this.model.dispatch('search');break;}
case'Tab':if(this.state.inputValue.length){this._selectSource(currentItem);}
break;case'Escape':if(this.state.sources.length){this._closeAutoComplete();}
break;}}
_onSearchInput(ev){this.state.inputValue=ev.target.value;const wasVisible=this.state.sources.length;const query=this.state.inputValue.trim().toLowerCase();if(query.length){this.state.sources=this._filterSources(query);}else if(wasVisible){this._closeAutoComplete();}}
_onSourceMousemove(resultIndex){this.state.focusedItem=resultIndex;}
_onWindowClick(ev){if(this.state.sources.length&&!this.el.contains(ev.target)){this._closeAutoComplete();}}
_onWindowKeydown(ev){if(ev.key==='Escape'&&this.state.sources.length){ev.preventDefault();ev.stopPropagation();this._closeAutoComplete();}}}
SearchBar.defaultProps={fields:{},};SearchBar.props={fields:Object,};SearchBar.template='web.SearchBar';return SearchBar;});;

/* /web/static/src/js/control_panel/search_utils.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.searchUtils',function(require){"use strict";const{_lt,_t}=require('web.core');const Domain=require('web.Domain');const pyUtils=require('web.py_utils');const FIELD_OPERATORS={boolean:[{symbol:"=",description:_lt("is true"),value:true},{symbol:"!=",description:_lt("is false"),value:true},],char:[{symbol:"ilike",description:_lt("contains")},{symbol:"not ilike",description:_lt("doesn't contain")},{symbol:"=",description:_lt("is equal to")},{symbol:"!=",description:_lt("is not equal to")},{symbol:"!=",description:_lt("is set"),value:false},{symbol:"=",description:_lt("is not set"),value:false},],date:[{symbol:"=",description:_lt("is equal to")},{symbol:"!=",description:_lt("is not equal to")},{symbol:">",description:_lt("is after")},{symbol:"<",description:_lt("is before")},{symbol:">=",description:_lt("is after or equal to")},{symbol:"<=",description:_lt("is before or equal to")},{symbol:"between",description:_lt("is between")},{symbol:"!=",description:_lt("is set"),value:false},{symbol:"=",description:_lt("is not set"),value:false},],datetime:[{symbol:"between",description:_lt("is between")},{symbol:"=",description:_lt("is equal to")},{symbol:"!=",description:_lt("is not equal to")},{symbol:">",description:_lt("is after")},{symbol:"<",description:_lt("is before")},{symbol:">=",description:_lt("is after or equal to")},{symbol:"<=",description:_lt("is before or equal to")},{symbol:"!=",description:_lt("is set"),value:false},{symbol:"=",description:_lt("is not set"),value:false},],id:[{symbol:"=",description:_lt("is")},],number:[{symbol:"=",description:_lt("is equal to")},{symbol:"!=",description:_lt("is not equal to")},{symbol:">",description:_lt("greater than")},{symbol:"<",description:_lt("less than")},{symbol:">=",description:_lt("greater than or equal to")},{symbol:"<=",description:_lt("less than or equal to")},{symbol:"!=",description:_lt("is set"),value:false},{symbol:"=",description:_lt("is not set"),value:false},],selection:[{symbol:"=",description:_lt("is")},{symbol:"!=",description:_lt("is not")},{symbol:"!=",description:_lt("is set"),value:false},{symbol:"=",description:_lt("is not set"),value:false},],};const FIELD_TYPES={boolean:'boolean',char:'char',date:'date',datetime:'datetime',float:'number',id:'id',integer:'number',html:'char',many2many:'char',many2one:'char',monetary:'number',one2many:'char',text:'char',selection:'selection',};const DEFAULT_PERIOD='this_month';const QUARTERS={1:{description:_lt("Q1"),coveredMonths:[0,1,2]},2:{description:_lt("Q2"),coveredMonths:[3,4,5]},3:{description:_lt("Q3"),coveredMonths:[6,7,8]},4:{description:_lt("Q4"),coveredMonths:[9,10,11]},};const MONTH_OPTIONS={this_month:{id:'this_month',groupNumber:1,format:'MMMM',addParam:{},granularity:'month',},last_month:{id:'last_month',groupNumber:1,format:'MMMM',addParam:{months:-1},granularity:'month',},antepenultimate_month:{id:'antepenultimate_month',groupNumber:1,format:'MMMM',addParam:{months:-2},granularity:'month',},};const QUARTER_OPTIONS={fourth_quarter:{id:'fourth_quarter',groupNumber:1,description:QUARTERS[4].description,setParam:{quarter:4},granularity:'quarter',},third_quarter:{id:'third_quarter',groupNumber:1,description:QUARTERS[3].description,setParam:{quarter:3},granularity:'quarter',},second_quarter:{id:'second_quarter',groupNumber:1,description:QUARTERS[2].description,setParam:{quarter:2},granularity:'quarter',},first_quarter:{id:'first_quarter',groupNumber:1,description:QUARTERS[1].description,setParam:{quarter:1},granularity:'quarter',},};const YEAR_OPTIONS={this_year:{id:'this_year',groupNumber:2,format:'YYYY',addParam:{},granularity:'year',},last_year:{id:'last_year',groupNumber:2,format:'YYYY',addParam:{years:-1},granularity:'year',},antepenultimate_year:{id:'antepenultimate_year',groupNumber:2,format:'YYYY',addParam:{years:-2},granularity:'year',},};const PERIOD_OPTIONS=Object.assign({},MONTH_OPTIONS,QUARTER_OPTIONS,YEAR_OPTIONS);const GROUPABLE_TYPES=['boolean','char','date','datetime','integer','many2one','selection',];const DEFAULT_INTERVAL='month';const INTERVAL_OPTIONS={year:{description:_lt("Year"),id:'year',groupNumber:1},quarter:{description:_lt("Quarter"),id:'quarter',groupNumber:1},month:{description:_lt("Month"),id:'month',groupNumber:1},week:{description:_lt("Week"),id:'week',groupNumber:1},day:{description:_lt("Day"),id:'day',groupNumber:1}};const COMPARISON_OPTIONS={previous_period:{description:_lt("Previous Period"),id:'previous_period',},previous_year:{description:_lt("Previous Year"),id:'previous_year',addParam:{years:-1},},};const PER_YEAR={year:1,quarter:4,month:12,};const FACET_ICONS={filter:'fa fa-filter',groupBy:'fa fa-bars',favorite:'fa fa-star',comparison:'fa fa-adjust',};function constructDateDomain(referenceMoment,fieldName,fieldType,selectedOptionIds,comparisonOptionId){let addParam;let selectedOptions;if(comparisonOptionId){[addParam,selectedOptions]=getComparisonParams(referenceMoment,selectedOptionIds,comparisonOptionId);}else{selectedOptions=getSelectedOptions(referenceMoment,selectedOptionIds);}
const yearOptions=selectedOptions.year;const otherOptions=[...(selectedOptions.quarter||[]),...(selectedOptions.month||[])];sortPeriodOptions(yearOptions);sortPeriodOptions(otherOptions);const ranges=[];for(const yearOption of yearOptions){const constructRangeParams={referenceMoment,fieldName,fieldType,addParam,};if(otherOptions.length){for(const option of otherOptions){const setParam=Object.assign({},yearOption.setParam,option?option.setParam:{});const{granularity}=option;const range=constructDateRange(Object.assign({granularity,setParam},constructRangeParams));ranges.push(range);}}else{const{granularity,setParam}=yearOption;const range=constructDateRange(Object.assign({granularity,setParam},constructRangeParams));ranges.push(range);}}
const domain=pyUtils.assembleDomains(ranges.map(range=>range.domain),'OR');const description=ranges.map(range=>range.description).join("/");return{domain,description};}
function constructDateRange({referenceMoment,fieldName,fieldType,granularity,setParam,addParam,}){const date=referenceMoment.clone().set(setParam).add(addParam||{});let leftBound=date.clone().locale('en').startOf(granularity);let rightBound=date.clone().locale('en').endOf(granularity);if(fieldType==='date'){leftBound=leftBound.format('YYYY-MM-DD');rightBound=rightBound.format('YYYY-MM-DD');}else{leftBound=leftBound.utc().format('YYYY-MM-DD HH:mm:ss');rightBound=rightBound.utc().format('YYYY-MM-DD HH:mm:ss');}
const domain=Domain.prototype.arrayToString(['&',[fieldName,'>=',leftBound],[fieldName,'<=',rightBound]]);const descriptions=[date.format("YYYY")];const method=_t.database.parameters.direction==="rtl"?"push":"unshift";if(granularity==="month"){descriptions[method](date.format("MMMM"));}else if(granularity==="quarter"){descriptions[method](QUARTERS[date.quarter()].description);}
const description=descriptions.join(" ");return{domain,description,};}
function getComparisonOptions(){return getOptionsWithDescriptions(COMPARISON_OPTIONS);}
function getComparisonParams(referenceMoment,selectedOptionIds,comparisonOptionId){const comparisonOption=COMPARISON_OPTIONS[comparisonOptionId];const selectedOptions=getSelectedOptions(referenceMoment,selectedOptionIds);let addParam=comparisonOption.addParam;if(addParam){return[addParam,selectedOptions];}
addParam={};let globalGranularity='year';if(selectedOptions.month){globalGranularity='month';}else if(selectedOptions.quarter){globalGranularity='quarter';}
const granularityFactor=PER_YEAR[globalGranularity];const years=selectedOptions.year.map(o=>o.setParam.year);const yearMin=Math.min(...years);const yearMax=Math.max(...years);let optionMin=0;let optionMax=0;if(selectedOptions.quarter){const quarters=selectedOptions.quarter.map(o=>o.setParam.quarter);if(globalGranularity==='month'){delete selectedOptions.quarter;for(const quarter of quarters){for(const month of QUARTERS[quarter].coveredMonths){const monthOption=selectedOptions.month.find(o=>o.setParam.month===month);if(!monthOption){selectedOptions.month.push({setParam:{month,},granularity:'month',});}}}}else{optionMin=Math.min(...quarters);optionMax=Math.max(...quarters);}}
if(selectedOptions.month){const months=selectedOptions.month.map(o=>o.setParam.month);optionMin=Math.min(...months);optionMax=Math.max(...months);}
addParam[globalGranularity]=-1+
granularityFactor*(yearMin-yearMax)+
optionMin-optionMax;return[addParam,selectedOptions];}
function getIntervalOptions(){return getOptionsWithDescriptions(INTERVAL_OPTIONS);}
function getPeriodOptions(referenceMoment){const options=[];for(const option of Object.values(PERIOD_OPTIONS)){const{id,groupNumber,description,}=option;const res={id,groupNumber,};const date=referenceMoment.clone().set(option.setParam).add(option.addParam);if(description){res.description=description.toString();}else{res.description=date.format(option.format.toString());}
res.setParam=getSetParam(option,referenceMoment);res.defaultYear=date.year();options.push(res);}
for(const option of options){const yearOption=options.find(o=>o.setParam&&o.setParam.year===option.defaultYear);option.defaultYearId=yearOption.id;delete option.defaultYear;delete option.setParam;}
return options;}
function getOptionsWithDescriptions(OPTIONS){const options=[];for(const option of Object.values(OPTIONS)){const{id,groupNumber,description,}=option;const res={id,};if(description){res.description=description.toString();}
if(groupNumber){res.groupNumber=groupNumber;}
options.push(res);}
return options;}
function getSelectedOptions(referenceMoment,selectedOptionIds){const selectedOptions={year:[]};for(const optionId of selectedOptionIds){const option=PERIOD_OPTIONS[optionId];const setParam=getSetParam(option,referenceMoment);const granularity=option.granularity;if(!selectedOptions[granularity]){selectedOptions[granularity]=[];}
selectedOptions[granularity].push({granularity,setParam});}
return selectedOptions;}
function getSetParam(periodOption,referenceMoment){if(periodOption.setParam){return periodOption.setParam;}
const date=referenceMoment.clone().add(periodOption.addParam);const setParam={};setParam[periodOption.granularity]=date[periodOption.granularity]();return setParam;}
function rankInterval(intervalOptionId){return Object.keys(INTERVAL_OPTIONS).indexOf(intervalOptionId);}
function sortPeriodOptions(options){options.sort((o1,o2)=>{const granularity1=o1.granularity;const granularity2=o2.granularity;if(granularity1===granularity2){return o1.setParam[granularity1]-o2.setParam[granularity1];}
return granularity1<granularity2?-1:1;});}
function yearSelected(selectedOptionIds){return selectedOptionIds.some(optionId=>!!YEAR_OPTIONS[optionId]);}
return{COMPARISON_OPTIONS,DEFAULT_INTERVAL,DEFAULT_PERIOD,FACET_ICONS,FIELD_OPERATORS,FIELD_TYPES,GROUPABLE_TYPES,INTERVAL_OPTIONS,PERIOD_OPTIONS,constructDateDomain,getComparisonOptions,getIntervalOptions,getPeriodOptions,rankInterval,yearSelected,};});;

/* /web/static/src/js/views/search_panel_model_extension.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("web/static/src/js/views/search_panel_model_extension.js",function(require){"use strict";const ActionModel=require("web/static/src/js/views/action_model.js");const{sortBy}=require("web.utils");const Domain=require("web.Domain");const pyUtils=require("web.py_utils");const DEFAULT_VIEW_TYPES=["kanban","tree"];const DEFAULT_LIMIT=200;let nextSectionId=1;function hasDomain(filter){return filter.domain!=="[]";}
function hasValues({errorMsg,groups,type,values}){if(errorMsg){return true;}else if(groups){return[...groups.values()].some((g)=>g.values.size);}else if(type==="category"){return values&&values.size>1;}else{return values&&values.size>0;}}
function serialiseMap(map){return[...map].map(([key,val])=>[key,Object.assign({},val)]);}
class SearchPanelModelExtension extends ActionModel.Extension{constructor(){super(...arguments);this.categoriesToLoad=[];this.defaultValues={};this.filtersToLoad=[];this.initialStateImport=false;this.searchDomain=[];for(const key in this.config.context){const match=/^searchpanel_default_(.*)$/.exec(key);if(match){this.defaultValues[match[1]]=this.config.context[key];}}}
async callLoad(params){const searchDomain=this._getExternalDomain();params.searchDomainChanged=(JSON.stringify(this.searchDomain)!==JSON.stringify(searchDomain));if(!this.shouldLoad&&!this.initialStateImport){const isFetchable=(section)=>section.enableCounters||(params.searchDomainChanged&&!section.expand);this.categoriesToLoad=this.categories.filter(isFetchable);this.filtersToLoad=this.filters.filter(isFetchable);this.shouldLoad=params.searchDomainChanged||Boolean(this.categoriesToLoad.length+this.filtersToLoad.length);}
this.searchDomain=searchDomain;this.initialStateImport=false;await super.callLoad(params);}
exportState(){const state=Object.assign({},super.exportState());state.sections=serialiseMap(state.sections);for(const[id,section]of state.sections){section.values=serialiseMap(section.values);if(section.groups){section.groups=serialiseMap(section.groups);for(const[id,group]of section.groups){group.values=serialiseMap(group.values);}}}
return state;}
get(property,...args){switch(property){case"domain":return this.getDomain();case"sections":return this.getSections(...args);}}
importState(importedState){this.initialStateImport=Boolean(importedState&&!this.state.sections);super.importState(...arguments);if(importedState){this.state.sections=new Map(this.state.sections);for(const section of this.state.sections.values()){section.values=new Map(section.values);if(section.groups){section.groups=new Map(section.groups);for(const group of section.groups.values()){group.values=new Map(group.values);}}}}}
async isReady(){await this.sectionsPromise;}
async load(params){this.sectionsPromise=this._fetchSections(params.isInitialLoad);if(this._shouldWaitForData(params)){await this.sectionsPromise;}}
prepareState(){Object.assign(this.state,{sections:new Map()});this._createSectionsFromArch();}
getDomain(){return Domain.prototype.normalizeArray([...this._getCategoryDomain(),...this._getFilterDomain(),]);}
getSections(predicate){let sections=[...this.state.sections.values()].map((section)=>Object.assign({},section,{empty:!hasValues(section)}));if(predicate){sections=sections.filter(predicate);}
return sections.sort((s1,s2)=>s1.index-s2.index);}
toggleCategoryValue(sectionId,valueId){const category=this.state.sections.get(sectionId);category.activeValueId=valueId;}
toggleFilterValues(sectionId,valueIds,forceTo=null){const section=this.state.sections.get(sectionId);for(const valueId of valueIds){const value=section.values.get(valueId);value.checked=forceTo===null?!value.checked:forceTo;}}
get categories(){return[...this.state.sections.values()].filter(s=>s.type==="category");}
get filters(){return[...this.state.sections.values()].filter(s=>s.type==="filter");}
_applyDefaultFilterValues(){for(const{fieldName,values}of this.filters){const defaultValues=this.defaultValues[fieldName]||[];for(const valueId of defaultValues){const value=values.get(valueId);if(value){value.checked=true;}}}}
_createCategoryTree(sectionId,result){const category=this.state.sections.get(sectionId);let{error_msg,parent_field:parentField,values,}=result;if(error_msg){category.errorMsg=error_msg;values=[];}
if(category.hierarchize){category.parentField=parentField;}
for(const value of values){category.values.set(value.id,Object.assign({},value,{childrenIds:[],parentId:value[parentField]||false,}));}
for(const value of values){const{parentId}=category.values.get(value.id);if(parentId&&category.values.has(parentId)){category.values.get(parentId).childrenIds.push(value.id);}}
category.rootIds=[false];for(const value of values){const{parentId}=category.values.get(value.id);if(!parentId){category.rootIds.push(value.id);}}
const valueIds=[false,...values.map((val)=>val.id)];this._ensureCategoryValue(category,valueIds);}
_createFilterTree(sectionId,result){const filter=this.state.sections.get(sectionId);let{error_msg,values,}=result;if(error_msg){filter.errorMsg=error_msg;values=[];}
values.forEach((value)=>{const oldValue=filter.values.get(value.id);value.checked=oldValue?oldValue.checked:false;});filter.values=new Map();const groupIds=[];if(filter.groupBy){const groups=new Map();for(const value of values){const groupId=value.group_id;if(!groups.has(groupId)){if(groupId){groupIds.push(groupId);}
groups.set(groupId,{id:groupId,name:value.group_name,values:new Map(),tooltip:value.group_tooltip,sequence:value.group_sequence,hex_color:value.group_hex_color,});const oldGroup=filter.groups&&filter.groups.get(groupId);groups.get(groupId).state=(oldGroup&&oldGroup.state)||false;}
groups.get(groupId).values.set(value.id,value);}
filter.groups=groups;filter.sortedGroupIds=sortBy(groupIds,(id)=>groups.get(id).sequence||groups.get(id).name);for(const group of filter.groups.values()){for(const[valueId,value]of group.values){filter.values.set(valueId,value);}}}else{for(const value of values){filter.values.set(value.id,value);}}}
_createSectionsFromArch(){let hasCategoryWithCounters=false;let hasFilterWithDomain=false;this.config.archNodes.forEach(({attrs,tag},index)=>{if(tag!=="field"||attrs.invisible==="1"){return;}
const type=attrs.select==="multi"?"filter":"category";const section={color:attrs.color,description:attrs.string||this.config.fields[attrs.name].string,enableCounters:!!pyUtils.py_eval(attrs.enable_counters||"0"),expand:!!pyUtils.py_eval(attrs.expand||"0"),fieldName:attrs.name,icon:attrs.icon,id:nextSectionId++,index,limit:pyUtils.py_eval(attrs.limit||String(DEFAULT_LIMIT)),type,values:new Map(),};if(type==="category"){section.activeValueId=this.defaultValues[attrs.name];section.icon=section.icon||"fa-folder";section.hierarchize=!!pyUtils.py_eval(attrs.hierarchize||"1");section.values.set(false,{childrenIds:[],display_name:this.env._t("All"),id:false,bold:true,parentId:false,});hasCategoryWithCounters=hasCategoryWithCounters||section.enableCounters;}else{section.domain=attrs.domain||"[]";section.groupBy=attrs.groupby;section.icon=section.icon||"fa-filter";hasFilterWithDomain=hasFilterWithDomain||section.domain!=="[]";}
this.state.sections.set(section.id,section);});if(hasCategoryWithCounters&&hasFilterWithDomain){for(const category of this.categories){category.enableCounters=false;}
console.warn("Warning: categories with counters are incompatible with filters having a domain attribute.","All category counters have been disabled to avoid inconsistencies.",);}}
_ensureCategoryValue(category,valueIds){if(!valueIds.includes(category.activeValueId)){category.activeValueId=valueIds[0];}}
async _fetchCategories(categories){const filterDomain=this._getFilterDomain();await Promise.all(categories.map(async(category)=>{const result=await this.env.services.rpc({method:"search_panel_select_range",model:this.config.modelName,args:[category.fieldName],kwargs:{category_domain:this._getCategoryDomain(category.id),enable_counters:category.enableCounters,expand:category.expand,filter_domain:filterDomain,hierarchize:category.hierarchize,limit:category.limit,search_domain:this.searchDomain,},});this._createCategoryTree(category.id,result);}));}
async _fetchFilters(filters){const evalContext={};for(const category of this.categories){evalContext[category.fieldName]=category.activeValueId;}
const categoryDomain=this._getCategoryDomain();await Promise.all(filters.map(async(filter)=>{const result=await this.env.services.rpc({method:"search_panel_select_multi_range",model:this.config.modelName,args:[filter.fieldName],kwargs:{category_domain:categoryDomain,comodel_domain:Domain.prototype.stringToArray(filter.domain,evalContext),enable_counters:filter.enableCounters,filter_domain:this._getFilterDomain(filter.id),expand:filter.expand,group_by:filter.groupBy||false,group_domain:this._getGroupDomain(filter),limit:filter.limit,search_domain:this.searchDomain,},});this._createFilterTree(filter.id,result);}));}
async _fetchSections(isInitialLoad){await this._fetchCategories(isInitialLoad?this.categories:this.categoriesToLoad);await this._fetchFilters(isInitialLoad?this.filters:this.filtersToLoad);if(isInitialLoad){this._applyDefaultFilterValues();}}
_getCategoryDomain(excludedCategoryId){const domain=[];for(const category of this.categories){if(category.id===excludedCategoryId||!category.activeValueId){continue;}
const field=this.config.fields[category.fieldName];const operator=field.type==="many2one"&&category.parentField?"child_of":"=";domain.push([category.fieldName,operator,category.activeValueId,]);}
return domain;}
_getExternalDomain(){const domains=this.config.get("domain");const domain=domains.reduce((acc,dom)=>[...acc,...dom],[]);return Domain.prototype.normalizeArray(domain);}
_getFilterDomain(excludedFilterId){const domain=[];function addCondition(fieldName,valueMap){const ids=[];for(const[valueId,value]of valueMap){if(value.checked){ids.push(valueId);}}
if(ids.length){domain.push([fieldName,"in",ids]);}}
for(const filter of this.filters){if(filter.id===excludedFilterId){continue;}
const{fieldName,groups,values}=filter;if(groups){for(const group of groups.values()){addCondition(fieldName,group.values);}}else{addCondition(fieldName,values);}}
return domain;}
_getGroupDomain(filter){const{fieldName,groups,enableCounters}=filter;const{type:fieldType}=this.config.fields[fieldName];if(!enableCounters||!groups){return{many2one:[],many2many:{},}[fieldType];}
let groupDomain=null;if(fieldType==="many2one"){for(const group of groups.values()){const valueIds=[];let active=false;for(const[valueId,value]of group.values){const{checked}=value;valueIds.push(valueId);if(checked){active=true;}}
if(active){if(groupDomain){groupDomain=[[0,"=",1]];break;}else{groupDomain=[[fieldName,"in",valueIds]];}}}}else if(fieldType==="many2many"){const checkedValueIds=new Map();groups.forEach(({values},groupId)=>{values.forEach(({checked},valueId)=>{if(checked){if(!checkedValueIds.has(groupId)){checkedValueIds.set(groupId,[]);}
checkedValueIds.get(groupId).push(valueId);}});});groupDomain={};for(const[gId,ids]of checkedValueIds.entries()){for(const groupId of groups.keys()){if(gId!==groupId){const key=JSON.stringify(groupId);if(!groupDomain[key]){groupDomain[key]=[];}
groupDomain[key].push([fieldName,"in",ids]);}}}}
return groupDomain;}
_shouldWaitForData({isInitialLoad,searchDomainChanged}){if(isInitialLoad&&Object.keys(this.defaultValues).length){return true;}
if(this.categories.length&&this.filters.some(hasDomain)){return true;}
if(!this.searchDomain.length){return false;}
return[...this.state.sections.values()].some((section)=>!section.expand&&searchDomainChanged);}
static extractArchInfo(archs,viewType){const{children}=archs.search;const spNode=children.find(c=>c.tag==="searchpanel");const isObject=(obj)=>typeof obj==="object"&&obj!==null;if(spNode){const actualType=viewType==="list"?"tree":viewType;const{view_types}=spNode.attrs;const viewTypes=view_types?view_types.split(","):DEFAULT_VIEW_TYPES;if(viewTypes.includes(actualType)){return{attrs:spNode.attrs,children:spNode.children.filter(isObject),};}}
return null;}}
SearchPanelModelExtension.layer=1;ActionModel.registry.add("SearchPanel",SearchPanelModelExtension,30);return SearchPanelModelExtension;});;

/* /web/static/src/js/views/search_panel.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("web/static/src/js/views/search_panel.js",function(require){"use strict";const{Model,useModel}=require("web/static/src/js/model.js");const patchMixin=require("web.patchMixin");const{Component,hooks}=owl;const{useState,useSubEnv}=hooks;class SearchPanel extends Component{constructor(){super(...arguments);useSubEnv({searchModel:this.props.searchModel});this.state=useState({active:{},expanded:{},});this.model=useModel("searchModel");this.scrollTop=0;this.hasImportedState=false;this.importState(this.props.importedState);}
async willStart(){this._expandDefaultValue();this._updateActiveValues();}
mounted(){this._updateGroupHeadersChecked();if(this.hasImportedState){this.el.scroll({top:this.scrollTop});}}
async willUpdateProps(){this._updateActiveValues();}
exportState(){const exported={expanded:this.state.expanded,scrollTop:this.el.scrollTop,};return JSON.stringify(exported);}
importState(stringifiedState){this.hasImportedState=Boolean(stringifiedState);if(this.hasImportedState){const state=JSON.parse(stringifiedState);this.state.expanded=state.expanded;this.scrollTop=state.scrollTop;}}
_expandDefaultValue(){if(this.hasImportedState){return;}
const categories=this.model.get("sections",s=>s.type==="category");for(const category of categories){this.state.expanded[category.id]={};if(category.activeValueId){const ancestorIds=this._getAncestorValueIds(category,category.activeValueId);for(const ancestorId of ancestorIds){this.state.expanded[category.id][ancestorId]=true;}}}}
_getAncestorValueIds(category,categoryValueId){const{parentId}=category.values.get(categoryValueId);return parentId?[...this._getAncestorValueIds(category,parentId),parentId]:[];}
async _toggleCategory(category,value){if(value.childrenIds.length){const categoryState=this.state.expanded[category.id];if(categoryState[value.id]&&category.activeValueId===value.id){delete categoryState[value.id];}else{categoryState[value.id]=true;}}
if(category.activeValueId!==value.id){this.state.active[category.id]=value.id;this.model.dispatch("toggleCategoryValue",category.id,value.id);}}
_toggleFilterGroup(filterId,{values}){const valueIds=[];const checked=[...values.values()].every((value)=>this.state.active[filterId][value.id]);values.forEach(({id})=>{valueIds.push(id);this.state.active[filterId][id]=!checked;});this.model.dispatch("toggleFilterValues",filterId,valueIds,!checked);}
_toggleFilterValue(filterId,valueId,{currentTarget}){this.state.active[filterId][valueId]=currentTarget.checked;this._updateGroupHeadersChecked();this.model.dispatch("toggleFilterValues",filterId,[valueId]);}
_updateActiveValues(){for(const section of this.model.get("sections")){if(section.type==="category"){this.state.active[section.id]=section.activeValueId;}else{this.state.active[section.id]={};if(section.groups){for(const group of section.groups.values()){for(const value of group.values.values()){this.state.active[section.id][value.id]=value.checked;}}}
if(section&&section.values){for(const value of section.values.values()){this.state.active[section.id][value.id]=value.checked;}}}}}
_updateGroupHeadersChecked(){const groups=this.el.querySelectorAll(":scope .o_search_panel_filter_group");for(const group of groups){const header=group.querySelector(":scope .o_search_panel_group_header input");const vals=[...group.querySelectorAll(":scope .o_search_panel_filter_value input")];header.checked=false;header.indeterminate=false;if(vals.every((v)=>v.checked)){header.checked=true;}else if(vals.some((v)=>v.checked)){header.indeterminate=true;}}}}
SearchPanel.modelExtension="SearchPanel";SearchPanel.props={className:{type:String,optional:1},importedState:{type:String,optional:1},searchModel:Model,};SearchPanel.template="web.SearchPanel";return patchMixin(SearchPanel);});;

/* /web/static/src/js/views/action_model.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("web/static/src/js/views/action_model.js",function(require){"use strict";const Domain=require("web.Domain");const{FACET_ICONS}=require("web.searchUtils");const{Model}=require("web/static/src/js/model.js");const{parseArch}=require("web.viewUtils");const pyUtils=require("web.py_utils");const Registry=require("web.Registry");const isNotNull=(value)=>value!==null&&value!==undefined;const isObject=(obj)=>typeof obj==="object"&&obj!==null;class ActionModelExtension extends Model.Extension{async callLoad(){this.loadPromise=super.callLoad(...arguments);await this.loadPromise;}
async isReady(){await this.loadPromise;}
static extractArchInfo(){return null;}}
class ActionModel extends Model{get(property){switch(property){case"query":return this.config.searchQuery||this._getQuery();case"facets":return this._getFacets();}
return super.get(...arguments);}
async isReady(){await this._awaitExtensions();}
async _awaitExtensions(){await Promise.all(this.extensions.flat().map((extension)=>extension.isReady()));}
__get(excluded,property){const results=super.__get(...arguments);switch(property){case"domain":return[this.config.domain,...results];case"context":return[this.config.context,...results];}
return results;}
_getFacets(){const types=this.config.searchMenuTypes||[];const isValidType=(type)=>(!['groupBy','comparison'].includes(type)||types.includes(type));const facets=[];for(const extension of this.extensions.flat()){for(const facet of extension.get("facets")||[]){if(!isValidType(facet.type)){continue;}
facet.separator=facet.type==='groupBy'?">":this.env._t("or");if(facet.type in FACET_ICONS){facet.icon=FACET_ICONS[facet.type];}
facets.push(facet);}}
return facets;}
_getQuery(){const evalContext=this.env.session.user_context;const contexts=this.__get(null,"context");const domains=this.__get(null,"domain");const query={context:pyUtils.eval("contexts",contexts,evalContext),domain:Domain.prototype.normalizeArray(pyUtils.eval("domains",domains,evalContext)),orderedBy:this.get("orderedBy")||[],};const searchMenuTypes=this.config.searchMenuTypes||[];if(searchMenuTypes.includes("groupBy")){query.groupBy=this.get("groupBy")||[];}else{query.groupBy=[];}
if(searchMenuTypes.includes("comparison")){query.timeRanges=this.get("timeRanges")||{};}
return query;}
async _loadExtensions({isInitialLoad}){await super._loadExtensions(...arguments);if(!isInitialLoad){this.trigger("search",this.get("query"));await this._awaitExtensions();}}
static extractArchInfo(archs,viewType=null){const parsedArchs={};if(!archs.search){archs.search="<search/>";}
for(const key in archs){const{attrs,children}=parseArch(archs[key]);const objectChildren=children.filter(isObject);parsedArchs[key]={attrs,children:objectChildren,};}
const archInfo={};for(const key of this.registry.keys()){const extension=this.registry.get(key);const result=extension.extractArchInfo(parsedArchs,viewType);if(isNotNull(result)){archInfo[key]=result;}}
return archInfo;}}
ActionModel.Extension=ActionModelExtension;ActionModel.registry=new Registry(null,(value)=>value.prototype instanceof ActionModel.Extension);return ActionModel;});;

/* /web/static/src/js/views/field_manager_mixin.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.FieldManagerMixin',function(require){"use strict";var BasicModel=require('web.BasicModel');var concurrency=require('web.concurrency');var FieldManagerMixin={custom_events:{field_changed:'_onFieldChanged',load:'_onLoad',mutexify:'_onMutexify',},init:function(model){this.model=model||new BasicModel(this);this.mutex=new concurrency.Mutex();},_applyChanges:function(dataPointID,changes,event){var self=this;var options=_.pick(event.data,'context','doNotSetDirty','notifyChange','viewType','allowWarning');return this.model.notifyChanges(dataPointID,changes,options).then(function(result){if(event.data.force_save){return self.model.save(dataPointID).then(function(){return self._confirmSave(dataPointID);}).guardedCatch(function(){return self._rejectSave(dataPointID);});}else if(options.notifyChange!==false){return self._confirmChange(dataPointID,result,event);}});},_confirmChange:function(id,fields,event){return Promise.resolve();},_confirmSave:function(id){return Promise.resolve();},_rejectSave:function(id){return Promise.resolve();},_onFieldChanged:function(event){event.stopPropagation();return this._applyChanges(event.data.dataPointID,event.data.changes,event).then(event.data.onSuccess||function(){}).guardedCatch(event.data.onFailure||function(){});},_onLoad:function(event){var self=this;event.stopPropagation();var data=event.data;if(!data.on_success){return;}
var params={};if('limit'in data){params.limit=data.limit;}
if('offset'in data){params.offset=data.offset;}
this.mutex.exec(function(){return self.model.reload(data.id,params).then(function(db_id){data.on_success(self.model.get(db_id));});});},_onMutexify:function(ev){ev.stopPropagation();this.mutex.exec(ev.data.action);},};return FieldManagerMixin;});;

/* /web/static/src/js/views/file_upload_mixin.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.fileUploadMixin',function(require){'use strict';const{csrf_token,_t}=require('web.core');const ProgressBar=require('web.ProgressBar');const ProgressCard=require('web.ProgressCard');const ProgressBarMixin={custom_events:{progress_bar_abort:'_onProgressBarAbort',},init(){this._fileUploads={};},_createXhr(){return new window.XMLHttpRequest();},_getFileUploadRenderOptions(){return{predicate:()=>true,targetCallback:undefined,};},_getFileUploadRoute(){return'/web/binary/upload_attachment';},_makeFileUpload(params){const{files,xhr}=params;const fileUploadId=_.uniqueId('fileUploadId');const formData=new FormData();const formDataKeys=this._makeFileUploadFormDataKeys(Object.assign({fileUploadId},params));formData.append('csrf_token',csrf_token);for(const key in formDataKeys){if(formDataKeys[key]!==undefined){formData.append(key,formDataKeys[key]);}}
for(const file of files){formData.append('ufile',file);}
return{fileUploadId,xhr,title:files.length===1?files[0].name:_.str.sprintf(_t("%s Files"),files.length),type:files.length===1?files[0].type:undefined,formData,};},_makeFileUploadFormDataKeys({fileUploadId}){return{callback:fileUploadId,};},async _removeFileUpload(fileUploadId){const upload=this._fileUploads[fileUploadId];upload.progressCard&&upload.progressCard.destroy();upload.progressBar&&upload.progressBar.destroy();delete this._fileUploads[fileUploadId];await this.reload();},async _renderFileUploads(){const{predicate,targetCallback}=this._getFileUploadRenderOptions();for(const fileUploadId in this._fileUploads){const upload=this._fileUploads[fileUploadId];if(!predicate(upload)){continue;}
if(!upload.progressBar){if(!upload.recordId||this.viewType!=='kanban'){upload.progressCard=new ProgressCard(this,{title:upload.title,type:upload.type,viewType:this.viewType,});}
upload.progressBar=new ProgressBar(this,{xhr:upload.xhr,title:upload.title,fileUploadId,});}
let $targetCard;if(upload.progressCard){await upload.progressCard.prependTo(this.renderer.$el);$targetCard=upload.progressCard.$el;}else if(targetCallback){$targetCard=targetCallback(upload);}
await upload.progressBar.appendTo($targetCard);}},async _uploadFiles(files,params={}){if(!files||!files.length){return;}
await new Promise(resolve=>{const xhr=this._createXhr();xhr.open('POST',this._getFileUploadRoute());const fileUploadData=this._makeFileUpload(Object.assign({files,xhr},params));const{fileUploadId,formData}=fileUploadData;this._fileUploads[fileUploadId]=fileUploadData;xhr.upload.addEventListener("progress",ev=>{this._updateFileUploadProgress(fileUploadId,ev);});const progressPromise=this._onBeforeUpload();xhr.onload=async()=>{await progressPromise;resolve();this._onUploadLoad({fileUploadId,xhr});};xhr.onerror=async()=>{await progressPromise;resolve();this._onUploadError({fileUploadId,xhr});};xhr.send(formData);});},_updateFileUploadProgress(fileUploadId,ev){const{progressCard,progressBar}=this._fileUploads[fileUploadId];progressCard&&progressCard.update(ev.loaded,ev.total);progressBar&&progressBar.update(ev.loaded,ev.total);},async _onBeforeUpload(){await this._renderFileUploads();},_onProgressBarAbort(ev){this._removeFileUpload(ev.data.fileUploadId);},_onUploadLoad({fileUploadId}){this._removeFileUpload(fileUploadId);},_onUploadError({fileUploadId,xhr}){this.do_notify(xhr.status,_.str.sprintf(_t('message: %s'),xhr.reponseText),true);this._removeFileUpload(fileUploadId);},};return ProgressBarMixin;});;

/* /web/static/src/js/views/file_upload_progress_bar.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.ProgressBar',function(require){'use strict';const{_t}=require('web.core');const Dialog=require('web.Dialog');const Widget=require('web.Widget');const ProgressBar=Widget.extend({template:'web.FileUploadProgressBar',events:{'click .o_upload_cross':'_onClickCross',},init(parent,{title,fileUploadId,xhr}){this._super(...arguments);this.title=title;this.fileUploadId=fileUploadId;this.xhr=xhr;},start(){this.xhr.onabort=()=>this.do_notify(false,_t("Upload cancelled"));return this._super(...arguments);},update(loaded,total){if(!this.$el){return;}
const percent=Math.round((loaded/total)*100);this.$('.o_file_upload_progress_bar_value').css("width",percent+"%");},_onClickCross(ev){ev.stopPropagation();const promptText=_.str.sprintf(_t("Do you really want to cancel the upload of %s?"),_.escape(this.title));Dialog.confirm(this,promptText,{confirm_callback:()=>{this.xhr.abort();this.trigger_up('progress_bar_abort',{fileUploadId:this.fileUploadId});}});},});return ProgressBar;});;

/* /web/static/src/js/views/file_upload_progress_card.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.ProgressCard',function(require){'use strict';const{_t}=require('web.core');const Widget=require('web.Widget');const ProgressCard=Widget.extend({template:'web.ProgressCard',init(parent,{title,type,viewType}){this._super(...arguments);this.title=title;this.type=type;this.viewType=viewType;},update(loaded,total){if(!this.$el){return;}
const percent=Math.round((loaded/total)*100);const $textDivLeft=this.$('.o_file_upload_progress_text_left');const $textDivRight=this.$('.o_file_upload_progress_text_right');if(percent===100){$textDivLeft.text(_t('Processing...'));}else{const mbLoaded=Math.round(loaded/1000000);const mbTotal=Math.round(total/1000000);$textDivLeft.text(_.str.sprintf(_t("Uploading... (%s%%)"),percent));$textDivRight.text(_.str.sprintf(_t("(%s/%sMb)"),mbLoaded,mbTotal));}},});return ProgressCard;});;

/* /web/static/src/js/views/sample_server.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.SampleServer',function(require){"use strict";const session=require('web.session');const utils=require('web.utils');const Registry=require('web.Registry');class UnimplementedRouteError extends Error{}
function getSampleFromId(id,sampleTexts){return sampleTexts[(id-1)%sampleTexts.length];}
function fieldNameRegex(...terms){return new RegExp(`\\b((\\w+)?_)?(${terms.join('|')})(_(\\w+)?)?\\b`);}
const DESCRIPTION_REGEX=fieldNameRegex('description','label','title','subject','message');const EMAIL_REGEX=fieldNameRegex('email');const PHONE_REGEX=fieldNameRegex('phone');const URL_REGEX=fieldNameRegex('url');class SampleServer{constructor(modelName,fields){this.mainModel=modelName;this.data={};this.data[modelName]={fields,records:[],};for(const fieldName in fields){const field=fields[fieldName];if(['many2one','one2many','many2many'].includes(field.type)){this.data[field.relation]=this.data[field.relation]||{fields:{display_name:{type:'char'},id:{type:'integer'},color:{type:'integer'},},records:[],};}}
this.existingGroups=null;this.populated=false;this.existingGroupsPopulated=false;}
mockRpc(params){if(!(params.model in this.data)){throw new Error(`SampleServer: unknown model ${params.model}`);}
this._populateModels();switch(params.method||params.route){case'/web/dataset/search_read':return this._mockSearchReadController(params);case'web_read_group':return this._mockWebReadGroup(params);case'read_group':return this._mockReadGroup(params);case'read_progress_bar':return this._mockReadProgressBar(params);case'read':return this._mockRead(params);}
const method=params.method||params.route;const mockFunction=SampleServer.mockRegistry.get(`${params.model}/${method}`)||SampleServer.mockRegistry.get(method);if(mockFunction){return mockFunction.call(this,params);}
console.log(`SampleServer: unimplemented route "${params.method || params.route}"`);throw new SampleServer.UnimplementedRouteError();}
setExistingGroups(groups){this.existingGroups=groups;}
_aggregateFields(measures,records){const values={};for(const{fieldName,type}of measures){if(['float','integer','monetary'].includes(type)){if(records.length){let value=0;for(const record of records){value+=record[fieldName];}
values[fieldName]=value;}else{values[fieldName]=null;}}
if(type==='many2one'){const ids=new Set(records.map(r=>r[fieldName]));values.fieldName=ids.size||null;}}
return values;}
_formatValue(value,options){if(!value){return false;}
const{type,interval,relation}=options;if(['date','datetime'].includes(type)){const fmt=SampleServer.FORMATS[interval];return moment(value).format(fmt);}else if(type==='many2one'){const rec=this.data[relation].records.find(({id})=>id===value);return[value,rec.display_name];}else{return value;}}
_generateFieldValue(modelName,fieldName,id){const field=this.data[modelName].fields[fieldName];switch(field.type){case"boolean":return fieldName==='active'?true:this._getRandomBool();case"char":case"text":if(["display_name","name"].includes(fieldName)){if(SampleServer.PEOPLE_MODELS.includes(modelName)){return getSampleFromId(id,SampleServer.SAMPLE_PEOPLE);}else if(modelName==='res.country'){return getSampleFromId(id,SampleServer.SAMPLE_COUNTRIES);}}
if(fieldName==='display_name'){return getSampleFromId(id,SampleServer.SAMPLE_TEXTS);}else if(["name","reference"].includes(fieldName)){return`REF${String(id).padStart(4, '0')}`;}else if(DESCRIPTION_REGEX.test(fieldName)){return getSampleFromId(id,SampleServer.SAMPLE_TEXTS);}else if(EMAIL_REGEX.test(fieldName)){const emailName=getSampleFromId(id,SampleServer.SAMPLE_PEOPLE).replace(/ /,".").toLowerCase();return`${emailName}@sample.demo`;}else if(PHONE_REGEX.test(fieldName)){return`+1 555 754 ${String(id).padStart(4, '0')}`;}else if(URL_REGEX.test(fieldName)){return`http://sample${id}.com`;}
return false;case"date":case"datetime":{const format=field.type==="date"?"YYYY-MM-DD":"YYYY-MM-DD HH:mm:ss";return this._getRandomDate(format);}
case"float":return this._getRandomFloat(SampleServer.MAX_FLOAT);case"integer":{let max=SampleServer.MAX_INTEGER;if(fieldName.includes('color')){max=this._getRandomBool()?SampleServer.MAX_COLOR_INT:0;}
return this._getRandomInt(max);}
case"monetary":return this._getRandomInt(SampleServer.MAX_MONETARY);case"many2one":if(field.relation==='res.currency'){return session.company_currency_id;}
return this._getRandomSubRecordId();case"one2many":case"many2many":{const ids=[this._getRandomSubRecordId(),this._getRandomSubRecordId()];return[...new Set(ids)];}
case"selection":{if(fieldName==='activity_exception_decoration'){return false;}
if(field.selection.length>0){return this._getRandomArrayEl(field.selection)[0];}
return false;}
default:return false;}}
_getRandomArrayEl(array){return array[Math.floor(Math.random()*array.length)];}
_getRandomBool(){return Math.random()<0.5;}
_getRandomDate(format){const delta=Math.floor((Math.random()-Math.random())*SampleServer.DATE_DELTA);return new moment().add(delta,"hour").format(format);}
_getRandomFloat(max){return Math.random()*max;}
_getRandomInt(max){return Math.floor(Math.random()*max);}
_getRandomSubRecordId(){return Math.floor(Math.random()*SampleServer.SUB_RECORDSET_SIZE)+1;}
_mockRead(params){const model=this.data[params.model];const ids=params.args[0];const fieldNames=params.args[1];const records=[];for(const r of model.records){if(!ids.includes(r.id)){continue;}
const record={id:r.id};for(const fieldName of fieldNames){const field=model.fields[fieldName];if(!field){record[fieldName]=false;}else if(field.type==='many2one'){const relModel=this.data[field.relation];const relRecord=relModel.records.find(relR=>r[fieldName]===relR.id);record[fieldName]=relRecord?[relRecord.id,relRecord.display_name]:false;}else{record[fieldName]=r[fieldName];}}
records.push(record);}
return records;}
_mockReadGroup(params){const lazy='lazy'in params?params.lazy:true;const model=params.model;const fields=this.data[model].fields;const records=this.data[model].records;const normalizedGroupBys=[];let groupBy=[];if(params.groupBy.length){groupBy=lazy?[params.groupBy[0]]:params.groupBy;}
for(const groupBySpec of groupBy){let[fieldName,interval]=groupBySpec.split(':');interval=interval||'month';const{type,relation}=fields[fieldName];if(type){const gb={fieldName,type,interval,relation,alias:groupBySpec};normalizedGroupBys.push(gb);}}
const groups=utils.groupBy(records,(record)=>{const vals={};for(const gb of normalizedGroupBys){const{fieldName,type}=gb;let value;if(['date','datetime'].includes(type)){value=this._formatValue(record[fieldName],gb);}else{value=record[fieldName];}
vals[fieldName]=value;}
return JSON.stringify(vals);});const measures=[];for(const measureSpec of(params.fields||Object.keys(fields))){const[fieldName,aggregateFunction]=measureSpec.split(':');const{type}=fields[fieldName];if(!params.groupBy.includes(fieldName)&&type&&(type!=='many2one'||aggregateFunction!=='count_distinct')){measures.push({fieldName,type});}}
let result=[];for(const id in groups){const records=groups[id];const group={__domain:[]};let countKey=`__count`;if(normalizedGroupBys.length&&lazy){countKey=`${normalizedGroupBys[0].fieldName}_count`;}
group[countKey]=records.length;const firstElem=records[0];for(const gb of normalizedGroupBys){const{alias,fieldName}=gb;group[alias]=this._formatValue(firstElem[fieldName],gb);}
Object.assign(group,this._aggregateFields(measures,records));result.push(group);}
if(normalizedGroupBys.length>0){const{alias,interval,type}=normalizedGroupBys[0];result=utils.sortBy(result,(group)=>{const val=group[alias];if(['date','datetime'].includes(type)){return moment(val,SampleServer.FORMATS[interval]);}
return val;});}
return result;}
_mockReadProgressBar(params){const groupBy=params.kwargs.group_by;const progress_bar=params.kwargs.progress_bar;const groupByField=this.data[params.model].fields[groupBy];const data={};for(const record of this.data[params.model].records){let groupByValue=record[groupBy];if(groupByField.type==="many2one"){const relatedRecords=this.data[groupByField.relation].records;const relatedRecord=relatedRecords.find(r=>r.id===groupByValue);groupByValue=relatedRecord.display_name;}
if(!(groupByValue in data)){data[groupByValue]={};for(const key in progress_bar.colors){data[groupByValue][key]=0;}}
const fieldValue=record[progress_bar.field];if(fieldValue in data[groupByValue]){data[groupByValue][fieldValue]++;}}
return data;}
_mockSearchReadController(params){const model=this.data[params.model];const rawRecords=model.records.slice(0,SampleServer.SEARCH_READ_LIMIT);const records=this._mockRead({model:params.model,args:[rawRecords.map(r=>r.id),params.fields],});return{records,length:records.length};}
_mockWebReadGroup(params){let groups;if(this.existingGroups){this._tweakExistingGroups(params);groups=this.existingGroups;}else{groups=this._mockReadGroup(params);}
return{groups,length:groups.length,};}
_populateExistingGroups(params){if(!this.existingGroupsPopulated){const groups=this.existingGroups;this.groupsInfo=groups;const groupBy=params.groupBy[0];const values=groups.map(g=>g[groupBy]);const groupByField=this.data[params.model].fields[groupBy];const groupedByM2O=groupByField.type==='many2one';if(groupedByM2O){this.data[groupByField.relation].records=values.map(v=>{return{id:v[0],display_name:v[1]};});}
for(const r of this.data[params.model].records){const value=getSampleFromId(r.id,values);r[groupBy]=groupedByM2O?value[0]:value;}
this.existingGroupsPopulated=true;}}
_populateModels(){if(!this.populated){for(const modelName in this.data){const model=this.data[modelName];const fieldNames=Object.keys(model.fields).filter(f=>f!=='id');const size=modelName===this.mainModel?SampleServer.MAIN_RECORDSET_SIZE:SampleServer.SUB_RECORDSET_SIZE;for(let id=1;id<=size;id++){const record={id};for(const fieldName of fieldNames){record[fieldName]=this._generateFieldValue(modelName,fieldName,id);}
model.records.push(record);}}
this.populated=true;}}
_tweakExistingGroups(params){const groups=this.existingGroups;this._populateExistingGroups(params);const groupBy=params.groupBy[0].split(':')[0];const groupByField=this.data[params.model].fields[groupBy];const groupedByM2O=groupByField.type==='many2one';const records=this.data[params.model].records;for(const g of groups){const groupValue=groupedByM2O?g[groupBy][0]:g[groupBy];const recordsInGroup=records.filter(r=>r[groupBy]===groupValue);g[`${groupBy}_count`]=recordsInGroup.length;for(const field of params.fields){const fieldType=this.data[params.model].fields[field].type;if(['integer, float','monetary'].includes(fieldType)){g[field]=recordsInGroup.reduce((acc,r)=>acc+r[field],0);}}
g.__data={records:this._mockRead({model:params.model,args:[recordsInGroup.map(r=>r.id),params.fields],}),length:recordsInGroup.length,};}}}
SampleServer.FORMATS={day:'YYYY-MM-DD',week:'[W]ww YYYY',month:'MMMM YYYY',quarter:'[Q]Q YYYY',year:'Y',};SampleServer.DISPLAY_FORMATS=Object.assign({},SampleServer.FORMATS,{day:'DD MMM YYYY'});SampleServer.MAIN_RECORDSET_SIZE=16;SampleServer.SUB_RECORDSET_SIZE=5;SampleServer.SEARCH_READ_LIMIT=10;SampleServer.MAX_FLOAT=100;SampleServer.MAX_INTEGER=50;SampleServer.MAX_COLOR_INT=7;SampleServer.MAX_MONETARY=100000;SampleServer.DATE_DELTA=24*60;SampleServer.SAMPLE_COUNTRIES=["Belgium","France","Portugal","Singapore","Australia"];SampleServer.SAMPLE_PEOPLE=["John Miller","Henry Campbell","Carrie Helle","Wendi Baltz","Thomas Passot",];SampleServer.SAMPLE_TEXTS=["Laoreet id","Volutpat blandit","Integer vitae","Viverra nam","In massa",];SampleServer.PEOPLE_MODELS=['res.users','res.partner','hr.employee','mail.followers','mailing.contact'];SampleServer.UnimplementedRouteError=UnimplementedRouteError;SampleServer.mockRegistry=new Registry();return SampleServer;});;

/* /web/static/src/js/views/select_create_controllers_registry.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.select_create_controllers_registry',function(require){"use strict";return{};});odoo.define('web._select_create_controllers_registry',function(require){"use strict";var KanbanController=require('web.KanbanController');var ListController=require('web.ListController');var select_create_controllers_registry=require('web.select_create_controllers_registry');var SelectCreateKanbanController=KanbanController.extend({_onOpenRecord:function(ev){var selectedRecord=this.model.get(ev.data.id);this.trigger_up('select_record',{id:selectedRecord.res_id,display_name:selectedRecord.data.display_name,});},});var SelectCreateListController=ListController.extend({_onOpenRecord:function(ev){var selectedRecord=this.model.get(ev.data.id);this.trigger_up('select_record',{id:selectedRecord.res_id,display_name:selectedRecord.data.display_name,});},});_.extend(select_create_controllers_registry,{SelectCreateListController:SelectCreateListController,SelectCreateKanbanController:SelectCreateKanbanController,});});;

/* /web/static/src/js/views/signature_dialog.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.signature_dialog',function(require){"use strict";var core=require('web.core');var Dialog=require('web.Dialog');var NameAndSignature=require('web.name_and_signature').NameAndSignature;var _t=core._t;var SignatureDialog=Dialog.extend({template:'web.signature_dialog',xmlDependencies:Dialog.prototype.xmlDependencies.concat(['/web/static/src/xml/name_and_signature.xml']),custom_events:{'signature_changed':'_onChangeSignature',},init:function(parent,options){var self=this;options=options||{};options.title=options.title||_t("Adopt Your Signature");options.size=options.size||'medium';options.technical=false;if(!options.buttons){options.buttons=[];options.buttons.push({text:_t("Adopt and Sign"),classes:"btn-primary",disabled:true,click:function(e){self._onConfirm();}});options.buttons.push({text:_t("Cancel"),close:true});}
this._super(parent,options);this.nameAndSignature=new NameAndSignature(this,options.nameAndSignatureOptions);},willStart:function(){return Promise.all([this.nameAndSignature.appendTo($('<div>')),this._super.apply(this,arguments)]);},start:function(){var self=this;this.$primaryButton=this.$footer.find('.btn-primary');this.opened().then(function(){self.$('.o_web_sign_name_and_signature').replaceWith(self.nameAndSignature.$el);self.nameAndSignature.resetSignature();});return this._super.apply(this,arguments);},isSignatureEmpty:function(){return this.nameAndSignature.isSignatureEmpty();},_onChangeSignature:function(){var isEmpty=this.nameAndSignature.isSignatureEmpty();this.$primaryButton.prop('disabled',isEmpty);},_onConfirm:function(fct){this.trigger_up('upload_signature',{name:this.nameAndSignature.getName(),signatureImage:this.nameAndSignature.getSignatureImage(),});},});return SignatureDialog;});;

/* /web/static/src/js/views/standalone_field_manager_mixin.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.StandaloneFieldManagerMixin',function(require){"use strict";var FieldManagerMixin=require('web.FieldManagerMixin');var StandaloneFieldManagerMixin=_.extend({},FieldManagerMixin,{init:function(){FieldManagerMixin.init.apply(this,arguments);this.registeredWidgets={};},_confirmChange:function(id,fields,event){var result=FieldManagerMixin._confirmChange.apply(this,arguments);var record=this.model.get(id);_.each(this.registeredWidgets[id],function(widget,fieldName){if(_.contains(fields,fieldName)){widget.reset(record,event);}});return result;},_registerWidget:function(datapointID,fieldName,widget){if(!this.registeredWidgets[datapointID]){this.registeredWidgets[datapointID]={};}
this.registeredWidgets[datapointID][fieldName]=widget;},});return StandaloneFieldManagerMixin;});;

/* /web/static/src/js/views/view_registry.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.view_registry',function(require){"use strict";var Registry=require('web.Registry');return new Registry();});odoo.define('web._view_registry',function(require){"use strict";var FormView=require('web.FormView');var GraphView=require('web.GraphView');var KanbanView=require('web.KanbanView');var ListView=require('web.ListView');var PivotView=require('web.PivotView');var CalendarView=require('web.CalendarView');var view_registry=require('web.view_registry');view_registry.add('form',FormView).add('list',ListView).add('kanban',KanbanView).add('graph',GraphView).add('pivot',PivotView).add('calendar',CalendarView);});;

/* /web/static/src/js/views/view_dialogs.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.view_dialogs',function(require){"use strict";var config=require('web.config');var core=require('web.core');var Dialog=require('web.Dialog');var dom=require('web.dom');var view_registry=require('web.view_registry');var select_create_controllers_registry=require('web.select_create_controllers_registry');var _t=core._t;var ViewDialog=Dialog.extend({custom_events:_.extend({},Dialog.prototype.custom_events,{push_state:'_onPushState',}),init:function(parent,options){options=options||{};options.fullscreen=config.device.isMobile;options.dialogClass=options.dialogClass||''+' o_act_window';this._super(parent,$.extend(true,{},options));this.res_model=options.res_model||null;this.domain=options.domain||[];this.context=options.context||{};this.options=_.extend(this.options||{},options||{});},_onPushState:function(event){event.stopPropagation();},});var FormViewDialog=ViewDialog.extend({init:function(parent,options){var self=this;options=options||{};this.res_id=options.res_id||null;this.on_saved=options.on_saved||(function(){});this.on_remove=options.on_remove||(function(){});this.context=options.context;this.model=options.model;this.parentID=options.parentID;this.recordID=options.recordID;this.shouldSaveLocally=options.shouldSaveLocally;this.readonly=options.readonly;this.deletable=options.deletable;this.disable_multiple_selection=options.disable_multiple_selection;var oBtnRemove='o_btn_remove';var multi_select=!_.isNumber(options.res_id)&&!options.disable_multiple_selection;var readonly=_.isNumber(options.res_id)&&options.readonly;if(!options.buttons){options.buttons=[{text:options.close_text||(readonly?_t("Close"):_t("Discard")),classes:"btn-secondary o_form_button_cancel",close:true,click:function(){if(!readonly){self.form_view.model.discardChanges(self.form_view.handle,{rollback:self.shouldSaveLocally,});}},}];if(!readonly){options.buttons.unshift({text:options.save_text||(multi_select?_t("Save & Close"):_t("Save")),classes:"btn-primary",click:function(){self._save().then(self.close.bind(self));}});if(multi_select){options.buttons.splice(1,0,{text:_t("Save & New"),classes:"btn-primary",click:function(){self._save().then(self.form_view.createRecord.bind(self.form_view,self.parentID)).then(function(){if(!self.deletable){return;}
self.deletable=false;self.buttons=self.buttons.filter(function(button){return button.classes.split(' ').indexOf(oBtnRemove)<0;});self.set_buttons(self.buttons);self.set_title(_t("Create ")+_.str.strRight(self.title,_t("Open: ")));});},});}
var multi=options.disable_multiple_selection;if(!multi&&this.deletable){this._setRemoveButtonOption(options,oBtnRemove);}}}
this._super(parent,options);},open:function(){var self=this;var _super=this._super.bind(this);var FormView=view_registry.get('form');var fields_view_def;if(this.options.fields_view){fields_view_def=Promise.resolve(this.options.fields_view);}else{fields_view_def=this.loadFieldView(this.res_model,this.context,this.options.view_id,'form');}
fields_view_def.then(function(viewInfo){var refinedContext=_.pick(self.context,function(value,key){return key.indexOf('_view_ref')===-1;});var formview=new FormView(viewInfo,{modelName:self.res_model,context:refinedContext,ids:self.res_id?[self.res_id]:[],currentId:self.res_id||undefined,index:0,mode:self.res_id&&self.options.readonly?'readonly':'edit',footerToButtons:true,default_buttons:false,withControlPanel:false,model:self.model,parentID:self.parentID,recordID:self.recordID,isFromFormViewDialog:true,});return formview.getController(self);}).then(function(formView){self.form_view=formView;var fragment=document.createDocumentFragment();if(self.recordID&&self.shouldSaveLocally){self.model.save(self.recordID,{savePoint:true});}
return self.form_view.appendTo(fragment).then(function(){self.opened().then(function(){var $buttons=$('<div>');self.form_view.renderButtons($buttons);if($buttons.children().length){self.$footer.empty().append($buttons.contents());}
dom.append(self.$el,fragment,{callbacks:[{widget:self.form_view}],in_DOM:true,});self.form_view.updateButtons();});return _super();});});return this;},_focusOnClose:function(){var isFocusSet=false;this.trigger_up('form_dialog_discarded',{callback:function(isFocused){isFocusSet=isFocused;},});return isFocusSet;},_remove:function(){return Promise.resolve(this.on_remove());},_save:function(){var self=this;return this.form_view.saveRecord(this.form_view.handle,{stayInEdit:true,reload:false,savePoint:this.shouldSaveLocally,viewType:'form',}).then(function(changedFields){var record=self.form_view.model.get(self.form_view.handle);return self.on_saved(record,!!changedFields.length);});},_setRemoveButtonOption(options,btnClasses){const self=this;options.buttons.push({text:_t("Remove"),classes:'btn-secondary '+btnClasses,click:function(){self._remove().then(self.close.bind(self));}});},});var SelectCreateDialog=ViewDialog.extend({custom_events:_.extend({},ViewDialog.prototype.custom_events,{select_record:function(event){if(!this.options.readonly){this.on_selected([event.data]);this.close();}},selection_changed:function(event){event.stopPropagation();this.$footer.find(".o_select_button").prop('disabled',!event.data.selection.length);},}),init:function(){this._super.apply(this,arguments);_.defaults(this.options,{initial_view:'search'});this.on_selected=this.options.on_selected||(function(){});this.on_closed=this.options.on_closed||(function(){});this.initialIDs=this.options.initial_ids;this.viewType='list';},open:function(){if(this.options.initial_view!=="search"){return this.create_edit_record();}
var self=this;var _super=this._super.bind(this);var viewRefID=this.viewType==='kanban'?(this.options.kanban_view_ref&&JSON.parse(this.options.kanban_view_ref)||false):false;return this.loadViews(this.res_model,this.context,[[viewRefID,this.viewType],[false,'search']],{load_filters:true}).then(this.setup.bind(this)).then(function(fragment){self.opened().then(function(){dom.append(self.$el,fragment,{callbacks:[{widget:self.viewController}],in_DOM:true,});self.set_buttons(self.__buttons);});return _super();});},setup:function(fieldsViews){var self=this;var fragment=document.createDocumentFragment();var domain=this.domain;if(this.initialIDs){domain=domain.concat([['id','in',this.initialIDs]]);}
var ViewClass=view_registry.get(this.viewType);var viewOptions={};var selectCreateController;if(this.viewType==='list'){_.extend(viewOptions,{hasSelectors:!this.options.disable_multiple_selection,readonly:true,},this.options.list_view_options);selectCreateController=select_create_controllers_registry.SelectCreateListController;}
if(this.viewType==='kanban'){_.extend(viewOptions,{noDefaultGroupby:true,selectionMode:this.options.selectionMode||false,});selectCreateController=select_create_controllers_registry.SelectCreateKanbanController;}
var view=new ViewClass(fieldsViews[this.viewType],_.extend(viewOptions,{action:{controlPanelFieldsView:fieldsViews.search,help:_.str.sprintf("<p>%s</p>",_t("No records found!")),},action_buttons:false,dynamicFilters:this.options.dynamicFilters,context:this.context,domain:domain,modelName:this.res_model,withBreadcrumbs:false,withSearchPanel:false,}));view.setController(selectCreateController);return view.getController(this).then(function(controller){self.viewController=controller;self._prepareButtons();return self.viewController.appendTo(fragment);}).then(function(){return fragment;});},close:function(){this._super.apply(this,arguments);this.on_closed();},create_edit_record:function(){var self=this;var dialog=new FormViewDialog(this,_.extend({},this.options,{on_saved:function(record){var values=[{id:record.res_id,display_name:record.data.display_name||record.data.name,}];self.on_selected(values);},})).open();dialog.on('closed',this,this.close);return dialog;},_focusOnClose:function(){var isFocusSet=false;this.trigger_up('form_dialog_discarded',{callback:function(isFocused){isFocusSet=isFocused;},});return isFocusSet;},_prepareButtons:function(){this.__buttons=[{text:_t("Cancel"),classes:'btn-secondary o_form_button_cancel',close:true,}];if(!this.options.no_create){this.__buttons.unshift({text:_t("Create"),classes:'btn-primary',click:this.create_edit_record.bind(this)});}
if(!this.options.disable_multiple_selection){this.__buttons.unshift({text:_t("Select"),classes:'btn-primary o_select_button',disabled:true,close:true,click:function(){var records=this.viewController.getSelectedRecords();var values=_.map(records,function(record){return{id:record.res_id,display_name:record.data.display_name,};});this.on_selected(values);},});}},});return{FormViewDialog:FormViewDialog,SelectCreateDialog:SelectCreateDialog,};});;

/* /web/static/src/js/views/view_utils.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.viewUtils',function(require){"use strict";var dom=require('web.dom');var utils=require('web.utils');var viewUtils={getGroupValue:function(group,groupByField){var groupedByField=group.fields[groupByField];switch(groupedByField.type){case'many2one':return group.res_id||false;case'selection':var descriptor=_.find(groupedByField.selection,function(option){return option[1]===group.value;});return descriptor&&descriptor[0];case'char':case'boolean':return group.value;default:return false;}},isQuickCreateEnabled:function(list){var groupByField=list.groupedBy[0]&&list.groupedBy[0].split(':')[0];if(!groupByField){return false;}
var availableTypes=['char','boolean','many2one','selection'];if(!_.contains(availableTypes,list.fields[groupByField].type)){return false;}
return true;},parseArch:function(arch){var doc=$.parseXML(arch).documentElement;var stripWhitespaces=doc.nodeName.toLowerCase()!=='kanban';return utils.xml_to_json(doc,stripWhitespaces);},renderButtonFromNode:function(node,options){var btnOptions={attrs:_.omit(node.attrs,'icon','string','type','attrs','modifiers','options','effect'),icon:node.attrs.icon,};if(options&&options.extraClass){var classes=btnOptions.attrs.class?btnOptions.attrs.class.split(' '):[];btnOptions.attrs.class=_.uniq(classes.concat(options.extraClass.split(' '))).join(' ');}
var str=(node.attrs.string||'').replace(/_/g,'');if(str){if(options&&options.textAsTitle){btnOptions.attrs.title=str;}else{btnOptions.text=str;}}
return dom.renderButton(btnOptions);},};return viewUtils;});;

/* /web/static/src/js/views/form/form_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.FormRenderer',function(require){"use strict";var BasicRenderer=require('web.BasicRenderer');var config=require('web.config');var core=require('web.core');var dom=require('web.dom');var viewUtils=require('web.viewUtils');var _t=core._t;var qweb=core.qweb;const symbol=Symbol('form');var FormRenderer=BasicRenderer.extend({className:"o_form_view",events:_.extend({},BasicRenderer.prototype.events,{'click .o_notification_box .oe_field_translate':'_onTranslate','click .o_notification_box .close':'_onTranslateNotificationClose','shown.bs.tab a[data-toggle="tab"]':'_onNotebookTabChanged',}),custom_events:_.extend({},BasicRenderer.prototype.custom_events,{'navigation_move':'_onNavigationMove','activate_next_widget':'_onActivateNextWidget',}),INNER_GROUP_COL:2,OUTER_GROUP_COL:2,init:function(parent,state,params){this._super.apply(this,arguments);this.fieldIdsToNames=params.fieldIdsToNames;this.idsForLabels={};this.lastActivatedFieldIndex=-1;this.alertFields={};this.renderInvisible=false;},start:function(){this._applyFormSizeClass();return this._super.apply(this,arguments);},autofocus:function(){if(this.mode==='readonly'){var firstPrimaryFormButton=this.$el.find('button.btn-primary:enabled:visible:first()');if(firstPrimaryFormButton.length>0){return firstPrimaryFormButton.focus();}else{return;}}
var focusWidget=this.defaultFocusField;if(!focusWidget||!focusWidget.isFocusable()){var widgets=this.allFieldWidgets[this.state.id];for(var i=0;i<(widgets?widgets.length:0);i++){var widget=widgets[i];if(widget.isFocusable()){focusWidget=widget;break;}}}
if(focusWidget){return focusWidget.activate({noselect:true,noAutomaticCreate:true});}},canBeSaved:function(){var fieldNames=this._super.apply(this,arguments);var $labels=this.$('label');$labels.removeClass('o_field_invalid');const allWidgets=this.allFieldWidgets[this.state.id]||[];const widgets=allWidgets.filter(w=>fieldNames.includes(w.name));for(const widget of widgets){const idForLabel=this.idsForLabels[widget[symbol]];if(idForLabel){$labels.filter('[for='+idForLabel+']').addClass('o_field_invalid');}}
return fieldNames;},updateAlertFields:function(alertFields){this.alertFields[this.state.res_id]=_.extend(this.alertFields[this.state.res_id]||{},alertFields);this.displayTranslationAlert();},displayTranslationAlert:function(){this.$('.o_notification_box').remove();if(this.alertFields[this.state.res_id]){var $notification=$(qweb.render('notification-box',{type:'info'})).append(qweb.render('translation-alert',{fields:this.alertFields[this.state.res_id],lang:_t.database.parameters.name}));if(this.$('.o_form_statusbar').length){this.$('.o_form_statusbar').after($notification);}else if(this.$('.o_form_sheet_bg').length){this.$('.o_form_sheet_bg').prepend($notification);}else{this.$el.prepend($notification);}}},confirmChange:function(){var self=this;return this._super.apply(this,arguments).then(function(resetWidgets){_.each(resetWidgets,function(widget){self._setIDForLabel(widget,self.idsForLabels[widget[symbol]]);});if(self.$('.o_field_invalid').length){self.canBeSaved(self.state.id);}
return resetWidgets;});},disableButtons:function(){this.$('.o_statusbar_buttons button, .oe_button_box button').attr('disabled',true);},enableButtons:function(){this.$('.o_statusbar_buttons button, .oe_button_box button').removeAttr('disabled');},focusLastActivatedWidget:function(){if(this.lastActivatedFieldIndex!==-1){return this._activateNextFieldWidget(this.state,this.lastActivatedFieldIndex-1,{noAutomaticCreate:true});}
return false;},getLocalState:function(){const state={};for(const notebook of this.el.querySelectorAll(':scope div.o_notebook')){const name=notebook.dataset.name;const navs=notebook.querySelectorAll(':scope .o_notebook_headers .nav-item > .nav-link');state[name]=Math.max([...navs].findIndex(nav=>nav.classList.contains('active')),0);}
return state;},resetLastActivatedField:function(){this.lastActivatedFieldIndex=-1;},setLocalState:function(state){for(const notebook of this.el.querySelectorAll(':scope div.o_notebook')){const name=notebook.dataset.name;if(name in state){const navs=notebook.querySelectorAll(':scope .o_notebook_headers .nav-item');const pages=notebook.querySelectorAll(':scope .tab-content > .tab-pane');const validTabsAmount=pages.length;if(!validTabsAmount){continue;}
let activeIndex=state[name];if(navs[activeIndex].classList.contains('o_invisible_modifier')){activeIndex=[...navs].findIndex(nav=>!nav.classList.contains('o_invisible_modifier'));}
if(activeIndex<=0){continue;}
for(let i=0;i<validTabsAmount;i++){navs[i].querySelector('.nav-link').classList.toggle('active',activeIndex===i);pages[i].classList.toggle('active',activeIndex===i);}
core.bus.trigger('DOM_updated');}}},updateState:function(state,params){this._setState(state);this.mode=(params&&'mode'in params)?params.mode:this.mode;if(params.fieldNames){return this.confirmChange(this.state,this.state.id,params.fieldNames);}
return this._super.apply(this,arguments);},_activateFirstVisibleTab(tabs){const visibleTabs=tabs.filter((tab)=>!tab.$header.hasClass("o_invisible_modifier"));const autofocusTab=visibleTabs.findIndex((tab)=>tab.node.attrs.autofocus==="autofocus");const tabToFocus=visibleTabs[Math.max(0,autofocusTab)];if(tabToFocus){tabToFocus.$header.find('.nav-link').addClass('active');tabToFocus.$page.addClass('active');}},_activateNextFieldWidget:function(record,currentIndex){if((currentIndex+1)>=(this.allFieldWidgets[record.id]||[]).length){this.trigger_up('focus_control_button');this.lastActivatedFieldIndex=-1;}else{var activatedIndex=this._super.apply(this,arguments);if(activatedIndex===-1){this.trigger_up('focus_control_button');this.lastActivatedFieldIndex=-1;}
else{this.lastActivatedFieldIndex=activatedIndex;}}
return this.lastActivatedFieldIndex;},_addButtonTooltip:function(node,$button){var self=this;$button.tooltip({title:function(){return qweb.render('WidgetButton.tooltip',{debug:config.isDebug(),state:self.state,node:node,});},});},_addOnClickAction:function($el,node){if(node.attrs.special||node.attrs.confirm||node.attrs.type||$el.hasClass('oe_stat_button')){var self=this;$el.on("click",function(){self.trigger_up('button_clicked',{attrs:node.attrs,record:self.state,});});}},_applyFormSizeClass:function(){const formEl=this.$el[0];if(config.device.size_class<=config.device.SIZES.XS){formEl.classList.add('o_xxs_form_view');}else{formEl.classList.remove('o_xxs_form_view');}
if(config.device.size_class===config.device.SIZES.XXL){formEl.classList.add('o_xxl_form_view');}else{formEl.classList.remove('o_xxl_form_view');}},_getIDForLabel:function(uid){if(!this.idsForLabels[uid]){this.idsForLabels[uid]=_.uniqueId('o_field_input_');}
return this.idsForLabels[uid];},_getRecord:function(recordId){return this.state.id===recordId?this.state:null;},_postProcessField:function(widget,node){this._super.apply(this,arguments);widget[symbol]=node.attrs.id;this._setIDForLabel(widget,this._getIDForLabel(node.attrs.id));if(JSON.parse(node.attrs.default_focus||"0")){this.defaultFocusField=widget;}},_renderButtonBox:function(node){var self=this;var $result=$('<'+node.tag+'>',{class:'o_not_full'});var nextDefIndex=this.defs.length;var buttons=_.map(node.children,function(child){if(child.tag==='button'){return self._renderStatButton(child);}else{return self._renderNode(child);}});var $tempWrapper=$('<div>');_.each(buttons,function($button){$button.appendTo($tempWrapper);});var defs=this.defs.slice(nextDefIndex);Promise.all(defs).then(function(){buttons=$tempWrapper.children();var buttons_partition=_.partition(buttons,function(button){return $(button).is('.o_invisible_modifier');});var invisible_buttons=buttons_partition[0];var visible_buttons=buttons_partition[1];var nb_buttons=self._renderButtonBoxNbButtons();var unfolded_buttons=visible_buttons.slice(0,nb_buttons).concat(invisible_buttons);var folded_buttons=visible_buttons.slice(nb_buttons);if(folded_buttons.length===1){unfolded_buttons=buttons;folded_buttons=[];}
var full=(visible_buttons.length>nb_buttons);$result.toggleClass('o_full',full).toggleClass('o_not_full',!full);_.each(unfolded_buttons,function(button){$(button).appendTo($result);});if(folded_buttons.length){$result.append(dom.renderButton({attrs:{'class':'oe_stat_button o_button_more dropdown-toggle','data-toggle':'dropdown',},text:_t("More"),}));var $dropdown=$("<div>",{class:"dropdown-menu o_dropdown_more",role:"menu"});_.each(folded_buttons,function(button){$(button).addClass('dropdown-item').appendTo($dropdown);});$dropdown.appendTo($result);}});this._handleAttributes($result,node);this._registerModifiers(node,this.state,$result);return $result;},_renderButtonBoxNbButtons:function(){return[2,2,2,4][config.device.size_class]||7;},_renderFieldWidget(node){if(!this.renderInvisible&&node.attrs.modifiers.invisible===true){return $();}
return this._super(...arguments);},_renderGenericTag:function(node){var $result=$('<'+node.tag+'>',_.omit(node.attrs,'modifiers'));this._handleAttributes($result,node);this._registerModifiers(node,this.state,$result);$result.append(_.map(node.children,this._renderNode.bind(this)));return $result;},_renderHeaderButton:function(node){var $button=viewUtils.renderButtonFromNode(node);if($button.not('.btn-primary, .btn-secondary, .btn-link, .btn-success, .btn-info, .btn-warning, .btn-danger').length){$button.addClass('btn-secondary');}
this._addOnClickAction($button,node);this._handleAttributes($button,node);this._registerModifiers(node,this.state,$button);if(config.isDebug()||node.attrs.help){this._addButtonTooltip(node,$button);}
return $button;},_renderHeaderButtons:function(node){var self=this;var buttons=[];_.each(node.children,function(child){if(child.tag==='button'){buttons.push(self._renderHeaderButton(child));}
if(child.tag==='widget'){buttons.push(self._renderTagWidget(child));}});return this._renderStatusbarButtons(buttons);},_renderInnerGroup:function(node){var self=this;var $result=$('<table/>',{class:'o_group o_inner_group'});var $tbody=$('<tbody />').appendTo($result);this._handleAttributes($result,node);this._registerModifiers(node,this.state,$result);var col=parseInt(node.attrs.col,10)||this.INNER_GROUP_COL;if(node.attrs.string){var $sep=$('<tr><td colspan="'+col+'" style="width: 100%;"><div class="o_horizontal_separator">'+node.attrs.string+'</div></td></tr>');$result.append($sep);}
var rows=[];var $currentRow=$('<tr/>');var currentColspan=0;node.children.forEach(function(child){if(child.tag==='newline'){rows.push($currentRow);$currentRow=$('<tr/>');currentColspan=0;return;}
var colspan=parseInt(child.attrs.colspan,10);var isLabeledField=(child.tag==='field'&&child.attrs.nolabel!=='1');if(!colspan){if(isLabeledField){colspan=2;}else{colspan=1;}}
var finalColspan=colspan-(isLabeledField?1:0);currentColspan+=colspan;if(currentColspan>col){rows.push($currentRow);$currentRow=$('<tr/>');currentColspan=colspan;}
var $tds;if(child.tag==='field'){$tds=self._renderInnerGroupField(child);}else if(child.tag==='label'){$tds=self._renderInnerGroupLabel(child);}else{var $td=$('<td/>');var $child=self._renderNode(child);if($child.hasClass('o_td_label')){$td.addClass('o_td_label');$child.removeClass('o_td_label');}
$tds=$td.append($child);}
if(finalColspan>1){$tds.last().attr('colspan',finalColspan);}
$currentRow.append($tds);});rows.push($currentRow);_.each(rows,function($tr){var nonLabelColSize=100/(col-$tr.children('.o_td_label').length);_.each($tr.children(':not(.o_td_label)'),function(el){var $el=$(el);$el.css('width',((parseInt($el.attr('colspan'),10)||1)*nonLabelColSize)+'%');});$tbody.append($tr);});return $result;},_renderInnerGroupField:function(node){var $el=this._renderFieldWidget(node,this.state);var $tds=$('<td/>').append($el);if(node.attrs.nolabel!=='1'){var $labelTd=this._renderInnerGroupLabel(node);$tds=$labelTd.add($tds);if(/\boe_edit_only\b/.test(node.attrs.class)){$tds.addClass('oe_edit_only');}
if(/\boe_read_only\b/.test(node.attrs.class)){$tds.addClass('oe_read_only');}}
return $tds;},_renderInnerGroupLabel:function(node){return $('<td/>',{class:'o_td_label'}).append(this._renderTagLabel(node));},_renderNode:function(node){var renderer=this['_renderTag'+_.str.capitalize(node.tag)];if(renderer){return renderer.call(this,node);}
if(node.tag==='div'&&node.attrs.name==='button_box'){return this._renderButtonBox(node);}
if(_.isString(node)){return node;}
return this._renderGenericTag(node);},_renderOuterGroup:function(node){var self=this;var $result=$('<div/>',{class:'o_group'});var nbCols=parseInt(node.attrs.col,10)||this.OUTER_GROUP_COL;var colSize=Math.max(1,Math.round(12/nbCols));if(node.attrs.string){var $sep=$('<div/>',{class:'o_horizontal_separator'}).text(node.attrs.string);$result.append($sep);}
$result.append(_.map(node.children,function(child){if(child.tag==='newline'){return $('<br/>');}
var $child=self._renderNode(child);$child.addClass('o_group_col_'+(colSize*(parseInt(child.attrs.colspan,10)||1)));return $child;}));this._handleAttributes($result,node);this._registerModifiers(node,this.state,$result);return $result;},_renderStatButton:function(node){var $button=viewUtils.renderButtonFromNode(node,{extraClass:'oe_stat_button',});$button.append(_.map(node.children,this._renderNode.bind(this)));if(node.attrs.help){this._addButtonTooltip(node,$button);}
this._addOnClickAction($button,node);this._handleAttributes($button,node);this._registerModifiers(node,this.state,$button);return $button;},_renderStatusbarButtons:function(buttons){var $statusbarButtons=$('<div>',{class:'o_statusbar_buttons'});buttons.forEach(button=>$statusbarButtons.append(button));return $statusbarButtons;},_renderTabHeader:function(page,page_id){var $a=$('<a>',{'data-toggle':'tab',disable_anchor:'true',href:'#'+page_id,class:'nav-link',role:'tab',text:page.attrs.string,});return $('<li>',{class:'nav-item'}).append($a);},_renderTabPage:function(page,page_id){var $result=$('<div class="tab-pane" id="'+page_id+'">');$result.append(_.map(page.children,this._renderNode.bind(this)));return $result;},_renderTagButton:function(node){var $button=viewUtils.renderButtonFromNode(node);$button.append(_.map(node.children,this._renderNode.bind(this)));this._addOnClickAction($button,node);this._handleAttributes($button,node);this._registerModifiers(node,this.state,$button);if(config.isDebug()||node.attrs.help){this._addButtonTooltip(node,$button);}
return $button;},_renderTagField:function(node){return this._renderFieldWidget(node,this.state);},_renderTagForm:function(node){var $result=$('<div/>');if(node.attrs.class){$result.addClass(node.attrs.class);}
var allNodes=node.children.map(this._renderNode.bind(this));$result.append(allNodes);return $result;},_renderTagGroup:function(node){var isOuterGroup=_.some(node.children,function(child){return child.tag==='group';});if(!isOuterGroup){return this._renderInnerGroup(node);}
return this._renderOuterGroup(node);},_renderTagHeader:function(node){var self=this;var $statusbar=$('<div>',{class:'o_form_statusbar'});$statusbar.append(this._renderHeaderButtons(node));_.each(node.children,function(child){if(child.tag==='field'){var $el=self._renderFieldWidget(child,self.state);$statusbar.append($el);}});this._handleAttributes($statusbar,node);this._registerModifiers(node,this.state,$statusbar);return $statusbar;},_renderTagLabel:function(node){if(!this.renderInvisible&&node.tag==='field'&&node.attrs.modifiers.invisible===true){return $();}
var self=this;var text;let fieldName;if(node.tag==='label'){fieldName=this.fieldIdsToNames[node.attrs.for];}else{fieldName=node.attrs.name;}
if('string'in node.attrs){text=node.attrs.string;}else if(fieldName){text=this.state.fields[fieldName].string;}else{return this._renderGenericTag(node);}
var $result=$('<label>',{class:'o_form_label',for:this._getIDForLabel(node.tag==='label'?node.attrs.for:node.attrs.id),text:text,});if(node.tag==='label'){this._handleAttributes($result,node);}
var modifiersOptions;if(fieldName){modifiersOptions={callback:function(element,modifiers,record){var widgets=self.allFieldWidgets[record.id];var widget=_.findWhere(widgets,{name:fieldName});if(!widget){return;}
element.$el.toggleClass('o_form_label_empty',!!(record.data.id&&(modifiers.readonly||self.mode==='readonly')&&!widget.isSet()));},};}
this._registerModifiers(node,this.state,$result,modifiersOptions);return $result;},_renderTagNotebook:function(node){var self=this;var $headers=$('<ul class="nav nav-tabs">');var $pages=$('<div class="tab-content">');var renderedTabs=_.map(node.children,function(child,index){var pageID=_.uniqueId('notebook_page_');var $header=self._renderTabHeader(child,pageID);var $page=self._renderTabPage(child,pageID);self._handleAttributes($header,child);$headers.append($header);$pages.append($page);return{$header:$header,$page:$page,node:child,};});_.each(renderedTabs,function(tab){self._registerModifiers(tab.node,self.state,tab.$header,{callback:function(element,modifiers){var $link=element.$el.find('.nav-link');if(modifiers.invisible&&$link.hasClass('active')){$link.removeClass('active');tab.$page.removeClass('active');self.inactiveNotebooks.push(renderedTabs);}},});});this._activateFirstVisibleTab(renderedTabs);var $notebookHeaders=$('<div class="o_notebook_headers">').append($headers);var $notebook=$('<div class="o_notebook">').append($notebookHeaders,$pages);$notebook[0].dataset.name=node.attrs.name||'_default_';this._registerModifiers(node,this.state,$notebook);this._handleAttributes($notebook,node);return $notebook;},_renderTagSeparator:function(node){var $separator=$('<div/>').addClass('o_horizontal_separator').text(node.attrs.string);this._handleAttributes($separator,node);this._registerModifiers(node,this.state,$separator);return $separator;},_renderTagSheet:function(node){this.has_sheet=true;var $sheet=$('<div>',{class:'clearfix position-relative o_form_sheet'});$sheet.append(node.children.map(this._renderNode.bind(this)));return $sheet;},_renderTagWidget:function(node){return this._renderWidget(this.state,node);},_renderView:function(){var self=this;var defs=[];this.defs=defs;this.inactiveNotebooks=[];var $form=this._renderNode(this.arch).addClass(this.className);delete this.defs;return Promise.all(defs).then(function(){self._updateView($form.contents());if(self.state.res_id in self.alertFields){self.displayTranslationAlert();}}).then(function(){if(self.lastActivatedFieldIndex>=0){self._activateNextFieldWidget(self.state,self.lastActivatedFieldIndex);}}).guardedCatch(function(){$form.remove();});},async _updateAllModifiers(){await this._super(...arguments);for(const tabs of this.inactiveNotebooks){this._activateFirstVisibleTab(tabs);}
this.inactiveNotebooks=[];},_updateView:function($newContent){var self=this;this.$el.html($newContent);this.$el.toggleClass('o_form_nosheet',!this.has_sheet);if(this.has_sheet){this.$el.children().not('.o_FormRenderer_chatterContainer').wrapAll($('<div/>',{class:'o_form_sheet_bg'}));}
this.$el.toggleClass('o_form_editable',this.mode==='edit');this.$el.toggleClass('o_form_readonly',this.mode==='readonly');_.each(this.allFieldWidgets[this.state.id],function(widget){const idForLabel=self.idsForLabels[widget[symbol]];var $label=idForLabel?self.$('.o_form_label[for='+idForLabel+']'):$();self._addFieldTooltip(widget,$label);if(widget.attrs.widget==='upgrade_boolean'){widget.renderWithLabel($label);}});},_setIDForLabel:function(widget,idForLabel){widget.setIDForLabel(idForLabel);},_onActivateNextWidget:function(ev){ev.stopPropagation();var index=this.allFieldWidgets[this.state.id].indexOf(ev.data.target);this._activateNextFieldWidget(this.state,index);},_onNavigationMove:function(ev){ev.stopPropagation();if(ev.data.originalEvent&&['next','previous'].includes(ev.data.direction)){ev.data.originalEvent.preventDefault();ev.data.originalEvent.stopPropagation();}
var index;let target=ev.data.target||ev.target;if(target.__owl__){target=target.__owl__.parent;}
if(ev.data.direction==="next"){index=this.allFieldWidgets[this.state.id].indexOf(target);this._activateNextFieldWidget(this.state,index);}else if(ev.data.direction==="previous"){index=this.allFieldWidgets[this.state.id].indexOf(target);this._activatePreviousFieldWidget(this.state,index);}},_onNotebookTabChanged:function(){core.bus.trigger('DOM_updated');},_onTranslate:function(ev){ev.preventDefault();this.trigger_up('translate',{fieldName:ev.target.name,id:this.state.id,isComingFromTranslationAlert:true,});},_onTranslateNotificationClose:function(ev){delete this.alertFields[this.state.res_id];},});return FormRenderer;});;

/* /web/static/src/js/views/form/form_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.FormController',function(require){"use strict";var BasicController=require('web.BasicController');var core=require('web.core');var Dialog=require('web.Dialog');var dialogs=require('web.view_dialogs');var _t=core._t;var qweb=core.qweb;var FormController=BasicController.extend({custom_events:_.extend({},BasicController.prototype.custom_events,{button_clicked:'_onButtonClicked',edited_list:'_onEditedList',open_one2many_record:'_onOpenOne2ManyRecord',open_record:'_onOpenRecord',toggle_column_order:'_onToggleColumnOrder',focus_control_button:'_onFocusControlButton',form_dialog_discarded:'_onFormDialogDiscarded',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.actionButtons=params.actionButtons;this.disableAutofocus=params.disableAutofocus;this.footerToButtons=params.footerToButtons;this.defaultButtons=params.defaultButtons;this.hasActionMenus=params.hasActionMenus;this.toolbarActions=params.toolbarActions||{};},on_attach_callback:function(){this._super.apply(this,arguments);this.autofocus();},willRestore:function(){this.mode=this.model.isNew(this.handle)?'edit':'readonly';},autofocus:function(){if(!this.disableAutofocus){var isControlActivted=this.renderer.autofocus();if(!isControlActivted){if(this.$buttons&&this.mode==='readonly'){return this.$buttons.find('.o_form_button_edit').focus();}}}},createRecord:async function(parentID){const record=this.model.get(this.handle,{raw:true});const handle=await this.model.load({context:record.getContext(),fields:record.fields,fieldsInfo:record.fieldsInfo,modelName:this.modelName,parentID:parentID,res_ids:record.res_ids,type:'record',viewType:'form',});this.handle=handle;this._updateControlPanel();return this._setMode('edit');},getSelectedIds:function(){var env=this.model.get(this.handle,{env:true});return env.currentId?[env.currentId]:[];},getTitle:function(){return this.model.getName(this.handle);},getState:function(){const state=this._super.apply(this,arguments);const env=this.model.get(this.handle,{env:true});state.id=env.currentId;return state;},renderButtons:function($node){var $footer=this.footerToButtons?this.renderer.$el&&this.renderer.$('footer'):null;var mustRenderFooterButtons=$footer&&$footer.length;if((this.defaultButtons&&!this.$buttons)||mustRenderFooterButtons){this.$buttons=$('<div/>');if(mustRenderFooterButtons){this.$buttons.append($footer);}else{this.$buttons.append(qweb.render("FormView.buttons",{widget:this}));this.$buttons.on('click','.o_form_button_edit',this._onEdit.bind(this));this.$buttons.on('click','.o_form_button_create',this._onCreate.bind(this));this.$buttons.on('click','.o_form_button_save',this._onSave.bind(this));this.$buttons.on('click','.o_form_button_cancel',this._onDiscard.bind(this));this._assignSaveCancelKeyboardBehavior(this.$buttons.find('.o_form_buttons_edit'));this.$buttons.find('.o_form_buttons_edit').tooltip({delay:{show:200,hide:0},title:function(){return qweb.render('SaveCancelButton.tooltip');},trigger:'manual',});}}
if(this.$buttons&&$node){this.$buttons.appendTo($node);}},_getPagingInfo:function(){if(this.model.isNew(this.handle)){return null;}
return Object.assign(this._super(...arguments),{validate:this.canBeDiscarded.bind(this),});},_getActionMenuItems:function(state){if(!this.hasActionMenus||this.mode==='edit'){return null;}
const props=this._super(...arguments);const activeField=this.model.getActiveField(state);const otherActionItems=[];if(this.archiveEnabled&&activeField in state.data){if(state.data[activeField]){otherActionItems.push({description:_t("Archive"),callback:()=>{Dialog.confirm(this,_t("Are you sure that you want to archive this record?"),{confirm_callback:()=>this._toggleArchiveState(true),});},});}else{otherActionItems.push({description:_t("Unarchive"),callback:()=>this._toggleArchiveState(false),});}}
if(this.activeActions.create&&this.activeActions.duplicate){otherActionItems.push({description:_t("Duplicate"),callback:()=>this._onDuplicateRecord(this),});}
if(this.activeActions.delete){otherActionItems.push({description:_t("Delete"),callback:()=>this._onDeleteRecord(this),});}
return Object.assign(props,{items:Object.assign(this.toolbarActions,{other:otherActionItems}),});},saveRecord:async function(){const changedFields=await this._super(...arguments);this._updateControlPanel();if(_t.database.multi_lang&&changedFields.length){var fields=this.renderer.state.fields;var data=this.renderer.state.data;var alertFields={};for(var k=0;k<changedFields.length;k++){var field=fields[changedFields[k]];var fieldData=data[changedFields[k]];if(field.translate&&fieldData&&fieldData!=='<p><br></p>'){alertFields[changedFields[k]]=field;}}
if(!_.isEmpty(alertFields)){this.renderer.updateAlertFields(alertFields);}}
return changedFields;},update:async function(params,options){if('currentId'in params&&!params.currentId){this.mode='edit';}
params=_.extend({viewType:'form',mode:this.mode},params);await this._super(params,options);this.autofocus();},updateButtons:function(){if(!this.$buttons){return;}
if(this.footerToButtons){var $footer=this.renderer.$el&&this.renderer.$('footer');if($footer&&$footer.length){this.$buttons.empty().append($footer);}}
var edit_mode=(this.mode==='edit');this.$buttons.find('.o_form_buttons_edit').toggleClass('o_hidden',!edit_mode);this.$buttons.find('.o_form_buttons_view').toggleClass('o_hidden',edit_mode);},_applyChanges:async function(){const result=await this._super.apply(this,arguments);core.bus.trigger('DOM_updated');return result;},_assignSaveCancelKeyboardBehavior:function($saveCancelButtonContainer){var self=this;$saveCancelButtonContainer.children().on('keydown',function(e){switch(e.which){case $.ui.keyCode.ENTER:e.preventDefault();self.saveRecord();break;case $.ui.keyCode.ESCAPE:e.preventDefault();self._discardChanges();break;case $.ui.keyCode.TAB:if(!e.shiftKey&&e.target.classList.contains('btn-primary')){$saveCancelButtonContainer.tooltip('show');e.preventDefault();}
break;}});},_confirmSave:function(id){if(id===this.handle){if(this.mode==='readonly'){return this.reload();}else{return this._setMode('readonly');}}else{var record=this.model.get(this.handle);var containsChangedRecord=function(value){return _.isObject(value)&&(value.id===id||_.find(value.data,containsChangedRecord));};var changedFields=_.findKey(record.data,containsChangedRecord);return this.renderer.confirmChange(record,record.id,[changedFields]);}},_disableButtons:function(){this._super.apply(this,arguments);this.renderer.disableButtons();},_enableButtons:function(){this._super.apply(this,arguments);this.renderer.enableButtons();},_onDeletedRecords:function(){var state=this.model.get(this.handle,{raw:true});if(!state.res_ids.length){this.trigger_up('history_back');}else{this._super.apply(this,arguments);}},_rejectSave:function(){if(this.mode==='readonly'){return this.reload();}
return this._super.apply(this,arguments);},_setMode:function(mode,recordID){if((recordID||this.handle)===this.handle){this.model.unfreezeOrder(this.handle);}
if(this.mode!==mode){this.renderer.resetLastActivatedField();}
return this._super.apply(this,arguments);},_shouldBounceOnClick(element){return this.mode==='readonly'&&!!element.closest('.oe_title, .o_inner_group');},_onButtonClicked:function(ev){ev.stopPropagation();var self=this;var def;this._disableButtons();function saveAndExecuteAction(){return self.saveRecord(self.handle,{stayInEdit:true,}).then(function(){var record=self.model.get(ev.data.record.id);return self._callButtonAction(attrs,record);});}
var attrs=ev.data.attrs;if(attrs.confirm){def=new Promise(function(resolve,reject){Dialog.confirm(this,attrs.confirm,{confirm_callback:saveAndExecuteAction,}).on("closed",null,resolve);});}else if(attrs.special==='cancel'){def=this._callButtonAction(attrs,ev.data.record);}else if(!attrs.special||attrs.special==='save'){def=saveAndExecuteAction();}else{console.warn('Unhandled button event',ev);return;}
def.then(function(){self._enableButtons();if(attrs.close){self.trigger_up('close_dialog');}}).guardedCatch(this._enableButtons.bind(this));},_onCreate:function(){this.createRecord();},_onDeleteRecord:function(){this._deleteRecords([this.handle]);},_onDiscard:function(){this._discardChanges();},_onDuplicateRecord:async function(){const handle=await this.model.duplicateRecord(this.handle);this.handle=handle;this._updateControlPanel();this._setMode('edit');},_onEdit:function(){this.mutex.getUnlockedDef().then(this._setMode.bind(this,'edit'));},_onEditedList:function(ev){ev.stopPropagation();if(ev.data.id){this.model.save(ev.data.id,{savePoint:true});}
this.model.freezeOrder(ev.data.id);},_onFocusControlButton:function(e){if(this.$buttons){e.stopPropagation();this.$buttons.find('.btn-primary:visible:first()').focus();}},_onFormDialogDiscarded:function(ev){ev.stopPropagation();var isFocused=this.renderer.focusLastActivatedWidget();if(ev.data.callback){ev.data.callback(_.str.toBool(isFocused));}},_onOpenOne2ManyRecord:async function(ev){ev.stopPropagation();var data=ev.data;var record;if(data.id){record=this.model.get(data.id,{raw:true});}
await this.model.mutex.getUnlockedDef();new dialogs.FormViewDialog(this,{context:data.context,domain:data.domain,fields_view:data.fields_view,model:this.model,on_saved:data.on_saved,on_remove:data.on_remove,parentID:data.parentID,readonly:data.readonly,deletable:record?data.deletable:false,recordID:record&&record.id,res_id:record&&record.res_id,res_model:data.field.relation,shouldSaveLocally:true,title:(record?_t("Open: "):_t("Create "))+(ev.target.string||data.field.string),}).open();},_onOpenRecord:function(ev){ev.stopPropagation();var self=this;var record=this.model.get(ev.data.id,{raw:true});new dialogs.FormViewDialog(self,{context:ev.data.context,fields_view:ev.data.fields_view,on_saved:ev.data.on_saved,on_remove:ev.data.on_remove,readonly:ev.data.readonly,deletable:ev.data.deletable,res_id:record.res_id,res_model:record.model,title:_t("Open: ")+ev.data.string,}).open();},_onSave:function(ev){ev.stopPropagation();this._disableButtons();this.saveRecord().then(this._enableButtons.bind(this)).guardedCatch(this._enableButtons.bind(this));},_onToggleColumnOrder:function(ev){ev.stopPropagation();var self=this;this.model.setSort(ev.data.id,ev.data.name).then(function(){var field=ev.data.field;var state=self.model.get(self.handle);self.renderer.confirmChange(state,state.id,[field]);});},_toggleArchiveState:function(archive){const resIds=this.model.localIdsToResIds([this.handle]);this._archive(resIds,archive);},});return FormController;});;

/* /web/static/src/js/views/form/form_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.FormView',function(require){"use strict";var BasicView=require('web.BasicView');var Context=require('web.Context');var core=require('web.core');var FormController=require('web.FormController');var FormRenderer=require('web.FormRenderer');const{generateID}=require('web.utils');var _lt=core._lt;var FormView=BasicView.extend({config:_.extend({},BasicView.prototype.config,{Renderer:FormRenderer,Controller:FormController,}),display_name:_lt('Form'),icon:'fa-edit',multi_record:false,withSearchBar:false,searchMenuTypes:[],viewType:'form',init:function(viewInfo,params){var hasActionMenus=params.hasActionMenus;this._super.apply(this,arguments);var mode=params.mode||(params.currentId?'readonly':'edit');this.loadParams.type='record';if(hasActionMenus===undefined){hasActionMenus=params.hasActionMenus;}
this.controllerParams.hasActionMenus=hasActionMenus;this.controllerParams.disableAutofocus=params.disable_autofocus||this.arch.attrs.disable_autofocus;this.controllerParams.toolbarActions=viewInfo.toolbar;this.controllerParams.footerToButtons=params.footerToButtons;var defaultButtons='default_buttons'in params?params.default_buttons:true;this.controllerParams.defaultButtons=defaultButtons;this.controllerParams.mode=mode;this.rendererParams.mode=mode;this.rendererParams.isFromFormViewDialog=params.isFromFormViewDialog;this.rendererParams.fieldIdsToNames=this.fieldsView.fieldIdsToNames;},getController:function(parent){return this._loadSubviews(parent).then(this._super.bind(this,parent));},_extractParamsFromAction:function(action){var params=this._super.apply(this,arguments);var inDialog=action.target==='new';var inline=action.target==='inline';var fullscreen=action.target==='fullscreen';params.withControlPanel=!(inDialog||inline);params.footerToButtons=inDialog;params.hasSearchView=inDialog?false:params.hasSearchView;params.hasActionMenus=!inDialog&&!inline;params.searchMenuTypes=inDialog?[]:params.searchMenuTypes;if(inDialog||inline||fullscreen){params.mode='edit';}else if(action.context&&action.context.form_view_initial_mode){params.mode=action.context.form_view_initial_mode;}
return params;},_loadSubviews:function(parent){var self=this;var defs=[];if(this.loadParams&&this.loadParams.fieldsInfo){var fields=this.loadParams.fields;_.each(this.loadParams.fieldsInfo.form,function(attrs,fieldName){var field=fields[fieldName];if(!field){return;}
if(field.type!=='one2many'&&field.type!=='many2many'){return;}
if(attrs.Widget.prototype.useSubview&&!attrs.__no_fetch&&!attrs.views[attrs.mode]){var context={};var regex=/'([a-z]*_view_ref)' *: *'(.*?)'/g;var matches;while(matches=regex.exec(attrs.context)){context[matches[1]]=matches[2];}
var refinedContext=_.pick(self.loadParams.context,function(value,key){return key.indexOf('_view_ref')===-1;});refinedContext.base_model_name=self.controllerParams.modelName;defs.push(parent.loadViews(field.relation,new Context(context,self.userContext,refinedContext).eval(),[[null,attrs.mode==='tree'?'list':attrs.mode]]).then(function(views){for(var viewName in views){attrs.views[viewName]=self._processFieldsView(views[viewName],viewName);attrs.views[viewName].fields=attrs.views[viewName].viewFields;self._processSubViewAttrs(attrs.views[viewName],attrs);}
self._setSubViewLimit(attrs);}));}else{self._setSubViewLimit(attrs);}});}
return Promise.all(defs);},_processArch(arch,fv){fv.fieldIdsToNames={};return this._super(...arguments);},_processNode(node,fv){if(node.tag==='field'){const name=node.attrs.name;let uid=node.attrs.id;if(!uid){uid=name in fv.fieldIdsToNames?`${name}__${generateID()}__`:name;node.attrs.id=uid;}
fv.fieldIdsToNames[uid]=name;}
return this._super(...arguments);},_setSubViewLimit:function(attrs){var view=attrs.views&&attrs.views[attrs.mode];var limit=view&&view.arch.attrs.limit&&parseInt(view.arch.attrs.limit,10);attrs.limit=limit||attrs.Widget.prototype.limit||40;},});return FormView;});;

/* /web/static/src/js/views/graph/graph_model.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.GraphModel',function(require){"use strict";var core=require('web.core');const{DEFAULT_INTERVAL,rankInterval}=require('web.searchUtils');var _t=core._t;var AbstractModel=require('web.AbstractModel');return AbstractModel.extend({init:function(){this._super.apply(this,arguments);this.chart=null;},__get:function(){return Object.assign({isSample:this.isSampleModel},this.chart);},__load:function(params){var groupBys=params.context.graph_groupbys||params.groupBys;this.initialGroupBys=groupBys;this.fields=params.fields;this.modelName=params.modelName;this.chart=Object.assign({context:params.context,dataPoints:[],domain:params.domain,groupBy:params.groupedBy.length?params.groupedBy:groupBys,measure:params.context.graph_measure||params.measure,mode:params.context.graph_mode||params.mode,origins:[],stacked:params.stacked,timeRanges:params.timeRanges,orderBy:params.orderBy});this._computeDerivedParams();return this._loadGraph();},__reload:function(handle,params){if('context'in params){this.chart.context=params.context;this.chart.groupBy=params.context.graph_groupbys||this.chart.groupBy;this.chart.measure=params.context.graph_measure||this.chart.measure;this.chart.mode=params.context.graph_mode||this.chart.mode;}
if('domain'in params){this.chart.domain=params.domain;}
if('groupBy'in params){this.chart.groupBy=params.groupBy.length?params.groupBy:this.initialGroupBys;}
if('measure'in params){this.chart.measure=params.measure;}
if('timeRanges'in params){this.chart.timeRanges=params.timeRanges;}
this._computeDerivedParams();if('mode'in params){this.chart.mode=params.mode;return Promise.resolve();}
if('stacked'in params){this.chart.stacked=params.stacked;return Promise.resolve();}
if('orderBy'in params){this.chart.orderBy=params.orderBy;return Promise.resolve();}
return this._loadGraph();},_computeDerivedParams:function(){this.chart.processedGroupBy=this._processGroupBy(this.chart.groupBy);const{range,rangeDescription,comparisonRange,comparisonRangeDescription,fieldName}=this.chart.timeRanges;if(range){this.chart.domains=[this.chart.domain.concat(range),this.chart.domain.concat(comparisonRange),];this.chart.origins=[rangeDescription,comparisonRangeDescription];const groupBys=this.chart.processedGroupBy.map(function(gb){return gb.split(":")[0];});this.chart.comparisonFieldIndex=groupBys.indexOf(fieldName);}else{this.chart.domains=[this.chart.domain];this.chart.origins=[""];this.chart.comparisonFieldIndex=-1;}},_isEmpty(){return this.chart.dataPoints.length===0;},_loadGraph:function(){var self=this;this.chart.dataPoints=[];var groupBy=this.chart.processedGroupBy;var fields=_.map(groupBy,function(groupBy){return groupBy.split(':')[0];});if(this.chart.measure!=='__count__'){if(this.fields[this.chart.measure].type==='many2one'){fields=fields.concat(this.chart.measure+":count_distinct");}
else{fields=fields.concat(this.chart.measure);}}
var context=_.extend({fill_temporal:true},this.chart.context);var proms=[];this.chart.domains.forEach(function(domain,originIndex){proms.push(self._rpc({model:self.modelName,method:'read_group',context:context,domain:domain,fields:fields,groupBy:groupBy,lazy:false,}).then(self._processData.bind(self,originIndex)));});return Promise.all(proms);},_processData:function(originIndex,rawData){var self=this;var isCount=this.chart.measure==='__count__';var labels;function getLabels(dataPt){return self.chart.processedGroupBy.map(function(field){return self._sanitizeValue(dataPt[field],field.split(":")[0]);});}
rawData.forEach(function(dataPt){labels=getLabels(dataPt);var count=dataPt.__count||dataPt[self.chart.processedGroupBy[0]+'_count']||0;var value=isCount?count:dataPt[self.chart.measure];if(value instanceof Array){value=1;}
self.chart.dataPoints.push({resId:dataPt[self.chart.groupBy[0]]instanceof Array?dataPt[self.chart.groupBy[0]][0]:-1,count:count,domain:dataPt.__domain,value:value,labels:labels,originIndex:originIndex,});});},_processGroupBy:function(groupBy){const groupBysMap=new Map();for(const gb of groupBy){let[fieldName,interval]=gb.split(':');const field=this.fields[fieldName];if(['date','datetime'].includes(field.type)){interval=interval||DEFAULT_INTERVAL;}
if(groupBysMap.has(fieldName)){const registeredInterval=groupBysMap.get(fieldName);if(rankInterval(registeredInterval)<rankInterval(interval)){groupBysMap.set(fieldName,interval);}}else{groupBysMap.set(fieldName,interval);}}
return[...groupBysMap].map(([fieldName,interval])=>{if(interval){return`${fieldName}:${interval}`;}
return fieldName;});},_sanitizeValue:function(value,fieldName){if(value===false&&this.fields[fieldName].type!=='boolean'){return _t("Undefined");}
if(value instanceof Array){return value[1];}
if(fieldName&&(this.fields[fieldName].type==='selection')){var selected=_.where(this.fields[fieldName].selection,{0:value})[0];return selected?selected[1]:value;}
return value;},});});;

/* /web/static/src/js/views/graph/graph_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.GraphController',function(require){"use strict";const AbstractController=require('web.AbstractController');const{ComponentWrapper}=require('web.OwlCompatibility');const DropdownMenu=require('web.DropdownMenu');const{DEFAULT_INTERVAL,INTERVAL_OPTIONS}=require('web.searchUtils');const{qweb}=require('web.core');class CarretDropdownMenu extends DropdownMenu{get displayCaret(){return true;}}
var GraphController=AbstractController.extend({custom_events:_.extend({},AbstractController.prototype.custom_events,{item_selected:'_onItemSelected',open_view:'_onOpenView',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.measures=params.measures;this.isEmbedded=params.isEmbedded;this.withButtons=params.withButtons;this.views=params.views;this.title=params.title;this.groupableFields=params.groupableFields;this.buttonDropdownPromises=[];},start:function(){this.$el.addClass('o_graph_controller');return this._super.apply(this,arguments);},destroy:function(){if(this.$buttons){this.$buttons.find('button').off().tooltip('dispose');}
this._super.apply(this,arguments);},getOwnedQueryParams:function(){var state=this.model.get();return{context:{graph_measure:state.measure,graph_mode:state.mode,graph_groupbys:state.groupBy,}};},reload:async function(){const promises=[this._super(...arguments)];if(this.withButtons){const state=this.model.get();this.measures.forEach(m=>m.isActive=m.fieldName===state.measure);promises.push(this.measureMenu.update({items:this.measures}));}
return Promise.all(promises);},renderButtons:function($node){this.$buttons=$(qweb.render('GraphView.buttons'));this.$buttons.find('button').tooltip();this.$buttons.click(ev=>this._onButtonClick(ev));if(this.withButtons){const state=this.model.get();const fragment=document.createDocumentFragment();this.measures.forEach(m=>m.isActive=m.fieldName===state.measure);this.measureMenu=new ComponentWrapper(this,CarretDropdownMenu,{title:"Measures",items:this.measures,});this.buttonDropdownPromises=[this.measureMenu.mount(fragment)];if($node){if(this.isEmbedded){this.groupByMenu=new ComponentWrapper(this,CarretDropdownMenu,{title:"Group By",icon:'fa fa-bars',items:this._getGroupBys(state.groupBy),});this.buttonDropdownPromises.push(this.groupByMenu.mount(fragment));}
this.$buttons.appendTo($node);}}},updateButtons:function(){if(!this.$buttons){return;}
var state=this.model.get();this.$buttons.find('.o_graph_button').removeClass('active');this.$buttons.find('.o_graph_button[data-mode="'+state.mode+'"]').addClass('active');this.$buttons.find('.o_graph_button[data-mode="stack"]').data('stacked',state.stacked).toggleClass('active',state.stacked).toggleClass('o_hidden',state.mode!=='bar');this.$buttons.find('.o_graph_button[data-order]').toggleClass('o_hidden',state.mode==='pie'||!!Object.keys(state.timeRanges).length).filter('.o_graph_button[data-order="'+state.orderBy+'"]').toggleClass('active',!!state.orderBy);if(this.withButtons){this._attachDropdownComponents();}},async _attachDropdownComponents(){await Promise.all(this.buttonDropdownPromises);const actionsContainer=this.$buttons[0];actionsContainer.appendChild(this.measureMenu.el);this.measureMenu.el.classList.add('o_graph_measures_list');if(this.isEmbedded){actionsContainer.appendChild(this.groupByMenu.el);this.groupByMenu.el.classList.add('o_group_by_menu');}
const buttons=actionsContainer.querySelectorAll('.o_dropdown_toggler_btn');for(const button of buttons){button.classList.remove('o_dropdown_toggler_btn','btn-secondary');if(this.isEmbedded){button.classList.add('btn-outline-secondary');}else{button.classList.add('btn-primary');button.tabIndex=0;}}},_getGroupBys(activeGroupBys){const normalizedGroupBys=this._normalizeActiveGroupBys(activeGroupBys);const groupBys=Object.keys(this.groupableFields).map(fieldName=>{const field=this.groupableFields[fieldName];const groupByActivity=normalizedGroupBys.filter(gb=>gb.fieldName===fieldName);const groupBy={id:fieldName,isActive:Boolean(groupByActivity.length),description:field.string,itemType:'groupBy',};if(['date','datetime'].includes(field.type)){groupBy.hasOptions=true;const activeOptionIds=groupByActivity.map(gb=>gb.interval);groupBy.options=Object.values(INTERVAL_OPTIONS).map(o=>{return Object.assign({},o,{isActive:activeOptionIds.includes(o.id)});});}
return groupBy;}).sort((gb1,gb2)=>{return gb1.description.localeCompare(gb2.description);});return groupBys;},_normalizeActiveGroupBys(activeGroupBys){return activeGroupBys.map(groupBy=>{const fieldName=groupBy.split(':')[0];const field=this.groupableFields[fieldName];const normalizedGroupBy={fieldName};if(['date','datetime'].includes(field.type)){normalizedGroupBy.interval=groupBy.split(':')[1]||DEFAULT_INTERVAL;}
return normalizedGroupBy;});},_onButtonClick:function(ev){var $target=$(ev.target);if($target.hasClass('o_graph_button')){if(_.contains(['bar','line','pie'],$target.data('mode'))){this.update({mode:$target.data('mode')});}else if($target.data('mode')==='stack'){this.update({stacked:!$target.data('stacked')});}else if(['asc','desc'].includes($target.data('order'))){const order=$target.data('order');const state=this.model.get();this.update({orderBy:state.orderBy===order?false:order});}}},_onItemSelected(ev){const item=ev.data.item;if(this.isEmbedded&&item.itemType==='groupBy'){const fieldName=item.id;const optionId=ev.data.option&&ev.data.option.id;const activeGroupBys=this.model.get().groupBy;if(optionId){const normalizedGroupBys=this._normalizeActiveGroupBys(activeGroupBys);const index=normalizedGroupBys.findIndex(ngb=>ngb.fieldName===fieldName&&ngb.interval===optionId);if(index===-1){activeGroupBys.push(fieldName+':'+optionId);}else{activeGroupBys.splice(index,1);}}else{const groupByFieldNames=activeGroupBys.map(gb=>gb.split(':')[0]);const indexOfGroupby=groupByFieldNames.indexOf(fieldName);if(indexOfGroupby===-1){activeGroupBys.push(fieldName);}else{activeGroupBys.splice(indexOfGroupby,1);}}
this.update({groupBy:activeGroupBys});this.groupByMenu.update({items:this._getGroupBys(activeGroupBys),});}else if(item.itemType==='measure'){this.update({measure:item.fieldName});this.measures.forEach(m=>m.isActive=m.fieldName===item.fieldName);this.measureMenu.update({items:this.measures});}},_onOpenView(ev){ev.stopPropagation();const state=this.model.get();const context=Object.assign({},state.context);Object.keys(context).forEach(x=>{if(x==='group_by'||x.startsWith('search_default_')){delete context[x];}});this.do_action({context:context,domain:ev.data.domain,name:this.title,res_model:this.modelName,target:'current',type:'ir.actions.act_window',view_mode:'list',views:this.views,});},});return GraphController;});;

/* /web/static/src/js/views/graph/graph_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.GraphRenderer',function(require){"use strict";var AbstractRenderer=require('web.AbstractRenderer');var config=require('web.config');var core=require('web.core');var dataComparisonUtils=require('web.dataComparisonUtils');var fieldUtils=require('web.field_utils');var _t=core._t;var DateClasses=dataComparisonUtils.DateClasses;var qweb=core.qweb;var CHART_TYPES=['pie','bar','line'];var COLORS=["#1f77b4","#ff7f0e","#aec7e8","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"];var COLOR_NB=COLORS.length;function hexToRGBA(hex,opacity){var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);var rgb=result.slice(1,4).map(function(n){return parseInt(n,16);}).join(',');return'rgba('+rgb+','+opacity+')';}
var FORMAT_OPTIONS={humanReadable:function(value){return Math.abs(value)>=1000;},minDigits:1,decimals:2,formatterCallback:function(str){return str;},};var NO_DATA=[_t('No data')];NO_DATA.isNoData=true;var MAX_LEGEND_LENGTH=4*(Math.max(1,config.device.size_class));return AbstractRenderer.extend({className:"o_graph_renderer",sampleDataTargets:['.o_graph_canvas_container'],init:function(parent,state,params){this._super.apply(this,arguments);this.isEmbedded=params.isEmbedded||false;this.title=params.title||'';this.fields=params.fields||{};this.disableLinking=params.disableLinking;this.chart=null;this.chartId=_.uniqueId('chart');this.$legendTooltip=null;this.$tooltip=null;},on_attach_callback:function(){this._super.apply(this,arguments);this.isInDOM=true;this._render();},on_detach_callback:function(){this._super.apply(this,arguments);this.isInDOM=false;},_adjustTooltipHeight:function(maxTooltipHeight){var sizeOneLine=this.$tooltip.find('tbody tr')[0].clientHeight;var tbodySize=this.$tooltip.find('tbody')[0].clientHeight;var toKeep=Math.floor((maxTooltipHeight-(this.$tooltip[0].clientHeight-tbodySize))/sizeOneLine)-1;var $lines=this.$tooltip.find('tbody tr');var toRemove=$lines.length-toKeep;if(toRemove>0){$lines.slice(toKeep).remove();var tr=document.createElement('tr');var td=document.createElement('td');tr.classList.add('o_show_more');td.innerHTML=_t("...");tr.appendChild(td);this.$tooltip.find('tbody').append(tr);}},_customTooltip:function(tooltipModel){this.$el.css({cursor:'default'});if(this.$tooltip){this.$tooltip.remove();}
if(tooltipModel.opacity===0){return;}
if(tooltipModel.dataPoints.length===0){return;}
if(this._isRedirectionEnabled()){this.$el.css({cursor:'pointer'});}
const chartArea=this.chart.chartArea;const chartAreaLeft=chartArea.left;const chartAreaRight=chartArea.right;const chartAreaTop=chartArea.top;const rendererTop=this.$el[0].getBoundingClientRect().top;const maxTooltipLabelWidth=Math.floor((chartAreaRight-chartAreaLeft)/1.68)+'px';const tooltipItems=this._getTooltipItems(tooltipModel);this.$tooltip=$(qweb.render('GraphView.CustomTooltip',{measure:this.fields[this.state.measure].string,tooltipItems:tooltipItems,maxWidth:maxTooltipLabelWidth,})).css({top:'2px',left:'2px'});const $container=this.$el.find('.o_graph_canvas_container');$container.append(this.$tooltip);let top;const tooltipHeight=this.$tooltip[0].clientHeight;const minTopAllowed=Math.floor(chartAreaTop);const maxTopAllowed=Math.floor(window.innerHeight-rendererTop-tooltipHeight)-2;const y=Math.floor(tooltipModel.y);if(minTopAllowed<=maxTopAllowed){if(y<=maxTopAllowed){if(y>=minTopAllowed){top=y;}else{top=minTopAllowed;}}else{top=maxTopAllowed;}}else{top=minTopAllowed;const maxTooltipHeight=window.innerHeight-(rendererTop+chartAreaTop)-2;this._adjustTooltipHeight(maxTooltipHeight);}
this.$tooltip[0].style.top=Math.floor(top)+'px';this._fixTooltipLeftPosition(this.$tooltip[0],tooltipModel.x);},_filterDataPoints:function(){var dataPoints=[];if(_.contains(['bar','pie'],this.state.mode)){dataPoints=this.state.dataPoints.filter(function(dataPt){return dataPt.count>0;});}else if(this.state.mode==='line'){var counts=0;this.state.dataPoints.forEach(function(dataPt){if(dataPt.labels[0]!==_t("Undefined")){dataPoints.push(dataPt);}
counts+=dataPt.count;});if(counts===0){dataPoints=[];}}
return dataPoints;},_fixTooltipLeftPosition:function(tooltip,x){let left;const tooltipWidth=tooltip.clientWidth;const minLeftAllowed=Math.floor(this.chart.chartArea.left+2);const maxLeftAllowed=Math.floor(this.chart.chartArea.right-tooltipWidth-2);x=Math.floor(x);if(x<=maxLeftAllowed){if(x>=minLeftAllowed){left=x;}else{left=minLeftAllowed;}}else{left=maxLeftAllowed;}
tooltip.style.left=left+'px';},_formatValue:function(value){var measureField=this.fields[this.state.measure];var formatter=fieldUtils.format.float;var formatedValue=formatter(value,measureField,FORMAT_OPTIONS);return formatedValue;},_getColor:function(index){return COLORS[index%COLOR_NB];},_getDatasetDataLength:function(originIndex,defaultLength){if(_.contains(['bar','line'],this.state.mode)&&this.state.comparisonFieldIndex===0){return this.dateClasses.dateSets[originIndex].length;}
return defaultLength;},_getDatasetLabel:function(dataPt){if(_.contains(['bar','line'],this.state.mode)){var datasetLabel=dataPt.labels.slice(1).join("/");if(this.state.origins.length>1){datasetLabel=this.state.origins[dataPt.originIndex]+
(datasetLabel?('/'+datasetLabel):'');}
datasetLabel=datasetLabel||this.fields[this.state.measure].string;return datasetLabel;}
return this.state.origins[dataPt.originIndex];},_getElementOptions:function(){var elementOptions={};if(this.state.mode==='bar'){elementOptions.rectangle={borderWidth:1};}else if(this.state.mode==='line'){elementOptions.line={tension:0,fill:false,};}
return elementOptions;},_getDateClasses:function(dataPoints){var self=this;var dateSets=this.state.origins.map(function(){return[];});dataPoints.forEach(function(dataPt){dateSets[dataPt.originIndex].push(dataPt.labels[self.state.comparisonFieldIndex]);});dateSets=dateSets.map(function(dateSet){return _.uniq(dateSet);});return new DateClasses(dateSets);},_getLabel:function(dataPt){var i=this.state.comparisonFieldIndex;if(_.contains(['bar','line'],this.state.mode)){if(i===0){return[this.dateClasses.dateClass(dataPt.originIndex,dataPt.labels[i])];}else{return dataPt.labels.slice(0,1);}}else if(i===0){return Array.prototype.concat.apply([],[this.dateClasses.dateClass(dataPt.originIndex,dataPt.labels[i]),dataPt.labels.slice(i+1)]);}else{return dataPt.labels;}},_getLegendOptions:function(datasetsCount){var legendOptions={display:datasetsCount<=MAX_LEGEND_LENGTH,position:'top',onHover:this._onlegendTooltipHover.bind(this),onLeave:this._onLegendTootipLeave.bind(this),};var self=this;if(_.contains(['bar','line'],this.state.mode)){var referenceColor;if(this.state.mode==='bar'){referenceColor='backgroundColor';}else{referenceColor='borderColor';}
legendOptions.labels={generateLabels:function(chart){var data=chart.data;return data.datasets.map(function(dataset,i){return{text:self._shortenLabel(dataset.label),fullText:dataset.label,fillStyle:dataset[referenceColor],hidden:!chart.isDatasetVisible(i),lineCap:dataset.borderCapStyle,lineDash:dataset.borderDash,lineDashOffset:dataset.borderDashOffset,lineJoin:dataset.borderJoinStyle,lineWidth:dataset.borderWidth,strokeStyle:dataset[referenceColor],pointStyle:dataset.pointStyle,datasetIndex:i,};});},};}else{legendOptions.labels={generateLabels:function(chart){var data=chart.data;var metaData=data.datasets.map(function(dataset,index){return chart.getDatasetMeta(index).data;});return data.labels.map(function(label,i){var hidden=metaData.reduce(function(hidden,data){if(data[i]){hidden=hidden||data[i].hidden;}
return hidden;},false);var fullText=self._relabelling(label);var text=self._shortenLabel(fullText);return{text:text,fullText:fullText,fillStyle:label.isNoData?'#d3d3d3':self._getColor(i),hidden:hidden,index:i,};});},};}
return legendOptions;},_getScaleOptions:function(){var self=this;if(_.contains(['bar','line'],this.state.mode)){return{xAxes:[{type:'category',scaleLabel:{display:this.state.processedGroupBy.length&&!this.isEmbedded,labelString:this.state.processedGroupBy.length?this.fields[this.state.processedGroupBy[0].split(':')[0]].string:'',},ticks:{callback:function(label){return self._relabelling(label);},},}],yAxes:[{type:'linear',scaleLabel:{display:!this.isEmbedded,labelString:this.fields[this.state.measure].string,},ticks:{callback:this._formatValue.bind(this),suggestedMax:0,suggestedMin:0,}}],};}
return{};},_getTooltipItemContent:function(item,data){var dataset=data.datasets[item.datasetIndex];var label=data.labels[item.index];var value;var boxColor;if(this.state.mode==='bar'){label=this._relabelling(label,dataset.originIndex);if(this.state.processedGroupBy.length>1||this.state.origins.length>1){label=label+"/"+dataset.label;}
value=this._formatValue(item.yLabel);boxColor=dataset.backgroundColor;}else if(this.state.mode==='line'){label=this._relabelling(label,dataset.originIndex);if(this.state.processedGroupBy.length>1||this.state.origins.length>1){label=label+"/"+dataset.label;}
value=this._formatValue(item.yLabel);boxColor=dataset.borderColor;}else{if(label.isNoData){value=this._formatValue(0);}else{value=this._formatValue(dataset.data[item.index]);}
label=this._relabelling(label,dataset.originIndex);if(this.state.origins.length>1){label=dataset.label+"/"+label;}
boxColor=dataset.backgroundColor[item.index];}
return{label:label,value:value,boxColor:boxColor,};},_getTooltipItems:function(tooltipModel){var self=this;var data=this.chart.config.data;var orderedItems=tooltipModel.dataPoints.sort(function(dPt1,dPt2){return dPt2.yLabel-dPt1.yLabel;});return orderedItems.reduce(function(acc,item){acc.push(self._getTooltipItemContent(item,data));return acc;},[]);},_getTooltipOptions:function(){var tooltipOptions={enabled:false,custom:this._customTooltip.bind(this),};if(this.state.mode==='line'){tooltipOptions.mode='index';tooltipOptions.intersect=false;}
return tooltipOptions;},_isRedirectionEnabled:function(){return!this.disableLinking&&(this.state.mode==='bar'||this.state.mode==='pie');},_indexOf:function(list,label){var index=-1;for(var j=0;j<list.length;j++){var otherLabel=list[j];if(label.length===otherLabel.length){var equal=true;for(var i=0;i<label.length;i++){if(label[i]!==otherLabel[i]){equal=false;}}
if(equal){index=j;break;}}}
return index;},_prepareData:function(dataPoints){var self=this;var labelMap={};var labels=dataPoints.reduce(function(acc,dataPt){var label=self._getLabel(dataPt);var labelKey=dataPt.resId+':'+JSON.stringify(label);var index=labelMap[labelKey];if(index===undefined){labelMap[labelKey]=dataPt.labelIndex=acc.length;acc.push(label);}
else{dataPt.labelIndex=index;}
return acc;},[]);var newDataset=function(datasetLabel,originIndex){var data=new Array(self._getDatasetDataLength(originIndex,labels.length)).fill(0);const domain=new Array(self._getDatasetDataLength(originIndex,labels.length)).fill([]);return{label:datasetLabel,data:data,domain:domain,originIndex:originIndex,};};var datasets=_.values(dataPoints.reduce(function(acc,dataPt){var datasetLabel=self._getDatasetLabel(dataPt);if(!(datasetLabel in acc)){acc[datasetLabel]=newDataset(datasetLabel,dataPt.originIndex);}
var labelIndex=dataPt.labelIndex;acc[datasetLabel].data[labelIndex]=dataPt.value;acc[datasetLabel].domain[labelIndex]=dataPt.domain;return acc;},{}));datasets=datasets.sort(function(dataset1,dataset2){return dataset1.originIndex-dataset2.originIndex;});return{datasets:datasets,labels:labels,};},_prepareOptions:function(datasetsCount){const options={maintainAspectRatio:false,scales:this._getScaleOptions(),legend:this._getLegendOptions(datasetsCount),tooltips:this._getTooltipOptions(),elements:this._getElementOptions(),};if(this._isRedirectionEnabled()){options.onClick=this._onGraphClicked.bind(this);}
return options;},_relabelling:function(label,originIndex){if(label.isNoData){return label[0];}
var i=this.state.comparisonFieldIndex;if(_.contains(['bar','line'],this.state.mode)&&i===0){return this.dateClasses.representative(label,originIndex)||'';}else if(this.state.mode==='pie'&&i===0){var labelCopy=label.slice(0);if(originIndex!==undefined){labelCopy.splice(i,1,this.dateClasses.representative(label[i],originIndex));}else{labelCopy.splice(i,1,this.dateClasses.dateClassMembers(label[i]));}
return labelCopy.join('/');}
return label.join('/')||_t('Total');},async _renderView(){if(this.chart){this.chart.destroy();}
this.$el.empty();if(!_.contains(CHART_TYPES,this.state.mode)){this.trigger_up('warning',{title:_t('Invalid mode for chart'),message:_t('Cannot render chart with mode : ')+this.state.mode});}
var dataPoints=this._filterDataPoints();dataPoints=this._sortDataPoints(dataPoints);if(this.isInDOM){this._renderTitle();if(this.state.mode==='pie'){const someNegative=dataPoints.some(dataPt=>dataPt.value<0);const somePositive=dataPoints.some(dataPt=>dataPt.value>0);if(someNegative&&somePositive){const context={title:_t("Invalid data"),description:[_t("Pie chart cannot mix positive and negative numbers. "),_t("Try to change your domain to only display positive results")].join("")};this._renderNoContentHelper(context);return;}}
if(this.state.isSample&&!this.isEmbedded){this._renderNoContentHelper();}
var $canvasContainer=$('<div/>',{class:'o_graph_canvas_container'});var $canvas=$('<canvas/>').attr('id',this.chartId);$canvasContainer.append($canvas);this.$el.append($canvasContainer);var i=this.state.comparisonFieldIndex;if(i===0){this.dateClasses=this._getDateClasses(dataPoints);}
if(this.state.mode==='bar'){this._renderBarChart(dataPoints);}else if(this.state.mode==='line'){this._renderLineChart(dataPoints);}else if(this.state.mode==='pie'){this._renderPieChart(dataPoints);}}},_renderBarChart:function(dataPoints){var self=this;var data=this._prepareData(dataPoints);data.datasets.forEach(function(dataset,index){dataset.stack=self.state.stacked?self.state.origins[dataset.originIndex]:undefined;var color=self._getColor(index);dataset.backgroundColor=color;});var options=this._prepareOptions(data.datasets.length);var ctx=document.getElementById(this.chartId);this.chart=new Chart(ctx,{type:'bar',data:data,options:options,});},_renderLineChart:function(dataPoints){var self=this;var data=this._prepareData(dataPoints);data.datasets.forEach(function(dataset,index){if(self.state.processedGroupBy.length<=1&&self.state.origins.length>1){if(dataset.originIndex===0){dataset.fill='origin';dataset.backgroundColor=hexToRGBA(COLORS[0],0.4);dataset.borderColor=hexToRGBA(COLORS[0],1);}else if(dataset.originIndex===1){dataset.borderColor=hexToRGBA(COLORS[1],1);}else{dataset.borderColor=self._getColor(index);}}else{dataset.borderColor=self._getColor(index);}
if(data.labels.length===1){dataset.data.unshift(undefined);}
dataset.pointBackgroundColor=dataset.borderColor;dataset.pointBorderColor='rgba(0,0,0,0.2)';});if(data.datasets.length===1){const dataset=data.datasets[0];dataset.fill='origin';dataset.backgroundColor=hexToRGBA(COLORS[0],0.4);}
data.labels=data.labels.length>1?data.labels:Array.prototype.concat.apply([],[[['']],data.labels,[['']]]);var options=this._prepareOptions(data.datasets.length);var ctx=document.getElementById(this.chartId);this.chart=new Chart(ctx,{type:'line',data:data,options:options,});},_renderPieChart:function(dataPoints){var self=this;var data={};var colors=[];const allZero=dataPoints.every(dataPt=>dataPt.value===0);if(allZero){data.labels=[NO_DATA];data.datasets=this.state.origins.map(function(origin){return{label:origin,data:[1],backgroundColor:['#d3d3d3'],};});}else{data=this._prepareData(dataPoints);colors=data.labels.map(function(label,index){return self._getColor(index);});data.datasets.forEach(function(dataset){dataset.backgroundColor=colors;dataset.borderColor='rgba(255,255,255,0.6)';});var representedOriginIndexes=data.datasets.map(function(dataset){return dataset.originIndex;});var addNoDataToLegend=false;var fakeData=(new Array(data.labels.length)).concat([1]);this.state.origins.forEach(function(origin,originIndex){if(!_.contains(representedOriginIndexes,originIndex)){data.datasets.splice(originIndex,0,{label:origin,data:fakeData,backgroundColor:colors.concat(['#d3d3d3']),});addNoDataToLegend=true;}});if(addNoDataToLegend){data.labels.push(NO_DATA);}}
var options=this._prepareOptions(data.datasets.length);var ctx=document.getElementById(this.chartId);this.chart=new Chart(ctx,{type:'pie',data:data,options:options,});},_renderTitle:function(){if(this.title){this.$el.prepend($('<label/>',{text:this.title,}));}},_shortenLabel:function(label){var groups=label.split("/");var shortLabel=groups.slice(0,3).join("/");if(shortLabel.length>30){shortLabel=shortLabel.slice(0,30)+'...';}else if(groups.length>3){shortLabel=shortLabel+'/...';}
return shortLabel;},_sortDataPoints(dataPoints){if(!Object.keys(this.state.timeRanges).length&&this.state.orderBy&&['bar','line'].includes(this.state.mode)&&this.state.groupBy.length){const groupByFieldName=this.state.groupBy[0].split(':')[0];const groupedByMany2One=this.fields[groupByFieldName].type==='many2one';const groupedDataPoints={};dataPoints.forEach(function(dataPoint){const key=groupedByMany2One?dataPoint.resId:dataPoint.labels[0];groupedDataPoints[key]=groupedDataPoints[key]||[];groupedDataPoints[key].push(dataPoint);});dataPoints=_.sortBy(groupedDataPoints,function(group){return group.reduce((sum,dataPoint)=>sum+dataPoint.value,0);});dataPoints=dataPoints.flat();if(this.state.orderBy==='desc'){dataPoints=dataPoints.reverse('value');}}
return dataPoints;},_onGraphClicked:function(ev){const activeElement=this.chart.getElementAtEvent(ev);if(activeElement.length===0){return;}
const domain=this.chart.data.datasets[activeElement[0]._datasetIndex].domain;if(!domain){return;}
this.trigger_up('open_view',{domain:domain[activeElement[0]._index],});},_onlegendTooltipHover:function(e,legendItem){e.target.style.cursor='pointer';if(legendItem.text===legendItem.fullText||this.$legendTooltip){return;}
const chartAreaLeft=this.chart.chartArea.left;const chartAreaRight=this.chart.chartArea.right;const rendererTop=this.$el[0].getBoundingClientRect().top;this.$legendTooltip=$('<div>',{class:"o_tooltip_legend",text:legendItem.fullText,css:{maxWidth:Math.floor((chartAreaRight-chartAreaLeft)/1.68)+'px',top:(e.clientY-rendererTop)+'px',}});const $container=this.$el.find('.o_graph_canvas_container');$container.append(this.$legendTooltip);this._fixTooltipLeftPosition(this.$legendTooltip[0],e.clientX);},_onLegendTootipLeave:function(e){e.target.style.cursor="";if(this.$legendTooltip){this.$legendTooltip.remove();this.$legendTooltip=null;}},});});;

/* /web/static/src/js/views/graph/graph_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.GraphView',function(require){"use strict";var AbstractView=require('web.AbstractView');var core=require('web.core');var GraphModel=require('web.GraphModel');var Controller=require('web.GraphController');var GraphRenderer=require('web.GraphRenderer');var _t=core._t;var _lt=core._lt;var searchUtils=require('web.searchUtils');var GROUPABLE_TYPES=searchUtils.GROUPABLE_TYPES;var GraphView=AbstractView.extend({display_name:_lt('Graph'),icon:'fa-bar-chart',jsLibs:['/web/static/lib/Chart/Chart.js',],config:_.extend({},AbstractView.prototype.config,{Model:GraphModel,Controller:Controller,Renderer:GraphRenderer,}),viewType:'graph',searchMenuTypes:['filter','groupBy','comparison','favorite'],init:function(viewInfo,params){this._super.apply(this,arguments);const additionalMeasures=params.additionalMeasures||[];let measure;const measures={};const measureStrings={};let groupBys=[];const groupableFields={};this.fields.__count__={string:_t("Count"),type:'integer'};this.arch.children.forEach(field=>{let fieldName=field.attrs.name;if(fieldName==="id"){return;}
const interval=field.attrs.interval;if(interval){fieldName=fieldName+':'+interval;}
if(field.attrs.type==='measure'){const{string}=this.fields[fieldName];measure=fieldName;measures[fieldName]={description:string,fieldName,groupNumber:0,isActive:false,itemType:'measure',};}else{groupBys.push(fieldName);}
if(field.attrs.string){measureStrings[fieldName]=field.attrs.string;}});for(const name in this.fields){const field=this.fields[name];if(name!=='id'&&field.store===true){if(['integer','float','monetary'].includes(field.type)||additionalMeasures.includes(name)){measures[name]={description:field.string,fieldName:name,groupNumber:0,isActive:false,itemType:'measure',};}
if(GROUPABLE_TYPES.includes(field.type)){groupableFields[name]=field;}}}
for(const name in measureStrings){if(measures[name]){measures[name].description=measureStrings[name];}}
this.arch.children.forEach(field=>{let fieldName=field.attrs.name;if(field.attrs.invisible&&py.eval(field.attrs.invisible)){groupBys=groupBys.filter(groupBy=>groupBy!==fieldName);if(fieldName in groupableFields){delete groupableFields[fieldName];}
if(!additionalMeasures.includes(fieldName)){delete measures[fieldName];}}});const sortedMeasures=Object.values(measures).sort((a,b)=>{const descA=a.description.toLowerCase();const descB=b.description.toLowerCase();return descA>descB?1:descA<descB?-1:0;});const countMeasure={description:_t("Count"),fieldName:'__count__',groupNumber:1,isActive:false,itemType:'measure',};this.controllerParams.withButtons=params.withButtons!==false;this.controllerParams.measures=[...sortedMeasures,countMeasure];this.controllerParams.groupableFields=groupableFields;this.controllerParams.title=params.title||this.arch.attrs.string||_t("Untitled");function _findView(views,viewType){const view=views.find(view=>{return view.type===viewType;});return[view?view.viewID:false,viewType];}
this.controllerParams.views=[_findView(params.actionViews,'list'),_findView(params.actionViews,'form'),];this.rendererParams.fields=this.fields;this.rendererParams.title=this.arch.attrs.title;this.rendererParams.disableLinking=!!JSON.parse(this.arch.attrs.disable_linking||'0');this.loadParams.mode=this.arch.attrs.type||'bar';this.loadParams.orderBy=this.arch.attrs.order;this.loadParams.measure=measure||'__count__';this.loadParams.groupBys=groupBys;this.loadParams.fields=this.fields;this.loadParams.comparisonDomain=params.comparisonDomain;this.loadParams.stacked=this.arch.attrs.stacked!=="False";},});return GraphView;});;

/* /web/static/src/js/views/kanban/kanban_column.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.KanbanColumn',function(require){"use strict";var config=require('web.config');var core=require('web.core');var session=require('web.session');var Dialog=require('web.Dialog');var KanbanRecord=require('web.KanbanRecord');var RecordQuickCreate=require('web.kanban_record_quick_create');var view_dialogs=require('web.view_dialogs');var viewUtils=require('web.viewUtils');var Widget=require('web.Widget');var KanbanColumnProgressBar=require('web.KanbanColumnProgressBar');var _t=core._t;var QWeb=core.qweb;var KanbanColumn=Widget.extend({template:'KanbanView.Group',custom_events:{cancel_quick_create:'_onCancelQuickCreate',quick_create_add_record:'_onQuickCreateAddRecord',tweak_column:'_onTweakColumn',tweak_column_records:'_onTweakColumnRecords',},events:{'click .o_column_edit':'_onEditColumn','click .o_column_delete':'_onDeleteColumn','click .o_kanban_quick_add':'_onAddQuickCreate','click .o_kanban_load_more':'_onLoadMore','click .o_kanban_toggle_fold':'_onToggleFold','click .o_column_archive_records':'_onArchiveRecords','click .o_column_unarchive_records':'_onUnarchiveRecords','click .o_kanban_config .dropdown-menu':'_onConfigDropdownClicked',},init:function(parent,data,options,recordOptions){this._super(parent);this.db_id=data.id;this.data_records=data.data;this.data=data;var value=data.value;this.id=data.res_id;this.folded=!data.isOpen;this.has_active_field='active'in data.fields;this.fields=data.fields;this.records=[];this.modelName=data.model;this.quick_create=options.quick_create;this.quickCreateView=options.quickCreateView;this.groupedBy=options.groupedBy;this.grouped_by_m2o=options.grouped_by_m2o;this.editable=options.editable;this.deletable=options.deletable;this.archivable=options.archivable;this.draggable=options.draggable;this.KanbanRecord=options.KanbanRecord||KanbanRecord;this.records_editable=options.records_editable;this.records_deletable=options.records_deletable;this.recordsDraggable=options.recordsDraggable;this.relation=options.relation;this.offset=0;this.remaining=data.count-this.data_records.length;this.canBeFolded=this.folded;if(options.hasProgressBar){this.barOptions={columnID:this.db_id,progressBarStates:options.progressBarStates,};}
this.record_options=_.clone(recordOptions);if(options.grouped_by_m2o||options.grouped_by_date){this.title=value?value:_t('Undefined');}else{this.title=value===undefined?_t('Undefined'):value;}
if(options.group_by_tooltip){this.tooltipInfo=_.compact(_.map(options.group_by_tooltip,function(help,field){help=help?help+"</br>":'';return(data.tooltipData&&data.tooltipData[field]&&"<div>"+help+data.tooltipData[field]+"</div>")||'';}));this.tooltipInfo=this.tooltipInfo.join("<div class='dropdown-divider' role='separator' />");}},start:function(){var self=this;var defs=[this._super.apply(this,arguments)];this.$header=this.$('.o_kanban_header');for(var i=0;i<this.data_records.length;i++){defs.push(this._addRecord(this.data_records[i]));}
if(this.recordsDraggable){this.$el.sortable({connectWith:'.o_kanban_group',containment:this.draggable?false:'parent',revert:0,delay:0,items:'> .o_kanban_record:not(.o_updating)',cursor:'move',over:function(){self.$el.addClass('o_kanban_hover');},out:function(){self.$el.removeClass('o_kanban_hover');},start:function(event,ui){ui.item.addClass('o_currently_dragged');},stop:function(event,ui){var item=ui.item;setTimeout(function(){item.removeClass('o_currently_dragged');});},update:function(event,ui){var record=ui.item.data('record');var index=self.records.indexOf(record);record.$el.removeAttr('style');if(index>=0){if($.contains(self.$el[0],record.$el[0])){self.trigger_up('kanban_column_resequence',{ids:self._getIDs()});}}else{ui.item.addClass('o_updating');self.trigger_up('kanban_column_add_record',{record:record,ids:self._getIDs()});}}});}
this.$el.click(function(event){if(self.folded){self._onToggleFold(event);}});if(this.barOptions){this.$el.addClass('o_kanban_has_progressbar');this.progressBar=new KanbanColumnProgressBar(this,this.barOptions,this.data);defs.push(this.progressBar.appendTo(this.$header));}
var title=this.folded?this.title+' ('+this.data.count+')':this.title;this.$header.find('.o_column_title').text(title);this.$el.toggleClass('o_column_folded',this.canBeFolded);if(this.tooltipInfo){this.$header.find('.o_kanban_header_title').tooltip({}).attr('data-original-title',this.tooltipInfo);}
if(!this.remaining){this.$('.o_kanban_load_more').remove();}else{this.$('.o_kanban_load_more').html(QWeb.render('KanbanView.LoadMore',{widget:this}));}
return Promise.all(defs);},on_attach_callback:function(){_.invoke(this.records,'on_attach_callback');if(this.quickCreateWidget){this.quickCreateWidget.on_attach_callback();}},addQuickCreate:async function(){if(this.folded){this.trigger_up('column_toggle_fold',{openQuickCreate:true,});return;}
if(this.quickCreateWidget){return Promise.reject();}
this.trigger_up('close_quick_create');var context=this.data.getContext();context['default_'+this.groupedBy]=viewUtils.getGroupValue(this.data,this.groupedBy);this.quickCreateWidget=new RecordQuickCreate(this,{context:context,formViewRef:this.quickCreateView,model:this.modelName,});await this.quickCreateWidget.appendTo(document.createDocumentFragment());this.trigger_up('start_quick_create');this.quickCreateWidget.$el.insertAfter(this.$header);this.quickCreateWidget.on_attach_callback();},cancelQuickCreate:function(){if(this.quickCreateWidget){this.quickCreateWidget.cancel();}},isEmpty:function(){return!this.records.length;},_addRecord:function(recordState,options){var record=new this.KanbanRecord(this,recordState,this.record_options);this.records.push(record);if(options&&options.position==='before'){return record.insertAfter(this.quickCreateWidget?this.quickCreateWidget.$el:this.$header);}else{var $load_more=this.$('.o_kanban_load_more');if($load_more.length){return record.insertBefore($load_more);}else{return record.appendTo(this.$el);}}},_cancelQuickCreate:function(){this.quickCreateWidget.destroy();this.quickCreateWidget=undefined;},_getIDs:function(){var ids=[];this.$('.o_kanban_record').each(function(index,r){ids.push($(r).data('record').id);});return ids;},_onAddQuickCreate:function(){this.trigger_up('add_quick_create',{groupId:this.db_id});},_onCancelQuickCreate:function(){this._cancelQuickCreate();},_onConfigDropdownClicked(ev){ev.stopPropagation();},_onDeleteColumn:function(event){event.preventDefault();var buttons=[{text:_t("Ok"),classes:'btn-primary',close:true,click:this.trigger_up.bind(this,'kanban_column_delete'),},{text:_t("Cancel"),close:true}];new Dialog(this,{size:'medium',buttons:buttons,$content:$('<div>',{text:_t("Are you sure that you want to remove this column ?")}),}).open();},_onEditColumn:function(event){event.preventDefault();new view_dialogs.FormViewDialog(this,{res_model:this.relation,res_id:this.id,context:session.user_context,title:_t("Edit Column"),on_saved:this.trigger_up.bind(this,'reload'),}).open();},_onLoadMore:function(event){event.preventDefault();this.trigger_up('kanban_load_more');},_onQuickCreateAddRecord:function(event){this.trigger_up('quick_create_record',event.data);},_onToggleFold:function(event){event.preventDefault();this.trigger_up('column_toggle_fold');},_onTweakColumn:function(ev){ev.data.callback(this.$el);},_onTweakColumnRecords:function(ev){_.each(this.records,function(record){ev.data.callback(record.$el,record.state.data);});},_onArchiveRecords:function(event){event.preventDefault();Dialog.confirm(this,_t("Are you sure that you want to archive all the records from this column?"),{confirm_callback:this.trigger_up.bind(this,'kanban_column_records_toggle_active',{archive:true,}),});},_onUnarchiveRecords:function(event){event.preventDefault();this.trigger_up('kanban_column_records_toggle_active',{archive:false,});}});return KanbanColumn;});;

/* /web/static/src/js/views/kanban/kanban_column_progressbar.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.KanbanColumnProgressBar',function(require){'use strict';const core=require('web.core');var session=require('web.session');var utils=require('web.utils');var Widget=require('web.Widget');const _t=core._t;var KanbanColumnProgressBar=Widget.extend({template:'KanbanView.ColumnProgressBar',events:{'click .o_kanban_counter_progress':'_onProgressBarParentClick','click .progress-bar':'_onProgressBarClick',},ANIMATE:true,init:function(parent,options,columnState){this._super.apply(this,arguments);this.columnID=options.columnID;this.columnState=columnState;this.fieldName=columnState.progressBarValues.field;this.colors=_.extend({},columnState.progressBarValues.colors,{__false:'muted',});this.sumField=columnState.progressBarValues.sum_field;var state=options.progressBarStates[this.columnID];if(state){this.groupCount=state.groupCount;this.subgroupCounts=state.subgroupCounts;this.totalCounterValue=state.totalCounterValue;this.activeFilter=state.activeFilter;}
var sumFieldInfo=this.sumField&&columnState.fieldsInfo.kanban[this.sumField];var currencyField=sumFieldInfo&&sumFieldInfo.options&&sumFieldInfo.options.currency_field;if(currencyField&&columnState.data.length){this.currency=session.currencies[columnState.data[0].data[currencyField].res_id];}},start:function(){var self=this;this.$bars={};_.each(this.colors,function(val,key){self.$bars[key]=self.$(`.progress-bar[data-filter=${key}]`);});this.$counter=this.$('.o_kanban_counter_side');this.$number=this.$counter.find('b');if(this.currency){var $currency=$('<span/>',{text:this.currency.symbol,});if(this.currency.position==='before'){$currency.prependTo(this.$counter);}else{$currency.appendTo(this.$counter);}}
return this._super.apply(this,arguments).then(function(){self.computeCounters();self._notifyState();self._render();});},computeCounters(){const subgroupCounts={};let allSubgroupCount=0;for(const key of Object.keys(this.colors)){const subgroupCount=this.columnState.progressBarValues.counts[key]||0;if(this.activeFilter===key&&subgroupCount===0){this.activeFilter=false;}
subgroupCounts[key]=subgroupCount;allSubgroupCount+=subgroupCount;};subgroupCounts.__false=this.columnState.count-allSubgroupCount;this.groupCount=this.columnState.count;this.subgroupCounts=subgroupCounts;this.prevTotalCounterValue=this.totalCounterValue;this.totalCounterValue=this.sumField?(this.columnState.aggregateValues[this.sumField]||0):this.columnState.count;},_render:function(){var self=this;this.trigger_up('tweak_column',{callback:function($el){$el.removeClass('o_kanban_group_show');_.each(self.colors,function(val,key){$el.removeClass('o_kanban_group_show_'+val);});if(self.activeFilter){$el.addClass('o_kanban_group_show o_kanban_group_show_'+self.colors[self.activeFilter]);}},});this.trigger_up('tweak_column_records',{callback:function($el,recordData){var categoryValue=recordData[self.fieldName]?recordData[self.fieldName]:'__false';_.each(self.colors,function(val,key){$el.removeClass('oe_kanban_card_'+val);});if(self.colors[categoryValue]){$el.addClass('oe_kanban_card_'+self.colors[categoryValue]);}},});var barNumber=0;var barMinWidth=6;const selection=self.columnState.fields[self.fieldName].selection;_.each(self.colors,function(val,key){var $bar=self.$bars[key];var count=self.subgroupCounts&&self.subgroupCounts[key]||0;if(!$bar){return;}
let value;if(selection){const option=selection.find(option=>option[0]===key);value=option&&option[1]||_t('Other');}else{value=key;}
$bar.attr('data-original-title',count+' '+value);$bar.tooltip({delay:0,trigger:'hover',});$bar.toggleClass('progress-bar-animated progress-bar-striped',key===self.activeFilter);$bar.removeClass('o_bar_has_records transition-off');window.getComputedStyle($bar[0]).getPropertyValue('width');if(count>0){$bar.addClass('o_bar_has_records');var maxWidth=100-barMinWidth*barNumber;self.$('.progress-bar.o_bar_has_records').css('max-width',maxWidth+'%');$bar.css('width',(count*100/self.groupCount)+'%');barNumber++;$bar.attr('aria-valuemin',0);$bar.attr('aria-valuemax',self.groupCount);$bar.attr('aria-valuenow',count);}else{$bar.css('width','');}});this.$('.progress-bar').css('min-width','');this.$('.progress-bar.o_bar_has_records').css('min-width',barMinWidth+'%');var start=this.prevTotalCounterValue;var end=this.totalCounterValue;if(this.activeFilter){if(this.sumField){end=0;_.each(self.columnState.data,function(record){var recordData=record.data;if(self.activeFilter===recordData[self.fieldName]||(self.activeFilter==='__false'&&!recordData[self.fieldName])){end+=parseFloat(recordData[self.sumField]);}});}else{end=this.subgroupCounts[this.activeFilter];}}
this.prevTotalCounterValue=end;var animationClass=start>999?'o_kanban_grow':'o_kanban_grow_huge';if(start!==undefined&&(end>start||this.activeFilter)&&this.ANIMATE){$({currentValue:start}).animate({currentValue:end},{duration:1000,start:function(){self.$counter.addClass(animationClass);},step:function(){self.$number.html(_getCounterHTML(this.currentValue));},complete:function(){self.$number.html(_getCounterHTML(this.currentValue));self.$counter.removeClass(animationClass);},});}else{this.$number.html(_getCounterHTML(end));}
function _getCounterHTML(value){return utils.human_number(value,0,3);}},_notifyState:function(){this.trigger_up('set_progress_bar_state',{columnID:this.columnID,values:{groupCount:this.groupCount,subgroupCounts:this.subgroupCounts,totalCounterValue:this.totalCounterValue,activeFilter:this.activeFilter,},});},_onProgressBarClick:function(ev){this.$clickedBar=$(ev.currentTarget);var filter=this.$clickedBar.data('filter');this.activeFilter=(this.activeFilter===filter?false:filter);this._notifyState();this._render();},_onProgressBarParentClick:function(ev){if(ev.target!==ev.currentTarget){return;}
this.activeFilter=false;this._notifyState();this._render();},});return KanbanColumnProgressBar;});;

/* /web/static/src/js/views/kanban/kanban_column_quick_create.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.kanban_column_quick_create',function(require){"use strict";var core=require('web.core');var Dialog=require('web.Dialog');var Widget=require('web.Widget');var _t=core._t;var QWeb=core.qweb;var ColumnQuickCreate=Widget.extend({template:'KanbanView.ColumnQuickCreate',events:{'click .o_quick_create_folded':'_onUnfold','click .o_kanban_add':'_onAddClicked','click .o_kanban_examples':'_onShowExamples','keydown':'_onKeydown','keypress input':'_onKeypress','blur input':'_onInputBlur','focus input':'_onInputFocus',},init:function(parent,options){this._super.apply(this,arguments);this.applyExamplesText=options.applyExampleText||_t("Use This For My Kanban");this.examples=options.examples;this.folded=true;this.isMobile=false;},start:function(){this.$quickCreateFolded=this.$('.o_quick_create_folded');this.$quickCreateUnfolded=this.$('.o_quick_create_unfolded');this.$input=this.$('input');core.bus.on('click',this,this._onWindowClicked);this._update();return this._super.apply(this,arguments);},on_attach_callback:function(){if(!this.folded){this.$input.focus();}},toggleFold:function(){this.folded=!this.folded;this._update();if(!this.folded){this.$input.focus();this.trigger_up('scrollTo',{selector:'.o_column_quick_create'});}},_add:function(){var value=this.$input.val().trim();if(!value.length){this._cancel();return;}
this.$input.val('');this.trigger_up('quick_create_add_column',{value:value});this.$input.focus();},_cancel:function(){if(!this.folded){this.$input.val('');this.folded=true;this._update();}},_update:function(){this.$quickCreateFolded.toggle(this.folded);this.$quickCreateUnfolded.toggle(!this.folded);this.trigger_up('quick_create_column_updated');},_onAddClicked:function(event){event.stopPropagation();this._add();},_onInputBlur:function(){this.$('.o_discard_msg').hide();},_onInputFocus:function(){this.$('.o_discard_msg').show();},_onKeydown:function(event){if(event.keyCode===$.ui.keyCode.ESCAPE){this._cancel();}},_onKeypress:function(event){if(event.keyCode===$.ui.keyCode.ENTER){this._add();}},_onShowExamples:function(){var self=this;var dialog=new Dialog(this,{$content:$(QWeb.render('KanbanView.ExamplesDialog',{examples:this.examples,})),buttons:[{classes:'btn-primary float-right',text:this.applyExamplesText,close:true,click:function(){const activeExample=self.examples[this.$('.nav-link.active').data("exampleIndex")];activeExample.columns.forEach(column=>{self.trigger_up('quick_create_add_column',{value:column.toString(),foldQuickCreate:true});});}},{classes:'btn-secondary float-right',close:true,text:_t('Close'),}],size:"large",title:"Kanban Examples",}).open();dialog.on('closed',this,function(){self.$input.focus();});},_onUnfold:function(){if(this.folded){this.toggleFold();}},_onWindowClicked:function(event){if(!document.contains(this.el)){return;}
if($(event.target).closest('.modal').length){return;}
if(this.el.contains(event.target)){return;}
this._cancel();},});return ColumnQuickCreate;});;

/* /web/static/src/js/views/kanban/kanban_model.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.KanbanModel',function(require){"use strict";var BasicModel=require('web.BasicModel');var viewUtils=require('web.viewUtils');var KanbanModel=BasicModel.extend({addRecordToGroup:function(groupID,resId){var self=this;var group=this.localData[groupID];var new_record=this._makeDataPoint({res_id:resId,modelName:group.model,fields:group.fields,fieldsInfo:group.fieldsInfo,viewType:group.viewType,parentID:groupID,});var def=this._fetchRecord(new_record).then(function(result){group.data.unshift(new_record.id);group.res_ids.unshift(resId);group.count++;self.localData[group.parentID].count++;self._updateParentResIDs(group);return result.id;});return this._reloadProgressBarGroupFromRecord(new_record.id,def);},createGroup:function(name,parentID){var self=this;var parent=this.localData[parentID];var groupBy=parent.groupedBy[0];var groupByField=parent.fields[groupBy];if(!groupByField||groupByField.type!=='many2one'){return Promise.reject();}
return this._rpc({model:groupByField.relation,method:'name_create',args:[name],context:parent.context,}).then(function(result){const createGroupDataPoint=(model,parent)=>{const newGroup=model._makeDataPoint({modelName:parent.model,context:parent.context,domain:parent.domain.concat([[groupBy,"=",result[0]]]),fields:parent.fields,fieldsInfo:parent.fieldsInfo,isOpen:true,limit:parent.limit,parentID:parent.id,openGroupByDefault:true,orderedBy:parent.orderedBy,value:result,viewType:parent.viewType,});if(parent.progressBar){newGroup.progressBarValues=_.extend({counts:{},},parent.progressBar);}
return newGroup;};const newGroup=createGroupDataPoint(self,parent);parent.data.push(newGroup.id);if(self.isInSampleMode()){const sampleParent=self.sampleModel.localData[parentID];const newSampleGroup=createGroupDataPoint(self.sampleModel,sampleParent);sampleParent.data.push(newSampleGroup.id);}
return newGroup.id;});},createRecordInGroup:function(groupID,values){var self=this;var group=this.localData[groupID];var context=this._getContext(group);var parent=this.localData[group.parentID];var groupedBy=parent.groupedBy;context['default_'+groupedBy]=viewUtils.getGroupValue(group,groupedBy);var def;if(Object.keys(values).length===1&&'display_name'in values){def=this._rpc({model:parent.model,method:'name_create',args:[values.display_name],context:context,}).then(function(records){return records[0];});}else{def=this._rpc({model:parent.model,method:'create',args:[values],context:context,});}
return def.then(function(resID){return self.addRecordToGroup(group.id,resID);});},__get:function(){var result=this._super.apply(this,arguments);var dp=result&&this.localData[result.id];if(dp){if(dp.tooltipData){result.tooltipData=$.extend(true,{},dp.tooltipData);}
if(dp.progressBarValues){result.progressBarValues=$.extend(true,{},dp.progressBarValues);}
if(dp.fields[dp.groupedBy[0]]){var groupedByM2O=dp.fields[dp.groupedBy[0]].type==='many2one';result.isGroupedByM2ONoColumn=!dp.data.length&&groupedByM2O;}else{result.isGroupedByM2ONoColumn=false;}}
return result;},getColumn:function(id){var element=this.localData[id];if(element){return this.get(element.parentID);}
return null;},__load:function(params){this.defaultGroupedBy=params.groupBy||[];params.groupedBy=(params.groupedBy&&params.groupedBy.length)?params.groupedBy:this.defaultGroupedBy;return this._super(params);},loadMore:function(groupID){var group=this.localData[groupID];var offset=group.loadMoreOffset+group.limit;return this.reload(group.id,{loadMoreOffset:offset,});},moveRecord:function(recordID,groupID,parentID){var self=this;var parent=this.localData[parentID];var new_group=this.localData[groupID];var changes={};var groupedFieldName=parent.groupedBy[0];var groupedField=parent.fields[groupedFieldName];if(groupedField.type==='many2one'){changes[groupedFieldName]={id:new_group.res_id,display_name:new_group.value,};}else if(groupedField.type==='selection'){var value=_.findWhere(groupedField.selection,{1:new_group.value});changes[groupedFieldName]=value&&value[0]||false;}else{changes[groupedFieldName]=new_group.value;}
var record=self.localData[recordID];var resID=record.res_id;var old_group;for(var i=0;i<parent.data.length;i++){old_group=self.localData[parent.data[i]];var index=_.indexOf(old_group.data,recordID);if(index>=0){old_group.data.splice(index,1);old_group.count--;old_group.res_ids=_.without(old_group.res_ids,resID);self._updateParentResIDs(old_group);break;}}
new_group.data.push(recordID);new_group.res_ids.push(resID);new_group.count++;return this.notifyChanges(recordID,changes).then(function(){return self.save(recordID);}).then(function(){record.parentID=new_group.id;return[old_group.id,new_group.id];});},reload:function(id,options){if(options&&options.groupBy&&!options.groupBy.length){options.groupBy=this.defaultGroupedBy;}
return this._super(id,options);},__reload:function(id,options){var def=this._super(id,options);if(options&&options.loadMoreOffset){return def;}
return this._reloadProgressBarGroupFromRecord(id,def);},save:function(recordID){var def=this._super.apply(this,arguments);return this._reloadProgressBarGroupFromRecord(recordID,def);},_makeDataPoint:function(params){var dataPoint=this._super.apply(this,arguments);if(params.progressBar){dataPoint.progressBar=params.progressBar;}
return dataPoint;},_load:function(dataPoint,options){if(dataPoint.groupedBy.length&&dataPoint.progressBar){return this._readProgressBarGroup(dataPoint,options);}
return this._super.apply(this,arguments);},_readGroup:function(list){var self=this;if(list.groupedBy.length>1){list.groupedBy=[list.groupedBy[0]];}
return this._super.apply(this,arguments).then(function(result){return self._readTooltipFields(list).then(_.constant(result));});},_readProgressBarGroup:function(list,options){var self=this;var groupsDef=this._readGroup(list,options);var progressBarDef=this._rpc({model:list.model,method:'read_progress_bar',kwargs:{domain:list.domain,group_by:list.groupedBy[0],progress_bar:list.progressBar,context:list.context,},});return Promise.all([groupsDef,progressBarDef]).then(function(results){var data=results[1];_.each(list.data,function(groupID){var group=self.localData[groupID];group.progressBarValues=_.extend({counts:data[group.value]||{},},list.progressBar);});return list;});},_readTooltipFields:function(list){var self=this;var groupedByField=list.fields[list.groupedBy[0].split(':')[0]];if(groupedByField.type!=='many2one'){return Promise.resolve();}
var groupIds=_.reduce(list.data,function(groupIds,id){var res_id=self.get(id,{raw:true}).res_id;if(res_id){groupIds.push(res_id);}
return groupIds;},[]);var tooltipFields=[];var groupedByFieldInfo=list.fieldsInfo.kanban[list.groupedBy[0]];if(groupedByFieldInfo&&groupedByFieldInfo.options){tooltipFields=Object.keys(groupedByFieldInfo.options.group_by_tooltip||{});}
if(groupIds.length&&tooltipFields.length){var fieldNames=_.union(['display_name'],tooltipFields);return this._rpc({model:groupedByField.relation,method:'read',args:[groupIds,fieldNames],context:list.context,}).then(function(result){_.each(list.data,function(id){var dp=self.localData[id];dp.tooltipData=_.findWhere(result,{id:dp.res_id});});});}
return Promise.resolve();},_reloadProgressBarGroupFromRecord:function(recordID,def){var element=this.localData[recordID];if(element.type==='list'&&!element.parentID){return def;}
var self=this;while(element){if(element.progressBar){return def.then(function(data){return self._load(element,{keepEmptyGroups:true,onlyGroups:true,}).then(function(){return data;});});}
element=this.localData[element.parentID];}
return def;},});return KanbanModel;});;

/* /web/static/src/js/views/kanban/kanban_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.KanbanController',function(require){"use strict";var BasicController=require('web.BasicController');var Context=require('web.Context');var core=require('web.core');var Dialog=require('web.Dialog');var Domain=require('web.Domain');var view_dialogs=require('web.view_dialogs');var viewUtils=require('web.viewUtils');var _t=core._t;var qweb=core.qweb;var KanbanController=BasicController.extend({buttons_template:'KanbanView.buttons',custom_events:_.extend({},BasicController.prototype.custom_events,{add_quick_create:'_onAddQuickCreate',quick_create_add_column:'_onAddColumn',quick_create_record:'_onQuickCreateRecord',resequence_columns:'_onResequenceColumn',button_clicked:'_onButtonClicked',kanban_record_delete:'_onRecordDelete',kanban_record_update:'_onUpdateRecord',kanban_column_delete:'_onDeleteColumn',kanban_column_add_record:'_onAddRecordToColumn',kanban_column_resequence:'_onColumnResequence',kanban_load_more:'_onLoadMore',column_toggle_fold:'_onToggleColumn',kanban_column_records_toggle_active:'_onToggleActiveRecords',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.on_create=params.on_create;this.hasButtons=params.hasButtons;this.quickCreateEnabled=params.quickCreateEnabled;},renderButtons:function($node){if(!this.hasButtons||!this.is_action_enabled('create')){return;}
this.$buttons=$(qweb.render(this.buttons_template,{btnClass:'btn-primary',widget:this,}));this.$buttons.on('click','button.o-kanban-button-new',this._onButtonNew.bind(this));this.$buttons.on('keydown',this._onButtonsKeyDown.bind(this));if($node){this.$buttons.appendTo($node);}},updateButtons:function(){if(!this.$buttons){return;}
var state=this.model.get(this.handle,{raw:true});var createHidden=this.is_action_enabled('group_create')&&state.isGroupedByM2ONoColumn;this.$buttons.find('.o-kanban-button-new').toggleClass('o_hidden',createHidden);},_addQuickCreate(groupId){this._removeSampleData(async()=>{await this.update({shouldUpdateSearchComponents:false},{reload:false});return this.renderer.addQuickCreate(groupId);});},_confirmSave:function(id){var data=this.model.get(this.handle,{raw:true});var grouped=data.groupedBy.length;if(grouped){var columnState=this.model.getColumn(id);return this.renderer.updateColumn(columnState.id,columnState);}
return this.renderer.updateRecord(this.model.get(id));},_getPagingInfo:function(state){if(!(state.count&&!state.groupedBy.length)){return null;}
return this._super(...arguments);},_reloadAfterButtonClick:function(kanbanRecord,params){var self=this;var recordModel=this.model.localData[params.record.id];var group=this.model.localData[recordModel.parentID];var parent=this.model.localData[group.parentID];this.model.reload(params.record.id).then(function(db_id){var data=self.model.get(db_id);kanbanRecord.update(data);var domain=(parent?parent.domain:group.domain)||[];var domInData=_.every(domain,function(d){return d[0]in data.data;});var activeInDomain=_.pluck(domain,0).indexOf('active')!==-1;var activeInData='active'in data.data;if(domInData&&!activeInDomain&&activeInData){domain=domain.concat([['active','=',true]]);}else if(!domInData&&!activeInDomain&&activeInData){domain=[['active','=',true]];}
try{var visible=new Domain(domain).compute(data.evalContext);}catch(e){return;}
if(!visible){kanbanRecord.destroy();}});},_resequenceColumns:function(ids){var state=this.model.get(this.handle,{raw:true});var model=state.fields[state.groupedBy[0]].relation;return this.model.resequence(model,ids,this.handle);},_resequenceRecords:function(column_id,ids){var self=this;return this.model.resequence(this.modelName,ids,column_id);},_shouldBounceOnClick(element){const state=this.model.get(this.handle,{raw:true});if(!state.count||state.isSample){const classesList=['o_kanban_view','o_kanban_group','o_kanban_header','o_column_quick_create','o_view_nocontent_smiling_face',];return classesList.some(c=>element.classList.contains(c));}
return false;},_onAddColumn:function(ev){var self=this;this.mutex.exec(function(){return self.model.createGroup(ev.data.value,self.handle).then(function(){var state=self.model.get(self.handle,{raw:true});var ids=_.pluck(state.data,'res_id').filter(_.isNumber);return self._resequenceColumns(ids);}).then(function(){return self.update({},{reload:false});}).then(function(){let quickCreateFolded=self.renderer.quickCreate.folded;if(ev.data.foldQuickCreate?!quickCreateFolded:quickCreateFolded){self.renderer.quickCreateToggleFold();}
self.renderer.trigger_up("quick_create_column_created");});});},_onAddRecordToColumn:function(ev){var self=this;var record=ev.data.record;var column=ev.target;this.alive(this.model.moveRecord(record.db_id,column.db_id,this.handle)).then(function(column_db_ids){return self._resequenceRecords(column.db_id,ev.data.ids).then(function(){_.each(column_db_ids,function(db_id){var data=self.model.get(db_id);self.renderer.updateColumn(db_id,data);});});}).guardedCatch(this.reload.bind(this));},_onAddQuickCreate(ev){ev.stopPropagation();this._addQuickCreate(ev.data.groupId);},_onButtonClicked:function(ev){var self=this;ev.stopPropagation();var attrs=ev.data.attrs;var record=ev.data.record;var def=Promise.resolve();if(attrs.context){attrs.context=new Context(attrs.context).set_eval_context({active_id:record.res_id,active_ids:[record.res_id],active_model:record.model,});}
if(attrs.confirm){def=new Promise(function(resolve,reject){Dialog.confirm(this,attrs.confirm,{confirm_callback:resolve,cancel_callback:reject,}).on("closed",null,reject);});}
def.then(function(){self.trigger_up('execute_action',{action_data:attrs,env:{context:record.getContext(),currentID:record.res_id,model:record.model,resIDs:record.res_ids,},on_closed:self._reloadAfterButtonClick.bind(self,ev.target,ev.data),});});},_onButtonNew:function(){var state=this.model.get(this.handle,{raw:true});var quickCreateEnabled=this.quickCreateEnabled&&viewUtils.isQuickCreateEnabled(state);if(this.on_create==='quick_create'&&quickCreateEnabled&&state.data.length){this.mutex.getUnlockedDef().then(this._addQuickCreate.bind(this,null));}else if(this.on_create&&this.on_create!=='quick_create'){this.do_action(this.on_create,{on_close:this.reload.bind(this,{}),additional_context:state.context,});}else{this.trigger_up('switch_view',{view_type:'form',res_id:undefined});}},_onButtonsKeyDown:function(ev){switch(ev.keyCode){case $.ui.keyCode.DOWN:this._giveFocus();}},_onColumnResequence:function(ev){this._resequenceRecords(ev.target.db_id,ev.data.ids);},_onDeleteColumn:function(ev){var column=ev.target;var state=this.model.get(this.handle,{raw:true});var relatedModelName=state.fields[state.groupedBy[0]].relation;this.model.deleteRecords([column.db_id],relatedModelName).then(this.update.bind(this,{},{}));},_onLoadMore:function(ev){var self=this;var column=ev.target;this.model.loadMore(column.db_id).then(function(db_id){var data=self.model.get(db_id);self.renderer.updateColumn(db_id,data);});},_onQuickCreateRecord:function(ev){var self=this;var values=ev.data.values;var column=ev.target;var onFailure=ev.data.onFailure||function(){};var update=function(db_id){var columnState=self.model.getColumn(db_id);var state=self.model.get(self.handle);return self.renderer.updateColumn(columnState.id,columnState,{openQuickCreate:true,state:state}).then(function(){if(ev.data.openRecord){self.trigger_up('open_record',{id:db_id,mode:'edit'});}});};this.model.createRecordInGroup(column.db_id,values).then(update).guardedCatch(function(reason){reason.event.preventDefault();var columnState=self.model.get(column.db_id,{raw:true});var context=columnState.getContext();var state=self.model.get(self.handle,{raw:true});var groupedBy=state.groupedBy[0];context['default_'+groupedBy]=viewUtils.getGroupValue(columnState,groupedBy);new view_dialogs.FormViewDialog(self,{res_model:state.model,context:_.extend({default_name:values.name||values.display_name},context),title:_t("Create"),disable_multiple_selection:true,on_saved:function(record){self.model.addRecordToGroup(column.db_id,record.res_id).then(update);},}).open().opened(onFailure);});},_onRecordDelete:function(ev){this._deleteRecords([ev.data.id]);},_onResequenceColumn:function(ev){var self=this;this._resequenceColumns(ev.data.ids);},_onToggleColumn:function(ev){var self=this;const columnID=ev.target.db_id||ev.data.db_id;this.model.toggleGroup(columnID).then(function(db_id){var data=self.model.get(db_id);var options={openQuickCreate:!!ev.data.openQuickCreate,};return self.renderer.updateColumn(db_id,data,options);}).then(function(){if(ev.data.onSuccess){ev.data.onSuccess();}});},_onUpdateRecord:function(ev){var onSuccess=ev.data.onSuccess;delete ev.data.onSuccess;var changes=_.clone(ev.data);ev.data.force_save=true;this._applyChanges(ev.target.db_id,changes,ev).then(onSuccess);},_onToggleActiveRecords:function(ev){var self=this;var archive=ev.data.archive;var column=ev.target;var recordIds=_.pluck(column.records,'id');if(recordIds.length){var prom=archive?this.model.actionArchive(recordIds,column.db_id):this.model.actionUnarchive(recordIds,column.db_id);prom.then(function(dbID){var data=self.model.get(dbID);if(data){self.model.reload(self.handle).then(function(){const state=self.model.get(self.handle);self.renderer.updateColumn(dbID,data,{state});});}});}},});return KanbanController;});;

/* /web/static/src/js/views/kanban/kanban_examples_registry.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.kanban_examples_registry',function(require){"use strict";var Registry=require('web.Registry');return new Registry();});;

/* /web/static/src/js/views/kanban/kanban_record.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.KanbanRecord',function(require){"use strict";var config=require('web.config');var core=require('web.core');var Domain=require('web.Domain');var Dialog=require('web.Dialog');var field_utils=require('web.field_utils');const FieldWrapper=require('web.FieldWrapper');var utils=require('web.utils');var Widget=require('web.Widget');var widgetRegistry=require('web.widget_registry');var _t=core._t;var QWeb=core.qweb;var KANBAN_RECORD_COLORS=require('web.basic_fields').FieldColorPicker.prototype.RECORD_COLORS;var NB_KANBAN_RECORD_COLORS=KANBAN_RECORD_COLORS.length;var KanbanRecord=Widget.extend({events:{'click .oe_kanban_action':'_onKanbanActionClicked','click .o_kanban_manage_toggle_button':'_onManageTogglerClicked',},init:function(parent,state,options){this._super(parent);this.fields=state.fields;this.fieldsInfo=state.fieldsInfo.kanban;this.modelName=state.model;this.options=options;this.editable=options.editable;this.deletable=options.deletable;this.read_only_mode=options.read_only_mode;this.selectionMode=options.selectionMode;this.qweb=options.qweb;this.subWidgets={};this._setState(state);this._onKanbanActionClicked=_.debounce(this._onKanbanActionClicked,300,true);},start:function(){return Promise.all([this._super.apply(this,arguments),this._render()]);},on_attach_callback:function(){this.isInDOM=true;_.invoke(this.subWidgets,'on_attach_callback');},on_detach_callback:function(){this.isInDOM=false;_.invoke(this.subWidgets,'on_detach_callback');},update:function(state){_.invoke(_.pluck(this.subWidgets,'$el'),'detach');this._setState(state);return this._render();},_attachTooltip:function(){var self=this;this.$('[tooltip]').each(function(){var $el=$(this);var tooltip=$el.attr('tooltip');if(tooltip){$el.tooltip({title:self.qweb.render(tooltip,self.qweb_context)});}});},_computeDomain:function(d){return new Domain(d).compute(this.state.evalContext);},_getColorClassname:function(variable){var color=this._getColorID(variable);return'oe_kanban_color_'+color;},_getColorID:function(variable){if(typeof variable==='number'){return Math.round(variable)%NB_KANBAN_RECORD_COLORS;}
if(typeof variable==='string'){var index=0;for(var i=0;i<variable.length;i++){index+=variable.charCodeAt(i);}
return index%NB_KANBAN_RECORD_COLORS;}
return 0;},_getColorname:function(variable){var colorID=this._getColorID(variable);return KANBAN_RECORD_COLORS[colorID];},file_type_magic_word:{'/':'jpg','R':'gif','i':'png','P':'svg+xml',},_getImageURL:function(model,field,id,placeholder){id=(_.isArray(id)?id[0]:id)||null;var isCurrentRecord=this.modelName===model&&this.recordData.id===id;var url;if(isCurrentRecord&&this.record[field]&&this.record[field].raw_value&&!utils.is_bin_size(this.record[field].raw_value)){url='data:image/'+this.file_type_magic_word[this.record[field].raw_value[0]]+';base64,'+this.record[field].raw_value;}else if(placeholder&&(!model||!field||!id||(isCurrentRecord&&this.record[field]&&!this.record[field].raw_value))){url=placeholder;}else{var session=this.getSession();var params={model:model,field:field,id:id};if(isCurrentRecord){params.unique=this.record.__last_update&&this.record.__last_update.value.replace(/[^0-9]/g,'');}
url=session.url('/web/image',params);}
return url;},_openRecord:function(){if(this.$el.hasClass('o_currently_dragged')){return;}
var editMode=this.$el.hasClass('oe_kanban_global_click_edit');this.trigger_up('open_record',{id:this.db_id,mode:editMode?'edit':'readonly',});},_processFields:function(){var self=this;this.$("field").each(function(){var $field=$(this);var field_name=$field.attr("name");var field_widget=$field.attr("widget");if(field_widget||self.fields[field_name].type==='many2many'){var widget=self.subWidgets[field_name];if(!widget){var Widget=self.fieldsInfo[field_name].Widget;if(Widget){widget=self._processWidget($field,field_name,Widget);self.subWidgets[field_name]=widget;}else if(config.isDebug()){$field.replaceWith($('<span>',{text:_.str.sprintf(_t('[No widget %s]'),field_widget),}));}}else{widget.reset(self.state);$field.replaceWith(widget.$el);if(self.isInDOM&&widget.on_attach_callback){widget.on_attach_callback();}}}else{self._processField($field,field_name);}});},_processField:function($field,field_name){var field=this.fields[field_name];var value=this.recordData[field_name];var options={data:this.recordData,forceString:true};var formatted_value=field_utils.format[field.type](value,field,options);var $result=$('<span>',{text:formatted_value,});$field.replaceWith($result);this._setFieldDisplay($result,field_name);return $result;},_processWidget:function($field,field_name,Widget){var self=this;var attrs=Object.create(null);_.each(this.fieldsInfo[field_name],function(value,key){if(_.str.startsWith(key,'t-att-')){key=key.slice(6);value=$field.attr(key);}
attrs[key]=value;});var options=_.extend({},this.options,{attrs:attrs});let widget;let def;if(utils.isComponent(Widget)){widget=new FieldWrapper(this,Widget,{fieldName:field_name,record:this.state,options:options,});def=widget.mount(document.createDocumentFragment()).then(()=>{$field.replaceWith(widget.$el);});}else{widget=new Widget(this,field_name,this.state,options);def=widget.replace($field);}
this.defs.push(def);def.then(function(){self._setFieldDisplay(widget.$el,field_name);});return widget;},_processWidgets:function(){var self=this;this.$("widget").each(function(){var $field=$(this);var Widget=widgetRegistry.get($field.attr('name'));var widget=new Widget(self,self.state);var def=widget._widgetRenderAndInsert(function(){});self.defs.push(def);def.then(function(){$field.replaceWith(widget.$el);widget.$el.addClass('o_widget');});});},_render:function(){this.defs=[];_.invoke(this.subWidgets,'on_detach_callback');this._replaceElement(this.qweb.render('kanban-box',this.qweb_context));this.$el.addClass('o_kanban_record').attr("tabindex",0);this.$el.attr('role','article');this.$el.data('record',this);if(this.selectionMode){this.$el.addClass('oe_kanban_global_click');}
if(this.$el.hasClass('oe_kanban_global_click')||this.$el.hasClass('oe_kanban_global_click_edit')){this.$el.on('click',this._onGlobalClick.bind(this));this.$el.on('keydown',this._onKeyDownCard.bind(this));}else{this.$el.on('keydown',this._onKeyDownOpenFirstLink.bind(this));}
this._processFields();this._processWidgets();this._setupColor();this._setupColorPicker();this._attachTooltip();this.$('span.o_tag').tooltip({delay:{'show':50}});return Promise.all(this.defs);},_setCoverImage:function(fieldName,autoOpen){var self=this;this._rpc({model:'ir.attachment',method:'search_read',domain:[['res_model','=',this.modelName],['res_id','=',this.id],['mimetype','ilike','image']],fields:['id','name'],}).then(function(attachmentIds){self.imageUploadID=_.uniqueId('o_cover_image_upload');self.accepted_file_extensions='image/*';self.attachment_count=attachmentIds.length;var coverId=self.record[fieldName]&&self.record[fieldName].raw_value;var $content=$(QWeb.render('KanbanView.SetCoverModal',{coverId:coverId,attachmentIds:attachmentIds,widget:self,}));var $imgs=$content.find('.o_kanban_cover_image');var dialog=new Dialog(self,{title:_t("Set a Cover Image"),$content:$content,buttons:[{text:_t("Select"),classes:attachmentIds.length?'btn-primary':'d-none',close:true,disabled:!coverId,click:function(){var $img=$imgs.filter('.o_selected').find('img');var data={};data[fieldName]={id:$img.data('id'),display_name:$img.data('name')};self.trigger_up('kanban_record_update',data);},},{text:_t('Upload and Set'),classes:attachmentIds.length?'':'btn-primary',close:false,click:function(){$content.find('input.o_input_file').click();},},{text:_t("Remove Cover Image"),classes:coverId?'':'d-none',close:true,click:function(){var data={};data[fieldName]=false;self.trigger_up('kanban_record_update',data);},},{text:_t("Discard"),close:true,}],});dialog.opened().then(function(){var $selectBtn=dialog.$footer.find('.btn-primary');if(autoOpen&&!self.attachment_count){$selectBtn.click();}
$content.on('click','.o_kanban_cover_image',function(ev){$imgs.not(ev.currentTarget).removeClass('o_selected');$selectBtn.prop('disabled',!$(ev.currentTarget).toggleClass('o_selected').hasClass('o_selected'));});$content.on('dblclick','.o_kanban_cover_image',function(ev){var $img=$(ev.currentTarget).find('img');var data={};data[fieldName]={id:$img.data('id'),display_name:$img.data('name')};self.trigger_up('kanban_record_update',data);dialog.close();});$content.on('change','input.o_input_file',function(){$content.find('form.o_form_binary_form').submit();});$(window).on(self.imageUploadID,function(){var images=Array.prototype.slice.call(arguments,1);var data={};data[fieldName]={id:images[0].id,display_name:images[0].filename};self.trigger_up('kanban_record_update',data);dialog.close();});});dialog.open();});},_setFieldDisplay:function($el,fieldName){if(this.fieldsInfo[fieldName].display==='right'){$el.addClass('float-right');}else if(this.fieldsInfo[fieldName].display==='full'){$el.addClass('o_text_block');}
if(this.fieldsInfo[fieldName].bold){$el.addClass('o_text_bold');}},_setState:function(recordState){this.state=recordState;this.id=recordState.res_id;this.db_id=recordState.id;this.recordData=recordState.data;this.record=this._transformRecord(recordState.data);this.qweb_context={context:this.state.getContext(),kanban_image:this._getImageURL.bind(this),kanban_color:this._getColorClassname.bind(this),kanban_getcolor:this._getColorID.bind(this),kanban_getcolorname:this._getColorname.bind(this),kanban_compute_domain:this._computeDomain.bind(this),selection_mode:this.selectionMode,read_only_mode:this.read_only_mode,record:this.record,user_context:this.getSession().user_context,widget:this,};},_setupColor:function(){var color_field=this.$el.attr('color');if(color_field&&color_field in this.fields){var colorHelp=_.str.sprintf(_t("Card color: %s"),this._getColorname(this.recordData[color_field]));var colorClass=this._getColorClassname(this.recordData[color_field]);this.$el.addClass(colorClass);this.$el.prepend('<span title="'+colorHelp+'" aria-label="'+colorHelp+'" role="img" class="oe_kanban_color_help"/>');}},_setupColorPicker:function(){var $colorpicker=this.$('ul.oe_kanban_colorpicker');if(!$colorpicker.length){return;}
$colorpicker.html(QWeb.render('KanbanColorPicker',{colors:KANBAN_RECORD_COLORS}));$colorpicker.on('click','a',this._onColorChanged.bind(this));},_transformRecord:function(recordData){var self=this;var new_record={};_.each(this.state.getFieldNames(),function(name){var value=recordData[name];var r=_.clone(self.fields[name]||{});if((r.type==='date'||r.type==='datetime')&&value){r.raw_value=value.toDate();}else if(r.type==='one2many'||r.type==='many2many'){r.raw_value=value.count?value.res_ids:[];}else if(r.type==='many2one'){r.raw_value=value&&value.res_id||false;}else{r.raw_value=value;}
if(r.type){var formatter=field_utils.format[r.type];r.value=formatter(value,self.fields[name],recordData,self.state);}else{r.value=value;}
new_record[name]=r;});return new_record;},_updateRecord:function(data){this.trigger_up('kanban_record_update',data);},_onColorChanged:function(event){event.preventDefault();var data={};var color_field=$(event.delegateTarget).data('field')||'color';data[color_field]=$(event.currentTarget).data('color');this.trigger_up('kanban_record_update',data);},_onGlobalClick:function(event){if($(event.target).parents('.o_dropdown_kanban').length){return;}
var trigger=true;var elem=event.target;var ischild=true;var children=[];while(elem){var events=$._data(elem,'events');if(elem===event.currentTarget){ischild=false;}
var test_event=events&&events.click&&(events.click.length>1||events.click[0].namespace!=='bs.tooltip');var testLinkWithHref=elem.nodeName.toLowerCase()==='a'&&elem.href;if(ischild){children.push(elem);if(test_event||testLinkWithHref){trigger=false;}}
if(trigger&&test_event){_.each(events.click,function(click_event){if(click_event.selector){_.each(children,function(child){if($(child).is(click_event.selector)){trigger=false;}});}});}
elem=elem.parentElement;}
if(trigger){this._openRecord();}},_onKanbanActionClicked:function(event){event.preventDefault();var $action=$(event.currentTarget);var type=$action.data('type')||'button';switch(type){case'edit':this.trigger_up('open_record',{id:this.db_id,mode:'edit'});break;case'open':this.trigger_up('open_record',{id:this.db_id});break;case'delete':this.trigger_up('kanban_record_delete',{id:this.db_id,record:this});break;case'action':case'object':var attrs=$action.data();attrs.confirm=$action.attr('confirm');this.trigger_up('button_clicked',{attrs:attrs,record:this.state,});break;case'set_cover':var fieldName=$action.data('field');var autoOpen=$action.data('auto-open');if(this.fields[fieldName].type==='many2one'&&this.fields[fieldName].relation==='ir.attachment'&&this.fieldsInfo[fieldName].widget==='attachment_image'){this._setCoverImage(fieldName,autoOpen);}else{var warning=_.str.sprintf(_t('Could not set the cover image: incorrect field ("%s") is provided in the view.'),fieldName);this.do_warn(warning);}
break;default:this.do_warn(false,_t("Kanban: no action for type: ")+type);}},_onKeyDownCard:function(event){switch(event.keyCode){case $.ui.keyCode.ENTER:if($(event.target).hasClass('oe_kanban_global_click')){event.preventDefault();this._onGlobalClick(event);break;}}},_onKeyDownOpenFirstLink:function(event){switch(event.keyCode){case $.ui.keyCode.ENTER:event.preventDefault();$(event.target).find('a, button').first().click();break;}},_onManageTogglerClicked:function(event){event.preventDefault();this.$el.parent().find('.o_kanban_record').not(this.$el).removeClass('o_dropdown_open');this.$el.toggleClass('o_dropdown_open');var colorClass=this._getColorClassname(this.recordData.color||0);this.$('.o_kanban_manage_button_section').toggleClass(colorClass);},});return KanbanRecord;});;

/* /web/static/src/js/views/kanban/kanban_record_quick_create.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.kanban_record_quick_create',function(require){"use strict";var core=require('web.core');var QuickCreateFormView=require('web.QuickCreateFormView');const session=require('web.session');var Widget=require('web.Widget');var RecordQuickCreate=Widget.extend({className:'o_kanban_quick_create',custom_events:{add:'_onAdd',cancel:'_onCancel',},events:{'click .o_kanban_add':'_onAddClicked','click .o_kanban_edit':'_onEditClicked','click .o_kanban_cancel':'_onCancelClicked',},init:function(parent,options){this._super.apply(this,arguments);this.context=options.context;this.formViewRef=options.formViewRef;this.model=options.model;this._disabled=false;},willStart:function(){var self=this;var superWillStart=this._super.apply(this,arguments);var viewsLoaded;if(this.formViewRef){var views=[[false,'form']];var context=_.extend({},this.context,{form_view_ref:this.formViewRef,});viewsLoaded=this.loadViews(this.model,context,views);}else{var fieldsView={};fieldsView.arch='<form>'+'<field name="display_name" placeholder="Title" modifiers=\'{"required": true}\'/>'+'</form>';var fields={display_name:{string:'Display name',type:'char'},};fieldsView.fields=fields;fieldsView.viewFields=fields;viewsLoaded=Promise.resolve({form:fieldsView});}
viewsLoaded=viewsLoaded.then(function(fieldsViews){var formView=new QuickCreateFormView(fieldsViews.form,{context:self.context,modelName:self.model,userContext:session.user_context,});return formView.getController(self).then(function(controller){self.controller=controller;return self.controller.appendTo(document.createDocumentFragment());});});return Promise.all([superWillStart,viewsLoaded]);},start:function(){this.$el.append(this.controller.$el);this.controller.renderButtons(this.$el);this.controller.autofocus();core.bus.on('click',this,this._onWindowClicked);return this._super.apply(this,arguments);},on_attach_callback:function(){if(this.controller){this.controller.autofocus();}},cancel:function(){var self=this;return this.controller.commitChanges().then(function(){if(!self.controller.isDirty()){self._cancel();}});},_add:function(options){var self=this;if(this._disabled){return;}
this._disableQuickCreate();this.controller.commitChanges().then(function(){var canBeSaved=self.controller.canBeSaved();if(canBeSaved){self.trigger_up('quick_create_add_record',{openRecord:options&&options.openRecord||false,values:self.controller.getChanges(),onFailure:self._enableQuickCreate.bind(self),});}else{self._enableQuickCreate();}}).guardedCatch(this._enableQuickCreate.bind(this));},_cancel:function(){this.trigger_up('cancel_quick_create');},_disableQuickCreate:function(){this._disabled=true;this.$el.addClass('o_disabled');this.$('input:not(:disabled)').addClass('o_temporarily_disabled').attr('disabled','disabled');},_enableQuickCreate:function(){this._disabled=false;this.$el.removeClass('o_disabled');this.$('input.o_temporarily_disabled').removeClass('o_temporarily_disabled').attr('disabled',false);},_onAdd:function(ev){ev.stopPropagation();this._add();},_onAddClicked:function(ev){ev.stopPropagation();this._add();},_onCancel:function(ev){ev.stopPropagation();this._cancel();},_onCancelClicked:function(ev){ev.stopPropagation();this._cancel();},_onEditClicked:function(ev){ev.stopPropagation();this._add({openRecord:true});},_onWindowClicked:function(ev){if(!document.contains(this.el)){return;}
if($(ev.target).closest('.o-kanban-button-new, .o_kanban_quick_add').length){return;}
if($(ev.target).parents('.ui-autocomplete').length){return;}
if($(ev.target).closest('.modal').length){return;}
if(!document.contains(ev.target)){return;}
if(this.el.contains(ev.target)&&this.el!==ev.target){return;}
this.cancel();},});return RecordQuickCreate;});;

/* /web/static/src/js/views/kanban/kanban_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.KanbanRenderer',function(require){"use strict";var BasicRenderer=require('web.BasicRenderer');var ColumnQuickCreate=require('web.kanban_column_quick_create');var config=require('web.config');var core=require('web.core');var KanbanColumn=require('web.KanbanColumn');var KanbanRecord=require('web.KanbanRecord');var QWeb=require('web.QWeb');var session=require('web.session');var utils=require('web.utils');var viewUtils=require('web.viewUtils');var qweb=core.qweb;var _t=core._t;function findInNode(node,predicate){if(predicate(node)){return node;}
if(!node.children){return undefined;}
for(var i=0;i<node.children.length;i++){if(findInNode(node.children[i],predicate)){return node.children[i];}}}
function qwebAddIf(node,condition){if(node.attrs[qweb.prefix+'-if']){condition=_.str.sprintf("(%s) and (%s)",node.attrs[qweb.prefix+'-if'],condition);}
node.attrs[qweb.prefix+'-if']=condition;}
function transformQwebTemplate(node,fields){if(node.tag&&node.attrs.modifiers){var modifiers=node.attrs.modifiers||{};if(modifiers.invisible){qwebAddIf(node,_.str.sprintf("!kanban_compute_domain(%s)",JSON.stringify(modifiers.invisible)));}}
switch(node.tag){case'button':case'a':var type=node.attrs.type||'';if(_.indexOf('action,object,edit,open,delete,url,set_cover'.split(','),type)!==-1){_.each(node.attrs,function(v,k){if(_.indexOf('icon,type,name,args,string,context,states,kanban_states'.split(','),k)!==-1){node.attrs['data-'+k]=v;delete(node.attrs[k]);}});if(node.attrs['data-string']){node.attrs.title=node.attrs['data-string'];}
if(node.tag==='a'&&node.attrs['data-type']!=="url"){node.attrs.href='#';}else{node.attrs.type='button';}
var action_classes=" oe_kanban_action oe_kanban_action_"+node.tag;if(node.attrs['t-attf-class']){node.attrs['t-attf-class']+=action_classes;}else if(node.attrs['t-att-class']){node.attrs['t-att-class']+=" + '"+action_classes+"'";}else{node.attrs['class']=(node.attrs['class']||'')+action_classes;}}
break;}
if(node.children){for(var i=0,ii=node.children.length;i<ii;i++){transformQwebTemplate(node.children[i],fields);}}}
var KanbanRenderer=BasicRenderer.extend({className:'o_kanban_view',config:{KanbanColumn:KanbanColumn,KanbanRecord:KanbanRecord,},custom_events:_.extend({},BasicRenderer.prototype.custom_events||{},{close_quick_create:'_onCloseQuickCreate',cancel_quick_create:'_onCancelQuickCreate',set_progress_bar_state:'_onSetProgressBarState',start_quick_create:'_onStartQuickCreate',quick_create_column_updated:'_onQuickCreateColumnUpdated',}),events:_.extend({},BasicRenderer.prototype.events||{},{'keydown .o_kanban_record':'_onRecordKeyDown'}),sampleDataTargets:['.o_kanban_counter','.o_kanban_record','.o_kanban_toggle_fold','.o_column_folded','.o_column_archive_records','.o_column_unarchive_records',],init:function(parent,state,params){this._super.apply(this,arguments);this.widgets=[];this.qweb=new QWeb(config.isDebug(),{_s:session.origin},false);var templates=findInNode(this.arch,function(n){return n.tag==='templates';});transformQwebTemplate(templates,state.fields);this.qweb.add_template(utils.json_node_to_xml(templates));this.examples=params.examples;this.recordOptions=_.extend({},params.record_options,{qweb:this.qweb,viewType:'kanban',});this.columnOptions=_.extend({KanbanRecord:this.config.KanbanRecord},params.column_options);if(this.columnOptions.hasProgressBar){this.columnOptions.progressBarStates={};}
this.quickCreateEnabled=params.quickCreateEnabled;if(!params.readOnlyMode){var handleField=_.findWhere(this.state.fieldsInfo.kanban,{widget:'handle'});this.handleField=handleField&&handleField.name;}
this._setState(state);},on_attach_callback:function(){this._super(...arguments);if(this.quickCreate){this.quickCreate.on_attach_callback();}},addQuickCreate:function(groupId){let kanbanColumn;if(groupId){kanbanColumn=this.widgets.find(column=>column.db_id===groupId);}
kanbanColumn=kanbanColumn||this.widgets[0];return kanbanColumn.addQuickCreate();},giveFocus:function(){this.$('.o_kanban_record:first').focus();},quickCreateToggleFold:function(){this.quickCreate.toggleFold();this._toggleNoContentHelper();},updateColumn:function(localID,columnState,options){var self=this;var KanbanColumn=this.config.KanbanColumn;var newColumn=new KanbanColumn(this,columnState,this.columnOptions,this.recordOptions);var index=_.findIndex(this.widgets,{db_id:localID});var column=this.widgets[index];this.widgets[index]=newColumn;if(options&&options.state){this._setState(options.state);}
return newColumn.appendTo(document.createDocumentFragment()).then(function(){var def;if(options&&options.openQuickCreate){def=newColumn.addQuickCreate();}
return Promise.resolve(def).then(function(){newColumn.$el.insertAfter(column.$el);self._toggleNoContentHelper();newColumn.on_attach_callback();column.destroy();});});},updateRecord:function(recordState){var isGrouped=!!this.state.groupedBy.length;var record;if(isGrouped){_.each(this.widgets,function(widget){record=record||_.findWhere(widget.records,{db_id:recordState.id,});});}else{record=_.findWhere(this.widgets,{db_id:recordState.id});}
if(record){return record.update(recordState);}
return Promise.resolve();},_focusOnNextCard:function(currentCardElement){var nextCard=currentCardElement.nextElementSibling;if(nextCard){nextCard.focus();}},_focusOnPreviousCard:function(currentCardElement){var previousCard=currentCardElement.previousElementSibling;if(previousCard&&previousCard.classList.contains("o_kanban_record")){previousCard.focus();return true;}},_getGhostColumns:function(){if(this.examples&&this.examples.ghostColumns){return this.examples.ghostColumns;}
return _.map(_.range(1,5),function(num){return _.str.sprintf(_t("Column %s"),num);});},_renderExampleBackground:function(fragment){var $background=$(qweb.render('KanbanView.ExamplesBackground',{ghostColumns:this._getGhostColumns()}));$background.appendTo(fragment);},_renderGhostDivs:function(fragment,nbDivs,options){var ghostDefs=[];for(var $ghost,i=0;i<nbDivs;i++){$ghost=$('<div>').addClass('o_kanban_record o_kanban_ghost');if(options&&options.inlineStyle){$ghost.attr('style',options.inlineStyle);}
var def=$ghost.appendTo(fragment);ghostDefs.push(def);}
return Promise.all(ghostDefs);},_renderGrouped:function(fragment){var self=this;var KanbanColumn=this.config.KanbanColumn;_.each(this.state.data,function(group){var column=new KanbanColumn(self,group,self.columnOptions,self.recordOptions);var def;if(!group.value){def=column.prependTo(fragment);self.widgets.unshift(column);}else{def=column.appendTo(fragment);self.widgets.push(column);}
self.defs.push(def);});if(this.$el.sortable('instance')!==undefined){this.$el.sortable('destroy');}
if(this.groupedByM2O){this.$el.sortable({axis:'x',items:'> .o_kanban_group',handle:'.o_column_title',cursor:'move',revert:150,delay:100,tolerance:'pointer',forcePlaceholderSize:true,stop:function(){var ids=[];self.$('.o_kanban_group').each(function(index,u){if(_.isNumber($(u).data('id'))){ids.push($(u).data('id'));}});self.trigger_up('resequence_columns',{ids:ids});},});if(this.createColumnEnabled){this.quickCreate=new ColumnQuickCreate(this,{applyExamplesText:this.examples&&this.examples.applyExamplesText,examples:this.examples&&this.examples.examples,});this.defs.push(this.quickCreate.appendTo(fragment).then(function(){if(!self.state.data.length){self.quickCreate.toggleFold();self._renderExampleBackground(fragment);}}));}}},_renderUngrouped:function(fragment){var self=this;var KanbanRecord=this.config.KanbanRecord;var kanbanRecord;_.each(this.state.data,function(record){kanbanRecord=new KanbanRecord(self,record,self.recordOptions);self.widgets.push(kanbanRecord);var def=kanbanRecord.appendTo(fragment);self.defs.push(def);});var orderedBy=this.state.orderedBy;var hasHandle=this.handleField&&(orderedBy.length===0||orderedBy[0].name===this.handleField);if(hasHandle){this.$el.sortable({items:'.o_kanban_record:not(.o_kanban_ghost)',cursor:'move',revert:0,delay:0,tolerance:'pointer',forcePlaceholderSize:true,stop:function(event,ui){self._moveRecord(ui.item.data('record').db_id,ui.item.index());},});}
var prom=Promise.all(self.defs).then(function(){var options={};if(kanbanRecord){options.inlineStyle=kanbanRecord.$el.attr('style');}
return self._renderGhostDivs(fragment,6,options);});this.defs.push(prom);},_renderView:function(){var self=this;var isGrouped=!!this.state.groupedBy.length;var fragment=document.createDocumentFragment();var defs=[];this.defs=defs;if(isGrouped){this._renderGrouped(fragment);}else{this._renderUngrouped(fragment);}
delete this.defs;return this._super.apply(this,arguments).then(function(){return Promise.all(defs).then(function(){self.$el.empty();self.$el.toggleClass('o_kanban_grouped',isGrouped);self.$el.toggleClass('o_kanban_ungrouped',!isGrouped);self.$el.append(fragment);self._toggleNoContentHelper();});});},_toggleNoContentHelper:function(remove){var displayNoContentHelper=!remove&&!this._hasContent()&&!!this.noContentHelp&&!(this.quickCreate&&!this.quickCreate.folded)&&!this.state.isGroupedByM2ONoColumn;var $noContentHelper=this.$('.o_view_nocontent');if(displayNoContentHelper&&!$noContentHelper.length){this._renderNoContentHelper();}
if(!displayNoContentHelper&&$noContentHelper.length){$noContentHelper.remove();}},_setState:function(){this._super(...arguments);var groupByField=this.state.groupedBy[0];var cleanGroupByField=this._cleanGroupByField(groupByField);var groupByFieldAttrs=this.state.fields[cleanGroupByField];var groupByFieldInfo=this.state.fieldsInfo.kanban[cleanGroupByField];var draggable=true;var grouped_by_date=false;if(groupByFieldAttrs){if(groupByFieldAttrs.type==="date"||groupByFieldAttrs.type==="datetime"){draggable=false;grouped_by_date=true;}else if(groupByFieldAttrs.readonly!==undefined){draggable=!(groupByFieldAttrs.readonly);}}
if(groupByFieldInfo){if(draggable&&groupByFieldInfo.readonly!==undefined){draggable=!(groupByFieldInfo.readonly);}}
this.groupedByM2O=groupByFieldAttrs&&(groupByFieldAttrs.type==='many2one');var relation=this.groupedByM2O&&groupByFieldAttrs.relation;var groupByTooltip=groupByFieldInfo&&groupByFieldInfo.options.group_by_tooltip;this.columnOptions=_.extend(this.columnOptions,{draggable:draggable,group_by_tooltip:groupByTooltip,groupedBy:groupByField,grouped_by_m2o:this.groupedByM2O,grouped_by_date:grouped_by_date,relation:relation,quick_create:this.quickCreateEnabled&&viewUtils.isQuickCreateEnabled(this.state),});this.createColumnEnabled=this.groupedByM2O&&this.columnOptions.group_creatable;},_cleanGroupByField:function(groupByField){var cleanGroupByField=groupByField;if(cleanGroupByField&&cleanGroupByField.indexOf(':')>-1){cleanGroupByField=cleanGroupByField.substring(0,cleanGroupByField.indexOf(':'));}
return cleanGroupByField;},_focusOnCardInColumn:function(eventTarget,direction){var currentColumn=eventTarget.parentElement;var hasSelectedACard=false;var cannotSelectAColumn=false;while(!hasSelectedACard&&!cannotSelectAColumn){var candidateColumn=direction==='LEFT'?currentColumn.previousElementSibling:currentColumn.nextElementSibling;currentColumn=candidateColumn;if(candidateColumn){var allCardsOfCandidateColumn=candidateColumn.getElementsByClassName('o_kanban_record');if(allCardsOfCandidateColumn.length){allCardsOfCandidateColumn[0].focus();hasSelectedACard=true;}}
else{direction==='LEFT'?this._focusOnPreviousCard(eventTarget):this._focusOnNextCard(eventTarget);cannotSelectAColumn=true;}}},_onCancelQuickCreate:function(){this._toggleNoContentHelper();},_onCloseQuickCreate:function(){if(this.state.groupedBy.length){_.invoke(this.widgets,'cancelQuickCreate');}
this._toggleNoContentHelper();},_onQuickCreateColumnUpdated:function(ev){ev.stopPropagation();this._toggleNoContentHelper();this._updateExampleBackground();},_onRecordKeyDown:function(e){switch(e.which){case $.ui.keyCode.DOWN:this._focusOnNextCard(e.currentTarget);e.stopPropagation();e.preventDefault();break;case $.ui.keyCode.UP:const previousFocused=this._focusOnPreviousCard(e.currentTarget);if(!previousFocused){this.trigger_up('navigation_move',{direction:'up'});}
e.stopPropagation();e.preventDefault();break;case $.ui.keyCode.RIGHT:this._focusOnCardInColumn(e.currentTarget,'RIGHT');e.stopPropagation();e.preventDefault();break;case $.ui.keyCode.LEFT:this._focusOnCardInColumn(e.currentTarget,'LEFT');e.stopPropagation();e.preventDefault();break;}},_onSetProgressBarState:function(ev){if(!this.columnOptions.progressBarStates[ev.data.columnID]){this.columnOptions.progressBarStates[ev.data.columnID]={};}
_.extend(this.columnOptions.progressBarStates[ev.data.columnID],ev.data.values);},_onStartQuickCreate:function(){this._toggleNoContentHelper(true);},_updateExampleBackground:function(){var $elem=this.$('.o_kanban_example_background_container');if(!this.state.data.length&&!$elem.length){this._renderExampleBackground(this.$el);}else{$elem.remove();}},});return KanbanRenderer;});;

/* /web/static/src/js/views/kanban/kanban_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.KanbanView',function(require){"use strict";var BasicView=require('web.BasicView');var core=require('web.core');var KanbanController=require('web.KanbanController');var kanbanExamplesRegistry=require('web.kanban_examples_registry');var KanbanModel=require('web.KanbanModel');var KanbanRenderer=require('web.KanbanRenderer');var utils=require('web.utils');var _lt=core._lt;var KanbanView=BasicView.extend({accesskey:"k",display_name:_lt("Kanban"),icon:'fa-th-large',mobile_friendly:true,config:_.extend({},BasicView.prototype.config,{Model:KanbanModel,Controller:KanbanController,Renderer:KanbanRenderer,}),jsLibs:[],viewType:'kanban',init:function(viewInfo,params){this._super.apply(this,arguments);this.loadParams.limit=this.loadParams.limit||40;this.loadParams.openGroupByDefault=true;this.loadParams.type='list';this.noDefaultGroupby=params.noDefaultGroupby;var progressBar;utils.traverse(this.arch,function(n){var isProgressBar=(n.tag==='progressbar');if(isProgressBar){progressBar=_.clone(n.attrs);progressBar.colors=JSON.parse(progressBar.colors);progressBar.sum_field=progressBar.sum_field||false;}
return!isProgressBar;});if(progressBar){this.loadParams.progressBar=progressBar;}
var activeActions=this.controllerParams.activeActions;var archAttrs=this.arch.attrs;activeActions=_.extend(activeActions,{group_create:this.arch.attrs.group_create?!!JSON.parse(archAttrs.group_create):true,group_edit:archAttrs.group_edit?!!JSON.parse(archAttrs.group_edit):true,group_delete:archAttrs.group_delete?!!JSON.parse(archAttrs.group_delete):true,});this.rendererParams.column_options={editable:activeActions.group_edit,deletable:activeActions.group_delete,archivable:archAttrs.archivable?!!JSON.parse(archAttrs.archivable):true,group_creatable:activeActions.group_create,quickCreateView:archAttrs.quick_create_view||null,recordsDraggable:archAttrs.records_draggable?!!JSON.parse(archAttrs.records_draggable):true,hasProgressBar:!!progressBar,};this.rendererParams.record_options={editable:activeActions.edit,deletable:activeActions.delete,read_only_mode:params.readOnlyMode,selectionMode:params.selectionMode,};this.rendererParams.quickCreateEnabled=this._isQuickCreateEnabled();this.rendererParams.readOnlyMode=params.readOnlyMode;var examples=archAttrs.examples;if(examples){this.rendererParams.examples=kanbanExamplesRegistry.get(examples);}
this.controllerParams.on_create=archAttrs.on_create;this.controllerParams.hasButtons=!params.selectionMode?true:false;this.controllerParams.quickCreateEnabled=this.rendererParams.quickCreateEnabled;},_isQuickCreateEnabled:function(){if(!this.controllerParams.activeActions.create){return false;}
if(this.arch.attrs.quick_create!==undefined){return!!JSON.parse(this.arch.attrs.quick_create);}
return true;},_updateMVCParams:function(){this._super.apply(this,arguments);if(this.searchMenuTypes.includes('groupBy')&&!this.noDefaultGroupby&&this.arch.attrs.default_group_by){this.loadParams.groupBy=[this.arch.attrs.default_group_by];}},});return KanbanView;});;

/* /web/static/src/js/views/kanban/quick_create_form_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.QuickCreateFormView',function(require){"use strict";var BasicModel=require('web.BasicModel');var FormController=require('web.FormController');var FormRenderer=require('web.FormRenderer');var FormView=require('web.FormView');const{qweb}=require("web.core");var QuickCreateFormRenderer=FormRenderer.extend({start:async function(){await this._super.apply(this,arguments);this.$el.addClass('o_xxs_form_view');this.$el.removeClass('o_xxl_form_view');},_applyFormSizeClass(){},_onNavigationMove:function(ev){var direction=ev.data.direction;if(direction==='cancel'||direction==='next_line'){ev.stopPropagation();this.trigger_up(direction==='cancel'?'cancel':'add');}else{this._super.apply(this,arguments);}},});var QuickCreateFormModel=BasicModel.extend({getChanges:function(localID){var record=this.localData[localID];return this._generateChanges(record,{changesOnly:false});},});var QuickCreateFormController=FormController.extend({commitChanges:function(){var mutexDef=this.mutex.getUnlockedDef();return Promise.all([mutexDef,this.renderer.commitChanges(this.handle)]);},getChanges:function(){return this.model.getChanges(this.handle);},renderButtons($node){this.$buttons=$(qweb.render('KanbanView.RecordQuickCreate.buttons'));if($node){this.$buttons.appendTo($node);}},updateButtons(){},});var QuickCreateFormView=FormView.extend({withControlPanel:false,config:_.extend({},FormView.prototype.config,{Model:QuickCreateFormModel,Renderer:QuickCreateFormRenderer,Controller:QuickCreateFormController,}),});return QuickCreateFormView;});;

/* /web/static/src/js/views/list/list_editable_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.EditableListRenderer',function(require){"use strict";var core=require('web.core');var dom=require('web.dom');var ListRenderer=require('web.ListRenderer');var utils=require('web.utils');const{WidgetAdapterMixin}=require('web.OwlCompatibility');var _t=core._t;ListRenderer.include({RESIZE_DELAY:200,custom_events:_.extend({},ListRenderer.prototype.custom_events,{navigation_move:'_onNavigationMove',}),events:_.extend({},ListRenderer.prototype.events,{'click .o_field_x2many_list_row_add a':'_onAddRecord','click .o_group_field_row_add a':'_onAddRecordToGroup','keydown .o_field_x2many_list_row_add a':'_onKeyDownAddRecord','click tbody td.o_data_cell':'_onCellClick','click tbody tr:not(.o_data_row)':'_onEmptyRowClick','click tfoot':'_onFooterClick','click tr .o_list_record_remove':'_onRemoveIconClick',}),init:function(parent,state,params){this._super.apply(this,arguments);this.editable=params.editable;this.isMultiEditable=params.isMultiEditable;this.columnWidths=false;this.addCreateLine=params.addCreateLine;this.addCreateLineInGroups=params.addCreateLineInGroups;this.creates=[];this.arch.children.forEach(child=>{if(child.tag!=='control'){return;}
child.children.forEach(child=>{if(child.tag!=='create'||child.attrs.invisible){return;}
this.creates.push({context:child.attrs.context,string:child.attrs.string,});});});if(this.creates.length===0){this.creates.push({string:_t("Add a line"),});}
this.addTrashIcon=params.addTrashIcon;this.isMany2Many=params.isMany2Many;this.currentRow=null;this.currentFieldIndex=null;this.isResizing=false;this.eventListeners=[];},start:function(){core.bus.on('click',this,this._onWindowClicked.bind(this));core.bus.on('resize',this,_.debounce(this._onResize.bind(this),this.RESIZE_DELAY));core.bus.on('DOM_updated',this,()=>this._freezeColumnWidths());return this._super();},destroy:function(){this.eventListeners.forEach(listener=>{const{type,el,callback,options}=listener;el.removeEventListener(type,callback,options);});return this._super.apply(this,arguments);},on_attach_callback:function(){this.isInDOM=true;this._super();this._freezeColumnWidths();},on_detach_callback:function(){this.isInDOM=false;this._super();},canBeSaved:function(recordID){if((recordID||this.state.id)===this.state.id){recordID=this.getEditableRecordID();if(recordID===null){return[];}}
var fieldNames=this._super(recordID);this.$('.o_selected_row .o_data_cell').removeClass('o_invalid_cell');this.$('.o_selected_row .o_data_cell:has(> .o_field_invalid)').addClass('o_invalid_cell');return fieldNames;},confirmChange:function(state,recordID){var self=this;return this._super.apply(this,arguments).then(function(widgets){if(widgets.length){var $row=self._getRow(recordID);var record=self._getRecord(recordID);self._setDecorationClasses($row,self.rowDecorations,record);self._updateFooter();}
return widgets;});},confirmUpdate:function(state,id,fields,ev){var self=this;var oldData=this.state.data;this._setState(state);return this.confirmChange(state,id,fields,ev).then(function(){var record=self._getRecord(id);if(!record){return;}
_.each(oldData,function(rec){if(rec.id!==id){self._destroyFieldWidgets(rec.id);}});self.defs=[];var $newBody=self._renderBody();var defs=self.defs;delete self.defs;return Promise.all(defs).then(function(){_.each(self.columns,function(node){self._registerModifiers(node,record,null,{mode:'edit'});});var currentRowID;var currentWidget;var focusedElement;var selectionRange;if(self.currentRow!==null){currentRowID=self._getRecordID(self.currentRow);currentWidget=self.allFieldWidgets[currentRowID][self.currentFieldIndex];if(currentWidget){focusedElement=currentWidget.getFocusableElement().get(0);if(currentWidget.formatType!=='boolean'){selectionRange=dom.getSelectionRange(focusedElement);}}}
var $editedRow=self._getRow(id);$editedRow.nextAll('.o_data_row').remove();$editedRow.prevAll('.o_data_row').remove();var $newRow=$newBody.find('.o_data_row[data-id="'+id+'"]');$newRow.prevAll('.o_data_row').get().reverse().forEach(function(row){$(row).insertBefore($editedRow);});$newRow.nextAll('.o_data_row').get().reverse().forEach(function(row){$(row).insertAfter($editedRow);});if(self.currentRow!==null){var newRowIndex=$editedRow.prop('rowIndex')-1;self.currentRow=newRowIndex;return self._selectCell(newRowIndex,self.currentFieldIndex,{force:true}).then(function(){currentWidget=self.allFieldWidgets[currentRowID][self.currentFieldIndex];if(currentWidget){focusedElement=currentWidget.getFocusableElement().get(0);if(selectionRange){dom.setSelectionRange(focusedElement,selectionRange);}}});}});});},editFirstRecord:function(ev){const $borderRow=this._getBorderRow(ev.data.side||'first');this._selectCell($borderRow.prop('rowIndex')-1,ev.data.cellIndex||0);},editRecord:function(recordID){var $row=this._getRow(recordID);var rowIndex=$row.prop('rowIndex')-1;this._selectCell(rowIndex,0);},focusCell:function(recordId,column){var $row=this._getRow(recordId);var cellIndex=this.columns.indexOf(column);$row.find('.o_data_cell')[cellIndex].focus();},getEditableRecordID:function(){if(this.currentRow!==null){return this._getRecordID(this.currentRow);}
return null;},isInMultipleRecordEdition:function(recordId){return this.isEditable()&&this.isMultiEditable&&this.selection.includes(recordId);},isEditable:function(){return this.editable||(this.isMultiEditable&&this.selection.length);},removeLine:function(state,recordID){this._setState(state);var $row=this._getRow(recordID);if($row.length===0){return;}
if($row.prop('rowIndex')-1===this.currentRow){this.currentRow=null;this._enableRecordSelectors();}
this._destroyFieldWidgets(recordID);if(this.state.count>=4){$row.remove();}else{var $emptyRow=this._renderEmptyRow();$row.replaceWith($emptyRow);const $lastDataRow=this.$('.o_data_row:last');if($lastDataRow.length){$emptyRow.insertAfter($lastDataRow);}}},setRowMode:function(recordID,mode){var self=this;var record=self._getRecord(recordID);if(!record){return Promise.resolve();}
var editMode=(mode==='edit');var $row=this._getRow(recordID);this.currentRow=editMode?$row.prop('rowIndex')-1:null;var $tds=$row.children('.o_data_cell');var oldWidgets=_.clone(this.allFieldWidgets[record.id]);var options={renderInvisible:editMode,renderWidgets:editMode,};options.mode=editMode?'edit':'readonly';var defs=[];this.defs=defs;_.each(this.columns,function(node,colIndex){var $td=$tds.eq(colIndex);var $newTd=self._renderBodyCell(record,node,colIndex,options);if($td.hasClass('o_list_button')){self._unregisterModifiersElement(node,recordID,$td.children());}
if(editMode){$td.empty().append($newTd.contents());}else{self._unregisterModifiersElement(node,recordID,$td);$td.replaceWith($newTd);}});delete this.defs;_.each(oldWidgets,this._destroyFieldWidget.bind(this,recordID));$row.toggleClass('o_selected_row',editMode);if(editMode){this._disableRecordSelectors();}else{this._enableRecordSelectors();}
return Promise.all(defs).then(function(){WidgetAdapterMixin.on_attach_callback.call(self);core.bus.trigger('DOM_updated');});},unselectRow:function(){if(this.currentRow===null){return Promise.resolve();}
var recordID=this._getRecordID(this.currentRow);var recordWidgets=this.allFieldWidgets[recordID];function toggleWidgets(disabled){_.each(recordWidgets,function(widget){var $el=widget.getFocusableElement();$el.prop('disabled',disabled);});}
toggleWidgets(true);return new Promise((resolve,reject)=>{this.trigger_up('save_line',{recordID:recordID,onSuccess:resolve,onFailure:reject,});}).then(selectNextRow=>{this._enableRecordSelectors();return selectNextRow;}).guardedCatch(()=>{toggleWidgets(false);});},updateState:function(state,params){if(params.keepWidths&&this.$el.is(':visible')){this._storeColumnWidths();}
if(params.noRender){this.allModifiersData=[];}
if('addTrashIcon'in params){if(this.addTrashIcon!==params.addTrashIcon){this.columnWidths=false;}
this.addTrashIcon=params.addTrashIcon;}
if('addCreateLine'in params){this.addCreateLine=params.addCreateLine;}
return this._super.apply(this,arguments);},_addEventListener:function(type,el,callback,options){el.addEventListener(type,callback,options);this.eventListeners.push({type,el,callback,options});},_computeDefaultWidths:function(){const isListEmpty=!this._hasVisibleRecords(this.state);const relativeWidths=[];this.columns.forEach(column=>{const th=this._getColumnHeader(column);if(th.offsetParent===null){relativeWidths.push(false);}else{const width=this._getColumnWidth(column);if(width.match(/[a-zA-Z]/)){if(isListEmpty){th.style.width=width;}else{th.style.minWidth=width;}
relativeWidths.push(false);}else{relativeWidths.push(parseFloat(width,10));}}});if(isListEmpty){const totalWidth=this._getColumnsTotalWidth(relativeWidths);for(let i in this.columns){if(relativeWidths[i]){const th=this._getColumnHeader(this.columns[i]);th.style.width=(relativeWidths[i]/totalWidth*100)+'%';}}
const trashHeader=this.el.getElementsByClassName('o_list_record_remove_header')[0];if(trashHeader){trashHeader.style.width='32px';}}},_destroyFieldWidgets:function(recordID){if(recordID in this.allFieldWidgets){var widgetsToDestroy=this.allFieldWidgets[recordID].slice();_.each(widgetsToDestroy,this._destroyFieldWidget.bind(this,recordID));delete this.allFieldWidgets[recordID];}},_disableRecordSelectors:function(){this.$('.o_list_record_selector input').attr('disabled','disabled');},_enableRecordSelectors:function(){this.$('.o_list_record_selector input').attr('disabled',false);},_freezeColumnWidths:function(){if(!this.columnWidths&&this.el.offsetParent===null){return;}
const thElements=[...this.el.querySelectorAll('table thead th')];if(!thElements.length){return;}
const table=this.el.getElementsByClassName('o_list_table')[0];let columnWidths=this.columnWidths;if(!columnWidths||!columnWidths.length){table.style.tableLayout='auto';thElements.forEach(th=>{th.style.width=null;th.style.maxWidth=null;});this._computeDefaultWidths();columnWidths=this._squeezeTable();}
thElements.forEach((th,index)=>{if(!th.style.width){th.style.width=`${columnWidths[index]}px`;}});table.style.tableLayout='fixed';},_getBorderRow:function(side){let $borderDataRow=this.$(`.o_data_row:${side}`);if(!this._isRecordEditable($borderDataRow.data('id'))){$borderDataRow=this._getNearestEditableRow($borderDataRow,side==='first');}
return $borderDataRow;},_getColumnsTotalWidth(relativeWidths){return relativeWidths.reduce((acc,width)=>acc+width,0);},_getColumnWidth:function(column){if(column.attrs.width){return column.attrs.width;}
const fieldsInfo=this.state.fieldsInfo.list;const name=column.attrs.name;if(!fieldsInfo[name]){return'1';}
const widget=fieldsInfo[name].Widget.prototype;if('widthInList'in widget){return widget.widthInList;}
const field=this.state.fields[name];if(!field){return'1';}
const fixedWidths={boolean:'70px',date:'92px',datetime:'146px',float:'92px',integer:'74px',monetary:'104px',};let type=field.type;if(fieldsInfo[name].widget in fixedWidths){type=fieldsInfo[name].widget;}
return fixedWidths[type]||'1';},_getColumnHeader:function(column){const{icon,name,string}=column.attrs;if(name){return this.el.querySelector(`thead th[data-name="${name}"]`);}else if(string){return this.el.querySelector(`thead th[data-string="${string}"]`);}else if(icon){return this.el.querySelector(`thead th[data-icon="${icon}"]`);}},_getNearestEditableRow:function($row,next){const direction=next?'next':'prev';let $nearestRow;if(this.editable){$nearestRow=$row[direction]();if(!$nearestRow.hasClass('o_data_row')){var $nextBody=$row.closest('tbody')[direction]();while($nextBody.length&&!$nextBody.find('.o_data_row').length){$nextBody=$nextBody[direction]();}
$nearestRow=$nextBody.find(`.o_data_row:${next ? 'first' : 'last'}`);}}else{const recordId=$row.data('id');const rowSelectionIndex=this.selection.indexOf(recordId);let nextRowIndex;if(rowSelectionIndex<0){nextRowIndex=next?0:this.selection.length-1;}else{nextRowIndex=rowSelectionIndex+(next?1:-1);}
$nearestRow=this._getRow(this.selection[nextRowIndex]);}
return $nearestRow;},_getNumberOfCols:function(){var n=this._super();if(this.addTrashIcon){n++;}
return n;},_getRecord:function(recordId){var record;utils.traverse_records(this.state,function(r){if(r.id===recordId){record=r;}});return record;},_getRecordID:function(rowIndex){var $tr=this.$('table.o_list_table > tbody tr').eq(rowIndex);return $tr.data('id');},_getRow:function(recordId){return this.$('.o_data_row[data-id="'+recordId+'"]');},_hasVisibleRecords:function(list){if(!list.groupedBy.length){return!!list.data.length;}else{var hasVisibleRecords=false;for(var i=0;i<list.data.length;i++){hasVisibleRecords=hasVisibleRecords||this._hasVisibleRecords(list.data[i]);}
return hasVisibleRecords;}},_isRecordEditable:function(recordID){return this.editable||(this.isMultiEditable&&this.selection.includes(recordID));},_moveToNextLine:function(options){this._moveToSideLine(true,options);},_moveToPreviousLine:function(options){this._moveToSideLine(false,options);},_moveToSideLine:function(next,options){options=options||{};const recordID=this._getRecordID(this.currentRow);this.commitChanges(recordID).then(()=>{const record=this._getRecord(recordID);const multiEdit=this.isInMultipleRecordEdition(recordID);if(!multiEdit){const fieldNames=this.canBeSaved(recordID);if(fieldNames.length&&(record.isDirty()||options.forceCreate)){return;}}
const side=next?'first':'last';const borderRowIndex=this._getBorderRow(side).prop('rowIndex')-1;const cellIndex=next?0:this.allFieldWidgets[recordID].length-1;const cellOptions={inc:next?1:-1,force:true};const $currentRow=this._getRow(recordID);const $nextRow=this._getNearestEditableRow($currentRow,next);let nextRowIndex=null;let groupId;if(!this.isGrouped){if($nextRow.length){nextRowIndex=$nextRow.prop('rowIndex')-1;}else if(!this.editable){nextRowIndex=borderRowIndex;}else if(!options.forceCreate&&!record.isDirty()){this.trigger_up('discard_changes',{recordID:recordID,onSuccess:this.trigger_up.bind(this,'activate_next_widget',{side:side}),});return;}}else{var $directNextRow=$currentRow.next();if(next&&this.editable==="bottom"&&$directNextRow.hasClass('o_add_record_row')){if(options.forceCreate||record.isDirty()){groupId=$directNextRow.data('group-id');}else{nextRowIndex=($nextRow.prop('rowIndex')-1)||null;this.trigger_up('discard_changes',{recordID:recordID,onSuccess:()=>{if(nextRowIndex!==null){if(!record.res_id){nextRowIndex--;}
this._selectCell(nextRowIndex,cellIndex,cellOptions);}else{this._selectCell(borderRowIndex,cellIndex,cellOptions);}},});return;}}else{nextRowIndex=$nextRow.length?($nextRow.prop('rowIndex')-1):borderRowIndex;}}
if(nextRowIndex!==null){this._selectCell(nextRowIndex,cellIndex,cellOptions);}else if(this.editable){this.unselectRow().then(this.trigger_up.bind(this,'add_record',{groupId:groupId,onFail:this._selectCell.bind(this,borderRowIndex,cellIndex,cellOptions),}));}});},_processColumns:function(){const oldColumns=this.columns;this._super.apply(this,arguments);if(this.columnWidths&&oldColumns&&oldColumns.length===this.columns.length){for(let i=0;i<oldColumns.length;i++){if(oldColumns[i]!==this.columns[i]){this.columnWidths=false;break;}}}else{this.columnWidths=false;}},_render:function(){this.currentRow=null;this.currentFieldIndex=null;return this._super.apply(this,arguments);},_renderGroup:function(group){var result=this._super.apply(this,arguments);if(!group.groupedBy.length&&this.addCreateLineInGroups){var $groupBody=result[0];var $a=$('<a href="#" role="button">').text(_t("Add a line")).attr('data-group-id',group.id);var $td=$('<td>').attr('colspan',this._getNumberOfCols()).addClass('o_group_field_row_add').attr('tabindex',-1).append($a);var $tr=$('<tr>',{class:'o_add_record_row'}).attr('data-group-id',group.id).append($td);$groupBody.append($tr.prepend($('<td>').html('&nbsp;')));}
return result;},_renderBody:function(){var self=this;var $body=this._super.apply(this,arguments);if(this.hasHandle){$body.sortable({axis:'y',items:'> tr.o_data_row',helper:'clone',handle:'.o_row_handle',stop:function(event,ui){if(self.currentRow!==null){var currentID=self.state.data[self.currentRow].id;self.currentRow=self._getRow(currentID).index();}
self.unselectRow().then(function(){self._moveRecord(ui.item.data('id'),ui.item.index());});},});}
return $body;},_renderFooter:function(){const $footer=this._super.apply(this,arguments);if(this.addTrashIcon){$footer.find('tr').append($('<td>'));}
return $footer;},_renderHeader:function(){var $thead=this._super.apply(this,arguments);if(this.addTrashIcon){$thead.find('tr').append($('<th>',{class:'o_list_record_remove_header'}));}
return $thead;},_renderHeaderCell:function(){const $th=this._super.apply(this,arguments);if($th[0].innerHTML.length&&this._hasVisibleRecords(this.state)){const resizeHandle=document.createElement('span');resizeHandle.classList='o_resize';resizeHandle.onclick=this._onClickResize.bind(this);resizeHandle.onmousedown=this._onStartResize.bind(this);$th.append(resizeHandle);}
return $th;},_renderRow:function(record,index){var $row=this._super.apply(this,arguments);if(this.addTrashIcon){var $icon=this.isMany2Many?$('<button>',{'class':'fa fa-times','name':'unlink','aria-label':_t('Unlink row ')+(index+1)}):$('<button>',{'class':'fa fa-trash-o','name':'delete','aria-label':_t('Delete row ')+(index+1)});var $td=$('<td>',{class:'o_list_record_remove'}).append($icon);$row.append($td);}
return $row;},_renderRows:function(){var $rows=this._super();if(this.addCreateLine){var $tr=$('<tr>');var colspan=this._getNumberOfCols();if(this.handleField){colspan=colspan-1;$tr.append('<td>');}
var $td=$('<td>').attr('colspan',colspan).addClass('o_field_x2many_list_row_add');$tr.append($td);$rows.push($tr);if(this.addCreateLine){_.each(this.creates,function(create,index){var $a=$('<a href="#" role="button">').attr('data-context',create.context).text(create.string);if(index>0){$a.addClass('ml16');}
$td.append($a);});}}
return $rows;},_renderView:function(){this.currentRow=null;return this._super.apply(this,arguments).then(()=>{const table=this.el.getElementsByClassName('o_list_table')[0];if(table){table.classList.toggle('o_empty_list',!this._hasVisibleRecords(this.state));this._freezeColumnWidths();}});},_selectCell:function(rowIndex,fieldIndex,options){options=options||{};if(!options.force&&rowIndex===this.currentRow&&fieldIndex===this.currentFieldIndex){return Promise.resolve();}
var wrap=options.wrap===undefined?true:options.wrap;var recordID=this._getRecordID(rowIndex);var self=this;return this._selectRow(rowIndex).then(function(){var record=self._getRecord(recordID);if(fieldIndex>=(self.allFieldWidgets[record.id]||[]).length){return Promise.reject();}
var oldFieldIndex=self.currentFieldIndex;self.currentFieldIndex=fieldIndex;fieldIndex=self._activateFieldWidget(record,fieldIndex,{inc:options.inc||1,wrap:wrap,event:options&&options.event,});if(fieldIndex<0){self.currentFieldIndex=oldFieldIndex;return Promise.reject();}
self.currentFieldIndex=fieldIndex;});},_selectRow:function(rowIndex){if(rowIndex===this.currentRow){return Promise.resolve();}
if(!this.columnWidths){this._storeColumnWidths();}
var recordId=this._getRecordID(rowIndex);var self=this;return this.unselectRow().then((selectNextRow=true)=>{if(!selectNextRow){return Promise.resolve();}
if(!recordId){return Promise.reject();}
return new Promise(function(resolve){self.trigger_up('edit_line',{recordId:recordId,onSuccess:function(){self._disableRecordSelectors();resolve();},});});});},_squeezeTable:function(){const table=this.el.getElementsByClassName('o_list_table')[0];table.classList.add('o_list_computing_widths');const thead=table.getElementsByTagName('thead')[0];const thElements=[...thead.getElementsByTagName('th')];const columnWidths=thElements.map(th=>th.offsetWidth);const getWidth=th=>columnWidths[thElements.indexOf(th)]||0;const getTotalWidth=()=>thElements.reduce((tot,th,i)=>tot+columnWidths[i],0);const shrinkColumns=(columns,width)=>{let thresholdReached=false;columns.forEach(th=>{const index=thElements.indexOf(th);let maxWidth=columnWidths[index]-Math.ceil(width/columns.length);if(maxWidth<92){maxWidth=92;thresholdReached=true;}
th.style.maxWidth=`${maxWidth}px`;columnWidths[index]=maxWidth;});return thresholdReached;};const sortedThs=[...thead.querySelectorAll('th:not(.o_list_button)')].sort((a,b)=>getWidth(b)-getWidth(a));const allowedWidth=table.parentNode.offsetWidth;let totalWidth=getTotalWidth();let stop=false;let index=0;while(totalWidth>allowedWidth&&!stop){index++;const largests=sortedThs.slice(0,index);while(getWidth(largests[0])===getWidth(sortedThs[index])){largests.push(sortedThs[index]);index++;}
const nextLargest=sortedThs[index];const totalToRemove=totalWidth-allowedWidth;const canRemove=(getWidth(largests[0])-getWidth(nextLargest))*largests.length;stop=shrinkColumns(largests,Math.min(totalToRemove,canRemove));totalWidth=getTotalWidth();}
table.classList.remove('o_list_computing_widths');return columnWidths;},_storeColumnWidths:function(){this.columnWidths=this.$('thead th').toArray().map(function(th){return $(th).outerWidth();});},_onAddRecordToGroup:function(ev){ev.preventDefault();ev.stopPropagation();var self=this;const target=ev.target.tagName!=='A'?ev.target.getElementsByTagName('A')[0]:ev.target;const groupId=target.dataset.groupId;this.currentGroupId=groupId;this.unselectRow().then(function(){self.trigger_up('add_record',{groupId:groupId,});});},_onAddRecord:function(ev){ev.preventDefault();ev.stopPropagation();var self=this;this.unselectRow().then(function(){self.trigger_up('add_record',{context:ev.currentTarget.dataset.context&&[ev.currentTarget.dataset.context]});});},_onCellClick:function(event){var $td=$(event.currentTarget);var $tr=$td.parent();var rowIndex=$tr.prop('rowIndex')-1;if(!this._isRecordEditable($tr.data('id'))||$(event.target).prop('special_click')){return;}
var fieldIndex=Math.max($tr.find('.o_field_cell').index($td),0);this._selectCell(rowIndex,fieldIndex,{event:event});},_onClickResize:function(ev){ev.stopPropagation();ev.preventDefault();},_onEmptyRowClick:function(){this.unselectRow();},_onFooterClick:function(){this.unselectRow();},_onKeyDown:function(ev){const $target=$(ev.currentTarget);const $tr=$target.closest('tr');const recordEditable=this._isRecordEditable($tr.data('id'));if(recordEditable&&ev.keyCode===$.ui.keyCode.ENTER&&$tr.hasClass('o_selected_row')){return;}
if(recordEditable&&ev.keyCode===$.ui.keyCode.ENTER&&!$tr.hasClass('o_selected_row')&&!$tr.hasClass('o_group_header')){ev.stopPropagation();ev.preventDefault();if($target.closest('td').hasClass('o_group_field_row_add')){this._onAddRecordToGroup(ev);}else{this._onCellClick(ev);}}else{this._super.apply(this,arguments);}},_onKeyDownAddRecord:function(e){switch(e.keyCode){case $.ui.keyCode.ENTER:e.stopPropagation();e.preventDefault();this._onAddRecord(e);break;}},_onNavigationMove:function(ev){var self=this;if(this.currentRow===null&&ev.data.direction==='up'){return;}
ev.stopPropagation();if(ev.data.originalEvent&&['next','previous'].includes(ev.data.direction)){ev.data.originalEvent.preventDefault();ev.data.originalEvent.stopPropagation();}
switch(ev.data.direction){case'previous':if(this.currentFieldIndex>0){this._selectCell(this.currentRow,this.currentFieldIndex-1,{inc:-1,wrap:false}).guardedCatch(this._moveToPreviousLine.bind(this));}else{this._moveToPreviousLine();}
break;case'next':if(this.currentFieldIndex+1<this.columns.length){this._selectCell(this.currentRow,this.currentFieldIndex+1,{wrap:false}).guardedCatch(this._moveToNextLine.bind(this));}else{this._moveToNextLine();}
break;case'next_line':if(!this.editable&&this.selection.length===1&&this._getRecordID(this.currentRow)===ev.target.dataPointID){this.unselectRow();}else{this._moveToNextLine({forceCreate:true});}
break;case'cancel':ev.data.originalEvent.stopPropagation();var rowIndex=this.currentRow;var cellIndex=this.currentFieldIndex+1;this.trigger_up('discard_changes',{recordID:ev.target.dataPointID,onSuccess:function(){self._enableRecordSelectors();var recordId=self._getRecordID(rowIndex);if(recordId){var correspondingRow=self._getRow(recordId);correspondingRow.children().eq(cellIndex).focus();}else if(self.currentGroupId){self.$('a[data-group-id="'+self.currentGroupId+'"]').focus();}else{self.$('.o_field_x2many_list_row_add a:first').focus();}}});break;}},_onRemoveIconClick:function(event){event.stopPropagation();var $row=$(event.target).closest('tr');var id=$row.data('id');if($row.hasClass('o_selected_row')){this.trigger_up('list_record_remove',{id:id});}else{var self=this;this.unselectRow().then(function(){self.trigger_up('list_record_remove',{id:id});});}},_onResize:function(){this.columnWidths=false;this._freezeColumnWidths();},_onRowClicked:function(ev){if(!this._isRecordEditable(ev.currentTarget.dataset.id)){if(this.getEditableRecordID()){this.unselectRow();}else{this._super.apply(this,arguments);}}},_onSortColumn:function(){if(this.currentRow===null&&!this.isResizing){this._super.apply(this,arguments);}},_onStartResize:function(ev){if(ev.which!==1){return;}
ev.preventDefault();ev.stopPropagation();this.isResizing=true;const table=this.el.getElementsByClassName('o_list_table')[0];const th=ev.target.closest('th');table.style.width=`${table.offsetWidth}px`;const thPosition=[...th.parentNode.children].indexOf(th);const resizingColumnElements=[...table.getElementsByTagName('tr')].filter(tr=>tr.children.length===th.parentNode.children.length).map(tr=>tr.children[thPosition]);const optionalDropdown=this.el.getElementsByClassName('o_optional_columns')[0];const initialX=ev.pageX;const initialWidth=th.offsetWidth;const initialTableWidth=table.offsetWidth;const initialDropdownX=optionalDropdown?optionalDropdown.offsetLeft:null;const resizeStoppingEvents=['keydown','mousedown','mouseup',];if(!this.el.style.width){this.el.style.width=`${initialTableWidth}px`;}
table.classList.add('o_resizing');resizingColumnElements.forEach(el=>el.classList.add('o_column_resizing'));const resizeHeader=ev=>{ev.preventDefault();ev.stopPropagation();const delta=ev.pageX-initialX;const newWidth=Math.max(10,initialWidth+delta);const tableDelta=newWidth-initialWidth;th.style.width=`${newWidth}px`;table.style.width=`${initialTableWidth + tableDelta}px`;if(optionalDropdown){optionalDropdown.style.left=`${initialDropdownX + tableDelta}px`;}};this._addEventListener('mousemove',window,resizeHeader);const stopResize=ev=>{if(ev.type==='mousedown'&&ev.which===1){return;}
ev.preventDefault();ev.stopPropagation();clearTimeout(this.resizeTimeout);this.resizeTimeout=setTimeout(()=>{this.isResizing=false;},100);window.removeEventListener('mousemove',resizeHeader);table.classList.remove('o_resizing');resizingColumnElements.forEach(el=>el.classList.remove('o_column_resizing'));resizeStoppingEvents.forEach(stoppingEvent=>{window.removeEventListener(stoppingEvent,stopResize);});document.activeElement.blur();};resizeStoppingEvents.forEach(stoppingEvent=>{this._addEventListener(stoppingEvent,window,stopResize);});},_onToggleOptionalColumnDropdown:function(ev){this.unselectRow().then(this._super.bind(this,ev));},_onWindowClicked:function(event){if(!this.isEditable()){return;}
if(!document.contains(this.el)){return;}
if(this.currentRow===null){return;}
if($(event.target).parents('.ui-autocomplete').length){return;}
var $clickModal=$(event.target).closest('.modal');if($clickModal.length){var $listModal=this.$el.closest('.modal');if($clickModal.prop('id')!==$listModal.prop('id')){return;}}
if(!document.contains(event.target)){return;}
if(this.el.contains(event.target)&&this.el!==event.target){return;}
this.unselectRow();},});});;

/* /web/static/src/js/views/list/list_model.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.ListModel',function(require){"use strict";var BasicModel=require('web.BasicModel');var ListModel=BasicModel.extend({init:function(parent,params){this._super.apply(this,arguments);this.groupbys=params.groupbys;},__get:function(){var result=this._super.apply(this,arguments);var dp=result&&this.localData[result.id];if(dp&&dp.groupData){result.groupData=this.get(dp.groupData);}
return result;},saveRecords:function(listDatapointId,referenceRecordId,recordIds,fieldName){var self=this;var referenceRecord=this.localData[referenceRecordId];var list=this.localData[listDatapointId];var allChanges=this._generateChanges(referenceRecord,{changesOnly:false});var changes=_.pick(allChanges,fieldName);var records=recordIds.map(function(recordId){return self.localData[recordId];});var model=records[0].model;var recordResIds=_.pluck(records,'res_id');var fieldNames=records[0].getFieldNames();var context=records[0].getContext();return this._rpc({model:model,method:'write',args:[recordResIds,changes],context:context,}).then(function(){return self._rpc({model:model,method:'read',args:[recordResIds,fieldNames],context:context,});}).then(function(results){results.forEach(function(data){var record=_.findWhere(records,{res_id:data.id});record.data=_.extend({},record.data,data);record._changes={};record._isDirty=false;self._parseServerData(fieldNames,record,record.data);});}).then(function(){return Promise.all([self._fetchX2ManysBatched(list),self._fetchReferencesBatched(list)]);});},_readGroup:function(list,options){var self=this;options=options||{};options.fetchRecordsWithGroups=true;return this._super(list,options).then(function(result){return self._readGroupExtraFields(list).then(_.constant(result));});},_readGroupExtraFields:function(list){var self=this;var groupByFieldName=list.groupedBy[0].split(':')[0];var groupedByField=list.fields[groupByFieldName];if(groupedByField.type!=='many2one'||!this.groupbys[groupByFieldName]){return Promise.resolve();}
var groupIds=_.reduce(list.data,function(groupIds,id){var resId=self.get(id,{raw:true}).res_id;if(resId){groupIds.push(resId);}
return groupIds;},[]);var groupFields=Object.keys(this.groupbys[groupByFieldName].viewFields);var prom;if(groupIds.length&&groupFields.length){prom=this._rpc({model:groupedByField.relation,method:'read',args:[groupIds,groupFields],context:list.context,});}
return Promise.resolve(prom).then(function(result){var fvg=self.groupbys[groupByFieldName];_.each(list.data,function(id){var dp=self.localData[id];var groupData=result&&_.findWhere(result,{id:dp.res_id,});var groupDp=self._makeDataPoint({context:dp.context,data:groupData,fields:fvg.fields,fieldsInfo:fvg.fieldsInfo,modelName:groupedByField.relation,parentID:dp.id,res_id:dp.res_id,viewType:'groupby',});dp.groupData=groupDp.id;});});},});return ListModel;});;

/* /web/static/src/js/views/list/list_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.ListRenderer',function(require){"use strict";var BasicRenderer=require('web.BasicRenderer');const{ComponentWrapper}=require('web.OwlCompatibility');var config=require('web.config');var core=require('web.core');var dom=require('web.dom');var field_utils=require('web.field_utils');var Pager=require('web.Pager');var utils=require('web.utils');var viewUtils=require('web.viewUtils');var _t=core._t;var DECORATIONS=['decoration-bf','decoration-it','decoration-danger','decoration-info','decoration-muted','decoration-primary','decoration-success','decoration-warning'];var FIELD_CLASSES={char:'o_list_char',float:'o_list_number',integer:'o_list_number',monetary:'o_list_number',text:'o_list_text',many2one:'o_list_many2one',};var ListRenderer=BasicRenderer.extend({className:'o_list_view',events:{"mousedown":"_onMouseDown","click .o_optional_columns_dropdown .dropdown-item":"_onToggleOptionalColumn","click .o_optional_columns_dropdown_toggle":"_onToggleOptionalColumnDropdown",'click tbody tr':'_onRowClicked','change tbody .o_list_record_selector':'_onSelectRecord','click thead th.o_column_sortable':'_onSortColumn','click .o_list_record_selector':'_onToggleCheckbox','click .o_group_header':'_onToggleGroup','change thead .o_list_record_selector input':'_onToggleSelection','keypress thead tr td':'_onKeyPress','keydown td':'_onKeyDown','keydown th':'_onKeyDown',},sampleDataTargets:['.o_data_row','.o_group_header','.o_list_table > tfoot','.o_list_table > thead .o_list_record_selector',],init:function(parent,state,params){this._super.apply(this,arguments);this._preprocessColumns();this.columnInvisibleFields=params.columnInvisibleFields||{};this.rowDecorations=this._extractDecorationAttrs(this.arch);this.fieldDecorations={};for(const field of this.arch.children.filter(c=>c.tag==='field')){const decorations=this._extractDecorationAttrs(field);this.fieldDecorations[field.attrs.name]=decorations;}
this.hasSelectors=params.hasSelectors;this.selection=params.selectedRecords||[];this.pagers=[];this.isGrouped=this.state.groupedBy.length>0;this.groupbys=params.groupbys;},willStart:function(){this._processColumns(this.columnInvisibleFields);return this._super.apply(this,arguments);},giveFocus:function(){this.$('th:eq(0) input, th:eq(1)').first().focus();},updateState:function(state,params){this._setState(state);this.isGrouped=this.state.groupedBy.length>0;this.columnInvisibleFields=params.columnInvisibleFields||{};this._processColumns(this.columnInvisibleFields);if(params.selectedRecords){this.selection=params.selectedRecords;}
return this._super.apply(this,arguments);},_computeAggregates:function(){var self=this;var data=[];if(this.selection.length){utils.traverse_records(this.state,function(record){if(_.contains(self.selection,record.id)){data.push(record);}});}else{data=this.state.data;}
_.each(this.columns,this._computeColumnAggregates.bind(this,data));},_computeColumnAggregates:function(data,column){var attrs=column.attrs;var field=this.state.fields[attrs.name];if(!field){return;}
var type=field.type;if(type!=='integer'&&type!=='float'&&type!=='monetary'){return;}
var func=(attrs.sum&&'sum')||(attrs.avg&&'avg')||(attrs.max&&'max')||(attrs.min&&'min');if(func){var count=0;var aggregateValue=0;if(func==='max'){aggregateValue=-Infinity;}else if(func==='min'){aggregateValue=Infinity;}
_.each(data,function(d){count+=1;var value=(d.type==='record')?d.data[attrs.name]:d.aggregateValues[attrs.name];if(func==='avg'){aggregateValue+=value;}else if(func==='sum'){aggregateValue+=value;}else if(func==='max'){aggregateValue=Math.max(aggregateValue,value);}else if(func==='min'){aggregateValue=Math.min(aggregateValue,value);}});if(func==='avg'){aggregateValue=count?aggregateValue/count:aggregateValue;}
column.aggregate={help:attrs[func],value:aggregateValue,};}},_extractDecorationAttrs:function(node){const decorations={};for(const[key,expr]of Object.entries(node.attrs)){if(DECORATIONS.includes(key)){const cssClass=key.replace('decoration','text');decorations[cssClass]=py.parse(py.tokenize(expr));}}
return decorations;},_findConnectedCell:function($cell,direction,colIndex){var $connectedRow=$cell.closest('tr')[direction]('tr');if(!$connectedRow.length){var tbody=$cell.closest('tbody, thead');var $connectedGroup=tbody[direction]('tbody, thead');if($connectedGroup.length){var $connectedRows=$connectedGroup.find('tr');var rowIndex;if(direction==='prev'){rowIndex=$connectedRows.length-1;}else{rowIndex=0;}
$connectedRow=$connectedRows.eq(rowIndex);}else{return;}}
var $connectedCell;if($connectedRow.hasClass('o_group_header')){$connectedCell=$connectedRow.children();this.currentColIndex=colIndex;}else if($connectedRow.has('td.o_group_field_row_add').length){$connectedCell=$connectedRow.find('.o_group_field_row_add');this.currentColIndex=colIndex;}else{var connectedRowChildren=$connectedRow.children();if(colIndex===-1){colIndex=connectedRowChildren.length-1;}
$connectedCell=connectedRowChildren.eq(colIndex);}
return $connectedCell;},_getNumberOfCols:function(){var n=this.columns.length;return this.hasSelectors?n+1:n;},_getOptionalColumnsStorageKeyParts:function(){var self=this;return{fields:_.map(this.state.fieldsInfo[this.viewType],function(_,fieldName){return{name:fieldName,type:self.state.fields[fieldName].type};}),};},_groupAdjacentButtons:function(){const children=[];let groupId=0;let buttonGroupNode=null;for(const c of this.arch.children){if(c.tag==='button'){if(!buttonGroupNode){buttonGroupNode={tag:'button_group',children:[c],attrs:{name:`button_group_${groupId++}`,modifiers:{},},};children.push(buttonGroupNode);}else{buttonGroupNode.children.push(c);}}else{buttonGroupNode=null;children.push(c);}}
this.arch.children=children;},_preprocessColumns:function(){this._processModeClassNames();this._groupAdjacentButtons();this.arch.children.filter(c=>c.tag==='button_group').forEach(c=>{c.attrs.editOnly=c.children.every(n=>n.attrs.editOnly);c.attrs.readOnly=c.children.every(n=>n.attrs.readOnly);});},_processColumns:function(columnInvisibleFields){var self=this;this.handleField=null;this.columns=[];this.optionalColumns=[];this.optionalColumnsEnabled=[];var storedOptionalColumns;this.trigger_up('load_optional_fields',{keyParts:this._getOptionalColumnsStorageKeyParts(),callback:function(res){storedOptionalColumns=res;},});_.each(this.arch.children,function(c){if(c.tag!=='control'&&c.tag!=='groupby'&&c.tag!=='header'){var reject=c.attrs.modifiers.column_invisible;if(c.tag==="button_group"){reject=c.children.every(child=>columnInvisibleFields[child.attrs.name]);}else if(c.attrs.name in columnInvisibleFields){reject=columnInvisibleFields[c.attrs.name];}
if(!reject&&c.attrs.widget==='handle'){self.handleField=c.attrs.name;if(self.isGrouped){reject=true;}}
if(!reject&&c.attrs.optional){self.optionalColumns.push(c);var enabled;if(storedOptionalColumns===undefined){enabled=c.attrs.optional==='show';}else{enabled=_.contains(storedOptionalColumns,c.attrs.name);}
if(enabled){self.optionalColumnsEnabled.push(c.attrs.name);}
reject=!enabled;}
if(!reject){self.columns.push(c);}}});},_processModeClassNames:function(){this.arch.children.forEach(c=>{if(c.attrs.class){c.attrs.editOnly=/\boe_edit_only\b/.test(c.attrs.class);c.attrs.readOnly=/\boe_read_only\b/.test(c.attrs.class);}});},_renderAggregateCells:function(aggregateValues){var self=this;return _.map(this.columns,function(column){var $cell=$('<td>');if(config.isDebug()){$cell.addClass(column.attrs.name);}
if(column.attrs.editOnly){$cell.addClass('oe_edit_only');}
if(column.attrs.readOnly){$cell.addClass('oe_read_only');}
if(column.attrs.name in aggregateValues){var field=self.state.fields[column.attrs.name];var value=aggregateValues[column.attrs.name].value;var help=aggregateValues[column.attrs.name].help;var formatFunc=field_utils.format[column.attrs.widget];if(!formatFunc){formatFunc=field_utils.format[field.type];}
var formattedValue=formatFunc(value,field,{escape:true,digits:column.attrs.digits?JSON.parse(column.attrs.digits):undefined,});$cell.addClass('o_list_number').attr('title',help).html(formattedValue);}
return $cell;});},_renderBody:function(){var self=this;var $rows=this._renderRows();while($rows.length<4){$rows.push(self._renderEmptyRow());}
return $('<tbody>').append($rows);},_renderBodyCell:function(record,node,colIndex,options){var tdClassName='o_data_cell';if(node.tag==='button_group'){tdClassName+=' o_list_button';}else if(node.tag==='field'){tdClassName+=' o_field_cell';var typeClass=FIELD_CLASSES[this.state.fields[node.attrs.name].type];if(typeClass){tdClassName+=(' '+typeClass);}
if(node.attrs.widget){tdClassName+=(' o_'+node.attrs.widget+'_cell');}}
if(node.attrs.editOnly){tdClassName+=' oe_edit_only';}
if(node.attrs.readOnly){tdClassName+=' oe_read_only';}
var $td=$('<td>',{class:tdClassName,tabindex:-1});var modifiers=this._registerModifiers(node,record,$td,_.pick(options,'mode'));if(modifiers.invisible&&!(options&&options.renderInvisible)){return $td;}
if(node.tag==='button_group'){for(const buttonNode of node.children){if(!this.columnInvisibleFields[buttonNode.attrs.name]){$td.append(this._renderButton(record,buttonNode));}}
return $td;}else if(node.tag==='widget'){return $td.append(this._renderWidget(record,node));}
if(node.attrs.widget||(options&&options.renderWidgets)){var $el=this._renderFieldWidget(node,record,_.pick(options,'mode'));return $td.append($el);}
this._handleAttributes($td,node);this._setDecorationClasses($td,this.fieldDecorations[node.attrs.name],record);var name=node.attrs.name;var field=this.state.fields[name];var value=record.data[name];var formatter=field_utils.format[field.type];var formatOptions={escape:true,data:record.data,isPassword:'password'in node.attrs,digits:node.attrs.digits&&JSON.parse(node.attrs.digits),};var formattedValue=formatter(value,field,formatOptions);var title='';if(field.type!=='boolean'){title=formatter(value,field,_.extend(formatOptions,{escape:false}));}
return $td.html(formattedValue).attr('title',title);},_renderButton:function(record,node){var self=this;var nodeWithoutWidth=Object.assign({},node);delete nodeWithoutWidth.attrs.width;let extraClass='';if(node.attrs.icon){const btnStyleRegex=/\bbtn-[a-z]+\b/;if(!btnStyleRegex.test(nodeWithoutWidth.attrs.class)){extraClass='btn-link o_icon_button';}}
var $button=viewUtils.renderButtonFromNode(nodeWithoutWidth,{extraClass:extraClass,});this._handleAttributes($button,node);this._registerModifiers(node,record,$button);if(record.res_id){$button.on("click",function(e){e.stopPropagation();self.trigger_up('button_clicked',{attrs:node.attrs,record:record,});});}else{if(node.attrs.options.warn){$button.on("click",function(e){e.stopPropagation();self.do_warn(false,_t('Please click on the "save" button first'));});}else{$button.prop('disabled',true);}}
return $button;},_renderEmptyRow:function(){var $td=$('<td>&nbsp;</td>').attr('colspan',this._getNumberOfCols());return $('<tr>').append($td);},_renderFooter:function(){var aggregates={};_.each(this.columns,function(column){if('aggregate'in column){aggregates[column.attrs.name]=column.aggregate;}});var $cells=this._renderAggregateCells(aggregates);if(this.hasSelectors){$cells.unshift($('<td>'));}
return $('<tfoot>').append($('<tr>').append($cells));},_renderGroupButton:function(list,node){var $button=viewUtils.renderButtonFromNode(node,{extraClass:node.attrs.icon?'o_icon_button':undefined,textAsTitle:!!node.attrs.icon,});this._handleAttributes($button,node);this._registerModifiers(node,list.groupData,$button);$button.on("click",this._onGroupButtonClicked.bind(this,list.groupData,node));$button.on("keydown",this._onGroupButtonKeydown.bind(this));return $button;},_renderGroupButtons:function(list,group){var self=this;var $buttons=$();if(list.value){group.arch.children.forEach(function(child){if(child.tag==='button'){$buttons=$buttons.add(self._renderGroupButton(list,child));}});}
return $buttons;},_renderGroupRow:function(group,groupLevel){var cells=[];var name=group.value===undefined?_t('Undefined'):group.value;var groupBy=this.state.groupedBy[groupLevel];if(group.fields[groupBy.split(':')[0]].type!=='boolean'){name=name||_t('Undefined');}
var $th=$('<th>').addClass('o_group_name').attr('tabindex',-1).text(name+' ('+group.count+')');var $arrow=$('<span>').css('padding-left',2+(groupLevel*20)+'px').css('padding-right','5px').addClass('fa');if(group.count>0){$arrow.toggleClass('fa-caret-right',!group.isOpen).toggleClass('fa-caret-down',group.isOpen);}
$th.prepend($arrow);cells.push($th);var aggregateKeys=Object.keys(group.aggregateValues);var aggregateValues=_.mapObject(group.aggregateValues,function(value){return{value:value};});var aggregateCells=this._renderAggregateCells(aggregateValues);var firstAggregateIndex=_.findIndex(this.columns,function(column){return column.tag==='field'&&_.contains(aggregateKeys,column.attrs.name);});var colspanBeforeAggregate;if(firstAggregateIndex!==-1){colspanBeforeAggregate=firstAggregateIndex;var lastAggregateIndex=_.findLastIndex(this.columns,function(column){return column.tag==='field'&&_.contains(aggregateKeys,column.attrs.name);});cells=cells.concat(aggregateCells.slice(firstAggregateIndex,lastAggregateIndex+1));var colSpan=this.columns.length-1-lastAggregateIndex;if(colSpan>0){cells.push($('<th>').attr('colspan',colSpan));}}else{var colN=this.columns.length;colspanBeforeAggregate=colN>1?colN-1:1;if(colN>1){cells.push($('<th>'));}}
if(this.hasSelectors){colspanBeforeAggregate+=1;}
$th.attr('colspan',colspanBeforeAggregate);if(group.isOpen&&!group.groupedBy.length&&(group.count>group.data.length)){const lastCell=cells[cells.length-1][0];this._renderGroupPager(group,lastCell);}
if(group.isOpen&&this.groupbys[groupBy]){var $buttons=this._renderGroupButtons(group,this.groupbys[groupBy]);if($buttons.length){var $buttonSection=$('<div>',{class:'o_group_buttons',}).append($buttons);$th.append($buttonSection);}}
return $('<tr>').addClass('o_group_header').toggleClass('o_group_open',group.isOpen).toggleClass('o_group_has_content',group.count>0).data('group',group).append(cells);},_renderGroup:function(group,groupLevel){var self=this;if(group.groupedBy.length){return this._renderGroups(group.data,groupLevel+1);}else{var $records=_.map(group.data,function(record){return self._renderRow(record);});return[$('<tbody>').append($records)];}},_renderGroupPager:function(group,target){const currentMinimum=group.offset+1;const limit=group.limit;const size=group.count;if(!this._shouldRenderPager(currentMinimum,limit,size)){return;}
const pager=new ComponentWrapper(this,Pager,{currentMinimum,limit,size});const pagerMounting=pager.mount(target).then(()=>{pager.el.addEventListener('pager-changed',ev=>this._onPagerChanged(ev,group));pager.el.addEventListener('click',ev=>ev.stopPropagation());});this.defs.push(pagerMounting);this.pagers.push(pager);},_renderGroups:function(data,groupLevel){var self=this;groupLevel=groupLevel||0;var result=[];var $tbody=$('<tbody>');_.each(data,function(group){if(!$tbody){$tbody=$('<tbody>');}
$tbody.append(self._renderGroupRow(group,groupLevel));if(group.data.length){result.push($tbody);result=result.concat(self._renderGroup(group,groupLevel));$tbody=null;}});if($tbody){result.push($tbody);}
return result;},_renderHeader:function(){var $tr=$('<tr>').append(_.map(this.columns,this._renderHeaderCell.bind(this)));if(this.hasSelectors){$tr.prepend(this._renderSelector('th'));}
return $('<thead>').append($tr);},_renderHeaderCell:function(node){const{icon,name,string}=node.attrs;var order=this.state.orderedBy;var isNodeSorted=order[0]&&order[0].name===name;var field=this.state.fields[name];var $th=$('<th>');if(name){$th.attr('data-name',name);}else if(string){$th.attr('data-string',string);}else if(icon){$th.attr('data-icon',icon);}
if(node.attrs.editOnly){$th.addClass('oe_edit_only');}
if(node.attrs.readOnly){$th.addClass('oe_read_only');}
if(node.tag==='button_group'){$th.addClass('o_list_button');}
if(!field||node.attrs.nolabel==='1'){return $th;}
var description=string||field.string;if(node.attrs.widget){$th.addClass(' o_'+node.attrs.widget+'_cell');const FieldWidget=this.state.fieldsInfo.list[name].Widget;if(FieldWidget.prototype.noLabel){description='';}else if(FieldWidget.prototype.label){description=FieldWidget.prototype.label;}}
$th.text(description).attr('tabindex',-1).toggleClass('o-sort-down',isNodeSorted?!order[0].asc:false).toggleClass('o-sort-up',isNodeSorted?order[0].asc:false).addClass((field.sortable||this.state.fieldsInfo.list[name].options.allow_order||false)&&'o_column_sortable');if(isNodeSorted){$th.attr('aria-sort',order[0].asc?'ascending':'descending');}
if(field.type==='float'||field.type==='integer'||field.type==='monetary'){$th.addClass('o_list_number_th');}
if(config.isDebug()){var fieldDescr={field:field,name:name,string:description||name,record:this.state,attrs:_.extend({},node.attrs,this.state.fieldsInfo.list[name]),};this._addFieldTooltip(fieldDescr,$th);}else{$th.attr('title',description);}
return $th;},_renderRow:function(record){var self=this;var $cells=this.columns.map(function(node,index){return self._renderBodyCell(record,node,index,{mode:'readonly'});});var $tr=$('<tr/>',{class:'o_data_row'}).attr('data-id',record.id).append($cells);if(this.hasSelectors){$tr.prepend(this._renderSelector('td',!record.res_id));}
this._setDecorationClasses($tr,this.rowDecorations,record);return $tr;},_renderRows:function(){return this.state.data.map(this._renderRow.bind(this));},_renderOptionalColumnsDropdown:function(){var self=this;var $optionalColumnsDropdown=$('<div>',{class:'o_optional_columns text-center dropdown',});var $a=$("<a>",{'class':"dropdown-toggle text-dark o-no-caret",'href':"#",'role':"button",'data-toggle':"dropdown",'data-display':"static",'aria-expanded':false,});$a.appendTo($optionalColumnsDropdown);var direction=_t.database.parameters.direction;var dropdownMenuClass=direction==='rtl'?'dropdown-menu-left':'dropdown-menu-right';var $dropdown=$("<div>",{class:'dropdown-menu o_optional_columns_dropdown '+dropdownMenuClass,role:'menu',});this.optionalColumns.forEach(function(col){var txt=(col.attrs.string||self.state.fields[col.attrs.name].string)+
(config.isDebug()?(' ('+col.attrs.name+')'):'');var $checkbox=dom.renderCheckbox({text:txt,prop:{name:col.attrs.name,checked:_.contains(self.optionalColumnsEnabled,col.attrs.name),}});$dropdown.append($("<div>",{class:"dropdown-item",}).append($checkbox));});$dropdown.appendTo($optionalColumnsDropdown);return $optionalColumnsDropdown;},_renderSelector:function(tag,disableInput){var $content=dom.renderCheckbox();if(disableInput){$content.find("input[type='checkbox']").prop('disabled',disableInput);}
return $('<'+tag+'>').addClass('o_list_record_selector').append($content);},async _renderView(){const oldPagers=this.pagers;let prom;let tableWrapper;if(this.state.count>0||!this.noContentHelp){this.pagers=[];const orderedBy=this.state.orderedBy;this.hasHandle=orderedBy.length===0||orderedBy[0].name===this.handleField;this._computeAggregates();const $table=$('<table class="o_list_table table table-sm table-hover table-striped"/>');$table.toggleClass('o_list_table_grouped',this.isGrouped);$table.toggleClass('o_list_table_ungrouped',!this.isGrouped);const defs=[];this.defs=defs;if(this.isGrouped){$table.append(this._renderHeader());$table.append(this._renderGroups(this.state.data));$table.append(this._renderFooter());}else{$table.append(this._renderHeader());$table.append(this._renderBody());$table.append(this._renderFooter());}
tableWrapper=Object.assign(document.createElement('div'),{className:'table-responsive',});tableWrapper.appendChild($table[0]);delete this.defs;prom=Promise.all(defs);}
await Promise.all([this._super.apply(this,arguments),prom]);this.el.innerHTML="";this.el.classList.remove('o_list_optional_columns');oldPagers.forEach(pager=>pager.destroy());if(tableWrapper){this.el.appendChild(tableWrapper);if(document.body.contains(this.el)){this.pagers.forEach(pager=>pager.on_attach_callback());}
if(this.optionalColumns.length){this.el.classList.add('o_list_optional_columns');this.$('table').append($('<i class="o_optional_columns_dropdown_toggle fa fa-ellipsis-v"/>'));this.$('table').append(this._renderOptionalColumnsDropdown());}
if(this.selection.length){const $checked_rows=this.$('tr').filter((i,el)=>this.selection.includes(el.dataset.id));$checked_rows.find('.o_list_record_selector input').prop('checked',true);if($checked_rows.length===this.$('.o_data_row').length){this.$('thead .o_list_record_selector input').prop('checked',true);}}}
if(!this._hasContent()&&!!this.noContentHelp){this._renderNoContentHelper();}},_setDecorationClasses:function($el,decorations,record){for(const[cssClass,expr]of Object.entries(decorations)){$el.toggleClass(cssClass,py.PY_isTrue(py.evaluate(expr,record.evalContext)));}},_shouldRenderPager:function(currentMinimum,limit,size){if(!limit||!size){return false;}
const maximum=Math.min(currentMinimum+limit-1,size);const singlePage=(1===currentMinimum)&&(maximum===size);return!singlePage;},_updateFooter:function(){this._computeAggregates();this.$('tfoot').replaceWith(this._renderFooter());},_updateSelection:function(){this.selection=[];var self=this;var $inputs=this.$('tbody .o_list_record_selector input:visible:not(:disabled)');var allChecked=$inputs.length>0;$inputs.each(function(index,input){if(input.checked){self.selection.push($(input).closest('tr').data('id'));}else{allChecked=false;}});this.$('thead .o_list_record_selector input').prop('checked',allChecked);this.trigger_up('selection_changed',{allChecked,selection:this.selection});this._updateFooter();},_onGroupButtonClicked:function(record,node,ev){ev.stopPropagation();if(node.attrs.type==='edit'){this.trigger_up('group_edit_button_clicked',{record:record,});}else{this.trigger_up('button_clicked',{attrs:node.attrs,record:record,});}},_onGroupButtonKeydown:function(ev){if(ev.keyCode===$.ui.keyCode.ENTER){ev.stopPropagation();}},_onToggleOptionalColumn:function(ev){var self=this;ev.stopPropagation();ev.preventDefault();var input=ev.currentTarget.querySelector('input');var fieldIndex=this.optionalColumnsEnabled.indexOf(input.name);if(fieldIndex>=0){this.optionalColumnsEnabled.splice(fieldIndex,1);}else{this.optionalColumnsEnabled.push(input.name);}
this.trigger_up('save_optional_fields',{keyParts:this._getOptionalColumnsStorageKeyParts(),optionalColumnsEnabled:this.optionalColumnsEnabled,});this._processColumns(this.columnInvisibleFields);this._render().then(function(){self._onToggleOptionalColumnDropdown(ev);});},_onToggleOptionalColumnDropdown:function(ev){ev.stopPropagation();this.$('.o_optional_columns .dropdown-toggle').dropdown('toggle');},_onKeyDown:function(ev){var $cell=$(ev.currentTarget);var $tr;var $futureCell;var colIndex;if(this.state.isSample){return;}
switch(ev.keyCode){case $.ui.keyCode.LEFT:ev.preventDefault();$tr=$cell.closest('tr');$tr.closest('tbody').addClass('o_keyboard_navigation');if($tr.hasClass('o_group_header')&&$tr.hasClass('o_group_open')){this._onToggleGroup(ev);}else{$futureCell=$cell.prev();}
break;case $.ui.keyCode.RIGHT:ev.preventDefault();$tr=$cell.closest('tr');$tr.closest('tbody').addClass('o_keyboard_navigation');if($tr.hasClass('o_group_header')&&!$tr.hasClass('o_group_open')){this._onToggleGroup(ev);}else{$futureCell=$cell.next();}
break;case $.ui.keyCode.UP:ev.preventDefault();$cell.closest('tbody').addClass('o_keyboard_navigation');colIndex=this.currentColIndex||$cell.index();$futureCell=this._findConnectedCell($cell,'prev',colIndex);if(!$futureCell){this.trigger_up('navigation_move',{direction:'up'});}
break;case $.ui.keyCode.DOWN:ev.preventDefault();$cell.closest('tbody').addClass('o_keyboard_navigation');colIndex=this.currentColIndex||$cell.index();$futureCell=this._findConnectedCell($cell,'next',colIndex);break;case $.ui.keyCode.ENTER:ev.preventDefault();$tr=$cell.closest('tr');if($tr.hasClass('o_group_header')){this._onToggleGroup(ev);}else{var id=$tr.data('id');if(id){this.trigger_up('open_record',{id:id,target:ev.target});}}
break;}
if($futureCell){var isInGroupHeader=$futureCell.closest('tr').hasClass('o_group_header');var $activables=!isInGroupHeader&&$futureCell.find(':focusable');if($activables.length){$activables[0].focus();}else{$futureCell.focus();}}},_onMouseDown:function(){$('.o_keyboard_navigation').removeClass('o_keyboard_navigation');},_onPagerChanged:async function(ev,group){ev.stopPropagation();const{currentMinimum,limit}=ev.detail;this.trigger_up('load',{id:group.id,limit:limit,offset:currentMinimum-1,on_success:reloadedGroup=>{Object.assign(group,reloadedGroup);this._render();},});},_onRowClicked:function(ev){if(!ev.target.closest('.o_list_record_selector')&&!$(ev.target).prop('special_click')){var id=$(ev.currentTarget).data('id');if(id){this.trigger_up('open_record',{id:id,target:ev.target});}}},_onSelectRecord:function(ev){ev.stopPropagation();this._updateSelection();},_onSortColumn:function(ev){var name=$(ev.currentTarget).data('name');this.trigger_up('toggle_column_order',{id:this.state.id,name:name});},_onToggleCheckbox:function(ev){const $recordSelector=$(ev.target).find('input[type=checkbox]:not(":disabled")');$recordSelector.prop('checked',!$recordSelector.prop("checked"));$recordSelector.change();},_onToggleGroup:function(ev){ev.preventDefault();var group=$(ev.currentTarget).closest('tr').data('group');if(group.count){this.trigger_up('toggle_group',{group:group,onSuccess:()=>{this._updateSelection();if(document.activeElement.tagName==='BODY'){var groupHeaders=$('tr.o_group_header:data("group")');var header=groupHeaders.filter(function(){return $(this).data('group').id===group.id;});header.find('.o_group_name').focus();}},});}},_onToggleSelection:function(ev){var checked=$(ev.currentTarget).prop('checked')||false;this.$('tbody .o_list_record_selector input:not(":disabled")').prop('checked',checked);this._updateSelection();},});return ListRenderer;});;

/* /web/static/src/js/views/list/list_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.ListView',function(require){"use strict";var BasicView=require('web.BasicView');var core=require('web.core');var ListModel=require('web.ListModel');var ListRenderer=require('web.ListRenderer');var ListController=require('web.ListController');var pyUtils=require('web.py_utils');var _lt=core._lt;var ListView=BasicView.extend({accesskey:"l",display_name:_lt('List'),icon:'fa-list-ul',config:_.extend({},BasicView.prototype.config,{Model:ListModel,Renderer:ListRenderer,Controller:ListController,}),viewType:'list',init:function(viewInfo,params){var self=this;this._super.apply(this,arguments);var selectedRecords=[];var pyevalContext=py.dict.fromJSON(_.pick(params.context,function(value,key,object){return!_.isUndefined(value)})||{});var expandGroups=!!JSON.parse(pyUtils.py_eval(this.arch.attrs.expand||"0",{'context':pyevalContext}));this.groupbys={};this.headerButtons=[];this.arch.children.forEach(function(child){if(child.tag==='groupby'){self._extractGroup(child);}
if(child.tag==='header'){self._extractHeaderButtons(child);}});let editable=false;if((!this.arch.attrs.edit||!!JSON.parse(this.arch.attrs.edit))&&!params.readonly){editable=this.arch.attrs.editable;}
this.controllerParams.activeActions.export_xlsx=this.arch.attrs.export_xlsx?!!JSON.parse(this.arch.attrs.export_xlsx):true;this.controllerParams.editable=editable;this.controllerParams.hasActionMenus=params.hasActionMenus;this.controllerParams.headerButtons=this.headerButtons;this.controllerParams.toolbarActions=viewInfo.toolbar;this.controllerParams.mode='readonly';this.controllerParams.selectedRecords=selectedRecords;this.rendererParams.arch=this.arch;this.rendererParams.groupbys=this.groupbys;this.rendererParams.hasSelectors='hasSelectors'in params?params.hasSelectors:true;this.rendererParams.editable=editable;this.rendererParams.selectedRecords=selectedRecords;this.rendererParams.addCreateLine=false;this.rendererParams.addCreateLineInGroups=editable&&this.controllerParams.activeActions.create;this.rendererParams.isMultiEditable=this.arch.attrs.multi_edit&&!!JSON.parse(this.arch.attrs.multi_edit);this.modelParams.groupbys=this.groupbys;this.loadParams.limit=this.loadParams.limit||80;this.loadParams.openGroupByDefault=expandGroups;this.loadParams.type='list';var groupsLimit=parseInt(this.arch.attrs.groups_limit,10);this.loadParams.groupsLimit=groupsLimit||(expandGroups?10:80);},_extractGroup:function(node){var innerView=this.fields[node.attrs.name].views.groupby;this.groupbys[node.attrs.name]=this._processFieldsView(innerView,'groupby');},_extractHeaderButtons(node){node.children.forEach(child=>{if(child.tag==='button'&&!child.attrs.modifiers.invisible){this.headerButtons.push(child);}});},_extractParamsFromAction:function(action){var params=this._super.apply(this,arguments);var inDialog=action.target==='new';var inline=action.target==='inline';params.hasActionMenus=!inDialog&&!inline;return params;},_updateMVCParams:function(){this._super.apply(this,arguments);this.controllerParams.noLeaf=!!this.loadParams.context.group_by_no_leaf;},});return ListView;});;

/* /web/static/src/js/views/list/list_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.ListController',function(require){"use strict";var core=require('web.core');var BasicController=require('web.BasicController');var DataExport=require('web.DataExport');var Dialog=require('web.Dialog');var ListConfirmDialog=require('web.ListConfirmDialog');var session=require('web.session');const viewUtils=require('web.viewUtils');var _t=core._t;var qweb=core.qweb;var ListController=BasicController.extend({buttons_template:'ListView.buttons',events:_.extend({},BasicController.prototype.events,{'click .o_list_export_xlsx':'_onDirectExportData','click .o_list_select_domain':'_onSelectDomain',}),custom_events:_.extend({},BasicController.prototype.custom_events,{activate_next_widget:'_onActivateNextWidget',add_record:'_onAddRecord',button_clicked:'_onButtonClicked',group_edit_button_clicked:'_onEditGroupClicked',edit_line:'_onEditLine',save_line:'_onSaveLine',selection_changed:'_onSelectionChanged',toggle_column_order:'_onToggleColumnOrder',toggle_group:'_onToggleGroup',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.hasActionMenus=params.hasActionMenus;this.headerButtons=params.headerButtons||[];this.toolbarActions=params.toolbarActions||{};this.editable=params.editable;this.noLeaf=params.noLeaf;this.selectedRecords=params.selectedRecords||[];this.multipleRecordsSavingPromise=null;this.fieldChangedPrevented=false;this.isPageSelected=false;this.isDomainSelected=false;this.isExportEnable=false;},willStart(){const sup=this._super(...arguments);const acl=session.user_has_group('base.group_allow_export').then(hasGroup=>{this.isExportEnable=hasGroup;});return Promise.all([sup,acl]);},getOwnedQueryParams:function(){var state=this._super.apply(this,arguments);var orderedBy=this.model.get(this.handle,{raw:true}).orderedBy||[];return _.extend({},state,{orderedBy:orderedBy});},getSelectedIds:function(){return _.map(this.getSelectedRecords(),function(record){return record.res_id;});},getSelectedRecords:function(){var self=this;return _.map(this.selectedRecords,function(db_id){return self.model.get(db_id,{raw:true});});},renderButtons:function($node){if(this.noLeaf||!this.hasButtons){this.hasButtons=false;this.$buttons=$('<div>');}else{this.$buttons=$(qweb.render(this.buttons_template,{widget:this}));this.$buttons.on('click','.o_list_button_add',this._onCreateRecord.bind(this));this._assignCreateKeyboardBehavior(this.$buttons.find('.o_list_button_add'));this.$buttons.find('.o_list_button_add').tooltip({delay:{show:200,hide:0},title:function(){return qweb.render('CreateButton.tooltip');},trigger:'manual',});this.$buttons.on('mousedown','.o_list_button_discard',this._onDiscardMousedown.bind(this));this.$buttons.on('click','.o_list_button_discard',this._onDiscard.bind(this));}
if($node){this.$buttons.appendTo($node);}},_renderHeaderButtons(){if(this.$headerButtons){this.$headerButtons.remove();this.$headerButtons=null;}
if(!this.headerButtons.length||!this.selectedRecords.length){return;}
const btnClasses='btn-primary btn-secondary btn-link btn-success btn-info btn-warning btn-danger'.split(' ');let $elms=$();this.headerButtons.forEach(node=>{const $btn=viewUtils.renderButtonFromNode(node);$btn.addClass('btn');if(!btnClasses.some(cls=>$btn.hasClass(cls))){$btn.addClass('btn-secondary');}
$btn.on("click",this._onHeaderButtonClicked.bind(this,node));$elms=$elms.add($btn);});this.$headerButtons=$elms;this.$headerButtons.appendTo(this.$buttons);},update:function(params,options){var self=this;let res_ids;if(options&&options.keepSelection){res_ids=this.model.get(this.handle).res_ids;this.selectedRecords=_.filter(this.selectedRecords,function(id){return _.contains(res_ids,self.model.get(id).res_id);});}else{this.selectedRecords=[];}
if(this.selectedRecords.length===0||this.selectedRecords.length<res_ids.length){this.isDomainSelected=false;this.isPageSelected=false;}
params.selectedRecords=this.selectedRecords;return this._super.apply(this,arguments);},updateButtons:function(mode){if(this.hasButtons){this.$buttons.toggleClass('o-editing',mode==='edit');const state=this.model.get(this.handle,{raw:true});if(state.count){this.$buttons.find('.o_list_export_xlsx').show();}else{this.$buttons.find('.o_list_export_xlsx').hide();}}
this._updateSelectionBox();},_abandonRecord:function(recordID){this._super.apply(this,arguments);if((recordID||this.handle)!==this.handle){var state=this.model.get(this.handle);this.renderer.removeLine(state,recordID);this._updatePaging(state);}},_addRecord:function(dataPointId){var self=this;this._disableButtons();return this._removeSampleData(()=>{return this.renderer.unselectRow().then(function(){return self.model.addDefaultRecord(dataPointId,{position:self.editable,});}).then(function(recordID){var state=self.model.get(self.handle);self._updateRendererState(state,{keepWidths:true}).then(function(){self.renderer.editRecord(recordID);}).then(()=>{self._updatePaging(state);});}).then(this._enableButtons.bind(this)).guardedCatch(this._enableButtons.bind(this));});},_assignCreateKeyboardBehavior:function($createButton){var self=this;$createButton.on('keydown',function(e){$createButton.tooltip('hide');switch(e.which){case $.ui.keyCode.ENTER:e.preventDefault();self._onCreateRecord.apply(self);break;case $.ui.keyCode.DOWN:e.preventDefault();self._giveFocus();break;case $.ui.keyCode.TAB:if(!e.shiftKey&&e.target.classList.contains("btn-primary")&&!self.model.isInSampleMode()){e.preventDefault();$createButton.tooltip('show');}
break;}});},_confirmSave:function(id){var state=this.model.get(this.handle);return this._updateRendererState(state,{noRender:true}).then(this._setMode.bind(this,'readonly',id));},_deleteRecordsInCurrentDomain:function(){const doIt=async()=>{const state=this.model.get(this.handle,{raw:true});const resIds=await this._domainToResIds(state.getDomain(),session.active_ids_limit);await this._rpc({model:this.modelName,method:'unlink',args:[resIds],context:state.getContext(),});if(resIds.length===session.active_ids_limit){const msg=_.str.sprintf(_t("Only the first %d records have been deleted (out of %d selected)"),resIds.length,state.count);this.do_notify(false,msg);}
this.reload();};if(this.confirmOnDelete){Dialog.confirm(this,_t("Are you sure you want to delete these records ?"),{confirm_callback:doIt,});}else{doIt();}},_discardChanges:function(recordID){if((recordID||this.handle)===this.handle){recordID=this.renderer.getEditableRecordID();if(recordID===null){return Promise.resolve();}}
var self=this;return this._super(recordID).then(function(){self.updateButtons('readonly');});},_domainToResIds:function(domain,limit){return this._rpc({model:this.modelName,method:'search',args:[domain],kwargs:{limit:limit,},});},_getExportDialogWidget(){let state=this.model.get(this.handle);let defaultExportFields=this.renderer.columns.filter(field=>field.tag==='field').map(field=>field.attrs.name);let groupedBy=this.renderer.state.groupedBy;const domain=this.isDomainSelected&&state.getDomain();return new DataExport(this,state,defaultExportFields,groupedBy,domain,this.getSelectedIds());},_getPagingInfo:function(state){if(!state.count){return null;}
return this._super(...arguments);},_getActionMenuItems:function(state){if(!this.hasActionMenus||!this.selectedRecords.length){return null;}
const props=this._super(...arguments);const otherActionItems=[];if(this.isExportEnable){otherActionItems.push({description:_t("Export"),callback:()=>this._onExportData()});}
if(this.archiveEnabled){otherActionItems.push({description:_t("Archive"),callback:()=>{Dialog.confirm(this,_t("Are you sure that you want to archive all the selected records?"),{confirm_callback:()=>this._toggleArchiveState(true),});}},{description:_t("Unarchive"),callback:()=>this._toggleArchiveState(false)});}
if(this.activeActions.delete){otherActionItems.push({description:_t("Delete"),callback:()=>this._onDeleteSelectedRecords()});}
return Object.assign(props,{items:Object.assign({},this.toolbarActions,{other:otherActionItems}),context:state.getContext(),domain:state.getDomain(),isDomainSelected:this.isDomainSelected,});},_saveMultipleRecords:function(recordId,node,changes){var fieldName=Object.keys(changes)[0];var value=Object.values(changes)[0];var recordIds=_.union([recordId],this.selectedRecords);var validRecordIds=recordIds.reduce((result,nextRecordId)=>{var record=this.model.get(nextRecordId);var modifiers=this.renderer._registerModifiers(node,record);if(!modifiers.readonly&&(!modifiers.required||value)){result.push(nextRecordId);}
return result;},[]);return new Promise((resolve,reject)=>{const saveRecords=()=>{this.model.saveRecords(this.handle,recordId,validRecordIds,fieldName).then(async()=>{this.updateButtons('readonly');const state=this.model.get(this.handle);this.selectedRecords=[];await this._updateRendererState(state,{keepWidths:true,selectedRecords:[],});this._updateSelectionBox();this.renderer.focusCell(recordId,node);resolve(!Object.keys(changes).length);}).guardedCatch(discardAndReject);};const discardAndReject=()=>{this.model.discardChanges(recordId);this._confirmSave(recordId).then(()=>{this.renderer.focusCell(recordId,node);reject();});};if(validRecordIds.length>0){if(recordIds.length===1){return saveRecords();}
const dialogOptions={confirm_callback:saveRecords,cancel_callback:discardAndReject,};const record=this.model.get(recordId);const dialogChanges={isDomainSelected:this.isDomainSelected,fieldLabel:node.attrs.string||record.fields[fieldName].string,fieldName:node.attrs.name,nbRecords:recordIds.length,nbValidRecords:validRecordIds.length,};new ListConfirmDialog(this,record,dialogChanges,dialogOptions).open({shouldFocusButtons:true});}else{Dialog.alert(this,_t("No valid record to save"),{confirm_callback:discardAndReject,});}});},_saveRecord:function(recordId){var record=this.model.get(recordId,{raw:true});if(record.isDirty()&&this.renderer.isInMultipleRecordEdition(recordId)){const prom=this.multipleRecordsSavingPromise||Promise.reject();this.multipleRecordsSavingPromise=null;return prom;}
return this._super.apply(this,arguments);},_setMode:function(mode,recordID){if((recordID||this.handle)!==this.handle){this.mode=mode;this.updateButtons(mode);return this.renderer.setRowMode(recordID,mode);}else{return this._super.apply(this,arguments);}},_shouldBounceOnClick(){const state=this.model.get(this.handle,{raw:true});return!state.count||state.isSample;},_toggleArchiveState:async function(archive){let resIds;let displayNotif=false;const state=this.model.get(this.handle,{raw:true});if(this.isDomainSelected){resIds=await this._domainToResIds(state.getDomain(),session.active_ids_limit);displayNotif=(resIds.length===session.active_ids_limit);}else{resIds=this.model.localIdsToResIds(this.selectedRecords);}
await this._archive(resIds,archive);if(displayNotif){const msg=_.str.sprintf(_t("Of the %d records selected, only the first %d have been archived/unarchived."),state.count,resIds.length);this.do_notify(_t('Warning'),msg);}},_toggleCreateButton:function(){if(this.hasButtons){var state=this.model.get(this.handle);var createHidden=this.renderer.isEditable()&&state.groupedBy.length&&state.data.length;this.$buttons.find('.o_list_button_add').toggleClass('o_hidden',!!createHidden);}},_update:async function(){await this._super(...arguments);this._toggleCreateButton();this.updateButtons('readonly');},_updateSelectionBox(){if(this.$selectionBox){this.$selectionBox.remove();this.$selectionBox=null;}
if(this.selectedRecords.length){const state=this.model.get(this.handle,{raw:true});this.$selectionBox=$(qweb.render('ListView.selection',{isDomainSelected:this.isDomainSelected,isPageSelected:this.isPageSelected,nbSelected:this.selectedRecords.length,nbTotal:state.count,}));this.$selectionBox.appendTo(this.$buttons);}
this._renderHeaderButtons();},_onActivateNextWidget:function(ev){ev.stopPropagation();this.renderer.editFirstRecord(ev);},_onAddRecord:function(ev){ev.stopPropagation();var dataPointId=ev.data.groupId||this.handle;if(this.activeActions.create){this._addRecord(dataPointId);}else if(ev.data.onFail){ev.data.onFail();}},_onButtonClicked:function(ev){ev.stopPropagation();this._callButtonAction(ev.data.attrs,ev.data.record);},_onCreateRecord:function(ev){if(ev){ev.stopPropagation();}
var state=this.model.get(this.handle,{raw:true});if(this.editable&&!state.groupedBy.length){this._addRecord(this.handle);}else{this.trigger_up('switch_view',{view_type:'form',res_id:undefined});}},_onDeleteSelectedRecords:async function(){if(this.isDomainSelected){this._deleteRecordsInCurrentDomain();}else{this._deleteRecords(this.selectedRecords);}},_onDiscard:function(ev){ev.stopPropagation();this._discardChanges();},_onDiscardMousedown:function(ev){var self=this;this.fieldChangedPrevented=true;window.addEventListener('mouseup',function(mouseupEvent){var preventedEvent=self.fieldChangedPrevented;self.fieldChangedPrevented=false;if(ev.target!==mouseupEvent.target&&preventedEvent.constructor.name==='OdooEvent'){self._onFieldChanged(preventedEvent);}},{capture:true,once:true});},_onEditLine:function(ev){var self=this;ev.stopPropagation();this.trigger_up('mutexify',{action:function(){self._setMode('edit',ev.data.recordId).then(ev.data.onSuccess);},});},_onExportData:function(){this._getExportDialogWidget().open();},_onDirectExportData(){return this._rpc({model:'ir.exports',method:'search_read',args:[[],['id']],limit:1,}).then(()=>this._getExportDialogWidget().export())},_onEditGroupClicked:function(ev){ev.stopPropagation();this.do_action({context:{create:false},type:'ir.actions.act_window',views:[[false,'form']],res_model:ev.data.record.model,res_id:ev.data.record.res_id,flags:{mode:'edit'},});},_onFieldChanged:function(ev){ev.stopPropagation();const recordId=ev.data.dataPointID;if(this.fieldChangedPrevented){this.fieldChangedPrevented=ev;}else if(this.renderer.isInMultipleRecordEdition(recordId)){const saveMulti=()=>{const target=ev.data.__originalComponent||ev.target;this.multipleRecordsSavingPromise=this._saveMultipleRecords(ev.data.dataPointID,target.__node,ev.data.changes);};ev.data.onSuccess=saveMulti;ev.data.onFailure=saveMulti;ev.data.notifyChange=false;}
this._super.apply(this,arguments);},async _onHeaderButtonClicked(node){this._disableButtons();const state=this.model.get(this.handle);try{let resIds;if(this.isDomainSelected){const limit=session.active_ids_limit;resIds=await this._domainToResIds(state.getDomain(),limit);}else{resIds=this.getSelectedIds();}
const actionData=Object.assign({},node.attrs,{context:state.getContext({additionalContext:node.attrs.context}),});Object.assign(actionData.context,{active_domain:state.getDomain(),active_id:resIds[0],active_ids:resIds,active_model:state.model,});const recordData={context:state.getContext(),model:state.model,resIDs:resIds,};await this._executeButtonAction(actionData,recordData);}finally{this._enableButtons();}},_onSaveLine:function(ev){this.saveRecord(ev.data.recordID).then(ev.data.onSuccess).guardedCatch(ev.data.onFailure);},_onSelectDomain:function(ev){ev.preventDefault();this.isDomainSelected=true;this._updateSelectionBox();this._updateControlPanel();},_onSelectionChanged:function(ev){this.selectedRecords=ev.data.selection;this.isPageSelected=ev.data.allChecked;this.isDomainSelected=false;this.$('.o_list_export_xlsx').toggle(!this.selectedRecords.length);this._updateSelectionBox();this._updateControlPanel();},_onSetDirty:function(ev){var recordId=ev.data.dataPointID;if(this.renderer.isInMultipleRecordEdition(recordId)){ev.stopPropagation();Dialog.alert(this,_t("No valid record to save"),{confirm_callback:async()=>{this.model.discardChanges(recordId);await this._confirmSave(recordId);this.renderer.focusCell(recordId,ev.target.__node);},});}else{this._super.apply(this,arguments);}},_onToggleColumnOrder:function(ev){ev.stopPropagation();var state=this.model.get(this.handle);if(!state.groupedBy){this._updatePaging(state,{currentMinimum:1});}
var self=this;this.model.setSort(state.id,ev.data.name).then(function(){self.update({});});},_onToggleGroup:function(ev){ev.stopPropagation();var self=this;this.model.toggleGroup(ev.data.group.id).then(function(){self.update({},{keepSelection:true,reload:false}).then(function(){if(ev.data.onSuccess){ev.data.onSuccess();}});});},});return ListController;});;

/* /web/static/src/js/views/list/list_confirm_dialog.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.ListConfirmDialog',function(require){"use strict";const core=require('web.core');const Dialog=require('web.Dialog');const FieldWrapper=require('web.FieldWrapper');const{WidgetAdapterMixin}=require('web.OwlCompatibility');const utils=require('web.utils');const _t=core._t;const qweb=core.qweb;const ListConfirmDialog=Dialog.extend(WidgetAdapterMixin,{init:function(parent,record,changes,options){options=Object.assign({},options,{$content:$(qweb.render('ListView.confirmModal',{changes})),buttons:options.buttons||[{text:_t("Ok"),classes:'btn-primary',close:true,click:options.confirm_callback,},{text:_t("Cancel"),close:true,click:options.cancel_callback,}],onForceClose:options.cancel_callback,size:options.size||'medium',title:options.title||_t("Confirmation"),});this._super(parent,options);const Widget=record.fieldsInfo.list[changes.fieldName].Widget;const widgetOptions={mode:'readonly',viewType:'list',noOpen:true,};this.isLegacyWidget=!utils.isComponent(Widget);if(this.isLegacyWidget){this.fieldWidget=new Widget(this,changes.fieldName,record,widgetOptions);}else{this.fieldWidget=new FieldWrapper(this,Widget,{fieldName:changes.fieldName,record,options:widgetOptions,});}},willStart:function(){let widgetProm;if(this.isLegacyWidget){widgetProm=this.fieldWidget._widgetRenderAndInsert(function(){});}else{widgetProm=this.fieldWidget.mount(document.createDocumentFragment());}
return Promise.all([widgetProm,this._super.apply(this,arguments)]);},start:function(){this.$content.find('.o_changes_widget').replaceWith(this.fieldWidget.$el);this.fieldWidget.el.style.pointerEvents='none';return this._super.apply(this,arguments);},destroy:function(){WidgetAdapterMixin.destroy.call(this);this._super();},});return ListConfirmDialog;});;

/* /web/static/src/js/views/pivot/pivot_model.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.PivotModel',function(require){"use strict";var AbstractModel=require('web.AbstractModel');var concurrency=require('web.concurrency');var core=require('web.core');var dataComparisonUtils=require('web.dataComparisonUtils');const Domain=require('web.Domain');var mathUtils=require('web.mathUtils');var session=require('web.session');var _t=core._t;var cartesian=mathUtils.cartesian;var computeVariation=dataComparisonUtils.computeVariation;var sections=mathUtils.sections;var PivotModel=AbstractModel.extend({init:function(){this._super.apply(this,arguments);this.numbering={};this.data=null;this._loadDataDropPrevious=new concurrency.DropPrevious();},addGroupBy:function(groupBy,type){if(type==='row'){this.data.expandedRowGroupBys.push(groupBy);}else{this.data.expandedColGroupBys.push(groupBy);}},closeGroup:function(groupId,type){var groupBys;var expandedGroupBys;let keyPart;var group;var tree;if(type==='row'){groupBys=this.data.rowGroupBys;expandedGroupBys=this.data.expandedRowGroupBys;tree=this.rowGroupTree;group=this._findGroup(this.rowGroupTree,groupId[0]);keyPart=0;}else{groupBys=this.data.colGroupBys;expandedGroupBys=this.data.expandedColGroupBys;tree=this.colGroupTree;group=this._findGroup(this.colGroupTree,groupId[1]);keyPart=1;}
const groupIdPart=groupId[keyPart];const range=groupIdPart.map((_,index)=>index);function keep(key){const idPart=JSON.parse(key)[keyPart];return range.some(index=>groupIdPart[index]!==idPart[index])||idPart.length===groupIdPart.length;}
function omitKeys(object){const newObject={};for(const key in object){if(keep(key)){newObject[key]=object[key];}}
return newObject;}
this.measurements=omitKeys(this.measurements);this.counts=omitKeys(this.counts);this.groupDomains=omitKeys(this.groupDomains);group.directSubTrees.clear();delete group.sortedKeys;var newGroupBysLength=this._getTreeHeight(tree)-1;if(newGroupBysLength<=groupBys.length){expandedGroupBys.splice(0);groupBys.splice(newGroupBysLength);}else{expandedGroupBys.splice(newGroupBysLength-groupBys.length);}},expandAll:function(){return this._loadData();},expandGroup:async function(group,groupBy){var leftDivisors;var rightDivisors;if(group.type==='row'){leftDivisors=[[groupBy]];rightDivisors=sections(this._getGroupBys().colGroupBys);}else{leftDivisors=sections(this._getGroupBys().rowGroupBys);rightDivisors=[[groupBy]];}
var divisors=cartesian(leftDivisors,rightDivisors);delete group.type;return this._subdivideGroup(group,divisors);},exportData:function(){var measureCount=this.data.measures.length;var originCount=this.data.origins.length;var table=this._getTable();var headers=table.headers;var colGroupHeaderRows;var measureRow=[];var originRow=[];function processHeader(header){var inTotalColumn=header.groupId[1].length===0;return{title:header.title,width:header.width,height:header.height,is_bold:!!header.measure&&inTotalColumn};}
if(originCount>1){colGroupHeaderRows=headers.slice(0,headers.length-2);measureRow=headers[headers.length-2].map(processHeader);originRow=headers[headers.length-1].map(processHeader);}else{colGroupHeaderRows=headers.slice(0,headers.length-1);measureRow=headers[headers.length-1].map(processHeader);}
colGroupHeaderRows[0].splice(0,1);colGroupHeaderRows=colGroupHeaderRows.map(function(headerRow){return headerRow.map(processHeader);});var tableRows=table.rows.map(function(row){return{title:row.title,indent:row.indent,values:row.subGroupMeasurements.map(function(measurement){var value=measurement.value;if(value===undefined){value="";}else if(measurement.originIndexes.length>1){value=value*100;}
return{is_bold:measurement.isBold,value:value,};}),};});return{col_group_headers:colGroupHeaderRows,measure_headers:measureRow,origin_headers:originRow,rows:tableRows,measure_count:measureCount,origin_count:originCount,};},flip:function(){var temp=this.rowGroupTree;this.rowGroupTree=this.colGroupTree;this.colGroupTree=temp;temp=this.data.rowGroupBys;this.data.groupedBy=this.data.colGroupBys;this.data.rowGroupBys=this.data.colGroupBys;this.data.colGroupBys=temp;temp=this.data.expandedColGroupBys;this.data.expandedColGroupBys=this.data.expandedRowGroupBys;this.data.expandedRowGroupBys=temp;function twistKey(key){return JSON.stringify(JSON.parse(key).reverse());}
function twist(object){var newObject={};Object.keys(object).forEach(function(key){var value=object[key];newObject[twistKey(key)]=value;});return newObject;}
this.measurements=twist(this.measurements);this.counts=twist(this.counts);this.groupDomains=twist(this.groupDomains);},__get:function(options){options=options||{};var raw=options.raw||false;var groupBys=this._getGroupBys();var state={colGroupBys:groupBys.colGroupBys,context:this.data.context,domain:this.data.domain,fields:this.fields,hasData:this._hasData(),isSample:this.isSampleModel,measures:this.data.measures,origins:this.data.origins,rowGroupBys:groupBys.rowGroupBys,selectionGroupBys:this._getSelectionGroupBy(groupBys),modelName:this.modelName};if(!raw&&state.hasData){state.table=this._getTable();state.tree=this.rowGroupTree;}
return state;},getTableWidth:function(){var leafCounts=this._getLeafCounts(this.colGroupTree);return leafCounts[JSON.stringify(this.colGroupTree.root.values)]+2;},__load:function(params){this.initialDomain=params.domain;this.initialRowGroupBys=params.context.pivot_row_groupby||params.rowGroupBys;this.defaultGroupedBy=params.groupedBy;this.fields=params.fields;this.modelName=params.modelName;this.groupableFields=params.groupableFields;const measures=this._processMeasures(params.context.pivot_measures)||params.measures.map(m=>m);this.data={expandedRowGroupBys:[],expandedColGroupBys:[],domain:this.initialDomain,context:_.extend({},session.user_context,params.context),groupedBy:params.context.pivot_row_groupby||params.groupedBy,colGroupBys:params.context.pivot_column_groupby||params.colGroupBys,measures,timeRanges:params.timeRanges,};this._computeDerivedParams();this.data.rowGroupBys=!_.isEmpty(this.data.groupedBy)?this.data.groupedBy:this.initialRowGroupBys;var defaultOrder=params.default_order&&params.default_order.split(' ');if(defaultOrder){this.data.sortedColumn={groupId:[[],[]],measure:defaultOrder[0],order:defaultOrder[1]?defaultOrder[1]:'asc',};}
return this._loadData();},__reload:function(handle,params){var self=this;var oldColGroupBys=this.data.colGroupBys;var oldRowGroupBys=this.data.rowGroupBys;if('context'in params){this.data.context=params.context;this.data.colGroupBys=params.context.pivot_column_groupby||this.data.colGroupBys;this.data.groupedBy=params.context.pivot_row_groupby||this.data.groupedBy;this.data.measures=this._processMeasures(params.context.pivot_measures)||this.data.measures;this.defaultGroupedBy=this.data.groupedBy.length?this.data.groupedBy:this.defaultGroupedBy;}
if('domain'in params){this.data.domain=params.domain;this.initialDomain=params.domain;}else{this.data.domain=this.initialDomain;}
if('groupBy'in params){this.data.groupedBy=params.groupBy.length?params.groupBy:this.defaultGroupedBy;}
if('timeRanges'in params){this.data.timeRanges=params.timeRanges;}
this._computeDerivedParams();this.data.rowGroupBys=!_.isEmpty(this.data.groupedBy)?this.data.groupedBy:this.initialRowGroupBys;if(!_.isEqual(oldRowGroupBys,self.data.rowGroupBys)){this.data.expandedRowGroupBys=[];}
if(!_.isEqual(oldColGroupBys,self.data.colGroupBys)){this.data.expandedColGroupBys=[];}
if('measure'in params){return this._toggleMeasure(params.measure);}
if(!this._hasData()){return this._loadData();}
var oldRowGroupTree=this.rowGroupTree;var oldColGroupTree=this.colGroupTree;return this._loadData().then(function(){if(_.isEqual(oldRowGroupBys,self.data.rowGroupBys)){self._pruneTree(self.rowGroupTree,oldRowGroupTree);}
if(_.isEqual(oldColGroupBys,self.data.colGroupBys)){self._pruneTree(self.colGroupTree,oldColGroupTree);}});},sortRows:function(sortedColumn){var self=this;var colGroupValues=sortedColumn.groupId[1];sortedColumn.originIndexes=sortedColumn.originIndexes||[0];this.data.sortedColumn=sortedColumn;var sortFunction=function(tree){return function(subTreeKey){var subTree=tree.directSubTrees.get(subTreeKey);var groupIntersectionId=[subTree.root.values,colGroupValues];var value=self._getCellValue(groupIntersectionId,sortedColumn.measure,sortedColumn.originIndexes)||0;return sortedColumn.order==='asc'?value:-value;};};this._sortTree(sortFunction,this.rowGroupTree);},_addGroup:function(groupTree,labels,values){var tree=groupTree;values.slice(0,values.length-1).forEach(function(value){tree=tree.directSubTrees.get(value);});tree.directSubTrees.set(values[values.length-1],{root:{labels:labels,values:values,},directSubTrees:new Map(),});},_computeRowGroupBys:function(){return!_.isEmpty(this.data.groupedBy)?this.data.groupedBy:this.initialRowGroupBys;},_findGroup:function(groupTree,values){var tree=groupTree;values.slice(0,values.length).forEach(function(value){tree=tree.directSubTrees.get(value);});return tree;},_getCellValue:function(groupId,measure,originIndexes){var self=this;var key=JSON.stringify(groupId);if(!self.measurements[key]){return;}
var values=originIndexes.map(function(originIndex){return self.measurements[key][originIndex][measure];});if(originIndexes.length>1){return computeVariation(values[1],values[0]);}else{return values[0];}},_getGroupBys:function(){return{colGroupBys:this.data.colGroupBys.concat(this.data.expandedColGroupBys),rowGroupBys:this.data.rowGroupBys.concat(this.data.expandedRowGroupBys),};},_getGroupDomain:function(group){var key=JSON.stringify([group.rowValues,group.colValues]);return this.groupDomains[key][group.originIndex];},_getGroupLabels:function(group,groupBys){var self=this;return groupBys.map(function(groupBy){return self._sanitizeLabel(group[groupBy],groupBy);});},_getGroupSubdivision:function(group,rowGroupBy,colGroupBy){var groupDomain=this._getGroupDomain(group);var measureSpecs=this._getMeasureSpecs();var groupBy=rowGroupBy.concat(colGroupBy);return this._rpc({model:this.modelName,method:'read_group',context:this.data.context,domain:groupDomain,fields:measureSpecs,groupBy:groupBy,lazy:false,}).then(function(subGroups){return{group:group,subGroups:subGroups,rowGroupBy:rowGroupBy,colGroupBy:colGroupBy};});},_getGroupValues:function(group,groupBys){var self=this;return groupBys.map(function(groupBy){return self._sanitizeValue(group[groupBy]);});},_getLeafCounts:function(tree){var self=this;var leafCounts={};var leafCount;if(!tree.directSubTrees.size){leafCount=1;}else{leafCount=[...tree.directSubTrees.values()].reduce(function(acc,subTree){var subLeafCounts=self._getLeafCounts(subTree);_.extend(leafCounts,subLeafCounts);return acc+leafCounts[JSON.stringify(subTree.root.values)];},0);}
leafCounts[JSON.stringify(tree.root.values)]=leafCount;return leafCounts;},_getMeasurements:function(group){var self=this;return this.data.measures.reduce(function(measurements,fieldName){var measurement=group[fieldName];if(measurement instanceof Array){measurement=1;}
if(self.fields[fieldName].type==='boolean'&&measurement instanceof Boolean){measurement=measurement?1:0;}
if(self.data.origins.length>1&&!measurement){measurement=0;}
measurements[fieldName]=measurement;return measurements;},{});},_getMeasuresRow:function(columns){var self=this;var sortedColumn=this.data.sortedColumn||{};var measureRow=[];columns.forEach(function(column){self.data.measures.forEach(function(measure){var measureCell={groupId:column.groupId,height:1,measure:measure,title:self.fields[measure].string,width:2*self.data.origins.length-1,};if(sortedColumn.measure===measure&&_.isEqual(sortedColumn.groupId,column.groupId)){measureCell.order=sortedColumn.order;}
measureRow.push(measureCell);});});return measureRow;},_getMeasureSpecs:function(){var self=this;return this.data.measures.reduce(function(acc,measure){if(measure==='__count'){acc.push(measure);return acc;}
var type=self.fields[measure].type;var groupOperator=self.fields[measure].group_operator;if(type==='many2one'){groupOperator='count_distinct';}
if(groupOperator===undefined){throw new Error("No aggregate function has been provided for the measure '"+measure+"'");}
acc.push(measure+':'+groupOperator);return acc;},[]);},_getNumberedLabel:function(label,fieldName){var id=label[0];var name=label[1];this.numbering[fieldName]=this.numbering[fieldName]||{};this.numbering[fieldName][name]=this.numbering[fieldName][name]||{};var numbers=this.numbering[fieldName][name];numbers[id]=numbers[id]||_.size(numbers)+1;return name+(numbers[id]>1?"  ("+numbers[id]+")":"");},_getOriginsRow:function(columns){var self=this;var sortedColumn=this.data.sortedColumn||{};var originRow=[];columns.forEach(function(column){var groupId=column.groupId;var measure=column.measure;var isSorted=sortedColumn.measure===measure&&_.isEqual(sortedColumn.groupId,groupId);var isSortedByOrigin=isSorted&&!sortedColumn.originIndexes[1];var isSortedByVariation=isSorted&&sortedColumn.originIndexes[1];self.data.origins.forEach(function(origin,originIndex){var originCell={groupId:groupId,height:1,measure:measure,originIndexes:[originIndex],title:origin,width:1,};if(isSortedByOrigin&&sortedColumn.originIndexes[0]===originIndex){originCell.order=sortedColumn.order;}
originRow.push(originCell);if(originIndex>0){var variationCell={groupId:groupId,height:1,measure:measure,originIndexes:[originIndex-1,originIndex],title:_t('Variation'),width:1,};if(isSortedByVariation&&sortedColumn.originIndexes[1]===originIndex){variationCell.order=sortedColumn.order;}
originRow.push(variationCell);}});});return originRow;},_getSelectionGroupBy:function(groupBys){let groupedFieldNames=groupBys.rowGroupBys.concat(groupBys.colGroupBys).map(function(g){return g.split(':')[0];});var fields=Object.keys(this.groupableFields).map((fieldName,index)=>{return{name:fieldName,field:this.groupableFields[fieldName],active:groupedFieldNames.includes(fieldName)}}).sort((left,right)=>left.field.string<right.field.string?-1:1);return fields;},_getTable:function(){var headers=this._getTableHeaders();return{headers:headers,rows:this._getTableRows(this.rowGroupTree,headers[headers.length-1]),};},_getTableHeaders:function(){var colGroupBys=this._getGroupBys().colGroupBys;var height=colGroupBys.length+1;var measureCount=this.data.measures.length;var originCount=this.data.origins.length;var leafCounts=this._getLeafCounts(this.colGroupTree);var headers=[];var measureColumns=[];var colGroupRows=(new Array(height)).fill(0).map(function(){return[];});colGroupRows[0].push({height:height+1+(originCount>1?1:0),title:"",width:1,});function generateTreeHeaders(tree,fields){var group=tree.root;var rowIndex=group.values.length;var row=colGroupRows[rowIndex];var groupId=[[],group.values];var isLeaf=!tree.directSubTrees.size;var leafCount=leafCounts[JSON.stringify(tree.root.values)];var cell={groupId:groupId,height:isLeaf?(colGroupBys.length+1-rowIndex):1,isLeaf:isLeaf,label:rowIndex===0?undefined:fields[colGroupBys[rowIndex-1].split(':')[0]].string,title:group.labels[group.labels.length-1]||_t('Total'),width:leafCount*measureCount*(2*originCount-1),};row.push(cell);if(isLeaf){measureColumns.push(cell);}
[...tree.directSubTrees.values()].forEach(function(subTree){generateTreeHeaders(subTree,fields);});}
generateTreeHeaders(this.colGroupTree,this.fields);if(leafCounts[JSON.stringify(this.colGroupTree.root.values)]>1){var groupId=[[],[]];var totalTopRightCell={groupId:groupId,height:height,title:"",width:measureCount*(2*originCount-1),};colGroupRows[0].push(totalTopRightCell);measureColumns.push(totalTopRightCell);}
headers=headers.concat(colGroupRows);var measuresRow=this._getMeasuresRow(measureColumns);headers.push(measuresRow);if(originCount>1){headers.push(this._getOriginsRow(measuresRow));}
return headers;},_getTableRows:function(tree,columns){var self=this;var rows=[];var group=tree.root;var rowGroupId=[group.values,[]];var title=group.labels[group.labels.length-1]||_t('Total');var indent=group.labels.length;var isLeaf=!tree.directSubTrees.size;var rowGroupBys=this._getGroupBys().rowGroupBys;var subGroupMeasurements=columns.map(function(column){var colGroupId=column.groupId;var groupIntersectionId=[rowGroupId[0],colGroupId[1]];var measure=column.measure;var originIndexes=column.originIndexes||[0];var value=self._getCellValue(groupIntersectionId,measure,originIndexes);var measurement={groupId:groupIntersectionId,originIndexes:originIndexes,measure:measure,value:value,isBold:!groupIntersectionId[0].length||!groupIntersectionId[1].length,};return measurement;});rows.push({title:title,label:indent===0?undefined:this.fields[rowGroupBys[indent-1].split(':')[0]].string,groupId:rowGroupId,indent:indent,isLeaf:isLeaf,subGroupMeasurements:subGroupMeasurements});var subTreeKeys=tree.sortedKeys||[...tree.directSubTrees.keys()];subTreeKeys.forEach(function(subTreeKey){var subTree=tree.directSubTrees.get(subTreeKey);rows=rows.concat(self._getTableRows(subTree,columns));});return rows;},_getTreeHeight:function(tree){var subTreeHeights=[...tree.directSubTrees.values()].map(this._getTreeHeight.bind(this));return Math.max(0,Math.max.apply(null,subTreeHeights))+1;},_hasData:function(){return(this.counts[JSON.stringify([[],[]])]||[]).some(function(count){return count>0;});},_isEmpty(){return!this._hasData();},_loadData:function(){var self=this;this.rowGroupTree={root:{labels:[],values:[]},directSubTrees:new Map()};this.colGroupTree={root:{labels:[],values:[]},directSubTrees:new Map()};this.measurements={};this.counts={};var key=JSON.stringify([[],[]]);this.groupDomains={};this.groupDomains[key]=this.data.domains.slice(0);var group={rowValues:[],colValues:[]};var groupBys=this._getGroupBys();var leftDivisors=sections(groupBys.rowGroupBys);var rightDivisors=sections(groupBys.colGroupBys);var divisors=cartesian(leftDivisors,rightDivisors);return this._subdivideGroup(group,divisors.slice(0,1)).then(function(){return self._subdivideGroup(group,divisors.slice(1));});},_prepareData:function(group,groupSubdivisions){var self=this;var groupRowValues=group.rowValues;var groupRowLabels=[];var rowSubTree=this.rowGroupTree;var root;if(groupRowValues.length){rowSubTree=this._findGroup(this.rowGroupTree,groupRowValues);root=rowSubTree.root;groupRowLabels=root.labels;}
var groupColValues=group.colValues;var groupColLabels=[];if(groupColValues.length){root=this._findGroup(this.colGroupTree,groupColValues).root;groupColLabels=root.labels;}
groupSubdivisions.forEach(function(groupSubdivision){groupSubdivision.subGroups.forEach(function(subGroup){var rowValues=groupRowValues.concat(self._getGroupValues(subGroup,groupSubdivision.rowGroupBy));var rowLabels=groupRowLabels.concat(self._getGroupLabels(subGroup,groupSubdivision.rowGroupBy));var colValues=groupColValues.concat(self._getGroupValues(subGroup,groupSubdivision.colGroupBy));var colLabels=groupColLabels.concat(self._getGroupLabels(subGroup,groupSubdivision.colGroupBy));if(!colValues.length&&rowValues.length){self._addGroup(self.rowGroupTree,rowLabels,rowValues);}
if(colValues.length&&!rowValues.length){self._addGroup(self.colGroupTree,colLabels,colValues);}
var key=JSON.stringify([rowValues,colValues]);var originIndex=groupSubdivision.group.originIndex;if(!(key in self.measurements)){self.measurements[key]=self.data.origins.map(function(){return self._getMeasurements({});});}
self.measurements[key][originIndex]=self._getMeasurements(subGroup);if(!(key in self.counts)){self.counts[key]=self.data.origins.map(function(){return 0;});}
self.counts[key][originIndex]=subGroup.__count;if(!(key in self.groupDomains)){self.groupDomains[key]=self.data.origins.map(function(){return Domain.FALSE_DOMAIN;});}
if(subGroup.__domain){self.groupDomains[key][originIndex]=subGroup.__domain;}});});if(this.data.sortedColumn){this.sortRows(this.data.sortedColumn,rowSubTree);}},_processMeasures:function(measures){if(measures){return _.map(measures,function(measure){return measure==='__count__'?'__count':measure;});}},_computeDerivedParams:function(){const{range,rangeDescription,comparisonRange,comparisonRangeDescription}=this.data.timeRanges;if(range){this.data.domains=[this.data.domain.concat(comparisonRange),this.data.domain.concat(range)];this.data.origins=[comparisonRangeDescription,rangeDescription];}else{this.data.domains=[this.data.domain];this.data.origins=[""];}},_pruneTree:function(tree,oldTree){if(!oldTree.directSubTrees.size){tree.directSubTrees.clear();delete tree.sortedKeys;return;}
var self=this;[...tree.directSubTrees.keys()].forEach(function(subTreeKey){var subTree=tree.directSubTrees.get(subTreeKey);if(!oldTree.directSubTrees.has(subTreeKey)){subTree.directSubTrees.clear();delete subTreeKey.sortedKeys;}else{var oldSubTree=oldTree.directSubTrees.get(subTreeKey);self._pruneTree(subTree,oldSubTree);}});},_toggleMeasure:function(fieldName){var index=this.data.measures.indexOf(fieldName);if(index!==-1){this.data.measures.splice(index,1);return Promise.resolve();}else{this.data.measures.push(fieldName);}
return this._loadData();},_sanitizeLabel:function(value,groupBy){var fieldName=groupBy.split(':')[0];if(value===false){return _t("Undefined");}
if(value instanceof Array){return this._getNumberedLabel(value,fieldName);}
if(fieldName&&this.fields[fieldName]&&(this.fields[fieldName].type==='selection')){var selected=_.where(this.fields[fieldName].selection,{0:value})[0];return selected?selected[1]:value;}
return value;},_sanitizeValue:function(value){if(value instanceof Array){return value[0];}
return value;},_subdivideGroup:function(group,divisors){var self=this;var key=JSON.stringify([group.rowValues,group.colValues]);var proms=this.data.origins.reduce(function(acc,origin,originIndex){if(!self.counts[key]||self.counts[key][originIndex]>0){var subGroup={rowValues:group.rowValues,colValues:group.colValues,originIndex:originIndex};divisors.forEach(function(divisor){acc.push(self._getGroupSubdivision(subGroup,divisor[0],divisor[1]));});}
return acc;},[]);return this._loadDataDropPrevious.add(Promise.all(proms)).then(function(groupSubdivisions){if(groupSubdivisions.length){self._prepareData(group,groupSubdivisions);}});},_sortTree:function(sortFunction,tree){var self=this;tree.sortedKeys=_.sortBy([...tree.directSubTrees.keys()],sortFunction(tree));[...tree.directSubTrees.values()].forEach(function(subTree){self._sortTree(sortFunction,subTree);});},});return PivotModel;});;

/* /web/static/src/js/views/pivot/pivot_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.PivotController',function(require){"use strict";const AbstractController=require('web.AbstractController');const core=require('web.core');const framework=require('web.framework');const session=require('web.session');const _t=core._t;const QWeb=core.qweb;const PivotController=AbstractController.extend({custom_events:Object.assign({},AbstractController.prototype.custom_events,{closed_header_click:'_onClosedHeaderClicked',open_view:'_onOpenView',opened_header_click:'_onOpenedHeaderClicked',sort_rows:'_onSortRows',groupby_menu_selection:'_onGroupByMenuSelection',}),init:function(parent,model,renderer,params){this._super(...arguments);this.disableLinking=params.disableLinking;this.measures=params.measures;this.title=params.title;this.views=params.views;this.groupSelected=null;},destroy:function(){if(this.$buttons){this.$buttons.find('button').off();}
return this._super(...arguments);},getOwnedQueryParams:function(){const state=this.model.get({raw:true});return{context:{pivot_measures:state.measures,pivot_column_groupby:state.colGroupBys,pivot_row_groupby:state.rowGroupBys,}};},renderButtons:function($node){const context=this._getRenderButtonContext();this.$buttons=$(QWeb.render('PivotView.buttons',context));this.$buttons.click(this._onButtonClick.bind(this));this.$buttons.find('button').tooltip();if($node){this.$buttons.appendTo($node);}},updateButtons:function(){if(!this.$buttons){return;}
const state=this.model.get({raw:true});Object.entries(this.measures).forEach(elt=>{const name=elt[0];const isSelected=state.measures.includes(name);this.$buttons.find('.dropdown-item[data-field="'+name+'"]').toggleClass('selected',isSelected);});const noDataDisplayed=!state.hasData||!state.measures.length;this.$buttons.find('.o_pivot_flip_button').prop('disabled',noDataDisplayed);this.$buttons.find('.o_pivot_expand_button').prop('disabled',noDataDisplayed);this.$buttons.find('.o_pivot_download').prop('disabled',noDataDisplayed);},_downloadTable:function(){if(this.model.getTableWidth()>16384){this.call('crash_manager','show_message',_t("For Excel compatibility, data cannot be exported if there are more than 16384 columns.\n\nTip: try to flip axis, filter further or reduce the number of measures."));framework.unblockUI();return;}
const table=this.model.exportData();table.title=this.title;session.get_file({url:'/web/pivot/export_xlsx',data:{data:JSON.stringify(table)},complete:framework.unblockUI,error:(error)=>this.call('crash_manager','rpc_error',error),});},_onButtonClick:async function(ev){const $target=$(ev.target);if($target.hasClass('o_pivot_flip_button')){this.model.flip();this.update({},{reload:false});}
if($target.hasClass('o_pivot_expand_button')){await this.model.expandAll();this.update({},{reload:false});}
if(ev.target.closest('.o_pivot_measures_list')){ev.preventDefault();ev.stopPropagation();const field=ev.target.dataset.field;if(field){this.update({measure:field});}}
if($target.hasClass('o_pivot_download')){this._downloadTable();}
await this._addIncludedButtons(ev);},_addIncludedButtons:async function(ev){},_getRenderButtonContext:function(){return{measures:Object.entries(this.measures).filter(x=>x[0]!=='__count').sort((a,b)=>a[1].string.toLowerCase()>b[1].string.toLowerCase()?1:-1),};},_onCloseGroup:function(ev){this.model.closeGroup(ev.data.groupId,ev.data.type);this.update({},{reload:false});},_onOpenedHeaderClicked:function(ev){this.model.closeGroup(ev.data.cell.groupId,ev.data.type);this.update({},{reload:false});},_onClosedHeaderClicked:async function(ev){const cell=ev.data.cell;const groupId=cell.groupId;const type=ev.data.type;const group={rowValues:groupId[0],colValues:groupId[1],type:type};const state=this.model.get({raw:true});const groupValues=type==='row'?groupId[0]:groupId[1];const groupBys=type==='row'?state.rowGroupBys:state.colGroupBys;this.selectedGroup=group;if(groupValues.length<groupBys.length){const groupBy=groupBys[groupValues.length];await this.model.expandGroup(this.selectedGroup,groupBy);this.update({},{reload:false});}},_onGroupByMenuSelection:async function(ev){ev.stopPropagation();let groupBy=ev.data.field.name;const interval=ev.data.interval;if(interval){groupBy=groupBy+':'+interval;}
this.model.addGroupBy(groupBy,this.selectedGroup.type);await this.model.expandGroup(this.selectedGroup,groupBy);this.update({},{reload:false});},_onOpenView:function(ev){ev.stopPropagation();const cell=ev.data;if(cell.value===undefined||this.disableLinking){return;}
const context=Object.assign({},this.model.data.context);Object.keys(context).forEach(x=>{if(x==='group_by'||x.startsWith('search_default_')){delete context[x];}});const group={rowValues:cell.groupId[0],colValues:cell.groupId[1],originIndex:cell.originIndexes[0]};const domain=this.model._getGroupDomain(group);this.do_action({type:'ir.actions.act_window',name:this.title,res_model:this.modelName,views:this.views,view_mode:'list',target:'current',context:context,domain:domain,});},_onSortRows:function(ev){this.model.sortRows({groupId:ev.data.groupId,measure:ev.data.measure,order:(ev.data.order||'desc')==='asc'?'desc':'asc',originIndexes:ev.data.originIndexes,});this.update({},{reload:false});},});return PivotController;});;

/* /web/static/src/js/views/pivot/pivot_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.PivotRenderer',function(require){"use strict";const OwlAbstractRenderer=require('web.AbstractRendererOwl');const field_utils=require('web.field_utils');const patchMixin=require('web.patchMixin');const{useExternalListener,useState,onMounted,onPatched}=owl.hooks;class PivotRenderer extends OwlAbstractRenderer{constructor(){super(...arguments);this.sampleDataTargets=['table'];this.state=useState({activeNodeHeader:{groupId:false,isXAxis:false,click:false},});onMounted(()=>this._updateTooltip());onPatched(()=>this._updateTooltip());if(!this.env.device.isMobile){useExternalListener(window,'click',this._resetState);}}
_getFormattedValue(cell){const type=this.props.widgets[cell.measure]||(this.props.fields[cell.measure].type==='many2one'?'integer':this.props.fields[cell.measure].type);const formatter=field_utils.format[type];return formatter(cell.value,this.props.fields[cell.measure]);}
_getFormattedVariation(cell){const value=cell.value;return isNaN(value)?'-':field_utils.format.percentage(value,this.props.fields[cell.measure]);}
_getPadding(cell){return 5+cell.indent*30;}
_isClicked(groupId,isXAxis){return _.isEqual(groupId,this.state.activeNodeHeader.groupId)&&this.state.activeNodeHeader.isXAxis===isXAxis;}
_resetState(){if(this.isHeaderClicked){this.isHeaderClicked=false;return;}
this.state.activeNodeHeader={groupId:false,isXAxis:false,click:false};}
_updateTooltip(){$(this.el).find('.o_pivot_header_cell_opened, .o_pivot_header_cell_closed').tooltip();}
_onClickMenuGroupBy(field,interval){this.trigger('groupby_menu_selection',{field,interval});}
_onHeaderClick(cell,type){const groupValues=cell.groupId[type==='col'?1:0];const groupByLength=type==='col'?this.props.colGroupBys.length:this.props.rowGroupBys.length;if(cell.isLeaf&&groupValues.length>=groupByLength){this.isHeaderClicked=true;this.state.activeNodeHeader={groupId:cell.groupId,isXAxis:type==='col',click:'leftClick'};}
this.trigger(cell.isLeaf?'closed_header_click':'opened_header_click',{cell,type});}
_onMouseEnter(ev){var index=[...ev.currentTarget.parentNode.children].indexOf(ev.currentTarget);if(ev.currentTarget.tagName==='TH'){index+=1;}
this.el.querySelectorAll('td:nth-child('+(index+1)+')').forEach(elt=>elt.classList.add('o_cell_hover'));}
_onMouseLeave(){this.el.querySelectorAll('.o_cell_hover').forEach(elt=>elt.classList.remove('o_cell_hover'));}}
PivotRenderer.template='web.PivotRenderer';return patchMixin(PivotRenderer);});;

/* /web/static/src/js/views/pivot/pivot_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.PivotView',function(require){"use strict";const AbstractView=require('web.AbstractView');const config=require('web.config');const core=require('web.core');const PivotModel=require('web.PivotModel');const PivotController=require('web.PivotController');const PivotRenderer=require('web.PivotRenderer');const RendererWrapper=require('web.RendererWrapper');const _t=core._t;const _lt=core._lt;const searchUtils=require('web.searchUtils');const GROUPABLE_TYPES=searchUtils.GROUPABLE_TYPES;const PivotView=AbstractView.extend({display_name:_lt('Pivot'),icon:'fa-table',config:Object.assign({},AbstractView.prototype.config,{Model:PivotModel,Controller:PivotController,Renderer:PivotRenderer,}),viewType:'pivot',searchMenuTypes:['filter','groupBy','comparison','favorite'],init:function(viewInfo,params){this._super.apply(this,arguments);const activeMeasures=[];const colGroupBys=[];const rowGroupBys=[];const measures={};const groupableFields={};const widgets={};const additionalMeasures=params.additionalMeasures||[];this.fields.__count={string:_t("Count"),type:"integer"};Object.keys(this.fields).forEach(name=>{const field=this.fields[name];if(name!=='id'&&field.store===true){if(['integer','float','monetary'].includes(field.type)||additionalMeasures.includes(name)){measures[name]=field;}
if(GROUPABLE_TYPES.includes(field.type)){groupableFields[name]=field;}}});measures.__count={string:_t("Count"),type:"integer"};this.arch.children.forEach(field=>{let name=field.attrs.name;if(field.attrs.invisible&&py.eval(field.attrs.invisible)){if(name in groupableFields){delete groupableFields[name];}
if(!additionalMeasures.includes(name)){delete measures[name];return;}}
if(field.attrs.interval){name+=':'+field.attrs.interval;}
if(field.attrs.widget){widgets[name]=field.attrs.widget;}
if(field.attrs.type==='measure'&&!(name in measures)){measures[name]=this.fields[name];}
if(field.attrs.string&&name in measures){measures[name].string=field.attrs.string;}
if(field.attrs.type==='measure'||'operator'in field.attrs){activeMeasures.push(name);measures[name]=this.fields[name];}
if(field.attrs.type==='col'){colGroupBys.push(name);}
if(field.attrs.type==='row'){rowGroupBys.push(name);}});if((!activeMeasures.length)||this.arch.attrs.display_quantity){activeMeasures.splice(0,0,'__count');}
this.loadParams.measures=activeMeasures;this.loadParams.colGroupBys=config.device.isMobile?[]:colGroupBys;this.loadParams.rowGroupBys=rowGroupBys;this.loadParams.fields=this.fields;this.loadParams.default_order=params.default_order||this.arch.attrs.default_order;this.loadParams.groupableFields=groupableFields;const disableLinking=!!(this.arch.attrs.disable_linking&&JSON.stringify(this.arch.attrs.disable_linking));this.rendererParams.widgets=widgets;this.rendererParams.disableLinking=disableLinking;this.controllerParams.disableLinking=disableLinking;this.controllerParams.title=params.title||this.arch.attrs.string||_t("Untitled");this.controllerParams.measures=measures;this.controllerParams.views=[_findView(params.actionViews,'list'),_findView(params.actionViews,'form'),];function _findView(views,viewType){const view=views.find(view=>{return view.type===viewType;});return[view?view.viewID:false,viewType];}},getRenderer(parent,state){state=Object.assign(state||{},this.rendererParams);return new RendererWrapper(parent,this.config.Renderer,state);},});return PivotView;});;

/* /web/static/src/js/views/calendar/calendar_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.CalendarController',function(require){"use strict";var AbstractController=require('web.AbstractController');var core=require('web.core');var Dialog=require('web.Dialog');var dialogs=require('web.view_dialogs');var QuickCreate=require('web.CalendarQuickCreate');var _t=core._t;var QWeb=core.qweb;function dateToServer(date){return date.clone().utc().locale('en').format('YYYY-MM-DD HH:mm:ss');}
var CalendarController=AbstractController.extend({custom_events:_.extend({},AbstractController.prototype.custom_events,{changeDate:'_onChangeDate',changeFilter:'_onChangeFilter',deleteRecord:'_onDeleteRecord',dropRecord:'_onDropRecord',next:'_onNext',openCreate:'_onOpenCreate',openEvent:'_onOpenEvent',prev:'_onPrev',quickCreate:'_onQuickCreate',updateRecord:'_onUpdateRecord',viewUpdated:'_onViewUpdated',}),events:_.extend({},AbstractController.prototype.events,{'click button.o_calendar_button_new':'_onButtonNew','click button.o_calendar_button_prev':'_onButtonNavigation','click button.o_calendar_button_today':'_onButtonNavigation','click button.o_calendar_button_next':'_onButtonNavigation','click button.o_calendar_button_day':'_onButtonScale','click button.o_calendar_button_week':'_onButtonScale','click button.o_calendar_button_month':'_onButtonScale','click button.o_calendar_button_year':'_onButtonScale',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.current_start=null;this.displayName=params.displayName;this.quickAddPop=params.quickAddPop;this.disableQuickCreate=params.disableQuickCreate;this.eventOpenPopup=params.eventOpenPopup;this.showUnusualDays=params.showUnusualDays;this.formViewId=params.formViewId;this.readonlyFormViewId=params.readonlyFormViewId;this.mapping=params.mapping;this.context=params.context;this.previousOpen=null;this.quickCreating=false;this.scales=params.scales;},renderButtons:function($node){this.$buttons=$(QWeb.render('CalendarView.buttons',this._renderButtonsParameters()));this.$buttons.find('.o_calendar_button_'+this.mode).addClass('active');if($node){this.$buttons.appendTo($node);}else{this.$('.o_calendar_buttons').replaceWith(this.$buttons);}},_extractLastPartOfClassName(startClassName,classList){var result;classList.forEach(function(value){if(value&&value.indexOf(startClassName)===0){result=value.substring(startClassName.length);}});return result;},_move:function(to){this.model[to]();return this.reload();},_renderButtonsParameters(){return{scales:this.scales,};},_update:function(){var self=this;if(!this.showUnusualDays){return this._super.apply(this,arguments);}
return this._super.apply(this,arguments).then(function(){self._rpc({model:self.modelName,method:'get_unusual_days',args:[self.model.data.start_date.format('YYYY-MM-DD'),self.model.data.end_date.format('YYYY-MM-DD')],context:self.context,}).then(function(data){_.each(self.$el.find('td.fc-day'),function(td){var $td=$(td);if(data[$td.data('date')]){$td.addClass('o_calendar_disabled');}});});});},_updateRecord:function(record){var reload=this.reload.bind(this,{});return this.model.updateRecord(record).then(reload,reload);},_onButtonNew(){this.trigger_up('switch_view',{view_type:'form'});},_onButtonNavigation(jsEvent){const action=this._extractLastPartOfClassName('o_calendar_button_',jsEvent.currentTarget.classList);if(action){this._move(action);}},_onButtonScale(jsEvent){const scale=this._extractLastPartOfClassName('o_calendar_button_',jsEvent.currentTarget.classList);if(scale){this.model.setScale(scale);this.reload();}},_onChangeDate:function(event){var modelData=this.model.get();if(modelData.target_date.format('YYYY-MM-DD')===event.data.date.format('YYYY-MM-DD')){switch(modelData.scale){case'month':this.model.setScale('week');break;case'week':this.model.setScale('day');break;case'day':this.model.setScale('month');break;}}else if(modelData.target_date.week()===event.data.date.week()){this.model.setScale('day');}else{this.model.setScale('week');}
this.model.setDate(event.data.date);this.reload();},_onChangeFilter:function(event){if(this.model.changeFilter(event.data)&&!event.data.no_reload){this.reload();}},_onDeleteRecord:function(event){var self=this;Dialog.confirm(this,_t("Are you sure you want to delete this record ?"),{confirm_callback:function(){self.model.deleteRecords([event.data.id],self.modelName).then(function(){self.reload();});}});},_onDropRecord:function(event){this._updateRecord(_.extend({},event.data,{'drop':true,}));},_onNext:function(event){event.stopPropagation();this._move('next');},_onOpenCreate:function(event){var self=this;if(["year","month"].includes(this.model.get().scale)){event.data.allDay=true;}
var data=this.model.calendarEventToRecord(event.data);var context=_.extend({},this.context,event.options&&event.options.context);if(data.name){context.default_name=data.name;}
context['default_'+this.mapping.date_start]=data[this.mapping.date_start]||null;if(this.mapping.date_stop){context['default_'+this.mapping.date_stop]=data[this.mapping.date_stop]||null;}
if(this.mapping.date_delay){context['default_'+this.mapping.date_delay]=data[this.mapping.date_delay]||null;}
if(this.mapping.all_day){context['default_'+this.mapping.all_day]=data[this.mapping.all_day]||null;}
for(var k in context){if(context[k]&&context[k]._isAMomentObject){context[k]=dateToServer(context[k]);}}
var options=_.extend({},this.options,event.options,{context:context,title:_.str.sprintf(_t('Create: %s'),(this.displayName||this.renderer.arch.attrs.string))});if(this.quick!=null){this.quick.destroy();this.quick=null;}
if(!options.disableQuickCreate&&!event.data.disableQuickCreate&&this.quickAddPop){this.quick=new QuickCreate(this,true,options,data,event.data);this.quick.open();this.quick.opened(function(){self.quick.focus();});return;}
var title=_t("Create");if(this.renderer.arch.attrs.string){title+=': '+this.renderer.arch.attrs.string;}
if(this.eventOpenPopup){if(this.previousOpen){this.previousOpen.close();}
this.previousOpen=new dialogs.FormViewDialog(self,{res_model:this.modelName,context:context,title:title,view_id:this.formViewId||false,disable_multiple_selection:true,on_saved:function(){if(event.data.on_save){event.data.on_save();}
self.reload();},});this.previousOpen.open();}else{this.do_action({type:'ir.actions.act_window',res_model:this.modelName,views:[[this.formViewId||false,'form']],target:'current',context:context,});}},_onOpenEvent:function(event){var self=this;var id=event.data._id;id=id&&parseInt(id).toString()===id?parseInt(id):id;if(!this.eventOpenPopup){this._rpc({model:self.modelName,method:'get_formview_id',args:[[id]],context:event.context||self.context,}).then(function(viewId){self.do_action({type:'ir.actions.act_window',res_id:id,res_model:self.modelName,views:[[viewId||false,'form']],target:'current',context:event.context||self.context,});});return;}
var options={res_model:self.modelName,res_id:id||null,context:event.context||self.context,title:_t("Open: ")+event.data.title,on_saved:function(){if(event.data.on_save){event.data.on_save();}
self.reload();},};if(this.formViewId){options.view_id=parseInt(this.formViewId);}
new dialogs.FormViewDialog(this,options).open();},_onPrev:function(){event.stopPropagation();this._move('prev');},_onQuickCreate:function(event){var self=this;if(this.quickCreating){return;}
this.quickCreating=true;this.model.createRecord(event).then(function(){self.quick.destroy();self.quick=null;self.reload();self.quickCreating=false;}).guardedCatch(function(result){var errorEvent=result.event;errorEvent.preventDefault();event.data.options.disableQuickCreate=true;event.data.data.on_save=self.quick.destroy.bind(self.quick);self._onOpenCreate(event.data);self.quickCreating=false;});},_onUpdateRecord:function(event){this._updateRecord(event.data);},_onViewUpdated:function(event){this.mode=event.data.mode;if(this.$buttons){this.$buttons.find('.active').removeClass('active');this.$buttons.find('.o_calendar_button_'+this.mode).addClass('active');}
const title=`${this.displayName} (${event.data.title})`;return this.updateControlPanel({title});},});return CalendarController;});;

/* /web/static/src/js/views/calendar/calendar_model.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.CalendarModel',function(require){"use strict";var AbstractModel=require('web.AbstractModel');var Context=require('web.Context');var core=require('web.core');var fieldUtils=require('web.field_utils');var session=require('web.session');var _t=core._t;function dateToServer(date){return date.clone().utc().locale('en').format('YYYY-MM-DD HH:mm:ss');}
return AbstractModel.extend({init:function(){this._super.apply(this,arguments);this.end_date=null;var week_start=_t.database.parameters.week_start;this.week_start=week_start!==undefined&&week_start!==false?week_start%7:moment().startOf('week').day();this.week_stop=this.week_start+6;},calendarEventToRecord:function(event){var data={'name':event.title};var start=event.start.clone();var end=event.end&&event.end.clone();if(!end||end.diff(start)<0){if(event.allDay){end=start.clone();}else{end=start.clone().add(2,'h');}}else if(event.allDay){end.add(-1,'days');}
var isDateEvent=this.fields[this.mapping.date_start].type==='date';if(event.allDay){if(!this.mapping.all_day&&!isDateEvent){if(event.r_start){start.hours(event.r_start.hours()).minutes(event.r_start.minutes()).seconds(event.r_start.seconds()).utc();end.hours(event.r_end.hours()).minutes(event.r_end.minutes()).seconds(event.r_end.seconds()).utc();}else{start.hours(7);end.hours(19);}
start.add(-this.getSession().getTZOffset(start),'minutes');end.add(-this.getSession().getTZOffset(end),'minutes');}}else{start.add(-this.getSession().getTZOffset(start),'minutes');end.add(-this.getSession().getTZOffset(end),'minutes');}
if(this.mapping.all_day){if(event.record){data[this.mapping.all_day]=(this.data.scale!=='month'&&event.allDay)||event.record[this.mapping.all_day]&&end.diff(start)<10||false;}else{data[this.mapping.all_day]=event.allDay;}}
data[this.mapping.date_start]=start;if(this.mapping.date_stop){data[this.mapping.date_stop]=end;}
if(this.mapping.date_delay){if(this.data.scale!=='month'||(this.data.scale==='month'&&!event.drop)){data[this.mapping.date_delay]=(end.diff(start)<=0?end.endOf('day').diff(start):end.diff(start))/1000/3600;}}
return data;},changeFilter:function(filter){var Filter=this.data.filters[filter.fieldName];if(filter.value==='all'){Filter.all=filter.active;}
var f=_.find(Filter.filters,function(f){return f.value===filter.value;});if(f){if(f.active!==filter.active){f.active=filter.active;}else{return false;}}else if(filter.active){Filter.filters.push({value:filter.value,active:true,});}
return true;},createRecord:function(event){var data=this.calendarEventToRecord(event.data.data);for(var k in data){if(data[k]&&data[k]._isAMomentObject){data[k]=dateToServer(data[k]);}}
return this._rpc({model:this.modelName,method:'create',args:[data],context:event.data.options.context,});},deleteRecords:function(ids,model){return this._rpc({model:model,method:'unlink',args:[ids],context:session.user_context,});},__get:function(){return _.extend({},this.data,{fields:this.fields});},__load:function(params){var self=this;this.modelName=params.modelName;this.fields=params.fields;this.fieldNames=params.fieldNames;this.fieldsInfo=params.fieldsInfo;this.mapping=params.mapping;this.mode=params.mode;this.scales=params.scales;this.scalesInfo=params.scalesInfo;this.editable=params.editable;this.creatable=params.creatable;this.eventLimit=params.eventLimit;this.fieldColor=params.fieldColor;if(!this.preloadPromise){this.preloadPromise=new Promise(function(resolve,reject){Promise.all([self._rpc({model:self.modelName,method:'check_access_rights',args:["write",false]}),self._rpc({model:self.modelName,method:'check_access_rights',args:["create",false]})]).then(function(result){var write=result[0];var create=result[1];self.write_right=write;self.create_right=create;resolve();}).guardedCatch(reject);});}
this.data={domain:params.domain,context:params.context,filters:params.filters,};this.setDate(params.initialDate);this.setScale(params.mode);_.each(this.data.filters,function(filter){if(filter.avatar_field&&!filter.avatar_model){filter.avatar_model=self.modelName;}});return this.preloadPromise.then(this._loadCalendar.bind(this));},next:function(){this.setDate(this.data.target_date.clone().add(1,this.data.scale));},prev:function(){this.setDate(this.data.target_date.clone().add(-1,this.data.scale));},__reload:function(handle,params){if(params.domain){this.data.domain=params.domain;}
if(params.context){this.data.context=params.context;}
return this._loadCalendar();},setDate:function(start){this.data.highlight_date=this.data.target_date=start.clone();this.data.start_date=this.data.end_date=start;switch(this.data.scale){case'year':{const yearStart=this.data.start_date.clone().startOf('year');let yearStartDay=this.week_start;if(yearStart.day()<yearStartDay){yearStartDay-=7;}
this.data.start_date=yearStart.day(yearStartDay).startOf('day');this.data.end_date=this.data.end_date.clone().endOf('year').day(this.week_stop).endOf('day');break;}
case'month':var monthStart=this.data.start_date.clone().startOf('month');var monthStartDay;if(monthStart.day()>=this.week_start){monthStartDay=this.week_start;}else{monthStartDay=this.week_start-7;}
this.data.start_date=monthStart.day(monthStartDay).startOf('day');this.data.end_date=this.data.start_date.clone().add(5,'week').day(this.week_stop).endOf('day');break;case'week':var weekStart=this.data.start_date.clone().startOf('week');var weekStartDay=this.week_start;if(this.data.start_date.day()<this.week_start){weekStartDay-=7;}
this.data.start_date=this.data.start_date.clone().day(weekStartDay).startOf('day');this.data.end_date=this.data.end_date.clone().day(weekStartDay+6).endOf('day');break;default:this.data.start_date=this.data.start_date.clone().startOf('day');this.data.end_date=this.data.end_date.clone().endOf('day');}
var manualUtcDateStart=this.data.start_date.clone().add(-this.getSession().getTZOffset(this.data.start_date),'minutes');var formattedUtcDateStart=manualUtcDateStart.format('YYYY-MM-DDTHH:mm:ss')+'Z';this.data.start_date=moment.utc(formattedUtcDateStart);var manualUtcDateEnd=this.data.end_date.clone().add(-this.getSession().getTZOffset(this.data.start_date),'minutes');var formattedUtcDateEnd=manualUtcDateEnd.format('YYYY-MM-DDTHH:mm:ss')+'Z';this.data.end_date=moment.utc(formattedUtcDateEnd);},setScale:function(scale){if(!_.contains(this.scales,scale)){scale="week";}
this.data.scale=scale;this.setDate(this.data.target_date);},today:function(){this.setDate(moment(new Date()));},updateRecord:function(record){var data=_.omit(this.calendarEventToRecord(record),'name');for(var k in data){if(data[k]&&data[k]._isAMomentObject){data[k]=dateToServer(data[k]);}}
var context=new Context(this.data.context,{from_ui:true});return this._rpc({model:this.modelName,method:'write',args:[[parseInt(record.id,10)],data],context:context});},_getFilterDomain:function(){var authorizedValues={};var avoidValues={};_.each(this.data.filters,function(filter){if(filter.all)return;_.each(filter.filters,function(f){if(filter.write_model){if(!authorizedValues[filter.fieldName])
authorizedValues[filter.fieldName]=[];if(f.active){authorizedValues[filter.fieldName].push(f.value);}}else{if(!f.active){if(!avoidValues[filter.fieldName])
avoidValues[filter.fieldName]=[];avoidValues[filter.fieldName].push(f.value);}}});});var domain=[];for(var field in authorizedValues){domain.push([field,'in',authorizedValues[field]]);}
for(var field in avoidValues){if(avoidValues[field].length>0){domain.push([field,'not in',avoidValues[field]]);}}
return domain;},_getFullCalendarOptions:function(){var format12Hour={hour:'numeric',minute:'2-digit',omitZeroMinute:true,meridiem:'short'};var format24Hour={hour:'numeric',minute:'2-digit',hour12:false,};return{defaultView:this.scalesInfo[this.mode||'week'],header:false,selectable:this.creatable&&this.create_right,selectMirror:true,editable:this.editable,droppable:true,navLinks:false,eventLimit:this.eventLimit,snapMinutes:15,longPressDelay:500,eventResizableFromStart:true,nowIndicator:true,weekNumbers:true,weekNumbersWithinDays:true,weekNumberCalculation:function(date){return moment(date).week();},weekLabel:_t("Week"),allDayText:_t("All day"),monthNames:moment.months(),monthNamesShort:moment.monthsShort(),dayNames:moment.weekdays(),dayNamesShort:moment.weekdaysShort(),firstDay:this.week_start,slotLabelFormat:_t.database.parameters.time_format.search("%H")!==-1?format24Hour:format12Hour,allDaySlot:this.mapping.all_day||this.fields[this.mapping.date_start].type==='date',};},_getRangeDomain:function(){var domain=[[this.mapping.date_start,'<=',dateToServer(this.data.end_date)]];if(this.mapping.date_stop){domain.push([this.mapping.date_stop,'>=',dateToServer(this.data.start_date)]);}else if(!this.mapping.date_delay){domain.push([this.mapping.date_start,'>=',dateToServer(this.data.start_date)]);}
return domain;},_loadCalendar:function(){var self=this;this.data.fc_options=this._getFullCalendarOptions();var defs=_.map(this.data.filters,this._loadFilter.bind(this));return Promise.all(defs).then(function(){return self._rpc({model:self.modelName,method:'search_read',context:self.data.context,fields:self.fieldNames,domain:self.data.domain.concat(self._getRangeDomain()).concat(self._getFilterDomain())}).then(function(events){self._parseServerData(events);self.data.data=_.map(events,self._recordToCalendarEvent.bind(self));return Promise.all([self._loadColors(self.data,self.data.data),self._loadRecordsToFilters(self.data,self.data.data)]);});});},_loadColors:function(element,events){if(this.fieldColor){var fieldName=this.fieldColor;_.each(events,function(event){var value=event.record[fieldName];event.color_index=_.isArray(value)?value[0]:value;});this.model_color=this.fields[fieldName].relation||element.model;}
return Promise.resolve();},_loadFilter:function(filter){if(!filter.write_model){return Promise.resolve();}
var field=this.fields[filter.fieldName];return this._rpc({model:filter.write_model,method:'search_read',domain:[["user_id","=",session.uid]],fields:[filter.write_field],}).then(function(res){var records=_.map(res,function(record){var _value=record[filter.write_field];var value=_.isArray(_value)?_value[0]:_value;var f=_.find(filter.filters,function(f){return f.value===value;});var formater=fieldUtils.format[_.contains(['many2many','one2many'],field.type)?'many2one':field.type];return{'id':record.id,'value':value,'label':formater(_value,field),'active':!f||f.active,};});records.sort(function(f1,f2){return _.string.naturalCmp(f2.label,f1.label);});if(field.relation==='res.partner'||field.relation==='res.users'){var value=field.relation==='res.partner'?session.partner_id:session.uid;var me=_.find(records,function(record){return record.value===value;});if(me){records.splice(records.indexOf(me),1);}else{var f=_.find(filter.filters,function(f){return f.value===value;});me={'value':value,'label':session.name+_t(" [Me]"),'active':!f||f.active,};}
records.unshift(me);}
records.push({'value':'all','label':field.relation==='res.partner'||field.relation==='res.users'?_t("Everybody's calendars"):_t("Everything"),'active':filter.all,});filter.filters=records;});},_loadRecordsToFilters:function(element,events){var self=this;var new_filters={};var to_read={};var defs=[];var color_filter={};_.each(this.data.filters,function(filter,fieldName){var field=self.fields[fieldName];new_filters[fieldName]=filter;if(filter.write_model){if(field.relation===self.model_color){_.each(filter.filters,function(f){f.color_index=f.value;});}
return;}
var fs=[];var undefined_fs=[];_.each(events,function(event){var data=event.record[fieldName];if(!_.contains(['many2many','one2many'],field.type)){data=[data];}else{to_read[field.relation]=(to_read[field.relation]||[]).concat(data);}
_.each(data,function(_value){var value=_.isArray(_value)?_value[0]:_value;var f={'color_index':self.model_color===(field.relation||element.model)?value:false,'value':value,'label':fieldUtils.format[field.type](_value,field)||_t("Undefined"),'avatar_model':field.relation||element.model,};value?fs.push(f):undefined_fs.push(f);});});_.each(_.union(fs,undefined_fs),function(f){var f1=_.findWhere(filter.filters,_.omit(f,'color_index'));if(f1){f1.display=true;}else{f.display=f.active=true;filter.filters.push(f);}});if(filter.color_model&&filter.field_color){var ids=filter.filters.reduce((acc,f)=>{if(!f.color_index&&f.value){acc.push(f.value);}
return acc;},[]);if(!color_filter[filter.color_model]){color_filter[filter.color_model]={};}
if(ids.length){defs.push(self._rpc({model:filter.color_model,method:'read',args:[_.uniq(ids),[filter.field_color]],}).then(function(res){_.each(res,function(c){color_filter[filter.color_model][c.id]=c[filter.field_color];});}));}}});_.each(to_read,function(ids,model){defs.push(self._rpc({model:model,method:'name_get',args:[_.uniq(ids)],}).then(function(res){to_read[model]=_.object(res);}));});return Promise.all(defs).then(function(){_.each(self.data.filters,function(filter){if(filter.write_model){return;}
if(filter.filters.length&&(filter.filters[0].avatar_model in to_read)){_.each(filter.filters,function(f){f.label=to_read[f.avatar_model][f.value];});}
if(filter.color_model&&filter.field_color){_.each(filter.filters,function(f){if(!f.color_index){f.color_index=color_filter[filter.color_model]&&color_filter[filter.color_model][f.value];}});}});});},_parseServerData:function(data){var self=this;_.each(data,function(event){_.each(self.fieldNames,function(fieldName){event[fieldName]=self._parseServerValue(self.fields[fieldName],event[fieldName]);});});},_recordToCalendarEvent:function(evt){var date_start;var date_stop;var date_delay=evt[this.mapping.date_delay]||1.0,all_day=this.fields[this.mapping.date_start].type==='date'||this.mapping.all_day&&evt[this.mapping.all_day]||false,the_title='',attendees=[];if(!all_day){date_start=evt[this.mapping.date_start].clone();date_stop=this.mapping.date_stop?evt[this.mapping.date_stop].clone():null;}else{date_start=evt[this.mapping.date_start].clone().startOf('day');date_stop=this.mapping.date_stop?evt[this.mapping.date_stop].clone().startOf('day'):null;}
if(!date_stop&&date_delay){date_stop=date_start.clone().add(date_delay,'hours');}
if(!all_day){date_start.add(this.getSession().getTZOffset(date_start),'minutes');date_stop.add(this.getSession().getTZOffset(date_stop),'minutes');}
if(this.mapping.all_day&&evt[this.mapping.all_day]){date_stop.add(1,'days');}
var r={'record':evt,'start':date_start.local(true).toDate(),'end':date_stop.local(true).toDate(),'r_start':date_start.clone().local(true).toDate(),'r_end':date_stop.clone().local(true).toDate(),'title':the_title,'allDay':all_day,'id':evt.id,'attendees':attendees,};if(!(this.mapping.all_day&&evt[this.mapping.all_day])&&this.data.scale==='month'&&this.fields[this.mapping.date_start].type!=='date'){r.showTime=true;}
return r;},});});;

/* /web/static/src/js/views/calendar/calendar_popover.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.CalendarPopover',function(require){"use strict";var fieldRegistry=require('web.field_registry');const fieldRegistryOwl=require('web.field_registry_owl');const FieldWrapper=require('web.FieldWrapper');var StandaloneFieldManagerMixin=require('web.StandaloneFieldManagerMixin');var Widget=require('web.Widget');const{WidgetAdapterMixin}=require('web.OwlCompatibility');var CalendarPopover=Widget.extend(WidgetAdapterMixin,StandaloneFieldManagerMixin,{template:'CalendarView.event.popover',events:{'click .o_cw_popover_edit':'_onClickPopoverEdit','click .o_cw_popover_delete':'_onClickPopoverDelete',},init:function(parent,eventInfo){this._super.apply(this,arguments);StandaloneFieldManagerMixin.init.call(this);this.hideDate=eventInfo.hideDate;this.hideTime=eventInfo.hideTime;this.eventTime=eventInfo.eventTime;this.eventDate=eventInfo.eventDate;this.displayFields=eventInfo.displayFields;this.fields=eventInfo.fields;this.event=eventInfo.event;this.modelName=eventInfo.modelName;this._canDelete=eventInfo.canDelete;},willStart:function(){return Promise.all([this._super.apply(this,arguments),this._processFields()]);},start:function(){var self=this;_.each(this.$fieldsList,function($field){$field.appendTo(self.$('.o_cw_popover_fields_secondary'));});return this._super.apply(this,arguments);},destroy:function(){this._super.apply(this,arguments);WidgetAdapterMixin.destroy.call(this);},on_attach_callback:function(){WidgetAdapterMixin.on_attach_callback.call(this);},on_detach_callback:function(){WidgetAdapterMixin.on_detach_callback.call(this);},isEventDeletable(){return this._canDelete;;},isEventDetailsVisible(){return true;},isEventEditable(){return true;},_processFields:function(){var self=this;var fieldsToGenerate=[];var fields=_.keys(this.displayFields);for(var i=0;i<fields.length;i++){var fieldName=fields[i];var displayFieldInfo=self.displayFields[fieldName]||{attrs:{invisible:1}};var fieldInfo=self.fields[fieldName];var field={name:fieldName,string:displayFieldInfo.attrs.string||fieldInfo.string,value:self.event.extendedProps.record[fieldName],type:fieldInfo.type,};if(field.type==='selection'){field.selection=fieldInfo.selection;}
if(field.type==='monetary'){var currencyField=field.currency_field||'currency_id';if(!fields.includes(currencyField)&&_.has(self.event.record,currencyField)){fields.push(currencyField);}}
if(fieldInfo.relation){field.relation=fieldInfo.relation;}
if(displayFieldInfo.attrs.widget){field.widget=displayFieldInfo.attrs.widget;}else if(_.contains(['many2many','one2many'],field.type)){field.widget='many2many_tags';}
if(_.contains(['many2many','one2many'],field.type)){field.fields=[{name:'id',type:'integer',},{name:'display_name',type:'char',}];}
fieldsToGenerate.push(field);};this.$fieldsList=[];return this.model.makeRecord(this.modelName,fieldsToGenerate).then(function(recordID){var defs=[];var record=self.model.get(recordID);_.each(fieldsToGenerate,function(field){if(field.invisible)return;let isLegacy=true;let fieldWidget;let FieldClass=fieldRegistryOwl.getAny([field.widget,field.type]);if(FieldClass){isLegacy=false;fieldWidget=new FieldWrapper(this,FieldClass,{fieldName:field.name,record,options:self.displayFields[field.name],});}else{FieldClass=fieldRegistry.getAny([field.widget,field.type]);fieldWidget=new FieldClass(self,field.name,record,self.displayFields[field.name]);}
if(fieldWidget.attrs&&!_.isObject(fieldWidget.attrs.modifiers)){fieldWidget.attrs.modifiers=fieldWidget.attrs.modifiers?JSON.parse(fieldWidget.attrs.modifiers):{};}
self._registerWidget(recordID,field.name,fieldWidget);var $field=$('<li>',{class:'list-group-item flex-shrink-0 d-flex flex-wrap'});var $fieldLabel=$('<strong>',{class:'mr-2',text:_.str.sprintf('%s : ',field.string)});$fieldLabel.appendTo($field);var $fieldContainer=$('<div>',{class:'flex-grow-1'});$fieldContainer.appendTo($field);let def;if(isLegacy){def=fieldWidget.appendTo($fieldContainer);}else{def=fieldWidget.mount($fieldContainer[0]);}
defs.push(def.then(function(){self.$fieldsList.push($field);}));});return Promise.all(defs);});},_onClickPopoverEdit:function(ev){ev.preventDefault();this.trigger_up('edit_event',{id:this.event.id,title:this.event.extendedProps.record.display_name,});},_onClickPopoverDelete:function(ev){ev.preventDefault();this.trigger_up('delete_event',{id:this.event.id});},});return CalendarPopover;});;

/* /web/static/src/js/views/calendar/calendar_quick_create.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.CalendarQuickCreate',function(require){"use strict";var core=require('web.core');var Dialog=require('web.Dialog');var _t=core._t;var QWeb=core.qweb;var QuickCreate=Dialog.extend({events:_.extend({},Dialog.events,{'keyup input':'_onkeyup',}),init:function(parent,buttons,options,dataTemplate,dataCalendar){this._buttons=buttons||false;this.options=options;this.dataTemplate=dataTemplate||{};this.dataCalendar=dataCalendar;var self=this;this._super(parent,{title:options.title,size:'small',buttons:this._buttons?[{text:_t("Create"),classes:'btn-primary',click:function(){if(!self._quickAdd(dataCalendar)){self.focus();}}},{text:_t("Edit"),click:function(){dataCalendar.disableQuickCreate=true;dataCalendar.title=self.$('input').val().trim();dataCalendar.on_save=self.destroy.bind(self);self.trigger_up('openCreate',dataCalendar);}},{text:_t("Cancel"),close:true},]:[],$content:QWeb.render('CalendarView.quick_create',{widget:this})});},focus:function(){this.$('input').focus();},_quickAdd:function(dataCalendar){dataCalendar=$.extend({},this.dataTemplate,dataCalendar);var val=this.$('input').val().trim();if(!val){this.$('label, input').addClass('o_field_invalid');var warnings=_.str.sprintf('<ul><li>%s</li></ul>',_t("Summary"));this.do_warn(_t("Invalid fields:"),warnings);}
dataCalendar.title=val;return(val)?this.trigger_up('quickCreate',{data:dataCalendar,options:this.options}):false;},_onkeyup:function(event){if(this._flagEnter){return;}
if(event.keyCode===$.ui.keyCode.ENTER){this._flagEnter=true;if(!this._quickAdd(this.dataCalendar)){this._flagEnter=false;}}else if(event.keyCode===$.ui.keyCode.ESCAPE&&this._buttons){this.close();}},});return QuickCreate;});;

/* /web/static/src/js/views/calendar/calendar_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.CalendarRenderer',function(require){"use strict";var AbstractRenderer=require('web.AbstractRenderer');var CalendarPopover=require('web.CalendarPopover');var core=require('web.core');var Dialog=require('web.Dialog');var field_utils=require('web.field_utils');var FieldManagerMixin=require('web.FieldManagerMixin');var relational_fields=require('web.relational_fields');var session=require('web.session');var Widget=require('web.Widget');const{createYearCalendarView}=require('/web/static/src/js/libs/fullcalendar.js');var _t=core._t;var qweb=core.qweb;var SidebarFilterM2O=relational_fields.FieldMany2One.extend({_getSearchBlacklist:function(){return this._super.apply(this,arguments).concat(this.filter_ids||[]);},});var SidebarFilter=Widget.extend(FieldManagerMixin,{template:'CalendarView.sidebar.filter',custom_events:_.extend({},FieldManagerMixin.custom_events,{field_changed:'_onFieldChanged',}),init:function(parent,options){this._super.apply(this,arguments);FieldManagerMixin.init.call(this);this.title=options.title;this.fields=options.fields;this.fieldName=options.fieldName;this.write_model=options.write_model;this.write_field=options.write_field;this.avatar_field=options.avatar_field;this.avatar_model=options.avatar_model;this.filters=options.filters;this.label=options.label;this.getColor=options.getColor;},willStart:function(){var self=this;var defs=[this._super.apply(this,arguments)];if(this.write_model||this.write_field){var def=this.model.makeRecord(this.write_model,[{name:this.write_field,relation:this.fields[this.fieldName].relation,type:'many2one',}]).then(function(recordID){self.many2one=new SidebarFilterM2O(self,self.write_field,self.model.get(recordID),{mode:'edit',attrs:{string:_t(self.fields[self.fieldName].string),placeholder:"+ "+_.str.sprintf(_t("Add %s"),self.title),can_create:false},});});defs.push(def);}
return Promise.all(defs);},start:function(){this._super();if(this.many2one){this.many2one.appendTo(this.$el);this.many2one.filter_ids=_.without(_.pluck(this.filters,'value'),'all');}
this.$el.on('click','.o_remove',this._onFilterRemove.bind(this));this.$el.on('click','.o_calendar_filter_items input',this._onFilterActive.bind(this));},_onFieldChanged:function(event){var self=this;event.stopPropagation();var createValues={'user_id':session.uid};var value=event.data.changes[this.write_field].id;createValues[this.write_field]=value;this._rpc({model:this.write_model,method:'create',args:[createValues],}).then(function(){self.trigger_up('changeFilter',{'fieldName':self.fieldName,'value':value,'active':true,});});},_onFilterActive:function(e){var $input=$(e.currentTarget);this.trigger_up('changeFilter',{'fieldName':this.fieldName,'value':$input.closest('.o_calendar_filter_item').data('value'),'active':$input.prop('checked'),});},_onFilterRemove:function(e){var self=this;var $filter=$(e.currentTarget).closest('.o_calendar_filter_item');Dialog.confirm(this,_t("Do you really want to delete this filter from favorites ?"),{confirm_callback:function(){self._rpc({model:self.write_model,method:'unlink',args:[[$filter.data('id')]],}).then(function(){self.trigger_up('changeFilter',{'fieldName':self.fieldName,'id':$filter.data('id'),'active':false,'value':$filter.data('value'),});});},});},});return AbstractRenderer.extend({template:"CalendarView",config:{CalendarPopover:CalendarPopover,},custom_events:_.extend({},AbstractRenderer.prototype.custom_events||{},{edit_event:'_onEditEvent',delete_event:'_onDeleteEvent',}),init:function(parent,state,params){this._super.apply(this,arguments);this.displayFields=params.displayFields;this.model=params.model;this.filters=[];this.color_map={};this.hideDate=params.hideDate;this.hideTime=params.hideTime;this.canDelete=params.canDelete;this.canCreate=params.canCreate;this.scalesInfo=params.scalesInfo;this._isInDOM=false;},start:function(){this._initSidebar();this._initCalendar();return this._super();},on_attach_callback:function(){this._super(...arguments);this._isInDOM=true;this.calendar.render();this._renderCalendar();window.addEventListener('click',this._onWindowClick.bind(this));},on_detach_callback:function(){this._super(...arguments);this._isInDOM=false;window.removeEventListener('click',this._onWindowClick);},destroy:function(){if(this.calendar){this.calendar.destroy();}
if(this.$small_calendar){this.$small_calendar.datepicker('destroy');$('#ui-datepicker-div:empty').remove();}
this._super.apply(this,arguments);},getAvatars:function(record,fieldName,imageField){var field=this.state.fields[fieldName];if(!record[fieldName]){return[];}
if(field.type==='one2many'||field.type==='many2many'){return _.map(record[fieldName],function(id){return'<img src="/web/image/'+field.relation+'/'+id+'/'+imageField+'" />';});}else if(field.type==='many2one'){return['<img src="/web/image/'+field.relation+'/'+record[fieldName][0]+'/'+imageField+'" />'];}else{var value=this._format(record,fieldName);var color=this.getColor(value);if(isNaN(color)){return['<span class="o_avatar_square" style="background-color:'+color+';"/>'];}
else{return['<span class="o_avatar_square o_calendar_color_'+color+'"/>'];}}},getColor:function(key){if(!key){return;}
if(this.color_map[key]){return this.color_map[key];}
if(typeof key==='string'&&key.match(/^((#[A-F0-9]{3})|(#[A-F0-9]{6})|((hsl|rgb)a?\(\s*(?:(\s*\d{1,3}%?\s*),?){3}(\s*,[0-9.]{1,4})?\))|)$/i)){return this.color_map[key]=key;}
if(typeof key==='number'&&!(key in this.color_map)){return this.color_map[key]=key;}
var index=(((_.keys(this.color_map).length+1)*5)%24)+1;this.color_map[key]=index;return index;},getLocalState:function(){var fcScroller=this.calendarElement.querySelector('.fc-scroller');return{scrollPosition:fcScroller.scrollTop,};},setLocalState:function(localState){if(localState.scrollPosition){var fcScroller=this.calendarElement.querySelector('.fc-scroller');fcScroller.scrollTop=localState.scrollPosition;}},_convertEventToFC3Event:function(fc4Event){var event=fc4Event;if(!moment.isMoment(fc4Event.start)){event={id:fc4Event.id,title:fc4Event.title,start:moment(fc4Event.start).utcOffset(0,true),end:fc4Event.end&&moment(fc4Event.end).utcOffset(0,true),allDay:fc4Event.allDay,color:fc4Event.color,};if(fc4Event.extendedProps){event=Object.assign({},event,{r_start:fc4Event.extendedProps.r_start&&moment(fc4Event.extendedProps.r_start).utcOffset(0,true),r_end:fc4Event.extendedProps.r_end&&moment(fc4Event.extendedProps.r_end).utcOffset(0,true),record:fc4Event.extendedProps.record,attendees:fc4Event.extendedProps.attendees,});}}
return event;},_eventRender:function(event){var qweb_context={event:event,record:event.extendedProps.record,color:this.getColor(event.extendedProps.color_index),showTime:!self.hideTime&&event.extendedProps.showTime,};this.qweb_context=qweb_context;if(_.isEmpty(qweb_context.record)){return'';}else{return qweb.render("calendar-box",qweb_context);}},_format:function(record,fieldName){var field=this.state.fields[fieldName];if(field.type==="one2many"||field.type==="many2many"){return field_utils.format[field.type]({data:record[fieldName]},field);}else{return field_utils.format[field.type](record[fieldName],field,{forceString:true});}},_getFullCalendarOptions:function(fcOptions){var self=this;const options=Object.assign({},this.state.fc_options,{plugins:['moment','interaction','dayGrid','timeGrid'],eventDrop:function(eventDropInfo){var event=self._convertEventToFC3Event(eventDropInfo.event);self.trigger_up('dropRecord',event);},eventResize:function(eventResizeInfo){self._unselectEvent();var event=self._convertEventToFC3Event(eventResizeInfo.event);self.trigger_up('updateRecord',event);},eventClick:function(eventClickInfo){eventClickInfo.jsEvent.preventDefault();eventClickInfo.jsEvent.stopPropagation();var eventData=eventClickInfo.event;self._unselectEvent();$(self.calendarElement).find(_.str.sprintf('[data-event-id=%s]',eventData.id)).addClass('o_cw_custom_highlight');self._renderEventPopover(eventData,$(eventClickInfo.el));},yearDateClick:function(info){self._unselectEvent();info.view.unselect();if(!info.events.length){if(info.selectable){const data={start:info.date,allDay:true,};if(self.state.context.default_name){data.title=self.state.context.default_name;}
self.trigger_up('openCreate',self._convertEventToFC3Event(data));}}else{self._renderYearEventPopover(info.date,info.events,$(info.dayEl));}},select:function(selectionInfo){if(self.$('.o_cw_popover').length){self._unselectEvent();}
var data={start:selectionInfo.start,end:selectionInfo.end,allDay:selectionInfo.allDay};if(self.state.context.default_name){data.title=self.state.context.default_name;}
self.trigger_up('openCreate',self._convertEventToFC3Event(data));if(self.state.scale==='year'){self.calendar.view.unselect();}else{self.calendar.unselect();}},eventRender:function(info){var event=info.event;var element=$(info.el);var view=info.view;element.attr('data-event-id',event.id);if(view.type==='dayGridYear'){const color=this.getColor(event.extendedProps.color_index);if(typeof color==='string'){element.css({backgroundColor:color,});}else if(typeof color==='number'){element.addClass(`o_calendar_color_${color}`);}else{element.addClass('o_calendar_color_1');}}else{var $render=$(self._eventRender(event));element.find('.fc-content').html($render.html());element.addClass($render.attr('class'));if(!element.find('.fc-bg').length){element.find('.fc-content').after($('<div/>',{class:'fc-bg'}));}
if(view.type==='dayGridMonth'&&event.extendedProps.record){var start=event.extendedProps.r_start||event.start;var end=event.extendedProps.r_end||event.end;var isSameDayEvent=moment(start).clone().add(1,'minute').isSame(moment(end).clone().subtract(1,'minute'),'day');if(!event.extendedProps.record.allday&&isSameDayEvent){element.addClass('o_cw_nobg');if(event.extendedProps.showTime&&!self.hideTime){const displayTime=moment(start).clone().format(self._getDbTimeFormat());element.find('.fc-content .fc-time').text(displayTime);}}}
element.on('dblclick',function(){self.trigger_up('edit_event',{id:event.id});});}},datesRender:function(info){const viewToMode=Object.fromEntries(Object.entries(self.scalesInfo).map(([k,v])=>[v,k]));self.trigger_up('viewUpdated',{mode:viewToMode[info.view.type],title:info.view.title,});},eventMouseEnter:function(mouseEnterInfo){$(self.calendarElement).find(_.str.sprintf('[data-event-id=%s]',mouseEnterInfo.event.id)).addClass('o_cw_custom_hover');},eventMouseLeave:function(mouseLeaveInfo){if(!mouseLeaveInfo.event.id){return;}
$(self.calendarElement).find(_.str.sprintf('[data-event-id=%s]',mouseLeaveInfo.event.id)).removeClass('o_cw_custom_hover');},eventDragStart:function(mouseDragInfo){$(self.calendarElement).find(_.str.sprintf('[data-event-id=%s]',mouseDragInfo.event.id)).addClass('o_cw_custom_hover');self._unselectEvent();},eventResizeStart:function(mouseResizeInfo){$(self.calendarElement).find(_.str.sprintf('[data-event-id=%s]',mouseResizeInfo.event.id)).addClass('o_cw_custom_hover');self._unselectEvent();},eventLimitClick:function(){self._unselectEvent();return'popover';},windowResize:function(){self._render();},views:{timeGridDay:{columnHeaderFormat:'LL'},timeGridWeek:{columnHeaderFormat:'ddd D'},dayGridMonth:{columnHeaderFormat:'dddd'}},height:'parent',unselectAuto:false,dir:_t.database.parameters.direction,events:(info,successCB)=>{successCB(self.state.data);},},fcOptions);options.plugins.push(createYearCalendarView(FullCalendar,options));return options;},_initCalendar:function(){this.calendarElement=this.$(".o_calendar_widget")[0];var locale=moment.locale();var fcOptions=this._getFullCalendarOptions({locale:locale,});this.calendar=new FullCalendar.Calendar(this.calendarElement,fcOptions);},_initCalendarMini:function(){var self=this;this.$small_calendar=this.$(".o_calendar_mini");this.$small_calendar.datepicker({'onSelect':function(datum,obj){self.trigger_up('changeDate',{date:moment(new Date(+obj.currentYear,+obj.currentMonth,+obj.currentDay))});},'showOtherMonths':true,'dayNamesMin':this.state.fc_options.dayNamesShort.map(x=>x[0]),'monthNames':this.state.fc_options.monthNamesShort,'firstDay':this.state.fc_options.firstDay,});},_initSidebar:function(){this.$sidebar=this.$('.o_calendar_sidebar');this.$sidebar_container=this.$(".o_calendar_sidebar_container");this._initCalendarMini();},_onPopoverShown:function($popoverElement,calendarPopover){var $popover=$($popoverElement.data('bs.popover').tip);$popover.find('.o_cw_popover_close').on('click',this._unselectEvent.bind(this));$popover.find('.o_cw_body').replaceWith(calendarPopover.$el);},async _renderView(){this.$('.o_calendar_view')[0].prepend(this.calendarElement);if(this._isInDOM){this._renderCalendar();}
this.$small_calendar.datepicker("setDate",this.state.highlight_date.toDate()).find('.o_selected_range').removeClass('o_color o_selected_range');var $a;switch(this.state.scale){case'year':$a=this.$small_calendar.find('td');break;case'month':$a=this.$small_calendar.find('td');break;case'week':$a=this.$small_calendar.find('tr:has(.ui-state-active)');break;case'day':$a=this.$small_calendar.find('a.ui-state-active');break;}
$a.addClass('o_selected_range');setTimeout(function(){$a.not('.ui-state-active').addClass('o_color');});await this._renderFilters();},_renderCalendar(){this.calendar.unselect();if(this.scalesInfo[this.state.scale]!==this.calendar.view.type){this.calendar.changeView(this.scalesInfo[this.state.scale]);}
if(this.target_date!==this.state.target_date.toString()){this.calendar.gotoDate(moment(this.state.target_date).toDate());this.target_date=this.state.target_date.toString();}else{this._renderEvents();}
this._unselectEvent();},_renderEvents:function(){this.calendar.refetchEvents();},_renderFilters:function(){this.$('.o_calendar_filter_item').popover('dispose');_.each(this.filters||(this.filters=[]),function(filter){filter.destroy();});if(this.state.fullWidth){return Promise.resolve();}
return this._renderFiltersOneByOne();},_renderFiltersOneByOne:function(filterIndex){filterIndex=filterIndex||0;var arrFilters=_.toArray(this.state.filters);var prom;if(filterIndex<arrFilters.length){var options=arrFilters[filterIndex];if(!_.find(options.filters,function(f){return f.display==null||f.display;})){return this._renderFiltersOneByOne(filterIndex+1);}
var self=this;options.getColor=this.getColor.bind(this);options.fields=this.state.fields;var sidebarFilter=new SidebarFilter(self,options);prom=sidebarFilter.appendTo(this.$sidebar).then(function(){if(options.avatar_field){_.each(options.filters,function(filter){if(!['all',false].includes(filter.value)){var selector=_.str.sprintf('.o_calendar_filter_item[data-value=%s]',filter.value);sidebarFilter.$el.find(selector).popover({animation:false,trigger:'hover',html:true,placement:'top',title:filter.label,delay:{show:300,hide:0},content:function(){return $('<img>',{src:_.str.sprintf('/web/image/%s/%s/%s',options.avatar_model,filter.value,options.avatar_field),class:'mx-auto',});},});}});}
return self._renderFiltersOneByOne(filterIndex+1);});this.filters.push(sidebarFilter);}
return Promise.resolve(prom);},_getDbTimeFormat:function(){return _t.database.parameters.time_format.search('%H')!==-1?'HH:mm':'hh:mm a';},_getFormattedDate:function(start,end,showDayName,allDay){const isSameDayEvent=start.clone().add(1,'minute').isSame(end.clone().subtract(1,'minute'),'day');if(allDay){end=end.clone().subtract(1,'day');}
if(!isSameDayEvent&&start.isSame(end,'month')){return start.clone().format('MMMM D')+'-'+end.clone().format('D, YYYY');}else{return isSameDayEvent?start.clone().format(showDayName?'dddd, LL':'LL'):start.clone().format('LL')+' - '+end.clone().format('LL');}},_getPopoverContext:function(eventData){var context={hideDate:this.hideDate,hideTime:this.hideTime,eventTime:{},eventDate:{},fields:this.state.fields,displayFields:this.displayFields,event:eventData,modelName:this.model,canDelete:this.canDelete,};var start=moment((eventData.extendedProps&&eventData.extendedProps.r_start)||eventData.start);var end=moment((eventData.extendedProps&&eventData.extendedProps.r_end)||eventData.end);var isSameDayEvent=start.clone().add(1,'minute').isSame(end.clone().subtract(1,'minute'),'day');if(!this.hideTime&&!eventData.extendedProps.record.allday&&isSameDayEvent){var dbTimeFormat=this._getDbTimeFormat();context.eventTime.time=start.clone().format(dbTimeFormat)+' - '+end.clone().format(dbTimeFormat);var durationHours=moment.duration(end.diff(start)).hours();var durationHoursKey=(durationHours===1)?'h':'hh';var durationMinutes=moment.duration(end.diff(start)).minutes();var durationMinutesKey=(durationMinutes===1)?'m':'mm';var localeData=moment.localeData();context.eventTime.duration=(durationHours>0?localeData.relativeTime(durationHours,true,durationHoursKey):'')
+(durationHours>0&&durationMinutes>0?', ':'')
+(durationMinutes>0?localeData.relativeTime(durationMinutes,true,durationMinutesKey):'');}
if(!this.hideDate){if(eventData.extendedProps.record.allday&&isSameDayEvent){context.eventDate.duration=_t("All day");}else if(eventData.extendedProps.record.allday&&!isSameDayEvent){var daysLocaleData=moment.localeData();var days=moment.duration(end.diff(start)).days();context.eventDate.duration=daysLocaleData.relativeTime(days,true,'dd');}
context.eventDate.date=this._getFormattedDate(start,end,true,eventData.extendedProps.record.allday);}
return context;},_getPopoverParams:function(eventData){return{animation:false,delay:{show:50,hide:100},trigger:'manual',html:true,title:eventData.extendedProps.record.display_name,template:qweb.render('CalendarView.event.popover.placeholder',{color:this.getColor(eventData.extendedProps.color_index)}),container:eventData.allDay?'.fc-view':'.fc-scroller',}},_renderEventPopover:function(eventData,$eventElement){var self=this;var calendarPopover=new self.config.CalendarPopover(self,self._getPopoverContext(eventData));calendarPopover.appendTo($('<div>')).then(()=>{$eventElement.popover(self._getPopoverParams(eventData)).on('shown.bs.popover',function(){self._onPopoverShown($(this),calendarPopover);}).popover('show');});},_renderYearEventPopover:function(date,events,$el){const groupKeys=[];const groupedEvents={};for(const event of events){const start=moment(event.extendedProps.r_start);const end=moment(event.extendedProps.r_end);const key=this._getFormattedDate(start,end,false,event.extendedProps.record.allday);if(!(key in groupedEvents)){groupedEvents[key]=[];groupKeys.push({key:key,start:event.extendedProps.r_start,end:event.extendedProps.r_end,isSameDayEvent:start.clone().add(1,'minute').isSame(end.clone().subtract(1,'minute'),'day'),});}
groupedEvents[key].push(event);}
const popoverContent=qweb.render('CalendarView.yearEvent.popover',{groupedEvents,groupKeys:groupKeys.sort((a,b)=>{if(a.isSameDayEvent){return Number.MIN_SAFE_INTEGER;}else if(b.isSameDayEvent){return Number.MAX_SAFE_INTEGER;}else if(a.start.getTime()-b.start.getTime()===0){return a.end.getTime()-b.end.getTime();}
return a.start.getTime()-b.start.getTime();}).map(x=>x.key),canCreate:this.canCreate,});$el.popover({animation:false,delay:{show:50,hide:100},trigger:'manual',html:true,content:popoverContent,template:qweb.render('CalendarView.yearEvent.popover.placeholder'),container:'.fc-dayGridYear-view',}).on('shown.bs.popover',()=>{$('.o_cw_popover .o_cw_popover_close').on('click',()=>this._unselectEvent());$('.o_cw_popover .o_cw_popover_create').on('click',(e)=>{e.preventDefault();e.stopPropagation();this._unselectEvent();const data={start:date,allDay:true,};if(this.state.context.default_name){data.title=this.state.context.default_name;}
this.trigger_up('openCreate',this._convertEventToFC3Event(data));});$('.o_cw_popover .o_cw_popover_link').on('click',(e)=>{e.preventDefault();e.stopPropagation();this._unselectEvent();this.trigger_up('openEvent',{_id:parseInt(e.target.dataset.id,10),title:e.target.dataset.title,});});}).popover('show');},_scrollToScrollTime:function(){var scrollTime=this.calendar.getOption('scrollTime');this.calendar.scrollToTime(scrollTime);},_unselectEvent:function(){this.$('.fc-event').removeClass('o_cw_custom_highlight');this.$('.o_cw_popover').popover('dispose');},_onWindowClick:function(e){const popover=this.el.querySelector('.o_cw_popover');if(popover&&!popover.contains(e.target)){this._unselectEvent();}},_onEditEvent:function(event){this._unselectEvent();this.trigger_up('openEvent',{_id:event.data.id,title:event.data.title,});},_onDeleteEvent:function(event){this._unselectEvent();this.trigger_up('deleteRecord',{id:parseInt(event.data.id,10)});},});});;

/* /web/static/src/js/views/calendar/calendar_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.CalendarView',function(require){"use strict";var AbstractView=require('web.AbstractView');var CalendarModel=require('web.CalendarModel');var CalendarController=require('web.CalendarController');var CalendarRenderer=require('web.CalendarRenderer');var core=require('web.core');var pyUtils=require('web.py_utils');var utils=require('web.utils');var _lt=core._lt;var fieldsToGather=["date_start","date_delay","date_stop","all_day","recurrence_update"];const scalesInfo={day:'timeGridDay',week:'timeGridWeek',month:'dayGridMonth',year:'dayGridYear',};var CalendarView=AbstractView.extend({display_name:_lt('Calendar'),icon:'fa-calendar',jsLibs:['/web/static/lib/fullcalendar/core/main.js','/web/static/lib/fullcalendar/interaction/main.js','/web/static/lib/fullcalendar/moment/main.js','/web/static/lib/fullcalendar/daygrid/main.js','/web/static/lib/fullcalendar/timegrid/main.js','/web/static/lib/fullcalendar/list/main.js'],cssLibs:['/web/static/lib/fullcalendar/core/main.css','/web/static/lib/fullcalendar/daygrid/main.css','/web/static/lib/fullcalendar/timegrid/main.css','/web/static/lib/fullcalendar/list/main.css'],config:_.extend({},AbstractView.prototype.config,{Model:CalendarModel,Controller:CalendarController,Renderer:CalendarRenderer,}),viewType:'calendar',searchMenuTypes:['filter','favorite'],init:function(viewInfo,params){this._super.apply(this,arguments);var arch=this.arch;var fields=this.fields;var attrs=arch.attrs;if(!attrs.date_start){throw new Error(_lt("Calendar view has not defined 'date_start' attribute."));}
var mapping={};var fieldNames=fields.display_name?['display_name']:[];var displayFields={};_.each(fieldsToGather,function(field){if(arch.attrs[field]){var fieldName=attrs[field];mapping[field]=fieldName;fieldNames.push(fieldName);}});var filters={};var eventLimit=attrs.event_limit!==null&&(isNaN(+attrs.event_limit)?_.str.toBool(attrs.event_limit):+attrs.event_limit);var modelFilters=[];_.each(arch.children,function(child){if(child.tag!=='field')return;var fieldName=child.attrs.name;fieldNames.push(fieldName);if(!child.attrs.invisible||child.attrs.filters){child.attrs.options=child.attrs.options?pyUtils.py_eval(child.attrs.options):{};if(!child.attrs.invisible){displayFields[fieldName]={attrs:child.attrs};}
if(params.sidebar===false)return;if(child.attrs.avatar_field){filters[fieldName]=filters[fieldName]||{'title':fields[fieldName].string,'fieldName':fieldName,'filters':[],};filters[fieldName].avatar_field=child.attrs.avatar_field;filters[fieldName].avatar_model=fields[fieldName].relation;}
if(child.attrs.write_model){filters[fieldName]=filters[fieldName]||{'title':fields[fieldName].string,'fieldName':fieldName,'filters':[],};filters[fieldName].write_model=child.attrs.write_model;filters[fieldName].write_field=child.attrs.write_field;modelFilters.push(fields[fieldName].relation);}
if(child.attrs.filters){filters[fieldName]=filters[fieldName]||{'title':fields[fieldName].string,'fieldName':fieldName,'filters':[],};if(child.attrs.color){filters[fieldName].field_color=child.attrs.color;filters[fieldName].color_model=fields[fieldName].relation;}
if(!child.attrs.avatar_field&&fields[fieldName].relation){if(fields[fieldName].relation.includes(['res.users','res.partner','hr.employee'])){filters[fieldName].avatar_field='image_128';}
filters[fieldName].avatar_model=fields[fieldName].relation;}}}});if(attrs.color){var fieldName=attrs.color;fieldNames.push(fieldName);}
this.controllerParams.quickAddPop=(!('quick_add'in attrs)||utils.toBoolElse(attrs.quick_add+'',true));this.controllerParams.disableQuickCreate=params.disable_quick_create||!this.controllerParams.quickAddPop;this.controllerParams.formViewId=attrs.form_view_id?parseInt(attrs.form_view_id,10):false;if(!this.controllerParams.formViewId&&params.action){var formViewDescr=_.find(params.action.views,function(v){return v.type==='form';});if(formViewDescr){this.controllerParams.formViewId=formViewDescr.viewID;}}
let scales;const allowedScales=Object.keys(scalesInfo);if(arch.attrs.scales){scales=arch.attrs.scales.split(',').filter(x=>allowedScales.includes(x));}else{scales=allowedScales;}
this.controllerParams.eventOpenPopup=utils.toBoolElse(attrs.event_open_popup||'',false);this.controllerParams.showUnusualDays=utils.toBoolElse(attrs.show_unusual_days||'',false);this.controllerParams.mapping=mapping;this.controllerParams.context=params.context||{};this.controllerParams.displayName=params.action&&params.action.name;this.controllerParams.scales=scales;this.rendererParams.displayFields=displayFields;this.rendererParams.model=viewInfo.model;this.rendererParams.hideDate=utils.toBoolElse(attrs.hide_date||'',false);this.rendererParams.hideTime=utils.toBoolElse(attrs.hide_time||'',false);this.rendererParams.canDelete=this.controllerParams.activeActions.delete;this.rendererParams.canCreate=this.controllerParams.activeActions.create;this.rendererParams.scalesInfo=scalesInfo;this.loadParams.fieldNames=_.uniq(fieldNames);this.loadParams.mapping=mapping;this.loadParams.fields=fields;this.loadParams.fieldsInfo=viewInfo.fieldsInfo;this.loadParams.editable=!fields[mapping.date_start].readonly;this.loadParams.creatable=this.controllerParams.activeActions.create;this.loadParams.eventLimit=eventLimit;this.loadParams.fieldColor=attrs.color;this.loadParams.filters=filters;this.loadParams.mode=(params.context&&params.context.default_mode)||attrs.mode;this.loadParams.scales=scales;this.loadParams.initialDate=moment(params.initialDate||new Date());this.loadParams.scalesInfo=scalesInfo;},});return CalendarView;});;

/* /web/static/src/js/views/qweb/qweb_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.qweb',function(require){"use strict";var core=require('web.core');var AbstractView=require('web.AbstractView');var AbstractModel=require('web.AbstractModel');var AbstractRenderer=require('web.AbstractRenderer');var AbstractController=require('web.AbstractController');var registry=require('web.view_registry');var _lt=core._lt;var Model=AbstractModel.extend({init:function(){this._super.apply(this,arguments);this._state={viewId:false,modelName:false,body:'',context:{},domain:[],};},_fetch:function(){var state=this._state;return this._rpc({model:state.modelName,method:'qweb_render_view',kwargs:{view_id:state.viewId,domain:state.domain,context:state.context}}).then(function(r){state.body=r;return state.viewId;});},__get:function(){return this._state;},__load:function(params){_.extend(this._state,_.pick(params,['viewId','modelName','domain','context']));return this._fetch();},__reload:function(_id,params){_.extend(this._state,_.pick(params,['domain','context']));return this._fetch();}});var Renderer=AbstractRenderer.extend({_render:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.$el.html(self.state.body);});}});var Controller=AbstractController.extend({events:_.extend({},AbstractController.prototype.events,{'click [type="toggle"]':'_onLazyToggle','click [type="action"]':'_onActionClicked',}),init:function(){this._super.apply(this,arguments);},renderButtons:function($node){this.$buttons=$('<nav/>');if($node){$node.append(this.$buttons);}},_update:function(){var self=this;return this._super.apply(this,arguments).then(function(){var $cp_buttons=self.renderer.$('nav.o_qweb_cp_buttons');$cp_buttons.children().appendTo(self.$buttons.empty());$cp_buttons.remove();});},_onLazyToggle:function(e){var $target=$(e.target);var $t=$target.closest('[data-model]');if(!($target.hasClass('fa-caret-down')||$target.hasClass('fa-caret-right'))){$target=$t.find('.fa-caret-down, .fa-caret-right');}
var data=$t.data();if(this._fold($t)){$target.removeClass('fa-caret-down').addClass('fa-caret-right');return;}
var args=data.args||_.omit(data,'model','method','id');return this._rpc({model:data.model,method:data.method,args:data.id?[data.id]:undefined,kwargs:args}).then(function(s){return $(s);}).then(function($newcontent){$t.data('children',$newcontent).after($newcontent);$target.removeClass('fa-caret-right').addClass('fa-caret-down');});},_fold:function($el){var $children=$el.data('children');if(!$children){return false;}
var self=this;$children.each(function(_i,e){self._fold($(e));}).remove();$el.removeData('children');return true;}});var QWebView=AbstractView.extend({display_name:_lt('Freedom View'),icon:'fa-file-picture-o',viewType:'qweb',enableTimeRangeMenu:true,config:_.extend({},AbstractView.prototype.config,{Model:Model,Renderer:Renderer,Controller:Controller,}),init:function(viewInfo,params){this._super.apply(this,arguments);this.loadParams.viewId=viewInfo.view_id;}});registry.add('qweb',QWebView);return{View:QWebView,Controller:Controller,Renderer:Renderer,Model:Model};});;

/* /web/static/src/js/widgets/attach_document.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.AttachDocument',function(require){"use static";var core=require('web.core');var framework=require('web.framework');var widgetRegistry=require('web.widget_registry');var Widget=require('web.Widget');var _t=core._t;var AttachDocument=Widget.extend({template:'AttachDocument',events:{'click':'_onClickAttachDocument','change input.o_input_file':'_onFileChanged',},init:function(parent,record,nodeInfo){this._super.apply(this,arguments);this.res_id=record.res_id;this.res_model=record.model;this.state=record;this.node=nodeInfo;this.fileuploadID=_.uniqueId('o_fileupload');},start:function(){$(window).on(this.fileuploadID,this._onFileLoaded.bind(this));return this._super.apply(this,arguments);},destroy:function(){$(window).off(this.fileuploadID);this._super.apply(this,arguments);},_notifyInvalidFields:function(invalidFields){var fields=this.state.fields;var warnings=invalidFields.map(function(fieldName){var fieldStr=fields[fieldName].string;return _.str.sprintf('<li>%s</li>',_.escape(fieldStr));});warnings.unshift('<ul>');warnings.push('</ul>');this.do_warn(_t("Invalid fields:"),warnings.join(''));},_onClickAttachDocument:function(ev){if($(ev.target).is('input.o_input_file')){return;}
var fieldNames=this.getParent().canBeSaved(this.state.id);if(fieldNames.length){return this._notifyInvalidFields(fieldNames);}
if(!this.res_id){return this.do_warn(false,_t('Please save before attaching a file'));}
this.$('input.o_input_file').trigger('click');},_onFileChanged:function(ev){ev.stopPropagation();this.$('form.o_form_binary_form').trigger('submit');framework.blockUI();},_onFileLoaded:function(){var self=this;var files=Array.prototype.slice.call(arguments,1);return new Promise(function(resolve){if(self.node.attrs.action){self._rpc({model:self.res_model,method:self.node.attrs.action,args:[self.res_id],kwargs:{attachment_ids:_.map(files,function(file){return file.id;}),}}).then(function(){resolve();});}else{resolve();}}).then(function(){self.trigger_up('reload');framework.unblockUI();});},});widgetRegistry.add('attach_document',AttachDocument);});;

/* /web/static/src/js/fields/signature.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.Signature',function(require){"use strict";var AbstractFieldBinary=require('web.basic_fields').AbstractFieldBinary;var core=require('web.core');var field_utils=require('web.field_utils');var registry=require('web.field_registry');var session=require('web.session');const SignatureDialog=require('web.signature_dialog');var utils=require('web.utils');var qweb=core.qweb;var _t=core._t;var _lt=core._lt;var FieldBinarySignature=AbstractFieldBinary.extend({description:_lt("Signature"),fieldDependencies:_.extend({},AbstractFieldBinary.prototype.fieldDependencies,{__last_update:{type:'datetime'},}),resetOnAnyFieldChange:true,custom_events:_.extend({},AbstractFieldBinary.prototype.custom_events,{upload_signature:'_onUploadSignature',}),events:_.extend({},AbstractFieldBinary.prototype.events,{'click .o_signature':'_onClickSignature',}),template:null,supportedFieldTypes:['binary'],file_type_magic_word:{'/':'jpg','R':'gif','i':'png','P':'svg+xml',},isSet:function(){if(this.mode==='edit'){return this.value;}
return true;},_render:function(){var self=this;var displaySignatureRatio=3;var url;var $img;var width=this.nodeOptions.size?this.nodeOptions.size[0]:this.attrs.width;var height=this.nodeOptions.size?this.nodeOptions.size[1]:this.attrs.height;if(this.value){if(!utils.is_bin_size(this.value)){url='data:image/'+(this.file_type_magic_word[this.value[0]]||'png')+';base64,'+this.value;}else{url=session.url('/web/image',{model:this.model,id:JSON.stringify(this.res_id),field:this.nodeOptions.preview_image||this.name,unique:field_utils.format.datetime(this.recordData.__last_update).replace(/[^0-9]/g,''),});}
$img=$(qweb.render("FieldBinarySignature-img",{widget:this,url:url}));}else{$img=$('<div class="o_signature o_signature_empty"><svg></svg><p>'+_t('SIGNATURE')+'</p></div>');if(width&&height){width=Math.min(width,displaySignatureRatio*height);height=width/displaySignatureRatio;}else if(width){height=width/displaySignatureRatio;}else if(height){width=height*displaySignatureRatio;}}
if(width){$img.attr('width',width);$img.css('max-width',width+'px');}
if(height){$img.attr('height',height);$img.css('max-height',height+'px');}
this.$('> div').remove();this.$('> img').remove();this.$el.prepend($img);$img.on('error',function(){self._clearFile();$img.attr('src',self.placeholder);self.do_warn(false,_t("Could not display the selected image"));});},_onClickSignature:function(){var self=this;if(this.mode==='edit'){var nameAndSignatureOptions={mode:'draw',displaySignatureRatio:3,signatureType:'signature',noInputName:true,};if(this.nodeOptions.full_name){var signName;if(this.fields[this.nodeOptions.full_name].type==='many2one'){signName=this.recordData[this.nodeOptions.full_name]&&this.recordData[this.nodeOptions.full_name].data.display_name;}else{signName=this.recordData[this.nodeOptions.full_name];}
nameAndSignatureOptions.defaultName=(signName==='')?undefined:signName;}
nameAndSignatureOptions.defaultFont=this.nodeOptions.default_font||'';this.signDialog=new SignatureDialog(self,{nameAndSignatureOptions:nameAndSignatureOptions});this.signDialog.open();}},_onUploadSignature:function(ev){var signatureImage=ev.data.signatureImage;if(signatureImage!==this.signDialog.emptySignature){var data=signatureImage[1];var type=signatureImage[0].split('/')[1];this.on_file_uploaded(data.length,ev.data.name,type,data);}
this.signDialog.close();}});registry.add('signature',FieldBinarySignature);});;

/* /web/static/src/js/owl_compatibility.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.OwlCompatibility',function(){"use strict";const{Component,hooks,tags}=owl;const{useRef,useSubEnv}=hooks;const{xml}=tags;const widgetSymbol=odoo.widgetSymbol;const children=new WeakMap();class ComponentAdapter extends Component{constructor(parent,props){if(!props.Component){throw Error(`ComponentAdapter: 'Component' prop is missing.`);}
let template;if(!(props.Component.prototype instanceof Component)){template=tags.xml`<div/>`;}else{let propsStr='';for(let p in props){if(p!=='Component'){propsStr+=` ${p}="props.${p}"`;}}
template=tags.xml`<t t-component="props.Component"${propsStr}/>`;}
ComponentAdapter.template=template;super(...arguments);this.template=template;ComponentAdapter.template=null;this.widget=null;}
willStart(){if(!(this.props.Component.prototype instanceof Component)){this.widget=new this.props.Component(this,...this.widgetArgs);return this.widget._widgetRenderAndInsert(()=>{});}}
willUpdateProps(nextProps){if(this.widget){return this.updateWidget(nextProps);}}
__patch(target,vnode){if(this.widget){if(this.__owl__.vnode){this.renderWidget();}
vnode.elm=this.widget.el;}
const result=super.__patch(...arguments);if(this.widget&&this.el!==this.widget.el){this.__owl__.vnode.elm=this.widget.el;}
return result;}
mounted(){if(this.widget&&this.widget.on_attach_callback){this.widget.on_attach_callback();}}
willUnmount(){if(this.widget&&this.widget.on_detach_callback){this.widget.on_detach_callback();}}
__destroy(){super.__destroy(...arguments);if(this.widget){this.widget.destroy();}}
get widgetArgs(){if(this.props.widgetArgs){return this.props.widgetArgs;}
const args=Object.keys(this.props);args.splice(args.indexOf('Component'),1);if(args.length>1){throw new Error(`ComponentAdapter has more than 1 argument, 'widgetArgs' must be overriden.`);}
return args.map(a=>this.props[a]);}
updateWidget(){if(this.env.isDebug('assets')){console.warn(`ComponentAdapter: Widget could not be updated, maybe override 'updateWidget' function?`);}}
renderWidget(){if(this.env.isDebug('assets')){console.warn(`ComponentAdapter: Widget could not be re-rendered, maybe override 'renderWidget' function?`);}}
_trigger_up(ev){const evType=ev.name;const payload=ev.data;if(evType==='call_service'){let args=payload.args||[];if(payload.service==='ajax'&&payload.method==='rpc'){args=args.concat(ev.target);}
const service=this.env.services[payload.service];const result=service[payload.method].apply(service,args);payload.callback(result);}else if(evType==='get_session'){if(payload.callback){payload.callback(this.env.session);}}else if(evType==='load_views'){const params={model:payload.modelName,context:payload.context,views_descr:payload.views,};this.env.dataManager.load_views(params,payload.options||{}).then(payload.on_success);}else if(evType==='load_filters'){return this.env.dataManager.load_filters(payload).then(payload.on_success);}else{payload.__targetWidget=ev.target;this.trigger(evType.replace(/_/g,'-'),payload);}}}
const WidgetAdapterMixin={on_attach_callback(){for(const component of children.get(this)||[]){component.on_attach_callback();}},on_detach_callback(){for(const component of children.get(this)||[]){component.on_detach_callback();}},destroy(){for(const component of children.get(this)||[]){component.__destroy();}
children.delete(this);},};class ComponentWrapper extends Component{constructor(parent,Component,props){if(parent instanceof Component){throw new Error('ComponentWrapper must be used with a legacy Widget as parent');}
super(null,props);if(parent){this._register(parent);}
useSubEnv({[widgetSymbol]:this._addListener.bind(this)});this.parentWidget=parent;this.Component=Component;this.props=props||{};this._handledEvents=new Set();this.componentRef=useRef("component");}
on_attach_callback(){function recursiveCallMounted(component){for(const key in component.__owl__.children){recursiveCallMounted(component.__owl__.children[key]);}
component.__callMounted();}
recursiveCallMounted(this);}
on_detach_callback(){this.__callWillUnmount();}
destroy(){if(this.parentWidget){const parentChildren=children.get(this.parentWidget);if(parentChildren){const index=parentChildren.indexOf(this);children.get(this.parentWidget).splice(index,1);}}
super.destroy();}
setParent(parent){if(parent instanceof Component){throw new Error('ComponentWrapper must be used with a legacy Widget as parent');}
this._register(parent);if(this.parentWidget){const parentChildren=children.get(this.parentWidget);parentChildren.splice(parentChildren.indexOf(this),1);}
this.parentWidget=parent;}
async update(props={}){if(this.__owl__.isDestroyed){return new Promise(()=>{});}
Object.assign(this.props,props);let prom;if(this.__owl__.isMounted){prom=this.render();}else{prom=this.mount(...this._mountArgs);}
return prom;}
_addListener(evType){if(this.parentWidget&&!this._handledEvents.has(evType)){this._handledEvents.add(evType);this.el.addEventListener(evType,ev=>{if(!ev.cancelBubble){ev.stopPropagation();const detail=Object.assign({},ev.detail,{__originalComponent:ev.originalComponent,});this.parentWidget.trigger_up(ev.type.replace(/-/g,'_'),detail);}});}}
_register(parent){let parentChildren=children.get(parent);if(!parentChildren){parentChildren=[];children.set(parent,parentChildren);}
parentChildren.push(this);}
async mount(target,options){if(options&&options.position==='self'){throw new Error('Unsupported position: "self" is not allowed for wrapper components. '+'Contact the JS Framework team or open an issue if your use case is relevant.');}
this._mountArgs=arguments;return super.mount(...arguments);}}
ComponentWrapper.template=xml`<t t-component="Component" t-props="props" t-ref="component"/>`;return{ComponentAdapter,ComponentWrapper,WidgetAdapterMixin,};});;

/* /web/static/src/js/report/utils.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('report.utils',function(require){'use strict';function get_protocol_from_url(url){var a=document.createElement('a');a.href=url;return a.protocol;}
function get_host_from_url(url){var a=document.createElement('a');a.href=url;return a.host;}
function build_origin(protocol,host){return protocol+'//'+host;}
return{'get_protocol_from_url':get_protocol_from_url,'get_host_from_url':get_host_from_url,'build_origin':build_origin,};});;

/* /web/static/src/js/report/client_action.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('report.client_action',function(require){'use strict';var AbstractAction=require('web.AbstractAction');var core=require('web.core');var session=require('web.session');var utils=require('report.utils');var QWeb=core.qweb;var AUTHORIZED_MESSAGES=['report:do_action',];var ReportAction=AbstractAction.extend({hasControlPanel:true,contentTemplate:'report.client_action',init:function(parent,action,options){this._super.apply(this,arguments);options=options||{};this.action_manager=parent;this._title=options.display_name||options.name;this.report_url=options.report_url;this.report_name=options.report_name;this.report_file=options.report_file;this.data=options.data||{};this.context=options.context||{};},start:function(){var self=this;this.iframe=this.$('iframe')[0];this.$buttons=$(QWeb.render('report.client_action.ControlButtons',{}));this.$buttons.on('click','.o_report_print',this.on_click_print);this.controlPanelProps.cp_content={$buttons:this.$buttons,};return Promise.all([this._super.apply(this,arguments),session.is_bound]).then(async function(){var web_base_url=session['web.base.url'];var trusted_host=utils.get_host_from_url(web_base_url);var trusted_protocol=utils.get_protocol_from_url(web_base_url);self.trusted_origin=utils.build_origin(trusted_protocol,trusted_host);self.iframe.src=self.report_url;});},do_show:function(){this.updateControlPanel({cp_content:{$buttons:this.$buttons,},});return this._super.apply(this,arguments);},on_attach_callback:function(){$(window).on('message',this,this.on_message_received);this._super();},on_detach_callback:function(){$(window).off('message',this.on_message_received);this._super();},on_message_received:function(ev){var message_origin=utils.build_origin(ev.originalEvent.source.location.protocol,ev.originalEvent.source.location.host);if(message_origin===this.trusted_origin){var message=ev.originalEvent.data;if(_.isObject(message)){message=message.message;}
if(!_.isString(message)||(_.isString(message)&&!_.contains(AUTHORIZED_MESSAGES,message))){return;}
switch(message){case'report:do_action':return this.do_action(ev.originalEvent.data.action);default:}}},_post_message:function(message){this.iframe.contentWindow.postMessage(message,this.trusted_origin);},on_click_print:function(){var action={'type':'ir.actions.report','report_type':'qweb-pdf','report_name':this.report_name,'report_file':this.report_file,'data':this.data,'context':this.context,'display_name':this.title,};return this.do_action(action);},});core.action_registry.add('report.client_action',ReportAction);return ReportAction;});;

/* /web_mobile/static/src/js/core/mixins.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_mobile.mixins',function(require){"use strict";const session=require('web.session');const mobile=require('web_mobile.core');var backButtonEventListeners=[];function onGlobalBackButton(){var listener=backButtonEventListeners[backButtonEventListeners.length-1];if(listener){listener._onBackButton.apply(listener,arguments);}}
var BackButtonEventMixin={on_attach_callback:function(){if(mobile.methods.overrideBackButton){backButtonEventListeners.push(this);if(backButtonEventListeners.length===1){document.addEventListener('backbutton',onGlobalBackButton);mobile.methods.overrideBackButton({enabled:true});}}},on_detach_callback:function(){if(mobile.methods.overrideBackButton){backButtonEventListeners=_.without(backButtonEventListeners,this);if(backButtonEventListeners.length===0){document.removeEventListener('backbutton',onGlobalBackButton);mobile.methods.overrideBackButton({enabled:false});}}},_onBackButton:function(){},};const UpdateDeviceAccountControllerMixin={async saveRecord(){const changedFields=await this._super(...arguments);this.savingDef=this.savingDef.then(()=>session.updateAccountOnMobileDevice());return changedFields;},};session.is_bound.then(()=>session.updateAccountOnMobileDevice());return{BackButtonEventMixin:BackButtonEventMixin,UpdateDeviceAccountControllerMixin,};});;

/* /web_mobile/static/src/js/core/dialog.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_mobile.Dialog',function(require){"use strict";var Dialog=require('web.Dialog');var mobileMixins=require('web_mobile.mixins');Dialog.include(_.extend({},mobileMixins.BackButtonEventMixin,{willStart:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.$modal.on('hidden.bs.modal',self.on_detach_callback.bind(self));});},opened:function(){return this._super.apply(this,arguments).then(this.on_attach_callback.bind(this));},_onBackButton:function(){this.close();},}));});;

/* /web_mobile/static/src/js/core/session.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_mobile.Session',function(require){"use strict";const core=require('web.core');const Session=require('web.Session');const utils=require('web.utils');const mobile=require('web_mobile.core');Session.include({get_file:function(options){if(mobile.methods.downloadFile){if(core.csrf_token){options.csrf_token=core.csrf_token;}
mobile.methods.downloadFile(options);if(options.success){options.success();}
if(options.complete){options.complete();}
return true;}else{return this._super.apply(this,arguments);}},async updateAccountOnMobileDevice(){if(!mobile.methods.updateAccount){return;}
const avatar=await this.fetchAvatar();const base64Avatar=await utils.getDataURLFromFile(avatar);return mobile.methods.updateAccount({avatar:base64Avatar.substring(base64Avatar.indexOf(',')+1),name:this.name,username:this.username,});},async fetchAvatar(){const url=this.url('/web/image',{model:'res.users',field:'image_medium',id:this.uid,});const response=await fetch(url);return response.blob();},});});;

/* /web_mobile/static/src/js/services/core.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_mobile.core',function(){"use strict";var available=typeof OdooDeviceUtility!=='undefined';var DeviceUtility;var deferreds={};var methods={};if(available){DeviceUtility=OdooDeviceUtility;delete window.OdooDeviceUtility;}
function native_invoke(name,args){if(_.isUndefined(args)){args={};}
var id=_.uniqueId();args=JSON.stringify(args);DeviceUtility.execute(name,args,id);return new Promise(function(resolve,reject){deferreds[id]={successCallback:resolve,errorCallback:reject};});}
window.odoo.native_notify=function(id,result){if(deferreds.hasOwnProperty(id)){if(result.success){deferreds[id].successCallback(result);}else{deferreds[id].errorCallback(result);}}};var plugins=available?JSON.parse(DeviceUtility.list_plugins()):[];_.each(plugins,function(plugin){methods[plugin.name]=function(args){return native_invoke(plugin.action,args);};});if(methods.hashChange){var currentHash;$(window).bind('hashchange',function(event){var hash=event.getState();if(!_.isEqual(currentHash,hash)){methods.hashChange(hash);}
currentHash=hash;});}
return{'methods':methods};});;

/* /web_mobile/static/src/js/action_manager.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_mobile.ActionManager',function(require){"use strict";var ActionManager=require('web.ActionManager');const mobile=require('web_mobile.core');ActionManager.include({ir_actions_act_url:function(action){var url=action.url;var result=this._super.apply(this,arguments);if(!_.isEmpty(mobile.methods)&&!url.startsWith("/web")){return Promise.resolve();}
return result;},});});;

/* /web_mobile/static/src/js/barcode_fields.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_mobile.barcode_fields',function(require){"use strict";var field_registry=require('web.field_registry');require('web._field_registry');var relational_fields=require('web.relational_fields');const mobile=require('web_mobile.core');var FieldMany2OneBarcode=relational_fields.FieldMany2One.extend({template:"FieldMany2OneBarcode",events:_.extend({},relational_fields.FieldMany2One.prototype.events,{'click .o_barcode_mobile':'_onBarcodeButtonClick',}),start:function(){var result=this._super.apply(this,arguments);this._startBarcode();return result;},_isExternalButtonVisible:function(){return this.$external_button.is(':visible');},_renderEdit:function(){this._super.apply(this,arguments);if(this.$barcode_button){this.$barcode_button.toggle(!this._isExternalButtonVisible());}},_startBarcode:function(){this.$barcode_button=this.$('.o_barcode_mobile');this.$barcode_button.toggle(!this.isSet());},_onBarcodeButtonClick:function(){var self=this;mobile.methods.scanBarcode().then(function(response){var barcode=response.data;if(barcode){self._onBarcodeScanned(barcode);mobile.methods.vibrate({duration:100,});}else{mobile.methods.showToast({message:'Please, scan again !!',});}});},_onBarcodeScanned:function(barcode){this._search(barcode);},});if(mobile.methods.scanBarcode){field_registry.add('many2one_barcode',FieldMany2OneBarcode);}
return FieldMany2OneBarcode;});;

/* /web_mobile/static/src/js/contact_sync.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_mobile.ContactSync',function(require){"use strict";var Widget=require('web.Widget');const mobile=require('web_mobile.core');var ContactSync=Widget.extend({template:'ContactSync',events:{'click':'_onClick',},init:function(parent,params){this.res_id=params.res_id;this.res_model=params.res_model;this.is_mobile=mobile.methods.addContact;return this._super.apply(this,arguments);},_onClick:function(){var fieldNames=['name','image_1920','parent_id','phone','mobile','email','street','street2','city','state_id','zip','country_id','website','function',];this._rpc({model:this.res_model,method:'read',args:[this.res_id,fieldNames],}).then(function(r){const contact=Object.assign({},r[0],{image:r[0].image_1920,});delete contact.image_1920;mobile.methods.addContact(contact);});},});return ContactSync;});;

/* /web_mobile/static/src/js/crash_manager.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_mobile.CrashManager',function(require){"use strict";var CrashManager=require('web.CrashManager').CrashManager;const mobile=require('web_mobile.core');CrashManager.include({rpc_error:function(error){if(mobile.methods.crashManager){mobile.methods.crashManager(error);}
return this._super.apply(this,arguments);},});});;

/* /web_mobile/static/src/js/datepicker.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("web_mobile.datepicker",function(require){"use strict";const mobile=require("web_mobile.core");if(!mobile.methods.requestDateTimePicker){return;}
const web_datepicker=require("web.datepicker");const Widget=require("web.Widget");web_datepicker.DateWidget.include({start(){this.$input=this.$("input.o_datepicker_input");this._setupMobilePicker();},destroy:Widget.prototype.destroy,maxDate(){console.warn("Unsupported in the mobile applications");},minDate(){console.warn("Unsupported in the mobile applications");},_setLibInputValue(){},_setupMobilePicker(){this.$el.on("click",async()=>{const{data}=await mobile.methods.requestDateTimePicker({value:this.getValue()?this.getValue().format("YYYY-MM-DD HH:mm:ss"):false,type:this.type_of_date,ignore_timezone:true,});this.$input.val(data);this.changeDatetime();});},});});;

/* /web_mobile/static/src/js/form_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_mobile.FormRenderer',function(require){"use strict";var FormRenderer=require('web.FormRenderer');var ContactSync=require('web_mobile.ContactSync');FormRenderer.include({_renderTagContactsync:function(){var $el=$('<div>');var widget=new ContactSync(this,{res_id:this.state.res_id,res_model:this.state.model,});var prom=widget._widgetRenderAndInsert(function(){});prom.then(function(){$el.replaceWith(widget.$el);});this.widgets.push(widget);this.defs.push(prom);return $el;},});});;

/* /web_mobile/static/src/js/form_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_mobile.FormView',function(require){"use strict";var config=require('web.config');var FormView=require('web.FormView');var QuickCreateFormView=require('web.QuickCreateFormView');FormView.include({init:function(){this._super.apply(this,arguments);if(config.device.isMobile){this.controllerParams.disableAutofocus=true;}},});QuickCreateFormView.include({init:function(){this._super.apply(this,arguments);this.controllerParams.disableAutofocus=false;},});});;

/* /web_mobile/static/src/js/pivot_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_mobile.PivotRenderer',async function(require){'use strict';const config=require('web.config');if(!config.device.isMobile){return;}
const PivotRenderer=require('web.PivotRenderer');PivotRenderer.patch("pivot_mobile",T=>class extends T{_updateTooltip(){}
_getPadding(cell){return 5+cell.indent*5;}
_onClickMenuGroupBy(field,interval,ev){if(!ev.currentTarget.classList.contains('o_pivot_field_selection')){super._onClickMenuGroupBy(...arguments);}else{ev.stopPropagation();}}});});;

/* /web_mobile/static/src/js/user_menu.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_mobile.user_menu',function(require){"use strict";var core=require('web.core');var UserMenu=require('web.UserMenu');var web_client=require('web.web_client');const mobile=require('web_mobile.core');var _t=core._t;UserMenu.include({start:function(){var self=this;return this._super.apply(this,arguments).then(function(){if(mobile.methods.switchAccount){self.$('a[data-menu="logout"]').addClass('d-none');self.$('a[data-menu="account"]').addClass('d-none');self.$('a[data-menu="switch"]').removeClass('d-none');}
if(mobile.methods.addHomeShortcut){self.$('a[data-menu="shortcut"]').removeClass('d-none');}});},_onMenuSwitch:function(){mobile.methods.switchAccount();},_onMenuShortcut:function(){var urlData=$.bbq.getState();if(urlData.menu_id){var menus=web_client.menu_data;var menu=_.filter(menus.children,function(child){return child.id===parseInt(urlData.menu_id);});mobile.methods.addHomeShortcut({'title':document.title,'shortcut_url':document.URL,'web_icon':menu&&menu[0].web_icon_data});}else{mobile.methods.showToast({"message":_t("No shortcut for Home Menu")});}},});});;

/* /web_mobile/static/src/js/user_preferences_form_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_mobile.UserPreferencesFormView',function(require){'use strict';const FormView=require('web.FormView');const viewRegistry=require('web.view_registry');const{UpdateDeviceAccountControllerMixin}=require('web_mobile.mixins');const UserPreferencesFormView=FormView.extend({config:Object.assign({},FormView.prototype.config,{Controller:FormView.prototype.config.Controller.extend(UpdateDeviceAccountControllerMixin),}),});viewRegistry.add('res_users_preferences_form',UserPreferencesFormView);return UserPreferencesFormView;});;

/* /base_import/static/lib/javascript-state-machine/state-machine.js defined in bundle 'point_of_sale.pos_assets_backend' */
(function(window){StateMachine={VERSION:"2.1.0",Result:{SUCCEEDED:1,NOTRANSITION:2,CANCELLED:3,ASYNC:4,},Error:{INVALID_TRANSITION:100,PENDING_TRANSITION:200,INVALID_CALLBACK:300,},WILDCARD:'*',ASYNC:'async',create:function(cfg,target){var initial=(typeof cfg.initial=='string')?{state:cfg.initial}:cfg.initial;var fsm=target||cfg.target||{};var events=cfg.events||[];var callbacks=cfg.callbacks||{};var map={};var add=function(e){var from=(e.from instanceof Array)?e.from:(e.from?[e.from]:[StateMachine.WILDCARD]);map[e.name]=map[e.name]||{};for(var n=0;n<from.length;n++)
map[e.name][from[n]]=e.to||from[n];};if(initial){initial.event=initial.event||'startup';add({name:initial.event,from:'none',to:initial.state});}
for(var n=0;n<events.length;n++)
add(events[n]);for(var name in map){if(map.hasOwnProperty(name))
fsm[name]=StateMachine.buildEvent(name,map[name]);}
for(var name in callbacks){if(callbacks.hasOwnProperty(name))
fsm[name]=callbacks[name]}
fsm.current='none';fsm.is=function(state){return this.current==state;};fsm.can=function(event){return!this.transition&&(map[event].hasOwnProperty(this.current)||map[event].hasOwnProperty(StateMachine.WILDCARD));}
fsm.cannot=function(event){return!this.can(event);};fsm.error=cfg.error||function(name,from,to,args,error,msg){throw msg;};if(initial&&!initial.defer)
fsm[initial.event]();return fsm;},doCallback:function(fsm,func,name,from,to,args){if(func){try{return func.apply(fsm,[name,from,to].concat(args));}
catch(e){return fsm.error(name,from,to,args,StateMachine.Error.INVALID_CALLBACK,"an exception occurred in a caller-provided callback function");}}},beforeEvent:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onbefore'+name],name,from,to,args);},afterEvent:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onafter'+name]||fsm['on'+name],name,from,to,args);},leaveState:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onleave'+from],name,from,to,args);},enterState:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onenter'+to]||fsm['on'+to],name,from,to,args);},changeState:function(fsm,name,from,to,args){return StateMachine.doCallback(fsm,fsm['onchangestate'],name,from,to,args);},buildEvent:function(name,map){return function(){var from=this.current;var to=map[from]||map[StateMachine.WILDCARD]||from;var args=Array.prototype.slice.call(arguments);if(this.transition)
return this.error(name,from,to,args,StateMachine.Error.PENDING_TRANSITION,"event "+name+" inappropriate because previous transition did not complete");if(this.cannot(name))
return this.error(name,from,to,args,StateMachine.Error.INVALID_TRANSITION,"event "+name+" inappropriate in current state "+this.current);if(false===StateMachine.beforeEvent(this,name,from,to,args))
return StateMachine.CANCELLED;if(from===to){StateMachine.afterEvent(this,name,from,to,args);return StateMachine.NOTRANSITION;}
var fsm=this;this.transition=function(){fsm.transition=null;fsm.current=to;StateMachine.enterState(fsm,name,from,to,args);StateMachine.changeState(fsm,name,from,to,args);StateMachine.afterEvent(fsm,name,from,to,args);};var leave=StateMachine.leaveState(this,name,from,to,args);if(false===leave){this.transition=null;return StateMachine.CANCELLED;}
else if("async"===leave){return StateMachine.ASYNC;}
else{if(this.transition)
this.transition();return StateMachine.SUCCEEDED;}};}};if("function"===typeof define){define("statemachine",[],function(){return StateMachine;});}
else{window.StateMachine=StateMachine;}}(this));;

/* /base_import/static/src/js/import_action.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('base_import.import',function(require){"use strict";var AbstractAction=require('web.AbstractAction');var config=require('web.config');var core=require('web.core');var session=require('web.session');var time=require('web.time');var AbstractWebClient=require('web.AbstractWebClient');var Loading=require('web.Loading');var QWeb=core.qweb;var _t=core._t;var _lt=core._lt;var StateMachine=window.StateMachine;function jsonp(form,attributes,callback){attributes=attributes||{};var options={jsonp:_.uniqueId('import_callback_')};window[options.jsonp]=function(){delete window[options.jsonp];callback.apply(null,arguments);};if('data'in attributes){_.extend(attributes.data,options);}else{_.extend(attributes,{data:options});}
_.extend(attributes,{dataType:'script',});$(form).ajaxSubmit(attributes);}
function _make_option(term){return{id:term,text:term};}
function _from_data(data,term){return _.findWhere(data,{id:term})||_make_option(term);}
function dataFilteredQuery(q){var suggestions=_.clone(this.data);if(q.term){var exact=_.filter(suggestions,function(s){return s.id===q.term||s.text===q.term;});if(exact.length){suggestions=exact;}else{suggestions=[_make_option(q.term)].concat(_.filter(suggestions,function(s){return s.id.indexOf(q.term)!==-1||s.text.indexOf(q.term)!==-1}));}}
q.callback({results:suggestions});}
var DataImport=AbstractAction.extend({hasControlPanel:true,contentTemplate:'ImportView',opts:[{name:'encoding',label:_lt("Encoding:"),value:''},{name:'separator',label:_lt("Separator:"),value:''},{name:'quoting',label:_lt("Text Delimiter:"),value:'"'}],spreadsheet_opts:[{name:'sheet',label:_lt("Selected Sheet:"),value:''},],parse_opts_formats:[{name:'date_format',label:_lt("Date Format:"),value:''},{name:'datetime_format',label:_lt("Datetime Format:"),value:''},],parse_opts_separators:[{name:'float_thousand_separator',label:_lt("Thousands Separator:"),value:','},{name:'float_decimal_separator',label:_lt("Decimal Separator:"),value:'.'}],events:{'change .oe_import_file':'loaded_file','change input.oe_import_has_header, .js_import_options input':'settings_changed','change input.oe_import_advanced_mode':function(e){this.do_not_change_match=true;this['settings_changed']();},'click a.oe_import_toggle':function(e){e.preventDefault();this.$('.oe_import_options').toggle();},'click .oe_import_report a.oe_import_report_count':function(e){e.preventDefault();$(e.target).parent().parent().toggleClass('oe_import_report_showmore');},'click .oe_import_report_see_possible_value':function(e){e.preventDefault();$(e.target).parent().toggleClass('oe_import_report_showmore');},'click .oe_import_moreinfo_action a':function(e){e.preventDefault();var action=JSON.parse($(e.target).attr('data-action'));action.views=_(action.views).map(function(view){var id=view[0],type=view[1];return[id,type!=='tree'?type:action.view_type==='form'?'list':'tree'];});this.do_action(_.extend(action,{target:'new',flags:{search_view:true,display_title:true,pager:true,list:{selectable:false}}}));},},init:function(parent,action){this._super.apply(this,arguments);this.action_manager=parent;this.res_model=action.params.model;this.parent_context=action.params.context||{};this.id=null;this.session=session;this._title=_t('Import a File');this.do_not_change_match=false;this.sheets=[];},willStart:function(){var self=this;var def=this._rpc({model:this.res_model,method:'get_import_templates',context:this.parent_context,}).then(function(result){self.importTemplates=result;});return Promise.all([this._super.apply(this,arguments),def]);},start:function(){var self=this;this.$form=this.$('form');this.setup_encoding_picker();this.setup_separator_picker();this.setup_float_format_picker();this.setup_date_format_picker();this.setup_sheets_picker();return Promise.all([this._super(),self.create_model().then(function(id){self.id=id;self.$('input[name=import_id]').val(id);self.renderButtons();var status={cp_content:{$buttons:self.$buttons},};self.updateControlPanel(status);}),]);},create_model:function(){return this._rpc({model:'base_import.import',method:'create',args:[{res_model:this.res_model}],kwargs:{context:session.user_context},});},renderButtons:function(){var self=this;this.$buttons=$(QWeb.render("ImportView.buttons",this));this.$buttons.filter('.o_import_validate').on('click',this.validate.bind(this));this.$buttons.filter('.o_import_import').on('click',this.import.bind(this));this.$buttons.filter('.oe_import_file').on('click',function(){self.$('.o_content .oe_import_file').click();});this.$buttons.filter('.o_import_cancel').on('click',function(e){e.preventDefault();self.exit();});},setup_encoding_picker:function(){this.$('input.oe_import_encoding').select2({width:'50%',data:_.map(('utf-8 utf-16 windows-1252 latin1 latin2 big5 gb18030 shift_jis windows-1251 koir8_r').split(/\s+/),_make_option),query:dataFilteredQuery,initSelection:function($e,c){return c(_make_option($e.val()));}});},setup_separator_picker:function(){var data=[{id:',',text:_t("Comma")},{id:';',text:_t("Semicolon")},{id:'\t',text:_t("Tab")},{id:' ',text:_t("Space")}];this.$('input.oe_import_separator').select2({width:'50%',data:data,query:dataFilteredQuery,initSelection:function($e,c){c(_from_data(data,$e.val())||_make_option($e.val()))}});},setup_float_format_picker:function(){var data_decimal=[{id:',',text:_t("Comma")},{id:'.',text:_t("Dot")},];var data_digits=data_decimal.concat([{id:'',text:_t("No Separator")}]);this.$('input.oe_import_float_thousand_separator').select2({width:'50%',data:data_digits,query:dataFilteredQuery,initSelection:function($e,c){c(_from_data(data_digits,$e.val())||_make_option($e.val()))}});this.$('input.oe_import_float_decimal_separator').select2({width:'50%',data:data_decimal,query:dataFilteredQuery,initSelection:function($e,c){c(_from_data(data_decimal,$e.val())||_make_option($e.val()))}});},setup_date_format_picker:function(){var data=_(['YYYY-MM-DD','DD/MM/YY','DD/MM/YYYY','DD-MM-YYYY','DD-MMM-YY','DD-MMM-YYYY','MM/DD/YY','MM/DD/YYYY','MM-DD-YY','MM-DD-YYYY','DDMMYY','DDMMYYYY','YYMMDD','YYYYMMDD','YY/MM/DD','YYYY/MM/DD','MMDDYY','MMDDYYYY',]).map(_make_option);this.$('input.oe_import_date_format').select2({width:'50%',data:data,query:dataFilteredQuery,initSelection:function($e,c){c(_from_data(data,$e.val())||_make_option($e.val()));}})},setup_sheets_picker:function(){var data=this.sheets.map(_make_option);this.$('input.oe_import_sheet').select2({width:'50%',data:data,query:dataFilteredQuery,initSelection:function($e,c){c(_from_data(data,$e.val())||_make_option($e.val()))},minimumResultsForSearch:10,});},import_options:function(){var self=this;var options={headers:this.$('input.oe_import_has_header').prop('checked'),advanced:this.$('input.oe_import_advanced_mode').prop('checked'),keep_matches:this.do_not_change_match,name_create_enabled_fields:{},skip:Number(this.$('#oe_import_row_start').val())-1||0,limit:Number(this.$('#oe_import_batch_limit').val())||null,};_.each(_.union(this.opts,this.spreadsheet_opts),function(opt){options[opt.name]=self.$('input.oe_import_'+opt.name).val();});_(this.parse_opts_formats).each(function(opt){options[opt.name]=time.moment_to_strftime_format(self.$('input.oe_import_'+opt.name).val());});_(this.parse_opts_separators).each(function(opt){options[opt.name]=self.$('input.oe_import_'+opt.name).val();});options['fields']=[];if(this.do_not_change_match){options['fields']=this.$('.oe_import_fields input.oe_import_match_field').map(function(index,el){return $(el).select2('val')||false;}).get();}
this.do_not_change_match=false;this.$('input.o_import_create_option').each(function(){var field=this.getAttribute('field');if(field){options.name_create_enabled_fields[field]=this.checked;}});return options;},onfile_loaded:function(event,from,to,arg){if(arg!=null){this.toggle_partial(null);}
this.$buttons.filter('.o_import_import, .o_import_validate').addClass('d-none');if(!this.$('input.oe_import_file').val()){return this['settings_changed']();}
this.$('.oe_import_date_format').select2('val','');this.$('.oe_import_datetime_format').val('');this.$('.oe_import_sheet').val('');this.$form.removeClass('oe_import_preview oe_import_error');var import_toggle=false;var file=this.$('input.oe_import_file')[0].files[0];if((file.type&&_.last(file.type.split('/'))==="csv")||(_.last(file.name.split('.'))==="csv")){import_toggle=true;}
this.$form.find('.oe_import_box').toggle(import_toggle);jsonp(this.$form,{url:'/base_import/set_file'},this.proxy('settings_changed'));},onpreviewing:function(){var self=this;this.$buttons.filter('.o_import_import, .o_import_validate').addClass('d-none');this.$form.addClass('oe_import_with_file');this.$form.removeClass('oe_import_preview_error oe_import_error');this.$form.toggleClass('oe_import_noheaders text-muted',!this.$('input.oe_import_has_header').prop('checked'));self.$('input.oe_import_file').val('');this._rpc({model:'base_import.import',method:'parse_preview',args:[this.id,this.import_options()],kwargs:{context:session.user_context},}).then(function(result){var signal=result.error?'preview_failed':'preview_succeeded';self[signal](result);});},onpreview_error:function(event,from,to,result){this.$('.oe_import_options').show();this.$form.addClass('oe_import_preview_error oe_import_error');this.$form.find('.oe_import_box, .oe_import_with_file').removeClass('d-none');this.$form.find('.o_view_nocontent').addClass('d-none');this.$('.oe_import_error_report').html(QWeb.render('ImportView.preview.error',result));},onpreview_success:function(event,from,to,result){var self=this;this.$buttons.filter('.oe_import_file').text(_t('Load New File')).removeClass('btn-primary').addClass('btn-secondary').blur();this.$buttons.filter('.o_import_import, .o_import_validate').removeClass('d-none');this.$form.find('.oe_import_box, .oe_import_with_file').removeClass('d-none');this.$form.find('.o_view_nocontent').addClass('d-none');this.$form.addClass('oe_import_preview');this.$('input.oe_import_advanced_mode').prop('checked',result.advanced_mode);this.$('.oe_import_grid').html(QWeb.render('ImportView.preview',result));this.$('.o_import_batch_alert').toggleClass('d-none',!result.batch);var messages=[];if(result.headers.length===1){messages.push({type:'warning',message:_t("A single column was found in the file, this often means the file separator is incorrect")});}
if(!_.isEmpty(messages)){this.$('.oe_import_options').show();this.onresults(null,null,null,{'messages':messages});}
if(!_.isEqual(this.sheets,result.options.sheets)){this.sheets=result.options.sheets||[];this.setup_sheets_picker();}
this.$('div.oe_import_has_multiple_sheets').toggle(this.sheets.length>1);_.each(['encoding','separator','float_thousand_separator','float_decimal_separator','sheet'],function(id){self.$('.oe_import_'+id).select2('val',result.options[id])});this.$('.oe_import_date_format').select2('val',time.strftime_to_moment_format(result.options.date_format));this.$('.oe_import_datetime_format').val(time.strftime_to_moment_format(result.options.datetime_format));this.$('.oe_import_debug_option').toggleClass('d-none',!result.debug);var $fields=this.$('.oe_import_fields input');this.render_fields_matches(result,$fields);var data=this.generate_fields_completion(result);var item_finder=function(id,items){items=items||data;for(var i=0;i<items.length;++i){var item=items[i];if(item.id===id){return item;}
var val;if(item.children&&(val=item_finder(id,item.children))){return val;}}
return'';};$fields.each(function(k,v){var filtered_data=self.generate_fields_completion(result,k);var $thing=$();var bind=function(d){};if(config.isDebug()){$thing=$(QWeb.render('ImportView.create_record_option')).insertAfter(v).hide();bind=function(data){switch(data.type){case'many2one':case'many2many':$thing.find('input').attr('field',data.id);$thing.show();break;default:$thing.find('input').attr('field','').prop('checked',false);$thing.hide();}}}
$(v).select2({allowClear:true,minimumInputLength:0,data:filtered_data,initSelection:function(element,callback){var default_value=element.val();if(!default_value){callback('');return;}
var data=item_finder(default_value);bind(data);callback(data);},placeholder:_t('Don\'t import'),width:'resolve',dropdownCssClass:'oe_import_selector'}).on('change',function(e){bind(item_finder(e.currentTarget.value));});});},generate_fields_completion:function(root,index){var self=this;var basic=[];var regulars=[];var o2m=[];var headers_type=root.headers_type;function traverse(field,ancestors,collection,type){var subfields=field.fields;var advanced_mode=self.$('input.oe_import_advanced_mode').prop('checked');var field_path=ancestors.concat(field);var label=_(field_path).pluck('string').join(' / ');var id=_(field_path).pluck('name').join('/');if(type===undefined||(type!==undefined&&(type.indexOf('all')!==-1||type.indexOf(field['type'])!==-1))){if(!collection){if(field.name==='id'){collection=basic;}else if(_.isEmpty(subfields)||_.isEqual(_.pluck(subfields,'name'),['id','.id'])){collection=regulars;}else{collection=o2m;}}
collection.push({id:id,text:label,required:field.required,type:field.type});}
if(advanced_mode){for(var i=0,end=subfields.length;i<end;++i){traverse(subfields[i],field_path,collection,type);}}}
_(root.fields).each(function(field){if(index===undefined){traverse(field,[]);}
else{if(self.$('input.oe_import_advanced_mode').prop('checked')){traverse(field,[],undefined,['all']);}
else{traverse(field,[],undefined,headers_type[index]);}}});var cmp=function(field1,field2){return field1.text.localeCompare(field2.text);};regulars.sort(cmp);o2m.sort(cmp);if(!_.isEmpty(regulars)&&!_.isEmpty(o2m)){basic=basic.concat([{text:_t("Normal Fields"),children:regulars},{text:_t("Relation Fields"),children:o2m},]);}
else if(!_.isEmpty(regulars)){basic=basic.concat(regulars);}
else if(!_.isEmpty(o2m)){basic=basic.concat(o2m);}
return basic;},render_fields_matches:function(result,$fields){if(_(result.matches).isEmpty()){return;}
$fields.each(function(index,input){var match=result.matches[index];if(!match){return;}
var current_field=result;input.value=_(match).chain().map(function(name){return current_field=_(current_field.fields).find(function(subfield){return subfield.name===name;});}).pluck('name').value().join('/');});},call_import:function(kwargs){var fields=this.$('.oe_import_fields input.oe_import_match_field').map(function(index,el){return $(el).select2('val')||false;}).get();var columns=this.$('.oe_import_grid-header .oe_import_grid-cell .o_import_header_name').map(function(){return $(this).text().trim().toLowerCase()||false;}).get();var tracking_disable='tracking_disable'in kwargs?kwargs.tracking_disable:!this.$('#oe_import_tracking').prop('checked')
delete kwargs.tracking_disable;kwargs.context=_.extend({},this.parent_context,{tracking_disable:tracking_disable});var self=this;this.trigger_up('with_client',{callback:function(){this.loading.ignore_events=true;}});$.blockUI({message:QWeb.render('Throbber')});$(document.body).addClass('o_ui_blocked');var opts=this.import_options();var $el=$('.oe_throbber_message');var msg=kwargs.dryrun?_t("%d records tested..."):_t("%d records successfully imported...");opts.callback=function(count){$el.text(_.str.sprintf(msg,count));};return this._batchedImport(opts,[this.id,fields,columns],kwargs,{done:0,prev:0}).then(null,function(reason){var error=reason.message;var event=reason.event;if(event){event.preventDefault();}
var msg;var errordata=error.data||{};if(errordata.type==='xhrerror'){var xhr=errordata.objects[0];switch(xhr.status){case 504:msg=_t("Import timed out. Please retry. If you still encounter this issue, the file may be too big for the system's configuration, try to split it (import less records per file).");break;default:msg=_t("An unknown issue occurred during import (possibly lost connection, data limit exceeded or memory limits exceeded). Please retry in case the issue is transient. If the issue still occurs, try to split the file rather than import it at once.");}}else{msg=errordata.arguments&&(errordata.arguments[1]||errordata.arguments[0])||error.message;}
return Promise.resolve({'messages':[{type:'error',record:false,message:msg,}]});}).finally(function(){$(document.body).removeClass('o_ui_blocked');$.unblockUI();self.trigger_up('with_client',{callback:function(){delete this.loading.ignore_events;}});});},_batchedImport:function(opts,args,kwargs,rec){opts.callback&&opts.callback(rec.done||0);var self=this;return this._rpc({model:'base_import.import',method:'do',args:args.concat([opts]),kwargs:kwargs}).then(function(results){_.each(results.messages,offset_by(opts.skip));if(!kwargs.dryrun&&!results.ids){self.$('#oe_import_row_start').val(opts.skip+1);if(opts.skip){results.messages.push({type:'info',priority:true,message:_.str.sprintf(_t("This file has been successfully imported up to line %d."),opts.skip)});}
return results;}
if(!results.nextrow){return results;}
return self._batchedImport(_.defaults({skip:results.nextrow},opts),args,kwargs,{done:rec.done+(results.ids||[]).length,prev:results.nextrow}).then(function(r2){return{name:_.zip(results.name,r2.name).map(function(names){return names[0]||names[1];}),ids:(results.ids||[]).concat(r2.ids||[]),messages:results.messages.concat(r2.messages),skip:r2.skip||results.nextrow,nextrow:r2.nextrow}});});},onvalidate:function(){var prom=this.call_import({dryrun:true,tracking_disable:true});prom.then(this.proxy('validated'));return prom;},onimport:function(){var self=this;var prom=this.call_import({dryrun:false});prom.then(function(results){var message=results.messages;if(!_.any(message,function(message){return message.type==='error';})){self['import_succeeded'](results);return;}
self['import_failed'](results);});return prom;},onimported:function(event,from,to,results){this.do_notify(false,_.str.sprintf(_t("%d records successfully imported"),results.ids.length));this.exit();},exit:function(){this.trigger_up('history_back');},onresults:function(event,from,to,results){var fields=this.$('.oe_import_fields input.oe_import_match_field').map(function(index,el){return $(el).select2('val')||false;}).get();var message=results.messages;var no_messages=_.isEmpty(message);if(no_messages){message.push({type:'info',message:_t("Everything seems valid.")});}else if(event==='import_failed'&&results.ids){this.toggle_partial(results);}
var offset=1;if(this.import_options().headers){offset+=1;}
var messagesSorted=_.sortBy(_(message).groupBy('message'),function(group){if(group[0].priority){return-2;}
var order=0;switch(group[0].type){case'error':order=0;break;case'warning':order=fields.length+1;break;case'info':order=2*(fields.length+1);break;default:order=3*(fields.length+1);break;}
return order+_.indexOf(fields,group[0].field);});this.$form.addClass('oe_import_error');this.$('.oe_import_error_report').html(QWeb.render('ImportView.error',{errors:messagesSorted,at:function(rows){var from=rows.from+offset;var to=rows.to+offset;var rowName='';if(results.name.length>rows.from&&results.name[rows.from]!==''){rowName=_.str.sprintf(' (%s)',results.name[rows.from]);}
if(from===to){return _.str.sprintf(_t("at row %d%s"),from,rowName);}
return _.str.sprintf(_t("between rows %d and %d"),from,to);},at_multi:function(rows){var from=rows.from+offset;var to=rows.to+offset;var rowName='';if(results.name.length>rows.from&&results.name[rows.from]!==''){rowName=_.str.sprintf(' (%s)',results.name[rows.from]);}
if(from===to){return _.str.sprintf(_t("Row %d%s"),from,rowName);}
return _.str.sprintf(_t("Between rows %d and %d"),from,to);},at_multi_header:function(numberLines){return _.str.sprintf(_t("at %d different rows:"),numberLines);},more:function(n){return _.str.sprintf(_t("(%d more)"),n);},info:function(msg){if(typeof msg==='string'){return _.str.sprintf('<div class="oe_import_moreinfo oe_import_moreinfo_message">%s</div>',_.str.escapeHTML(msg));}
if(msg instanceof Array){return _.str.sprintf('<div class="oe_import_moreinfo oe_import_moreinfo_choices"><a href="#" class="oe_import_report_see_possible_value oe_import_see_all"><i class="fa fa-arrow-right"/> %s </a><ul class="oe_import_report_more">%s</ul></div>',_.str.escapeHTML(_t("See possible values")),_(msg).map(function(msg){return'<li>'
+_.str.escapeHTML(msg)
+'</li>';}).join(''));}
return['<div class="oe_import_moreinfo oe_import_moreinfo_action">',_.str.sprintf('<a href="#" data-action="%s" class="oe_import_see_all"><i class="fa fa-arrow-right"/> ',_.str.escapeHTML(JSON.stringify(msg))),_.str.escapeHTML(_t("See possible values")),'</a>','</div>'].join('');},}));},toggle_partial:function(result){var $form=this.$('.oe_import');var $partial_warning=this.$('.o_import_partial_alert');var $partial_count=this.$('.o_import_partial_count');if(result==null){$partial_warning.addClass('d-none');$form.add(this.$buttons).removeClass('o_import_partial_mode');var $skip=this.$('#oe_import_row_start');$skip.val($skip.attr('value'));$partial_count.text('');return;}
this.$('.o_import_batch_alert').addClass('d-none');$partial_warning.removeClass('d-none');$form.add(this.$buttons).addClass('o_import_partial_mode');$partial_count.text((result.skip||0)+1);}});core.action_registry.add('import',DataImport);StateMachine.create({target:DataImport.prototype,events:[{name:'loaded_file',from:['none','file_loaded','preview_error','preview_success','results'],to:'file_loaded'},{name:'settings_changed',from:['file_loaded','preview_error','preview_success','results'],to:'previewing'},{name:'preview_failed',from:'previewing',to:'preview_error'},{name:'preview_succeeded',from:'previewing',to:'preview_success'},{name:'validate',from:'preview_success',to:'validating'},{name:'validate',from:'results',to:'validating'},{name:'validated',from:'validating',to:'results'},{name:'import',from:['preview_success','results'],to:'importing'},{name:'import_succeeded',from:'importing',to:'imported'},{name:'import_failed',from:'importing',to:'results'}],});Loading.include({on_rpc_event:function(){if(this.ignore_events){return}
this._super.apply(this,arguments);}});AbstractWebClient.prototype.custom_events['with_client']=function(ev){ev.data.callback.call(this);};function offset_by(by){return function offset_message(msg){if(msg.rows){msg.rows.from+=by;msg.rows.to+=by;}}}
return{DataImport:DataImport,};});;

/* /base_import/static/src/js/import_menu.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('base_import.ImportMenu',function(require){"use strict";const DropdownMenuItem=require('web.DropdownMenuItem');const FavoriteMenu=require('web.FavoriteMenu');const{useModel}=require('web/static/src/js/model.js');class ImportMenu extends DropdownMenuItem{constructor(){super(...arguments);this.model=useModel('searchModel');}
_onImportClick(){const action={type:'ir.actions.client',tag:'import',params:{model:this.model.config.modelName,context:this.model.config.context,}};this.trigger('do-action',{action:action});}
static shouldBeDisplayed(env){return env.view&&['kanban','list'].includes(env.view.type)&&!env.device.isMobile&&!!JSON.parse(env.view.arch.attrs.import||'1')&&!!JSON.parse(env.view.arch.attrs.create||'1');}}
ImportMenu.props={};ImportMenu.template='base_import.ImportMenu';FavoriteMenu.registry.add('import-menu',ImportMenu,1);return ImportMenu;});;

/* /odoo_referral/static/src/js/systray.js defined in bundle 'point_of_sale.pos_assets_backend' */
;

/* /web_cohort/static/src/js/cohort_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_cohort.CohortView',function(require){'use strict';var AbstractView=require('web.AbstractView');var core=require('web.core');var view_registry=require('web.view_registry');var CohortController=require('web_cohort.CohortController');var CohortModel=require('web_cohort.CohortModel');var CohortRenderer=require('web_cohort.CohortRenderer');const RendererWrapper=require('web.RendererWrapper');var _t=core._t;var _lt=core._lt;var intervals={day:_lt('Day'),week:_lt('Week'),month:_lt('Month'),year:_lt('Year'),};var CohortView=AbstractView.extend({display_name:_lt('Cohort'),icon:'fa-signal',config:_.extend({},AbstractView.prototype.config,{Model:CohortModel,Controller:CohortController,Renderer:CohortRenderer,}),viewType:'cohort',searchMenuTypes:['filter','comparison','favorite'],init:function(viewInfo,params){this._super.apply(this,arguments);var fields=this.fields;var attrs=this.arch.attrs;const additionalMeasures=params.additionalMeasures||[];if(!attrs.date_start){throw new Error(_lt('Cohort view has not defined "date_start" attribute.'));}
if(!attrs.date_stop){throw new Error(_lt('Cohort view has not defined "date_stop" attribute.'));}
var measures={};_.each(fields,function(field,name){if(name!=='id'&&field.store===true&&_.contains(['integer','float','monetary'],field.type)){measures[name]=field.string;}});this.arch.children.forEach(field=>{let fieldName=field.attrs.name;if(!additionalMeasures.includes(fieldName)&&field.attrs.invisible&&py.eval(field.attrs.invisible)){delete measures[fieldName];return;}
if(fieldName in measures&&field.attrs.string){measures[fieldName]=field.attrs.string;}});measures.__count__=_t('Count');this.rendererParams.measures=measures;this.rendererParams.intervals=intervals;this.controllerParams.measures=_.omit(measures,'__count__');this.controllerParams.intervals=intervals;this.controllerParams.title=params.title||attrs.string||_t('Untitled');this.controllerParams.views=[_findViewID('list'),_findViewID('form'),];function _findViewID(viewType){var action=params.action;if(action===undefined){return[false,viewType];}
var contextID=viewType==='list'?action.context.list_view_id:action.context.form_view_id;var result=_.findWhere(action.views,{type:viewType});return[contextID||(result?result.viewID:false),viewType];}},_updateMVCParams:function(){this._super.apply(this,arguments);var context=this.loadParams.context;var attrs=this.arch.attrs;this.loadParams.dateStart=context.cohort_date_start||attrs.date_start;this.loadParams.dateStop=context.cohort_date_stop||attrs.date_stop;this.loadParams.mode=context.cohort_mode||attrs.mode||'retention';this.loadParams.timeline=context.cohort_timeline||attrs.timeline||'forward';this.loadParams.measure=context.cohort_measure||attrs.measure||'__count__';this.loadParams.interval=context.cohort_interval||attrs.interval||'day';this.rendererParams.mode=this.loadParams.mode;this.rendererParams.timeline=this.loadParams.timeline;this.rendererParams.dateStartString=this.fields[this.loadParams.dateStart].string;this.rendererParams.dateStopString=this.fields[this.loadParams.dateStop].string;this.controllerParams.dateStartString=this.rendererParams.dateStartString;this.controllerParams.dateStopString=this.rendererParams.dateStopString;this.controllerParams.timeline=this.rendererParams.timeline;},getRenderer(parent,state){state=Object.assign({},state,this.rendererParams);return new RendererWrapper(null,this.config.Renderer,state);},});view_registry.add('cohort',CohortView);return CohortView;});;

/* /web_cohort/static/src/js/cohort_model.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_cohort.CohortModel',function(require){'use strict';var AbstractModel=require('web.AbstractModel');var CohortModel=AbstractModel.extend({__get:function(){const{rangeDescription,comparisonRangeDescription}=this.timeRanges;return Object.assign({},this.data,{hasContent:!this._isEmpty(),isSample:this.isSampleModel,rangeDescription,comparisonRangeDescription});},__load:function(params){this.modelName=params.modelName;this.dateStart=params.dateStart;this.dateStop=params.dateStop;this.measure=params.measure;this.interval=params.interval;this.domain=params.domain;this.mode=params.mode;this.timeline=params.timeline;this.data={measure:this.measure,interval:this.interval,};this.context=params.context;this.timeRanges=params.timeRanges;return this._fetchData();},__reload:function(handle,params){if('measure'in params){this.data.measure=params.measure;}
if('interval'in params){this.data.interval=params.interval;}
if('domain'in params){this.domain=params.domain;}
if('timeRanges'in params){this.timeRanges=params.timeRanges;}
return this._fetchData();},_fetchData:function(){const domains=this._getDomains();const proms=domains.map(domain=>{return this._rpc({model:this.modelName,method:'get_cohort_data',kwargs:{date_start:this.dateStart,date_stop:this.dateStop,measure:this.data.measure,interval:this.data.interval,domain:domain,mode:this.mode,timeline:this.timeline,context:this.context}});});return Promise.all(proms).then(([report,comparisonReport])=>{this.data.report=report;this.data.comparisonReport=comparisonReport;});},_getDomains:function(){const{range,comparisonRange}=this.timeRanges;if(!range){return[this.domain];}
return[this.domain.concat(range),this.domain.concat(comparisonRange),];},_isEmpty(){let rowCount=this.data.report.rows.length;if(this.data.comparisonReport){rowCount+=this.data.comparisonReport.rows.length;}
return rowCount===0;},});return CohortModel;});;

/* /web_cohort/static/src/js/cohort_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_cohort.CohortController',function(require){'use strict';const AbstractController=require('web.AbstractController');const config=require('web.config');const core=require('web.core');const framework=require('web.framework');const session=require('web.session');const qweb=core.qweb;const _t=core._t;var CohortController=AbstractController.extend({custom_events:Object.assign({},AbstractController.prototype.custom_events,{row_clicked:'_onRowClicked',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.title=params.title;this.measures=params.measures;this.intervals=params.intervals;this.dateStartString=params.dateStartString;this.dateStopString=params.dateStopString;this.timeline=params.timeline;this.views=params.views;},getOwnedQueryParams:function(){var state=this.model.get();return{context:{cohort_measure:state.measure,cohort_interval:state.interval,}};},renderButtons:function($node){this.$buttons=$(qweb.render('CohortView.buttons',{measures:_.sortBy(_.pairs(this.measures),function(x){return x[1].toLowerCase();}),intervals:this.intervals,isMobile:config.device.isMobile}));this.$measureList=this.$buttons.find('.o_cohort_measures_list');this.$buttons.on('click','button',this._onButtonClick.bind(this));if($node){this.$buttons.appendTo($node);}},updateButtons:function(){if(!this.$buttons){return;}
var data=this.model.get();var noData=!data.report.rows.length&&(!data.comparisonReport||!data.comparisonReport.rows.length);this.$buttons.find('.o_cohort_download_button').toggleClass('d-none',noData);if(config.device.isMobile){var $activeInterval=this.$buttons.find('.o_cohort_interval_button[data-interval="'+data.interval+'"]');this.$buttons.find('.dropdown_cohort_content').text($activeInterval.text());}
this.$buttons.find('.o_cohort_interval_button').removeClass('active');this.$buttons.find('.o_cohort_interval_button[data-interval="'+data.interval+'"]').addClass('active');_.each(this.$measureList.find('.dropdown-item'),function(el){var $el=$(el);$el.toggleClass('selected',$el.data('field')===data.measure);});},_downloadExcel:function(){var data=this.model.get();data=_.extend(data,{title:this.title,interval_string:this.intervals[data.interval].toString(),measure_string:this.measures[data.measure]||_t('Count'),date_start_string:this.dateStartString,date_stop_string:this.dateStopString,timeline:this.timeline,});framework.blockUI();session.get_file({url:'/web/cohort/export',data:{data:JSON.stringify(data)},complete:framework.unblockUI,error:(error)=>this.call('crash_manager','rpc_error',error),});},_setInterval:function(interval){this.update({interval:interval});},_setMeasure:function(measure){this.update({measure:measure});},_update:function(){this.updateButtons();return this._super.apply(this,arguments);},_onButtonClick:function(ev){var $btn=$(ev.currentTarget);if($btn.hasClass('o_cohort_interval_button')){this._setInterval($btn.data('interval'));}else if($btn.hasClass('o_cohort_download_button')){this._downloadExcel();}else if($btn.closest('.o_cohort_measures_list').length){ev.preventDefault();ev.stopPropagation();this._setMeasure($btn.data('field'));}},_onRowClicked:function(event){this.do_action({type:'ir.actions.act_window',name:this.title,res_model:this.modelName,views:this.views,domain:event.data.domain,});},});return CohortController;});;

/* /web_cohort/static/src/js/cohort_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_cohort.CohortRenderer',function(require){'use strict';const OwlAbstractRenderer=require('web.AbstractRendererOwl');const field_utils=require('web.field_utils');const patchMixin=require('web.patchMixin');class CohortRenderer extends OwlAbstractRenderer{constructor(){super(...arguments);this.sampleDataTargets=['table'];}
_range(value){return _.range(value);}
_formatFloat(value){return field_utils.format.float(value,null,{digits:[42,1],});}
_formatPercentage(value){return field_utils.format.percentage(value,null,{digits:[42,1],});}
_onClickRow(ev){if(!ev.target.classList.contains('o_cohort_value')){return;}
const rowData=ev.currentTarget.dataset;const rowIndex=rowData.rowIndex;const colIndex=ev.target.dataset.colIndex;const row=(rowData.type==='data')?this.props.report.rows[rowIndex]:this.props.comparisonReport.rows[rowIndex];const rowDomain=row?row.domain:[];const cellContent=row?row.columns[colIndex]:false;const cellDomain=cellContent?cellContent.domain:[];const fullDomain=rowDomain.concat(cellDomain);if(cellDomain.length){fullDomain.unshift('&');}
if(fullDomain.length){this.trigger('row_clicked',{domain:fullDomain});}}}
CohortRenderer.template='web_cohort.CohortRenderer';return patchMixin(CohortRenderer);});;

/* /web_cohort/static/src/js/sample_server.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_cohort/static/src/js/sample_server.js',function(require){"use strict";const SampleServer=require('web.SampleServer');function _mockGetCohortData(params){const{model}=params;const{date_start,interval,measure,mode,timeline}=params.kwargs;const columns_avg={};const rows=[];let initialChurnValue=0;const groups=this._mockReadGroup({model,fields:[date_start],groupBy:[date_start+':'+interval]});const totalCount=groups.length;let totalValue=0;for(const group of groups){const format=SampleServer.FORMATS[interval];const displayFormat=SampleServer.DISPLAY_FORMATS[interval];const date=moment(group[date_start+':'+interval],format);const now=moment();let colStartDate=date.clone();if(timeline==='backward'){colStartDate=colStartDate.subtract(15,interval);}
let value=measure==='__count__'?this._getRandomInt(SampleServer.MAX_INTEGER):this._generateFieldValue(model,measure);value=value||25;totalValue+=value;let initialValue=value;let max=value;const columns=[];for(let column=0;column<=15;column++){if(!columns_avg[column]){columns_avg[column]={percentage:0,count:0};}
if(colStartDate.clone().add(column,interval)>now){columns.push({value:'-',churn_value:'-',percentage:''});continue;}
let colValue=0;if(max>0){colValue=Math.min(Math.round(Math.random()*max),max);max-=colValue;}
if(timeline==='backward'&&column===0){initialValue=Math.min(Math.round(Math.random()*value),value);initialChurnValue=value-initialValue;}
const previousValue=column===0?initialValue:columns[column-1].value;const remainingValue=previousValue-colValue;const previousChurnValue=column===0?initialChurnValue:columns[column-1].churn_value;const churn_value=colValue+previousChurnValue;let percentage=value?parseFloat(remainingValue/value):0;if(mode==='churn'){percentage=1-percentage;}
percentage=Number((100*percentage).toFixed(1));columns_avg[column].percentage+=percentage;columns_avg[column].count+=1;columns.push({value:remainingValue,churn_value,percentage,period:column,});}
const keepRow=columns.some(c=>c.percentage!=='');if(keepRow){rows.push({date:date.format(displayFormat),value,columns});}}
const avg_value=totalCount?(totalValue/totalCount):0;const avg={avg_value,columns_avg};return{rows,avg};}
SampleServer.mockRegistry.add('get_cohort_data',_mockGetCohortData);});;

/* /web_editor/static/src/js/frontend/loader.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_editor.loader',function(require){'use strict';var Wysiwyg=require('web_editor.wysiwyg.root');function load(parent,textarea,options){var loading=textarea.nextElementSibling;if(loading&&!loading.classList.contains('o_wysiwyg_loading')){loading=null;}
if(!textarea.value.match(/\S/)){textarea.value='<p><br/></p>';}
var wysiwyg=new Wysiwyg(parent,options);return wysiwyg.attachTo(textarea).then(()=>{if(loading){loading.parentNode.removeChild(loading);}
return wysiwyg;});}
return{load:load,};});;

/* /web_editor/static/src/js/backend/field_html.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_editor.field.html',function(require){'use strict';var ajax=require('web.ajax');var basic_fields=require('web.basic_fields');var config=require('web.config');var core=require('web.core');var Wysiwyg=require('web_editor.wysiwyg.root');var field_registry=require('web.field_registry');require('web._field_registry');var _lt=core._lt;var TranslatableFieldMixin=basic_fields.TranslatableFieldMixin;var QWeb=core.qweb;var assetsLoaded;var jinjaRegex=/(^|\n)\s*%\s(end|set\s)/;var FieldHtml=basic_fields.DebouncedField.extend(TranslatableFieldMixin,{description:_lt("Html"),className:'oe_form_field oe_form_field_html',supportedFieldTypes:['html'],custom_events:{wysiwyg_focus:'_onWysiwygFocus',wysiwyg_blur:'_onWysiwygBlur',wysiwyg_change:'_onChange',wysiwyg_attachment:'_onAttachmentChange',},willStart:function(){var self=this;this.isRendered=false;this._onUpdateIframeId='onLoad_'+_.uniqueId('FieldHtml');var defAsset;if(this.nodeOptions.cssReadonly){defAsset=ajax.loadAsset(this.nodeOptions.cssReadonly);}
if(!assetsLoaded){assetsLoaded=new Promise(function(resolve){var wysiwyg=new Wysiwyg(self,{});wysiwyg.attachTo($('<textarea>')).then(function(){wysiwyg.destroy();resolve();});});}
return Promise.all([this._super(),assetsLoaded,defAsset]);},destroy:function(){delete window.top[this._onUpdateIframeId];if(this.$iframe){this.$iframe.remove();}
this._super();},activate:function(options){if(this.wysiwyg){this.wysiwyg.focus();return true;}},commitChanges:function(){var self=this;if(config.isDebug()&&this.mode==='edit'){var layoutInfo=$.summernote.core.dom.makeLayoutInfo(this.wysiwyg.$editor);$.summernote.pluginEvents.codeview(undefined,undefined,layoutInfo,false);}
if(this.mode=="readonly"||!this.isRendered){return this._super();}
var _super=this._super.bind(this);return this.wysiwyg.saveModifiedImages(this.$content).then(function(){return self.wysiwyg.save().then(function(result){self._isDirty=result.isDirty;_super();});});},isSet:function(){var value=this.value&&this.value.split('&nbsp;').join('').replace(/\s/g,'');return value&&value!=="<p></p>"&&value!=="<p><br></p>"&&value.match(/\S/);},getFocusableElement:function(){return this.$target||$();},reset:function(record,event){this._reset(record,event);var value=this.value;if(this.nodeOptions.wrapper){value=this._wrap(value);}
value=this._textToHtml(value);if(!event||event.target!==this){if(this.mode==='edit'){this.wysiwyg.setValue(value);}else{this.$content.html(value);}}
return Promise.resolve();},_getValue:function(){var value=this.$target.val();if(this.nodeOptions.wrapper){return this._unWrap(value);}
return value;},_createWysiwygIntance:function(){var self=this;this.wysiwyg=new Wysiwyg(this,this._getWysiwygOptions());this.wysiwyg.__extraAssetsForIframe=this.__extraAssetsForIframe||[];return this.wysiwyg.attachTo(this.$target).then(function(){self.$content=self.wysiwyg.$editor.closest('body, odoo-wysiwyg-container');self._onLoadWysiwyg();self.isRendered=true;});},_getWysiwygOptions:function(){var self=this;return Object.assign({},this.nodeOptions,{recordInfo:{context:this.record.getContext(this.recordParams),res_model:this.model,res_id:this.res_id,},noAttachment:this.nodeOptions['no-attachment'],inIframe:!!this.nodeOptions.cssEdit,iframeCssAssets:this.nodeOptions.cssEdit,snippets:this.nodeOptions.snippets,tabsize:0,height:180,generateOptions:function(options){var toolbar=options.toolbar||options.airPopover||{};var para=_.find(toolbar,function(item){return item[0]==='para';});if(para&&para[1]&&para[1].indexOf('checklist')===-1){para[1].splice(2,0,'checklist');}
if(config.isDebug()){options.codeview=true;var view=_.find(toolbar,function(item){return item[0]==='view';});if(view){if(!view[1].includes('codeview')){view[1].splice(-1,0,'codeview');}}else{toolbar.splice(-1,0,['view',['codeview']]);}}
if(self.field.sanitize&&self.field.sanitize_tags){options.noVideos=true;}
options.prettifyHtml=false;return options;},});},_onAttachmentChange:function(attachments){if(!this.fieldNameAttachment){return;}
this.trigger_up('field_changed',{dataPointID:this.dataPointID,changes:_.object([this.fieldNameAttachment],[{operation:'ADD_M2M',ids:attachments}])});},_renderEdit:function(){var value=this._textToHtml(this.value);if(this.nodeOptions.wrapper){value=this._wrap(value);}
this.$target=$('<textarea>').val(value).hide();this.$target.appendTo(this.$el);var fieldNameAttachment=_.chain(this.recordData).pairs().find(function(value){return _.isObject(value[1])&&value[1].model==="ir.attachment";}).first().value();if(fieldNameAttachment){this.fieldNameAttachment=fieldNameAttachment;}
if(this.nodeOptions.cssEdit){this._createWysiwygIntance();}else{return this._createWysiwygIntance();}},_renderReadonly:function(){var self=this;var value=this._textToHtml(this.value);if(this.nodeOptions.wrapper){value=this._wrap(value);}
this.$el.empty();var resolver;var def=new Promise(function(resolve){resolver=resolve;});if(this.nodeOptions.cssReadonly){this.$iframe=$('<iframe class="o_readonly"/>');this.$iframe.appendTo(this.$el);var avoidDoubleLoad=0;this.$iframe.data('loadDef',def);window.top[this._onUpdateIframeId]=function(_avoidDoubleLoad){if(_avoidDoubleLoad!==avoidDoubleLoad){console.warn('Wysiwyg iframe double load detected');return;}
self.$content=$('#iframe_target',self.$iframe[0].contentWindow.document.body);resolver();};this.$iframe.on('load',function onLoad(){var _avoidDoubleLoad=++avoidDoubleLoad;ajax.loadAsset(self.nodeOptions.cssReadonly).then(function(asset){if(_avoidDoubleLoad!==avoidDoubleLoad){console.warn('Wysiwyg immediate iframe double load detected');return;}
var cwindow=self.$iframe[0].contentWindow;cwindow.document.open("text/html","replace").write('<head>'+'<meta charset="utf-8"/>'+'<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>\n'+'<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"/>\n'+
_.map(asset.cssLibs,function(cssLib){return'<link type="text/css" rel="stylesheet" href="'+cssLib+'"/>';}).join('\n')+'\n'+
_.map(asset.cssContents,function(cssContent){return'<style type="text/css">'+cssContent+'</style>';}).join('\n')+'\n'+'</head>\n'+'<body class="o_in_iframe o_readonly">\n'+'<div id="iframe_target">'+value+'</div>\n'+'<script type="text/javascript">'+'if (window.top.'+self._onUpdateIframeId+') {'+'window.top.'+self._onUpdateIframeId+'('+_avoidDoubleLoad+')'+'}'+'</script>\n'+'</body>');var height=cwindow.document.body.scrollHeight;self.$iframe.css('height',Math.max(30,Math.min(height,500))+'px');});});}else{this.$content=$('<div class="o_readonly"/>').html(value);this.$content.appendTo(this.$el);resolver();}
def.then(function(){self.$content.on('click','ul.o_checklist > li',self._onReadonlyClickChecklist.bind(self));});},_textToHtml:function(text){var value=text||"";if(jinjaRegex.test(value)){return value;}
try{$(text)[0].innerHTML;}catch(e){if(value.match(/^\s*$/)){value='<p><br/></p>';}else{value="<p>"+value.split(/<br\/?>/).join("<br/></p><p>")+"</p>";value=value.replace(/<p><\/p>/g,'').replace('<p><p>','<p>').replace('<p><p ','<p ').replace('</p></p>','</p>');}}
return value;},_unWrap:function(html){var $wrapper=$(html).find('#wrapper');return $wrapper.length?$wrapper.html():html;},_wrap:function(html){return $(QWeb.render(this.nodeOptions.wrapper)).find('#wrapper').html(html).end().prop('outerHTML');},_onChange:function(ev){this._doDebouncedAction.apply(this,arguments);var $lis=this.$content.find('.note-editable ul.o_checklist > li:not(:has(> ul.o_checklist))');if(!$lis.length){return;}
var max=0;var ids=[];$lis.map(function(){var checklistId=parseInt(($(this).attr('id')||'0').replace(/^checklist-id-/,''));if(ids.indexOf(checklistId)===-1){if(checklistId>max){max=checklistId;}
ids.push(checklistId);}else{$(this).removeAttr('id');}});$lis.not('[id]').each(function(){$(this).attr('id','checklist-id-'+(++max));});},_onKeydown:function(ev){if(ev.which===$.ui.keyCode.ENTER&&$(ev.target).is('textarea')){ev.stopPropagation();return;}
this._super.apply(this,arguments);},_onReadonlyClickChecklist:function(ev){var self=this;if(ev.offsetX>0){return;}
ev.stopPropagation();ev.preventDefault();var checked=$(ev.target).hasClass('o_checked');var checklistId=parseInt(($(ev.target).attr('id')||'0').replace(/^checklist-id-/,''));this._rpc({route:'/web_editor/checklist',params:{res_model:this.model,res_id:this.res_id,filename:this.name,checklistId:checklistId,checked:!checked,},}).then(function(value){self._setValue(value);});},_onLoadWysiwyg:function(){var $button=this._renderTranslateButton();$button.css({'font-size':'15px',position:'absolute',right:'+5px',top:'+5px',});this.$el.append($button);},_onWysiwygBlur:function(ev){ev.stopPropagation();this._doAction();if(ev.data.key==='TAB'){this.trigger_up('navigation_move',{direction:ev.data.shiftKey?'left':'right',});}},_onWysiwygFocus:function(ev){},});field_registry.add('html',FieldHtml);return FieldHtml;});;

/* /web_editor/static/src/js/backend/convert_inline.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_editor.convertInline',function(require){'use strict';var FieldHtml=require('web_editor.field.html');function getMatchedCSSRules(a){var i,r,k;var doc=a.ownerDocument;var rulesCache=a.ownerDocument._rulesCache||(a.ownerDocument._rulesCache=[]);if(!rulesCache.length){var sheets=doc.styleSheets;for(i=sheets.length-1;i>=0;i--){var rules;try{rules=sheets[i].rules||sheets[i].cssRules;}catch(e){console.warn("Can't read the css rules of: "+sheets[i].href,e);continue;}
if(rules){for(r=rules.length-1;r>=0;r--){var selectorText=rules[r].selectorText;if(selectorText&&rules[r].cssText&&selectorText!=='*'&&selectorText.indexOf(':hover')===-1&&selectorText.indexOf(':before')===-1&&selectorText.indexOf(':after')===-1&&selectorText.indexOf(':active')===-1&&selectorText.indexOf(':link')===-1&&selectorText.indexOf('::')===-1&&selectorText.indexOf("'")===-1){var st=selectorText.split(/\s*,\s*/);for(k=0;k<st.length;k++){rulesCache.push({'selector':st[k],'style':rules[r].style});}}}}}
rulesCache.reverse();}
var css=[];var style;a.matches=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.msMatchesSelector||a.oMatchesSelector;for(r=0;r<rulesCache.length;r++){if(a.matches(rulesCache[r].selector)){style=rulesCache[r].style;if(style.parentRule){var style_obj={};var len;for(k=0,len=style.length;k<len;k++){if(style[k].indexOf('animation')!==-1){continue;}
style_obj[style[k]]=style[style[k].replace(/-(.)/g,function(a,b){return b.toUpperCase();})];if(new RegExp(style[k]+'\s*:[^:;]+!important').test(style.cssText)){style_obj[style[k]]+=' !important';}}
rulesCache[r].style=style=style_obj;}
css.push([rulesCache[r].selector,style]);}}
function specificity(selector){var a=0;selector=selector.replace(/#[a-z0-9_-]+/gi,function(){a++;return'';});var b=0;selector=selector.replace(/(\.[a-z0-9_-]+)|(\[.*?\])/gi,function(){b++;return'';});var c=0;selector=selector.replace(/(^|\s+|:+)[a-z0-9_-]+/gi,function(a){if(a.indexOf(':not(')===-1)c++;return'';});return a*100+b*10+c;}
css.sort(function(a,b){return specificity(a[0])-specificity(b[0]);});style={};_.each(css,function(v,k){_.each(v[1],function(v,k){if(v&&_.isString(v)&&k.indexOf('-webkit')===-1&&(!style[k]||style[k].indexOf('important')===-1||v.indexOf('important')!==-1)){style[k]=v;}});});_.each(style,function(v,k){if(v.indexOf('important')!==-1){style[k]=v.slice(0,v.length-11);}});if(style.display==='block'){delete style.display;}
_.each([{property:'margin'},{property:'padding'},{property:'border',propertyEnd:'-style',defaultValue:'none'},],function(propertyInfo){var p=propertyInfo.property;var e=propertyInfo.propertyEnd||'';var defVal=propertyInfo.defaultValue||0;if(style[p+'-top'+e]||style[p+'-right'+e]||style[p+'-bottom'+e]||style[p+'-left'+e]){if(style[p+'-top'+e]===style[p+'-right'+e]&&style[p+'-top'+e]===style[p+'-bottom'+e]&&style[p+'-top'+e]===style[p+'-left'+e]){style[p+e]=style[p+'-top'+e];}
else{style[p+e]=(style[p+'-top'+e]||defVal)+' '+(style[p+'-right'+e]||defVal)+' '+(style[p+'-bottom'+e]||defVal)+' '+(style[p+'-left'+e]||defVal);if(style[p+e].indexOf('inherit')!==-1||style[p+e].indexOf('initial')!==-1){delete style[p+e];return;}}
delete style[p+'-top'+e];delete style[p+'-right'+e];delete style[p+'-bottom'+e];delete style[p+'-left'+e];}});if(style['border-bottom-left-radius']){style['border-radius']=style['border-bottom-left-radius'];delete style['border-bottom-left-radius'];delete style['border-bottom-right-radius'];delete style['border-top-left-radius'];delete style['border-top-right-radius'];}
_.each(_.keys(style),function(k){if(k.indexOf('border')!==-1&&style[k]==='initial'){delete style[k];}});if(style['text-decoration-line']){style['text-decoration']=style['text-decoration-line'];delete style['text-decoration-line'];delete style['text-decoration-color'];delete style['text-decoration-style'];}
if(style['text-align']==='inherit'){var $el=$(a).parent();do{var align=$el.css('text-align');if(_.indexOf(['left','right','center','justify'],align)>=0){style['text-align']=align;break;}
$el=$el.parent();}while($el.length&&!$el.is('html'));}
return style;}
function fontToImg($editable){var fonts=odoo.__DEBUG__.services["wysiwyg.fonts"];$editable.find('.fa').each(function(){var $font=$(this);var icon,content;_.find(fonts.fontIcons,function(font){return _.find(fonts.getCssSelectors(font.parser),function(data){if($font.is(data.selector.replace(/::?before/g,''))){icon=data.names[0].split('-').shift();content=data.css.match(/content:\s*['"]?(.)['"]?/)[1];return true;}});});if(content){var color=$font.css('color').replace(/\s/g,'');$font.replaceWith($('<img/>',{src:_.str.sprintf('/web_editor/font_to_img/%s/%s/%s',content.charCodeAt(0),window.encodeURI(color),Math.max(1,Math.round($font.height()))),'data-class':$font.attr('class'),'data-style':$font.attr('style'),class:$font.attr('class').replace(new RegExp('(^|\\s+)'+icon+'(-[^\\s]+)?','gi'),''),style:$font.attr('style'),}).css({height:'auto',width:'auto'}));}else{$font.remove();}});}
function imgToFont($editable){$editable.find('img[src*="/web_editor/font_to_img/"]').each(function(){var $img=$(this);$img.replaceWith($('<span/>',{class:$img.data('class'),style:$img.data('style')}));});}
function applyOverDescendants(node,func){node=node.firstChild;while(node){if(node.nodeType===1){func(node);applyOverDescendants(node,func);}
var $node=$(node);if(node.nodeName==='A'&&$node.hasClass('btn')&&!$node.children().length&&$(node).parents('.o_outlook_hack').length){node=$(node).parents('.o_outlook_hack')[0];}
else if(node.nodeName==='IMG'&&$node.parent('p').hasClass('o_outlook_hack')){node=$node.parent()[0];}
node=node.nextSibling;}}
function classToStyle($editable){applyOverDescendants($editable[0],function(node){var $target=$(node);var css=getMatchedCSSRules(node);var style=$target.attr('style')||'';_.each(css,function(v,k){if(!(new RegExp('(^|;)\s*'+k).test(style))){style=k+':'+v+';'+style;}});if(_.isEmpty(style)){$target.removeAttr('style');}else{$target.attr('style',style);}
if(node.nodeName==='TD'&&!node.childNodes.length){node.innerHTML='&nbsp;';}
if(node.nodeName==='A'&&$target.hasClass('btn')&&!$target.hasClass('btn-link')&&!$target.children().length){var $hack=$('<table class="o_outlook_hack" style="display: inline-table;vertical-align:middle"><tr><td></td></tr></table>');$hack.find('td').attr('height',$target.outerHeight()).css({'text-align':$target.parent().css('text-align'),'margin':$target.css('padding'),'border-radius':$target.css('border-radius'),'background-color':$target.css('background-color'),});$target.after($hack);$target.appendTo($hack.find('td'));node=$hack[0].previousSibling;if(node&&node.nodeType===Node.TEXT_NODE&&!node.textContent.match(/\S/)){$(node).remove();}
node=$hack[0].nextSibling;if(node&&node.nodeType===Node.TEXT_NODE&&!node.textContent.match(/\S/)){$(node).remove();}}
else if(node.nodeName==='IMG'&&$target.is('.mx-auto.d-block')){$target.wrap('<p class="o_outlook_hack" style="text-align:center;margin:0"/>');}});}
function styleToClass($editable){$editable.find('.o_outlook_hack').each(function(){$(this).after($('a,img',this));}).remove();var $c=$('<span/>').appendTo($editable[0].ownerDocument.body);applyOverDescendants($editable[0],function(node){var $target=$(node);var css=getMatchedCSSRules(node);var style='';_.each(css,function(v,k){if(!(new RegExp('(^|;)\s*'+k).test(style))){style=k+':'+v+';'+style;}});css=($c.attr('style',style).attr('style')||'').split(/\s*;\s*/);style=($target.attr('style')||'').replace(/\s*:\s*/,':').replace(/\s*;\s*/,';');_.each(css,function(v){style=style.replace(v,'');});style=style.replace(/;+(\s;)*/g,';').replace(/^;/g,'');if(style!==''){$target.attr('style',style);}else{$target.removeAttr('style');}});$c.remove();}
function attachmentThumbnailToLinkImg($editable){$editable.find('a[href*="/web/content/"][data-mimetype]').filter(':empty, :containsExact( )').each(function(){var $link=$(this);var $img=$('<img/>').attr('src',$link.css('background-image').replace(/(^url\(['"])|(['"]\)$)/g,'')).css('height',Math.max(1,$link.height())+'px').css('width',Math.max(1,$link.width())+'px');$link.prepend($img);});}
function linkImgToAttachmentThumbnail($editable){$editable.find('a[href*="/web/content/"][data-mimetype] > img').remove();}
FieldHtml.include({commitChanges:function(){if(this.nodeOptions['style-inline']&&this.mode==="edit"){this._toInline();}
return this._super();},_toInline:function(){var $editable=this.wysiwyg.getEditable();var html=this.wysiwyg.getValue();$editable.html(html);attachmentThumbnailToLinkImg($editable);fontToImg($editable);classToStyle($editable);this.wysiwyg.setValue($editable.html(),{notifyChange:false,});},_fromInline:function(){var $editable=this.wysiwyg.getEditable();var html=this.wysiwyg.getValue();$editable.html(html);styleToClass($editable);imgToFont($editable);linkImgToAttachmentThumbnail($editable);this.wysiwyg.setValue($editable.html(),{notifyChange:false,});},_onLoadWysiwyg:function(){if(this.nodeOptions['style-inline']&&this.mode==="edit"){this._fromInline();}
this._super();},});return{fontToImg:fontToImg,imgToFont:imgToFont,classToStyle:classToStyle,styleToClass:styleToClass,attachmentThumbnailToLinkImg:attachmentThumbnailToLinkImg,linkImgToAttachmentThumbnail:linkImgToAttachmentThumbnail,};});;

/* /web_enterprise/static/src/js/apps.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_enterprise.apps',function(require){"use strict";var Apps=require('web.Apps');Apps.include({_on_update_count:function(){},});});;

/* /web_enterprise/static/src/js/home_menu_wrapper.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("web_enterprise.HomeMenuWrapper",function(require){"use strict";const HomeMenu=require('web_enterprise.HomeMenu');const utils=require('web.utils');const{Component,useState}=owl;class HomeMenuWrapper extends Component{constructor(){super(...arguments);const{apps,menuItems}=this._processMenuData(this.props.menuData);this.state=useState({apps,menuItems});}
updateMenuData(menuData){const{apps,menuItems}=this._processMenuData(menuData);this.state.apps=apps;this.state.menuItems=menuItems;}
_processMenuData(menuData){const apps=[];const menuItems=[];utils.traversePath(menuData,(menuItem,parents)=>{if(!menuItem.id||!menuItem.action){return;}
const isApp=!menuItem.parent_id;const item={parents:parents.slice(1).map(p=>p.name).join(' / '),label:menuItem.name,id:menuItem.id,xmlid:menuItem.xmlid,action:menuItem.action?menuItem.action.split(',')[1]:'',webIcon:menuItem.web_icon,};if(!menuItem.parent_id){if(menuItem.web_icon_data){item.webIconData=`data:image/png;base64,${menuItem.web_icon_data}`.replace(/\s/g,"");}else if(item.webIcon){const[iconClass,color,backgroundColor]=item.webIcon.split(',');item.webIcon={iconClass,color,backgroundColor};}else{item.webIconData='/web_enterprise/static/src/img/default_icon_app.png';}}else{item.menu_id=parents[1].id;}
if(isApp){apps.push(item);}else{menuItems.push(item);}});return{apps,menuItems};}}
HomeMenuWrapper.components={HomeMenu};HomeMenuWrapper.props={menuData:Object,};HomeMenuWrapper.template="HomeMenuWrapper";return HomeMenuWrapper;});;

/* /web_enterprise/static/src/js/home_menu.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("web_enterprise.HomeMenu",function(require){"use strict";const ExpirationPanel=require("web_enterprise.ExpirationPanel");const{Component,hooks}=owl;const{useExternalListener,useState,useRef}=hooks;class HomeMenu extends Component{constructor(){super(...arguments);this.availableApps=this.props.apps;this.displayedMenuItems=[];this.inputRef=useRef('input');this.mainContentRef=useRef('mainContent');this.state=useState({displayExpirationPanel:this._shouldExpirationPanelBeDisplayed(),focusedIndex:null,isSearching:false,query:"",});if(!this.env.device.isMobile){useExternalListener(window,'keydown',this._onKeydown);}}
async willUpdateProps(){this.state.focusedIndex=null;this.state.isSearching=false;this.state.query="";this.inputRef.el.value="";this.availableApps=this.props.apps;this.displayedMenuItems=[];}
mounted(){this._updateScrollBarWidth();}
patched(){if(this.state.focusedIndex!==null&&!this.env.device.isMobile){const selectedItem=document.querySelector('.o_home_menu .o_menuitem.o_focused');if(selectedItem){selectedItem.scrollIntoView({block:'center'});}}
this._updateScrollBarWidth();}
get appIndex(){const appLength=this.displayedApps.length;const focusedIndex=this.state.focusedIndex;return focusedIndex<appLength?focusedIndex:null;}
get displayedApps(){return this.availableApps;}
get maxIconNumber(){const w=window.innerWidth;return(w<576)?3:(w<768?4:6);}
get menuIndex(){const appLength=this.displayedApps.length;const focusedIndex=this.state.focusedIndex;return focusedIndex>=appLength?focusedIndex-appLength:null;}
_shouldExpirationPanelBeDisplayed(){if(!this.env.session.warning){return false;}
const expirationDate=new moment(this.env.session.expiration_date||new moment().add(30,"d"));const diffDays=ExpirationPanel.computeDiffDays(expirationDate);const hideCookie=this.env.services.getCookie("oe_instance_hide_panel");return(diffDays<=30&&!hideCookie)||diffDays<=0;}
_filter(array){const options={extract:el=>(el.parents+" / "+el.label).split("/").reverse().join("/"),};return fuzzy.filter(this.state.query,array,options).map(el=>el.original);}
_openMenu({menu,isApp}){this.trigger(isApp?'app-clicked':'menu-clicked',{menu_id:menu.id,action_id:menu.action,});if(!isApp){this.env.bus.trigger('change_menu_section',menu.menu_id);}}
_updateFocusedIndex(cmd){const nbrApps=this.displayedApps.length;const nbrMenuItems=this.displayedMenuItems.length;const lastIndex=nbrApps+nbrMenuItems-1;let oldIndex=this.state.focusedIndex;if(lastIndex<0){return;}
if(!this.state.isSearching){if(document.activeElement.classList.contains('o_menuitem')){oldIndex=[...this.el.getElementsByClassName('o_menuitem')].indexOf(document.activeElement);}else{this.el.getElementsByClassName('o_menuitem')[0].focus();return;}}
const appIndex=this.state.isSearching?this.appIndex:oldIndex;const lastAppIndex=nbrApps-1;const appFocused=appIndex!==null;const lineNumber=Math.ceil(nbrApps/this.maxIconNumber);const currentLine=appFocused?Math.ceil((appIndex+1)/this.maxIconNumber):null;let newIndex;switch(cmd){case'previousElem':newIndex=oldIndex-1;break;case'nextElem':newIndex=oldIndex+1;break;case'previousColumn':if(!appFocused){newIndex=oldIndex;}else if(oldIndex%this.maxIconNumber){newIndex=oldIndex-1;}else{newIndex=oldIndex+Math.min(lastAppIndex-oldIndex,this.maxIconNumber-1);}
break;case'nextColumn':if(!appFocused){newIndex=oldIndex;}else if(oldIndex===lastAppIndex||(oldIndex+1)%this.maxIconNumber===0){newIndex=(currentLine-1)*this.maxIconNumber;}else{newIndex=oldIndex+1;}
break;case'previousLine':if(!appFocused){if(oldIndex>lastAppIndex+1){newIndex=oldIndex-1;}else{newIndex=(lineNumber-1)*this.maxIconNumber;}}else if(currentLine===1){if(nbrMenuItems>0){newIndex=lastIndex;}else{newIndex=oldIndex+(lineNumber-1)*this.maxIconNumber;if(newIndex>lastAppIndex){newIndex=lastAppIndex;}}}else{newIndex=oldIndex-this.maxIconNumber;}
break;case'nextLine':if(!appFocused){newIndex=oldIndex+1;}else if(currentLine===lineNumber){if(nbrMenuItems>0){newIndex=lastAppIndex+1;}else{newIndex=oldIndex%this.maxIconNumber;}}else{newIndex=oldIndex+Math.min(this.maxIconNumber,lastAppIndex-oldIndex);}
break;}
if(newIndex<0){newIndex=lastIndex;}else if(newIndex>lastIndex){newIndex=0;}
if(this.state.isSearching){this.state.focusedIndex=newIndex;}else{const item=this.el.getElementsByClassName('o_menuitem')[newIndex];item.focus();}}
_updateQuery(query){this.state.query=query;this.inputRef.el.value=this.state.query;this.state.isSearching=true;if(query===""){this.availableApps=this.props.apps;this.displayedMenuItems=[];}else{this.availableApps=this._filter(this.props.apps);this.displayedMenuItems=this._filter(this.props.menuItems);}
const total=this.displayedApps.length+this.displayedMenuItems.length;this.state.focusedIndex=total?0:null;}
_updateScrollBarWidth(){const{clientWidth,offsetWidth,style}=this.mainContentRef.el;style.paddingLeft=`${offsetWidth - clientWidth}px`;}
_onAppClick(app){this._openMenu({menu:app,isApp:true});}
_onHideExpirationPanel(){this.env.services.setCookie("oe_instance_hide_panel",true,24*60*60);this.state.displayExpirationPanel=false;}
_onInputSearch(ev){this._updateQuery(ev.target.value);}
_onKeydown(ev){const isEditable=ev.target.tagName==="INPUT"||ev.target.tagName==="TEXTAREA"||ev.target.isContentEditable;const input=this.inputRef.el;if(isEditable&&ev.target!==input){return;}
switch(ev.key){case'ArrowDown':this._updateFocusedIndex('nextLine');ev.preventDefault();break;case'ArrowRight':if(input===document.activeElement&&input.selectionEnd<this.state.query.length){return;}
this._updateFocusedIndex('nextColumn');ev.preventDefault();break;case'ArrowUp':this._updateFocusedIndex('previousLine');ev.preventDefault();break;case'ArrowLeft':if(input===document.activeElement&&input.selectionStart>0){return;}
this._updateFocusedIndex('previousColumn');ev.preventDefault();break;case'Tab':if(!this.state.isSearching){return;}
ev.preventDefault();this._updateFocusedIndex(ev.shiftKey?'previousElem':'nextElem');break;case'Enter':if(this.state.focusedIndex!==null){const isApp=this.appIndex!==null;const menu=isApp?this.displayedApps[this.appIndex]:this.displayedMenuItems[this.menuIndex];this._openMenu({menu,isApp});ev.preventDefault();}
return;case'Alt':case'AltGraph':case'Control':case'PageDown':case'PageUp':case'Shift':break;case'Escape':const currentQuery=this.state.query;this._updateQuery("");if(!currentQuery){this.state.focusedIndex=null;this.state.isSearching=false;this.trigger("hide-home-menu");}
break;case'c':case'x':if(ev.ctrlKey||ev.metaKey){break;}
default:if(document.activeElement!==input){input.focus();}}}
_onMenuitemClick(menu){this._openMenu({menu,isApp:false});}}
HomeMenu.components={ExpirationPanel};HomeMenu.props={apps:{type:Array,element:{type:Object,shape:{action:String,id:Number,label:String,parents:String,webIcon:[Boolean,String,{type:Object,optional:1,shape:{iconClass:String,color:String,backgroundColor:String,},}],webIconData:{type:String,optional:1},xmlid:String,},},},menuItems:{type:Array,element:{type:Object,shape:{action:String,id:Number,label:String,menu_id:Number,parents:String,webIcon:Boolean,xmlid:String,},},},};HomeMenu.template="HomeMenu";return HomeMenu;});;

/* /web_enterprise/static/src/js/expiration_panel.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("web_enterprise.ExpirationPanel",function(require){"use strict";const{Component,hooks}=owl;const{useState,useRef}=hooks;class ExpirationPanel extends Component{constructor(){super(...arguments);const expirationDate=new moment(this.env.session.expiration_date||new moment().add(30,"d"));const diffDays=this.constructor.computeDiffDays(expirationDate);this.state=useState({alertType:diffDays<=6?"danger":(diffDays<=16?"warning":"info"),buttonText:"Register",diffDays:diffDays,message:'register',validDate:moment(expirationDate).format("LL"),});this.inputRef=useRef('input');this.expirationReason=this.env.session.expiration_reason;this.notYetRegistered=['trial','demo',false].includes(this.expirationReason);this.mailInstalled=this.env.session.module_list.some(m=>m==="mail");this.warning=this.env.session.warning;}
mounted(){if(this.state.diffDays<=0){this.env.services.blockUI({message:this.el,css:{cursor:"auto"},overlayCSS:{cursor:"auto"},});}}
static computeDiffDays(date){const d=new moment(date);const today=new moment();const duration=moment.duration(d.diff(today));return Math.round(duration.asDays());}
_clearState(){for(const key in this.state){delete this.state[key];}}
_onHide(){this.trigger("hide-expiration-panel");}
_onClickRegister(){this.state.displayRegisterForm=!this.state.displayRegisterForm;}
async _onBuy(){const limitDate=new moment().subtract(15,"days").format("YYYY-MM-DD");const users=await this.rpc({model:"res.users",method:"search_count",args:[[["share","=",false],["login_date",">=",limitDate]]],});this.env.services.navigate("https://www.odoo.com/odoo-enterprise/upgrade",{num_users:users});}
async _onCodeSubmit(){const input=this.inputRef.el;const enterpriseCode=input.value;if(!enterpriseCode){const inputTitle=input.getAttribute("title");input.setAttribute("placeholder",inputTitle);return;}
const[oldDate,,linkedSubscriptionUrl,emailLinked]=await Promise.all([this.rpc({model:"ir.config_parameter",method:"get_param",args:["database.expiration_date"],}),this.rpc({model:"ir.config_parameter",method:"set_param",args:["database.enterprise_code",enterpriseCode],}),this.rpc({model:'ir.config_parameter',method:'get_param',args:['database.already_linked_subscription_url'],}),this.rpc({model:'ir.config_parameter',method:'get_param',args:['database.already_linked_email'],})]);this.env.services.setCookie("oe_instance_hide_panel","",-1);await this.rpc({model:"publisher_warranty.contract",method:"update_notification",args:[[]],});const expirationDate=await this.rpc({model:"ir.config_parameter",method:"get_param",args:["database.expiration_date"],});this.env.services.unblockUI();this._clearState();if(expirationDate!==oldDate&&!linkedSubscriptionUrl){this.state.message='success';this.state.displayRegisterForm=false;this.state.alertType="success";this.state.validDate=moment(expirationDate).format("LL");}else{this.state.alertType="danger";this.state.buttonText="Retry";this.state.displayRegisterForm=true;if(linkedSubscriptionUrl){this.state.message="link";this.state.linkedSubscriptionUrl=linkedSubscriptionUrl;this.state.emailDelivery=null;this.state.emailLinked=emailLinked;}else{this.state.message='error';}}}
async _onCheckStatus(){const oldDate=await this.rpc({model:"ir.config_parameter",method:"get_param",args:["database.expiration_date"],});if(this.constructor.computeDiffDays(oldDate)>=30){return;}
await this.rpc({model:"publisher_warranty.contract",method:"update_notification",args:[[]],});const expirationDate=await this.rpc({model:"ir.config_parameter",method:"get_param",args:["database.expiration_date"],});if(expirationDate!==oldDate&&new moment(expirationDate)>new moment()){this.env.services.unblockUI();this._clearState();this.state.message='update';this.state.alertType="success";this.state.validDate=moment(expirationDate).format("LL");this.state.diffDays=this.constructor.computeDiffDays(expirationDate);}else{this.env.services.reloadPage();}}
async _onSendUnlinkEmail(){const unlink_mail_send_url=await this.rpc({model:'ir.config_parameter',method:'get_param',args:['database.already_linked_send_mail_url'],});this.state.emailDelivery='ongoing';const{result,reason}=await this.env.services.ajaxJsonRPC(unlink_mail_send_url,'call',{});if(result){this.emailDelivery='success';}else{this.state.emailDelivery='fail';this.state.failReason=reason;}}
async _onRenew(){const oldDate=await this.rpc({model:"ir.config_parameter",method:"get_param",args:["database.expiration_date"],});this.env.services.setCookie("oe_instance_hide_panel","",-1);await this.rpc({model:"publisher_warranty.contract",method:"update_notification",args:[[]],});const[expirationDate,enterpriseCode]=await Promise.all([this.rpc({model:"ir.config_parameter",method:"get_param",args:["database.expiration_date"],}),this.rpc({model:"ir.config_parameter",method:"get_param",args:["database.enterprise_code"],})]);if(expirationDate!==oldDate&&new moment(expirationDate)>new moment()){this.env.services.unblockUI();this._clearState();this.state.message='success';this.state.alertType="success";this.state.validDate=moment(expirationDate).format("LL");this.state.diffDays=this.constructor.computeDiffDays(expirationDate);}else{const params=enterpriseCode?{contract:enterpriseCode}:{};this.env.services.navigate("https://www.odoo.com/odoo-enterprise/renew",params);}}
async _onUpsell(){const limitDate=new moment().subtract(15,"days").format("YYYY-MM-DD");const[enterpriseCode,users]=await Promise.all([this.rpc({model:"ir.config_parameter",method:"get_param",args:["database.enterprise_code"],}),this.rpc({model:"res.users",method:"search_count",args:[[["share","=",false],["login_date",">=",limitDate]]],})]);const params=enterpriseCode?{contract:enterpriseCode,num_users:users}:{num_users:users};this.env.services.navigate("https://www.odoo.com/odoo-enterprise/upsell",params);}}
ExpirationPanel.template="DatabaseExpirationPanel";return ExpirationPanel;});;

/* /web_enterprise/static/src/js/menu_mobile.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_enterprise.MenuMobile',function(require){"use strict";var config=require('web.config');if(!config.device.isMobile){return;}
var core=require('web.core');var session=require('web.session');var Menu=require('web_enterprise.Menu');const{SwitchCompanyMenuMobile}=require('web_enterprise.SwitchCompanyMenu');var QWeb=core.qweb;Menu.include({events:_.extend({},Menu.prototype.events,{'click .o_mobile_menu_toggle':'_onOpenBurgerMenu',}),menusTemplate:'Menu.sections.mobile',animationDuration:200,start:function(){return this._super.apply(this,arguments).then(this._renderBurgerMenu.bind(this));},destroy:function(){this.$burgerMenu.remove();this._super.apply(this,arguments);},do_action(){return this._super(...arguments).then(resp=>{this._closeBurgerMenu();return resp;});},_closeBurgerMenu:function(){var self=this;this.$burgerMenu.animate({left:'100%'},this.animationDuration,function(){self.$burgerMenu.addClass("o_hidden");});},_renderBurgerMenu:function(){this.$burgerMenu=$(QWeb.render('BurgerMenu',{session:session}));this.$burgerMenu.addClass("o_hidden");this.$('.o_user_menu_mobile').appendTo(this.$burgerMenu.find('.o_burger_menu_user'));this.$section_placeholder.appendTo(this.$burgerMenu.find('.o_burger_menu_app'));const companySwitcher=new SwitchCompanyMenuMobile();companySwitcher.appendTo('.o_burger_menu_companies');this.$burgerMenu.on('click','.o_burger_menu_close',this._onCloseBurgerMenu.bind(this));this.$burgerMenu.on('click','.o_burger_menu_topbar.o_toggler',this._onTopbarClicked.bind(this));this.$burgerMenu.on('click','.o_burger_menu_section',this._onBurgerMenuSectionClick.bind(this));core.bus.on('close_o_burger_menu',null,this._closeBurgerMenu.bind(this));$('body').append(this.$burgerMenu);},_onBurgerMenuSectionClick:function(ev){ev.preventDefault();ev.stopPropagation();var $target=$(ev.currentTarget);$target.toggleClass('show');$target.find('> a .toggle_icon').toggleClass('fa-chevron-down fa-chevron-right');},_onCloseBurgerMenu:function(ev){ev.stopPropagation();this._closeBurgerMenu();},_onOpenBurgerMenu:function(ev){ev.preventDefault();var displaySubMenus=!this.homeMenuDisplayed;if(displaySubMenus){var app=_.findWhere(this.menu_data.children,{id:this.current_primary_menu});displaySubMenus=!!(app&&app.children.length);}
this.$burgerMenu.find('.o_burger_menu_topbar').toggleClass('o_toggler',displaySubMenus);this.$burgerMenu.find('.o_burger_menu_content').toggleClass('o_burger_menu_dark',displaySubMenus);this.$burgerMenu.find('.o_burger_menu_caret').toggleClass('o_hidden',!displaySubMenus);this.$burgerMenu.find('.o_burger_menu_app').toggleClass('o_hidden',!displaySubMenus);this.$burgerMenu.find('.o_burger_menu_user').toggleClass('o_hidden',displaySubMenus);this.$burgerMenu.css({left:'100%'});this.$burgerMenu.animate({left:'0%'},this.animationDuration).removeClass('o_hidden');},_on_secondary_menu_click:function(){this._super.apply(this,arguments);this._closeBurgerMenu();},_onTopbarClicked:function(){this.$burgerMenu.find('.o_burger_menu_content').toggleClass('o_burger_menu_dark');this.$burgerMenu.find('.o_burger_menu_caret').toggleClass('dropup');this.$burgerMenu.find('.o_burger_menu_app, .o_burger_menu_user').toggleClass('o_hidden');this.$burgerMenu.find('.o_burger_menu_app .fa-chevron-down').toggleClass('fa-chevron-down fa-chevron-right');},});});;

/* /web_enterprise/static/src/js/res_config_settings.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('base.settingsMobile',function(require){"use strict";var config=require('web.config');if(!config.device.isMobile){return;}
var core=require('web.core');var BaseSetting=require('base.settings');var KanbanTabsMobileMixin=require('web.KanbanTabsMobileMixin');BaseSetting.Renderer.include(Object.assign({},KanbanTabsMobileMixin,{start:function(){var prom=this._super.apply(this,arguments);core.bus.on("DOM_updated",this,function(){this._moveToTab(this.currentIndex||this._currentAppIndex());});return prom;},on_attach_callback:function(){this._super.apply(this,arguments);this._computeTabPosition(this.modules,this.currentIndex,this.$('.settings_tab'));},_activateSettingMobileTab:function(currentTab){var self=this;var moveTo=currentTab;var next=moveTo+1;var previous=moveTo-1;this.$(".settings .app_settings_block").removeClass("previous next current before after");this.$(".settings_tab .tab").removeClass("previous next current before after");_.each(this.modules,function(module,index){var tab=self.$(".tab[data-key='"+module.key+"']");var view=module.settingView;if(index===previous){tab.addClass("previous");view.addClass("previous");}else if(index===next){tab.addClass("next");view.addClass("next");}else if(index<moveTo){tab.addClass("before");view.addClass("before");}else if(index===moveTo){tab.addClass("current");view.addClass("current");}else if(index>moveTo){tab.addClass("after");view.addClass("after");}});this._computeTabPosition(this.modules,moveTo,this.$('.settings_tab'));},_enableSwipe:function(){var self=this;this.$('.settings').swipe({swipeLeft:function(){self._moveToTab(self.currentIndex+1);},swipeRight:function(){self._moveToTab(self.currentIndex-1);}});},_getTabWidth:function(column){return this.$(".tab[data-key='"+column.key+"']").outerWidth();},_moveToTab:function(index){this._super.apply(this,arguments);if(this.currentIndex!==-1){this.activeTab.removeClass("selected");this._activateSettingMobileTab(this.currentIndex);}},_onKeyUpSearch:function(event){this.$('.settings_tab').addClass('o_hidden');this.$('.settings').addClass('d-block');this._super.apply(this,arguments);},_resetSearch:function(){this._super.apply(this,arguments);this.$('.settings_tab').removeClass('o_hidden');this.$('.settings').removeClass('d-block');},_render:function(){var self=this;return this._super.apply(this,arguments).then(function(){self._enableSwipe();});}}));var view_registry=require('web.view_registry');var BaseSettingsView=view_registry.get('base_settings');BaseSettingsView.include({init:function(){this.jsLibs.push('/web/static/lib/jquery.touchSwipe/jquery.touchSwipe.js');this._super.apply(this,arguments);},});});;

/* /web_enterprise/static/src/js/search_panel_mobile.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("web.SearchPanelMobile",function(require){"use strict";const SearchPanel=require("web/static/src/js/views/search_panel.js");const{device}=require("web.config");if(!device.isMobile){return;}
const{Portal}=owl.misc;const isFilter=(s)=>s.type==="filter";function nameOfCheckedValues(values){const names=[];for(const[_,value]of values){if(value.checked){names.push(value.display_name);}}
return names;}
SearchPanel.patch("web_enterprise.SearchPanel.Mobile",(T)=>{class SearchPanelMobile extends T{constructor(){super(...arguments);this.state.showMobileSearch=false;}
_getCategorySelection(){const activeCategories=this.model.get("sections",(s)=>s.type==="category"&&s.activeValueId);const selection=[];for(const category of activeCategories){const parentIds=this._getAncestorValueIds(category,category.activeValueId);const orderedCategoryNames=[category.activeValueId,...parentIds,].map((valueId)=>category.values.get(valueId).display_name);selection.push({values:orderedCategoryNames,icon:category.icon,color:category.color,});}
return selection;}
_getFilterSelection(){const filters=this.model.get("sections",isFilter);const selection=[];for(const{groups,values,icon,color}of filters){let filterValues;if(groups){filterValues=Object.keys(groups).map((groupId)=>nameOfCheckedValues(groups[groupId].values)).flat();}else if(values){filterValues=nameOfCheckedValues(values);}
if(filterValues.length){selection.push({values:filterValues,icon,color});}}
return selection;}}
SearchPanelMobile.components.Portal=Portal;SearchPanelMobile.template="web_enterprise.SearchPanel.Mobile";return SearchPanelMobile;});});;

/* /web_enterprise/static/src/js/control_panel.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_enterprise.ControlPanel',function(require){"use strict";const ControlPanel=require('web.ControlPanel');const{device}=require('web.config');const{Portal}=owl.misc;const{useState}=owl.hooks;const STICKY_CLASS='o_mobile_sticky';if(!device.isMobile){return;}
ControlPanel.patch('web_enterprise.ControlPanel',T=>{class ControlPanelPatchEnterprise extends T{constructor(){super(...arguments);this.state=useState({showSearchBar:false,showMobileSearch:false,showViewSwitcher:false,});}
mounted(){this.onWindowClick=this._onWindowClick.bind(this);this.onWindowScroll=this._onScrollThrottled.bind(this);window.addEventListener('click',this.onWindowClick);document.addEventListener('scroll',this.onWindowScroll);this.oldScrollTop=0;this.initialScrollTop=document.documentElement.scrollTop;this.el.style.top='0px';super.mounted();}
willUnmount(){window.removeEventListener('click',this.onWindowClick);document.removeEventListener('scroll',this.onWindowScroll);}
_getToday(){return new Date().getDate();}
_onScrollThrottled(){if(this.isScrolling){return;}
this.isScrolling=true;requestAnimationFrame(()=>this.isScrolling=false);const scrollTop=document.documentElement.scrollTop;const delta=Math.round(scrollTop-this.oldScrollTop);if(scrollTop>this.initialScrollTop){const elRect=this.el.getBoundingClientRect();this.el.classList.add(STICKY_CLASS);this.el.style.top=delta<0?`${Math.min(0, elRect.top - delta)}px`:`${Math.max(-elRect.height, elRect.top - delta)}px`;}else{this.el.classList.remove(STICKY_CLASS);}
this.oldScrollTop=scrollTop;}
_onSwitchView(){Object.assign(this.state,{showSearchBar:false,showMobileSearch:false,showViewSwitcher:false,});}
_onWindowClick(ev){if(this.state.showViewSwitcher&&!ev.target.closest('.o_cp_switch_buttons')){this.state.showViewSwitcher=false;}}}
ControlPanelPatchEnterprise.components.Portal=Portal;ControlPanelPatchEnterprise.template='web_enterprise.ControlPanel';return ControlPanelPatchEnterprise;});});;

/* /web_enterprise/static/src/js/swipe_item_mixin.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_enterprise.SwipeItemMixin',function(){const ANIMATION_SWIPE_DURATION=250;const SWIPE_ACTIVATION_THRESHOLD=15;const SWIPE_ITEM_DATA_KEY='swipe_item';const ACTION_DIRECTION=Object.freeze({LEFT:'left',RIGHT:'right',NONE:false});const SWIPE_AXES=Object.freeze({HORIZONTAL:'horizontal',VERTICAL:'vertical',NONE:false});return{events:{'touchstart .o_swipe_item':'_onTouchStart','touchmove .o_swipe_item':'_onTouchMove','touchend .o_swipe_item':'_onTouchEnd',},init(options){this.actions=options.actions;this.selectorTarget=options.selectorTarget;},addClassesToTarget(){this.$(this.selectorTarget).addClass('o_swipe_item');},_addSwipeElement(target){target.classList.add('o_swipe_current');target.parentElement.classList.add('overflow-hidden');$('<div/>').addClass('o_swipe_separator').prependTo(target);for(const[key,value]of Object.entries(this.actions)){$('<div/>').addClass(['o_swipe_action',key]).append($('<span/>').addClass(value.classesImage)).prependTo(target);this._setSwipeData(target,'actionThreshold',{[key]:this._calculateActionThreshold(target,key)});}},_allowSwipe(ev,action){if(this.actions[action]&&this.actions[action].allowSwipe){return this.actions[action].allowSwipe(ev);}
return false;},_calculateActionThreshold(targetElement,swipeDirection){const iconElement=targetElement.querySelector(`.o_swipe_action.${swipeDirection} .fa`);const iconParentElement=iconElement.parentElement;return parseFloat(getComputedStyle(iconElement).width)+(2*parseFloat(getComputedStyle(iconParentElement).paddingLeft));},_getMaxPosition(swipeDirection){if(swipeDirection===ACTION_DIRECTION.LEFT){return'-100%';}else if(swipeDirection===ACTION_DIRECTION.RIGHT){return'100%';}},_getSwipeActionElement(target,action){if(action){return target.querySelector(`.o_swipe_action.${action}`);}
return target.querySelector(`.o_swipe_action`);},_getSwipeAxes(touchDelta){if(Math.abs(touchDelta.yDelta)>SWIPE_ACTIVATION_THRESHOLD){return SWIPE_AXES.VERTICAL;}else if(Math.abs(touchDelta.xDelta)>SWIPE_ACTIVATION_THRESHOLD){return SWIPE_AXES.HORIZONTAL;}
return SWIPE_AXES.NONE;},_getSwipeData(target,key){return $(target).data(SWIPE_ITEM_DATA_KEY)[key];},_getSwipeDirection(touchDelta){if(touchDelta.xDelta>0){return ACTION_DIRECTION.RIGHT;}else if(touchDelta.xDelta<0){return ACTION_DIRECTION.LEFT;}
return ACTION_DIRECTION.NONE;},_getTouchDelta(event,target){const touch=this._getTouchPosition(event);const touchStart=this._getSwipeData(target,'touchStart');return{xDelta:touch.x-touchStart.x+this._getSwipeData(target,'startLeft'),yDelta:touch.y-touchStart.y};},_getTouchPosition(event){return{x:event.changedTouches[0].clientX,y:event.changedTouches[0].clientY};},_isThresholdReach(target,touchDelta,swipeDirection){if(Math.abs(touchDelta.xDelta)<this._getSwipeData(target,'actionThreshold')[swipeDirection]){return false;}
return swipeDirection;},_moveElementAndActionWithAnimation(target,swipeDirection,toPosition,unit='px'){return this._moveWithAnimation(target,toPosition,{step:(now)=>this._updateSwipeActionPosition(target,swipeDirection,-now,unit)});},_moveWithAnimation(element,left,customOptions={}){return $(element).animate({left:left,},Object.assign({},{duration:ANIMATION_SWIPE_DURATION,},customOptions)).promise();},_performSwipeEndAction(ev,callback,restore=()=>{}){if(callback){callback(ev,restore);}},async _restoreDOMLikeBeforeSwipe(target){await this._moveElementAndActionWithAnimation(target,null,0);$(target).find('.o_swipe_action, .o_swipe_separator').remove();target.classList.remove('o_swipe_current');target.parentElement.classList.remove('overflow-hidden');this._setSwipeData(target,'swipeDirection',false);this._setSwipeData(target,'swipeAxes',false);},_setSwipeData(target,key,value){const tmpData=$(target).data(SWIPE_ITEM_DATA_KEY);if(typeof tmpData[key]==='object'){Object.assign(tmpData[key],value);}else{tmpData[key]=value;}
$(target).data(SWIPE_ITEM_DATA_KEY,tmpData);},_updateSwipeActionElement(target,action,xDelta){const actionOptions=this.actions[action];if(actionOptions){const swipeActionElement=this._getSwipeActionElement(target,action);const max=this._getSwipeData(target,'actionThreshold')[action];swipeActionElement.classList.add(actionOptions.backgroundClassColor);swipeActionElement.style.opacity=Math.abs(xDelta/max);}},_updateSwipeActionPosition(target,swipeDirection,left,unit='px'){const swipeActionElement=this._getSwipeActionElement(target,swipeDirection);if(swipeActionElement){swipeActionElement.style.left=`${left}${unit}`;}},_updateSwipePosition(target,swipeDirection,left){target.style.left=`${left}px`;this._updateSwipeActionPosition(target,swipeDirection,-left);},_onTouchStart(ev){const target=ev.currentTarget;if(!target.matches(this.selectorTarget)){return;}
$(target).data(SWIPE_ITEM_DATA_KEY,{touchStart:this._getTouchPosition(ev),startLeft:$(target).css('left')==='auto'?0:parseInt($(target).css('left'),10),swipeDirection:false,swipeAxes:false,actionThreshold:{},});},_onTouchMove(ev){const target=ev.currentTarget;if(!target.matches(this.selectorTarget)){return;}
const touchDelta=this._getTouchDelta(ev,target);const swipeDirection=this._getSwipeDirection(touchDelta);if(this._getSwipeData(target,'swipeAxes')===false){this._setSwipeData(target,'swipeAxes',this._getSwipeAxes(touchDelta));}
if(this._getSwipeData(target,'swipeAxes')!==SWIPE_AXES.HORIZONTAL){return;}
ev.preventDefault();const allowSwipe=this._allowSwipe(ev,swipeDirection);if(!target.classList.contains('o_swipe_current')&&allowSwipe){this._addSwipeElement(target);}
if(allowSwipe){this._setSwipeData(target,'swipeDirection',swipeDirection);}else{if(!(this._getSwipeData(target,'swipeDirection')&&this._getSwipeData(target,'swipeDirection')===swipeDirection)){this._updateSwipePosition(target,swipeDirection,0);}
return;}
this._updateSwipePosition(target,swipeDirection,touchDelta.xDelta);this._updateSwipeActionElement(target,swipeDirection,touchDelta.xDelta);},async _onTouchEnd(ev){const target=ev.currentTarget;if(!target.matches(this.selectorTarget)){return;}
const touchDelta=this._getTouchDelta(ev,target);const swipeDirection=this._getSwipeDirection(touchDelta);if(this._getSwipeData(target,'swipeAxes')!==SWIPE_AXES.HORIZONTAL){return;}
ev.preventDefault();if(!this._allowSwipe(ev,swipeDirection)){this._restoreDOMLikeBeforeSwipe(target);return;}
const swipeDirectionWithThresholdReach=this._isThresholdReach(target,touchDelta,swipeDirection);const action=this.actions[swipeDirectionWithThresholdReach];if(action){if(swipeDirectionWithThresholdReach){await this._moveElementAndActionWithAnimation(target,swipeDirectionWithThresholdReach,this._getMaxPosition(swipeDirectionWithThresholdReach),'%');}
if(!(action.avoidRestorePositionElement&&action.avoidRestorePositionElement(swipeDirection,target,ev))){await this._moveElementAndActionWithAnimation(target,swipeDirectionWithThresholdReach,0);}
this._performSwipeEndAction(ev,action.actionCallback,()=>{target.style.left=0;});}
this._restoreDOMLikeBeforeSwipe(target);},};});;

/* /web_enterprise/static/src/js/tour_disable_mobile.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_enterprise.DisableTour',function(require){"use strict";var config=require('web.config');if(!config.device.isMobile){return;}
var TourManager=require('web_tour.TourManager');TourManager.include({_register:function(do_update,tour,name){if(!this.running_tour){this.consumed_tours.push(name);}
return this._super.apply(this,arguments);},});});;

/* /web_enterprise/static/src/js/core/dialog.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("web_enterprise.Dialog",function(require){"use strict";const config=require("web.config");if(!config.device.isMobile){return;}
const Dialog=require("web.Dialog");Dialog.include({init(parent,{headerButtons}){this._super.apply(this,arguments);this.headerButtons=headerButtons||[];},async willStart(){const prom=await this._super.apply(this,arguments);if(this.renderHeader&&this.fullscreen){const $modalHeader=this.$modal.find(".modal-header");$modalHeader.find("button.close").remove();const $navigationBtn=$("<button>",{class:"btn fa fa-arrow-left","data-dismiss":"modal","aria-label":"close",});$modalHeader.prepend($navigationBtn);const $btnContainer=$("<div>");this._setButtonsTo($btnContainer,this.headerButtons);$modalHeader.append($btnContainer);}
return prom;},});});;

/* /web_enterprise/static/src/js/views/basic/basic_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_enterprise.BasicRenderer',function(require){"use strict";const config=require('web.config');if(!config.device.isMobile){return;}
const BasicRenderer=require('web.BasicRenderer');BasicRenderer.include({SHOW_AFTER_DELAY:250,showTimer:undefined,tooltipNodes:[],on_attach_callback(){this._super(...arguments);this._addListener();},on_detach_callback(){this._removeListeners();this._super(...arguments);},_addListener:function(){this.tooltipNodes.forEach((nodeElement)=>{nodeElement.addEventListener('touchstart',this._onTouchStart);nodeElement.addEventListener('touchend',this._onTouchEnd);nodeElement.classList.add('o_user_select_none');});},_addFieldTooltip:function(widget,$node){this._super(...arguments);$node=$node.length?$node:widget.$el;const nodeElement=$node[0];if(!this.tooltipNodes.some(node=>node===nodeElement)){this.tooltipNodes.push(nodeElement);}},_getTooltipOptions:function(){return Object.assign({},this._super(...arguments),{trigger:'manual',});},_render:function(){return this._super(...arguments).then(()=>{this._addListener();});},_removeListeners:function(){while(this.tooltipNodes.length){const node=this.tooltipNodes.shift();node.removeEventListener('touchstart',this._onTouchStart);node.removeEventListener('touchend',this._onTouchEnd);node.classList.remove('o_user_select_none');}},_onTouchEnd:function(event){clearTimeout(this.showTimer);const $node=$(event.target);$node.tooltip('hide');},_onTouchStart:function(event){const $node=$(event.target);this.showTimer=setTimeout(()=>{$node.tooltip('show');},this.SHOW_AFTER_DELAY);},});});;

/* /web_enterprise/static/src/js/views/calendar/calendar_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_enterprise.CalendarController',function(require){"use strict";const config=require('web.config');if(!config.device.isMobile){return;}
const CalendarController=require('web.CalendarController');CalendarController.include({custom_events:_.extend({},CalendarController.prototype.custom_events,{today_button_click:'_onTodayButtonClicked',}),_onTodayButtonClicked:function(){this._move('today');},_renderButtonsParameters:function(){return _.extend({},this._super.apply(this,arguments),{isMobile:config.device.isMobile,});},});});;

/* /web_enterprise/static/src/js/views/calendar/calendar_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_enterprise.CalendarRenderer',function(require){"use strict";const config=require('web.config');if(!config.device.isMobile){return;}
const{qweb}=require('web.core');const CalendarRenderer=require('web.CalendarRenderer');CalendarRenderer.include({events:_.extend({},CalendarRenderer.events,{'click .o_other_calendar_panel':'_toggleSidePanel',}),init:function(parent,state,params){this._super.apply(this,arguments);this.isSwipeEnabled=true;this.isSidePanelVisible=false;this.filtersMobile=[];},on_attach_callback:function(){this.$el.height($(window).height()-this.$el.offset().top);this._super(...arguments);},start:function(){const promise=this._super();this._bindSwipe();return promise;},_bindSwipe:function(){const self=this;let touchStartX;let touchEndX;this.calendarElement.addEventListener('touchstart',function(event){self.isSwipeEnabled=true;touchStartX=event.touches[0].pageX;});this.calendarElement.addEventListener('touchend',function(event){if(!self.isSwipeEnabled){return;}
touchEndX=event.changedTouches[0].pageX;if(touchStartX-touchEndX>100){self.trigger_up('next');}else if(touchStartX-touchEndX<-100){self.trigger_up('prev');}});},_getFilters:function(){const filters=this.state.filters;return Object.keys(filters).filter(key=>filters[key].filters).map(key=>({label:filters[key].title,values:this._prepareDataFilterForQWeb(filters[key].filters),countItems:filters[key].filters.length,}));},_getFullCalendarOptions:function(){const oldOptions=this._super(...arguments);oldOptions.views.dayGridMonth.columnHeaderFormat='ddd';oldOptions.weekNumbersWithinDays=false;oldOptions.views.dayGridMonth.weekLabel='';return oldOptions;},_getPopoverParams:function(eventData){const popoverParameters=this._super.apply(this,arguments);popoverParameters.container='body';return popoverParameters;},_initCalendar:function(){const self=this;this._super.apply(this,arguments);const oldEventDragStart=this.calendar.getOption('eventDragStart');const oldEventPositioned=this.calendar.getOption('eventPositioned');const oldEventRender=this.calendar.getOption('eventRender');const oldEventResize=this.calendar.getOption('eventResize');const oldEventResizeStart=this.calendar.getOption('eventResizeStart');const oldSelectAllow=this.calendar.getOption('selectAllow');this.calendar.setOption('eventDragStart',function(info){self.isSwipeEnabled=false;if(oldEventDragStart){oldEventDragStart(info);}});this.calendar.setOption('eventPositioned',function(info){self.isSwipeEnabled=false;if(oldEventPositioned){oldEventPositioned(info);}});this.calendar.setOption('eventRender',function(info){self.isSwipeEnabled=false;if(oldEventRender){oldEventRender(info);}});this.calendar.setOption('eventResize',function(eventResizeInfo){self.isSwipeEnabled=false;if(oldEventResize){oldEventResize(eventResizeInfo);}});this.calendar.setOption('eventResizeStart',function(mouseResizeInfo){self.isSwipeEnabled=false;if(oldEventResizeStart){oldEventResizeStart(mouseResizeInfo);}});this.calendar.setOption('selectAllow',function(selectInfo){self.isSwipeEnabled=false;if(oldSelectAllow){return oldSelectAllow(selectInfo);}
return true;});},_onPopoverShown:function($popoverElement,calendarPopover){this._super.apply(this,arguments);const $popover=$($popoverElement.data('bs.popover').tip);setTimeout(()=>{$popover.toggleClass(['bs-popover-left','bs-popover-right',],false);$popover.find('.arrow').remove();$popover.css({display:'flex',bottom:0,right:0,borderWidth:0,maxWidth:'100%',transform:'translate3d(0px, 0px, 0px)',});$popover.find('.o_cw_body').css({display:'flex',flex:'1 0 auto',flexDirection:'column',});$popover.find('.o_cw_popover_fields_secondary').toggleClass('o_cw_popover_fields_secondary',false).css({flexGrow:1,});$popover.on('touchmove',(event)=>{event.preventDefault();});$popover.on('mousewheel',(event)=>{event.preventDefault();});$popover.on('wheel',(event)=>{event.preventDefault();});$popover.find('a.o_field_widget[href]').on('click',(event)=>{$('.o_cw_popover').popover('dispose');});},0);},_prepareDataFilterForQWeb:function(array){const self=this;return array.filter(element=>element.active).map(function(element){return Object.assign({},element,{color:self.getColor(element.color_index),});});},async _renderView(){return this._super(...arguments).then(()=>{this.$('.o_calendar_mini').toggleClass('d-none',true);this._renderOtherCalendar();});},_renderFilters:function(){return this._super(...arguments).then(()=>{this.filtersMobile=this._getFilters();const reduce=!!this.filtersMobile.reduce((visible,filter)=>visible|(filter.countItems>0),false);this.$('.o_calendar_sidebar .o_view_nocontent').toggleClass('d-none',reduce);});},_renderOtherCalendar:function(){this.$('.o_other_calendar_panel').remove();this.otherCalendarMobile=$(qweb.render('CalendarView.OtherCalendarMobile',{filters:this.filtersMobile,isSidePanelVisible:this.isSidePanelVisible,}));this.$el.prepend(this.otherCalendarMobile);},_toggleSidePanel:async function(){this.isSidePanelVisible=!this.isSidePanelVisible;this.$('.o_calendar_view').toggleClass('d-none',this.isSidePanelVisible);this.$('.o_calendar_sidebar_container').toggleClass('d-none',!this.isSidePanelVisible);this._renderOtherCalendar();},_unselectEvent:function(){this._super.apply(this,arguments);$('.o_cw_popover').popover('dispose');},});});;

/* /web_enterprise/static/src/js/views/kanban/kanban_column.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.KanbanColumnMobile',function(require){"use strict";const config=require('web.config');if(!config.device.isMobile){return;}
const KanbanColumn=require('web.KanbanColumn');KanbanColumn.include({init(){this._super(...arguments);this.recordsDraggable=false;this.canBeFolded=false;},});});;

/* /web_enterprise/static/src/js/views/kanban/kanban_column_quick_create.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_enterprise.kanban_column_quick_create',function(require){"use strict";const config=require('web.config');if(!config.device.isMobile){return;}
const KanbanRenderer=require('web.kanban_column_quick_create');KanbanRenderer.include({init(){this._super(...arguments);this.isMobile=true;},_cancel(){if(!this.folded){this.$input.val('');}},});});;

/* /web_enterprise/static/src/js/views/kanban/kanban_renderer_mobile.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.KanbanRendererMobile',function(require){"use strict";var config=require('web.config');if(!config.device.isMobile){return;}
var core=require('web.core');var KanbanRenderer=require('web.KanbanRenderer');var KanbanTabsMobileMixin=require('web.KanbanTabsMobileMixin');var _t=core._t;var qweb=core.qweb;KanbanRenderer.include(Object.assign({},KanbanTabsMobileMixin,{custom_events:_.extend({},KanbanRenderer.prototype.custom_events||{},{quick_create_column_created:'_onColumnAdded',}),events:_.extend({},KanbanRenderer.prototype.events,{'click .o_kanban_mobile_tab':'_onMobileTabClicked','click .o_kanban_mobile_add_column':'_onMobileQuickCreateClicked',}),ANIMATE:true,init:function(){this._super.apply(this,arguments);this.activeColumnIndex=0;this._lastGroupedByField=null;this._scrollPosition=null;},on_attach_callback:function(){if(this._scrollPosition&&this.state.groupedBy.length&&this.widgets.length){var $column=this.widgets[this.activeColumnIndex].$el;$column.scrollLeft(this._scrollPosition.left);$column.scrollTop(this._scrollPosition.top);}
this._computeTabPosition(this.widgets,this.activeColumnIndex,this.$('.o_kanban_mobile_tabs'));this._super.apply(this,arguments);},on_detach_callback:function(){if(this.state.groupedBy.length&&this.widgets.length){var $column=this.widgets[this.activeColumnIndex].$el;this._scrollPosition={left:$column.scrollLeft(),top:$column.scrollTop(),};}else{this._scrollPosition=null;}
this._super.apply(this,arguments);},addQuickCreate:function(){if(this._canCreateColumn()&&!this.quickCreate.folded){this._onMobileQuickCreateClicked();}
return this.widgets[this.activeColumnIndex].addQuickCreate();},updateColumn:function(localID){var index=_.findIndex(this.widgets,{db_id:localID});var $column=this.widgets[index].$el;var scrollTop=$column.scrollTop();return this._super.apply(this,arguments).then(()=>this._layoutUpdate(false)).then(()=>$column.scrollTop(scrollTop));},_canCreateColumn:function(){return this.quickCreateEnabled&&this.quickCreate&&this.widgets.length;},_computeColumnPosition:function(animate){if(this.widgets.length){const rtl=_t.database.parameters.direction==='rtl';this.$('.o_kanban_group').show();const $columnAfter=this._toNode(this.widgets.filter((widget,index)=>index>this.activeColumnIndex));const promiseAfter=this._updateColumnCss($columnAfter,rtl?{right:'100%'}:{left:'100%'},animate);const $columnBefore=this._toNode(this.widgets.filter((widget,index)=>index<this.activeColumnIndex));const promiseBefore=this._updateColumnCss($columnBefore,rtl?{right:'-100%'}:{left:'-100%'},animate);const $columnCurrent=this._toNode(this.widgets.filter((widget,index)=>index===this.activeColumnIndex));const promiseCurrent=this._updateColumnCss($columnCurrent,rtl?{right:'0%'}:{left:'0%'},animate);promiseAfter.then(promiseBefore).then(promiseCurrent).then(()=>{$columnAfter.hide();$columnBefore.hide();});}},_computeCurrentColumn:function(){if(this.widgets.length){var column=this.widgets[this.activeColumnIndex];if(!column){return;}
var columnID=column.id||column.db_id;this.$('.o_kanban_mobile_tab.o_current, .o_kanban_group.o_current').removeClass('o_current');this.$('.o_kanban_group[data-id="'+columnID+'"], '+'.o_kanban_mobile_tab[data-id="'+columnID+'"]').addClass('o_current');}},_enableSwipe:function(){var self=this;var step=_t.database.parameters.direction==='rtl'?-1:1;this.$el.swipe({excludedElements:".o_kanban_mobile_tabs",swipeLeft:function(){var moveToIndex=self.activeColumnIndex+step;if(moveToIndex<self.widgets.length){self._moveToGroup(moveToIndex,self.ANIMATE);}},swipeRight:function(){var moveToIndex=self.activeColumnIndex-step;if(moveToIndex>-1){self._moveToGroup(moveToIndex,self.ANIMATE);}}});},_getTabWidth:function(column){var columnID=column.id||column.db_id;return this.$('.o_kanban_mobile_tab[data-id="'+columnID+'"]').outerWidth();},_layoutUpdate:function(animate){this._computeCurrentColumn();this._computeTabPosition(this.widgets,this.activeColumnIndex,this.$('.o_kanban_mobile_tabs'));this._computeColumnPosition(animate);},_moveToGroup:function(moveToIndex,animate){if(moveToIndex<0||moveToIndex>=this.widgets.length){this._layoutUpdate(animate);return Promise.resolve();}
this.activeColumnIndex=moveToIndex;this._lastGroupedByField=this.columnOptions.groupedBy;var column=this.widgets[this.activeColumnIndex];if(column.data.isOpen){this._layoutUpdate(animate);}else{this.trigger_up('column_toggle_fold',{db_id:column.db_id,onSuccess:()=>this._layoutUpdate(animate)});}
this._enableSwipe();return Promise.resolve();},_renderExampleBackground:function(){},_renderGrouped:function(fragment){var self=this;var newFragment=document.createDocumentFragment();this._super.apply(this,[newFragment]);this.defs.push(Promise.all(this.defs).then(function(){var data=[];_.each(self.state.data,function(group){if(!group.value){group=_.extend({},group,{value:_t('Undefined')});data.unshift(group);}else{data.push(group);}});var kanbanColumnContainer=document.createElement('div');kanbanColumnContainer.classList.add('o_kanban_columns_content');kanbanColumnContainer.appendChild(newFragment);fragment.appendChild(kanbanColumnContainer);$(qweb.render('KanbanView.MobileTabs',{data:data,quickCreateEnabled:self._canCreateColumn()})).prependTo(fragment);}));},_renderView:function(){var self=this;return this._super.apply(this,arguments).then(function(){if(self.state.groupedBy.length){if(self._lastGroupedByField!==self.columnOptions.groupedBy){self.activeColumnIndex=0;}
return self._moveToGroup(self.activeColumnIndex);}else{if(self._canCreateColumn()){self._onMobileQuickCreateClicked();}
return Promise.resolve();}});},_toNode:function(widgets){const selectorCss=widgets.map(widget=>'.o_kanban_group[data-id="'+(widget.id||widget.db_id)+'"]').join(', ');return this.$(selectorCss);},_updateColumnCss:function($column,cssProperties,animate){if(animate){return new Promise(resolve=>$column.animate(cssProperties,'fast',resolve));}else{$column.css(cssProperties);return Promise.resolve();}},_onColumnAdded:function(){this._computeTabPosition(this.widgets,this.activeColumnIndex,this.$('.o_kanban_mobile_tabs'));if(this._canCreateColumn()&&!this.quickCreate.folded){this.quickCreate.toggleFold();}},_onMobileQuickCreateClicked:function(){this.$('.o_kanban_group').toggle();this.quickCreate.toggleFold();},_onMobileTabClicked:function(event){if(this._canCreateColumn()&&!this.quickCreate.folded){this.quickCreate.toggleFold();}
this._moveToGroup($(event.currentTarget).index(),true);},}));});;

/* /web_enterprise/static/src/js/views/kanban/kanban_tabs_mobile_mixin.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.KanbanTabsMobileMixin',function(){"use strict";const KanbanTabsMobileMixin={_computeTabPosition(tabs,moveToIndex,$tabsContainer){this._computeTabJustification(tabs,$tabsContainer);this._computeTabScrollPosition(tabs,moveToIndex,$tabsContainer);},_computeTabScrollPosition(tabs,moveToIndex,$tabsContainer){if(tabs.length){const lastItemIndex=tabs.length-1;let scrollToLeft=0;for(let i=0;i<moveToIndex;i++){const columnWidth=this._getTabWidth(tabs[i]);if(moveToIndex!==lastItemIndex&&i===moveToIndex-1){const partialWidth=0.75;scrollToLeft+=columnWidth*partialWidth;}else{scrollToLeft+=columnWidth;}}
$tabsContainer.scrollLeft(scrollToLeft);}},_computeTabJustification(tabs,$tabsContainer){if(tabs.length){const widthChilds=tabs.reduce((total,column)=>total+this._getTabWidth(column),0);$tabsContainer.toggleClass('justify-content-between',$tabsContainer.outerWidth()>=widthChilds);}},_getTabWidth(tab){}};return KanbanTabsMobileMixin;});;

/* /web_enterprise/static/src/js/views/kanban/kanban_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.KanbanViewMobile',function(require){"use strict";const config=require('web.config');if(!config.device.isMobile){return;}
const KanbanView=require('web.KanbanView');KanbanView.include({init(){this._super(...arguments);this.jsLibs.push('/web/static/lib/jquery.touchSwipe/jquery.touchSwipe.js');},});});;

/* /web_enterprise/static/src/js/views/list_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_enterprise.ListControllerMobile',function(require){"use strict";const config=require('web.config');if(!config.device.isMobile){return;}
const ListController=require('web.ListController');ListController.include({renderButtons(){this._super(...arguments);this.$buttons.find('.o_list_export_xlsx').hide();},updateButtons(){this._super(...arguments);this.$buttons.find('.o_list_export_xlsx').hide();},_updateSelectionBox(){this._super(...arguments);const displayBanner=Boolean(this.$selectionBox);if(displayBanner){const banner=this.$selectionBox[0];this.renderer.el.prepend(banner);banner.style.width=`${document.documentElement.offsetWidth}px`;}
this.renderer.el.classList.toggle('o_renderer_selection_banner',displayBanner);},});});;

/* /web_enterprise/static/src/js/views/form_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_enterprise.MobileFormRenderer',function(require){"use strict";const config=require('web.config');if(!config.device.isMobile){return;}
const core=require('web.core');const FormRenderer=require('web.FormRenderer');const qweb=core.qweb;FormRenderer.include({_renderStatusbarButtons:function(buttons){const $visibleButtons=buttons.filter(button=>{return!($(button).hasClass('o_invisible_modifier')||(this.mode==='edit'&&$(button).hasClass('oe_read_only')));});if($visibleButtons.length>1){const $statusbarButtonsDropdown=$(qweb.render('StatusbarButtonsDropdown'));const $dropdownMenu=$statusbarButtonsDropdown.find('.dropdown-menu');buttons.forEach(button=>{const dropdownButton=$(button).addClass('dropdown-item');return $dropdownMenu.append(dropdownButton);});return $statusbarButtonsDropdown;}
buttons.forEach(button=>$(button).removeClass('dropdown-item'));return this._super.apply(this,arguments);},_updateAllModifiers:function(){return this._super.apply(this,arguments).then(()=>{const $statusbarButtonsContainer=this.$('.o_statusbar_buttons');const $statusbarButtons=$statusbarButtonsContainer.find('button.btn').toArray();$statusbarButtonsContainer.replaceWith(this._renderStatusbarButtons($statusbarButtons));});},});});;

/* /web_enterprise/static/src/js/views/relational_fields.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_enterprise.relational_fields',function(require){"use strict";var config=require('web.config');if(!config.device.isMobile){return;}
var core=require('web.core');var relational_fields=require('web.relational_fields');var FieldStatus=relational_fields.FieldStatus;var FieldMany2One=relational_fields.FieldMany2One;var FieldX2Many=relational_fields.FieldX2Many;var qweb=core.qweb;var _t=core._t;FieldStatus.include({isEmpty:function(){return!this.isSet();},_render:function(){this.$el.html(qweb.render("FieldStatus.content.mobile",{selection:this.status_information,status:_.findWhere(this.status_information,{selected:true}),clickable:this.isClickable,}));},});FieldMany2One.include({start:function(){var superRes=this._super.apply(this,arguments);this.$input.prop('readonly',true);return superRes;},_bindAutoComplete:function(){},_getSearchCreatePopupOptions:function(){var self=this;var searchCreatePopupOptions=this._super.apply(this,arguments);_.extend(searchCreatePopupOptions,{selectionMode:true,on_clear:function(){self.reinitialize(false);},});return searchCreatePopupOptions;},_search:function(search_val){var self=this;var def=new Promise(function(resolve,reject){var context=self.record.getContext(self.recordParams);var domain=self.record.getDomain(self.recordParams);_.extend(context,self.additionalContext);var blacklisted_ids=self._getSearchBlacklist();if(blacklisted_ids.length>0){domain.push(['id','not in',blacklisted_ids]);}
var prom;if(search_val){prom=self._rpc({model:self.field.relation,method:'name_search',kwargs:{name:search_val,args:domain,operator:"ilike",limit:self.SEARCH_MORE_LIMIT,context:context,},});}
Promise.resolve(prom).then(function(results){var dynamicFilters;if(results){var ids=_.map(results,function(x){return x[0];});dynamicFilters=[{description:_.str.sprintf(_t('Quick search: %s'),search_val),domain:[['id','in',ids]],}];}
self._searchCreatePopup("search",false,{},dynamicFilters);});});this.orderer.add(def);return def;},_onInputClick:function(){return this._search();},});FieldX2Many.include({_renderButtons:function(){var result=this._super.apply(this,arguments);if(this.$buttons){this.$buttons.find('.btn-secondary').removeClass('btn-secondary').addClass('btn-primary btn-add-record');}
return result;}});});;

/* /web_enterprise/static/src/js/views/upgrade_fields.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_enterprise.upgrade_widgets',function(require){"use strict";var basic_fields=require('web.basic_fields');var field_registry=require('web.field_registry');var relational_fields=require('web.relational_fields');var UpgradeBoolean=basic_fields.FieldBoolean.extend({renderWithLabel:function(){},});var UpgradeRadio=relational_fields.FieldRadio.extend({});field_registry.add('upgrade_boolean',UpgradeBoolean).add('upgrade_radio',UpgradeRadio);});;

/* /web_enterprise/static/src/js/views/view_dialogs.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_enterprise.view_dialogs',function(require){"use strict";var config=require('web.config');if(!config.device.isMobile){return;}
var core=require('web.core');var view_dialogs=require('web.view_dialogs');var _t=core._t;view_dialogs.FormViewDialog.include({init(parent,options){options.headerButtons=options.headerButtons||[];this._super.apply(this,arguments);},_setRemoveButtonOption(options,btnClasses){options.headerButtons.push({text:_t("Remove"),classes:`btn-secondary ${btnClasses}`,click:async()=>{await this._remove();this.close();},});},});view_dialogs.SelectCreateDialog.include({init:function(){this._super.apply(this,arguments);this.on_clear=this.options.on_clear||(function(){});this.viewType='kanban';},_prepareButtons:function(){this._super.apply(this,arguments);if(this.options.disable_multiple_selection){if(this.options.selectionMode){this.headerButtons.push({text:_t("Clear"),classes:'btn-secondary o_clear_button',close:true,click:function(){this.on_clear();},});}}else{this.__buttons=this.__buttons.filter(button=>!button.classes.split(' ').includes('o_select_button'));}},});});;

/* /web_enterprise/static/src/js/widgets/debug_manager.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_enterprise.DebugManager',function(require){"use strict";var config=require('web.config');var WebClient=require('web.WebClient');if(config.isDebug()){WebClient.include({start:function(){var self=this;return this._super.apply(this,arguments).then(function(){var toggleHomeMenu=self.toggleHomeMenu;self.toggleHomeMenu=function(display){var action,controller;if(!display){action=self.action_manager.getCurrentAction();controller=self.action_manager.getCurrentController();}
self.update_debug_manager(action,controller);toggleHomeMenu.apply(self,arguments);};});},instanciate_menu_widgets:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.systray_menu=self.menu.systray_menu;});},});}});;

/* /web_enterprise/static/src/js/widgets/user_menu.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_enterprise.UserMenu',function(require){"use strict";var config=require('web.config');var core=require('web.core');var Dialog=require('web.Dialog');var UserMenu=require('web.UserMenu');var _t=core._t;var QWeb=core.qweb;UserMenu.include({init:function(){this._super.apply(this,arguments);if(config.device.isMobile){this.className='o_user_menu_mobile';this.tagName='ul';this.template=undefined;}},start:function(){if(config.device.isMobile){this.$el.append(QWeb.render('UserMenu.Actions'));}
return this._super.apply(this,arguments);},do_action(){return this._super(...arguments).then(resp=>{core.bus.trigger('close_o_burger_menu');return resp;});},_onMenuSupport:function(){window.open('https://www.odoo.com/help','_blank');},});});;

/* /web_enterprise/static/src/js/widgets/snackbar.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_enterprise.SnackBar',function(require){'use strict';var config=require('web.config');if(!config.device.isMobile){return;}
const Widget=require('web.Widget');const SnackBar=Widget.extend({template:'SnackBar',events:{'click .o_snackbar_button':'_onClickButton'},init(parent,options){this._super(...arguments);this.message=options.message||'';this.delay=options.delay||1000;this.onComplete=options.onComplete;this.actionText=options.actionText||'';this.onActionClick=options.onActionClick;this._timeout=false;},_delayedAction(){if(this.onComplete){this.onComplete();}
this.destroy();},_onClickButton(ev){ev.preventDefault();ev.stopPropagation();if(this.onActionClick){this.onActionClick();}
if(this._timeout){clearTimeout(this._timeout);}
this.destroy();},dismiss(){this.destroy();},show(){this.appendTo($('body'));const hasValidDelay=this.delay>-1;if(hasValidDelay){this._timeout=setTimeout(()=>this._delayedAction(),this.delay);}},});return SnackBar;});;

/* /web_enterprise/static/src/js/widgets/switch_company_menu.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_enterprise.SwitchCompanyMenu',function(require){"use strict";var config=require('web.config');if(!config.device.isMobile){return;}
var SwitchCompanyMenu=require('web.SwitchCompanyMenu');var SystrayMenu=require('web.SystrayMenu');if(config.device.isMobile){var index=SystrayMenu.Items.indexOf(SwitchCompanyMenu);if(index>=0){SystrayMenu.Items.splice(index,1);}}
const SwitchCompanyMenuMobile=SwitchCompanyMenu.extend({template:'MobileCompanySwitcher',events:Object.assign({},SwitchCompanyMenu.prototype.events,{'click .log_into':'_onSwitchCompanyClick','click .toggle_company':'_onToggleCompanyClick',}),});return{SwitchCompanyMenuMobile:SwitchCompanyMenuMobile,};});;

/* /web_gantt/static/src/js/gantt_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_gantt.GanttRenderer',function(require){"use strict";var AbstractRenderer=require('web.AbstractRenderer');var config=require('web.config');var core=require('web.core');var GanttRow=require('web_gantt.GanttRow');var qweb=require('web.QWeb');var session=require('web.session');var utils=require('web.utils');var QWeb=core.qweb;var _t=core._t;var GanttRenderer=AbstractRenderer.extend({config:{GanttRow:GanttRow},custom_events:_.extend({},AbstractRenderer.prototype.custom_events,{'start_dragging':'_onStartDragging','start_no_dragging':'_onStartNoDragging','stop_dragging':'_onStopDragging','stop_no_dragging':'_onStopNoDragging',}),DECORATIONS:['decoration-secondary','decoration-success','decoration-info','decoration-warning','decoration-danger',],sampleDataTargets:['.o_gantt_row',],init:function(parent,state,params){var self=this;this._super.apply(this,arguments);this.$draggedPill=null;this.$draggedPillClone=null;this.canCreate=params.canCreate;this.canCellCreate=params.canCellCreate;this.canEdit=params.canEdit;this.canPlan=params.canPlan;this.cellPrecisions=params.cellPrecisions;this.colorField=params.colorField;this.progressField=params.progressField;this.consolidationParams=params.consolidationParams;this.fieldsInfo=params.fieldsInfo;this.SCALES=params.SCALES;this.string=params.string;this.totalRow=params.totalRow;this.collapseFirstLevel=params.collapseFirstLevel;this.thumbnails=params.thumbnails;this.rowWidgets={};this.pillDecorations=_.chain(this.arch.attrs).pick(function(value,key){return self.DECORATIONS.indexOf(key)>=0;}).mapObject(function(value){return py.parse(py.tokenize(value));}).value();if(params.popoverTemplate){this.popoverQWeb=new qweb(config.isDebug(),{_s:session.origin});this.popoverQWeb.add_template(utils.json_node_to_xml(params.popoverTemplate));}else{this.popoverQWeb=QWeb;}
this.isRTL=_t.database.parameters.direction==="rtl";},on_attach_callback:function(){this._isInDom=true;core.bus.on("keydown",this,this._onKeydown);core.bus.on("keyup",this,this._onKeyup);this._setRowsDroppable();},on_detach_callback:function(){this._isInDom=false;core.bus.off("keydown",this,this._onKeydown);core.bus.off("keyup",this,this._onKeyup);_.invoke(this.rowWidgets,'on_detach_callback');},updateRow:function(rowState){var self=this;var oldRowIds=[rowState.id].concat(rowState.childrenRowIds);var oldRows=[];oldRowIds.forEach(function(rowId){if(self.rowWidgets[rowId]){oldRows.push(self.rowWidgets[rowId]);delete self.rowWidgets[rowId];}});this.proms=[];var rows=this._renderRows([rowState],rowState.groupedBy);var proms=this.proms;delete this.proms;return Promise.all(proms).then(function(){var $previousRow=oldRows[0].$el;rows.forEach(function(row){row.$el.insertAfter($previousRow);$previousRow=row.$el;});_.invoke(oldRows,'destroy');self._setRowsDroppable();});},_getAction:function(event){return event.ctrlKey||event.metaKey?'copy':'reschedule';},_getFocusDateFormat:function(){var focusDate=this.state.focusDate;switch(this.state.scale){case'day':return focusDate.format('dddd, MMMM DD, YYYY');case'week':var dateStart=focusDate.clone().startOf('week').format('DD MMMM YYYY');var dateEnd=focusDate.clone().endOf('week').format('DD MMMM YYYY');return _.str.sprintf('%s - %s',dateStart,dateEnd);case'month':return focusDate.format('MMMM YYYY');case'year':return focusDate.format('YYYY');default:break;}},_getSlotsDates:function(){var token=this.SCALES[this.state.scale].interval;var stopDate=this.state.stopDate;var day=this.state.startDate;var dates=[];while(day<=stopDate){dates.push(day);day=day.clone().add(1,token);}
return dates;},_prepareViewInfo:function(){return{colorField:this.colorField,progressField:this.progressField,consolidationParams:this.consolidationParams,state:this.state,fieldsInfo:this.fieldsInfo,slots:this._getSlotsDates(),pillDecorations:this.pillDecorations,popoverQWeb:this.popoverQWeb,activeScaleInfo:{precision:this.cellPrecisions[this.state.scale],interval:this.SCALES[this.state.scale].cellPrecisions[this.cellPrecisions[this.state.scale]],time:this.SCALES[this.state.scale].time,},};},async _renderView(){var self=this;var oldRowWidgets=Object.keys(this.rowWidgets).map(function(rowId){return self.rowWidgets[rowId];});this.rowWidgets={};this.viewInfo=this._prepareViewInfo();this.proms=[];var rows=this._renderRows(this.state.rows,this.state.groupedBy);var totalRow;if(this.totalRow){totalRow=this._renderTotalRow();}
this.proms.push(this._super.apply(this,arguments));var proms=this.proms;delete this.proms;return Promise.all(proms).then(function(){self.$el.empty();_.invoke(oldRowWidgets,'destroy');self._replaceElement(QWeb.render('GanttView',{widget:self}));const $containment=$('<div id="o_gantt_containment"/>');self.$('.o_gantt_row_container').append($containment);if(!self.state.groupedBy.length){$containment.css(self.isRTL?{right:0}:{left:0})}
rows.forEach(function(row){row.$el.appendTo(self.$('.o_gantt_row_container'));});if(totalRow){totalRow.$el.appendTo(self.$('.o_gantt_total_row_container'));}
if(self._isInDom){self._setRowsDroppable();}
if(self.state.isSample){self._renderNoContentHelper();}});},_renderRows:function(rows,groupedBy){var self=this;var rowWidgets=[];var disableResize=this.state.scale==='year';var groupLevel=this.state.groupedBy.length-groupedBy.length;var hideSidebar=groupedBy.length===0;if(this.collapseFirstLevel){hideSidebar=self.state.groupedBy.length===0;}
rows.forEach(function(row){var pillsInfo={groupId:row.groupId,resId:row.resId,pills:row.records,groupLevel:groupLevel,};if(groupedBy.length){pillsInfo.groupName=row.name;pillsInfo.groupedByField=row.groupedByField;}
var params={canCreate:self.canCreate,canCellCreate:self.canCellCreate,canEdit:self.canEdit,canPlan:self.canPlan,isGroup:row.isGroup,consolidate:(groupLevel===0)&&(self.state.groupedBy[0]===self.consolidationParams.maxField),hideSidebar:hideSidebar,isOpen:row.isOpen,disableResize:disableResize,rowId:row.id,scales:self.SCALES,unavailabilities:row.unavailabilities,};if(self.thumbnails&&row.groupedByField&&row.groupedByField in self.thumbnails){params.thumbnail={model:self.fieldsInfo[row.groupedByField].relation,field:self.thumbnails[row.groupedByField],};}
rowWidgets.push(self._renderRow(pillsInfo,params));if(row.isGroup&&row.isOpen){var subRowWidgets=self._renderRows(row.rows,groupedBy.slice(1));rowWidgets=rowWidgets.concat(subRowWidgets);}});return rowWidgets;},_renderRow:function(pillsInfo,params){var ganttRow=new this.config.GanttRow(this,pillsInfo,this.viewInfo,params);this.rowWidgets[ganttRow.rowId]=ganttRow;this.proms.push(ganttRow._widgetRenderAndInsert(function(){}));return ganttRow;},_renderTotalRow:function(){var pillsInfo={groupId:"groupTotal",pills:this.state.records,groupLevel:0,groupName:"Total"};var params={canCreate:this.canCreate,canCellCreate:this.canCellCreate,canEdit:this.canEdit,canPlan:this.canPlan,hideSidebar:this.state.groupedBy.length===0,isGroup:true,rowId:'__total_row__',scales:this.SCALES,};return this._renderRow(pillsInfo,params);},_setRowsDroppable:function(){const firstCell=this.$('.o_gantt_header_scale .o_gantt_header_cell:first')[0];_.invoke(this.rowWidgets,'setDroppable',firstCell);},_onKeydown:function(ev){this.action=this._getAction(ev);if(this.$draggedPill&&this.action==='copy'){this.$el.addClass('o_copying');this.$el.removeClass('o_grabbing');}},_onKeyup:function(ev){this.action=this._getAction(ev);if(this.$draggedPill&&this.action==='reschedule'){this.$el.addClass('o_grabbing');this.$el.removeClass('o_copying');}},_onStartDragging:function(event){this.$draggedPill=event.data.$draggedPill;this.$draggedPill.addClass('o_dragged_pill');if(this.action==='copy'){this.$el.addClass('o_copying');}else{this.$el.addClass('o_grabbing');}},_onStartNoDragging:function(){this.$el.addClass('o_no_dragging');},_onStopDragging:function(){this.$draggedPill.removeClass('o_dragged_pill');this.$draggedPill=null;this.$draggedPillClone=null;this.$el.removeClass('o_grabbing');this.$el.removeClass('o_copying');},_onStopNoDragging:function(){this.$el.removeClass('o_no_dragging');},});return GanttRenderer;});;

/* /web_gantt/static/src/js/gantt_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_gantt.GanttView',function(require){"use strict";var AbstractView=require('web.AbstractView');var core=require('web.core');var GanttModel=require('web_gantt.GanttModel');var GanttRenderer=require('web_gantt.GanttRenderer');var GanttController=require('web_gantt.GanttController');var pyUtils=require('web.py_utils');var view_registry=require('web.view_registry');var _t=core._t;var _lt=core._lt;var GanttView=AbstractView.extend({display_name:_lt('Gantt'),icon:'fa-tasks',config:_.extend({},AbstractView.prototype.config,{Model:GanttModel,Controller:GanttController,Renderer:GanttRenderer,}),jsLibs:['/web/static/lib/nearest/jquery.nearest.js',],viewType:'gantt',init:function(viewInfo,params){this._super.apply(this,arguments);this.SCALES={day:{string:_t('Day'),cellPrecisions:{full:60,half:30,quarter:15},defaultPrecision:'full',time:'minutes',interval:'hour'},week:{string:_t('Week'),cellPrecisions:{full:24,half:12},defaultPrecision:'half',time:'hours',interval:'day'},month:{string:_t('Month'),cellPrecisions:{full:24,half:12},defaultPrecision:'half',time:'hours',interval:'day'},year:{string:_t('Year'),cellPrecisions:{full:1},defaultPrecision:'full',time:'months',interval:'month'},};var arch=this.arch;var decorationFields=[];_.each(arch.children,function(child){if(child.tag==='field'){decorationFields.push(child.attrs.name);}});var collapseFirstLevel=!!arch.attrs.collapse_first_level;var displayUnavailability=!!arch.attrs.display_unavailability;var colorField=arch.attrs.color;var precisionAttrs=arch.attrs.precision?pyUtils.py_eval(arch.attrs.precision):{};var cellPrecisions={};_.each(this.SCALES,function(vals,key){if(precisionAttrs[key]){var precision=precisionAttrs[key].split(':');if(precision[1]&&_.contains(_.keys(vals.cellPrecisions),precision[1])){cellPrecisions[key]=precision[1];}}
cellPrecisions[key]=cellPrecisions[key]||vals.defaultPrecision;});var consolidationMaxField;var consolidationMaxValue;var consolidationMax=arch.attrs.consolidation_max?pyUtils.py_eval(arch.attrs.consolidation_max):{};if(Object.keys(consolidationMax).length>0){consolidationMaxField=Object.keys(consolidationMax)[0];consolidationMaxValue=consolidationMax[consolidationMaxField];collapseFirstLevel=!!consolidationMaxField||collapseFirstLevel;}
var consolidationParams={field:arch.attrs.consolidation,maxField:consolidationMaxField,maxValue:consolidationMaxValue,excludeField:arch.attrs.consolidation_exclude,};var formViewId=arch.attrs.form_view_id?parseInt(arch.attrs.form_view_id,10):false;if(params.action&&!formViewId){var result=_.findWhere(params.action.views,{type:'form'});formViewId=result?result.viewID:false;}
var dialogViews=[[formViewId,'form']];var allowedScales;if(arch.attrs.scales){var possibleScales=Object.keys(this.SCALES);allowedScales=_.reduce(arch.attrs.scales.split(','),function(allowedScales,scale){if(possibleScales.indexOf(scale)>=0){allowedScales.push(scale.trim());}
return allowedScales;},[]);}else{allowedScales=Object.keys(this.SCALES);}
var scale=params.context.default_scale||arch.attrs.default_scale||'month';var initialDate=moment(params.context.initialDate||params.initialDate||arch.attrs.initial_date||new Date());var offset=arch.attrs.offset;if(offset&&scale){initialDate.add(offset,scale);}
var thumbnails=this.arch.attrs.thumbnails?pyUtils.py_eval(this.arch.attrs.thumbnails):{};var canPlan=this.arch.attrs.plan?!!JSON.parse(this.arch.attrs.plan):true;const canCellCreate=this.arch.attrs.cell_create?!!JSON.parse(this.arch.attrs.cell_create):true;this.controllerParams.context=params.context||{};this.controllerParams.dialogViews=dialogViews;this.controllerParams.SCALES=this.SCALES;this.controllerParams.allowedScales=allowedScales;this.controllerParams.collapseFirstLevel=collapseFirstLevel;this.controllerParams.createAction=arch.attrs.on_create||null;this.loadParams.initialDate=initialDate;this.loadParams.collapseFirstLevel=collapseFirstLevel;this.loadParams.colorField=colorField;this.loadParams.dateStartField=arch.attrs.date_start;this.loadParams.dateStopField=arch.attrs.date_stop;this.loadParams.progressField=arch.attrs.progress;this.loadParams.decorationFields=decorationFields;this.loadParams.defaultGroupBy=this.arch.attrs.default_group_by;this.loadParams.dynamicRange=this.arch.attrs.dynamic_range;this.loadParams.displayUnavailability=displayUnavailability;this.loadParams.fields=this.fields;this.loadParams.scale=scale;this.loadParams.SCALES=this.SCALES;this.loadParams.consolidationParams=consolidationParams;this.rendererParams.canCreate=this.controllerParams.activeActions.create;this.rendererParams.canCellCreate=canCellCreate;this.rendererParams.canEdit=this.controllerParams.activeActions.edit;this.rendererParams.canPlan=canPlan&&this.rendererParams.canEdit;this.rendererParams.fieldsInfo=viewInfo.fields;this.rendererParams.SCALES=this.SCALES;this.rendererParams.cellPrecisions=cellPrecisions;this.rendererParams.totalRow=arch.attrs.total_row||false;this.rendererParams.string=arch.attrs.string||_t('Gantt View');this.rendererParams.popoverTemplate=_.findWhere(arch.children,{tag:'templates'});this.rendererParams.colorField=colorField;this.rendererParams.progressField=arch.attrs.progress;this.rendererParams.displayUnavailability=displayUnavailability;this.rendererParams.collapseFirstLevel=collapseFirstLevel;this.rendererParams.consolidationParams=consolidationParams;this.rendererParams.thumbnails=thumbnails;},});view_registry.add('gantt',GanttView);return GanttView;});;

/* /web_gantt/static/src/js/gantt_model.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_gantt.GanttModel',function(require){"use strict";var AbstractModel=require('web.AbstractModel');var concurrency=require('web.concurrency');var core=require('web.core');var fieldUtils=require('web.field_utils');var session=require('web.session');var _t=core._t;var GanttModel=AbstractModel.extend({init:function(){this._super.apply(this,arguments);this.dp=new concurrency.DropPrevious();this.mutex=new concurrency.Mutex();},collapseRow:function(rowId){this.allRows[rowId].isOpen=false;},collapseRows:function(){this.ganttData.rows.forEach(function(group){group.isOpen=false;});},convertToServerTime:function(date){var result=date.clone();if(!result.isUTC()){result.subtract(session.getTZOffset(date),'minutes');}
return result.locale('en').format('YYYY-MM-DD HH:mm:ss');},dateAdd:function(date,offset,unit){var result=date.clone().add(offset,unit);if(Math.abs(result.diff(date,'hours'))>=24){var tzOffsetDiff=result.clone().local().utcOffset()-date.clone().local().utcOffset();if(tzOffsetDiff!==0){result.subtract(tzOffsetDiff,'minutes');}}
return result;},__get:function(rowId){if(rowId){return this.allRows[rowId];}else{return Object.assign({isSample:this.isSampleModel},this.ganttData);}},expandRow:function(rowId){this.allRows[rowId].isOpen=true;},expandRows:function(){var self=this;Object.keys(this.allRows).forEach(function(rowId){var row=self.allRows[rowId];if(row.isGroup){self.allRows[rowId].isOpen=true;}});},__load:async function(params){await this._super(...arguments);this.modelName=params.modelName;this.fields=params.fields;this.domain=params.domain;this.context=params.context;this.decorationFields=params.decorationFields;this.colorField=params.colorField;this.progressField=params.progressField;this.consolidationParams=params.consolidationParams;this.collapseFirstLevel=params.collapseFirstLevel;this.displayUnavailability=params.displayUnavailability;this.SCALES=params.SCALES;this.defaultGroupBy=params.defaultGroupBy?[params.defaultGroupBy]:[];let groupedBy=params.groupedBy;if(!groupedBy||!groupedBy.length){groupedBy=this.defaultGroupBy;}
groupedBy=this._filterDateInGroupedBy(groupedBy);this.ganttData={dateStartField:params.dateStartField,dateStopField:params.dateStopField,groupedBy,fields:params.fields,dynamicRange:params.dynamicRange,};this._setRange(params.initialDate,params.scale);return this._fetchData().then(function(){return Promise.resolve();});},__reload:async function(handle,params){await this._super(...arguments);if('scale'in params){this._setRange(this.ganttData.focusDate,params.scale);}
if('date'in params){this._setRange(params.date,this.ganttData.scale);}
if('domain'in params){this.domain=params.domain;}
if('groupBy'in params){if(params.groupBy&&params.groupBy.length){this.ganttData.groupedBy=this._filterDateInGroupedBy(params.groupBy);if(this.ganttData.groupedBy.length!==params.groupBy.length){this.do_warn(false,_t('Grouping by date is not supported'));}}else{this.ganttData.groupedBy=this.defaultGroupBy;}}
return this._fetchData()},copy:function(id,schedule){var self=this;const defaults=this.rescheduleData(schedule);return this.mutex.exec(function(){return self._rpc({model:self.modelName,method:'copy',args:[id,defaults],context:self.context,});});},reschedule:function(ids,schedule,isUTC){var self=this;if(!_.isArray(ids)){ids=[ids];}
const data=this.rescheduleData(schedule,isUTC);return this.mutex.exec(function(){return self._rpc({model:self.modelName,method:'write',args:[ids,data],context:self.context,});});},rescheduleData:function(schedule,isUTC){const allowedFields=[this.ganttData.dateStartField,this.ganttData.dateStopField,...this.ganttData.groupedBy];const data=_.pick(schedule,allowedFields);let type;for(let k in data){type=this.fields[k].type;if(data[k]&&(type==='datetime'||type==='date')&&!isUTC){data[k]=this.convertToServerTime(data[k]);}};return data},_fetchData:function(){var self=this;var domain=this._getDomain();var context=Object.assign({},this.context,{group_by:this.ganttData.groupedBy});var groupsDef;if(this.ganttData.groupedBy.length){groupsDef=this._rpc({model:this.modelName,method:'read_group',fields:this._getFields(),domain:domain,context:context,groupBy:this.ganttData.groupedBy,orderBy:this.ganttData.groupedBy.map(function(f){return{name:f};}),lazy:this.ganttData.groupedBy.length===1,});}
var dataDef=this._rpc({route:'/web/dataset/search_read',model:this.modelName,fields:this._getFields(),context:context,domain:domain,});return this.dp.add(Promise.all([groupsDef,dataDef])).then(function(results){var groups=results[0];var searchReadResult=results[1];if(groups){_.each(groups,function(group){group.id=_.uniqueId('group');});}
var oldRows=self.allRows;self.allRows={};self.ganttData.groups=groups;self.ganttData.records=self._parseServerData(searchReadResult.records);self.ganttData.rows=self._generateRows({groupedBy:self.ganttData.groupedBy,groups:groups,oldRows:oldRows,records:self.ganttData.records,});var unavailabilityProm;if(self.displayUnavailability&&!self.isSampleModel){unavailabilityProm=self._fetchUnavailability();}
return unavailabilityProm;});},_computeUnavailabilityRows:function(rows){var self=this;return _.map(rows,function(r){if(r){return{groupedBy:r.groupedBy,records:r.records,name:r.name,resId:r.resId,rows:self._computeUnavailabilityRows(r.rows)}}else{return r;}});},_fetchUnavailability:function(){var self=this;return this._rpc({model:this.modelName,method:'gantt_unavailability',args:[this.convertToServerTime(this.ganttData.startDate),this.convertToServerTime(this.ganttData.stopDate),this.ganttData.scale,this.ganttData.groupedBy,this._computeUnavailabilityRows(this.ganttData.rows),],context:this.context,}).then(function(enrichedRows){self._updateUnavailabilityRows(self.ganttData.rows,enrichedRows);});},_updateUnavailabilityRows:function(original,enriched){var self=this;_.zip(original,enriched).forEach(function(rowPair){var o=rowPair[0];var e=rowPair[1];o.unavailabilities=_.map(e.unavailabilities,function(u){u.start=self._parseServerValue({type:'datetime'},u.start);u.stop=self._parseServerValue({type:'datetime'},u.stop);return u;});if(o.rows&&e.rows){self._updateUnavailabilityRows(o.rows,e.rows);}});},_generateRows:function(params){var self=this;var groups=params.groups;var groupedBy=params.groupedBy;var rows;if(!groupedBy.length){var row={groupId:groups&&groups.length&&groups[0].id,id:_.uniqueId('row'),records:params.records,};rows=[row];this.allRows[row.id]=row;}else{var groupedByField=groupedBy[0];var currentLevelGroups=_.groupBy(groups,groupedByField);rows=Object.keys(currentLevelGroups).map(function(key){var subGroups=currentLevelGroups[key];var groupRecords=_.filter(params.records,function(record){return _.isEqual(record[groupedByField],subGroups[0][groupedByField]);});var value;if(groupRecords.length){value=groupRecords[0][groupedByField];}else{value=subGroups[0][groupedByField];}
var path=(params.parentPath||'')+JSON.stringify(value);var minNbGroups=self.collapseFirstLevel?0:1;var isGroup=groupedBy.length>minNbGroups;var row={name:self._getFieldFormattedValue(value,self.fields[groupedByField]),groupId:subGroups[0].id,groupedBy:groupedBy,groupedByField:groupedByField,id:_.uniqueId('row'),resId:_.isArray(value)?value[0]:value,isGroup:isGroup,isOpen:!_.findWhere(params.oldRows,{path:path,isOpen:false}),path:path,records:groupRecords,};if(isGroup){row.rows=self._generateRows({groupedBy:groupedBy.slice(1),groups:subGroups,oldRows:params.oldRows,parentPath:row.path+'\n',records:groupRecords,});row.childrenRowIds=[];row.rows.forEach(function(subRow){row.childrenRowIds.push(subRow.id);row.childrenRowIds=row.childrenRowIds.concat(subRow.childrenRowIds||[]);});}
self.allRows[row.id]=row;return row;});if(!rows.length){rows=[{groups:[],records:[],}];}}
return rows;},_getDomain:function(){var domain=[[this.ganttData.dateStartField,'<=',this.convertToServerTime(this.ganttData.stopDate)],[this.ganttData.dateStopField,'>=',this.convertToServerTime(this.ganttData.startDate)],];return this.domain.concat(domain);},_getFields:function(){var fields=['display_name',this.ganttData.dateStartField,this.ganttData.dateStopField];fields=fields.concat(this.ganttData.groupedBy,this.decorationFields);if(this.progressField){fields.push(this.progressField);}
if(this.colorField){fields.push(this.colorField);}
if(this.consolidationParams.field){fields.push(this.consolidationParams.field);}
if(this.consolidationParams.excludeField){fields.push(this.consolidationParams.excludeField);}
return _.uniq(fields);},_getFieldFormattedValue:function(value,field){var options={};if(field.type==='boolean'){options={forceString:true};}
var formattedValue=fieldUtils.format[field.type](value,field,options);return formattedValue||_.str.sprintf(_t('Undefined %s'),field.string);},_isEmpty(){return!this.ganttData.records.length;},_parseServerData:function(data){var self=this;data.forEach(function(record){Object.keys(record).forEach(function(fieldName){record[fieldName]=self._parseServerValue(self.fields[fieldName],record[fieldName]);});});return data;},_setRange:function(focusDate,scale){this.ganttData.scale=scale;this.ganttData.focusDate=focusDate;if(this.ganttData.dynamicRange){this.ganttData.startDate=focusDate.clone().startOf(this.SCALES[scale].interval);this.ganttData.stopDate=this.ganttData.startDate.clone().add(1,scale);}else{this.ganttData.startDate=focusDate.clone().startOf(scale);this.ganttData.stopDate=focusDate.clone().endOf(scale);}},_filterDateInGroupedBy(groupedBy){return groupedBy.filter(groupedByField=>{var fieldName=groupedByField.split(':')[0];return fieldName in this.fields&&this.fields[fieldName].type.indexOf('date')===-1;});},});return GanttModel;});;

/* /web_gantt/static/src/js/gantt_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_gantt.GanttController',function(require){"use strict";var AbstractController=require('web.AbstractController');var core=require('web.core');var dialogs=require('web.view_dialogs');var confirmDialog=require('web.Dialog').confirm;var QWeb=core.qweb;var _t=core._t;var GanttController=AbstractController.extend({events:_.extend({},AbstractController.prototype.events,{'click .o_gantt_button_add':'_onAddClicked','click .o_gantt_button_scale':'_onScaleClicked','click .o_gantt_button_prev':'_onPrevPeriodClicked','click .o_gantt_button_next':'_onNextPeriodClicked','click .o_gantt_button_today':'_onTodayClicked','click .o_gantt_button_expand_rows':'_onExpandClicked','click .o_gantt_button_collapse_rows':'_onCollapseClicked',}),custom_events:_.extend({},AbstractController.prototype.custom_events,{add_button_clicked:'_onCellAddClicked',plan_button_clicked:'_onCellPlanClicked',collapse_row:'_onCollapseRow',expand_row:'_onExpandRow',pill_clicked:'_onPillClicked',pill_resized:'_onPillResized',pill_dropped:'_onPillDropped',updating_pill_started:'_onPillUpdatingStarted',updating_pill_stopped:'_onPillUpdatingStopped',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.model=model;this.context=params.context;this.dialogViews=params.dialogViews;this.SCALES=params.SCALES;this.allowedScales=params.allowedScales;this.collapseFirstLevel=params.collapseFirstLevel;this.createAction=params.createAction;this.isRTL=_t.database.parameters.direction==="rtl";},renderButtons:function($node){var state=this.model.get();this.$buttons=$(QWeb.render('GanttView.buttons',{groupedBy:state.groupedBy,widget:this,SCALES:this.SCALES,activateScale:state.scale,allowedScales:this.allowedScales,}));if($node){this.$buttons.appendTo($node);}},_copy:function(id,schedule){return this._executeAsyncOperation(this.model.copy.bind(this.model),[id,schedule]);},_executeAsyncOperation:function(operation,args){const self=this;var prom=new Promise(function(resolve,reject){var asyncOp=operation(...args);asyncOp.then(resolve).guardedCatch(resolve);self.dp.add(asyncOp).guardedCatch(reject);});return prom.then(this.reload.bind(this,{}));},_getDialogContext:function(date,groupId){var state=this.model.get();var context={};context[state.dateStartField]=date.clone();context[state.dateStopField]=date.clone().endOf(this.SCALES[state.scale].interval);if(groupId){_.each(state.groupedBy,function(fieldName){var groupValue=_.find(state.groups,function(group){return group.id===groupId;});var value=groupValue[fieldName];if(_.isArray(value)){value=value[0];}
context[fieldName]=value;});}
for(var k in context){var type=state.fields[k].type;if(context[k]&&(type==='datetime'||type==='date')){context[k]=this.model.convertToServerTime(context[k]);}}
return context;},_openDialog:function(resID,context){var title=resID?_t("Open"):_t("Create");return new dialogs.FormViewDialog(this,{title:_.str.sprintf(title),res_model:this.modelName,view_id:this.dialogViews[0][0],res_id:resID,readonly:!this.is_action_enabled('edit'),deletable:this.is_action_enabled('delete')&&resID,context:_.extend({},this.context,context),on_saved:this.reload.bind(this,{}),on_remove:this._onDialogRemove.bind(this,resID),}).open();},_onDialogRemove:function(resID){var controller=this;var confirm=new Promise(function(resolve){confirmDialog(this,_t('Are you sure to delete this record?'),{confirm_callback:function(){resolve(true);},cancel_callback:function(){resolve(false);},});});return confirm.then(function(confirmed){if((!confirmed)){return Promise.resolve();}
return controller._rpc({model:controller.modelName,method:'unlink',args:[[resID,],],}).then(function(){return controller.reload();})});},_openPlanDialog:function(context){var self=this;var state=this.model.get();var domain=['|',[state.dateStartField,'=',false],[state.dateStopField,'=',false],];new dialogs.SelectCreateDialog(this,{title:_t("Plan"),res_model:this.modelName,domain:this.model.domain.concat(domain),views:this.dialogViews,context:_.extend({},this.context,context),on_selected:function(records){var ids=_.pluck(records,'id');if(ids.length){self._reschedule(ids,context,true);}},}).open();},_onCreate:function(context){if(this.createAction){var fullContext=_.extend({},this.context,context);this.do_action(this.createAction,{additional_context:fullContext,on_close:this.reload.bind(this,{})});}else{this._openDialog(undefined,context);}},_reschedule:function(ids,schedule,isUTC){return this._executeAsyncOperation(this.model.reschedule.bind(this.model),[ids,schedule,isUTC]);},_update:function(){var self=this;return this._super.apply(this,arguments).then(function(){if(self.$buttons){var nbGroups=self.model.get().groupedBy.length;var minNbGroups=self.collapseFirstLevel?0:1;var displayButtons=nbGroups>minNbGroups;self.$buttons.find('.o_gantt_button_expand_rows').toggle(displayButtons);self.$buttons.find('.o_gantt_button_collapse_rows').toggle(displayButtons);}});},_onCellAddClicked:function(ev){ev.stopPropagation();var context=this._getDialogContext(ev.data.date,ev.data.groupId);for(var k in context){context[_.str.sprintf('default_%s',k)]=context[k];}
this._onCreate(context);},_onAddClicked:function(ev){ev.preventDefault();var context={};var state=this.model.get();context[state.dateStartField]=this.model.convertToServerTime(state.focusDate.clone().startOf(state.scale));context[state.dateStopField]=this.model.convertToServerTime(state.focusDate.clone().endOf(state.scale));for(var k in context){context[_.str.sprintf('default_%s',k)]=context[k];}
this._onCreate(context);},_onCollapseClicked:function(ev){ev.preventDefault();this.model.collapseRows();this.update({},{reload:false});},_onCollapseRow:function(ev){ev.stopPropagation();this.model.collapseRow(ev.data.rowId);this.renderer.updateRow(this.model.get(ev.data.rowId));},_onExpandClicked:function(ev){ev.preventDefault();this.model.expandRows();this.update({},{reload:false});},_onExpandRow:function(ev){ev.stopPropagation();this.model.expandRow(ev.data.rowId);this.renderer.updateRow(this.model.get(ev.data.rowId));},_onNextPeriodClicked:function(ev){ev.preventDefault();var state=this.model.get();this.update({date:state.focusDate.add(1,state.scale)});},_onPillClicked:async function(ev){if(!this._updating){ev.data.target.addClass('o_gantt_pill_editing');await this.model.mutex.getUnlockedDef();var dialog=this._openDialog(ev.data.target.data('id'));dialog.on('closed',this,function(){ev.data.target.removeClass('o_gantt_pill_editing');});}},_onPillDropped:function(ev){ev.stopPropagation();var state=this.model.get();var schedule={};var diff=ev.data.diff;diff=this.isRTL?-diff:diff;if(diff){var pill=_.findWhere(state.records,{id:ev.data.pillId});schedule[state.dateStartField]=this.model.dateAdd(pill[state.dateStartField],diff,this.SCALES[state.scale].time);schedule[state.dateStopField]=this.model.dateAdd(pill[state.dateStopField],diff,this.SCALES[state.scale].time);}else if(ev.data.action==='copy'){const pill=_.findWhere(state.records,{id:ev.data.pillId});schedule[state.dateStartField]=pill[state.dateStartField].clone();schedule[state.dateStopField]=pill[state.dateStopField].clone();}
if(ev.data.newGroupId&&ev.data.newGroupId!==ev.data.oldGroupId){var group=_.findWhere(state.groups,{id:ev.data.newGroupId});var fieldsToWrite=state.groupedBy.slice(0,ev.data.groupLevel+1);_.each(fieldsToWrite,function(fieldName){schedule[fieldName]=group[fieldName];if(_.isArray(schedule[fieldName])){schedule[fieldName]=schedule[fieldName][0];}});}
if(ev.data.action==='copy'){this._copy(ev.data.pillId,schedule);}else{this._reschedule(ev.data.pillId,schedule);}},_onPillResized:function(ev){ev.stopPropagation();var schedule={};schedule[ev.data.field]=ev.data.date;this._reschedule(ev.data.id,schedule);},_onPillUpdatingStarted:function(ev){ev.stopPropagation();this._updating=true;},_onPillUpdatingStopped:function(ev){ev.stopPropagation();this._updating=false;},_onCellPlanClicked:function(ev){ev.stopPropagation();var context=this._getDialogContext(ev.data.date,ev.data.groupId);this._openPlanDialog(context);},_onPrevPeriodClicked:function(ev){ev.preventDefault();var state=this.model.get();this.update({date:state.focusDate.subtract(1,state.scale)});},_onScaleClicked:function(ev){ev.preventDefault();var $button=$(ev.currentTarget);this.$buttons.find('.o_gantt_button_scale').removeClass('active');$button.addClass('active');this.$buttons.find('.o_gantt_dropdown_selected_scale').text($button.text());this.update({scale:$button.data('value')});},_onTodayClicked:function(ev){ev.preventDefault();this.update({date:moment()});},});return GanttController;});;

/* /web_gantt/static/src/js/gantt_row.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_gantt.GanttRow',function(require){"use strict";var core=require('web.core');var session=require('web.session');var Widget=require('web.Widget');const pyUtils=require('web.py_utils');var QWeb=core.qweb;var _t=core._t;var GanttRow=Widget.extend({template:'GanttView.Row',events:{'mouseleave':'_onMouseLeave','mousemove .o_gantt_cell':'_onMouseMove','mouseenter .o_gantt_pill':'_onPillEntered','click .o_gantt_pill':'_onPillClicked','click':'_onRowSidebarClicked','click .o_gantt_cell_buttons > div > .o_gantt_cell_add':'_onButtonAddClicked','click .o_gantt_cell_buttons > div > .o_gantt_cell_plan':'_onButtonPlanClicked',},NB_GANTT_RECORD_COLORS:12,LEVEL_LEFT_OFFSET:16,LEVEL_TOP_OFFSET:31,POPOVER_DELAY:260,init:function(parent,pillsInfo,viewInfo,options){this._super.apply(this,arguments);var self=this;this.name=pillsInfo.groupName;this.groupId=pillsInfo.groupId;this.groupLevel=pillsInfo.groupLevel;this.groupedByField=pillsInfo.groupedByField;this.pills=_.map(pillsInfo.pills,_.clone);this.resId=pillsInfo.resId;this.viewInfo=viewInfo;this.fieldsInfo=viewInfo.fieldsInfo;this.state=viewInfo.state;this.colorField=viewInfo.colorField;this.options=options;this.SCALES=options.scales;this.isGroup=options.isGroup;this.isOpen=options.isOpen;this.rowId=options.rowId;this.unavailabilities=(options.unavailabilities||[]).map(u=>{return{startDate:self._convertToUserTime(u.start),stopDate:self._convertToUserTime(u.stop)};});this.consolidate=options.consolidate;this.consolidationParams=viewInfo.consolidationParams;if(options.thumbnail){this.thumbnailUrl=session.url('/web/image',{model:options.thumbnail.model,id:this.resId,field:this.options.thumbnail.field,});}
this.isTotal=this.groupId==='groupTotal';this._adaptPills();this._snapToGrid(this.pills);this._calculateLevel();if(this.isGroup&&this.pills.length){this._aggregateGroupedPills();}else{this.progressField=viewInfo.progressField;this._evaluateDecoration();}
this._calculateMarginAndWidth();this.leftPadding=(this.groupLevel+1)*this.LEVEL_LEFT_OFFSET;this.cellHeight=this.level*this.LEVEL_TOP_OFFSET+(this.level>0?this.level-1:0);this.MIN_WIDTHS={full:100,half:50,quarter:25};this.PARTS={full:1,half:2,quarter:4};this.cellMinWidth=this.MIN_WIDTHS[this.viewInfo.activeScaleInfo.precision];this.cellPart=this.PARTS[this.viewInfo.activeScaleInfo.precision];this._prepareSlots();this._insertIntoSlot();this.childrenRows=[];this._onButtonAddClicked=_.debounce(this._onButtonAddClicked,500,true);this._onButtonPlanClicked=_.debounce(this._onButtonPlanClicked,500,true);this._onPillClicked=_.debounce(this._onPillClicked,500,true);if(this.isTotal){const maxCount=Math.max(...this.pills.map(p=>p.count));const factor=maxCount?(90/maxCount):0;for(let p of this.pills){p.totalHeight=factor*p.count;}}
this.isRTL=_t.database.parameters.direction==="rtl";},setDroppable:function(firstCell){if(this.isTotal){return;}
var self=this;const resizeSnappingWidth=this._getResizeSnappingWidth(firstCell);this.$el.droppable({drop:function(event,ui){var diff=self._getDiff(resizeSnappingWidth,ui.position.left);var $pill=ui.draggable;var oldGroupId=$pill.closest('.o_gantt_row').data('group-id');if(diff||(self.groupId!==oldGroupId)){const action=event.ctrlKey||event.metaKey?'copy':'reschedule';self._saveDragChanges($pill.data('id'),diff,oldGroupId,self.groupId,action);}else{ui.helper.animate({left:0,top:0,});}},tolerance:'intersect',});},_bindPopover:function(){var self=this;this.$('.o_gantt_pill').popover({container:this.$el,trigger:'hover',delay:{show:this.POPOVER_DELAY},html:true,placement:'top',content:function(){return self.viewInfo.popoverQWeb.render('gantt-popover',self._getPopoverContext($(this).data('id')));},});},_bindPillPopover:function(target){var self=this;var $target=$(target);if(!$target.hasClass('o_gantt_pill')){$target=this.$(target.offsetParent);}
$target.popover({container:this.$el,trigger:'hover',delay:{show:this.POPOVER_DELAY},html:true,placement:'top',content:function(){return self.viewInfo.popoverQWeb.render('gantt-popover',self._getPopoverContext($(this).data('id')));},}).popover("show");},_calculateLevel:function(){if(this.isGroup||!this.pills.length){this.level=0;this.pills.forEach(function(pill){pill.level=0;});}else{this.pills=_.sortBy(this.pills,'startDate');this.pills[0].level=0;var levels=[{pills:[this.pills[0]],maxStopDate:this.pills[0].stopDate,}];for(var i=1;i<this.pills.length;i++){var currentPill=this.pills[i];for(var l=0;l<levels.length;l++){if(currentPill.startDate>=levels[l].maxStopDate){currentPill.level=l;levels[l].pills.push(currentPill);if(currentPill.stopDate>levels[l].maxStopDate){levels[l].maxStopDate=currentPill.stopDate;}
break;}}
if(!currentPill.level&&currentPill.level!=0){currentPill.level=levels.length;levels.push({pills:[currentPill],maxStopDate:currentPill.stopDate,});}}
this.level=levels.length;}},_adaptPills:function(){var self=this;var dateStartField=this.state.dateStartField;var dateStopField=this.state.dateStopField;var ganttStartDate=this.state.startDate;var ganttStopDate=this.state.stopDate;this.pills.forEach(function(pill){var pillStartDate=self._convertToUserTime(pill[dateStartField]);var pillStopDate=self._convertToUserTime(pill[dateStopField]);if(pillStartDate<ganttStartDate){pill.startDate=ganttStartDate;pill.disableStartResize=true;}else{pill.startDate=pillStartDate;}
if(pillStopDate>ganttStopDate){pill.stopDate=ganttStopDate;pill.disableStopResize=true;}else{pill.stopDate=pillStopDate;}
if(self.isGroup){pill.disableStartResize=true;pill.disableStopResize=true;}});},_aggregateGroupedPills:function(){var self=this;var sortedPills=_.sortBy(_.map(this.pills,_.clone),'startDate');var firstPill=sortedPills[0];firstPill.count=1;var timeToken=this.SCALES[this.state.scale].time;var precision=this.viewInfo.activeScaleInfo.precision;var cellTime=this.SCALES[this.state.scale].cellPrecisions[precision];var intervals=_.reduce(this.viewInfo.slots,function(intervals,slotStart){intervals.push(slotStart);if(precision==='half'){intervals.push(slotStart.clone().add(cellTime,timeToken));}
return intervals;},[]);this.pills=_.reduce(intervals,function(pills,intervalStart){var intervalStop=intervalStart.clone().add(cellTime,timeToken);var pillsInThisInterval=_.filter(self.pills,function(pill){return pill.startDate<intervalStop&&pill.stopDate>intervalStart;});if(pillsInThisInterval.length){var previousPill=pills[pills.length-1];var isContinuous=previousPill&&_.intersection(previousPill.aggregatedPills,pillsInThisInterval).length;if(isContinuous&&previousPill.count===pillsInThisInterval.length){previousPill.stopDate=intervalStop;previousPill.aggregatedPills=previousPill.aggregatedPills.concat(pillsInThisInterval);}else{var newPill={id:0,count:pillsInThisInterval.length,aggregatedPills:pillsInThisInterval,startDate:moment.max(_.min(pillsInThisInterval,'startDate').startDate,intervalStart),stopDate:moment.min(_.max(pillsInThisInterval,'stopDate').stopDate,intervalStop),};if(self.consolidate&&self.consolidationParams.field){newPill.consolidationValue=pillsInThisInterval.reduce(function(sum,pill){if(!pill[self.consolidationParams.excludeField]){return sum+pill[self.consolidationParams.field];}
return sum;},0);newPill.consolidationMaxValue=self.consolidationParams.maxValue;newPill.consolidationExceeded=newPill.consolidationValue>newPill.consolidationMaxValue;}
pills.push(newPill);}}
return pills;},[]);var maxCount=_.max(this.pills,function(pill){return pill.count;}).count;var minColor=215;var maxColor=100;this.pills.forEach(function(pill){pill.consolidated=true;if(self.consolidate&&self.consolidationParams.maxValue){pill.status=pill.consolidationExceeded?'danger':'success';pill.display_name=pill.consolidationValue;}else{var color=minColor-((pill.count-1)/maxCount)*(minColor-maxColor);pill.style=_.str.sprintf("background-color: rgba(%s, %s, %s, 0.6)",color,color,color);pill.display_name=pill.count;}});},_calculateMarginAndWidth:function(){var self=this;var left;var diff;this.pills.forEach(function(pill){switch(self.state.scale){case'day':left=pill.startDate.diff(pill.startDate.clone().startOf('hour'),'minutes');pill.leftMargin=(left/60)*100;diff=pill.stopDate.diff(pill.startDate,'minutes');var gapSize=pill.stopDate.diff(pill.startDate,'hours')-1;pill.width=gapSize>0?'calc('+(diff/60)*100+'% + '+gapSize+'px)':(diff/60)*100+'%';break;case'week':case'month':left=pill.startDate.diff(pill.startDate.clone().startOf('day'),'hours');pill.leftMargin=(left/24)*100;diff=pill.stopDate.diff(pill.startDate,'hours');var gapSize=pill.stopDate.diff(pill.startDate,'days')-1;pill.width=gapSize>0?'calc('+(diff/24)*100+'% + '+gapSize+'px)':(diff/24)*100+'%';break;case'year':var startDateMonthStart=pill.startDate.clone().startOf('month');var stopDateMonthEnd=pill.stopDate.clone().endOf('month');left=pill.startDate.diff(startDateMonthStart,'days');pill.leftMargin=(left/30)*100;var monthsDiff=stopDateMonthEnd.diff(startDateMonthStart,'months',true);if(monthsDiff<1){diff=Math.max(Math.ceil(pill.stopDate.diff(pill.startDate,'days',true)),2);pill.width=(diff/pill.startDate.daysInMonth())*100+"%";}else{var startDateMonthEnd=pill.startDate.clone().endOf('month');var diffMonthStart=Math.ceil(startDateMonthEnd.diff(pill.startDate,'days',true));var widthMonthStart=(diffMonthStart/pill.startDate.daysInMonth());var stopDateMonthStart=pill.stopDate.clone().startOf('month');var diffMonthStop=Math.ceil(pill.stopDate.diff(stopDateMonthStart,'days',true));var widthMonthStop=(diffMonthStop/pill.stopDate.daysInMonth());var width=Math.max((widthMonthStart+widthMonthStop),(2/30))*100;if(monthsDiff>2){width+=(monthsDiff-2)*100;}
pill.width=width+"%";}
break;default:break;}
pill.topPadding=pill.level*(self.LEVEL_TOP_OFFSET+1);});},_convertToUserTime:function(date){return date.clone().local();},_evaluateDecoration:function(){var self=this;this.pills.forEach(function(pill){var pillDecorations=[];_.each(self.viewInfo.pillDecorations,function(expr,decoration){if(py.PY_isTrue(py.evaluate(expr,self._getDecorationEvalContext(pill)))){pillDecorations.push(decoration);}});pill.decorations=pillDecorations;if(self.colorField){pill._color=self._getColor(pill[self.colorField]);}
if(self.progressField){pill._progress=pill[self.progressField]||0;}});},_getColor:function(value){if(_.isNumber(value)){return Math.round(value)%this.NB_GANTT_RECORD_COLORS;}else if(_.isArray(value)){return value[0]%this.NB_GANTT_RECORD_COLORS;}
return 0;},_getDecorationEvalContext:function(pillData){return Object.assign(pyUtils.context(),session.user_context,this._getPillEvalContext(pillData),);},_getDiff:function(resizeSnappingWidth,gridOffset){return Math.round(gridOffset/resizeSnappingWidth)*this.viewInfo.activeScaleInfo.interval;},_getPillEvalContext:function(pillData){var pillContext=_.clone(pillData);for(var fieldName in pillContext){if(this.fieldsInfo[fieldName]){var fieldType=this.fieldsInfo[fieldName].type;if(pillContext[fieldName]._isAMomentObject){pillContext[fieldName]=pillContext[fieldName].format(pillContext[fieldName].f);}
else if(fieldType==='date'||fieldType==='datetime'){if(pillContext[fieldName]){pillContext[fieldName]=JSON.parse(JSON.stringify(pillContext[fieldName]));}
continue;}}}
return pillContext;},_getPopoverContext:function(pillID){var data=_.clone(_.findWhere(this.pills,{id:pillID}));data.userTimezoneStartDate=this._convertToUserTime(data[this.state.dateStartField]);data.userTimezoneStopDate=this._convertToUserTime(data[this.state.dateStopField]);return data;},_getResizeSnappingWidth:function(firstCell){if(!this.firstCell){this.firstCell=firstCell||$('.o_gantt_view .o_gantt_header_scale .o_gantt_header_cell:first')[0];}
return this.firstCell.getBoundingClientRect().width/this.cellPart;},_insertIntoSlot:function(){var slotsToFill=this.slots;this.pills.forEach(function(currentPill){var skippedSlots=[];slotsToFill.some(function(currentSlot){var fitsInThisSlot=currentPill.startDate<currentSlot.stop;if(fitsInThisSlot){currentSlot.pills.push(currentPill);}else{skippedSlots.push(currentSlot);}
return fitsInThisSlot;});slotsToFill=_.difference(slotsToFill,skippedSlots);});},_prepareSlots:function(){const{interval,time,cellPrecisions}=this.SCALES[this.state.scale];const precision=this.viewInfo.activeScaleInfo.precision;const cellTime=cellPrecisions[precision];function getSlotStyle(cellPart,subSlotUnavailabilities,isToday){function color(d){if(isToday){return d?'#f4f3ed':'#fffaeb';}
return d?'#e9ecef':'#ffffff';}
const sum=subSlotUnavailabilities.reduce((acc,d)=>acc+d);if(!sum){return'';}
if(cellPart===sum){return`background: ${color(1)}`;}
if(cellPart===2){const[c0,c1]=subSlotUnavailabilities.map(color);return`background: linear-gradient(90deg, ${c0} 49%, ${c1} 50%);`}
if(cellPart===4){const[c0,c1,c2,c3]=subSlotUnavailabilities.map(color);return`background: linear-gradient(90deg, ${c0} 24%, ${c1} 25%, ${c1} 49%, ${c2} 50%, ${c2} 74%, ${c3} 75%);`}}
this.slots=[];let index=0;for(const date of this.viewInfo.slots){const slotStart=date;const slotStop=date.clone().add(1,interval);const isToday=date.isSame(new Date(),'day')&&this.state.scale!=='day';let slotStyle='';if(!this.isGroup&&this.unavailabilities.slice(index).length){let subSlotUnavailabilities=[];for(let j=0;j<this.cellPart;j++){const subSlotStart=date.clone().add(j*cellTime,time);const subSlotStop=date.clone().add((j+1)*cellTime,time).subtract(1,'seconds');let subSlotUnavailable=0;for(let i=index;i<this.unavailabilities.length;i++){let u=this.unavailabilities[i];if(subSlotStop>u.stopDate){index++;}else if(u.startDate<=subSlotStart){subSlotUnavailable=1;break;}}
subSlotUnavailabilities.push(subSlotUnavailable);}
slotStyle=getSlotStyle(this.cellPart,subSlotUnavailabilities,isToday);}
this.slots.push({isToday:isToday,style:slotStyle,hasButtons:!this.isGroup&&!this.isTotal,start:slotStart,stop:slotStop,pills:[],});}},_saveDragChanges:function(pillId,diff,oldGroupId,newGroupId,action){this.trigger_up('pill_dropped',{pillId:pillId,diff:diff,oldGroupId:oldGroupId,newGroupId:newGroupId,groupLevel:this.groupLevel,action:action,});},_saveResizeChanges:function(pillID,resizeDiff,direction){var pill=_.findWhere(this.pills,{id:pillID});var data={id:pillID};if(direction==='left'){data.field=this.state.dateStartField;data.date=pill[this.state.dateStartField].clone().subtract(resizeDiff,this.viewInfo.activeScaleInfo.time);}else{data.field=this.state.dateStopField;data.date=pill[this.state.dateStopField].clone().add(resizeDiff,this.viewInfo.activeScaleInfo.time);}
this.trigger_up('pill_resized',data);},_setDraggable:function($pill){if($pill.hasClass('ui-draggable-dragging')){return;}
var self=this;var pill=_.findWhere(this.pills,{id:$pill.data('id')});if(this.options.canEdit&&!pill.disableStartResize&&!pill.disableStopResize&&!this.isGroup){const resizeSnappingWidth=this._getResizeSnappingWidth();if($pill.draggable("instance")){return;}
if(!this.$containment){this.$containment=$('#o_gantt_containment');}
$pill.draggable({containment:this.$containment,start:function(event,ui){self.trigger_up('updating_pill_started');const pillWidth=$pill[0].getBoundingClientRect().width;ui.helper.css({width:pillWidth});ui.helper.removeClass('position-relative');self.trigger_up('start_dragging',{$draggedPill:$pill,$draggedPillClone:ui.helper,});self.$el.addClass('o_gantt_dragging');$pill.popover('hide');self.$('.o_gantt_pill').popover('disable');},drag:function(event,ui){if($(event.target).hasClass('o_gantt_pill_editing')){return false;}
var diff=self._getDiff(resizeSnappingWidth,ui.position.left);self._updateResizeBadge(ui.helper,diff,ui);const pointObject={x:event.pageX,y:event.pageY};const options={container:document.body};const $el=$.nearest(pointObject,'.o_gantt_hoverable',options).first();if($el.length){$('.o_gantt_hoverable').removeClass('ui-drag-hover');$el.addClass('ui-drag-hover');}},stop:function(){self.trigger_up('updating_pill_stopped');self.trigger_up('stop_dragging');self.$('.ui-drag-hover').removeClass('ui-drag-hover');self.$el.removeClass('o_gantt_dragging');self.$('.o_gantt_pill').popover('enable');},helper:'clone',});}else{if($pill.draggable("instance")){return;}
if(!this.$lockIndicator){this.$lockIndicator=$('<div class="fa fa-lock"/>').css({'z-index':20,position:'absolute',top:'4px',right:'4px',});}
$pill.draggable({grid:[0,0],start:function(){self.trigger_up('updating_pill_started');self.trigger_up('start_no_dragging');$pill.popover('hide');self.$('.o_gantt_pill').popover('disable');self.$lockIndicator.appendTo($pill);},drag:function(){if($(event.target).hasClass('o_gantt_pill_editing')){return false;}},stop:function(){self.trigger_up('updating_pill_stopped');self.trigger_up('stop_no_dragging');self.$('.o_gantt_pill').popover('enable');self.$lockIndicator.detach();},});$pill.addClass('o_fake_draggable');}},_setResizable:function($pill){if($pill.hasClass('ui-resizable')){return;}
var self=this;var pillHeight=this.$('.o_gantt_pill:first').height();var pill=_.findWhere(self.pills,{id:$pill.data('id')});const resizeSnappingWidth=this._getResizeSnappingWidth();var handles=[];if(!pill.disableStartResize){handles.push('w');}
if(!pill.disableStopResize){handles.push('e');}
if(handles.length&&!self.options.disableResize&&!self.isGroup&&self.options.canEdit){$pill.resizable({handles:handles.join(', '),odoo_isRTL:this.isRTL,grid:[resizeSnappingWidth,pillHeight],start:function(){$pill.popover('hide');self.$('.o_gantt_pill').popover('disable');self.trigger_up('updating_pill_started');self.$el.addClass('o_gantt_dragging');},resize:function(event,ui){var diff=Math.round((ui.size.width-ui.originalSize.width)/resizeSnappingWidth*self.viewInfo.activeScaleInfo.interval);self._updateResizeBadge($pill,diff,ui);},stop:function(event,ui){setTimeout(()=>{self.trigger_up('updating_pill_stopped');self.$el.removeClass('o_gantt_dragging');self.$('.o_gantt_pill').popover('enable');});var diff=Math.round((ui.size.width-ui.originalSize.width)/resizeSnappingWidth*self.viewInfo.activeScaleInfo.interval);var direction=ui.position.left?'left':'right';if(diff){self._saveResizeChanges(pill.id,diff,direction);}},});}},_snapToGrid:function(timeSpans){var self=this;var interval=this.viewInfo.activeScaleInfo.interval;switch(this.state.scale){case'day':timeSpans.forEach(function(span){var snappedStartDate=self._snapMinutes(span.startDate,interval);var snappedStopDate=self._snapMinutes(span.stopDate,interval);var minuteDiff=snappedStartDate.diff(snappedStopDate,'minute');if(minuteDiff===0){if(snappedStartDate>span.startDate){span.startDate=snappedStartDate.subtract(interval,'minute');span.stopDate=snappedStopDate;}else{span.startDate=snappedStartDate;span.stopDate=snappedStopDate.add(interval,'minute');}}else{span.startDate=snappedStartDate;span.stopDate=snappedStopDate;}});break;case'week':case'month':timeSpans.forEach(function(span){var snappedStartDate=self._snapHours(span.startDate,interval);var snappedStopDate=self._snapHours(span.stopDate,interval);var hourDiff=snappedStartDate.diff(snappedStopDate,'hour');if(hourDiff===0){if(snappedStartDate.diff(span.startDate,'hours')>2&&span.stopDate.diff(snappedStopDate,'hours')>2){span.startDate=snappedStartDate.subtract(interval,'hour');span.stopDate=snappedStopDate.add(interval,'hour');}else if(snappedStartDate>span.startDate){span.startDate=snappedStartDate.subtract(interval,'hour');span.stopDate=snappedStopDate;}else{span.startDate=snappedStartDate;span.stopDate=snappedStopDate.add(interval,'hour');}}else{if(snappedStartDate.diff(span.startDate,'hours')>2){snappedStartDate=snappedStartDate.subtract(interval,'hour');}
if(span.stopDate.diff(snappedStopDate,'hours')>2){snappedStopDate=snappedStopDate.add(interval,'hour');}
span.startDate=snappedStartDate;span.stopDate=snappedStopDate;}});break;case'year':timeSpans.forEach(function(span){span.startDate=span.startDate.clone().startOf('month');span.stopDate=span.stopDate.clone().endOf('month');});break;default:break;}},_snapHours:function(date,interval){var snappedHours=Math.round(date.clone().hour()/interval)*interval;return date.clone().hour(snappedHours).minute(0).second(0);},_snapMinutes:function(date,interval){var snappedMinutes=Math.round(date.clone().minute()/interval)*interval;return date.clone().minute(snappedMinutes).second(0);},_updateResizeBadge:function($pill,diff,ui){$pill.find('.o_gantt_pill_resize_badge').remove();if(diff){var direction=ui.position.left?'left':'right';$(QWeb.render('GanttView.ResizeBadge',{diff:diff,direction:direction,time:this.viewInfo.activeScaleInfo.time,}),{css:{'z-index':2}}).appendTo($pill);}},_onButtonAddClicked:function(ev){var date=moment($(ev.currentTarget).closest('.o_gantt_cell').data('date'));this.trigger_up('add_button_clicked',{date:date,groupId:this.groupId,});},_onButtonPlanClicked:function(ev){var date=moment($(ev.currentTarget).closest('.o_gantt_cell').data('date'));this.trigger_up('plan_button_clicked',{date:date,groupId:this.groupId,});},_onMouseMove:function(ev){if((this.options.canCreate||this.options.canEdit)&&!this.$el[0].classList.contains('o_gantt_dragging')){var elementsFromPoint=function(x,y){if(document.elementsFromPoint)
return document.elementsFromPoint(x,y);if(document.msElementsFromPoint){return Array.prototype.slice.call(document.msElementsFromPoint(x,y));}};var hoveredCell;if(ev.target.classList.contains('o_gantt_pill')||ev.target.parentNode.classList.contains('o_gantt_pill')){elementsFromPoint(ev.pageX,ev.pageY).some(function(element){return element.classList.contains('o_gantt_cell')?((hoveredCell=element),true):false;});}else{hoveredCell=ev.currentTarget;}
if(hoveredCell&&hoveredCell!=this.lastHoveredCell){if(this.lastHoveredCell){this.lastHoveredCell.classList.remove('o_hovered');}
hoveredCell.classList.add('o_hovered');this.lastHoveredCell=hoveredCell;}}},_onMouseLeave:function(){this.$(".o_gantt_cell.o_hovered").removeClass('o_hovered');this.lastHoveredCell=undefined;},_onPillClicked:function(ev){if(!this.isGroup){this.trigger_up('pill_clicked',{target:$(ev.currentTarget),});}},_onPillEntered:function(ev){var $pill=$(ev.currentTarget);this._setResizable($pill);if(!this.isTotal){this._setDraggable($pill);}
if(!this.isGroup){this._bindPillPopover(ev.target);}},_onRowSidebarClicked:function(){if(this.isGroup&!this.isTotal){if(this.isOpen){this.trigger_up('collapse_row',{rowId:this.rowId});}else{this.trigger_up('expand_row',{rowId:this.rowId});}}},});return GanttRow;});;

/* /web_grid/static/src/js/grid_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_grid.GridView',function(require){"use strict";var AbstractView=require('web.AbstractView');var config=require('web.config');var core=require('web.core');var GridModel=require('web_grid.GridModel');var GridController=require('web_grid.GridController');var GridRenderer=require('web_grid.GridRenderer');var viewRegistry=require('web.view_registry');var pyUtils=require('web.py_utils');const RendererWrapper=require('web.RendererWrapper');var session=require('web.session');var _t=core._t;var _lt=core._lt;var GridView=AbstractView.extend({display_name:_lt('Grid'),mobile_friendly:true,icon:'fa-th',config:_.extend({},AbstractView.prototype.config,{Model:GridModel,Controller:GridController,Renderer:GridRenderer,}),viewType:'grid',init:function(viewInfo,params){var self=this;this._super.apply(this,arguments);var arch=this.arch;var fields=this.fields;var rowFields=[];var sectionField,colField,cellField,ranges,cellComponent,cellComponentOptions,measureLabel,readonlyField;_.each(arch.children,function(child){if(child.tag==='field'){if(child.attrs.type==='row'){if(child.attrs.section==='1'&&!sectionField){sectionField=child.attrs.name;}
rowFields.push(child.attrs.name);}
if(child.attrs.type==='col'){colField=child.attrs.name;ranges=self._extract_ranges(child,params.context);}
if(child.attrs.type==='measure'){cellField=child.attrs.name;cellComponent=child.attrs.widget;if(child.attrs.options){cellComponentOptions=JSON.parse(child.attrs.options.replace(/'/g,'"'));}
measureLabel=child.attrs.string;}
if(child.attrs.type==='readonly'){readonlyField=child.attrs.name;}}});this.loadParams.ranges=ranges;var contextRangeName=params.context.grid_range;var contextRange=contextRangeName&&_.findWhere(ranges,{name:contextRangeName});this.loadParams.fields=this.fields;this.loadParams.currentRange=contextRange||ranges[0];this.loadParams.rowFields=rowFields;this.loadParams.sectionField=sectionField;this.loadParams.colField=colField;this.loadParams.cellField=cellField;this.loadParams.groupedBy=params.groupBy;this.loadParams.readonlyField=readonlyField;this.rendererParams.canCreate=this.controllerParams.activeActions.create;this.rendererParams.fields=fields;this.rendererParams.measureLabel=measureLabel;this.rendererParams.editableCells=!!(this.controllerParams.activeActions.edit&&arch.attrs.adjustment);this.rendererParams.cellComponent=cellComponent;this.rendererParams.cellComponentOptions=cellComponentOptions;this.rendererParams.hideLineTotal=!!JSON.parse(arch.attrs.hide_line_total||'0');this.rendererParams.hideColumnTotal=!!JSON.parse(arch.attrs.hide_column_total||'0');this.rendererParams.hasBarChartTotal=!!JSON.parse(arch.attrs.barchart_total||'0');this.controllerParams.formViewID=false;this.controllerParams.listViewID=false;_.each(params.actionViews,function(view){if(view.type==='form'){self.controllerParams.formViewID=view.viewID;}
if(view.type==='list'){self.controllerParams.listViewID=view.viewID;}});this.controllerParams.context=params.context;this.controllerParams.ranges=ranges;this.controllerParams.currentRange=this.loadParams.currentRange.name;this.controllerParams.navigationButtons=arch.children.filter(function(c){return c.tag==='button';}).map(function(c){return c.attrs;});this.controllerParams.adjustment=arch.attrs.adjustment;this.controllerParams.adjustName=arch.attrs.adjust_name;},getRenderer(parent,state){state=Object.assign({},state,this.rendererParams);return new RendererWrapper(null,this.config.Renderer,state);},_extract_ranges:function(col_node,context){var ranges=[];if(config.device.isMobile){ranges.push({name:'day',string:_t('Day'),span:'day',step:'day',});}
var pyevalContext=py.dict.fromJSON(context||{});_.each(_.pluck(col_node.children,'attrs'),function(range){if(range.invisible&&pyUtils.py_eval(range.invisible,{'context':pyevalContext})){return;}
ranges.push(range);});return ranges;},});viewRegistry.add('grid',GridView);return GridView;});;

/* /web_grid/static/src/js/grid_model.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_grid.GridModel',function(require){"use strict";var AbstractModel=require('web.AbstractModel');var concurrency=require('web.concurrency');var utils=require('web.utils');const{_t}=require('web.core');const GridModel=AbstractModel.extend({init:function(){this._super.apply(this,arguments);this._gridData=null;this.dp=new concurrency.DropPrevious();},computeAllTotals:function(state){state.data.forEach((group,groupIndex)=>{state.data[groupIndex].totals=this._computeTotals(group.grid);});state.totals=this._computeTotals(_.flatten(_.pluck(state.data,'grid'),true));return state;},__get:function(){return this._gridData;},getContext:function(context){var c=_.extend({},this.context,context);return c;},getIds:function(){var data=this._gridData.data;if(!_.isArray(data)){data=[data];}
var domain=[];var cells=0;for(var i=0;i<data.length;i++){var grid=data[i].grid;for(var j=0;j<grid.length;j++){var row=grid[j];for(var k=0;k<row.length;k++){var cell=row[k];if(cell.size!==0){cells++;domain.push.apply(domain,cell.domain);}}}}
if(cells===0){return Promise.resolve([]);}
while(--cells>0){domain.unshift('|');}
return this._rpc({model:this.modelName,method:'search',args:[domain],context:this.getContext(),});},__load:function(params){this.fields=params.fields;this.modelName=params.modelName;this.rowFields=params.rowFields;this.sectionField=params.sectionField;this.colField=params.colField;this.cellField=params.cellField;this.ranges=params.ranges;this.currentRange=params.currentRange;this.domain=params.domain;this.context=params.context;var groupedBy=(params.groupedBy&&params.groupedBy.length)?params.groupedBy:this.rowFields;this.groupedBy=Array.isArray(groupedBy)?groupedBy:[groupedBy];this.readonlyField=params.readonlyField;return this._fetch(this.groupedBy);},__reload:function(handle,params){if(params==='special'){return Promise.resolve();}
params=params||{};if('context'in params){var old_context=this.context;this.context=params.context;if(old_context.grid_anchor!==undefined||params.context.grid_anchor!==undefined){this.context.grid_anchor=old_context.grid_anchor||params.context.grid_anchor;}}
if('domain'in params){this.domain=params.domain;}
if('pagination'in params){_.extend(this.context,params.pagination);}
if('range'in params){this.currentRange=_.findWhere(this.ranges,{name:params.range});}
if('groupBy'in params){if(params.groupBy.length){this.groupedBy=Array.isArray(params.groupBy)?params.groupBy:[params.groupBy];}else{this.groupedBy=this.rowFields;}}
return this._fetch(this.groupedBy);},reloadCell:function(cell,cellField,colField){var self=this;var domain=cell.col.domain.concat(this.domain);var domainRow=cell.row.values;for(var value in domainRow){domain=domain.concat([[value.toString(),'=',domainRow[value][0]]]);}
if(this._gridData.isGrouped){var groupLabel=this._gridData.data[cell.cell_path[0]].__label;domain=domain.concat([[this._gridData.groupBy[0],'=',groupLabel[0]]]);}
return this._rpc({model:this.modelName,method:'read_group',kwargs:{domain:domain,fields:[cellField],groupby:[colField],},context:this.getContext()}).then(function(result){if(result.length===0||!(cellField in result[0])){return Promise.resolve();}
var currentCell=utils.into(self._gridData.data,cell.cell_path);currentCell.value=result[0][cellField];currentCell.size=result[0][colField+'_count'];currentCell.domain=domain;self._gridData=self.computeAllTotals(self._gridData);});},_computeTotals:function(grid){const totals={super:0,rows:{},columns:{}};for(let i=0;i<grid.length;i++){const row=grid[i];for(let j=0;j<row.length;j++){const cell=row[j];totals.super+=cell.value;totals.rows[i]=(totals.rows[i]||0)+cell.value;totals.columns[j]=(totals.columns[j]||0)+cell.value;}}
return totals;},_getRowLabel(row,grouped){let groupBy=this.groupedBy;if(grouped){groupBy=groupBy.slice(1);}
const rowValues=[];for(let i=0;i<groupBy.length;i++){const rowField=groupBy[i];let value=row.values[rowField];const fieldName=rowField.split(':')[0];const fieldType=this.fields[fieldName].type;if(fieldType==='selection'){value=this.fields[fieldName].selection.find(function(choice){return choice[0]===value;});}
value=value&&["many2one","selection"].includes(fieldType)?value[1]:value;rowValues.push(value);}
return rowValues;},_fetch:function(groupBy){if(!this.currentRange){return Promise.resolve();}
if(this.sectionField&&this.sectionField===groupBy[0]){return this._fetchGroupedData(groupBy);}else{return this._fetchUngroupedData(groupBy);}},_fetchGroupedData:async function(groupBy){const d=await this.dp.add(this._rpc({model:this.modelName,method:'read_grid_domain',kwargs:{field:this.colField,range:this.currentRange,},context:this.getContext(),}));const groups=await this.dp.add(this._rpc({model:this.modelName,method:'read_group',kwargs:{domain:d.concat(this.domain||[]),fields:[this.sectionField],groupby:[this.sectionField],},context:this.getContext()}));let prom;if(!groups.length){prom=Promise.all([this._fetchSectionGrid(groupBy,{__domain:this.domain||[],})]);}else{prom=Promise.all((groups||[]).map(group=>{return this._fetchSectionGrid(groupBy,group);}));}
const results=await this.dp.add(prom);if(!(_.isEmpty(results)||_.reduce(results,function(m,it){return _.isEqual(m.cols,it.cols)&&m;}))){throw new Error(_t("The sectioned grid view can't handle groups with different columns sets"));}
results.forEach((group,groupIndex)=>{results[groupIndex].totals=this._computeTotals(group.grid);group.rows.forEach((row,rowIndex)=>{results[groupIndex].rows[rowIndex].label=this._getRowLabel(row,true);});});this._gridData={isGrouped:true,data:results,totals:this._computeTotals(_.flatten(_.pluck(results,'grid'),true)),groupBy,colField:this.colField,cellField:this.cellField,range:this.currentRange.name,context:this.context,};},_fetchSectionGrid:function(groupBy,sectionGroup,additionalContext){var self=this;var rpcProm=this._rpc({model:this.modelName,method:'read_grid',kwargs:{row_fields:groupBy.slice(1),col_field:this.colField,cell_field:this.cellField,range:this.currentRange,domain:sectionGroup.__domain,readonly_field:this.readonlyField,},context:this.getContext(additionalContext),})
rpcProm.then(function(grid){grid.__label=sectionGroup[self.sectionField];});return rpcProm;},_fetchUngroupedData:async function(groupBy){const result=await this.dp.add(this._rpc({model:this.modelName,method:'read_grid',kwargs:{row_fields:groupBy,col_field:this.colField,cell_field:this.cellField,domain:this.domain,range:this.currentRange,readonly_field:this.readonlyField,},context:this.getContext(),}));const rows=result.rows;rows.forEach((row,rowIndex)=>{result.rows[rowIndex].label=this._getRowLabel(row,false);});this._gridData={isGrouped:false,data:[result],totals:this._computeTotals(result.grid),groupBy,colField:this.colField,cellField:this.cellField,range:this.currentRange.name,context:this.context,};},});return GridModel;});;

/* /web_grid/static/src/js/grid_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_grid.GridController',function(require){"use strict";var AbstractController=require('web.AbstractController');var config=require('web.config');var core=require('web.core');var dialogs=require('web.view_dialogs');var utils=require('web.utils');var concurrency=require('web.concurrency');var qweb=core.qweb;var _t=core._t;var GridController=AbstractController.extend({custom_events:Object.assign({},AbstractController.prototype.custom_events,{'cell_edited':'_onCellEdited','cell_edited_temporary':'_onCellEditedTemporary','open_cell_information':'_onOpenCellInformation',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.context=params.context;this.navigationButtons=params.navigationButtons;this.ranges=params.ranges;this.currentRange=params.currentRange;this.formViewID=params.formViewID;this.listViewID=params.listViewID;this.adjustment=params.adjustment;this.adjustName=params.adjustName;this.canCreate=params.activeActions.create;this.mutex=new concurrency.Mutex();},renderButtons:function($node){this.$buttons=$(qweb.render('grid.GridArrows',{widget:{_ranges:this.ranges,_buttons:this.navigationButtons,allowCreate:this.canCreate,},isMobile:config.device.isMobile}));this.$buttons.on('click','.o_grid_button_add',this._onAddLine.bind(this));this.$buttons.on('click','.grid_arrow_previous',this._onPaginationChange.bind(this,'prev'));this.$buttons.on('click','.grid_button_initial',this._onPaginationChange.bind(this,'initial'));this.$buttons.on('click','.grid_arrow_next',this._onPaginationChange.bind(this,'next'));this.$buttons.on('click','.grid_arrow_range',this._onRangeChange.bind(this));this.$buttons.on('click','.grid_arrow_button',this._onButtonClicked.bind(this));this.updateButtons();if($node){this.$buttons.appendTo($node);}},updateButtons:function(){if(!this.$buttons){return;}
const state=this.model.get();this.$buttons.find('.grid_arrow_previous').toggleClass('d-none',!state.data[0].prev);this.$buttons.find('.grid_arrow_next').toggleClass('d-none',!state.data[0].next);this.$buttons.find('.grid_button_initial').toggleClass('d-none',!state.data[0].initial);this.$buttons.find('.grid_arrow_range').removeClass('active');this.$buttons.find('.grid_arrow_range[data-name='+this.currentRange+']').addClass('active');},_adjust:function(cell,newValue){var difference=newValue-cell.value;if(Math.abs(difference)<1e-6){return Promise.resolve();}
var state=this.model.get();var domain=this.model.domain.concat(cell.row.domain);var self=this;return this.mutex.exec(function(){return self._rpc({model:self.modelName,method:self.adjustName,args:[[],domain,state.colField,cell.col.values[state.colField][0],state.cellField,difference],context:self.model.getContext()}).then(function(){return self.model.reloadCell(cell,state.cellField,state.colField);}).then(function(){var state=self.model.get();return self.renderer.update(state);}).then(function(){self.updateButtons(state);});});},_update:function(){return this._super.apply(this,arguments).then(this.updateButtons.bind(this));},_onAddLine:function(event){event.preventDefault();var context=this.model.getContext();var formContext=_.extend({},context,{view_grid_add_line:true});var formViewID=context.quick_create_view||this.formViewID||false;new dialogs.FormViewDialog(this,{res_model:this.modelName,res_id:false,context:formContext,view_id:formViewID,title:_t("Add a Line"),disable_multiple_selection:true,on_saved:this.reload.bind(this,{}),}).open();},_onCellEdited:function(event){var state=this.model.get();this._adjust({row:utils.into(state.data,event.data.row_path),col:utils.into(state.data,event.data.col_path),value:utils.into(state.data,event.data.cell_path).value,cell_path:event.data.cell_path,},event.data.value).then(function(){if(event.data.doneCallback!==undefined){event.data.doneCallback();}}).guardedCatch(function(){if(event.data.doneCallback!==undefined){event.data.doneCallback();}});},_onCellEditedTemporary:function(event){var state=this.model.get();var oldValue=utils.into(state.data,event.data.cell_path).value;utils.into(state.data,event.data.cell_path).value=event.data.value;state=this.model.computeAllTotals(state);utils.into(state.data,event.data.cell_path).value=oldValue;this.renderer.update(state);},_onButtonClicked:function(e){var self=this;e.stopPropagation();var button=this.navigationButtons[$(e.target).attr('data-index')];var actionData=_.extend({},button,{context:this.model.getContext(button.context),});this.model.getIds().then(function(ids){self.trigger_up('execute_action',{action_data:actionData,env:{context:self.model.getContext(),model:self.modelName,resIDs:ids,},on_closed:self.reload.bind(self,{}),});});},_onOpenCellInformation:function(ev){var self=this;var cell_path=ev.data.path.split('.');var row_path=cell_path.slice(0,-3).concat(['rows'],cell_path.slice(-2,-1));var state=this.model.get();var cell=utils.into(state.data,cell_path);var row=utils.into(state.data,row_path);var groupFields=state.groupBy.slice(state.isGrouped?1:0);var label=_.filter(_.map(groupFields,function(g){return row.values[g][1];}),function(g){return g;}).join(': ');var cols_path=cell_path.slice(0,-3).concat(['cols'],cell_path.slice(-1));var col=utils.into(state.data,cols_path);var column_value=col.values[state.colField][0];if(!column_value){column_value=false;}else if(!_.isNumber(column_value)){column_value=column_value.split("/")[0];}
var ctx=_.extend({},this.context);var sectionField=_.find(this.renderer.fields,function(res){return self.model.sectionField===res.name;});if(this.model.sectionField&&state.groupBy&&state.groupBy[0]===this.model.sectionField){var value=state.data[parseInt(cols_path[0])].__label;ctx['default_'+this.model.sectionField]=_.isArray(value)?value[0]:value;}
_.each(groupFields,function(field){ctx['default_'+field]=row.values[field][0]||false;});ctx['default_'+state.colField]=column_value;ctx['create']=this.canCreate&&!cell.readonly;ctx['edit']=this.activeActions.edit&&!cell.readonly;this.do_action({type:'ir.actions.act_window',name:label,res_model:this.modelName,views:[[this.listViewID,'list'],[this.formViewID,'form']],domain:cell.domain,context:ctx,});},_onPaginationChange:function(dir){var state=this.model.get();this.update({pagination:state.data[0][dir]});},_onRangeChange:function(e){e.stopPropagation();var $target=$(e.target);if(config.device.isMobile){$target.closest(".dropdown-menu").prev().dropdown("toggle");}
if($target.hasClass('active')){return;}
this.currentRange=$target.attr('data-name');this.update({range:this.currentRange});},});return GridController;});;

/* /web_grid/static/src/js/grid_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_grid.GridRenderer',function(require){"use strict";const AbstractRenderer=require('web.AbstractRendererOwl');const fieldUtils=require('web.field_utils');const utils=require('web.utils');const gridComponentRegistry=require('web_grid.component_registry');const{useListener}=require('web.custom_hooks');const{useRef,useState}=owl.hooks;class GridRenderer extends AbstractRenderer{constructor(parent,props){super(parent,props);this.state=useState({editMode:false,currentPath:"",errors:{},});this.currentInput=useRef("currentInput");useListener('mouseover','td:not(:first-child), th:not(:first-child)',this._onMouseEnter);useListener('mouseout','td:not(:first-child), th:not(:first-child)',this._onMouseLeave);}
willUpdateProps(nextProps){if(nextProps.data[0].next.grid_anchor!==this.props.data[0].next.grid_anchor){this.state.errors={};}}
patched(){if(this.currentInput.el){this.currentInput.el.select();}}
get columns(){return this.props.data.length?this.props.data[0].cols:[];}
get component(){return gridComponentRegistry.get(this.props.cellComponent);}
get gridAnchorNext(){return this.props.data[0].next.grid_anchor;}
get emptyRows(){return Array.from({length:Math.max(5-this.props.data[0].rows.length,0)},(_,i)=>i);}
get formatType(){if(this.hasComponent){return this.component.formatType;}
return this.props.fields[this.props.cellField].type;}
get hasComponent(){return gridComponentRegistry.contains(this.props.cellComponent);}
get gridTotal(){if(this.props.totals.super){const classMap={'o_grid_super':true,'text-danger':this.props.totals.super<0,};const value=this.props.totals.super;return{classMap,value};}else{return{classMap:{o_grid_super:true},value:0.0};}}
get measureLabel(){if(this.props.measureLabel){return _.str.sprintf("%s",this.props.measureLabel);}else{return this.env._t("Total");}}
get noContentHelper(){return utils.json_node_to_xml(this.props.noContentHelper);}
get showNoContentHelp(){const state=Array.isArray(this.props.data)?this.props.data[0]:this.props.data;return state.rows[0]===undefined&&!!this.props.noContentHelp;}
_cellEdited(path,value,doneCallback){const cell_path=path.split('.');const grid_path=cell_path.slice(0,-3);const row_path=grid_path.concat(['rows'],cell_path.slice(-2,-1));const col_path=grid_path.concat(['cols'],cell_path.slice(-1));this.trigger('cell-edited',{cell_path,row_path,col_path,value,doneCallback,});}
_format(value){if(value===undefined){return'';}
const cellField=this.props.fields[this.props.cellField];return fieldUtils.format[this.formatType](value,cellField,this.props.cellComponentOptions);}
_formatCellContentTotals(index){if(this.props.totals){return{value:this.props.totals.columns[index],smallerThanZero:this.props.totals.columns[index]<0,muted:!this.props.totals.columns||!this.props.totals.columns[index]};}else{return{};}}
_getCellClassMap(cell){const classmap={o_grid_cell_container:true,o_grid_cell_empty:!cell.size,o_grid_cell_readonly:!this.props.editableCells||cell.readonly,};for(const cls of cell.classes||[]){if(!(cls in classmap)){classmap[cls]=true;}}
return classmap;}
_parse(value){const cellField=this.props.fields[this.props.cellField];return fieldUtils.parse[this.formatType](value,cellField,this.props.cellComponentOptions);}
_totalHeight(index){const maxCount=Math.max(...Object.values(this.props.totals.columns));const factor=maxCount?(90/maxCount):0;return factor*this.props.totals.columns[index];}
_onClickCellInformation(path){this.state.editMode=false;this.trigger('open-cell-information',{path});}
_onFocusComponent(ev){this.state.editMode=true;this.state.currentPath=ev.detail.path;}
_onFocusGridCell(path){this.state.editMode=true;this.state.currentPath=path;}
_onGridInputBlur(ev){this.state.editMode=false;let hasError=false;let value=ev.target.value;try{value=this._parse(value);}catch(_){hasError=true;}
const path=this.state.currentPath;if(hasError){this.state.errors[path]=value;}else{delete this.state.errors[path];this._cellEdited(path,value);}}
_onUpdateValue(ev){this.state.editMode=false;const value=ev.detail.value;const doneCallback=ev.detail.doneCallback;const path=ev.detail.path;if(value!==undefined){this._cellEdited(path,value,doneCallback);}}
_onUpdateValueTemporary(ev){const value=ev.detail.value;const path=ev.detail.path;const cell_path=path.split('.');const grid_path=cell_path.slice(0,-3);const row_path=grid_path.concat(['rows'],cell_path.slice(-2,-1));const col_path=grid_path.concat(['cols'],cell_path.slice(-1));this.trigger('cell-edited-temporary',{cell_path,row_path,col_path,value});}
_onMouseEnter(ev){const cellParent=ev.target.closest('td,th');const rowParent=ev.target.closest('tr');const index=[...rowParent.children].indexOf(cellParent)+1;this.el.querySelectorAll(`td:nth-child(${index}), th:nth-child(${index})`).forEach(el=>el.classList.add('o_cell_hover'));}
_onMouseLeave(){this.el.querySelectorAll('.o_cell_hover').forEach(el=>el.classList.remove('o_cell_hover'));}}
GridRenderer.defaultProps={cellComponentOptions:{},hasBarChartTotal:false,hideColumnTotal:false,hideLineTotal:false,};GridRenderer.props={editableCells:{type:Boolean,optional:true},canCreate:Boolean,cellComponent:{type:String,optional:true},cellComponentOptions:Object,cellField:String,colField:String,fields:Object,groupBy:Array,hasBarChartTotal:Boolean,hideColumnTotal:Boolean,hideLineTotal:Boolean,measureLabel:{type:String,optional:true},noContentHelp:{type:String,optional:true},range:String,context:Object,arch:Object,isEmbedded:Boolean,isGrouped:Boolean,data:[{cols:[{values:Object,domain:Array,is_current:Boolean,is_unavailable:Boolean,}],grid:[{size:Number,domain:Array,value:Number,readonly:{type:Boolean,optional:true},is_current:Boolean,is_unavailable:Boolean,}],initial:Object,next:Object,prev:Object,rows:[{values:Object,domain:Array,project:Object,label:Array}],totals:{columns:Object,rows:Object,super:Number},__label:Array}],totals:Object,};GridRenderer.template='web_grid.GridRenderer';return GridRenderer;});;

/* /web_grid/static/src/js/grid_components.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_grid.components',function(require){"use strict";const fieldUtils=require('web.field_utils');const utils=require('web.utils');const{useRef,useState}=owl.hooks;class BaseGridComponent extends owl.Component{constructor(){super(...arguments);this.currentInput=useRef("currentInput");this.state=useState({error:false,});}
willUpdateProps(nextProps){if(nextProps.date!==this.props.date){this.state.error=false;}}
patched(){if(this.currentInput.el){this.currentInput.el.select();}}
get fieldOptions(){return this.props.nodeOptions;}
get formatType(){return this.constructor.formatType||this.props.fieldInfo.type;}
_format(value){return fieldUtils.format[this.formatType](value,{},this.fieldOptions);}
_parse(value){return fieldUtils.parse[this.formatType](value,{},this.fieldOptions);}
_onBlurCell(ev){let value;try{value=this._parse(ev.target.value);this.state.error=false;}catch(_){this.state.error=ev.target.value;}finally{this.trigger('grid-cell-update',{path:this.props.path,value});}}
_onFocusCell(){this.trigger('grid-cell-focus',{path:this.props.path});}}
BaseGridComponent.defaultProps={cellHeight:0,cellValue:0,hasBarChartTotal:false,readonly:false,isTotal:false,nodeOptions:{}};BaseGridComponent.props={cellHeight:{type:Number,optional:true},cellValue:{type:Number,optional:true},fieldInfo:Object,hasBarChartTotal:Boolean,isInput:Boolean,nodeOptions:Object,path:{type:String,optional:true},readonly:Boolean,isTotal:{type:Boolean,optional:true},date:{type:String,optional:true},};BaseGridComponent.template='web_grid.BaseGridComponent';BaseGridComponent.formatType='float_factor';class FloatFactorComponent extends BaseGridComponent{}
class FloatTimeComponent extends BaseGridComponent{get fieldOptions(){return Object.assign({},super.fieldOptions,{noLeadingZeroHour:true,});}}
FloatTimeComponent.formatType='float_time';class FloatToggleComponent extends BaseGridComponent{constructor(){super(...arguments);this.state=useState({disabled:false,value:this.initialValue,});}
willUpdateProps(nextProps){if(nextProps.cellValue!==this.initialValue){this.state.value=nextProps.cellValue;}}
get fieldOptions(){const fieldOptions=Object.assign({},this.props.nodeOptions);if(!fieldOptions.factor){fieldOptions.factor=1;}
const range=[0.0,0.5,1.0];if(!fieldOptions.range){fieldOptions.range=range;}
return fieldOptions;}
get initialValue(){return this.props.cellValue;}
_onBlurButton(){if(this.state.value!==this.initialValue){this.state.disabled=true;this.trigger('grid-cell-update',{path:this.props.path,value:this.state.value,doneCallback:()=>{this.state.disabled=false;}});}}
_onClickButton(){const range=this.fieldOptions.range;const currentFloat=parseFloat(this._format(this.state.value));const closest=utils.closestNumber(currentFloat,range);const closestIndex=range.indexOf(closest);const nextIndex=closestIndex+1<range.length?closestIndex+1:0;this.state.value=this._parse(range[nextIndex].toString());this.trigger('grid-cell-update-temporary',{path:this.props.path,value:this.state.value});}}
FloatToggleComponent.template='web_grid.FloatToggleComponent';return{BaseGridComponent,FloatFactorComponent,FloatTimeComponent,FloatToggleComponent,};});;

/* /web_grid/static/src/js/grid_component_registry.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_grid.component_registry',function(require){"use strict";const Registry=require('web.Registry');return new Registry();});odoo.define('web_grid._component_registry',function(require){"use strict";const components=require('web_grid.components');const registry=require('web_grid.component_registry');registry.add('float_factor',components.FloatFactorComponent).add('float_time',components.FloatTimeComponent).add('float_toggle',components.FloatToggleComponent);});;

/* /web_kanban_gauge/static/src/js/kanban_gauge.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_kanban_gauge.widget',function(require){"use strict";var AbstractField=require('web.AbstractField');var core=require('web.core');var field_registry=require('web.field_registry');var utils=require('web.utils');var _t=core._t;var GaugeWidget=AbstractField.extend({className:"oe_gauge",jsLibs:['/web/static/lib/Chart/Chart.js',],_render:function(){var val=this.value;if(_.isArray(JSON.parse(val))){val=JSON.parse(val);}
var gauge_value=_.isArray(val)&&val.length?val[val.length-1].value:val;if(this.nodeOptions.gauge_value_field){gauge_value=this.recordData[this.nodeOptions.gauge_value_field];}
var max_value=this.nodeOptions.max_value||100;if(this.nodeOptions.max_field){max_value=this.recordData[this.nodeOptions.max_field];}
max_value=Math.max(gauge_value,max_value);var label=this.nodeOptions.label||"";if(this.nodeOptions.label_field){label=this.recordData[this.nodeOptions.label_field];}
var title=this.nodeOptions.title||this.field.string;var maxLabel=max_value;if(gauge_value===0&&max_value===0){max_value=1;maxLabel=0;}
var config={type:'doughnut',data:{datasets:[{data:[gauge_value,max_value-gauge_value],backgroundColor:["#1f77b4","#dddddd"],label:title}],},options:{circumference:Math.PI,rotation:-Math.PI,responsive:true,tooltips:{displayColors:false,callbacks:{label:function(tooltipItems){if(tooltipItems.index===0){return _t('Value: ')+gauge_value;}
return _t('Max: ')+maxLabel;},},},title:{display:true,text:title,padding:4,},layout:{padding:{bottom:5}},maintainAspectRatio:false,cutoutPercentage:70,}};this.$canvas=$('<canvas/>');this.$el.empty();this.$el.append(this.$canvas);this.$el.attr('style',this.nodeOptions.style);this.$el.css({position:'relative'});var context=this.$canvas[0].getContext('2d');this.chart=new Chart(context,config);var humanValue=utils.human_number(gauge_value,1);var $value=$('<span class="o_gauge_value">').text(humanValue);$value.css({'text-align':'center',position:'absolute',left:0,right:0,bottom:'6px','font-weight':'bold'});this.$el.append($value);},});field_registry.add("gauge",GaugeWidget);return GaugeWidget;});;

/* /web_tour/static/src/js/debug_manager.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_tour.DebugManager.Backend',function(require){"use strict";var core=require("web.core");var DebugManager=require('web.DebugManager.Backend');var Dialog=require("web.Dialog");var local_storage=require('web.local_storage');var tour=require('web_tour.tour');var utils=require('web_tour.utils');var get_debugging_key=utils.get_debugging_key;function get_active_tours(){return _.difference(_.keys(tour.tours),tour.consumed_tours);}
DebugManager.include({start:function(){this.consume_tours_enabled=get_active_tours().length>0;return this._super.apply(this,arguments);},consume_tours:function(){var active_tours=get_active_tours();if(active_tours.length>0){this._rpc({model:'web_tour.tour',method:'consume',args:[active_tours],}).then(function(){for(const tourName of active_tours){local_storage.removeItem(get_debugging_key(tourName));}
window.location.reload();});}},start_tour:async function(){const tours=Object.values(tour.tours).sort((t1,t2)=>{return(t1.sequence-t2.sequence)||(t1.name<t2.name?-1:1);});const dialog=new Dialog(this,{title:'Tours',$content:core.qweb.render('web_tour.ToursDialog',{onboardingTours:tours.filter(t=>!t.test),testingTours:tours.filter(t=>t.test),}),});await dialog.open().opened();dialog.$('.o_start_tour').on('click',this._onStartTour.bind(this));dialog.$('.o_test_tour').on('click',this._onTestTour.bind(this));},_onStartTour(ev){ev.preventDefault();tour.reset($(ev.target).data('name'));},_onTestTour(ev){ev.preventDefault();tour.run($(ev.target).data('name'));},});});;

/* /barcodes/static/src/js/barcode_parser.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('barcodes.BarcodeParser',function(require){"use strict";var Class=require('web.Class');var rpc=require('web.rpc');var BarcodeParser=Class.extend({init:function(attributes){this.nomenclature_id=attributes.nomenclature_id;this.loaded=this.load();},load:function(){var self=this;if(!this.nomenclature_id){return;}
var id=this.nomenclature_id[0];return rpc.query({model:'barcode.nomenclature',method:'read',args:[[id],['name','rule_ids','upc_ean_conv']],}).then(function(nomenclatures){self.nomenclature=nomenclatures[0];var args=[[['barcode_nomenclature_id','=',self.nomenclature.id]],['name','sequence','type','encoding','pattern','alias'],];return rpc.query({model:'barcode.rule',method:'search_read',args:args,});}).then(function(rules){rules=rules.sort(function(a,b){return a.sequence-b.sequence;});self.nomenclature.rules=rules;});},is_loaded:function(){return this.loaded;},ean_checksum:function(ean){var code=ean.split('');if(code.length!==13){return-1;}
var oddsum=0,evensum=0,total=0;code=code.reverse().splice(1);for(var i=0;i<code.length;i++){if(i%2===0){oddsum+=Number(code[i]);}else{evensum+=Number(code[i]);}}
total=oddsum*3+evensum;return Number((10-total%10)%10);},ean8_checksum:function(ean){var code=ean.split('');if(code.length!==8){return-1;}
var sum1=Number(code[1])+Number(code[3])+Number(code[5]);var sum2=Number(code[0])+Number(code[2])+Number(code[4])+Number(code[6]);var total=sum1+3*sum2;return Number((10-total%10)%10);},check_ean:function(ean){return/^\d+$/.test(ean)&&this.ean_checksum(ean)===Number(ean[ean.length-1]);},check_encoding:function(barcode,encoding){var len=barcode.length;var allnum=/^\d+$/.test(barcode);var check=Number(barcode[len-1]);if(encoding==='ean13'){return len===13&&allnum&&this.ean_checksum(barcode)===check;}else if(encoding==='ean8'){return len===8&&allnum&&this.ean8_checksum(barcode)===check;}else if(encoding==='upca'){return len===12&&allnum&&this.ean_checksum('0'+barcode)===check;}else if(encoding==='any'){return true;}else{return false;}},sanitize_ean:function(ean){ean=ean.substr(0,13);for(var n=0,count=(13-ean.length);n<count;n++){ean='0'+ean;}
return ean.substr(0,12)+this.ean_checksum(ean);},sanitize_upc:function(upc){return this.sanitize_ean('0'+upc).substr(1,12);},match_pattern:function(barcode,pattern,encoding){var match={value:0,base_code:barcode,match:false,};barcode=barcode.replace("\\","\\\\").replace("{",'\{').replace("}","\}").replace(".","\.");var numerical_content=pattern.match(/[{][N]*[D]*[}]/);var base_pattern=pattern;if(numerical_content){var num_start=numerical_content.index;var num_length=numerical_content[0].length;var value_string=barcode.substr(num_start,num_length-2);var whole_part_match=numerical_content[0].match("[{][N]*[D}]");var decimal_part_match=numerical_content[0].match("[{N][D]*[}]");var whole_part=value_string.substr(0,whole_part_match.index+whole_part_match[0].length-2);var decimal_part="0."+value_string.substr(decimal_part_match.index,decimal_part_match[0].length-1);if(whole_part===''){whole_part='0';}
match['value']=parseInt(whole_part)+parseFloat(decimal_part);match['base_code']=barcode.substr(0,num_start);var base_pattern=pattern.substr(0,num_start);for(var i=0;i<(num_length-2);i++){match['base_code']+="0";base_pattern+="0";}
match['base_code']+=barcode.substr(num_start+num_length-2,barcode.length-1);base_pattern+=pattern.substr(num_start+num_length,pattern.length-1);match['base_code']=match['base_code'].replace("\\\\","\\").replace("\{","{").replace("\}","}").replace("\.",".");var base_code=match.base_code.split('')
if(encoding==='ean13'){base_code[12]=''+this.ean_checksum(match.base_code);}else if(encoding==='ean8'){base_code[7]=''+this.ean8_checksum(match.base_code);}else if(encoding==='upca'){base_code[11]=''+this.ean_checksum('0'+match.base_code);}
match.base_code=base_code.join('')}
if(base_pattern[0]!=='^'){base_pattern="^"+base_pattern;}
match.match=match.base_code.match(base_pattern);return match;},parse_barcode:function(barcode){var parsed_result={encoding:'',type:'error',code:barcode,base_code:barcode,value:0,};if(!this.nomenclature){return parsed_result;}
var rules=this.nomenclature.rules;for(var i=0;i<rules.length;i++){var rule=rules[i];var cur_barcode=barcode;if(rule.encoding==='ean13'&&this.check_encoding(barcode,'upca')&&this.nomenclature.upc_ean_conv in{'upc2ean':'','always':''}){cur_barcode='0'+cur_barcode;}else if(rule.encoding==='upca'&&this.check_encoding(barcode,'ean13')&&barcode[0]==='0'&&this.upc_ean_conv in{'ean2upc':'','always':''}){cur_barcode=cur_barcode.substr(1,12);}
if(!this.check_encoding(cur_barcode,rule.encoding)){continue;}
var match=this.match_pattern(cur_barcode,rules[i].pattern,rule.encoding);if(match.match){if(rules[i].type==='alias'){barcode=rules[i].alias;parsed_result.code=barcode;parsed_result.type='alias';}
else{parsed_result.encoding=rules[i].encoding;parsed_result.type=rules[i].type;parsed_result.value=match.value;parsed_result.code=cur_barcode;if(rules[i].encoding==="ean13"){parsed_result.base_code=this.sanitize_ean(match.base_code);}
else{parsed_result.base_code=match.base_code;}
return parsed_result;}}}
return parsed_result;},});return BarcodeParser;});;

/* /barcodes/static/src/js/barcode_events.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('barcodes.BarcodeEvents',function(require){"use strict";var config=require('web.config');var core=require('web.core');var mixins=require('web.mixins');var session=require('web.session');function CustomEvent(event,params){params=params||{bubbles:false,cancelable:false,detail:undefined};var evt=document.createEvent('CustomEvent');evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail);return evt;}
CustomEvent.prototype=window.Event.prototype;var BarcodeEvents=core.Class.extend(mixins.PropertiesMixin,{timeout:null,key_pressed:{},buffered_key_events:[],regexp:/(.{3,})[\n\r\t]*/,suffix:/[\n\r\t]+/,max_time_between_keys_in_ms:session.max_time_between_keys_in_ms||55,inputTimeOut:800,init:function(){mixins.PropertiesMixin.init.call(this);this.__keydown_handler=_.bind(this.keydown_handler,this);this.__keyup_handler=_.bind(this.keyup_handler,this);this.__handler=_.bind(this.handler,this);$(_.bind(this.start,this,false));this.isChromeMobile=config.device.isMobileDevice&&navigator.userAgent.match(/Chrome/i);this.$barcodeInput=$('<input/>',{name:'barcode',type:'text',css:{'position':'fixed','top':'50%','transform':'translateY(-50%)','z-index':'-1','opacity':'0',},});this.$barcodeInput.attr('autocomplete','off');this.__blurBarcodeInput=_.debounce(this._blurBarcodeInput,this.inputTimeOut);},handle_buffered_keys:function(){var str=this.buffered_key_events.reduce(function(memo,e){return memo+String.fromCharCode(e.which)},'');var match=str.match(this.regexp);if(match){var barcode=match[1];core.bus.trigger('barcode_scanned',barcode,this.buffered_key_events[0].target);if(this.buffered_key_events[0].target.getAttribute("barcode_events")==="true")
$(this.buffered_key_events[0].target).trigger('barcode_scanned',barcode);}else{this.resend_buffered_keys();}
this.buffered_key_events=[];},resend_buffered_keys:function(){var old_event,new_event;for(var i=0;i<this.buffered_key_events.length;i++){old_event=this.buffered_key_events[i];if(old_event.which!==13){var params={'bubbles':old_event.bubbles,'cancelable':old_event.cancelable,};new_event=$.Event('keypress',params);new_event.viewArg=old_event.viewArg;new_event.ctrl=old_event.ctrl;new_event.alt=old_event.alt;new_event.shift=old_event.shift;new_event.meta=old_event.meta;new_event.char=old_event.char;new_event.key=old_event.key;new_event.charCode=old_event.charCode;new_event.keyCode=old_event.keyCode||old_event.which;new_event.which=old_event.which;new_event.dispatched_by_barcode_reader=true;$(old_event.target).trigger(new_event);}}},element_is_editable:function(element){return $(element).is('input,textarea,[contenteditable="true"]');},is_special_key:function(e){if(e.key==="ArrowLeft"||e.key==="ArrowRight"||e.key==="ArrowUp"||e.key==="ArrowDown"||e.key==="Escape"||e.key==="Tab"||e.key==="Backspace"||e.key==="Delete"||e.key==="Home"||e.key==="End"||e.key==="PageUp"||e.key==="PageDown"||e.key==="Unidentified"||/F\d\d?/.test(e.key)){return true;}else{return false;}},keydown_handler:function(e){if(this.key_pressed[e.which]){e.preventDefault();}else{this.key_pressed[e.which]=true;}},keyup_handler:function(e){this.key_pressed[e.which]=false;},handler:function(e){if(e.dispatched_by_barcode_reader)
return;if(this.is_special_key(e))
return;if(e.ctrlKey||e.metaKey||e.altKey)
return;if(e.which===13&&this.buffered_key_events.length===0)
return;if((this.element_is_editable(e.target)&&!$(e.target).data('enableBarcode'))&&e.target.getAttribute("barcode_events")!=="true")
return;this.buffered_key_events.push(e);e.preventDefault();e.stopImmediatePropagation();clearTimeout(this.timeout);if(String.fromCharCode(e.which).match(this.suffix)){this.handle_buffered_keys();}else{this.timeout=setTimeout(_.bind(this.handle_buffered_keys,this),this.max_time_between_keys_in_ms);}},_listenBarcodeScanner:function(e){if($(document.activeElement).not('input:text, textarea, [contenteditable], '+'[type="email"], [type="number"], [type="password"], [type="tel"], [type="search"]').length){$('body').append(this.$barcodeInput);this.$barcodeInput.focus();}
if(this.$barcodeInput.is(":focus")){clearTimeout(this.timeout);if(String.fromCharCode(e.which).match(this.suffix)){this._handleBarcodeValue(e);}else{this.timeout=setTimeout(this._handleBarcodeValue.bind(this,e),this.max_time_between_keys_in_ms);}
this.__blurBarcodeInput();}},_handleBarcodeValue:function(e){var barcodeValue=this.$barcodeInput.val();if(barcodeValue.match(this.regexp)){core.bus.trigger('barcode_scanned',barcodeValue,$(e.target).parent()[0]);this._blurBarcodeInput();}},_blurBarcodeInput:function(){this.$barcodeInput.val('').blur();},start:function(prevent_key_repeat){if(this.isChromeMobile){$('body').on("keydown",this._listenBarcodeScanner.bind(this));}else{$('body').bind("keypress",this.__handler);}
if(prevent_key_repeat===true){$('body').bind("keydown",this.__keydown_handler);$('body').bind('keyup',this.__keyup_handler);}},stop:function(){$('body').off("keypress",this.__handler);$('body').off("keydown",this.__keydown_handler);$('body').off('keyup',this.__keyup_handler);},});return{BarcodeEvents:new BarcodeEvents(),ReservedBarcodePrefixes:['O-CMD'],};});;

/* /barcodes/static/src/js/barcode_form_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('barcodes.FormView',function(require){"use strict";var BarcodeEvents=require('barcodes.BarcodeEvents');var concurrency=require('web.concurrency');var core=require('web.core');var Dialog=require('web.Dialog');var FormController=require('web.FormController');var FormRenderer=require('web.FormRenderer');var _t=core._t;FormController.include({custom_events:_.extend({},FormController.prototype.custom_events,{activeBarcode:'_barcodeActivated',}),init:function(){this._super.apply(this,arguments);this.activeBarcode={form_view:{commands:{'O-CMD.EDIT':this._barcodeEdit.bind(this),'O-CMD.DISCARD':this._barcodeDiscard.bind(this),'O-CMD.SAVE':this._barcodeSave.bind(this),'O-CMD.PREV':this._barcodePagerPrevious.bind(this),'O-CMD.NEXT':this._barcodePagerNext.bind(this),'O-CMD.PAGER-FIRST':this._barcodePagerFirst.bind(this),'O-CMD.PAGER-LAST':this._barcodePagerLast.bind(this),},},};this.barcodeMutex=new concurrency.Mutex();this._barcodeStartListening();},destroy:function(){this._barcodeStopListening();this._super();},_barcodeAddX2MQuantity:function(barcode,activeBarcode){if(this.mode==='readonly'){this.do_warn(false,_t('Enable edit mode to modify this document'));return Promise.reject();}
var record=this.model.get(this.handle);var candidate=this._getBarCodeRecord(record,barcode,activeBarcode);if(candidate){return this._barcodeSelectedCandidate(candidate,record,barcode,activeBarcode);}else{return this._barcodeWithoutCandidate(record,barcode,activeBarcode);}},_barcodeDiscard:function(){return this.discardChanges();},_barcodeEdit:function(){return this._setMode('edit');},_barcodePagerFirst:async function(){return this._updatePage(()=>1);},_barcodePagerLast:async function(){return this._updatePage((min,state)=>state.count);},_barcodePagerNext:function(){return this._updatePage((min,state)=>{min+=1;if(min>state.count){min=1;}
return min;});},_barcodePagerPrevious:function(){return this._updatePage((min,state)=>{min-=1;if(min<1){min=state.count;}
return min;});},_updatePage:async function(updater){await this.mutex.exec(()=>{});const state=this.model.get(this.handle,{raw:true});const pagingInfo=this._getPagingInfo(state);if(!pagingInfo){return this.do_warn(false,_t('Pager unavailable'));}
const currentMinimum=updater(pagingInfo.currentMinimum,state);const limit=pagingInfo.limit;const reloadParams=state.groupedBy&&state.groupedBy.length?{groupsLimit:limit,groupsOffset:currentMinimum-1,}:{limit,offset:currentMinimum-1,};await this.reload(reloadParams);if(state.limit===limit){this.trigger_up('scrollTo',{top:0});}},_barcodeRecordFilter:function(candidate,barcode,activeBarcode){return candidate.data.product_barcode===barcode;},_barcodeSave:function(){return this.saveRecord();},_barcodeSelectedCandidate:function(candidate,record,barcode,activeBarcode,quantity){var changes={};var candidateChanges={};candidateChanges[activeBarcode.quantity]=quantity?quantity:candidate.data[activeBarcode.quantity]+1;changes[activeBarcode.fieldName]={operation:'UPDATE',id:candidate.id,data:candidateChanges,};return this.model.notifyChanges(this.handle,changes,{notifyChange:activeBarcode.notifyChange});},_barcodeStartListening:function(){core.bus.on('barcode_scanned',this,this._barcodeScanned);core.bus.on('keypress',this,this._quantityListener);},_barcodeStopListening:function(){core.bus.off('barcode_scanned',this,this._barcodeScanned);core.bus.off('keypress',this,this._quantityListener);},_barcodeWithoutCandidate:function(record,barcode,activeBarcode){var changes={};changes[activeBarcode.name]=barcode;return this.model.notifyChanges(record.id,changes);},_getBarCodeRecord:function(record,barcode,activeBarcode){var self=this;if(!activeBarcode.fieldName||!record.data[activeBarcode.fieldName]){return;}
return _.find(record.data[activeBarcode.fieldName].data,function(record){return self._barcodeRecordFilter(record,barcode,activeBarcode);});},_barcodeActivated:function(event){event.stopPropagation();var name=event.data.name;this.activeBarcode[name]={name:name,handle:this.handle,target:event.target,widget:event.target.attrs&&event.target.attrs.widget,setQuantityWithKeypress:!!event.data.setQuantityWithKeypress,fieldName:event.data.fieldName,notifyChange:(event.data.notifyChange!==undefined)?event.data.notifyChange:true,quantity:event.data.quantity,commands:event.data.commands||{},candidate:this.activeBarcode[name]&&this.activeBarcode[name].handle===this.handle?this.activeBarcode[name].candidate:null,};this.disableAutofocus=true;},_barcodeActiveScanned:function(method,barcode,activeBarcode){var self=this;var methodDef;var def=new Promise(function(resolve,reject){if(typeof method==='string'){methodDef=self[method](barcode,activeBarcode);}else{methodDef=method.call(self,barcode,activeBarcode);}
methodDef.then(function(){var record=self.model.get(self.handle);var candidate=self._getBarCodeRecord(record,barcode,activeBarcode);activeBarcode.candidate=candidate;}).then(resolve,resolve);});return def;},_barcodeScanned:function(barcode,target){var self=this;return this.barcodeMutex.exec(function(){var prefixed=_.any(BarcodeEvents.ReservedBarcodePrefixes,function(reserved){return barcode.indexOf(reserved)===0;});var hasCommand=false;var defs=[];if(!$.contains(target,self.el)){return;}
for(var k in self.activeBarcode){var activeBarcode=self.activeBarcode[k];var methods=self.activeBarcode[k].commands;var method=prefixed?methods[barcode]:methods.barcode;if(method){if(prefixed){hasCommand=true;}
defs.push(self._barcodeActiveScanned(method,barcode,activeBarcode));}}
if(prefixed&&!hasCommand){self.do_warn(_t('Undefined barcode command'),barcode);}
return self.alive(Promise.all(defs)).then(function(){if(!prefixed){self.current_barcode=barcode;self.update({},{reload:false});}});});},_quantityListener:function(event){var character=String.fromCharCode(event.which);if(!$.contains(event.target,this.el)){return;}
if(!$(event.target).is('body, .modal')||!/[0-9]/.test(character)){return;}
var barcodeInfos=_.filter(this.activeBarcode,'setQuantityWithKeypress');if(!barcodeInfos.length){return;}
if(!_.compact(_.pluck(barcodeInfos,'candidate')).length){return this.do_warn(false,_t('Scan a barcode to set the quantity'));}
for(var k in this.activeBarcode){if(this.activeBarcode[k].candidate){this._quantityOpenDialog(character,this.activeBarcode[k]);}}},_quantityOpenDialog:function(character,activeBarcode){var self=this;var $content=$('<div>').append($('<input>',{type:'text',class:'o_set_qty_input'}));this.dialog=new Dialog(this,{title:_t('Set quantity'),buttons:[{text:_t('Select'),classes:'btn-primary',close:true,click:function(){var new_qty=this.$content.find('.o_set_qty_input').val();var record=self.model.get(self.handle);return self._barcodeSelectedCandidate(activeBarcode.candidate,record,self.current_barcode,activeBarcode,parseFloat(new_qty)).then(function(){self.update({},{reload:false});});}},{text:_t('Discard'),close:true}],$content:$content,});this.dialog.opened().then(function(){var $input=self.dialog.$('.o_set_qty_input').focus().val(character);var $selectBtn=self.dialog.$footer.find('.btn-primary');$input.on('keypress',function(event){if(event.which===13){event.preventDefault();$input.off();$selectBtn.click();}});});this.dialog.open();},});FormRenderer.include({_barcodeButtonHandler:function($button,node){var commands={};commands.barcode=function(){return Promise.resolve();};commands['O-BTN.'+node.attrs.barcode_trigger]=function(){if(!$button.hasClass('o_invisible_modifier')){$button.click();}
return Promise.resolve();};var name=node.attrs.name;if(node.attrs.string){name=name+'_'+node.attrs.string;}
this.trigger_up('activeBarcode',{name:name,commands:commands});},_renderHeaderButton:function(node){var $button=this._super.apply(this,arguments);if(node.attrs.barcode_trigger){this._barcodeButtonHandler($button,node);}
return $button;},_renderStatButton:function(node){var $button=this._super.apply(this,arguments);if(node.attrs.barcode_trigger){this._barcodeButtonHandler($button,node);}
return $button;},_renderTagButton:function(node){var $button=this._super.apply(this,arguments);if(node.attrs.barcode_trigger){this._barcodeButtonHandler($button,node);}
return $button;}});BarcodeEvents.ReservedBarcodePrefixes.push('O-BTN');});;

/* /barcodes/static/src/js/barcode_field.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('barcodes.field',function(require){"use strict";var AbstractField=require('web.AbstractField');var basicFields=require('web.basic_fields');var fieldRegistry=require('web.field_registry');var BarcodeEvents=require('barcodes.BarcodeEvents').BarcodeEvents;var FieldFloatScannable=basicFields.FieldFloat.extend({events:_.extend({},basicFields.FieldFloat.prototype.events,{keypress:'_onKeypress',}),_renderEdit:function(){var self=this;return Promise.resolve(this._super()).then(function(){self.$input.data('enableBarcode',true);});},_onKeypress:function(e){if(e.dispatched_by_barcode_reader!==true){if(!BarcodeEvents.is_special_key(e)){e.preventDefault();}
return;}
var character=String.fromCharCode(e.which);var current_str=e.target.value;var str_before_carret=current_str.substring(0,e.target.selectionStart);var str_after_carret=current_str.substring(e.target.selectionEnd);e.target.value=str_before_carret+character+str_after_carret;var new_carret_index=str_before_carret.length+character.length;e.target.setSelectionRange(new_carret_index,new_carret_index);$(e.target).trigger('input');},});var FormViewBarcodeHandler=AbstractField.extend({init:function(){this._super.apply(this,arguments);this.trigger_up('activeBarcode',{name:this.name,commands:{barcode:'_barcodeAddX2MQuantity',}});},});fieldRegistry.add('field_float_scannable',FieldFloatScannable);fieldRegistry.add('barcode_handler',FormViewBarcodeHandler);return{FieldFloatScannable:FieldFloatScannable,FormViewBarcodeHandler:FormViewBarcodeHandler,};});;

/* /base_setup/static/src/js/res_config_dev_tool.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('base_setup.ResConfigDevTool',function(require){"use strict";var config=require('web.config');var Widget=require('web.Widget');var widget_registry=require('web.widget_registry');var ResConfigDevTool=Widget.extend({template:'res_config_dev_tool',events:{'click .o_web_settings_force_demo':'_onClickForceDemo',},init:function(){this._super.apply(this,arguments);this.isDebug=config.isDebug();this.isAssets=config.isDebug("assets");this.isTests=config.isDebug("tests");},willStart:function(){var self=this;return this._super.apply(this,arguments).then(function(){return self._rpc({route:'/base_setup/demo_active',}).then(function(demo_active){self.demo_active=demo_active;});});},_onClickForceDemo:function(ev){ev.preventDefault();this.do_action('base.demo_force_install_action');},});widget_registry.add('res_config_dev_tool',ResConfigDevTool);});;

/* /base_setup/static/src/js/res_config_edition.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('base_setup.ResConfigEdition',function(require){"use strict";var Widget=require('web.Widget');var widget_registry=require('web.widget_registry');var session=require('web.session');var ResConfigEdition=Widget.extend({template:'res_config_edition',init:function(){this._super.apply(this,arguments);this.server_version=session.server_version;this.expiration_date=session.expiration_date?moment(session.expiration_date):moment().add(30,'d');},});widget_registry.add('res_config_edition',ResConfigEdition);return ResConfigEdition;});;

/* /base_setup/static/src/js/res_config_invite_users.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('base_setup.ResConfigInviteUsers',function(require){"use strict";var Widget=require('web.Widget');var widget_registry=require('web.widget_registry');var core=require('web.core');var _t=core._t;var ResConfigInviteUsers=Widget.extend({template:'res_config_invite_users',events:{'click .o_web_settings_invite':'_onClickInvite','click .o_web_settings_user':'_onClickUser','click .o_web_settings_more':'_onClickMore','keydown .o_user_emails':'_onKeydownUserEmails',},init:function(){this._super.apply(this,arguments);this.emails=[];},willStart:function(){var self=this;return this._super.apply(this,arguments).then(function(){return self.load();});},load:function(){var self=this;return this._rpc({route:'/base_setup/data',}).then(function(data){self.active_users=data.active_users;self.pending_users=data.pending_users;self.pending_count=data.pending_count;self.resend_invitation=data.resend_invitation||false;});},_validateEmail:function(email){var re=/^([a-z0-9][-a-z0-9_\+\.]*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,63}(?:\.[a-z]{2})?)$/i;return re.test(email);},_invite:function(){var self=this;var $userEmails=this.$('.o_user_emails');$userEmails.prop('disabled',true);this.$('.o_web_settings_invite').prop('disabled',true);var value=$userEmails.val().trim();if(value){var emails=_.uniq(value.split(/[ ,;\n]+/));var invalidEmails=_.reject(emails,this._validateEmail);if(invalidEmails.length){this.do_warn(false,_.str.sprintf(_t('Invalid email addresses: %s.'),invalidEmails.join(', ')));}
emails=_.difference(emails,invalidEmails);if(!this.resend_invitation){var pendingEmails=_.map(this.pending_users,function(info){return info[1];});var existingEmails=_.intersection(emails,this.emails.concat(pendingEmails));if(existingEmails.length){this.do_warn(false,_.str.sprintf(_t('Email addresses already existing: %s.'),existingEmails.join(', ')));}
emails=_.difference(emails,existingEmails);}
if(emails.length){$userEmails.val('');this._rpc({model:'res.users',method:'web_create_users',args:[emails],}).then(function(){return self.load().then(function(){self.renderElement();self.$('.o_user_emails').focus();});});}else{$userEmails.prop('disabled',false);this.$('.o_web_settings_invite').prop('disabled',false);self.$('.o_user_emails').focus();}}},_onClickInvite:function(ev){if(this.$('.o_user_emails').val().length){var $button=$(ev.target);$button.button('loading');return this._invite();}},_onClickMore:function(ev){var self=this;ev.preventDefault();this._rpc({model:'ir.model.data',method:'xmlid_to_res_model_res_id',args:["base.view_users_form"],}).then(function(data){self.do_action({name:_t('Users'),type:'ir.actions.act_window',view_mode:'tree,form',res_model:'res.users',domain:[['log_ids','=',false]],context:{search_default_no_share:true,},views:[[false,'list'],[data[1],'form']],});});},_onClickUser:function(ev){var self=this;ev.preventDefault();var user_id=$(ev.currentTarget).data('user-id');this._rpc({model:'ir.model.data',method:'xmlid_to_res_model_res_id',args:["base.view_users_form"],}).then(function(data){self.do_action({type:'ir.actions.act_window',res_model:'res.users',view_mode:'form',res_id:user_id,views:[[data[1],'form']],});});},_onKeydownUserEmails:function(ev){var keyCodes=[$.ui.keyCode.TAB,$.ui.keyCode.COMMA,$.ui.keyCode.ENTER];if(_.contains(keyCodes,ev.which)){ev.preventDefault();this._invite();}},});widget_registry.add('res_config_invite_users',ResConfigInviteUsers);});;

/* /bus/static/src/js/longpolling_bus.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('bus.Longpolling',function(require){"use strict";var Bus=require('web.Bus');var ServicesMixin=require('web.ServicesMixin');var LongpollingBus=Bus.extend(ServicesMixin,{PARTNERS_PRESENCE_CHECK_PERIOD:30000,ERROR_RETRY_DELAY:10000,POLL_ROUTE:'/longpolling/poll',_isActive:null,_lastNotificationID:0,_isOdooFocused:true,_pollRetryTimeout:null,init:function(parent,params){this._super.apply(this,arguments);this._id=_.uniqueId('bus');this._longPollingBusId=this._id;this._options={};this._channels=[];this._lastPresenceTime=new Date().getTime();$(window).on("focus."+this._longPollingBusId,this._onFocusChange.bind(this,{focus:true}));$(window).on("blur."+this._longPollingBusId,this._onFocusChange.bind(this,{focus:false}));$(window).on("unload."+this._longPollingBusId,this._onFocusChange.bind(this,{focus:false}));$(window).on("click."+this._longPollingBusId,this._onPresence.bind(this));$(window).on("keydown."+this._longPollingBusId,this._onPresence.bind(this));$(window).on("keyup."+this._longPollingBusId,this._onPresence.bind(this));},destroy:function(){this.stopPolling();$(window).off("focus."+this._longPollingBusId);$(window).off("blur."+this._longPollingBusId);$(window).off("unload."+this._longPollingBusId);$(window).off("click."+this._longPollingBusId);$(window).off("keydown."+this._longPollingBusId);$(window).off("keyup."+this._longPollingBusId);this._super();},addChannel:function(channel){if(this._channels.indexOf(channel)===-1){this._channels.push(channel);if(this._pollRpc){this._pollRpc.abort();}else{this.startPolling();}}},deleteChannel:function(channel){var index=this._channels.indexOf(channel);if(index!==-1){this._channels.splice(index,1);if(this._pollRpc){this._pollRpc.abort();}}},isOdooFocused:function(){return this._isOdooFocused;},startPolling:function(){if(this._isActive===null){this._poll=this._poll.bind(this);}
if(!this._isActive){this._isActive=true;this._poll();}},stopPolling:function(){this._isActive=false;this._channels=[];clearTimeout(this._pollRetryTimeout);if(this._pollRpc){this._pollRpc.abort();}},updateOption:function(key,value){this._options[key]=value;},_getLastPresence:function(){return this._lastPresenceTime;},_poll:function(){var self=this;if(!this._isActive){return;}
var now=new Date().getTime();var options=_.extend({},this._options,{bus_inactivity:now-this._getLastPresence(),});var data={channels:this._channels,last:this._lastNotificationID,options:options};this._pollRpc=this._makePoll(data);this._pollRpc.then(function(result){self._pollRpc=false;self._onPoll(result);self._poll();}).guardedCatch(function(result){self._pollRpc=false;result.event.preventDefault();if(result.message==="XmlHttpRequestError abort"){self._poll();}else{self._pollRetryTimeout=setTimeout(self._poll,self.ERROR_RETRY_DELAY+(Math.floor((Math.random()*20)+1)*1000));}});},_makePoll:function(data){return this._rpc({route:this.POLL_ROUTE,params:data},{shadow:true,timeout:60000});},_onFocusChange:function(params){this._isOdooFocused=params.focus;if(params.focus){this._lastPresenceTime=new Date().getTime();this.trigger('window_focus',this._isOdooFocused);}},_onPoll:function(notifications){var self=this;var notifs=_.map(notifications,function(notif){if(notif.id>self._lastNotificationID){self._lastNotificationID=notif.id;}
return[notif.channel,notif.message];});this.trigger("notification",notifs);return notifs;},_onPresence:function(){this._lastPresenceTime=new Date().getTime();},});return LongpollingBus;});;

/* /bus/static/src/js/crosstab_bus.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('bus.CrossTab',function(require){"use strict";var Longpolling=require('bus.Longpolling');var session=require('web.session');var CrossTabBus=Longpolling.extend({TAB_HEARTBEAT_PERIOD:10000,MASTER_TAB_HEARTBEAT_PERIOD:1500,HEARTBEAT_OUT_OF_DATE_PERIOD:5000,HEARTBEAT_KILL_OLD_PERIOD:15000,LOCAL_STORAGE_PREFIX:'bus',_isMasterTab:false,_isRegistered:false,init:function(){this._super.apply(this,arguments);var now=new Date().getTime();this._sanitizedOrigin=session.origin.replace(/:\/{0,2}/g,'_');this._id=_.uniqueId(this.LOCAL_STORAGE_PREFIX)+':'+now;if(this._callLocalStorage('getItem','last_ts',0)+50000<now){this._callLocalStorage('removeItem','last');}
this._lastNotificationID=this._callLocalStorage('getItem','last',0);this.call('local_storage','onStorage',this,this._onStorage);},destroy:function(){this._super();clearTimeout(this._heartbeatTimeout);},addChannel:function(){this._super.apply(this,arguments);this._callLocalStorage('setItem','channels',this._channels);},deleteChannel:function(){this._super.apply(this,arguments);this._callLocalStorage('setItem','channels',this._channels);},getTabId:function(){return this._id;},isMasterTab:function(){return this._isMasterTab;},startPolling:function(){if(this._isActive===null){this._heartbeat=this._heartbeat.bind(this);}
if(!this._isRegistered){this._isRegistered=true;var peers=this._callLocalStorage('getItem','peers',{});peers[this._id]=new Date().getTime();this._callLocalStorage('setItem','peers',peers);this._registerWindowUnload();if(!this._callLocalStorage('getItem','master')){this._startElection();}
this._heartbeat();if(this._isMasterTab){this._callLocalStorage('setItem','channels',this._channels);this._callLocalStorage('setItem','options',this._options);}else{this._channels=this._callLocalStorage('getItem','channels',this._channels);this._options=this._callLocalStorage('getItem','options',this._options);}
return;}
if(this._isMasterTab){this._super.apply(this,arguments);}},updateOption:function(){this._super.apply(this,arguments);this._callLocalStorage('setItem','options',this._options);},_callLocalStorage:function(method,key,param){return this.call('local_storage',method,this._generateKey(key),param);},_generateKey:function(key){return this.LOCAL_STORAGE_PREFIX+'.'+this._sanitizedOrigin+'.'+key;},_getLastPresence:function(){return this._callLocalStorage('getItem','lastPresence')||this._super();},_heartbeat:function(){var now=new Date().getTime();var heartbeatValue=parseInt(this._callLocalStorage('getItem','heartbeat',0));var peers=this._callLocalStorage('getItem','peers',{});if((heartbeatValue+this.HEARTBEAT_OUT_OF_DATE_PERIOD)<now){this._startElection();heartbeatValue=parseInt(this._callLocalStorage('getItem','heartbeat',0));}
if(this._isMasterTab){var cleanedPeers={};for(var peerName in peers){if(peers[peerName]+this.HEARTBEAT_KILL_OLD_PERIOD>now){cleanedPeers[peerName]=peers[peerName];}}
if(heartbeatValue!==this.lastHeartbeat){this._isMasterTab=false;this.lastHeartbeat=0;peers[this._id]=now;this._callLocalStorage('setItem','peers',peers);this.stopPolling();this.trigger('no_longer_master');}else{this.lastHeartbeat=now;this._callLocalStorage('setItem','heartbeat',now);this._callLocalStorage('setItem','peers',cleanedPeers);}}else{peers[this._id]=now;this._callLocalStorage('setItem','peers',peers);}
var hbPeriod=this._isMasterTab?this.MASTER_TAB_HEARTBEAT_PERIOD:this.TAB_HEARTBEAT_PERIOD;if(this._lastPresenceTime+hbPeriod>now){this._callLocalStorage('setItem','lastPresence',this._lastPresenceTime);}
this._heartbeatTimeout=setTimeout(this._heartbeat.bind(this),hbPeriod);},_registerWindowUnload:function(){$(window).on('unload.'+this._id,this._onUnload.bind(this));},_startElection:function(){if(this._isMasterTab){return;}
var now=new Date().getTime();var peers=this._callLocalStorage('getItem','peers',{});var heartbeatKillOld=now-this.HEARTBEAT_KILL_OLD_PERIOD;var newMaster;for(var peerName in peers){if(peers[peerName]<heartbeatKillOld){continue;}
newMaster=peerName;break;}
if(newMaster===this._id){this.lastHeartbeat=now;this._callLocalStorage('setItem','heartbeat',this.lastHeartbeat);this._callLocalStorage('setItem','master',true);this._isMasterTab=true;this.startPolling();this.trigger('become_master');delete peers[newMaster];this._callLocalStorage('setItem','peers',peers);}},_onFocusChange:function(params){this._super.apply(this,arguments);this._callLocalStorage('setItem','focus',params.focus);},_onPoll:function(notifications){var notifs=this._super(notifications);if(this._isMasterTab&&notifs.length){this._callLocalStorage('setItem','last',this._lastNotificationID);this._callLocalStorage('setItem','last_ts',new Date().getTime());this._callLocalStorage('setItem','notification',notifs);}},_onStorage:function(e){var value=JSON.parse(e.newValue);var key=e.key;if(this._isRegistered&&key===this._generateKey('master')&&!value){this._startElection();}
if(key===this._generateKey('last')){this._lastNotificationID=value||0;}
else if(key===this._generateKey('notification')){if(!this._isMasterTab){this.trigger("notification",value);}}
else if(key===this._generateKey('channels')){var channels=value;_.each(_.difference(this._channels,channels),this.deleteChannel.bind(this));_.each(_.difference(channels,this._channels),this.addChannel.bind(this));}
else if(key===this._generateKey('options')){this._options=value;}
else if(key===this._generateKey('focus')){this._isOdooFocused=value;this.trigger('window_focus',this._isOdooFocused);}},_onUnload:function(){var peers=this._callLocalStorage('getItem','peers')||{};delete peers[this._id];this._callLocalStorage('setItem','peers',peers);if(this._isMasterTab){this._callLocalStorage('removeItem','master');}},});return CrossTabBus;});;

/* /bus/static/src/js/services/bus_service.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('bus.BusService',function(require){"use strict";var CrossTab=require('bus.CrossTab');var core=require('web.core');var ServicesMixin=require('web.ServicesMixin');const session=require('web.session');var BusService=CrossTab.extend(ServicesMixin,{dependencies:['local_storage'],_audio:null,init:function(env){this.env=env;this._super();},_trigger_up:function(ev){if(ev.name==='call_service'){const payload=ev.data;let args=payload.args||[];if(payload.service==='ajax'&&payload.method==='rpc'){args=args.concat(ev.target);}
const service=this.env.services[payload.service];const result=service[payload.method].apply(service,args);payload.callback(result);}},start:function(){},sendNotification:function(title,content,callback){if(window.Notification&&Notification.permission==="granted"){if(this.isMasterTab()){try{this._sendNativeNotification(title,content,callback);}catch(error){if(error.message.indexOf('ServiceWorkerRegistration')>-1){this.do_notify(title,content);this._beep();}else{throw error;}}}}else{this.do_notify(title,content);if(this.isMasterTab()){this._beep();}}},onNotification:function(){this.on.apply(this,["notification"].concat(Array.prototype.slice.call(arguments)));},_beep:function(){if(typeof(Audio)!=="undefined"){if(!this._audio){this._audio=new Audio();var ext=this._audio.canPlayType("audio/ogg; codecs=vorbis")?".ogg":".mp3";this._audio.src=session.url("/mail/static/src/audio/ting"+ext);}
Promise.resolve(this._audio.play()).catch(_.noop);}},_sendNativeNotification:function(title,content,callback){var notification=new Notification(_.unescape(title),{body:_.unescape(content),icon:"/mail/static/src/img/odoobot_transparent.png"});notification.onclick=function(){window.focus();if(this.cancel){this.cancel();}else if(this.close){this.close();}
if(callback){callback();}};},});core.serviceRegistry.add('bus_service',BusService);return BusService;});;

/* /bus/static/src/js/web_client_bus.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('bus.WebClient',function(require){"use strict";const core=require('web.core');const WebClient=require('web.WebClient');const _t=core._t;WebClient.include({async start(){this._assetsChangedNotificationId=null;this._assets={};await this._super(...arguments);},show_application(){const shown=this._super(...arguments);document.querySelectorAll('*[data-asset-xmlid]').forEach(el=>{this._assets[el.getAttribute('data-asset-xmlid')]=el.getAttribute('data-asset-version');});this.call('bus_service','onNotification',this,this._onNotification);this.call('bus_service','addChannel','bundle_changed');return shown;},_displayBundleChangedNotification(){if(!this._assetsChangedNotificationId){clearTimeout(this._bundleNotifTimerID);this._bundleNotifTimerID=setTimeout(()=>{this._assetsChangedNotificationId=this.call('notification','notify',{title:_t('Refresh'),message:_t('The page appears to be out of date.'),sticky:true,onClose:()=>{this._assetsChangedNotificationId=null;},buttons:[{text:_t('Refresh'),primary:true,click:()=>{window.location.reload(true);}}],});},this._getBundleNotificationDelay());}},_getBundleNotificationDelay(){return 10000+Math.floor(Math.random()*50)*1000;},_onNotification(notifications){for(const notif of notifications){if(notif[0][1]==='bundle_changed'){const bundleXmlId=notif[1][0];const bundleVersion=notif[1][1];if(bundleXmlId in this._assets&&bundleVersion!==this._assets[bundleXmlId]){this._displayBundleChangedNotification();break;}}}}});});;

/* /resource/static/src/js/section_fields_backend.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('resource.section_backend',function(require){"use strict";var FieldOne2Many=require('web.relational_fields').FieldOne2Many;var fieldRegistry=require('web.field_registry');var ListRenderer=require('web.ListRenderer');var SectionListRenderer=ListRenderer.extend({_renderBodyCell:function(record,node,index,options){var $cell=this._super.apply(this,arguments);var isSection=record.data.display_type==='line_section';if(isSection){if(node.attrs.widget==="handle"){return $cell;}else if(node.attrs.name==="name"){var nbrColumns=this._getNumberOfCols();if(this.handleField){nbrColumns--;}
if(this.addTrashIcon){nbrColumns--;}
$cell.attr('colspan',nbrColumns);}else{return $cell.addClass('o_hidden');}}
return $cell;},_renderRow:function(record,index){var $row=this._super.apply(this,arguments);if(record.data.display_type){$row.addClass('o_is_'+record.data.display_type);}
return $row;},_renderView:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.$('.o_list_table').addClass('o_section_list_view');});},});var SectionFieldOne2Many=FieldOne2Many.extend({_getRenderer:function(){if(this.view.arch.tag==='tree'){return SectionListRenderer;}
return this._super.apply(this,arguments);},});fieldRegistry.add('section_one2many',SectionFieldOne2Many);});;

/* /utm/static/src/js/utm_campaign_kanban_examples.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('utm.campaing_kanban_examples',function(require){'use strict';var core=require('web.core');var kanbanExamplesRegistry=require('web.kanban_examples_registry');var _lt=core._lt;kanbanExamplesRegistry.add('utm_campaign',{ghostColumns:[_lt('Ideas'),_lt('Design'),_lt('Review'),_lt('Send'),_lt('Done')],applyExamplesText:_lt("Use This For My Campaigns"),examples:[{name:_lt('Creative Flow'),columns:[_lt('Ideas'),_lt('Design'),_lt('Review'),_lt('Send'),_lt('Done')],description:_lt("Collect ideas, design creative content and publish it once reviewed."),},{name:_lt('Event-driven Flow'),columns:[_lt('Later'),_lt('This Month'),_lt('This Week'),_lt('Running'),_lt('Sent')],description:_lt("Track incoming events (e.g. : Christmas, Black Friday, ...) and publish timely content."),},{name:_lt('Soft-Launch Flow'),columns:[_lt('Pre-Launch'),_lt('Soft-Launch'),_lt('Deploy'),_lt('Report'),_lt('Done')],description:_lt("Prepare your Campaign, test it with part of your audience and deploy it fully afterwards."),},{name:_lt('Audience-driven Flow'),columns:[_lt('Gather Data'),_lt('List-Building'),_lt('Copywriting'),_lt('Sent')],description:_lt("Gather data, build a recipient list and write content based on your Marketing target."),},{name:_lt('Approval-based Flow'),columns:[_lt('To be Approved'),_lt('Approved'),_lt('Deployed')],description:_lt("Prepare Campaigns and get them approved before making them go live."),}],});});;

/* /web_dashboard/static/src/js/dashboard_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_dashboard.DashboardView',function(require){"use strict";var BasicView=require('web.BasicView');var core=require('web.core');var viewRegistry=require('web.view_registry');var DashboardController=require('web_dashboard.DashboardController');var DashboardModel=require('web_dashboard.DashboardModel');var DashboardRenderer=require('web_dashboard.DashboardRenderer');var _lt=core._lt;var DashboardView=BasicView.extend({config:_.extend({},BasicView.prototype.config,{Model:DashboardModel,Controller:DashboardController,Renderer:DashboardRenderer,}),display_name:_lt('Dashboard'),searchMenuTypes:['filter','comparison','favorite'],icon:'fa-tachometer',viewType:'dashboard',init:function(viewInfo,params){this._super.apply(this,arguments);this.modelName=params.modelName;this.controllerParams.actionDomain=(params.action&&params.action.domain)||[];this.rendererParams.subFieldsViews={};var fields=this.fieldsInfo.dashboard;const additionalMeasures=[];for(const f of Object.values(fields)){if(!f.invisible){additionalMeasures.push(f.field);}}
this.rendererParams.additionalMeasures=additionalMeasures;this.subViewRefs={};_.each(this.fieldsView.subViews,subView=>{if(subView[0]){this.subViewRefs[subView[1]+'_view_ref']=subView[0];}});this.rendererParams.subViewRefs=this.subViewRefs;this.fieldsView.subViews=_.map(this.fieldsView.subViews,function(subView){return[false,subView[1]];});this.loadParams.aggregates=this.fieldsView.aggregates;this.loadParams.formulas=this.fieldsView.formulas;},_createSearchModel(params,extraExtensions={}){Object.assign(extraExtensions,{Dashboard:{}});return this._super(params,extraExtensions);},_loadData:function(model){var self=this;var subViewsDef;if(this.fieldsView.subViews.length){const context=Object.assign({},this.subViewRefs,this.loadParams.context);subViewsDef=model.loadViews(this.modelName,context,this.fieldsView.subViews).then(function(fieldsViews){for(var viewType in fieldsViews){self.rendererParams.subFieldsViews[viewType]=fieldsViews[viewType];}});}
var superDef=this._super.apply(this,arguments);return Promise.all([superDef,subViewsDef]).then(function(results){return results[0];});},_processAggregateNode:function(node,fv){var aggregateID=node.attrs.name;var field=fv.viewFields[node.attrs.field];var aggregate=_.defaults({},node.attrs,{domain:'[]',group_operator:field.group_operator,});aggregate.Widget=this._getFieldWidgetClass('dashboard',field,aggregate);if(field.type==='many2one'){field.type='integer';field.realType='many2one';aggregate.realType='many2one';aggregate.group_operator='count_distinct';}
aggregate.type=field.type;fv.fieldsInfo.dashboard[aggregateID]=aggregate;fv.viewFields[node.attrs.name]=_.extend({},field,{name:node.attrs.name,});fv.aggregates.push(aggregateID);return false;},_processArch:function(arch,fv){fv.aggregates=[];fv.formulas={};fv.subViews=[];fv.viewFields=$.extend(true,{},fv.viewFields);this._super.apply(this,arguments);},_processFormulaNode:function(node,fv){var formulaID=node.attrs.name||_.uniqueId('formula_');node.attrs.name=formulaID;var formula=_.extend({},node.attrs,{type:'float'});var fakeField={name:formulaID,type:'float'};formula.Widget=this._getFieldWidgetClass('dashboard',fakeField,formula);fv.fieldsInfo.dashboard[formulaID]=formula;fv.viewFields[formulaID]=fakeField;fv.formulas[formulaID]=_.pick(node.attrs,'string','value');return false;},_processNode:function(node,fv){var res=this._super.apply(this,arguments);if(node.tag==='aggregate'){res=this._processAggregateNode(node,fv);}
if(node.tag==='formula'){res=this._processFormulaNode(node,fv);}
if(node.tag==='view'){fv.subViews.push([node.attrs.ref,node.attrs.type]);res=false;}
return res;},});viewRegistry.add('dashboard',DashboardView);return DashboardView;});;

/* /web_dashboard/static/src/js/dashboard_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_dashboard.DashboardRenderer',function(require){"use strict";var config=require('web.config');var core=require('web.core');var dataComparisonUtils=require('web.dataComparisonUtils');var Domain=require('web.Domain');var fieldUtils=require('web.field_utils');var FormRenderer=require('web.FormRenderer');var pyUtils=require('web.py_utils');var viewRegistry=require('web.view_registry');var renderComparison=dataComparisonUtils.renderComparison;var renderVariation=dataComparisonUtils.renderVariation;var QWeb=core.qweb;var DashboardRenderer=FormRenderer.extend({className:"o_dashboard_view",sampleDataTargets:['.o_subview','.o_group'],events:{'click .o_aggregate.o_clickable':'_onAggregateClicked',},OUTER_GROUP_COL:6,init:function(parent,state,params){this._super.apply(this,arguments);this.mode='readonly';this.subFieldsViews=params.subFieldsViews;this.subViewRefs=params.subViewRefs;this.additionalMeasures=params.additionalMeasures;this.subControllers={};this.subControllersContext=_.pick(state.context||{},'pivot','graph','cohort');this.subcontrollersNextMeasures={pivot:{},graph:{},cohort:{}};var session=this.getSession();var currency_id=session.company_currency_id;if(session.companies_currency_id&&session.user_context.allowed_company_ids){currency_id=session.companies_currency_id[session.user_context.allowed_company_ids[0]];}
this.formatOptions={currency_id:currency_id,humanReadable:function(value){return Math.abs(value)>=1000;},minDigits:1,decimals:2,formatterCallback:function(str){return str;}};},on_attach_callback:function(){this._super.apply(this,arguments);this.isInDOM=true;_.invoke(this.subControllers,'on_attach_callback');},on_detach_callback:function(){this._super.apply(this,arguments);this.isInDOM=false;},getsubControllersContext:function(){return _.mapObject(this.subControllers,function(controller){return controller.getOwnedQueryParams().context;});},updateState:function(state,params){var viewType;for(viewType in this.subControllers){this.subControllersContext[viewType]=this.subControllers[viewType].getOwnedQueryParams().context;}
var subControllersContext=_.pick(params.context||{},'pivot','graph','cohort');_.extend(this.subControllersContext,subControllersContext);for(viewType in this.subControllers){_.extend(this.subControllersContext[viewType],this.subcontrollersNextMeasures[viewType]);this.subcontrollersNextMeasures[viewType]={};}
return this._super.apply(this,arguments);},_addStatisticTooltip:function($el,node){$el.tooltip({delay:{show:1000,hide:0},title:function(){return QWeb.render('web_dashboard.StatisticTooltip',{debug:config.isDebug(),node:node,});}});},_renderLabel:function(node){var text=node.attrs.name;if('string'in node.attrs){text=node.attrs.string;}
var $result=$('<label>',{text:text});return $result;},_renderStatistic:function(node){var self=this;var $label=this._renderLabel(node);var $el=$('<div>').attr('name',node.attrs.name).append($label);var $value;var statisticName=node.attrs.name;var variation;var formatter;var statistic=self.state.fieldsInfo.dashboard[statisticName];var valueLabel=statistic.value_label?(' '+statistic.value_label):'';if(!node.attrs.widget||(node.attrs.widget in fieldUtils.format)){var fieldValue=self.state.data[statisticName];fieldValue=_.contains(['date','datetime'],statistic.type)?(fieldValue===0?NaN:moment(fieldValue)):fieldValue;var formatType=node.attrs.widget||statistic.type;formatter=fieldUtils.format[formatType];if(this.state.compare){var comparisonValue=this.state.comparisonData[statisticName];comparisonValue=_.contains(['date','datetime'],statistic.type)?(comparisonValue===0?NaN:moment(comparisonValue)):comparisonValue;variation=this.state.variationData[statisticName];renderComparison($el,fieldValue,comparisonValue,variation,formatter,statistic,this.formatOptions);$('.o_comparison',$el).append(valueLabel);}else{fieldValue=isNaN(fieldValue)?'-':formatter(fieldValue,statistic,this.formatOptions);$value=$('<div>',{class:'o_value'}).html(fieldValue+valueLabel);$el.append($value);}}else{if(this.state.compare){var $originalValue=this._renderFieldWidget(node,this.state);var fakeState=_.clone(this.state);fakeState.data=fakeState.comparisonData;var $comparisonValue=this._renderFieldWidget(node,fakeState);variation=this.state.variationData[statisticName];fakeState.data[statisticName]=variation;$el.append(renderVariation(variation,statistic)).append($('<div>',{class:'o_comparison'}).append($originalValue,$('<span>').html(" vs "),$comparisonValue));}else{$value=this._renderFieldWidget(node,this.state).addClass('o_value');$el.append($value);}}
if(variation){if(variation>0){$el.addClass('border-success');}else if(variation<0){$el.addClass('border-danger');}}
this._registerModifiers(node,this.state,$el);if(config.isDebug()||node.attrs.help){this._addStatisticTooltip($el,node);}
return $el;},_renderSubViewButtons:function($el,controller){var $buttons=$('<div>',{class:'o_'+controller.viewType+'_buttons o_dashboard_subview_buttons'});controller.renderButtons($buttons);var $buttonGroup=$('<div class="btn-group">');$buttonGroup.append($buttons.find('[aria-label="Main actions"]'));$buttonGroup.append($buttons.find('.o_dropdown:has(.o_group_by_menu)'));$buttonGroup.prependTo($buttons);$('<button>').addClass("btn btn-outline-secondary fa fa-arrows-alt float-right o_button_switch").attr({title:'Full Screen View',viewType:controller.viewType}).tooltip().on('click',this._onViewSwitcherClicked.bind(this)).appendTo($buttons);$buttons.find('.btn-primary,.btn-secondary').removeClass('btn-primary btn-secondary o_dropdown_toggler_btn').addClass("btn-outline-secondary");$buttons.find('[class*=interval_button]').addClass('text-muted text-capitalize');$buttons.find('.fa.fa-bars').removeClass('fa fa-bars');$buttons.prependTo($el);controller.updateButtons();},_renderTagAggregate:function(node){var $aggregate=this._renderStatistic(node).addClass('o_aggregate');var isClickable=node.attrs.clickable===undefined||pyUtils.py_eval(node.attrs.clickable);$aggregate.toggleClass('o_clickable',isClickable);var $result=$('<div>').addClass('o_aggregate_col').append($aggregate);this._registerModifiers(node,this.state,$result);return $result;},_renderTagFormula:function(node){return this._renderStatistic(node).addClass('o_formula');},_renderTagGroup:function(node){var $group=this._renderOuterGroup(node);if(node.children.length&&node.children[0].tag==='widget'){$group.addClass('o_has_widget');}
return $group;},_renderTagView:function(node){var self=this;var viewType=node.attrs.type;var controllerContext=this.subControllersContext[viewType];var searchQuery={context:_.extend({},this.state.context,controllerContext),domain:this.state.domain,groupBy:[],timeRanges:this.state.timeRanges,};var subViewParams={modelName:this.state.model,withControlPanel:false,withSearchPanel:false,hasSwitchButton:true,isEmbedded:true,additionalMeasures:this.additionalMeasures,searchQuery:searchQuery,useSampleModel:Boolean(this.state.isSample),};var SubView=viewRegistry.get(viewType);var subView=new SubView(this.subFieldsViews[viewType],subViewParams);var $div=$('<div>',{class:'o_subview',type:viewType});var def=subView.getController(this).then(function(controller){return controller.appendTo($div).then(function(){self._renderSubViewButtons($div,controller);self.subControllers[viewType]=controller;});});this.defs.push(def);return $div;},_renderView:function(){var self=this;var oldControllers=_.values(this.subControllers);var r=this._super.apply(this,arguments);return r.then(function(){_.invoke(oldControllers,'destroy');if(self.isInDOM){_.invoke(self.subControllers,'on_attach_callback');}
if(self.state.isSample){self._renderNoContentHelper();}});},_updateView:function($newContent){this.$el.html($newContent);},_onAggregateClicked:function(ev){var aggregate=ev.currentTarget.getAttribute('name');var aggregateInfo=this.state.fieldsInfo.dashboard[aggregate];var measure=aggregateInfo.measure!==undefined?aggregateInfo.measure:aggregateInfo.field;if(this.subControllers.pivot){this.subcontrollersNextMeasures.pivot.pivot_measures=[measure];}
if(this.subControllers.graph){this.subcontrollersNextMeasures.graph.graph_measure=measure;}
if(this.subControllers.cohort){this.subcontrollersNextMeasures.cohort.cohort_measure=measure;}
var domain=new Domain(aggregateInfo.domain);var label=aggregateInfo.domain_label||aggregateInfo.string||aggregateInfo.name;this.trigger_up('reload',{domain:domain.toArray(),domainLabel:label,});},_onViewSwitcherClicked:function(ev){ev.stopPropagation();var viewType=$(ev.currentTarget).attr('viewType');var controller=this.subControllers[viewType];const controllerContext=controller.getOwnedQueryParams().context;this.trigger_up('open_view',{context:Object.assign({},this.state.context,controllerContext,this.subViewRefs),viewType:viewType,additionalMeasures:this.additionalMeasures,});},});return DashboardRenderer;});;

/* /web_dashboard/static/src/js/dashboard_model.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_dashboard.DashboardModel',function(require){"use strict";var BasicModel=require('web.BasicModel');var dataComparisonUtils=require('web.dataComparisonUtils');var Domain=require('web.Domain');var pyUtils=require('web.py_utils');var computeVariation=dataComparisonUtils.computeVariation;var DashboardModel=BasicModel.extend({__get:function(){var record=this._super.apply(this,arguments);record.timeRanges=this.dataPoint.timeRanges;record.timeRange=this.dataPoint.timeRange;record.comparisonTimeRange=this.dataPoint.comparisonTimeRange;record.compare=this.dataPoint.compare;record.comparisonData=this.dataPoint.comparisonData;record.variationData=this.dataPoint.variationData;record.isSample=this.isSampleModel;return record;},__load:function(params){params.type='record';this.dataPoint=this._makeDataPoint(params);return this._load(this.dataPoint);},__reload:function(id,options){options=options||{};if(options.domain!==undefined){this.dataPoint.domain=options.domain;}
if('timeRanges'in options){this._processTimeRanges(this.dataPoint,options.timeRanges);}
return this._load(this.dataPoint);},_evaluateFormulas:function(dataPoint){_.each(dataPoint.formulas,function(formula,formulaID){try{dataPoint.data[formulaID]=pyUtils.py_eval(formula.value,{record:dataPoint.data});if(!isFinite(dataPoint.data[formulaID])){dataPoint.data[formulaID]=NaN;}}catch(e){dataPoint.data[formulaID]=NaN;}
if(dataPoint.compare){try{dataPoint.comparisonData[formulaID]=pyUtils.py_eval(formula.value,{record:dataPoint.comparisonData});if(!isFinite(dataPoint.comparisonData[formulaID])){dataPoint.comparisonData[formulaID]=NaN;}}catch(e){dataPoint.comparisonData[formulaID]=NaN;}}});},_getReadGroupDomain:function(aggregateDomain,range){return Domain.prototype.normalizeArray(this.dataPoint.domain).concat(range).concat(Domain.prototype.normalizeArray(new Domain(aggregateDomain).toArray()));},_isEmpty(){return this.dataPoint.count===0;},_load:function(dataPoint){var self=this;let count=0;const domainMapping={};if(this.useSampleModel){domainMapping['[]']=[];}
var fieldsInfo=dataPoint.fieldsInfo.dashboard;_.each(dataPoint.aggregates,function(aggregateName){var domain=fieldsInfo[aggregateName].domain;if(domain in domainMapping){domainMapping[domain].push(aggregateName);}else{domainMapping[domain]=[aggregateName];}});var defs=[];_.each(domainMapping,function(aggregateNames,domain){var fields=_.map(aggregateNames,function(aggregateName){var fieldName=fieldsInfo[aggregateName].field;var groupOperator=fieldsInfo[aggregateName].group_operator;return aggregateName+':'+groupOperator+'('+fieldName+')';});defs.push(self._readGroup({domain:self._getReadGroupDomain(domain,self.dataPoint.timeRange),fields:fields,}).then(function(result){count=count+(domain==='[]'?result.__count:0);_.extend(self.dataPoint.data,_.pick(result,aggregateNames));}));if(dataPoint.compare){defs.push(self._readGroup({domain:self._getReadGroupDomain(domain,self.dataPoint.comparisonTimeRange),fields:fields,}).then(function(result){count=count+(domain==='[]'?result.__count:0);_.extend(self.dataPoint.comparisonData,_.pick(result,aggregateNames));}));}});return Promise.all(defs).then(function(){self.dataPoint.count=count;self._evaluateFormulas(dataPoint);if(dataPoint.compare){var value,comparisonValue;for(var statisticName in dataPoint.data){value=dataPoint.data[statisticName];comparisonValue=dataPoint.comparisonData[statisticName];dataPoint.variationData[statisticName]=computeVariation(value,comparisonValue);}}else{dataPoint.comparisonData={};dataPoint.variationData={};}
return dataPoint.id;});},_makeDataPoint:function(params){var dataPoint=this._super.apply(this,arguments);dataPoint.aggregates=params.aggregates;dataPoint.count=0;dataPoint.formulas=params.formulas;dataPoint.comparisonData={};dataPoint.variationData={};this._processTimeRanges(dataPoint,params.timeRanges);return dataPoint;},_readGroup:function(args){var readGroupArgs=_.extend({context:this.dataPoint.getContext(),groupBy:[],lazy:true,method:'read_group',model:this.dataPoint.model,orderBy:[],},args);return this._rpc(readGroupArgs).then(function(result){result=result[0];return _.mapObject(result,function(value){return value||0;});});},_processTimeRanges:function(dataPoint,timeRanges){const{range,comparisonRange}=timeRanges;dataPoint.timeRanges=timeRanges;dataPoint.timeRange=range||[];dataPoint.comparisonTimeRange=comparisonRange||[];dataPoint.compare=Boolean(dataPoint.comparisonTimeRange.length);},});return DashboardModel;});;

/* /web_dashboard/static/src/js/dashboard_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_dashboard.DashboardController',function(require){"use strict";var AbstractController=require('web.AbstractController');var BasicController=require('web.BasicController');var core=require('web.core');var Domain=require('web.Domain');var _t=core._t;var DashboardController=AbstractController.extend({custom_events:_.extend({},BasicController.prototype.custom_events,{open_view:'_onOpenView',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.actionDomain=params.actionDomain;this.currentFilterIDs=[];},getOwnedQueryParams:function(){return{context:this.renderer.getsubControllersContext()};},_onOpenView:function(ev){ev.stopPropagation();var data=ev.data;var action={domain:this.actionDomain,context:data.context,name:_.str.sprintf(_t('%s Analysis'),_.str.capitalize(data.viewType)),res_model:this.modelName,type:'ir.actions.act_window',views:[[false,data.viewType]],useSampleModel:false,};if(!_.isEmpty(ev.data.additionalMeasures)){action.flags={additionalMeasures:ev.data.additionalMeasures};}
this.do_action(action,{controllerState:this.exportState(),});},_onReload:async function(ev){ev.stopPropagation();const dashboardDomain={};if(ev.data.domain&&ev.data.domain.length){dashboardDomain.domain=Domain.prototype.arrayToString(ev.data.domain);dashboardDomain.label=ev.data.domainLabel;}
this.searchModel.dispatch("updateDashboardDomain",dashboardDomain);},});return DashboardController;});;

/* /web_dashboard/static/src/js/dashboard_model_extension.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("web_dashboard/static/src/js/dashboard_model_extension.js",function(require){"use strict";const ActionModel=require("web/static/src/js/views/action_model.js");const DASHBOARD_FACET_ID="dashboard";class DashboardModelExtension extends ActionModel.Extension{prepareState(){this.state.domain=null;this.state.facets=null;}
get(property){switch(property){case"domain":return this.getDomain();case"facets":return this.getFacets();}}
deactivateGroup(groupId){if(groupId===DASHBOARD_FACET_ID){this.state.domain=null;this.state.facets=null;}}
getDomain(){return this.state.domain;}
getFacets(){return this.state.facets;}
updateDashboardDomain({domain,label}){this.state.domain=domain||null;if(domain){const facet={groupId:DASHBOARD_FACET_ID,type:"filter",values:[label],};this.state.facets=[facet];}else{this.state.facets=null;}}}
ActionModel.registry.add("Dashboard",DashboardModelExtension,50);});;

/* /iap/static/src/js/iap_credit.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('iap.redirect_odoo_credit_widget',function(require){"use strict";var AbstractAction=require('web.AbstractAction');var core=require('web.core');var IapOdooCreditRedirect=AbstractAction.extend({template:'iap.redirect_to_odoo_credit',events:{"click .redirect_confirm":"odoo_redirect",},init:function(parent,action){this._super(parent,action);this.url=action.params.url;},odoo_redirect:function(){window.open(this.url,'_blank');this.do_action({type:'ir.actions.act_window_close'});},});core.action_registry.add('iap_odoo_credit_redirect',IapOdooCreditRedirect);});;

/* /iap/static/src/js/crash_manager.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('iap.CrashManager',function(require){"use strict";var ajax=require('web.ajax');var core=require('web.core');var CrashManager=require('web.CrashManager').CrashManager;var Dialog=require('web.Dialog');var _t=core._t;var QWeb=core.qweb;CrashManager.include({_getButtonMessage:function(isTrial){var isEnterprise=_.last(odoo.session_info.server_version_info)==='e';return isTrial&&isEnterprise?_t('Start a Trial at Odoo'):_t('Buy credits');},rpc_error:function(error){var self=this;if(error.data.name==="odoo.addons.iap.tools.iap_tools.InsufficientCreditError"){var error_data=JSON.parse(error.data.message);ajax.jsonRpc('/web/dataset/call_kw','call',{model:'iap.account',method:'get_credits_url',args:[],kwargs:{base_url:error_data.base_url,service_name:error_data.service_name,credit:error_data.credit,trial:error_data.trial}}).then(function(url){var content=$(QWeb.render('iap.redirect_to_odoo_credit',{data:error_data,}));if(error_data.body){content.css('padding',0);}
new Dialog(this,{size:'large',title:error_data.title||_t("Insufficient Balance"),$content:content,buttons:[{text:self._getButtonMessage(error_data.trial),classes:"btn-primary",click:function(){window.open(url,'_blank');},close:true,},{text:_t("Cancel"),close:true,}],}).open();});}else{this._super.apply(this,arguments);}},});});;

/* /iap/static/src/js/iap_buy_more_credits.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('iap.buy_more_credits',function(require){'use strict';var widgetRegistry=require('web.widget_registry');var Widget=require('web.Widget');var core=require('web.core');var rpc=require('web.rpc');var QWeb=core.qweb;var IAPBuyMoreCreditsWidget=Widget.extend({className:'o_field_iap_buy_more_credits',init:function(parent,data,options){this._super.apply(this,arguments);this.service_name=options.attrs.service_name;},start:function(){this.$widget=$(QWeb.render('iap.buy_more_credits'));this.$buyLink=this.$widget.find('.buy_credits');this.$widget.appendTo(this.$el);this.$buyLink.click(this._getLink.bind(this));},_getLink:function(){var self=this;return rpc.query({model:'iap.account',method:'get_credits_url',args:[this.service_name],},{shadow:true,}).then(function(url){return self.do_action({type:'ir.actions.act_url',url:url,});});},});widgetRegistry.add('iap_buy_more_credits',IAPBuyMoreCreditsWidget);return IAPBuyMoreCreditsWidget;});;

/* /mail/static/src/js/core/translation.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/js/core/translation.js',function(require){'use strict';const{TranslationDataBase}=require('web.translation');const{Component}=owl;TranslationDataBase.include({set_bundle(){const res=this._super(...arguments);if(Component.env.messaging){Component.env.messaging.locale.update({textDirection:this.parameters.direction,});}
return res;},});});;

/* /mail/static/src/js/many2many_tags_email.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail.many2manytags',function(require){"use strict";var BasicModel=require('web.BasicModel');var core=require('web.core');var form_common=require('web.view_dialogs');var field_registry=require('web.field_registry');var relational_fields=require('web.relational_fields');var M2MTags=relational_fields.FieldMany2ManyTags;var _t=core._t;BasicModel.include({_setInvalidMany2ManyTagsEmail:function(record,fieldName){var self=this;var localID=(record._changes&&fieldName in record._changes)?record._changes[fieldName]:record.data[fieldName];var list=this._applyX2ManyOperations(this.localData[localID]);var invalidPartnerIds=[];_.each(list.data,function(id){var record=self.localData[id];if(!record.data.email){invalidPartnerIds.push(record);}});var def;if(invalidPartnerIds.length){var changes={operation:'DELETE',ids:_.pluck(invalidPartnerIds,'id')};def=this._applyX2ManyChange(record,fieldName,changes);}
return Promise.resolve(def).then(function(){return{invalidPartnerIds:_.pluck(invalidPartnerIds,'res_id'),};});},});var FieldMany2ManyTagsEmail=M2MTags.extend({tag_template:"FieldMany2ManyTagsEmail",fieldsToFetch:_.extend({},M2MTags.prototype.fieldsToFetch,{email:{type:'char'},}),specialData:"_setInvalidMany2ManyTagsEmail",_checkEmailPopup:function(){var self=this;var popupDefs=[];var validPartners=[];_.each(this.record.specialData[this.name].invalidPartnerIds,function(resID){var def=new Promise(function(resolve,reject){var pop=new form_common.FormViewDialog(self,{res_model:self.field.relation,res_id:resID,context:self.record.context,title:"",on_saved:function(record){if(record.data.email){validPartners.push(record.res_id);}},}).open();pop.on('closed',self,function(){resolve();});});popupDefs.push(def);});return Promise.all(popupDefs).then(function(){validPartners=_.uniq(validPartners);if(validPartners.length){var values=_.map(validPartners,function(id){return{id:id};});self._setValue({operation:'ADD_M2M',ids:values,});}});},_render:function(){var self=this;var _super=this._super.bind(this);return new Promise(function(resolve,reject){if(self.record.specialData[self.name].invalidPartnerIds.length){resolve(self._checkEmailPopup());}else{resolve();}}).then(function(){return _super.apply(self,arguments);});},});field_registry.add('many2many_tags_email',FieldMany2ManyTagsEmail);});;

/* /mail/static/src/js/many2one_avatar_user.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail.Many2OneAvatarUser',function(require){"use strict";const fieldRegistry=require('web.field_registry');const{Many2OneAvatar}=require('web.relational_fields');const{Component}=owl;const Many2OneAvatarUser=Many2OneAvatar.extend({events:Object.assign({},Many2OneAvatar.prototype.events,{'click .o_m2o_avatar':'_onAvatarClicked',}),supportedModels:['res.users'],init(){this._super(...arguments);if(!this.supportedModels.includes(this.field.relation)){throw new Error(`This widget is only supported on many2one fields pointing to ${JSON.stringify(this.supportedModels)}`);}
if(this.mode==='readonly'){this.className+=' o_clickable_m2o_avatar';}},async _onAvatarClicked(ev){ev.stopPropagation();const env=Component.env;await env.messaging.openChat({userId:this.value.res_id});}});const KanbanMany2OneAvatarUser=Many2OneAvatarUser.extend({_template:'mail.KanbanMany2OneAvatarUser',});fieldRegistry.add('many2one_avatar_user',Many2OneAvatarUser);fieldRegistry.add('kanban.many2one_avatar_user',KanbanMany2OneAvatarUser);return{Many2OneAvatarUser,KanbanMany2OneAvatarUser,};});;

/* /mail/static/src/js/field_char.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sms.onchange_in_keyup',function(require){"use strict";var FieldChar=require('web.basic_fields').FieldChar;FieldChar.include({init:function(){this._super.apply(this,arguments);this._triggerOnchange=_.throttle(this._triggerOnchange,1000,{leading:false});},_onKeydown:function(){this._super.apply(this,arguments);if(this.nodeOptions.onchange_on_keydown){this._triggerOnchange();}},_triggerOnchange:function(){this.$input.trigger('change');},});});;

/* /mail/static/src/js/document_viewer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail.DocumentViewer',function(require){"use strict";var core=require('web.core');var Widget=require('web.Widget');var QWeb=core.qweb;var SCROLL_ZOOM_STEP=0.1;var ZOOM_STEP=0.5;var DocumentViewer=Widget.extend({template:"DocumentViewer",events:{'click .o_download_btn':'_onDownload','click .o_viewer_img':'_onImageClicked','click .o_viewer_video':'_onVideoClicked','click .move_next':'_onNext','click .move_previous':'_onPrevious','click .o_rotate':'_onRotate','click .o_zoom_in':'_onZoomIn','click .o_zoom_out':'_onZoomOut','click .o_zoom_reset':'_onZoomReset','click .o_close_btn, .o_viewer_img_wrapper':'_onClose','click .o_print_btn':'_onPrint','DOMMouseScroll .o_viewer_content':'_onScroll','mousewheel .o_viewer_content':'_onScroll','keydown':'_onKeydown','keyup':'_onKeyUp','mousedown .o_viewer_img':'_onStartDrag','mousemove .o_viewer_content':'_onDrag','mouseup .o_viewer_content':'_onEndDrag'},init:function(parent,attachments,activeAttachmentID){this._super.apply(this,arguments);this.attachment=_.filter(attachments,function(attachment){var match=attachment.type==='url'?attachment.url.match("(youtu|.png|.jpg|.gif)"):attachment.mimetype.match("(image|video|application/pdf|text)");if(match){attachment.fileType=match[1];if(match[1].match("(.png|.jpg|.gif)")){attachment.fileType='image';}
if(match[1]==='youtu'){var youtube_array=attachment.url.split('/');var youtube_token=youtube_array[youtube_array.length-1];if(youtube_token.indexOf('watch')!==-1){youtube_token=youtube_token.split('v=')[1];var amp=youtube_token.indexOf('&')
if(amp!==-1){youtube_token=youtube_token.substring(0,amp);}}
attachment.youtube=youtube_token;}
return true;}});this.activeAttachment=_.findWhere(attachments,{id:activeAttachmentID});this.modelName='ir.attachment';this._reset();},start:function(){this.$el.modal('show');this.$el.on('hidden.bs.modal',_.bind(this._onDestroy,this));this.$('.o_viewer_img').on("load",_.bind(this._onImageLoaded,this));this.$('[data-toggle="tooltip"]').tooltip({delay:0});return this._super.apply(this,arguments);},destroy:function(){if(this.isDestroyed()){return;}
this.$el.modal('hide');this.$el.remove();this._super.apply(this,arguments);},_next:function(){var index=_.findIndex(this.attachment,this.activeAttachment);index=(index+1)%this.attachment.length;this.activeAttachment=this.attachment[index];this._updateContent();},_previous:function(){var index=_.findIndex(this.attachment,this.activeAttachment);index=index===0?this.attachment.length-1:index-1;this.activeAttachment=this.attachment[index];this._updateContent();},_reset:function(){this.scale=1;this.dragStartX=this.dragstopX=0;this.dragStartY=this.dragstopY=0;},_updateContent:function(){this.$('.o_viewer_content').html(QWeb.render('DocumentViewer.Content',{widget:this}));this.$('.o_viewer_img').on("load",_.bind(this._onImageLoaded,this));this.$('[data-toggle="tooltip"]').tooltip({delay:0});this._reset();},_getTransform:function(scale,angle){return'scale3d('+scale+', '+scale+', 1) rotate('+angle+'deg)';},_rotate:function(angle){this._reset();var new_angle=(this.angle||0)+angle;this.$('.o_viewer_img').css('transform',this._getTransform(this.scale,new_angle));this.$('.o_viewer_img').css('max-width',new_angle%180!==0?$(document).height():'100%');this.$('.o_viewer_img').css('max-height',new_angle%180!==0?$(document).width():'100%');this.angle=new_angle;},_zoom:function(scale){if(scale>0.5){this.$('.o_viewer_img').css('transform',this._getTransform(scale,this.angle||0));this.scale=scale;}
this.$('.o_zoom_reset').add('.o_zoom_out').toggleClass('disabled',scale===1);},_onClose:function(e){e.preventDefault();this.destroy();},_onDestroy:function(){this.destroy();},_onDownload:function(e){e.preventDefault();window.location='/web/content/'+this.modelName+'/'+this.activeAttachment.id+'/'+'datas'+'?download=true';},_onDrag:function(e){e.preventDefault();if(this.enableDrag){var $image=this.$('.o_viewer_img');var $zoomer=this.$('.o_viewer_zoomer');var top=$image.prop('offsetHeight')*this.scale>$zoomer.height()?e.clientY-this.dragStartY:0;var left=$image.prop('offsetWidth')*this.scale>$zoomer.width()?e.clientX-this.dragStartX:0;$zoomer.css("transform","translate3d("+left+"px, "+top+"px, 0)");$image.css('cursor','move');}},_onEndDrag:function(e){e.preventDefault();if(this.enableDrag){this.enableDrag=false;this.dragstopX=e.clientX-this.dragStartX;this.dragstopY=e.clientY-this.dragStartY;this.$('.o_viewer_img').css('cursor','');}},_onImageClicked:function(e){e.stopPropagation();},_onImageLoaded:function(){this.$('.o_loading_img').hide();},_onKeydown:function(e){switch(e.which){case $.ui.keyCode.RIGHT:e.preventDefault();this._next();break;case $.ui.keyCode.LEFT:e.preventDefault();this._previous();break;}},_onKeyUp:function(e){switch(e.which){case $.ui.keyCode.ESCAPE:e.preventDefault();this._onClose(e);break;}},_onNext:function(e){e.preventDefault();this._next();},_onPrevious:function(e){e.preventDefault();this._previous();},_onPrint:function(e){e.preventDefault();var src=this.$('.o_viewer_img').prop('src');var script=QWeb.render('PrintImage',{src:src});var printWindow=window.open('about:blank',"_new");printWindow.document.open();printWindow.document.write(script);printWindow.document.close();},_onScroll:function(e){var scale;if(e.originalEvent.wheelDelta>0||e.originalEvent.detail<0){scale=this.scale+SCROLL_ZOOM_STEP;this._zoom(scale);}else{scale=this.scale-SCROLL_ZOOM_STEP;this._zoom(scale);}},_onStartDrag:function(e){e.preventDefault();this.enableDrag=true;this.dragStartX=e.clientX-(this.dragstopX||0);this.dragStartY=e.clientY-(this.dragstopY||0);},_onVideoClicked:function(e){e.stopPropagation();var videoElement=e.target;if(videoElement.paused){videoElement.play();}else{videoElement.pause();}},_onRotate:function(e){e.preventDefault();this._rotate(90);},_onZoomIn:function(e){e.preventDefault();var scale=this.scale+ZOOM_STEP;this._zoom(scale);},_onZoomOut:function(e){e.preventDefault();var scale=this.scale-ZOOM_STEP;this._zoom(scale);},_onZoomReset:function(e){e.preventDefault();this.$('.o_viewer_zoomer').css("transform","");this._zoom(1);},});return DocumentViewer;});;

/* /mail/static/src/js/basic_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail.BasicView',function(require){"use strict";const BasicView=require('web.BasicView');const mailWidgets=['kanban_activity'];BasicView.include({init:function(){this._super.apply(this,arguments);const post_refresh=this._getFieldOption('message_ids','post_refresh',false);const followers_post_refresh=this._getFieldOption('message_follower_ids','post_refresh',false);this.chatterFields={hasActivityIds:this._hasField('activity_ids'),hasMessageFollowerIds:this._hasField('message_follower_ids'),hasMessageIds:this._hasField('message_ids'),hasRecordReloadOnAttachmentsChanged:post_refresh==='always',hasRecordReloadOnMessagePosted:!!post_refresh,hasRecordReloadOnFollowersUpdate:!!followers_post_refresh,isAttachmentBoxVisibleInitially:(this._getFieldOption('message_ids','open_attachments',false)||this._getFieldOption('message_follower_ids','open_attachments',false)),};const fieldsInfo=this.fieldsInfo[this.viewType];this.rendererParams.chatterFields=this.chatterFields;this.mailFields={};for(const fieldName in fieldsInfo){const fieldInfo=fieldsInfo[fieldName];if(_.contains(mailWidgets,fieldInfo.widget)){this.mailFields[fieldInfo.widget]=fieldName;fieldInfo.__no_fetch=true;}}
this.rendererParams.activeActions=this.controllerParams.activeActions;this.rendererParams.mailFields=this.mailFields;},_getFieldOption(fieldName,optionName,defaultValue){const field=this.fieldsInfo[this.viewType][fieldName];if(field&&field.options&&field.options[optionName]!==undefined){return field.options[optionName];}
return defaultValue;},_hasField(fieldName){return!!this.fieldsInfo[this.viewType][fieldName];},});});;

/* /mail/static/src/js/systray/systray_activity_menu.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail.systray.ActivityMenu',function(require){"use strict";var core=require('web.core');var session=require('web.session');var SystrayMenu=require('web.SystrayMenu');var Widget=require('web.Widget');var QWeb=core.qweb;const{Component}=owl;var ActivityMenu=Widget.extend({name:'activity_menu',template:'mail.systray.ActivityMenu',events:{'click .o_mail_activity_action':'_onActivityActionClick','click .o_mail_preview':'_onActivityFilterClick','show.bs.dropdown':'_onActivityMenuShow','hide.bs.dropdown':'_onActivityMenuHide',},start:function(){this._$activitiesPreview=this.$('.o_mail_systray_dropdown_items');Component.env.bus.on('activity_updated',this,this._updateCounter);this._updateCounter();this._updateActivityPreview();return this._super();},_getActivityData:function(){var self=this;return self._rpc({model:'res.users',method:'systray_get_activities',args:[],kwargs:{context:session.user_context},}).then(function(data){self._activities=data;self.activityCounter=_.reduce(data,function(total_count,p_data){return total_count+p_data.total_count||0;},0);self.$('.o_notification_counter').text(self.activityCounter);self.$el.toggleClass('o_no_notification',!self.activityCounter);});},_getActivityModelViewID:function(model){return this._rpc({model:model,method:'get_activity_view_id'});},_getViewsList(model){return[[false,'kanban'],[false,'list'],[false,'form']];},_updateActivityPreview:function(){var self=this;self._getActivityData().then(function(){self._$activitiesPreview.html(QWeb.render('mail.systray.ActivityMenu.Previews',{widget:self}));});},_updateCounter:function(data){if(data){if(data.activity_created){this.activityCounter++;}
if(data.activity_deleted&&this.activityCounter>0){this.activityCounter--;}
this.$('.o_notification_counter').text(this.activityCounter);this.$el.toggleClass('o_no_notification',!this.activityCounter);}},_onActivityActionClick:function(ev){ev.stopPropagation();this.$('.dropdown-toggle').dropdown('toggle');var targetAction=$(ev.currentTarget);var actionXmlid=targetAction.data('action_xmlid');if(actionXmlid){this.do_action(actionXmlid);}else{var domain=[['activity_ids.user_id','=',session.uid]]
if(targetAction.data('domain')){domain=domain.concat(targetAction.data('domain'))}
this.do_action({type:'ir.actions.act_window',name:targetAction.data('model_name'),views:[[false,'activity'],[false,'kanban'],[false,'list'],[false,'form']],view_mode:'activity',res_model:targetAction.data('res_model'),domain:domain,},{clear_breadcrumbs:true,});}},_onActivityFilterClick:function(event){var data=_.extend({},$(event.currentTarget).data(),$(event.target).data());var context={};if(data.filter==='my'){context['search_default_activities_overdue']=1;context['search_default_activities_today']=1;}else{context['search_default_activities_'+data.filter]=1;}
context['force_search_count']=1;var domain=[['activity_ids.user_id','=',session.uid]]
if(data.domain){domain=domain.concat(data.domain)}
this.do_action({type:'ir.actions.act_window',name:data.model_name,res_model:data.res_model,views:this._getViewsList(data.res_model),search_view_id:[false],domain:domain,context:context,},{clear_breadcrumbs:true,});},_onActivityMenuShow:function(){document.body.classList.add('modal-open');this._updateActivityPreview();},_onActivityMenuHide:function(){document.body.classList.remove('modal-open');},});SystrayMenu.Items.push(ActivityMenu);return ActivityMenu;});;

/* /mail/static/src/js/tours/mail.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('mail_tour',{url:"/web#action=mail.widgets.discuss",},[{trigger:'.o_DiscussSidebar_groupChannel .o_DiscussSidebar_groupHeaderItemAdd',content:_t("<p>Channels make it easy to organize information across different topics and groups.</p> <p>Try to <b>create your first channel</b> (e.g. sales, marketing, product XYZ, after work party, etc).</p>"),position:'bottom',},{trigger:'.o_DiscussSidebar_itemNewInput',content:_t("<p>Create a channel here.</p>"),position:'bottom',auto:true,run:function(actions){var t=new Date().getTime();actions.text("SomeChannel_"+t,this.$anchor);},},{trigger:".o_DiscussSidebar_newChannelAutocompleteSuggestions",content:_t("<p>Create a public or private channel.</p>"),position:'right',run(){this.$consumeEventAnchors.find('li:first').click();},},{trigger:'.o_Discuss_thread .o_ComposerTextInput_textarea',content:_t("<p><b>Write a message</b> to the members of the channel here.</p> <p>You can notify someone with <i>'@'</i> or link another channel with <i>'#'</i>. Start your message with <i>'/'</i> to get the list of possible commands.</p>"),position:"top",width:350,run:function(actions){var t=new Date().getTime();actions.text("SomeText_"+t,this.$anchor);},},{trigger:'.o_Discuss_thread .o_Composer_buttonSend',content:_t("Post your message on the thread"),position:"top",},{trigger:'.o_Discuss_thread .o_Message_commandStar',content:_t("Messages can be <b>starred</b> to remind you to check back later."),position:"bottom",},{trigger:'.o_DiscussSidebarItem.o-starred-box',content:_t("Once a message has been starred, you can come back and review it at any time here."),position:"bottom",},{trigger:'.o_DiscussSidebar_groupChat .o_DiscussSidebar_groupHeaderItemAdd',content:_t("<p><b>Chat with coworkers</b> in real-time using direct messages.</p><p><i>You might need to invite users from the Settings app first.</i></p>"),position:'bottom',}]);});;

/* /mail/static/src/js/tools/debug_manager.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail.DebugManager.Backend',function(require){"use strict";var core=require('web.core');var DebugManager=require('web.DebugManager.Backend');var _t=core._t;DebugManager.include({getMailMessages:function(){var selectedIDs=this._controller.getSelectedIds();if(!selectedIDs.length){console.warn(_t("No message available"));return;}
this.do_action({res_model:'mail.message',name:_t('Manage Messages'),views:[[false,'list'],[false,'form']],type:'ir.actions.act_window',domain:[['res_id','=',selectedIDs[0]],['model','=',this._controller.modelName]],context:{default_res_model:this._controller.modelName,default_res_id:selectedIDs[0],},});},});});;

/* /mail/static/src/js/custom_filter_item.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail.CustomFilterItem',function(require){"use strict";const CustomFilterItem=require('web.CustomFilterItem');CustomFilterItem.patch('mail.CustomFilterItem',T=>class extends T{_validateField(field){return super._validateField(...arguments)&&field.relation!=='mail.message'&&field.name!=='message_ids';}});return CustomFilterItem;});;

/* /mail/static/src/js/utils.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail.utils',function(require){"use strict";var core=require('web.core');var _t=core._t;function parseAndTransform(htmlString,transformFunction){var openToken="OPEN"+Date.now();var string=htmlString.replace(/&lt;/g,openToken);var children;try{children=$('<div>').html(string).contents();}catch(e){children=$('<div>').html('<pre>'+string+'</pre>').contents();}
return _parseAndTransform(children,transformFunction).replace(new RegExp(openToken,"g"),"&lt;");}
function _parseAndTransform(nodes,transformFunction){return _.map(nodes,function(node){return transformFunction(node,function(){return _parseAndTransform(node.childNodes,transformFunction);});}).join("");}
var urlRegexp=/\b(?:https?:\/\/\d{1,3}(?:\.\d{1,3}){3}|(?:https?:\/\/|(?:www\.))[-a-z0-9@:%._+~#=]{2,256}\.[a-z]{2,13})\b(?:[-a-z0-9@:%_+.~#?&'$//=;]*)/gi;function linkify(text,attrs){attrs=attrs||{};if(attrs.target===undefined){attrs.target='_blank';}
if(attrs.target==='_blank'){attrs.rel='noreferrer noopener';}
attrs=_.map(attrs,function(value,key){return key+'="'+_.escape(value)+'"';}).join(' ');return text.replace(urlRegexp,function(url){var href=(!/^https?:\/\//i.test(url))?"http://"+url:url;return'<a '+attrs+' href="'+href+'">'+url+'</a>';});}
function addLink(node,transformChildren){if(node.nodeType===3){const linkified=linkify(node.data);if(linkified!==node.data){const div=document.createElement('div');div.innerHTML=linkified;for(const childNode of[...div.childNodes]){node.parentNode.insertBefore(childNode,node);}
node.parentNode.removeChild(node);return linkified;}
return node.textContent;}
if(node.tagName==="A")return node.outerHTML;transformChildren();return node.outerHTML;}
function htmlToTextContentInline(htmlString){const fragment=document.createDocumentFragment();const div=document.createElement('div');fragment.appendChild(div);htmlString=htmlString.replace(/<br\s*\/?>/gi,' ');try{div.innerHTML=htmlString;}catch(e){div.innerHTML=`<pre>${htmlString}</pre>`;}
return div.textContent.trim().replace(/[\n\r]/g,'').replace(/\s\s+/g,' ');}
function stripHTML(node,transformChildren){if(node.nodeType===3)return node.data;if(node.tagName==="BR")return"\n";return transformChildren();}
function inline(node,transform_children){if(node.nodeType===3)return node.data;if(node.nodeType===8)return"";if(node.tagName==="BR")return" ";if(node.tagName.match(/^(A|P|DIV|PRE|BLOCKQUOTE)$/))return transform_children();node.innerHTML=transform_children();return node.outerHTML;}
function parseEmail(text){if(text){var result=text.match(/(.*)<(.*@.*)>/);if(result){return[_.str.trim(result[1]),_.str.trim(result[2])];}
result=text.match(/(.*@.*)/);if(result){return[_.str.trim(result[1]),_.str.trim(result[1])];}
return[text,false];}}
function escapeAndCompactTextContent(content){let value=_.escape(content).trim();value=value.replace(/(\r|\n){2,}/g,'<br/><br/>');value=value.replace(/(\r|\n)/g,'<br/>');value=value.replace(/ /g,'&nbsp;').replace(/([^>])&nbsp;([^<])/g,'$1 $2');return value;}
function getTextToHTML(text){return text.replace(/((?:https?|ftp):\/\/[\S]+)/g,'<a href="$1">$1</a> ').replace(/[\n\r]/g,'<br/>');}
function timeFromNow(date){if(moment().diff(date,'seconds')<45){return _t("now");}
return date.fromNow();}
return{addLink:addLink,getTextToHTML:getTextToHTML,htmlToTextContentInline,inline:inline,linkify:linkify,parseAndTransform:parseAndTransform,parseEmail:parseEmail,stripHTML:stripHTML,timeFromNow:timeFromNow,escapeAndCompactTextContent,};});;

/* /mail/static/src/js/activity.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail.Activity',function(require){"use strict";var mailUtils=require('mail.utils');var AbstractField=require('web.AbstractField');var BasicModel=require('web.BasicModel');var config=require('web.config');var core=require('web.core');var field_registry=require('web.field_registry');var session=require('web.session');var framework=require('web.framework');var time=require('web.time');var QWeb=core.qweb;var _t=core._t;const _lt=core._lt;function _readActivities(self,ids){if(!ids.length){return Promise.resolve([]);}
var context=self.getSession().user_context;if(self.record&&!_.isEmpty(self.record.getContext())){context=self.record.getContext();}
return self._rpc({model:'mail.activity',method:'activity_format',args:[ids],context:context,}).then(function(activities){_.each(activities,function(activity){activity.create_date=moment(time.auto_str_to_date(activity.create_date));activity.date_deadline=moment(time.auto_str_to_date(activity.date_deadline));});activities=_.sortBy(activities,'date_deadline');return activities;});}
BasicModel.include({_fetchSpecialActivity:function(record,fieldName){var localID=(record._changes&&fieldName in record._changes)?record._changes[fieldName]:record.data[fieldName];return _readActivities(this,this.localData[localID].res_ids);},});var setDelayLabel=function(activities){var today=moment().startOf('day');_.each(activities,function(activity){var toDisplay='';var diff=activity.date_deadline.diff(today,'days',true);if(diff===0){toDisplay=_t("Today");}else{if(diff<0){if(diff===-1){toDisplay=_t("Yesterday");}else{toDisplay=_.str.sprintf(_t("%d days overdue"),Math.abs(diff));}}else{if(diff===1){toDisplay=_t("Tomorrow");}else{toDisplay=_.str.sprintf(_t("Due in %d days"),Math.abs(diff));}}}
activity.label_delay=toDisplay;});return activities;};var setFileUploadID=function(activities){_.each(activities,function(activity){if(activity.activity_category==='upload_file'){activity.fileuploadID=_.uniqueId('o_fileupload');}});return activities;};var BasicActivity=AbstractField.extend({events:{'click .o_edit_activity':'_onEditActivity','change input.o_input_file':'_onFileChanged','click .o_mark_as_done':'_onMarkActivityDone','click .o_mark_as_done_upload_file':'_onMarkActivityDoneUploadFile','click .o_activity_template_preview':'_onPreviewMailTemplate','click .o_schedule_activity':'_onScheduleActivity','click .o_activity_template_send':'_onSendMailTemplate','click .o_unlink_activity':'_onUnlinkActivity',},init:function(){this._super.apply(this,arguments);this._draftFeedback={};},scheduleActivity:function(){var callback=this._reload.bind(this,{activity:true,thread:true});return this._openActivityForm(false,callback);},_markActivityDone:function(params){var activityID=params.activityID;var feedback=params.feedback||false;var attachmentIds=params.attachmentIds||[];return this._sendActivityFeedback(activityID,feedback,attachmentIds).then(this._reload.bind(this,{activity:true,thread:true}));},_markActivityDoneAndScheduleNext:function(params){var activityID=params.activityID;var feedback=params.feedback;var self=this;this._rpc({model:'mail.activity',method:'action_feedback_schedule_next',args:[[activityID]],kwargs:{feedback:feedback},context:this.record.getContext(),}).then(function(rslt_action){if(rslt_action){self.do_action(rslt_action,{on_close:function(){self.trigger_up('reload');},});}else{self.trigger_up('reload');}});},_openActivityForm:function(id,callback){var action={type:'ir.actions.act_window',name:_t("Schedule Activity"),res_model:'mail.activity',view_mode:'form',views:[[false,'form']],target:'new',context:{default_res_id:this.res_id,default_res_model:this.model,},res_id:id||false,};return this.do_action(action,{on_close:callback});},_sendActivityFeedback:function(activityID,feedback,attachmentIds){return this._rpc({model:'mail.activity',method:'action_feedback',args:[[activityID]],kwargs:{feedback:feedback,attachment_ids:attachmentIds||[],},context:this.record.getContext(),});},_bindOnUploadAction:function(activities){var self=this;_.each(activities,function(activity){if(activity.fileuploadID){$(window).on(activity.fileuploadID,function(){framework.unblockUI();var files=Array.prototype.slice.call(arguments,1);self._markActivityDone({activityID:activity.id,attachmentIds:_.pluck(files,'id')}).then(function(){self.trigger_up('reload');});});}});},_bindPopoverFocusout:function($popover_el){var self=this;var $popover=$($popover_el.data("bs.popover").tip);var activityID=$popover_el.data('activity-id');$popover.off('focusout');$popover.focusout(function(e){if(!$popover.is(e.relatedTarget)&&!$popover.find(e.relatedTarget).length){self._draftFeedback[activityID]=$popover.find('#activity_feedback').val();$popover.popover('hide');}});},_onEditActivity:function(ev){ev.preventDefault();var activityID=$(ev.currentTarget).data('activity-id');return this._openActivityForm(activityID,this._reload.bind(this,{activity:true,thread:true}));},_onFileChanged:function(ev){ev.stopPropagation();ev.preventDefault();var $form=$(ev.currentTarget).closest('form');$form.submit();framework.blockUI();},_onMarkActivityDone:function(ev){ev.stopPropagation();ev.preventDefault();var self=this;var $markDoneBtn=$(ev.currentTarget);var activityID=$markDoneBtn.data('activity-id');var previousActivityTypeID=$markDoneBtn.data('previous-activity-type-id')||false;var forceNextActivity=$markDoneBtn.data('force-next-activity');if($markDoneBtn.data('toggle')==='collapse'){var $actLi=$markDoneBtn.parents('.o_log_activity');var $panel=self.$('#o_activity_form_'+activityID);if(!$panel.data('bs.collapse')){var $form=$(QWeb.render('mail.activity_feedback_form',{previous_activity_type_id:previousActivityTypeID,force_next:forceNextActivity}));$panel.append($form);self._onMarkActivityDoneActions($markDoneBtn,$form,activityID);_.each($panel.siblings('.o_activity_form'),function(el){if($(el).data('bs.collapse')){$(el).empty().collapse('dispose').removeClass('show');}});$markDoneBtn.parents('.o_activity_log_container').scrollTo($actLi.position().top,100);}
$panel.on('hidden.bs.collapse',function(){if($panel.data('bs.collapse')){$actLi.removeClass('o_activity_selected');$panel.collapse('dispose');$panel.empty();}});this.$('.o_activity_selected').removeClass('o_activity_selected');$actLi.toggleClass('o_activity_selected');$panel.collapse('toggle');}else if(!$markDoneBtn.data('bs.popover')){$markDoneBtn.popover({template:$(Popover.Default.template).addClass('o_mail_activity_feedback')[0].outerHTML,container:$markDoneBtn,title:_t("Feedback"),html:true,trigger:'manual',placement:'right',content:function(){var $popover=$(QWeb.render('mail.activity_feedback_form',{previous_activity_type_id:previousActivityTypeID,force_next:forceNextActivity}));self._onMarkActivityDoneActions($markDoneBtn,$popover,activityID);return $popover;},}).on('shown.bs.popover',function(){var $popover=$($(this).data("bs.popover").tip);$(".o_mail_activity_feedback.popover").not($popover).popover("hide");$popover.addClass('o_mail_activity_feedback').attr('tabindex',0);$popover.find('#activity_feedback').focus();self._bindPopoverFocusout($(this));}).popover('show');}else{var popover=$markDoneBtn.data('bs.popover');if($('#'+popover.tip.id).length===0){popover.show();}}},_onMarkActivityDoneActions:function($btn,$form,activityID){var self=this;$form.find('#activity_feedback').val(self._draftFeedback[activityID]);$form.on('click','.o_activity_popover_done',function(ev){ev.stopPropagation();self._markActivityDone({activityID:activityID,feedback:$form.find('#activity_feedback').val(),});});$form.on('click','.o_activity_popover_done_next',function(ev){ev.stopPropagation();self._markActivityDoneAndScheduleNext({activityID:activityID,feedback:$form.find('#activity_feedback').val(),});});$form.on('click','.o_activity_popover_discard',function(ev){ev.stopPropagation();if($btn.data('bs.popover')){$btn.popover('hide');}else if($btn.data('toggle')==='collapse'){self.$('#o_activity_form_'+activityID).collapse('hide');}});},_onMarkActivityDoneUploadFile:function(ev){ev.preventDefault();ev.stopPropagation();var fileuploadID=$(ev.currentTarget).data('fileupload-id');var $input=this.$("[target='"+fileuploadID+"'] > input.o_input_file");$input.click();},_onPreviewMailTemplate:function(ev){ev.stopPropagation();ev.preventDefault();var self=this;var templateID=$(ev.currentTarget).data('template-id');var action={name:_t('Compose Email'),type:'ir.actions.act_window',res_model:'mail.compose.message',views:[[false,'form']],target:'new',context:{default_res_id:this.res_id,default_model:this.model,default_use_template:true,default_template_id:templateID,force_email:true,},};return this.do_action(action,{on_close:function(){self.trigger_up('reload');}});},_onSendMailTemplate:function(ev){ev.stopPropagation();ev.preventDefault();var templateID=$(ev.currentTarget).data('template-id');return this._rpc({model:this.model,method:'activity_send_mail',args:[[this.res_id],templateID],}).then(this._reload.bind(this,{activity:true,thread:true,followers:true}));},_onScheduleActivity:function(ev){ev.preventDefault();return this._openActivityForm(false,this._reload.bind(this));},_onUnlinkActivity:function(ev,options){ev.preventDefault();var activityID=$(ev.currentTarget).data('activity-id');options=_.defaults(options||{},{model:'mail.activity',args:[[activityID]],});return this._rpc({model:options.model,method:'unlink',args:options.args,}).then(this._reload.bind(this,{activity:true}));},_unbindOnUploadAction:function(activities){_.each(activities,function(activity){if(activity.fileuploadID){$(window).off(activity.fileuploadID);}});},});var Activity=BasicActivity.extend({className:'o_mail_activity',events:_.extend({},BasicActivity.prototype.events,{'click a':'_onClickRedirect',}),specialData:'_fetchSpecialActivity',init:function(){this._super.apply(this,arguments);this._activities=this.record.specialData[this.name];},destroy:function(){this._unbindOnUploadAction();return this._super.apply(this,arguments);},_reload:function(fieldsToReload){this.trigger_up('reload_mail_fields',fieldsToReload);},_render:function(){_.each(this._activities,function(activity){var note=mailUtils.parseAndTransform(activity.note||'',mailUtils.inline);var is_blank=(/^\s*$/).test(note);if(!is_blank){activity.note=mailUtils.parseAndTransform(activity.note,mailUtils.addLink);}else{activity.note='';}});var activities=setFileUploadID(setDelayLabel(this._activities));if(activities.length){var nbActivities=_.countBy(activities,'state');this.$el.html(QWeb.render('mail.activity_items',{uid:session.uid,activities:activities,nbPlannedActivities:nbActivities.planned,nbTodayActivities:nbActivities.today,nbOverdueActivities:nbActivities.overdue,dateFormat:time.getLangDateFormat(),datetimeFormat:time.getLangDatetimeFormat(),session:session,widget:this,}));this._bindOnUploadAction(this._activities);}else{this._unbindOnUploadAction(this._activities);this.$el.empty();}},_reset:function(record){this._super.apply(this,arguments);this._activities=this.record.specialData[this.name];this.res_id=record.res_id;},_onClickRedirect:function(ev){var id=$(ev.currentTarget).data('oe-id');if(id){ev.preventDefault();var model=$(ev.currentTarget).data('oe-model');this.trigger_up('redirect',{res_id:id,res_model:model,});}},});var KanbanActivity=BasicActivity.extend({template:'mail.KanbanActivity',events:_.extend({},BasicActivity.prototype.events,{'show.bs.dropdown':'_onDropdownShow',}),fieldDependencies:_.extend({},BasicActivity.prototype.fieldDependencies,{activity_exception_decoration:{type:'selection'},activity_exception_icon:{type:'char'},activity_state:{type:'selection'},}),init:function(parent,name,record){this._super.apply(this,arguments);var selection={};_.each(record.fields.activity_state.selection,function(value){selection[value[0]]=value[1];});this.selection=selection;this._setState(record);},destroy:function(){this._unbindOnUploadAction();return this._super.apply(this,arguments);},_reload:function(){this.trigger_up('reload',{db_id:this.record_id});},_render:function(){const spanClasses=['fa','fa-lg','fa-fw'];spanClasses.push('o_activity_color_'+(this.activityState||'default'));if(this.recordData.activity_exception_decoration){spanClasses.push('text-'+this.recordData.activity_exception_decoration);spanClasses.push(this.recordData.activity_exception_icon);}else{spanClasses.push('fa-clock-o');}
this.$('.o_activity_btn > span').removeClass().addClass(spanClasses.join(' '));if(this.$el.hasClass('show')){this._renderDropdown();}},_renderDropdown:function(){var self=this;this.$('.o_activity').toggleClass('dropdown-menu-right',config.device.isMobile).html(QWeb.render('mail.KanbanActivityLoading'));return _readActivities(this,this.value.res_ids).then(function(activities){activities=setFileUploadID(activities);self.$('.o_activity').html(QWeb.render('mail.KanbanActivityDropdown',{selection:self.selection,records:_.groupBy(setDelayLabel(activities),'state'),session:session,widget:self,}));self._bindOnUploadAction(activities);});},_reset:function(record){this._super.apply(this,arguments);this._setState(record);},_setState:function(record){this.record_id=record.id;this.activityState=this.recordData.activity_state;},_onDropdownShow:function(){this._renderDropdown();},});const ListActivity=KanbanActivity.extend({template:'mail.ListActivity',events:Object.assign({},KanbanActivity.prototype.events,{'click .dropdown-menu.o_activity':'_onDropdownClicked',}),fieldDependencies:_.extend({},KanbanActivity.prototype.fieldDependencies,{activity_summary:{type:'char'},activity_type_id:{type:'many2one',relation:'mail.activity.type'},activity_type_icon:{type:'char'},}),label:_lt('Next Activity'),_render:async function(){await this._super(...arguments);this.$('.o_activity_btn > span').prop('special_click',true);if(this.value.count){let text;if(this.recordData.activity_exception_decoration){text=_t('Warning');}else{text=this.recordData.activity_summary||this.recordData.activity_type_id.data.display_name;}
this.$('.o_activity_summary').text(text);}
if(this.recordData.activity_type_icon){this.el.querySelector('.o_activity_btn > span').classList.replace('fa-clock-o',this.recordData.activity_type_icon);}},_onDropdownClicked:function(ev){ev.stopPropagation();},});var ActivityException=AbstractField.extend({noLabel:true,fieldDependencies:_.extend({},AbstractField.prototype.fieldDependencies,{activity_exception_icon:{type:'char'}}),_renderEdit:function(){return this._renderReadonly();},_renderReadonly:function(){this.$el.empty();if(this.value){this.$el.attr({title:_t('This record has an exception activity.'),class:"pull-right mt-1 text-"+this.value+" fa "+this.recordData.activity_exception_icon});}}});field_registry.add('kanban_activity',KanbanActivity).add('list_activity',ListActivity).add('activity_exception',ActivityException);return Activity;});;

/* /mail/static/src/js/views/activity/activity_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail.ActivityView',function(require){"use strict";const ActivityController=require('mail.ActivityController');const ActivityModel=require('mail.ActivityModel');const ActivityRenderer=require('mail.ActivityRenderer');const BasicView=require('web.BasicView');const core=require('web.core');const RendererWrapper=require('web.RendererWrapper');const view_registry=require('web.view_registry');const _lt=core._lt;const ActivityView=BasicView.extend({accesskey:"a",display_name:_lt('Activity'),icon:'fa-clock-o',config:_.extend({},BasicView.prototype.config,{Controller:ActivityController,Model:ActivityModel,Renderer:ActivityRenderer,}),viewType:'activity',searchMenuTypes:['filter','favorite'],init:function(){this._super.apply(this,arguments);this.loadParams.type='list';this.loadParams.limit=false;this.rendererParams.templates=_.findWhere(this.arch.children,{'tag':'templates'});this.controllerParams.title=this.arch.attrs.string;},getRenderer(parent,state){state=Object.assign({},state,this.rendererParams);return new RendererWrapper(null,this.config.Renderer,state);},});view_registry.add('activity',ActivityView);return ActivityView;});;

/* /mail/static/src/js/views/activity/activity_model.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail.ActivityModel',function(require){'use strict';const BasicModel=require('web.BasicModel');const session=require('web.session');const ActivityModel=BasicModel.extend({__get:function(){var result=this._super.apply(this,arguments);if(result&&result.model===this.modelName&&result.type==='list'){_.extend(result,this.additionalData,{getKanbanActivityData:this.getKanbanActivityData});}
return result;},getKanbanActivityData(activityGroup,resId){return{data:{activity_ids:{model:'mail.activity',res_ids:activityGroup.ids,},activity_state:activityGroup.state,closest_deadline:activityGroup.o_closest_deadline,},fields:{activity_ids:{},activity_state:{selection:[['overdue',"Overdue"],['today',"Today"],['planned',"Planned"],],},},fieldsInfo:{},model:this.model,type:'record',res_id:resId,getContext:function(){return{};},};},__load:function(params){this.originalDomain=_.extend([],params.domain);params.domain.push(['activity_ids','!=',false]);this.domain=params.domain;this.modelName=params.modelName;params.groupedBy=[];var def=this._super.apply(this,arguments);return Promise.all([def,this._fetchData()]).then(function(result){return result[0];});},__reload:function(handle,params){if(params&&'domain'in params){this.originalDomain=_.extend([],params.domain);params.domain.push(['activity_ids','!=',false]);this.domain=params.domain;}
if(params&&'groupBy'in params){params.groupBy=[];}
var def=this._super.apply(this,arguments);return Promise.all([def,this._fetchData()]).then(function(result){return result[0];});},_fetchData:function(){var self=this;return this._rpc({model:"mail.activity",method:'get_activity_data',kwargs:{res_model:this.modelName,domain:this.domain,context:session.user_context,}}).then(function(result){self.additionalData=result;});},});return ActivityModel;});;

/* /mail/static/src/js/views/activity/activity_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail.ActivityController',function(require){"use strict";require('mail.Activity');var BasicController=require('web.BasicController');var core=require('web.core');var field_registry=require('web.field_registry');var ViewDialogs=require('web.view_dialogs');var KanbanActivity=field_registry.get('kanban_activity');var _t=core._t;var ActivityController=BasicController.extend({custom_events:_.extend({},BasicController.prototype.custom_events,{empty_cell_clicked:'_onEmptyCell',send_mail_template:'_onSendMailTemplate',schedule_activity:'_onScheduleActivity',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.title=params.title;},_getPagingInfo:function(){return null;},_onScheduleActivity:function(){var self=this;var state=this.model.get(this.handle);new ViewDialogs.SelectCreateDialog(this,{res_model:state.model,domain:this.model.originalDomain,title:_.str.sprintf(_t("Search: %s"),this.title),no_create:!this.activeActions.create,disable_multiple_selection:true,context:state.context,on_selected:function(record){var fakeRecord=state.getKanbanActivityData({},record[0]);var widget=new KanbanActivity(self,'activity_ids',fakeRecord,{});widget.scheduleActivity();},}).open();},_onEmptyCell:function(ev){var state=this.model.get(this.handle);this.do_action({type:'ir.actions.act_window',res_model:'mail.activity',view_mode:'form',view_type:'form',views:[[false,'form']],target:'new',context:{default_res_id:ev.data.resId,default_res_model:state.model,default_activity_type_id:ev.data.activityTypeId,},res_id:false,},{on_close:this.reload.bind(this),});},_onSendMailTemplate:function(ev){var templateID=ev.data.templateID;var activityTypeID=ev.data.activityTypeID;var state=this.model.get(this.handle);var groupedActivities=state.grouped_activities;var resIDS=[];Object.keys(groupedActivities).forEach(function(resID){var activityByType=groupedActivities[resID];var activity=activityByType[activityTypeID];if(activity){resIDS.push(parseInt(resID));}});this._rpc({model:this.model.modelName,method:'activity_send_mail',args:[resIDS,templateID],});},});return ActivityController;});;

/* /mail/static/src/js/views/activity/activity_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail.ActivityRenderer',function(require){"use strict";const AbstractRendererOwl=require('web.AbstractRendererOwl');const ActivityCell=require('mail.ActivityCell');const ActivityRecord=require('mail.ActivityRecord');const{ComponentAdapter}=require('web.OwlCompatibility');const core=require('web.core');const KanbanColumnProgressBar=require('web.KanbanColumnProgressBar');const patchMixin=require('web.patchMixin');const QWeb=require('web.QWeb');const session=require('web.session');const utils=require('web.utils');const _t=core._t;const{useState}=owl.hooks;class ActivityRecordAdapter extends ComponentAdapter{renderWidget(){_.invoke(_.pluck(this.widget.subWidgets,'$el'),'detach');this.widget._render();}
updateWidget(nextProps){const state=nextProps.widgetArgs[0];this.widget._setState(state);}}
class ActivityCellAdapter extends ComponentAdapter{renderWidget(){this.widget._render();}
updateWidget(nextProps){const record=nextProps.widgetArgs[1];this.widget._reset(record);}}
class KanbanColumnProgressBarAdapter extends ComponentAdapter{renderWidget(){this.widget._render();}
updateWidget(nextProps){const options=nextProps.widgetArgs[0];const columnState=nextProps.widgetArgs[1];const columnId=options.columnID;const nextActiveFilter=options.progressBarStates[columnId].activeFilter;this.widget.activeFilter=nextActiveFilter?this.widget.activeFilter:false;this.widget.columnState=columnState;this.widget.computeCounters();}
_trigger_up(ev){if(this.el){super._trigger_up(ev);}}}
class ActivityRenderer extends AbstractRendererOwl{constructor(parent,props){super(...arguments);this.qweb=new QWeb(this.env.isDebug(),{_s:session.origin});this.qweb.add_template(utils.json_node_to_xml(props.templates));this.activeFilter=useState({state:null,activityTypeId:null,resIds:[]});this.widgetComponents={ActivityRecord,ActivityCell,KanbanColumnProgressBar,};}
get activityResIds(){const copiedActivityResIds=Array.from(this.props.activity_res_ids)
return copiedActivityResIds.sort((a,b)=>this.activeFilter.resIds.includes(a)?-1:0);}
get activityTypeIds(){const activities=Object.values(this.props.grouped_activities);const activityIds=activities.flatMap(Object.keys);const uniqueIds=Array.from(new Set(activityIds));return uniqueIds.map(Number);}
getProgressBarOptions(typeId){return{columnID:typeId,progressBarStates:{[typeId]:{activeFilter:this.activeFilter.activityTypeId===typeId,},},};}
getProgressBarColumnState(typeId){const counts={planned:0,today:0,overdue:0};for(let activities of Object.values(this.props.grouped_activities)){if(typeId in activities){counts[activities[typeId].state]+=1;}}
return{count:Object.values(counts).reduce((x,y)=>x+y),fields:{activity_state:{type:'selection',selection:[['planned',_t('Planned')],['today',_t('Today')],['overdue',_t('Overdue')],],},},progressBarValues:{field:'activity_state',colors:{planned:'success',today:'warning',overdue:'danger'},counts:counts,},};}
_onEmptyCellClicked(ev){this.trigger('empty_cell_clicked',{resId:parseInt(ev.currentTarget.dataset.resId,10),activityTypeId:parseInt(ev.currentTarget.dataset.activityTypeId,10),});}
_onSendMailTemplateClicked(ev){this.trigger('send_mail_template',{activityTypeID:parseInt(ev.currentTarget.dataset.activityTypeId,10),templateID:parseInt(ev.currentTarget.dataset.templateId,10),});}
_onSetProgressBarState(ev){if(ev.detail.values.activeFilter){this.activeFilter.state=ev.detail.values.activeFilter;this.activeFilter.activityTypeId=ev.detail.columnID;this.activeFilter.resIds=Object.entries(this.props.grouped_activities).filter(([,resIds])=>ev.detail.columnID in resIds&&resIds[ev.detail.columnID].state===ev.detail.values.activeFilter).map(([key])=>parseInt(key));}else{this.activeFilter.state=null;this.activeFilter.activityTypeId=null;this.activeFilter.resIds=[];}}}
ActivityRenderer.components={ActivityRecordAdapter,ActivityCellAdapter,KanbanColumnProgressBarAdapter,};ActivityRenderer.template='mail.ActivityRenderer';return patchMixin(ActivityRenderer);});;

/* /mail/static/src/js/views/activity/activity_record.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail.ActivityRecord',function(require){"use strict";var KanbanRecord=require('web.KanbanRecord');var ActivityRecord=KanbanRecord.extend({init:function(parent,state){this._super.apply(this,arguments);this.fieldsInfo=state.fieldsInfo.activity;},_render:function(){this.defs=[];this._replaceElement(this.qweb.render('activity-box',this.qweb_context));this.$el.on('click',this._onGlobalClick.bind(this));this.$el.addClass('o_activity_record');this._processFields();this._setupColor();return Promise.all(this.defs);},_setFieldDisplay:function($el,fieldName){this._super.apply(this,arguments);if(this.fieldsInfo[fieldName].muted){$el.addClass('text-muted');}},_setState:function(){this._super.apply(this,arguments);this.qweb_context={activity_image:this._getImageURL.bind(this),record:this.record,user_context:this.getSession().user_context,widget:this,};},});return ActivityRecord;});;

/* /mail/static/src/js/views/activity/activity_cell.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("mail.ActivityCell",function(require){"use strict";require("mail.Activity");const field_registry=require('web.field_registry');const KanbanActivity=field_registry.get('kanban_activity');const ActivityCell=KanbanActivity.extend({_render(){const $date=$('<div class="o_closest_deadline">');const date=new Date(this.record.data.closest_deadline);if(moment().year()===moment(date).year()){$date.text(date.toLocaleDateString(moment().locale(),{day:'numeric',month:'short'}));}else{$date.text(moment(date).format('ll'));}
this.$('a').html($date);if(this.record.data.activity_ids.res_ids.length>1){this.$('a').append($('<span>',{class:'badge badge-light badge-pill border-0 '+this.record.data.activity_state,text:this.record.data.activity_ids.res_ids.length,}));}
if(this.$el.hasClass('show')){this._renderDropdown();}}});return ActivityCell;});;

/* /mail/static/src/js/emojis.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail.emojis',function(require){"use strict";var data={":)":"",":-)":"","=)":"",":]":"",":D":"",":-D":"","=D":"","xD":"","XD":"","x'D":"",";)":"",";-)":"","B)":"","8)":"","B-)":"","8-)":"",";p":"",";P":"",":p":"",":P":"",":-p":"",":-P":"","=P":"","xp":"","xP":"","o_o":"",":|":"",":-|":"",":/":"",":-/":"",":(":"",":@":"",":O":"",":-O":"",":o":"",":-o":"",":'o":"","3:(":"",">:(":"","3:":"","3:)":"",">:)":"",":*":"",":-*":"","o:)":"",":'(":"",":'-(":"",":\"(":"","<3":"","&lt;3":"",":heart":"","</3":"","&lt;/3":"",":heart_eyes":"",":turban":"",":+1":"",":-1":"",":ok":"",":poop":"",":no_see":"",":no_hear":"",":no_speak":"",":bug":"",":kitten":"",":bear":"",":snail":"",":boar":"",":clover":"",":sunflower":"",":fire":"",":sun":"",":partly_sunny:":"",":rainbow":"",":cloud":"",":zap":"",":star":"",":cookie":"",":pizza":"",":hamburger":"",":fries":"",":cake":"",":cake_part":"",":coffee":"",":banana":"",":sushi":"",":rice_ball":"",":beer":"",":wine":"",":cocktail":"",":tropical":"",":beers":"",":ghost":"",":skull":"",":et":"",":alien":"",":party":"",":trophy":"",":key":"",":pin":"",":postal_horn":"",":music":"",":trumpet":"",":guitar":"",":run":"",":bike":"",":soccer":"",":football":"",":8ball":"",":clapper":"",":microphone":"",":cheese":"",};var emojiDict={};_.each(data,function(unicode,source){if(!emojiDict[unicode]){emojiDict[unicode]={sources:[source],unicode:unicode,description:source,};}else{emojiDict[unicode].sources.push(source);}});var emojis=_.values(emojiDict);return emojis;});;

/* /mail/static/src/js/emojis_mixin.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail.emoji_mixin',function(require){"use strict";var emojis=require('mail.emojis');return{_onEmojiClick:function(ev){var unicode=ev.currentTarget.textContent.trim();var textInput=this._getTargetTextElement($(ev.currentTarget))[0];var selectionStart=textInput.selectionStart;textInput.value=textInput.value.slice(0,selectionStart)+unicode+textInput.value.slice(selectionStart);textInput.focus();textInput.setSelectionRange(selectionStart+unicode.length,selectionStart+unicode.length);},_formatText:function(message){message=this._htmlEscape(message);message=this._wrapEmojis(message);message=message.replace(/(?:\r\n|\r|\n)/g,'<br>');return message;},_htmlEscape:function(s){if(s==null){return'';}
return String(s).replace(/</g,'&lt;').replace(/>/g,'&gt;');},_wrapEmojis:function(message){emojis.forEach(function(emoji){message=message.replace(new RegExp(emoji.unicode.replace(/[.*+?^${}()|[\]\\]/g,'\\$&'),'g'),'<span class="o_mail_emoji">'+emoji.unicode+'</span>');});return message;}};});;

/* /mail/static/src/js/field_emojis_common.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail.field_emojis_common',function(require){"use strict";var basicFields=require('web.basic_fields');var core=require('web.core');var emojis=require('mail.emojis');var MailEmojisMixin=require('mail.emoji_mixin');var _onEmojiClickMixin=MailEmojisMixin._onEmojiClick;var QWeb=core.qweb;var FieldEmojiCommon={init:function(){this._super.apply(this,arguments);this._triggerOnchange=_.throttle(this._triggerOnchange,1000,{leading:false});this.emojis=emojis;},on_attach_callback:function(){this._attachEmojisDropdown();},_render:function(){this._super.apply(this,arguments);if(this.mode!=='edit'){this.$el.html(this._formatText(this.$el.text()));}},_onEmojiClick:function(){_onEmojiClickMixin.apply(this,arguments);this._isDirty=true;this.$input.trigger('change');},_onKeydown:function(){this._super.apply(this,arguments);if(this.nodeOptions.onchange_on_keydown){this._triggerOnchange();}},_getTargetTextElement(){return this.$el;},_triggerOnchange:function(){this.$input.trigger('change');},_attachEmojisDropdown:function(){if(!this.$emojisIcon){this.$emojisIcon=$(QWeb.render('mail.EmojisDropdown',{widget:this}));this.$emojisIcon.find('.o_mail_emoji').on('click',this._onEmojiClick.bind(this));if(this.$el.filter('span.o_field_translate').length){this.$emojisIcon.addClass('o_mail_emojis_dropdown_translation');}
if(this.$el.filter('textarea').length){this.$emojisIcon.addClass('o_mail_emojis_dropdown_textarea');}
this.$el.last().after(this.$emojisIcon);}
if(this.mode==='edit'){this.$emojisIcon.show();}else{this.$emojisIcon.hide();}}};return FieldEmojiCommon;});;

/* /mail/static/src/js/field_char_emojis.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail.field_char_emojis',function(require){"use strict";var basicFields=require('web.basic_fields');var registry=require('web.field_registry');var FieldEmojiCommon=require('mail.field_emojis_common');var MailEmojisMixin=require('mail.emoji_mixin');var FieldCharEmojis=basicFields.FieldChar.extend(MailEmojisMixin,FieldEmojiCommon);registry.add('char_emojis',FieldCharEmojis);return FieldCharEmojis;});;

/* /mail/static/src/js/field_text_emojis.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail.field_text_emojis',function(require){"use strict";var basicFields=require('web.basic_fields');var registry=require('web.field_registry');var FieldEmojiCommon=require('mail.field_emojis_common');var MailEmojisMixin=require('mail.emoji_mixin');var FieldTextEmojis=basicFields.FieldText.extend(MailEmojisMixin,FieldEmojiCommon);registry.add('text_emojis',FieldTextEmojis);return FieldTextEmojis;});;

/* /mail/static/src/bugfix/bugfix.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/bugfix/bugfix.js',function(require){'use strict';});;

/* /mail/static/src/component_hooks/use_drag_visible_dropzone/use_drag_visible_dropzone.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/component_hooks/use_drag_visible_dropzone/use_drag_visible_dropzone.js',function(require){'use strict';const{useRef,useState,onMounted,onWillUnmount}=owl.hooks;function useDragVisibleDropZone(){const isVisible=useState({value:false});const dropzoneRef=useRef('dropzone');let dragCount=0;onMounted(()=>{document.addEventListener('dragenter',_onDragenterListener,true);document.addEventListener('dragleave',_onDragleaveListener,true);document.addEventListener('drop',_onDropListener,true);});onWillUnmount(()=>{document.removeEventListener('dragenter',_onDragenterListener,true);document.removeEventListener('dragleave',_onDragleaveListener,true);document.removeEventListener('drop',_onDropListener,true);});function _onDragenterListener(ev){if(dragCount===0){isVisible.value=true;}
dragCount++;}
function _onDragleaveListener(ev){dragCount--;if(dragCount===0){isVisible.value=false;}}
function _onDropListener(ev){dragCount=0;if(dropzoneRef.comp&&!dropzoneRef.comp.contains(ev.target)){isVisible.value=false;}}
return isVisible;}
return useDragVisibleDropZone;});;

/* /mail/static/src/component_hooks/use_refs/use_refs.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/component_hooks/use_refs/use_refs.js',function(require){'use strict';const{Component}=owl;function useRefs(){const component=Component.current;return function(){return component.__owl__.refs||{};};}
return useRefs;});;

/* /mail/static/src/component_hooks/use_store/use_store.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/component_hooks/use_store/use_store.js',function(require){'use strict';function useStore(selector,options={}){const store=options.store||owl.Component.current.env.store;const hashFn=store.observer.revNumber.bind(store.observer);const isEqual=options.isEqual||((a,b)=>a===b);function proxyComparator(){let oldRevNumber;function compare(a,b){let ok=true;const newRevNumber=hashFn(b);if(a===b&&newRevNumber>0){ok=oldRevNumber===newRevNumber;}else{ok=isEqual(a,b);}
oldRevNumber=newRevNumber;return ok;}
return compare;}
function proxyComparatorDeep(compareDepth=0){const comparator=proxyComparator();const comparators={};function compare(a,b){if(a===b&&hashFn(b)>0){return comparator(a,b);}
let ok=true;const newKeys=Object.keys(b);if(!a||(Object.keys(a).length!==newKeys.length)){ok=false;}
for(const key of newKeys){let depth;if(typeof compareDepth==='number'){depth=compareDepth;}else{depth=compareDepth[key]||0;}
if(!(key in comparators)){if(depth>0){comparators[key]=proxyComparatorDeep(depth-1);}else{comparators[key]=proxyComparator();}}
if(!comparators[key](a?a[key]:a,b[key])){ok=false;}}
return ok;}
return compare;}
const extendedSelector=(state,props)=>selector(props);return owl.hooks.useStore(extendedSelector,Object.assign({},options,{isEqual:proxyComparatorDeep(options.compareDepth),}));}
return useStore;});;

/* /mail/static/src/components/activity/activity.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/activity/activity.js',function(require){'use strict';const components={ActivityMarkDonePopover:require('mail/static/src/components/activity_mark_done_popover/activity_mark_done_popover.js'),FileUploader:require('mail/static/src/components/file_uploader/file_uploader.js'),MailTemplate:require('mail/static/src/components/mail_template/mail_template.js'),};const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{auto_str_to_date,getLangDateFormat,getLangDatetimeFormat,}=require('web.time');const{Component,useState}=owl;const{useRef}=owl.hooks;class Activity extends Component{constructor(...args){super(...args);this.state=useState({areDetailsVisible:false,});useStore(props=>{const activity=this.env.models['mail.activity'].get(props.activityLocalId);return{activity:activity?activity.__state:undefined,assigneeNameOrDisplayName:(activity&&activity.assignee&&activity.assignee.nameOrDisplayName),};});this._fileUploaderRef=useRef('fileUploader');}
get activity(){return this.env.models['mail.activity'].get(this.props.activityLocalId);}
get assignedUserText(){return _.str.sprintf(this.env._t("for %s"),this.activity.assignee.nameOrDisplayName);}
get delayLabel(){const today=moment().startOf('day');const momentDeadlineDate=moment(auto_str_to_date(this.activity.dateDeadline));const diff=momentDeadlineDate.diff(today,'days',true);if(diff===0){return this.env._t("Today:");}else if(diff===-1){return this.env._t("Yesterday:");}else if(diff<0){return _.str.sprintf(this.env._t("%d days overdue:"),Math.abs(diff));}else if(diff===1){return this.env._t("Tomorrow:");}else{return _.str.sprintf(this.env._t("Due in %d days:"),Math.abs(diff));}}
get formattedCreateDatetime(){const momentCreateDate=moment(auto_str_to_date(this.activity.dateCreate));const datetimeFormat=getLangDatetimeFormat();return momentCreateDate.format(datetimeFormat);}
get formattedDeadlineDate(){const momentDeadlineDate=moment(auto_str_to_date(this.activity.dateDeadline));const datetimeFormat=getLangDateFormat();return momentDeadlineDate.format(datetimeFormat);}
get MARK_DONE(){return this.env._t("Mark Done");}
get summary(){return _.str.sprintf(this.env._t("%s"),this.activity.summary);}
_onAttachmentCreated(ev){this.activity.markAsDone({attachments:[ev.detail.attachment]});}
_onClick(ev){if(ev.target.tagName==='A'&&ev.target.dataset.oeId&&ev.target.dataset.oeModel){this.env.messaging.openProfile({id:Number(ev.target.dataset.oeId),model:ev.target.dataset.oeModel,});ev.preventDefault();}}
_onClickCancel(ev){ev.preventDefault();this.activity.deleteServerRecord();}
_onClickDetailsButton(){this.state.areDetailsVisible=!this.state.areDetailsVisible;}
_onClickEdit(ev){this.activity.edit();}
_onClickUploadDocument(ev){this._fileUploaderRef.comp.openBrowserFileUploader();}}
Object.assign(Activity,{components,props:{activityLocalId:String,},template:'mail.Activity',});return Activity;});;

/* /mail/static/src/components/activity_box/activity_box.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/activity_box/activity_box.js',function(require){'use strict';const components={Activity:require('mail/static/src/components/activity/activity.js'),};const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component}=owl;class ActivityBox extends Component{constructor(...args){super(...args);useStore(props=>{const chatter=this.env.models['mail.chatter'].get(props.chatterLocalId);const thread=chatter&&chatter.thread;return{chatter:chatter?chatter.__state:undefined,thread:thread&&thread.__state,};});}
get chatter(){return this.env.models['mail.chatter'].get(this.props.chatterLocalId);}
_onClickTitle(){this.chatter.toggleActivityBoxVisibility();}}
Object.assign(ActivityBox,{components,props:{chatterLocalId:String,},template:'mail.ActivityBox',});return ActivityBox;});;

/* /mail/static/src/components/activity_mark_done_popover/activity_mark_done_popover.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/activity_mark_done_popover/activity_mark_done_popover.js',function(require){'use strict';const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component}=owl;const{useRef}=owl.hooks;class ActivityMarkDonePopover extends Component{constructor(...args){super(...args);useStore(props=>{const activity=this.env.models['mail.activity'].get(props.activityLocalId);return{activity:activity?activity.__state:undefined,};});this._feedbackTextareaRef=useRef('feedbackTextarea');}
mounted(){this._feedbackTextareaRef.el.focus();}
get activity(){return this.env.models['mail.activity'].get(this.props.activityLocalId);}
get DONE_AND_SCHEDULE_NEXT(){return this.env._t("Done & Schedule Next");}
_close(){this.trigger('o-popover-close');}
_onClickDiscard(){this._close();}
_onClickDone(){this.activity.markAsDone({feedback:this._feedbackTextareaRef.el.value,});}
_onClickDoneAndScheduleNext(){this.activity.markAsDoneAndScheduleNext({feedback:this._feedbackTextareaRef.el.value,});}
_onKeydown(ev){if(ev.key==='Escape'){this._close();}}}
Object.assign(ActivityMarkDonePopover,{props:{activityLocalId:String,},template:'mail.ActivityMarkDonePopover',});return ActivityMarkDonePopover;});;

/* /mail/static/src/components/attachment/attachment.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/attachment/attachment.js',function(require){'use strict';const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const components={AttachmentDeleteConfirmDialog:require('mail/static/src/components/attachment_delete_confirm_dialog/attachment_delete_confirm_dialog.js'),};const{Component,useState}=owl;class Attachment extends Component{constructor(...args){super(...args);useStore(props=>{const attachment=this.env.models['mail.attachment'].get(props.attachmentLocalId);return{attachment:attachment?attachment.__state:undefined,};});this.state=useState({hasDeleteConfirmDialog:false,});}
get attachment(){return this.env.models['mail.attachment'].get(this.props.attachmentLocalId);}
get attachmentUrl(){if(this.attachment.isTemporary){return'';}
return this.env.session.url('/web/content',{id:this.attachment.id,download:true,});}
get detailsMode(){if(this.props.detailsMode!=='auto'){return this.props.detailsMode;}
if(this.attachment.fileType!=='image'){return'card';}
return'hover';}
get imageStyle(){if(this.attachment.fileType!=='image'){return'';}
if(this.env.isQUnitTest){return'';}
let size;if(this.detailsMode==='card'){size='38x38';}else{size='160x160';}
return`background-image:url(/web/image/${this.attachment.id}/${size}/?crop=true);`;}
_onClickDownload(ev){ev.stopPropagation();window.location=`/web/content/ir.attachment/${this.attachment.id}/datas?download=true`;}
_onClickImage(ev){if(!this.attachment.isViewable){return;}
this.env.models['mail.attachment'].view({attachment:this.attachment,attachments:this.props.attachmentLocalIds.map(attachmentLocalId=>this.env.models['mail.attachment'].get(attachmentLocalId)),});}
_onClickUnlink(ev){ev.stopPropagation();if(this.attachment.isLinkedToComposer){this.attachment.remove();this.trigger('o-attachment-removed',{attachmentLocalId:this.props.attachmentLocalId});}else{this.state.hasDeleteConfirmDialog=true;}}
_onDeleteConfirmDialogClosed(){this.state.hasDeleteConfirmDialog=false;}}
Object.assign(Attachment,{components,defaultProps:{attachmentLocalIds:[],detailsMode:'auto',imageSize:'medium',isDownloadable:false,isEditable:true,showExtension:true,showFilename:true,},props:{attachmentLocalId:String,attachmentLocalIds:{type:Array,element:String,},detailsMode:{type:String,validate:prop=>['auto','card','hover','none'].includes(prop),},imageSize:{type:String,validate:prop=>['small','medium','large'].includes(prop),},isDownloadable:Boolean,isEditable:Boolean,showExtension:Boolean,showFilename:Boolean,},template:'mail.Attachment',});return Attachment;});;

/* /mail/static/src/components/attachment_box/attachment_box.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/attachment_box/attachment_box.js',function(require){'use strict';const components={AttachmentList:require('mail/static/src/components/attachment_list/attachment_list.js'),DropZone:require('mail/static/src/components/drop_zone/drop_zone.js'),FileUploader:require('mail/static/src/components/file_uploader/file_uploader.js'),};const useDragVisibleDropZone=require('mail/static/src/component_hooks/use_drag_visible_dropzone/use_drag_visible_dropzone.js');const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component}=owl;const{useRef}=owl.hooks;class AttachmentBox extends Component{constructor(...args){super(...args);this.isDropZoneVisible=useDragVisibleDropZone();useStore(props=>{const thread=this.env.models['mail.thread'].get(props.threadLocalId);return{attachments:thread?thread.allAttachments.map(attachment=>attachment.__state):[],thread:thread?thread.__state:undefined,};});this._fileUploaderRef=useRef('fileUploader');}
get newAttachmentExtraData(){return{originThread:[['link',this.thread]],};}
get thread(){return this.env.models['mail.thread'].get(this.props.threadLocalId);}
_onAttachmentCreated(ev){this.trigger('o-attachments-changed');}
_onAttachmentRemoved(ev){this.trigger('o-attachments-changed');}
_onClickAdd(ev){ev.preventDefault();ev.stopPropagation();this._fileUploaderRef.comp.openBrowserFileUploader();}
async _onDropZoneFilesDropped(ev){ev.stopPropagation();await this._fileUploaderRef.comp.uploadFiles(ev.detail.files);this.isDropZoneVisible.value=false;}}
Object.assign(AttachmentBox,{components,props:{threadLocalId:String,},template:'mail.AttachmentBox',});return AttachmentBox;});;

/* /mail/static/src/components/attachment_delete_confirm_dialog/attachment_delete_confirm_dialog.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/attachment_delete_confirm_dialog/attachment_delete_confirm_dialog.js',function(require){'use strict';const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const components={Dialog:require('web.OwlDialog'),};const{Component}=owl;const{useRef}=owl.hooks;class AttachmentDeleteConfirmDialog extends Component{constructor(...args){super(...args);useStore(props=>{const attachment=this.env.models['mail.attachment'].get(props.attachmentLocalId);return{attachment:attachment?attachment.__state:undefined,};});this._dialogRef=useRef('dialog');}
get attachment(){return this.env.models['mail.attachment'].get(this.props.attachmentLocalId);}
getBody(){return _.str.sprintf(this.env._t(`Do you really want to delete "%s"?`),owl.utils.escape(this.attachment.displayName));}
getTitle(){return this.env._t("Confirmation");}
_onClickCancel(){this._dialogRef.comp._close();}
_onClickOk(){this._dialogRef.comp._close();this.attachment.remove();this.trigger('o-attachment-removed',{attachmentLocalId:this.props.attachmentLocalId});}}
Object.assign(AttachmentDeleteConfirmDialog,{components,props:{attachmentLocalId:String,},template:'mail.AttachmentDeleteConfirmDialog',});return AttachmentDeleteConfirmDialog;});;

/* /mail/static/src/components/attachment_list/attachment_list.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/attachment_list/attachment_list.js',function(require){'use strict';const components={Attachment:require('mail/static/src/components/attachment/attachment.js'),};const{Component}=owl;class AttachmentList extends Component{}
Object.assign(AttachmentList,{components,defaultProps:{attachmentLocalIds:[],},props:{areAttachmentsDownloadable:{type:Boolean,optional:true,},areAttachmentsEditable:{type:Boolean,optional:true,},attachmentLocalIds:{type:Array,element:String,},attachmentsDetailsMode:{type:String,optional:true,validate:prop=>['auto','card','hover','none'].includes(prop),},attachmentsImageSize:{type:String,optional:true,validate:prop=>['small','medium','large'].includes(prop),},showAttachmentsExtensions:{type:Boolean,optional:true,},showAttachmentsFilenames:{type:Boolean,optional:true,},},template:'mail.AttachmentList',});return AttachmentList;});;

/* /mail/static/src/components/attachment_viewer/attachment_viewer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/attachment_viewer/attachment_viewer.js',function(require){'use strict';const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component,QWeb}=owl;const{useRef}=owl.hooks;const MIN_SCALE=0.5;const SCROLL_ZOOM_STEP=0.1;const ZOOM_STEP=0.5;class AttachmentViewer extends Component{constructor(...args){super(...args);this.MIN_SCALE=MIN_SCALE;useStore(props=>{const attachmentViewer=this.env.models['mail.attachment_viewer'].get(props.localId);return{attachment:attachmentViewer&&attachmentViewer.attachment?attachmentViewer.attachment.__state:undefined,attachments:attachmentViewer?attachmentViewer.attachments.map(attachment=>attachment.__state):[],attachmentViewer:attachmentViewer?attachmentViewer.__state:undefined,};});this._isDragging=false;this._imageRef=useRef('image');this._zoomerRef=useRef('zoomer');this._translate={x:0,y:0,dx:0,dy:0};this._renderedAttachment=undefined;this._onClickGlobal=this._onClickGlobal.bind(this);}
mounted(){this.el.focus();this._handleImageLoad();this._renderedAttachment=this.attachmentViewer.attachment;document.addEventListener('click',this._onClickGlobal);}
patched(){this._handleImageLoad();this._renderedAttachment=this.attachmentViewer.attachment;}
willUnmount(){document.removeEventListener('click',this._onClickGlobal);}
get attachmentViewer(){return this.env.models['mail.attachment_viewer'].get(this.props.localId);}
get imageStyle(){const attachmentViewer=this.attachmentViewer;let style=`transform: `+`scale3d(${attachmentViewer.scale}, ${attachmentViewer.scale}, 1) `+`rotate(${attachmentViewer.angle}deg);`;if(attachmentViewer.angle%180!==0){style+=``+`max-height: ${window.innerWidth}px; `+`max-width: ${window.innerHeight}px;`;}else{style+=``+`max-height: 100%; `+`max-width: 100%;`;}
return style;}
isCloseable(){return!this._isDragging;}
_close(){this.attachmentViewer.close();}
_download(){const id=this.attachmentViewer.attachment.id;this.env.services.navigate(`/web/content/ir.attachment/${id}/datas`,{download:true});}
_handleImageLoad(){if(this.attachmentViewer.attachment.fileType==='image'&&this._renderedAttachment!==this.attachmentViewer.attachment){this.attachmentViewer.update({isImageLoading:true});this._imageRef.el.addEventListener('load',ev=>this._onLoadImage(ev));}}
_next(){const attachmentViewer=this.attachmentViewer;const index=attachmentViewer.attachments.findIndex(attachment=>attachment===attachmentViewer.attachment);const nextIndex=(index+1)%attachmentViewer.attachments.length;attachmentViewer.update({attachment:[['link',attachmentViewer.attachments[nextIndex]]],});}
_previous(){const attachmentViewer=this.attachmentViewer;const index=attachmentViewer.attachments.findIndex(attachment=>attachment===attachmentViewer.attachment);const nextIndex=index===0?attachmentViewer.attachments.length-1:index-1;attachmentViewer.update({attachment:[['link',attachmentViewer.attachments[nextIndex]]],});}
_print(){const printWindow=window.open('about:blank','_new');printWindow.document.open();printWindow.document.write(`
            <html>
                <head>
                    <script>
                        function onloadImage() {
                            setTimeout('printImage()', 10);
                        }
                        function printImage() {
                            window.print();
                            window.close();
                        }
                    </script>
                </head>
                <body onload='onloadImage()'>
                    <img src="${this.attachmentViewer.attachment.defaultSource}" alt=""/>
                </body>
            </html>`);printWindow.document.close();}
_rotate(){this.attachmentViewer.update({angle:this.attachmentViewer.angle+90});}
_stopDragging(){this._isDragging=false;this._translate.x+=this._translate.dx;this._translate.y+=this._translate.dy;this._translate.dx=0;this._translate.dy=0;this._updateZoomerStyle();}
_updateZoomerStyle(){const attachmentViewer=this.attachmentViewer;const tx=this._imageRef.el.offsetWidth*attachmentViewer.scale>this._zoomerRef.el.offsetWidth?this._translate.x+this._translate.dx:0;const ty=this._imageRef.el.offsetHeight*attachmentViewer.scale>this._zoomerRef.el.offsetHeight?this._translate.y+this._translate.dy:0;if(tx===0){this._translate.x=0;}
if(ty===0){this._translate.y=0;}
this._zoomerRef.el.style=`transform: `+`translate(${tx}px, ${ty}px)`;}
_zoomIn({scroll=false}={}){this.attachmentViewer.update({scale:this.attachmentViewer.scale+(scroll?SCROLL_ZOOM_STEP:ZOOM_STEP),});this._updateZoomerStyle();}
_zoomOut({scroll=false}={}){if(this.attachmentViewer.scale===MIN_SCALE){return;}
const unflooredAdaptedScale=(this.attachmentViewer.scale-
(scroll?SCROLL_ZOOM_STEP:ZOOM_STEP));this.attachmentViewer.update({scale:Math.max(MIN_SCALE,unflooredAdaptedScale),});this._updateZoomerStyle();}
_zoomReset(){this.attachmentViewer.update({scale:1});this._updateZoomerStyle();}
_onClick(ev){if(this._isDragging){return;}
this._close();}
_onClickClose(ev){this._close();}
_onClickDownload(ev){ev.stopPropagation();this._download();}
_onClickGlobal(ev){if(!this._isDragging){return;}
ev.stopPropagation();this._stopDragging();}
_onClickHeader(ev){ev.stopPropagation();}
_onClickImage(ev){if(this._isDragging){return;}
ev.stopPropagation();}
_onClickNext(ev){ev.stopPropagation();this._next();}
_onClickPrevious(ev){ev.stopPropagation();this._previous();}
_onClickPrint(ev){ev.stopPropagation();this._print();}
_onClickRotate(ev){ev.stopPropagation();this._rotate();}
_onClickVideo(ev){ev.stopPropagation();}
_onClickZoomIn(ev){ev.stopPropagation();this._zoomIn();}
_onClickZoomOut(ev){ev.stopPropagation();this._zoomOut();}
_onClickZoomReset(ev){ev.stopPropagation();this._zoomReset();}
_onKeydown(ev){switch(ev.key){case'ArrowRight':this._next();break;case'ArrowLeft':this._previous();break;case'Escape':this._close();break;case'q':this._close();break;case'r':this._rotate();break;case'+':this._zoomIn();break;case'-':this._zoomOut();break;case'0':this._zoomReset();break;default:return;}
ev.stopPropagation();}
_onLoadImage(ev){ev.stopPropagation();this.attachmentViewer.update({isImageLoading:false});}
_onMousedownImage(ev){if(this._isDragging){return;}
if(ev.button!==0){return;}
ev.stopPropagation();this._isDragging=true;this._dragstartX=ev.clientX;this._dragstartY=ev.clientY;}
_onMousemoveView(ev){if(!this._isDragging){return;}
this._translate.dx=ev.clientX-this._dragstartX;this._translate.dy=ev.clientY-this._dragstartY;this._updateZoomerStyle();}
_onWheelImage(ev){ev.stopPropagation();if(!this.el){return;}
if(ev.deltaY>0){this._zoomOut({scroll:true});}else{this._zoomIn({scroll:true});}}}
Object.assign(AttachmentViewer,{props:{localId:String,},template:'mail.AttachmentViewer',});QWeb.registerComponent('AttachmentViewer',AttachmentViewer);return AttachmentViewer;});;

/* /mail/static/src/components/autocomplete_input/autocomplete_input.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/autocomplete_input/autocomplete_input.js',function(require){'use strict';const{Component}=owl;class AutocompleteInput extends Component{mounted(){if(this.props.isFocusOnMount){this.el.focus();}
let args={select:(ev,ui)=>this._onAutocompleteSelect(ev,ui),source:(req,res)=>this._onAutocompleteSource(req,res),focus:ev=>this._onAutocompleteFocus(ev),html:this.props.isHtml||false,};if(this.props.customClass){args.classes={'ui-autocomplete':this.props.customClass};}
$(this.el).autocomplete(args);}
willUnmount(){$(this.el).autocomplete('destroy');}
contains(node){if(this.el.contains(node)){return true;}
if(!this.props.customClass){return false;}
const element=document.querySelector(`.${this.props.customClass}`);if(!element){return false;}
return element.contains(node);}
focus(){if(!this.el){return;}
this.el.focus();}
focusout(){if(!this.el){return;}
this.el.blur();}
_onAutocompleteFocus(ev){if(this.props.focus){this.props.focus(ev);}else{ev.preventDefault();}}
_onAutocompleteSelect(ev,ui){if(this.props.select){this.props.select(ev,ui);}}
_onAutocompleteSource(req,res){if(this.props.source){this.props.source(req,res);}}
_onBlur(ev){this.trigger('o-hide');}
_onKeydown(ev){if(ev.key==='Escape'){this.trigger('o-hide');}}}
Object.assign(AutocompleteInput,{defaultProps:{isFocusOnMount:false,isHtml:false,placeholder:'',},props:{customClass:{type:String,optional:true,},focus:{type:Function,optional:true,},isFocusOnMount:Boolean,isHtml:Boolean,placeholder:String,select:{type:Function,optional:true,},source:{type:Function,optional:true,},},template:'mail.AutocompleteInput',});return AutocompleteInput;});;

/* /mail/static/src/components/chat_window/chat_window.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/chat_window/chat_window.js',function(require){'use strict';const components={AutocompleteInput:require('mail/static/src/components/autocomplete_input/autocomplete_input.js'),ChatWindowHeader:require('mail/static/src/components/chat_window_header/chat_window_header.js'),ThreadView:require('mail/static/src/components/thread_view/thread_view.js'),};const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{isEventHandled}=require('mail/static/src/utils/utils.js');const{Component}=owl;const{useRef}=owl.hooks;class ChatWindow extends Component{constructor(...args){super(...args);useStore(props=>{const chatWindow=this.env.models['mail.chat_window'].get(props.chatWindowLocalId);const thread=chatWindow?chatWindow.thread:undefined;return{chatWindow:chatWindow?chatWindow.__state:undefined,isDeviceMobile:this.env.messaging.device.isMobile,localeTextDirection:this.env.messaging.locale.textDirection,thread:thread?thread.__state:undefined,};});this._chatWindowHeaderRef=useRef('header');this._inputRef=useRef('input');this._threadRef=useRef('thread');this._onAutocompleteSelect=this._onAutocompleteSelect.bind(this);this._onAutocompleteSource=this._onAutocompleteSource.bind(this);}
mounted(){this.env.messagingBus.on('will_hide_home_menu',this,this._onWillHideHomeMenu.bind(this));this.env.messagingBus.on('will_show_home_menu',this,this._onWillShowHomeMenu.bind(this));this._update();}
patched(){this._update();}
willUnmount(){this.env.messagingBus.off('will_hide_home_menu',this,this._onWillHideHomeMenu.bind(this));this.env.messagingBus.off('will_show_home_menu',this,this._onWillShowHomeMenu.bind(this));}
get chatWindow(){return this.env.models['mail.chat_window'].get(this.props.chatWindowLocalId);}
get newMessageFormInputPlaceholder(){return this.env._t("Search user...");}
_applyVisibleOffset(){const textDirection=this.env.messaging.locale.textDirection;const offsetFrom=textDirection==='rtl'?'left':'right';const oppositeFrom=offsetFrom==='right'?'left':'right';this.el.style[offsetFrom]=this.chatWindow.visibleOffset+'px';this.el.style[oppositeFrom]='auto';}
_focus(){this.chatWindow.update({isDoFocus:false,isFocused:true,});if(this._inputRef.comp){this._inputRef.comp.focus();}
if(this._threadRef.comp){this._threadRef.comp.focus();}}
_saveThreadScrollTop(){if(!this._threadRef.comp||!this.chatWindow.threadViewer){return;}
this.chatWindow.threadViewer.saveThreadCacheScrollHeightAsInitial(this._threadRef.comp.getScrollHeight());this.chatWindow.threadViewer.saveThreadCacheScrollPositionsAsInitial(this._threadRef.comp.getScrollTop());}
_update(){if(!this.chatWindow){return;}
if(this.chatWindow.isDoFocus){this._focus();}
this._applyVisibleOffset();}
async _onAutocompleteSelect(ev,ui){const chat=await this.env.messaging.getChat({partnerId:ui.item.id});if(!chat){return;}
this.env.messaging.chatWindowManager.openThread(chat,{makeActive:true,replaceNewMessage:true,});}
_onAutocompleteSource(req,res){this.env.models['mail.partner'].imSearch({callback:(partners)=>{const suggestions=partners.map(partner=>{return{id:partner.id,value:partner.nameOrDisplayName,label:partner.nameOrDisplayName,};});res(_.sortBy(suggestions,'label'));},keyword:_.escape(req.term),limit:10,});}
_onClickedHeader(ev){ev.stopPropagation();if(this.env.messaging.device.isMobile){return;}
if(this.chatWindow.isFolded){this.chatWindow.unfold();this.chatWindow.focus();}else{this._saveThreadScrollTop();this.chatWindow.fold();}}
_onFocusinThread(ev){ev.stopPropagation();if(!this.chatWindow){return;}
this.chatWindow.update({isFocused:true});}
_onFocusout(){if(!this.chatWindow){return;}
this.chatWindow.update({isFocused:false});}
_onKeydown(ev){ev.stopPropagation();if(!this.chatWindow){return;}
switch(ev.key){case'Tab':ev.preventDefault();if(ev.shiftKey){this.chatWindow.focusPreviousVisibleUnfoldedChatWindow();}else{this.chatWindow.focusNextVisibleUnfoldedChatWindow();}
break;case'Escape':if(isEventHandled(ev,'ComposerTextInput.closeSuggestions')){break;}
if(isEventHandled(ev,'Composer.closeEmojisPopover')){break;}
ev.preventDefault();this.chatWindow.focusNextVisibleUnfoldedChatWindow();this.chatWindow.close();break;}}
async _onWillHideHomeMenu(){this._saveThreadScrollTop();}
async _onWillShowHomeMenu(){this._saveThreadScrollTop();}}
Object.assign(ChatWindow,{components,defaultProps:{hasCloseAsBackButton:false,isExpandable:false,isFullscreen:false,},props:{chatWindowLocalId:String,hasCloseAsBackButton:Boolean,isExpandable:Boolean,isFullscreen:Boolean,},template:'mail.ChatWindow',});return ChatWindow;});;

/* /mail/static/src/components/chat_window_header/chat_window_header.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/chat_window_header/chat_window_header.js',function(require){'use strict';const components={ThreadIcon:require('mail/static/src/components/thread_icon/thread_icon.js'),};const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component}=owl;class ChatWindowHeader extends Component{constructor(...args){super(...args);useStore(props=>{const chatWindow=this.env.models['mail.chat_window'].get(props.chatWindowLocalId);const thread=chatWindow&&chatWindow.thread;return{chatWindow:chatWindow?chatWindow.__state:undefined,isDeviceMobile:this.env.messaging.device.isMobile,thread:thread?thread.__state:undefined,};});}
get chatWindow(){return this.env.models['mail.chat_window'].get(this.props.chatWindowLocalId);}
_onClick(ev){const chatWindow=this.chatWindow;this.trigger('o-clicked',{chatWindow});}
_onClickClose(ev){ev.stopPropagation();this.chatWindow.close();}
_onClickExpand(ev){ev.stopPropagation();this.chatWindow.expand();}
_onClickShiftLeft(ev){ev.stopPropagation();this.chatWindow.shiftLeft();}
_onClickShiftRight(ev){ev.stopPropagation();this.chatWindow.shiftRight();}}
Object.assign(ChatWindowHeader,{components,defaultProps:{hasCloseAsBackButton:false,isExpandable:false,},props:{chatWindowLocalId:String,hasCloseAsBackButton:Boolean,isExpandable:Boolean,},template:'mail.ChatWindowHeader',});return ChatWindowHeader;});;

/* /mail/static/src/components/chat_window_hidden_menu/chat_window_hidden_menu.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/chat_window_hidden_menu/chat_window_hidden_menu.js',function(require){'use strict';const components={ChatWindowHeader:require('mail/static/src/components/chat_window_header/chat_window_header.js'),};const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component}=owl;const{useRef}=owl.hooks;class ChatWindowHiddenMenu extends Component{constructor(...args){super(...args);useStore(props=>{const chatWindowManager=this.env.messaging.chatWindowManager;const device=this.env.messaging.device;const locale=this.env.messaging.locale;return{chatWindowManager:chatWindowManager?chatWindowManager.__state:undefined,device:device?device.__state:undefined,localeTextDirection:locale?locale.textDirection:undefined,};});this._onClickCaptureGlobal=this._onClickCaptureGlobal.bind(this);this._listRef=useRef('list');this._wasMenuOpen;}
mounted(){this._apply();document.addEventListener('click',this._onClickCaptureGlobal,true);}
patched(){this._apply();}
willUnmount(){document.removeEventListener('click',this._onClickCaptureGlobal,true);}
_apply(){this._applyListHeight();this._applyOffset();this._wasMenuOpen=this.env.messaging.chatWindowManager.isHiddenMenuOpen;}
_applyListHeight(){const device=this.env.messaging.device;const height=device.globalWindowInnerHeight/2;this._listRef.el.style['max-height']=`${height}px`;}
_applyOffset(){const textDirection=this.env.messaging.locale.textDirection;const offsetFrom=textDirection==='rtl'?'left':'right';const oppositeFrom=offsetFrom==='right'?'left':'right';const offset=this.env.messaging.chatWindowManager.visual.hidden.offset;this.el.style[offsetFrom]=`${offset}px`;this.el.style[oppositeFrom]='auto';}
_onClickCaptureGlobal(ev){if(this.el.contains(ev.target)){return;}
this.env.messaging.chatWindowManager.closeHiddenMenu();}
_onClickToggle(ev){if(this._wasMenuOpen){this.env.messaging.chatWindowManager.closeHiddenMenu();}else{this.env.messaging.chatWindowManager.openHiddenMenu();}}
_onClickedChatWindow(ev){const chatWindow=ev.detail.chatWindow;chatWindow.makeActive();this.env.messaging.chatWindowManager.closeHiddenMenu();}}
Object.assign(ChatWindowHiddenMenu,{components,props:{},template:'mail.ChatWindowHiddenMenu',});return ChatWindowHiddenMenu;});;

/* /mail/static/src/components/chat_window_manager/chat_window_manager.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/chat_window_manager/chat_window_manager.js',function(require){'use strict';const components={ChatWindow:require('mail/static/src/components/chat_window/chat_window.js'),ChatWindowHiddenMenu:require('mail/static/src/components/chat_window_hidden_menu/chat_window_hidden_menu.js'),};const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component}=owl;class ChatWindowManager extends Component{constructor(...args){super(...args);useStore(props=>{const chatWindowManager=this.env.messaging&&this.env.messaging.chatWindowManager;const allOrderedVisible=chatWindowManager?chatWindowManager.allOrderedVisible:[];return{allOrderedVisible:allOrderedVisible.map(chatWindow=>chatWindow?chatWindow.__state:undefined),chatWindowManager:chatWindowManager?chatWindowManager.__state:undefined,isMessagingInitialized:this.env.isMessagingInitialized(),};},{compareDepth:{allOrderedVisible:1,},});}}
Object.assign(ChatWindowManager,{components,props:{},template:'mail.ChatWindowManager',});return ChatWindowManager;});;

/* /mail/static/src/components/chatter/chatter.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/chatter/chatter.js',function(require){'use strict';const components={ActivityBox:require('mail/static/src/components/activity_box/activity_box.js'),AttachmentBox:require('mail/static/src/components/attachment_box/attachment_box.js'),ChatterTopbar:require('mail/static/src/components/chatter_topbar/chatter_topbar.js'),Composer:require('mail/static/src/components/composer/composer.js'),ThreadView:require('mail/static/src/components/thread_view/thread_view.js'),};const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component}=owl;const{useRef}=owl.hooks;class Chatter extends Component{constructor(...args){super(...args);useStore(props=>{const chatter=this.env.models['mail.chatter'].get(props.chatterLocalId);const thread=chatter?chatter.thread:undefined;let attachments=[];if(thread){attachments=thread.allAttachments;}
return{attachments:attachments.map(attachment=>attachment.__state),chatter:chatter?chatter.__state:undefined,thread:thread?thread.__state:undefined,};},{compareDepth:{attachments:1,},});this._composerRef=useRef('composer');this._threadRef=useRef('thread');}
mounted(){this._update();}
patched(){this._update();}
get chatter(){return this.env.models['mail.chatter'].get(this.props.chatterLocalId);}
_notifyRendered(){this.trigger('o-chatter-rendered',{attachments:this.chatter.thread.allAttachments,thread:this.chatter.thread.localId,});}
_update(){if(this.chatter.thread){this._notifyRendered();}
if(this.chatter.isDoFocus){this.chatter.update({isDoFocus:false});const composer=this._composerRef.comp;if(composer){composer.focus();}}}
_onComposerMessagePosted(){this.chatter.update({isComposerVisible:false});}
_onScrollPanelScroll(ev){if(!this._threadRef.comp){return;}
this._threadRef.comp.onScroll(ev);}}
Object.assign(Chatter,{components,props:{chatterLocalId:String,},template:'mail.Chatter',});return Chatter;});;

/* /mail/static/src/components/chatter_container/chatter_container.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/chatter_container/chatter_container.js',function(require){'use strict';const components={Chatter:require('mail/static/src/components/chatter/chatter.js'),};const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{clear}=require('mail/static/src/model/model_field_command.js');const{Component}=owl;class ChatterContainer extends Component{constructor(...args){super(...args);this.chatter=undefined;this._wasMessagingInitialized=false;useStore(props=>{const isMessagingInitialized=this.env.isMessagingInitialized();if(!this._wasMessagingInitialized&&isMessagingInitialized){this._wasMessagingInitialized=true;this._insertFromProps(props);}
return{chatter:this.chatter};});}
mounted(){this._update();}
willUpdateProps(nextProps){if(this.env.isMessagingInitialized()){this._insertFromProps(nextProps);}
return super.willUpdateProps(...arguments);}
patched(){this._update();}
destroy(){super.destroy();if(this.chatter){this.chatter.delete();}}
_insertFromProps(props){const values=Object.assign({},props);if(values.threadId===undefined){values.threadId=clear();}
if(!this.chatter){this.chatter=this.env.models['mail.chatter'].create(values);}else{this.chatter.update(values);}}
_update(){if(this.chatter){this.chatter.refresh();}}}
Object.assign(ChatterContainer,{components,props:{hasActivities:{type:Boolean,optional:true,},hasExternalBorder:{type:Boolean,optional:true,},hasFollowers:{type:Boolean,optional:true,},hasMessageList:{type:Boolean,optional:true,},hasMessageListScrollAdjust:{type:Boolean,optional:true,},hasTopbarCloseButton:{type:Boolean,optional:true,},isAttachmentBoxVisibleInitially:{type:Boolean,optional:true,},threadId:{type:Number,optional:true,},threadModel:String,},template:'mail.ChatterContainer',});return ChatterContainer;});;

/* /mail/static/src/components/chatter_topbar/chatter_topbar.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/chatter_topbar/chatter_topbar.js',function(require){'use strict';const components={FollowButton:require('mail/static/src/components/follow_button/follow_button.js'),FollowerListMenu:require('mail/static/src/components/follower_list_menu/follower_list_menu.js'),};const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component}=owl;class ChatterTopbar extends Component{constructor(...args){super(...args);useStore(props=>{const chatter=this.env.models['mail.chatter'].get(props.chatterLocalId);const thread=chatter?chatter.thread:undefined;const threadAttachments=thread?thread.allAttachments:[];return{areThreadAttachmentsLoaded:thread&&thread.areAttachmentsLoaded,chatter:chatter?chatter.__state:undefined,composer:chatter&&chatter.composer?chatter.composer.__state:undefined,threadAttachmentsAmount:threadAttachments.length,};});}
get chatter(){return this.env.models['mail.chatter'].get(this.props.chatterLocalId);}
_onClickAttachments(ev){this.chatter.update({isAttachmentBoxVisible:!this.chatter.isAttachmentBoxVisible,});}
_onClickClose(ev){this.trigger('o-close-chatter');}
_onClickLogNote(ev){if(!this.chatter.composer){return;}
if(this.chatter.isComposerVisible&&this.chatter.composer.isLog){this.chatter.update({isComposerVisible:false});}else{this.chatter.showLogNote();}}
_onClickScheduleActivity(ev){const action={type:'ir.actions.act_window',name:this.env._t("Schedule Activity"),res_model:'mail.activity',view_mode:'form',views:[[false,'form']],target:'new',context:{default_res_id:this.chatter.thread.id,default_res_model:this.chatter.thread.model,},res_id:false,};return this.env.bus.trigger('do-action',{action,options:{on_close:()=>{this.chatter.thread.refreshActivities();this.chatter.thread.refresh();},},});}
_onClickSendMessage(ev){if(!this.chatter.composer){return;}
if(this.chatter.isComposerVisible&&!this.chatter.composer.isLog){this.chatter.update({isComposerVisible:false});}else{this.chatter.showSendMessage();}}}
Object.assign(ChatterTopbar,{components,props:{chatterLocalId:String,},template:'mail.ChatterTopbar',});return ChatterTopbar;});;

/* /mail/static/src/components/composer/composer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/composer/composer.js',function(require){'use strict';const components={AttachmentList:require('mail/static/src/components/attachment_list/attachment_list.js'),ComposerSuggestedRecipientList:require('mail/static/src/components/composer_suggested_recipient_list/composer_suggested_recipient_list.js'),DropZone:require('mail/static/src/components/drop_zone/drop_zone.js'),EmojisPopover:require('mail/static/src/components/emojis_popover/emojis_popover.js'),FileUploader:require('mail/static/src/components/file_uploader/file_uploader.js'),TextInput:require('mail/static/src/components/composer_text_input/composer_text_input.js'),ThreadTextualTypingStatus:require('mail/static/src/components/thread_textual_typing_status/thread_textual_typing_status.js'),};const useDragVisibleDropZone=require('mail/static/src/component_hooks/use_drag_visible_dropzone/use_drag_visible_dropzone.js');const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{isEventHandled,markEventHandled,}=require('mail/static/src/utils/utils.js');const{Component}=owl;const{useRef}=owl.hooks;class Composer extends Component{constructor(...args){super(...args);this.isDropZoneVisible=useDragVisibleDropZone();useStore(props=>{const composer=this.env.models['mail.composer'].get(props.composerLocalId);return{composer:composer?composer.__state:undefined,isDeviceMobile:this.env.messaging.device.isMobile,thread:composer&&composer.thread?composer.thread.__state:undefined,};});this._emojisPopoverRef=useRef('emojisPopover');this._fileUploaderRef=useRef('fileUploader');this._textInputRef=useRef('textInput');this._subjectRef=useRef('subject');this._onClickCaptureGlobal=this._onClickCaptureGlobal.bind(this);}
mounted(){document.addEventListener('click',this._onClickCaptureGlobal,true);this._update();}
patched(){this._update();}
willUnmount(){document.removeEventListener('click',this._onClickCaptureGlobal,true);}
get composer(){return this.env.models['mail.composer'].get(this.props.composerLocalId);}
contains(node){const emojisPopover=this._emojisPopoverRef.comp;if(emojisPopover&&emojisPopover.contains(node)){return true;}
return this.el.contains(node);}
get currentPartnerAvatar(){const avatar=this.env.messaging.currentUser?this.env.session.url('/web/image',{field:'image_128',id:this.env.messaging.currentUser.id,model:'res.users',}):'/web/static/src/img/user_menu_avatar.png';return avatar;}
focus(){if(this.env.messaging.device.isMobile){this.el.scrollIntoView();}
this._textInputRef.comp.focus();}
focusout(){this._textInputRef.comp.focusout();}
get hasFooter(){return(this.props.hasThreadTyping||this.composer.attachments.length>0||!this.props.isCompact);}
get hasHeader(){return((this.props.hasThreadName&&this.composer.thread)||(this.props.hasFollowers&&!this.composer.isLog));}
get newAttachmentExtraData(){return{composers:[['replace',this.composer]],};}
async _postMessage(){if(!this.composer.canPostMessage){if(this.composer.hasUploadingAttachment){this.env.services['notification'].notify({message:this.env._t("Please wait while the file is uploading."),type:'warning',});}
return;}
await this.composer.postMessage();this.trigger('o-message-posted');}
_update(){if(this._subjectRef.el){this._subjectRef.el.value=this.composer.subjectContent;}}
_onClickAddAttachment(){this._fileUploaderRef.comp.openBrowserFileUploader();if(!this.env.device.isMobile){this.focus();}}
_onClickCaptureGlobal(ev){if(this.contains(ev.target)){return;}
this.composer.discard();}
_onClickFullComposer(){this.composer.openFullComposer();}
_onClickDiscard(ev){this.composer.discard();}
_onClickSend(){this._postMessage();}
_onComposerSuggestionClicked(){this.focus();}
_onComposerTextInputSendShortcut(){this._postMessage();}
async _onDropZoneFilesDropped(ev){ev.stopPropagation();await this._fileUploaderRef.comp.uploadFiles(ev.detail.files);this.isDropZoneVisible.value=false;}
_onEmojiSelection(ev){ev.stopPropagation();this._textInputRef.comp.saveStateInStore();this.composer.insertIntoTextInput(ev.detail.unicode);if(!this.env.device.isMobile){this.focus();}}
_onInputSubject(){this.composer.update({subjectContent:this._subjectRef.el.value});}
_onKeydown(ev){if(ev.key==='Escape'){if(isEventHandled(ev,'ComposerTextInput.closeSuggestions')){return;}
if(isEventHandled(ev,'Composer.closeEmojisPopover')){return;}
ev.preventDefault();this.composer.discard();}}
_onKeydownEmojiButton(ev){if(ev.key==='Escape'){if(this._emojisPopoverRef.comp){this._emojisPopoverRef.comp.close();this.focus();markEventHandled(ev,'Composer.closeEmojisPopover');}}}
async _onPasteTextInput(ev){if(!ev.clipboardData||!ev.clipboardData.files){return;}
await this._fileUploaderRef.comp.uploadFiles(ev.clipboardData.files);}}
Object.assign(Composer,{components,defaultProps:{attachmentLocalIds:[],hasCurrentPartnerAvatar:true,hasDiscardButton:false,hasFollowers:false,hasSendButton:true,hasThreadName:false,hasThreadTyping:false,isCompact:true,isExpandable:false,},props:{attachmentLocalIds:{type:Array,element:String,},attachmentsDetailsMode:{type:String,optional:true,},composerLocalId:String,hasCurrentPartnerAvatar:Boolean,hasDiscardButton:Boolean,hasFollowers:Boolean,hasMentionSuggestionsBelowPosition:{type:Boolean,optional:true,},hasSendButton:Boolean,hasThreadName:Boolean,hasThreadTyping:Boolean,showAttachmentsExtensions:{type:Boolean,optional:true,},showAttachmentsFilenames:{type:Boolean,optional:true,},initialAttachmentLocalIds:{type:Array,element:String,optional:true,},initialTextInputHtmlContent:{type:String,optional:true,},isCompact:Boolean,isExpandable:Boolean,textInputSendShortcuts:{type:Array,element:String,optional:true,},},template:'mail.Composer',});return Composer;});;

/* /mail/static/src/components/composer_suggested_recipient/composer_suggested_recipient.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/composer_suggested_recipient/composer_suggested_recipient.js',function(require){'use strict';const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{FormViewDialog}=require('web.view_dialogs');const{ComponentAdapter}=require('web.OwlCompatibility');const{Component}=owl;const{useRef}=owl.hooks;class FormViewDialogComponentAdapter extends ComponentAdapter{renderWidget(){return this.willStart();}}
const components={FormViewDialogComponentAdapter,};class ComposerSuggestedRecipient extends Component{constructor(...args){super(...args);this.id=_.uniqueId('o_ComposerSuggestedRecipient_');useStore(props=>{const suggestedRecipientInfo=this.env.models['mail.suggested_recipient_info'].get(props.suggestedRecipientLocalId);const partner=suggestedRecipientInfo&&suggestedRecipientInfo.partner;return{partner:partner&&partner.__state,suggestedRecipientInfo:suggestedRecipientInfo&&suggestedRecipientInfo.__state,};});this.FormViewDialog=FormViewDialog;this._checkboxRef=useRef('checkbox');this._dialogRef=useRef('dialog');this._isDialogOpen=false;this._onDialogSaved=this._onDialogSaved.bind(this);}
mounted(){this._update();}
patched(){this._update();}
get ADD_AS_RECIPIENT_AND_FOLLOWER_REASON(){if(!this.suggestedRecipientInfo){return undefined;}
return this.env._t(_.str.sprintf("Add as recipient and follower (reason: %s)",this.suggestedRecipientInfo.reason));}
get PLEASE_COMPLETE_CUSTOMER_S_INFORMATION(){return this.env._t("Please complete customer's information");}
get suggestedRecipientInfo(){return this.env.models['mail.suggested_recipient_info'].get(this.props.suggestedRecipientInfoLocalId);}
_update(){if(this._checkboxRef.el&&this.suggestedRecipientInfo){this._checkboxRef.el.checked=this.suggestedRecipientInfo.isSelected;}}
_onChangeCheckbox(){const isChecked=this._checkboxRef.el.checked;this.suggestedRecipientInfo.update({isSelected:isChecked});if(!this.suggestedRecipientInfo.partner){if(isChecked&&this._dialogRef&&!this._isDialogOpen){this._isDialogOpen=true;this._dialogRef.comp.widget.on('closed',this,()=>{this._isDialogOpen=false;});this._dialogRef.comp.widget.open();}}}
_onDialogSaved(){const thread=this.suggestedRecipientInfo&&this.suggestedRecipientInfo.thread;if(!thread){return;}
thread.fetchAndUpdateSuggestedRecipients();}}
Object.assign(ComposerSuggestedRecipient,{components,props:{suggestedRecipientInfoLocalId:String,},template:'mail.ComposerSuggestedRecipient',});return ComposerSuggestedRecipient;});;

/* /mail/static/src/components/composer_suggested_recipient_list/composer_suggested_recipient_list.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/composer_suggested_recipient_list/composer_suggested_recipient_list.js',function(require){'use strict';const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component}=owl;const{useState}=owl.hooks;const components={ComposerSuggestedRecipient:require('mail/static/src/components/composer_suggested_recipient/composer_suggested_recipient.js'),};class ComposerSuggestedRecipientList extends Component{constructor(...args){super(...args);this.state=useState({hasShowMoreButton:false,});useStore(props=>{const thread=this.env.models['mail.thread'].get(props.threadLocalId);return{thread:thread?thread.__state:undefined,};});}
get thread(){return this.env.models['mail.thread'].get(this.props.threadLocalId);}
_onClickShowLess(ev){this.state.hasShowMoreButton=false;}
_onClickShowMore(ev){this.state.hasShowMoreButton=true;}}
Object.assign(ComposerSuggestedRecipientList,{components,props:{threadLocalId:String,},template:'mail.ComposerSuggestedRecipientList',});return ComposerSuggestedRecipientList;});;

/* /mail/static/src/components/composer_suggestion/composer_suggestion.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/composer_suggestion/composer_suggestion.js',function(require){'use strict';const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const components={PartnerImStatusIcon:require('mail/static/src/components/partner_im_status_icon/partner_im_status_icon.js'),};const{Component}=owl;class ComposerSuggestion extends Component{constructor(...args){super(...args);useStore(props=>{const composer=this.env.models['mail.composer'].get(this.props.composerLocalId);const record=this.env.models[props.modelName].get(props.recordLocalId);return{composer:composer&&composer.__state,record:record?record.__state:undefined,};});}
mounted(){this._update();}
patched(){this._update();}
get composer(){return this.env.models['mail.composer'].get(this.props.composerLocalId);}
get isCannedResponse(){return this.props.modelName==="mail.canned_response";}
get isChannel(){return this.props.modelName==="mail.thread";}
get isCommand(){return this.props.modelName==="mail.channel_command";}
get isPartner(){return this.props.modelName==="mail.partner";}
get record(){return this.env.models[this.props.modelName].get(this.props.recordLocalId);}
title(){if(this.isCannedResponse){return _.str.sprintf("%s: %s",this.record.source,this.record.substitution);}
if(this.isChannel){return this.record.name;}
if(this.isCommand){return _.str.sprintf("%s: %s",this.record.name,this.record.help);}
if(this.isPartner){if(this.record.email){return _.str.sprintf("%s (%s)",this.record.nameOrDisplayName,this.record.email);}
return this.record.nameOrDisplayName;}
return"";}
_update(){if(this.composer&&this.composer.hasToScrollToActiveSuggestion&&this.props.isActive){this.el.scrollIntoView({block:'center',});this.composer.update({hasToScrollToActiveSuggestion:false});}}
_onClick(ev){ev.preventDefault();this.composer.update({[this.composer.activeSuggestedRecordName]:[['link',this.record]],});this.composer.insertSuggestion();this.composer.closeSuggestions();this.trigger('o-composer-suggestion-clicked');}}
Object.assign(ComposerSuggestion,{components,defaultProps:{isActive:false,},props:{composerLocalId:String,isActive:Boolean,modelName:String,recordLocalId:String,},template:'mail.ComposerSuggestion',});return ComposerSuggestion;});;

/* /mail/static/src/components/composer_suggestion_list/composer_suggestion_list.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/composer_suggestion_list/composer_suggestion_list.js',function(require){'use strict';const components={ComposerSuggestion:require('mail/static/src/components/composer_suggestion/composer_suggestion.js'),};const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component}=owl;class ComposerSuggestionList extends Component{constructor(...args){super(...args);useStore(props=>{const composer=this.env.models['mail.composer'].get(props.composerLocalId);const activeSuggestedRecord=composer?composer.activeSuggestedRecord:undefined;const extraSuggestedRecordsList=composer?composer.extraSuggestedRecordsList:[];const mainSuggestedRecordsList=composer?composer.mainSuggestedRecordsList:[];return{activeSuggestedRecord:activeSuggestedRecord?activeSuggestedRecord.__state:undefined,composer:composer?composer.__state:undefined,extraSuggestedRecordsList:extraSuggestedRecordsList?extraSuggestedRecordsList.map(record=>record.__state):[],mainSuggestedRecordsList:mainSuggestedRecordsList?mainSuggestedRecordsList.map(record=>record.__state):[],};},{compareDepth:{extraSuggestedRecordsList:1,mainSuggestedRecordsList:1,},});}
get composer(){return this.env.models['mail.composer'].get(this.props.composerLocalId);}}
Object.assign(ComposerSuggestionList,{components,defaultProps:{isBelow:false,},props:{composerLocalId:String,isBelow:Boolean,},template:'mail.ComposerSuggestionList',});return ComposerSuggestionList;});;

/* /mail/static/src/components/composer_text_input/composer_text_input.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/composer_text_input/composer_text_input.js',function(require){'use strict';const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const components={ComposerSuggestionList:require('mail/static/src/components/composer_suggestion_list/composer_suggestion_list.js'),};const{markEventHandled}=require('mail/static/src/utils/utils.js');const{Component}=owl;const{useRef}=owl.hooks;class ComposerTextInput extends Component{constructor(...args){super(...args);useStore(props=>{const composer=this.env.models['mail.composer'].get(props.composerLocalId);return{composer:composer?composer.__state:undefined,isDeviceMobile:this.env.messaging.device.isMobile,};});this._textareaLastInputValue="";this._textareaRef=useRef('textarea');}
mounted(){this._update();}
patched(){this._update();}
get composer(){return this.env.models['mail.composer'].get(this.props.composerLocalId);}
get textareaPlaceholder(){if(!this.composer){return"";}
if(this.composer.thread&&this.composer.thread.model!=='mail.channel'){if(this.composer.isLog){return this.env._t("Log an internal note...");}
return this.env._t("Send a message to followers...");}
return this.env._t("Write something...");}
focus(){this._textareaRef.el.focus();}
focusout(){this.saveStateInStore();this._textareaRef.el.blur();}
saveStateInStore(){this.composer.update({textInputContent:this._getContent(),textInputCursorStart:this._getSelectionStart(),textInputCursorEnd:this._getSelectionEnd(),});}
_getContent(){return this._textareaRef.el.value;}
_getSelectionEnd(){return this._textareaRef.el.selectionEnd;}
_getSelectionStart(){return this._textareaRef.el.selectionStart;}
_isEmpty(){return this._getContent()==="";}
_update(){this._textareaRef.el.value=this.composer.textInputContent;this._textareaRef.el.setSelectionRange(this.composer.textInputCursorStart,this.composer.textInputCursorEnd);this._updateHeight();}
_updateHeight(){this._textareaRef.el.style.height="0px";this._textareaRef.el.style.height=(this._textareaRef.el.scrollHeight)+"px";}
_onFocusinTextarea(){this.composer.focus();}
_onFocusoutTextarea(){this.saveStateInStore();this.composer.update({hasFocus:false});}
_onInputTextarea(){if(this._textareaLastInputValue!==this._textareaRef.el.value){this.composer.handleCurrentPartnerIsTyping();}
this._textareaLastInputValue=this._textareaRef.el.value;this._updateHeight();this.saveStateInStore();}
_onKeydownTextarea(ev){switch(ev.key){case'Escape':if(this.composer.hasSuggestions){ev.preventDefault();this.composer.closeSuggestions();markEventHandled(ev,'ComposerTextInput.closeSuggestions');}
break;case'ArrowUp':case'PageUp':case'ArrowDown':case'PageDown':case'Home':case'End':case'Tab':if(this.composer.hasSuggestions){ev.preventDefault();}
break;case'Enter':this._onKeydownTextareaEnter(ev);break;}}
_onKeydownTextareaEnter(ev){if(this.composer.hasSuggestions){ev.preventDefault();return;}
if(this.props.sendShortcuts.includes('ctrl-enter')&&!ev.altKey&&ev.ctrlKey&&!ev.metaKey&&!ev.shiftKey){this.trigger('o-composer-text-input-send-shortcut');ev.preventDefault();return;}
if(this.props.sendShortcuts.includes('enter')&&!ev.altKey&&!ev.ctrlKey&&!ev.metaKey&&!ev.shiftKey&&!this.env.messaging.device.isMobile){this.trigger('o-composer-text-input-send-shortcut');ev.preventDefault();return;}
if(this.props.sendShortcuts.includes('meta-enter')&&!ev.altKey&&!ev.ctrlKey&&ev.metaKey&&!ev.shiftKey){this.trigger('o-composer-text-input-send-shortcut');ev.preventDefault();return;}}
_onKeyupTextarea(ev){switch(ev.key){case'Escape':break;case'Enter':if(this.composer.hasSuggestions){this.composer.insertSuggestion();this.composer.closeSuggestions();this.focus();}
break;case'ArrowUp':case'PageUp':if(this.composer.hasSuggestions){this.composer.setPreviousSuggestionActive();this.composer.update({hasToScrollToActiveSuggestion:true});}
break;case'ArrowDown':case'PageDown':if(this.composer.hasSuggestions){this.composer.setNextSuggestionActive();this.composer.update({hasToScrollToActiveSuggestion:true});}
break;case'Home':if(this.composer.hasSuggestions){this.composer.setFirstSuggestionActive();this.composer.update({hasToScrollToActiveSuggestion:true});}
break;case'End':if(this.composer.hasSuggestions){this.composer.setLastSuggestionActive();this.composer.update({hasToScrollToActiveSuggestion:true});}
break;case'Tab':if(this.composer.hasSuggestions){if(ev.shiftKey){this.composer.setPreviousSuggestionActive();this.composer.update({hasToScrollToActiveSuggestion:true});}else{this.composer.setNextSuggestionActive();this.composer.update({hasToScrollToActiveSuggestion:true});}}
break;case'Alt':case'AltGraph':case'CapsLock':case'Control':case'Fn':case'FnLock':case'Hyper':case'Meta':case'NumLock':case'ScrollLock':case'Shift':case'ShiftSuper':case'Symbol':case'SymbolLock':break;default:this.saveStateInStore();this.composer.detectSuggestionDelimiter();}}}
Object.assign(ComposerTextInput,{components,defaultProps:{hasMentionSuggestionsBelowPosition:false,sendShortcuts:[],},props:{composerLocalId:String,hasMentionSuggestionsBelowPosition:Boolean,isCompact:Boolean,sendShortcuts:{type:Array,element:String,validate:prop=>{for(const shortcut of prop){if(!['ctrl-enter','enter','meta-enter'].includes(shortcut)){return false;}}
return true;},},},template:'mail.ComposerTextInput',});return ComposerTextInput;});;

/* /mail/static/src/components/dialog/dialog.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/dialog/dialog.js',function(require){'use strict';const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component}=owl;const{useRef}=owl.hooks;class Dialog extends Component{constructor(...args){super(...args);this._componentRef=useRef('component');this._onClickGlobal=this._onClickGlobal.bind(this);this._onKeydownDocument=this._onKeydownDocument.bind(this);useStore(props=>{const dialog=this.env.models['mail.dialog'].get(props.dialogLocalId);return{dialog:dialog?dialog.__state:undefined,};});}
mounted(){document.addEventListener('click',this._onClickGlobal,true);document.addEventListener('keydown',this._onKeydownDocument);}
willUnmount(){document.removeEventListener('click',this._onClickGlobal,true);document.removeEventListener('keydown',this._onKeydownDocument);}
get dialog(){return this.env.models['mail.dialog'].get(this.props.dialogLocalId);}
_onClick(ev){ev.stopPropagation();}
_onClickGlobal(ev){if(this._componentRef.el&&this._componentRef.el.contains(ev.target)){return;}
if(this._componentRef.comp&&this._componentRef.comp.isCloseable&&!this._componentRef.comp.isCloseable()){return;}
this.dialog.delete();}
_onKeydownDocument(ev){if(ev.key==='Escape'){this.dialog.delete();}}}
Object.assign(Dialog,{props:{dialogLocalId:String,},template:'mail.Dialog',});return Dialog;});;

/* /mail/static/src/components/dialog_manager/dialog_manager.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/dialog_manager/dialog_manager.js',function(require){'use strict';const components={Dialog:require('mail/static/src/components/dialog/dialog.js'),};const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component}=owl;class DialogManager extends Component{constructor(...args){super(...args);useStore(props=>{const dialogManager=this.env.messaging&&this.env.messaging.dialogManager;return{dialogManager:dialogManager?dialogManager.__state:undefined,};});}
mounted(){this._checkDialogOpen();}
patched(){this._checkDialogOpen();}
_checkDialogOpen(){if(!this.env.messaging){return;}
if(this.env.messaging.dialogManager.dialogs.length>0){document.body.classList.add('modal-open');}else{document.body.classList.remove('modal-open');}}}
Object.assign(DialogManager,{components,props:{},template:'mail.DialogManager',});return DialogManager;});;

/* /mail/static/src/components/discuss/discuss.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/discuss/discuss.js',function(require){'use strict';const components={AutocompleteInput:require('mail/static/src/components/autocomplete_input/autocomplete_input.js'),Composer:require('mail/static/src/components/composer/composer.js'),DiscussMobileMailboxSelection:require('mail/static/src/components/discuss_mobile_mailbox_selection/discuss_mobile_mailbox_selection.js'),DiscussSidebar:require('mail/static/src/components/discuss_sidebar/discuss_sidebar.js'),MobileMessagingNavbar:require('mail/static/src/components/mobile_messaging_navbar/mobile_messaging_navbar.js'),ModerationDiscardDialog:require('mail/static/src/components/moderation_discard_dialog/moderation_discard_dialog.js'),ModerationRejectDialog:require('mail/static/src/components/moderation_reject_dialog/moderation_reject_dialog.js'),NotificationList:require('mail/static/src/components/notification_list/notification_list.js'),ThreadView:require('mail/static/src/components/thread_view/thread_view.js'),};const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component}=owl;const{useRef}=owl.hooks;class Discuss extends Component{constructor(...args){super(...args);useStore(props=>{const discuss=this.env.messaging&&this.env.messaging.discuss;const threadView=discuss&&discuss.threadView;return{checkedMessages:threadView?threadView.checkedMessages.map(message=>message.__state):[],discuss:discuss?discuss.__state:undefined,isDeviceMobile:this.env.messaging&&this.env.messaging.device.isMobile,isMessagingInitialized:this.env.isMessagingInitialized(),thread:discuss&&discuss.thread?discuss.thread.__state:undefined,threadCache:(threadView&&threadView.threadCache)?threadView.threadCache.__state:undefined,uncheckedMessages:threadView?threadView.uncheckedMessages.map(message=>message.__state):[],};},{compareDepth:{checkedMessages:1,uncheckedMessages:1,},});this._updateLocalStoreProps();this._composerRef=useRef('composer');this._threadViewRef=useRef('threadView');this._onMobileAddItemHeaderInputSelect=this._onMobileAddItemHeaderInputSelect.bind(this);this._onMobileAddItemHeaderInputSource=this._onMobileAddItemHeaderInputSource.bind(this);}
mounted(){this.discuss.update({isOpen:true});if(this.discuss.thread){this.trigger('o-push-state-action-manager');}else if(this.env.messaging.isInitialized){this.discuss.openInitThread();}
this._updateLocalStoreProps();this._update();}
patched(){this.trigger('o-update-control-panel');if(this.discuss.thread){this.trigger('o-push-state-action-manager');}
if(this.discuss.thread&&this.discuss.thread===this.env.messaging.inbox&&this.discuss.threadView&&this._lastThreadCache===this.discuss.threadView.threadCache.localId&&this._lastThreadCounter>0&&this.discuss.thread.counter===0){this.trigger('o-show-rainbow-man');}
this._activeThreadCache=this.discuss.threadView&&this.discuss.threadView.threadCache;this._updateLocalStoreProps();this._update();}
willUnmount(){if(this.discuss){this.discuss.close();}}
get addChannelInputPlaceholder(){return this.env._t("Create or search channel...");}
get addChatInputPlaceholder(){return this.env._t("Search user...");}
get discuss(){return this.env.messaging&&this.env.messaging.discuss;}
mobileNavbarTabs(){return[{icon:'fa fa-inbox',id:'mailbox',label:this.env._t("Mailboxes"),},{icon:'fa fa-user',id:'chat',label:this.env._t("Chat"),},{icon:'fa fa-users',id:'channel',label:this.env._t("Channel"),}];}
_update(){if(this.discuss.isDoFocus){this.discuss.update({isDoFocus:false});const composer=this._composerRef.comp;if(composer){composer.focus();}else{const threadView=this._threadViewRef.comp;if(threadView){threadView.focus();}}}}
_updateLocalStoreProps(){this._lastThreadCache=(this.discuss.threadView&&this.discuss.threadView.threadCache&&this.discuss.threadView.threadCache.localId);this._lastThreadCounter=(this.discuss.thread&&this.discuss.thread.counter);}
_onDialogClosedModerationDiscard(){this.discuss.update({hasModerationDiscardDialog:false});}
_onDialogClosedModerationReject(){this.discuss.update({hasModerationRejectDialog:false});}
_onHideMobileAddItemHeader(ev){ev.stopPropagation();this.discuss.clearIsAddingItem();}
_onMobileAddItemHeaderInputSelect(ev,ui){const discuss=this.discuss;if(discuss.isAddingChannel){discuss.handleAddChannelAutocompleteSelect(ev,ui);}else{discuss.handleAddChatAutocompleteSelect(ev,ui);}}
_onMobileAddItemHeaderInputSource(req,res){if(this.discuss.isAddingChannel){this.discuss.handleAddChannelAutocompleteSource(req,res);}else{this.discuss.handleAddChatAutocompleteSource(req,res);}}
_onReplyingToMessageMessagePosted(){this.env.services['notification'].notify({message:_.str.sprintf(this.env._t(`Message posted on "%s"`),owl.utils.escape(this.discuss.replyingToMessage.originThread.displayName)),type:'warning',});this.discuss.clearReplyingToMessage();}
_onSelectMobileNavbarTab(ev){ev.stopPropagation();if(this.discuss.activeMobileNavbarTabId===ev.detail.tabId){return;}
this.discuss.clearReplyingToMessage();this.discuss.update({activeMobileNavbarTabId:ev.detail.tabId});}
_onThreadRendered(ev){this.trigger('o-update-control-panel');}}
Object.assign(Discuss,{components,props:{},template:'mail.Discuss',});return Discuss;});;

/* /mail/static/src/components/discuss_mobile_mailbox_selection/discuss_mobile_mailbox_selection.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/discuss_mobile_mailbox_selection/discuss_mobile_mailbox_selection.js',function(require){'use strict';const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component}=owl;class DiscussMobileMailboxSelection extends Component{constructor(...args){super(...args);useStore(props=>{return{allOrderedAndPinnedMailboxes:this.orderedMailboxes.map(mailbox=>mailbox.__state),discussThread:this.env.messaging.discuss.thread?this.env.messaging.discuss.thread.__state:undefined,};},{compareDepth:{allOrderedAndPinnedMailboxes:1,},});}
get orderedMailboxes(){return this.env.models['mail.thread'].all(thread=>thread.isPinned&&thread.model==='mail.box').sort((mailbox1,mailbox2)=>{if(mailbox1===this.env.messaging.inbox){return-1;}
if(mailbox2===this.env.messaging.inbox){return 1;}
if(mailbox1===this.env.messaging.starred){return-1;}
if(mailbox2===this.env.messaging.starred){return 1;}
const mailbox1Name=mailbox1.displayName;const mailbox2Name=mailbox2.displayName;mailbox1Name<mailbox2Name?-1:1;});}
get discuss(){return this.env.messaging&&this.env.messaging.discuss;}
_onClick(ev){const{mailboxLocalId}=ev.currentTarget.dataset;const mailbox=this.env.models['mail.thread'].get(mailboxLocalId);if(!mailbox){return;}
mailbox.open();}}
Object.assign(DiscussMobileMailboxSelection,{props:{},template:'mail.DiscussMobileMailboxSelection',});return DiscussMobileMailboxSelection;});;

/* /mail/static/src/components/discuss_sidebar/discuss_sidebar.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/discuss_sidebar/discuss_sidebar.js',function(require){'use strict';const components={AutocompleteInput:require('mail/static/src/components/autocomplete_input/autocomplete_input.js'),DiscussSidebarItem:require('mail/static/src/components/discuss_sidebar_item/discuss_sidebar_item.js'),};const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component}=owl;const{useRef}=owl.hooks;class DiscussSidebar extends Component{constructor(...args){super(...args);useStore((...args)=>this._useStoreSelector(...args),{compareDepth:()=>this._useStoreCompareDepth()});this._quickSearchInputRef=useRef('quickSearchInput');this._onAddChannelAutocompleteSelect=this._onAddChannelAutocompleteSelect.bind(this);this._onAddChannelAutocompleteSource=this._onAddChannelAutocompleteSource.bind(this);this._onAddChatAutocompleteSelect=this._onAddChatAutocompleteSelect.bind(this);this._onAddChatAutocompleteSource=this._onAddChatAutocompleteSource.bind(this);}
mounted(){this._update();}
patched(){this._update();}
get discuss(){return this.env.messaging&&this.env.messaging.discuss;}
get FIND_OR_CREATE_CHANNEL(){return this.env._t("Find or create a channel...");}
get orderedMailboxes(){return this.env.models['mail.thread'].all(thread=>thread.isPinned&&thread.model==='mail.box').sort((mailbox1,mailbox2)=>{if(mailbox1===this.env.messaging.inbox){return-1;}
if(mailbox2===this.env.messaging.inbox){return 1;}
if(mailbox1===this.env.messaging.starred){return-1;}
if(mailbox2===this.env.messaging.starred){return 1;}
const mailbox1Name=mailbox1.displayName;const mailbox2Name=mailbox2.displayName;mailbox1Name<mailbox2Name?-1:1;});}
get quickSearchPinnedAndOrderedChats(){const allOrderedAndPinnedChats=this.env.models['mail.thread'].all(thread=>thread.channel_type==='chat'&&thread.isPinned&&thread.model==='mail.channel').sort((c1,c2)=>c1.displayName<c2.displayName?-1:1);if(!this.discuss.sidebarQuickSearchValue){return allOrderedAndPinnedChats;}
const qsVal=this.discuss.sidebarQuickSearchValue.toLowerCase();return allOrderedAndPinnedChats.filter(chat=>{const nameVal=chat.displayName.toLowerCase();return nameVal.includes(qsVal);});}
get quickSearchOrderedAndPinnedMultiUserChannels(){const allOrderedAndPinnedMultiUserChannels=this.env.models['mail.thread'].all(thread=>thread.channel_type==='channel'&&thread.isPinned&&thread.model==='mail.channel').sort((c1,c2)=>c1.displayName<c2.displayName?-1:1);if(!this.discuss.sidebarQuickSearchValue){return allOrderedAndPinnedMultiUserChannels;}
const qsVal=this.discuss.sidebarQuickSearchValue.toLowerCase();return allOrderedAndPinnedMultiUserChannels.filter(channel=>{const nameVal=channel.displayName.toLowerCase();return nameVal.includes(qsVal);});}
_update(){if(this._quickSearchInputRef.el){this._quickSearchInputRef.el.value=this.discuss.sidebarQuickSearchValue;}}
_useStoreCompareDepth(){return{allOrderedAndPinnedChats:1,allOrderedAndPinnedMailboxes:1,allOrderedAndPinnedMultiUserChannels:1,allPinnedChannelAmount:1,};}
_useStoreSelector(props){return{allOrderedAndPinnedChats:this.env.models['mail.thread'].all(thread=>thread.channel_type==='chat'&&thread.isPinned&&thread.model==='mail.channel').sort((c1,c2)=>c1.displayName<c2.displayName?-1:1).map(chat=>chat.__state),allOrderedAndPinnedMailboxes:this.orderedMailboxes.map(mailbox=>mailbox.__state),allOrderedAndPinnedMultiUserChannels:this.env.models['mail.thread'].all(thread=>thread.channel_type==='channel'&&thread.isPinned&&thread.model==='mail.channel').sort((c1,c2)=>c1.displayName<c2.displayName?-1:1).map(channel=>channel.__state),allPinnedChannelAmount:this.env.models['mail.thread'].all(thread=>thread.isPinned&&thread.model==='mail.channel').length,discuss:this.env.messaging.discuss.__state,};}
_onAddChannelAutocompleteSelect(ev,ui){this.discuss.handleAddChannelAutocompleteSelect(ev,ui);}
_onAddChannelAutocompleteSource(req,res){this.discuss.handleAddChannelAutocompleteSource(req,res);}
_onAddChatAutocompleteSelect(ev,ui){this.discuss.handleAddChatAutocompleteSelect(ev,ui);}
_onAddChatAutocompleteSource(req,res){this.discuss.handleAddChatAutocompleteSource(req,res);}
_onClickChannelAdd(ev){ev.stopPropagation();this.discuss.update({isAddingChannel:true});}
_onClickChannelTitle(ev){ev.stopPropagation();return this.env.bus.trigger('do-action',{action:{name:this.env._t("Public Channels"),type:'ir.actions.act_window',res_model:'mail.channel',views:[[false,'kanban'],[false,'form']],domain:[['public','!=','private']]},});}
_onClickChatAdd(ev){ev.stopPropagation();this.discuss.update({isAddingChat:true});}
_onHideAddingItem(ev){ev.stopPropagation();this.discuss.clearIsAddingItem();}
_onInputQuickSearch(ev){ev.stopPropagation();this.discuss.update({sidebarQuickSearchValue:this._quickSearchInputRef.el.value,});}}
Object.assign(DiscussSidebar,{components,props:{},template:'mail.DiscussSidebar',});return DiscussSidebar;});;

/* /mail/static/src/components/discuss_sidebar_item/discuss_sidebar_item.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/discuss_sidebar_item/discuss_sidebar_item.js',function(require){'use strict';const components={EditableText:require('mail/static/src/components/editable_text/editable_text.js'),ThreadIcon:require('mail/static/src/components/thread_icon/thread_icon.js'),};const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const Dialog=require('web.Dialog');const{Component}=owl;class DiscussSidebarItem extends Component{constructor(...args){super(...args);useStore(props=>{const thread=this.env.models['mail.thread'].get(props.threadLocalId);const correspondent=thread?thread.correspondent:undefined;return{correspondent:correspondent?correspondent.__state:undefined,discuss:this.env.messaging.discuss.__state,thread:thread?thread.__state:undefined,};});}
get counter(){if(this.thread.model==='mail.box'){return this.thread.counter;}else if(this.thread.channel_type==='channel'){return this.thread.message_needaction_counter;}else if(this.thread.channel_type==='chat'){return this.thread.localMessageUnreadCounter;}
return 0;}
get discuss(){return this.env.messaging&&this.env.messaging.discuss;}
hasUnpin(){return this.thread.channel_type==='chat';}
get thread(){return this.env.models['mail.thread'].get(this.props.threadLocalId);}
_askAdminConfirmation(){return new Promise(resolve=>{Dialog.confirm(this,this.env._t("You are the administrator of this channel. Are you sure you want to leave?"),{buttons:[{text:this.env._t("Leave"),classes:'btn-primary',close:true,click:resolve},{text:this.env._t("Discard"),close:true}]});});}
_onCancelRenaming(ev){this.discuss.cancelThreadRenaming(this.thread);}
_onClick(ev){this.thread.open();}
_onClickedEditableText(ev){ev.stopPropagation();}
async _onClickLeave(ev){ev.stopPropagation();if(this.thread.creator===this.env.messaging.currentUser){await this._askAdminConfirmation();}
this.thread.unsubscribe();}
_onClickRename(ev){ev.stopPropagation();this.discuss.setThreadRenaming(this.thread);}
_onClickSettings(ev){ev.stopPropagation();return this.env.bus.trigger('do-action',{action:{type:'ir.actions.act_window',res_model:this.thread.model,res_id:this.thread.id,views:[[false,'form']],target:'current'},});}
_onClickUnpin(ev){ev.stopPropagation();this.thread.unsubscribe();}
_onValidateEditableText(ev){ev.stopPropagation();this.discuss.renameThread(this.thread,ev.detail.newName);}}
Object.assign(DiscussSidebarItem,{components,props:{threadLocalId:String,},template:'mail.DiscussSidebarItem',});return DiscussSidebarItem;});;

/* /mail/static/src/components/drop_zone/drop_zone.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/drop_zone/drop_zone.js',function(require){'use strict';const{Component,useState}=owl;class DropZone extends Component{constructor(...args){super(...args);this.state=useState({isDraggingInside:false,});this._dragCount=0;}
contains(node){return this.el.contains(node);}
_isDragSourceExternalFile(dataTransfer){const dragDataType=dataTransfer.types;if(dragDataType.constructor===window.DOMStringList){return dragDataType.contains('Files');}
if(dragDataType.constructor===Array){return dragDataType.includes('Files');}
return false;}
_onDragenter(ev){ev.preventDefault();if(this._dragCount===0){this.state.isDraggingInside=true;}
this._dragCount++;}
_onDragleave(ev){this._dragCount--;if(this._dragCount===0){this.state.isDraggingInside=false;}}
_onDragover(ev){ev.preventDefault();ev.dataTransfer.dropEffect='copy';}
_onDrop(ev){ev.preventDefault();if(this._isDragSourceExternalFile(ev.dataTransfer)){this.trigger('o-dropzone-files-dropped',{files:ev.dataTransfer.files,});}
this.state.isDraggingInside=false;}}
Object.assign(DropZone,{props:{},template:'mail.DropZone',});return DropZone;});;

/* /mail/static/src/components/editable_text/editable_text.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/editable_text/editable_text.js',function(require){'use strict';const{Component}=owl;class EditableText extends Component{mounted(){this.el.focus();this.el.setSelectionRange(0,(this.el.value&&this.el.value.length)||0);}
willUnmount(){this.trigger('o-cancel');}
_onBlur(ev){this.trigger('o-cancel');}
_onClick(ev){this.trigger('o-clicked');}
_onKeydown(ev){switch(ev.key){case'Enter':this._onKeydownEnter(ev);break;case'Escape':this.trigger('o-cancel');break;}}
_onKeydownEnter(ev){const value=this.el.value;const newName=value||this.props.placeholder;if(this.props.value!==newName){this.trigger('o-validate',{newName});}else{this.trigger('o-cancel');}}}
Object.assign(EditableText,{defaultProps:{placeholder:"",value:"",},props:{placeholder:String,value:String,},template:'mail.EditableText',});return EditableText;});;

/* /mail/static/src/components/emojis_popover/emojis_popover.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/emojis_popover/emojis_popover.js',function(require){'use strict';const emojis=require('mail.emojis');const{Component}=owl;class EmojisPopover extends Component{constructor(...args){super(...args);this.emojis=emojis;}
mounted(){this._update();}
patched(){this._update();}
_update(){this.trigger('o-popover-compute');}
close(){this.trigger('o-popover-close');}
contains(node){if(!this.el){return false;}
return this.el.contains(node);}
_onClickEmoji(ev){this.close();this.trigger('o-emoji-selection',{unicode:ev.currentTarget.dataset.unicode,});}}
Object.assign(EmojisPopover,{props:{},template:'mail.EmojisPopover',});return EmojisPopover;});;

/* /mail/static/src/components/file_uploader/file_uploader.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/file_uploader/file_uploader.js',function(require){'use strict';const core=require('web.core');const{Component}=owl;const{useRef}=owl.hooks;class FileUploader extends Component{constructor(...args){super(...args);this._fileInputRef=useRef('fileInput');this._fileUploadId=_.uniqueId('o_FileUploader_fileupload');this._onAttachmentUploaded=this._onAttachmentUploaded.bind(this);}
mounted(){$(window).on(this._fileUploadId,this._onAttachmentUploaded);}
willUnmount(){$(window).off(this._fileUploadId);}
async uploadFiles(files){await this._unlinkExistingAttachments(files);this._createTemporaryAttachments(files);await this._performUpload(files);this._fileInputRef.el.value='';}
openBrowserFileUploader(){this._fileInputRef.el.click();}
_createAttachment(fileData){return this.env.models['mail.attachment'].create(Object.assign({},fileData,this.props.newAttachmentExtraData));}
_createFormData(file){let formData=new window.FormData();formData.append('callback',this._fileUploadId);formData.append('csrf_token',core.csrf_token);formData.append('id',this.props.uploadId);formData.append('model',this.props.uploadModel);formData.append('ufile',file,file.name);return formData;}
_createTemporaryAttachments(files){for(const file of files){this._createAttachment({filename:file.name,isTemporary:true,name:file.name});}}
async _performUpload(files){for(const file of files){const uploadingAttachment=this.env.models['mail.attachment'].find(attachment=>attachment.isTemporary&&attachment.filename===file.name);try{const response=await this.env.browser.fetch('/web/binary/upload_attachment',{method:'POST',body:this._createFormData(file),signal:uploadingAttachment.uploadingAbortController.signal,});let html=await response.text();const template=document.createElement('template');template.innerHTML=html.trim();window.eval(template.content.firstChild.textContent);}catch(e){if(e.name!=='AbortError'){throw e;}}}}
async _unlinkExistingAttachments(files){for(const file of files){const attachment=this.props.attachmentLocalIds.map(attachmentLocalId=>this.env.models['mail.attachment'].get(attachmentLocalId)).find(attachment=>attachment.name===file.name&&attachment.size===file.size);if(attachment){attachment.remove();}}}
async _onAttachmentUploaded(ev,...filesData){for(const fileData of filesData){const{error,filename,id,mimetype,name,size}=fileData;if(error||!id){this.env.services['notification'].notify({type:'danger',message:owl.utils.escape(error),});const relatedTemporaryAttachments=this.env.models['mail.attachment'].find(attachment=>attachment.filename===filename&&attachment.isTemporary);for(const attachment of relatedTemporaryAttachments){attachment.delete();}
return;}
await new Promise(resolve=>setTimeout(resolve));const attachment=this._createAttachment({filename,id,mimetype,name,size,});this.trigger('o-attachment-created',{attachment});}}
async _onChangeAttachment(ev){await this.uploadFiles(ev.target.files);}}
Object.assign(FileUploader,{defaultProps:{uploadId:0,uploadModel:'mail.compose.message'},props:{attachmentLocalIds:{type:Array,element:String,},newAttachmentExtraData:{type:Object,optional:true,},uploadId:Number,uploadModel:String,},template:'mail.FileUploader',});return FileUploader;});;

/* /mail/static/src/components/follow_button/follow_button.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/follow_button/follow_button.js',function(require){'use strict';const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component}=owl;const{useState}=owl.hooks;class FollowButton extends Component{constructor(...args){super(...args);this.state=useState({isUnfollowButtonHighlighted:false,});useStore(props=>{const thread=this.env.models['mail.thread'].get(props.threadLocalId);return{thread:thread?thread.__state:undefined,};});}
get thread(){return this.env.models['mail.thread'].get(this.props.threadLocalId);}
_onClickFollow(ev){this.thread.follow();}
_onClickUnfollow(ev){this.thread.unfollow();}
_onMouseLeaveUnfollow(ev){this.state.isUnfollowButtonHighlighted=false;}
_onMouseEnterUnfollow(ev){this.state.isUnfollowButtonHighlighted=true;}}
Object.assign(FollowButton,{defaultProps:{isDisabled:false,},props:{isDisabled:Boolean,threadLocalId:String,},template:'mail.FollowButton',});return FollowButton;});;

/* /mail/static/src/components/follower/follower.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/follower/follower.js',function(require){'use strict';const components={FollowerSubtypeList:require('mail/static/src/components/follower_subtype_list/follower_subtype_list.js'),};const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component}=owl;class Follower extends Component{constructor(...args){super(...args);useStore(props=>{const follower=this.env.models['mail.follower'].get(props.followerLocalId);return[follower?follower.__state:undefined];});}
get follower(){return this.env.models['mail.follower'].get(this.props.followerLocalId);}
_onClickDetails(ev){ev.preventDefault();ev.stopPropagation();this.follower.openProfile();}
_onClickEdit(ev){ev.preventDefault();this.follower.showSubtypes();}
_onClickRemove(ev){this.follower.remove();}}
Object.assign(Follower,{components,props:{followerLocalId:String,},template:'mail.Follower',});return Follower;});;

/* /mail/static/src/components/follower_list_menu/follower_list_menu.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/follower_list_menu/follower_list_menu.js',function(require){'use strict';const components={Follower:require('mail/static/src/components/follower/follower.js'),};const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component}=owl;const{useRef,useState}=owl.hooks;class FollowerListMenu extends Component{constructor(...args){super(...args);this.state=useState({isDropdownOpen:false,});useStore(props=>{const thread=this.env.models['mail.thread'].get(props.threadLocalId);const followers=thread?thread.followers:[];return{followers:followers.map(follower=>follower.__state),thread:thread?thread.__state:undefined,};},{compareDepth:{followers:1,},});this._dropdownRef=useRef('dropdown');this._onClickCaptureGlobal=this._onClickCaptureGlobal.bind(this);}
mounted(){document.addEventListener('click',this._onClickCaptureGlobal,true);}
willUnmount(){document.removeEventListener('click',this._onClickCaptureGlobal,true);}
get thread(){return this.env.models['mail.thread'].get(this.props.threadLocalId);}
_hide(){this.state.isDropdownOpen=false;}
_onKeydown(ev){ev.stopPropagation();switch(ev.key){case'Escape':ev.preventDefault();this._hide();break;}}
_onClickAddChannels(ev){ev.preventDefault();this._hide();this.thread.promptAddChannelFollower();}
_onClickAddFollowers(ev){ev.preventDefault();this._hide();this.thread.promptAddPartnerFollower();}
_onClickCaptureGlobal(ev){if(this._dropdownRef.el&&!this._dropdownRef.el.contains(ev.target)){this._hide();}}
_onClickFollowersButton(ev){this.state.isDropdownOpen=!this.state.isDropdownOpen;}
_onClickFollower(ev){this._hide();}}
Object.assign(FollowerListMenu,{components,defaultProps:{isDisabled:false,},props:{isDisabled:Boolean,threadLocalId:String,},template:'mail.FollowerListMenu',});return FollowerListMenu;});;

/* /mail/static/src/components/follower_subtype/follower_subtype.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/follower_subtype/follower_subtype.js',function(require){'use strict';const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component}=owl;class FollowerSubtype extends Component{constructor(...args){super(...args);useStore(props=>{const followerSubtype=this.env.models['mail.follower_subtype'].get(props.followerSubtypeLocalId);return[followerSubtype?followerSubtype.__state:undefined];});}
get follower(){return this.env.models['mail.follower'].get(this.props.followerLocalId);}
get followerSubtype(){return this.env.models['mail.follower_subtype'].get(this.props.followerSubtypeLocalId);}
_onChangeCheckbox(ev){if(ev.target.checked){this.follower.selectSubtype(this.followerSubtype);}else{this.follower.unselectSubtype(this.followerSubtype);}}}
Object.assign(FollowerSubtype,{props:{followerLocalId:String,followerSubtypeLocalId:String,},template:'mail.FollowerSubtype',});return FollowerSubtype;});;

/* /mail/static/src/components/follower_subtype_list/follower_subtype_list.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/follower_subtype_list/follower_subtype_list.js',function(require){'use strict';const components={FollowerSubtype:require('mail/static/src/components/follower_subtype/follower_subtype.js'),};const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component,QWeb}=owl;class FollowerSubtypeList extends Component{constructor(...args){super(...args);useStore(props=>{const followerSubtypeList=this.env.models['mail.follower_subtype_list'].get(props.localId);const follower=followerSubtypeList?followerSubtypeList.follower:undefined;const followerSubtypes=follower?follower.subtypes:[];return{follower:follower?follower.__state:undefined,followerSubtypeList:followerSubtypeList?followerSubtypeList.__state:undefined,followerSubtypes:followerSubtypes.map(subtype=>subtype.__state),};},{compareDepth:{followerSubtypes:1,},});}
get followerSubtypeList(){return this.env.models['mail.follower_subtype_list'].get(this.props.localId);}
_onClickCancel(ev){this.followerSubtypeList.follower.closeSubtypes();}
_onClickApply(ev){this.followerSubtypeList.follower.updateSubtypes();}}
Object.assign(FollowerSubtypeList,{components,props:{localId:String,},template:'mail.FollowerSubtypeList',});QWeb.registerComponent('FollowerSubtypeList',FollowerSubtypeList);return FollowerSubtypeList;});;

/* /mail/static/src/components/mail_template/mail_template.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/mail_template/mail_template.js',function(require){'use strict';const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component}=owl;class MailTemplate extends Component{constructor(...args){super(...args);useStore(props=>{const activity=this.env.models['mail.activity'].get(props.activityLocalId);const mailTemplate=this.env.models['mail.mail_template'].get(props.mailTemplateLocalId);return{activity:activity?activity.__state:undefined,mailTemplate:mailTemplate?mailTemplate.__state:undefined,};});}
get activity(){return this.env.models['mail.activity'].get(this.props.activityLocalId);}
get mailTemplate(){return this.env.models['mail.mail_template'].get(this.props.mailTemplateLocalId);}
_onClickPreview(ev){ev.stopPropagation();ev.preventDefault();this.mailTemplate.preview(this.activity);}
_onClickSend(ev){ev.stopPropagation();ev.preventDefault();this.mailTemplate.send(this.activity);}}
Object.assign(MailTemplate,{props:{activityLocalId:String,mailTemplateLocalId:String,},template:'mail.MailTemplate',});return MailTemplate;});;

/* /mail/static/src/components/message/message.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/message/message.js',function(require){'use strict';const components={AttachmentList:require('mail/static/src/components/attachment_list/attachment_list.js'),MessageSeenIndicator:require('mail/static/src/components/message_seen_indicator/message_seen_indicator.js'),ModerationBanDialog:require('mail/static/src/components/moderation_ban_dialog/moderation_ban_dialog.js'),ModerationDiscardDialog:require('mail/static/src/components/moderation_discard_dialog/moderation_discard_dialog.js'),ModerationRejectDialog:require('mail/static/src/components/moderation_reject_dialog/moderation_reject_dialog.js'),NotificationPopover:require('mail/static/src/components/notification_popover/notification_popover.js'),PartnerImStatusIcon:require('mail/static/src/components/partner_im_status_icon/partner_im_status_icon.js'),};const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{timeFromNow}=require('mail.utils');const{_lt}=require('web.core');const{getLangDatetimeFormat}=require('web.time');const{Component,useState}=owl;const{useRef}=owl.hooks;const READ_MORE=_lt("read more");const READ_LESS=_lt("read less");class Message extends Component{constructor(...args){super(...args);this.state=useState({hasModerationBanDialog:false,hasModerationDiscardDialog:false,hasModerationRejectDialog:false,isClicked:false,timeElapsed:null,});useStore(props=>{const message=this.env.models['mail.message'].get(props.messageLocalId);const author=message?message.author:undefined;const partnerRoot=this.env.messaging.partnerRoot;const originThread=message?message.originThread:undefined;const threadView=this.env.models['mail.thread_view'].get(props.threadViewLocalId);const thread=threadView?threadView.thread:undefined;const threadStringifiedDomain=threadView?threadView.stringifiedDomain:undefined;return{attachments:message?message.attachments.map(attachment=>attachment.__state):undefined,author:author?author.__state:undefined,hasMessageCheckbox:message?message.hasCheckbox:false,isDeviceMobile:this.env.messaging.device.isMobile,isMessageChecked:message&&threadView?message.isChecked(thread,threadStringifiedDomain):false,message:message?message.__state:undefined,notifications:message?message.notifications.map(notif=>notif.__state):[],originThread:originThread?originThread.__state:undefined,partnerRoot:partnerRoot?partnerRoot.__state:undefined,thread:thread?thread.__state:undefined,threadView:threadView?threadView.__state:undefined,};},{compareDepth:{notifications:1,},});this._wasSelected;this._contentRef=useRef('content');this._checkboxRef=useRef('checkbox');this._intervalId=undefined;this._constructor();}
_constructor(){}
mounted(){this._update();}
patched(){this._update();}
willUnmount(){clearInterval(this._intervalId);}
get avatar(){if(this.message.author&&this.message.author===this.env.messaging.partnerRoot){return'/mail/static/src/img/odoobot.png';}else if(this.message.author){return this.message.author.avatarUrl;}else if(this.message.message_type==='email'){return'/mail/static/src/img/email_icon.png';}
return'/mail/static/src/img/smiley/avatar.jpg';}
get datetime(){return this.message.date.format(getLangDatetimeFormat());}
get hasAuthorOpenChat(){if(!this.message.author){return false;}
if(this.threadView&&this.threadView.thread&&this.threadView.thread.correspondent===this.message.author){return false;}
return true;}
get imageAttachments(){return this.message.attachments.filter(attachment=>attachment.fileType==='image');}
isBottomVisible({offset=0}={}){if(!this.el){return false;}
const elRect=this.el.getBoundingClientRect();if(!this.el.parentNode){return false;}
const parentRect=this.el.parentNode.getBoundingClientRect();return(elRect.bottom<parentRect.bottom+offset&&parentRect.top<elRect.bottom+offset);}
isPartiallyVisible(){const elRect=this.el.getBoundingClientRect();if(!this.el.parentNode){return false;}
const parentRect=this.el.parentNode.getBoundingClientRect();return(elRect.top<parentRect.bottom+5&&parentRect.top<elRect.bottom+5);}
get message(){return this.env.models['mail.message'].get(this.props.messageLocalId);}
get nonImageAttachments(){return this.message.attachments.filter(attachment=>attachment.fileType!=='image');}
get OPEN_CHAT(){return this.env._t("Open chat");}
async scrollIntoView({behavior='auto',block='end'}={}){this.el.scrollIntoView({behavior,block,inline:'nearest',});if(behavior==='smooth'){return new Promise(resolve=>setTimeout(resolve,500));}else{return Promise.resolve();}}
get shortTime(){return this.message.date.format('hh:mm');}
get threadView(){return this.env.models['mail.thread_view'].get(this.props.threadViewLocalId);}
get trackingValues(){return this.message.tracking_value_ids.map(trackingValue=>{const value=Object.assign({},trackingValue);value.changed_field=_.str.sprintf(this.env._t("%s:"),value.changed_field);if(value.field_type==='datetime'){if(value.old_value){value.old_value=moment.utc(value.old_value).local().format('LLL');}
if(value.new_value){value.new_value=moment.utc(value.new_value).local().format('LLL');}}else if(value.field_type==='date'){if(value.old_value){value.old_value=moment(value.old_value).local().format('LL');}
if(value.new_value){value.new_value=moment(value.new_value).local().format('LL');}}
return value;});}
_insertReadMoreLess($element){const groups=[];let readMoreNodes;const $children=$element.contents().filter((index,content)=>content.nodeType===1||(content.nodeType===3&&content.nodeValue.trim()));for(const child of $children){let $child=$(child);if(child.nodeType===3&&$child.prevAll('[id*="stopSpelling"]').length>0){$child=$('<span>',{text:child.textContent,'data-o-mail-quote':'1',});child.parentNode.replaceChild($child[0],child);}
if($child.attr('data-o-mail-quote')||($child.get(0).nodeName==='BR'&&$child.prev('[data-o-mail-quote="1"]').length>0)){if(!readMoreNodes){readMoreNodes=[];groups.push(readMoreNodes);}
$child.hide();readMoreNodes.push($child);}else{readMoreNodes=undefined;this._insertReadMoreLess($child);}}
for(const group of groups){const $readMoreLess=$('<a>',{class:'o_Message_readMoreLess',href:'#',text:READ_MORE,}).insertBefore(group[0]);let isReadMore=true;$readMoreLess.click(e=>{e.preventDefault();isReadMore=!isReadMore;for(const $child of group){$child.hide();$child.toggle(!isReadMore);}
$readMoreLess.text(isReadMore?READ_MORE:READ_LESS);});}}
_update(){if(this._contentRef.el){for(const el of[...this._contentRef.el.querySelectorAll(':scope .o_Message_readMoreLess')]){el.remove();}
this._insertReadMoreLess($(this._contentRef.el));}
this._wasSelected=this.props.isSelected;if(!this.state.timeElapsed){this.state.timeElapsed=timeFromNow(this.message.date);}
clearInterval(this._intervalId);this._intervalId=setInterval(()=>{this.state.timeElapsed=timeFromNow(this.message.date);},60*1000);}
_onChangeCheckbox(){this.message.toggleCheck(this.threadView.thread,this.threadView.stringifiedDomain);}
_onClick(ev){if(ev.target.closest('.o_channel_redirect')){this.env.messaging.openProfile({id:Number(ev.target.dataset.oeId),model:'mail.channel',});ev.preventDefault();return;}
if(ev.target.tagName==='A'){if(ev.target.dataset.oeId&&ev.target.dataset.oeModel){this.env.messaging.openProfile({id:Number(ev.target.dataset.oeId),model:ev.target.dataset.oeModel,});ev.preventDefault();}
return;}
this.state.isClicked=!this.state.isClicked;}
_onClickAuthorAvatar(ev){if(!this.hasAuthorOpenChat){return;}
this.message.author.openChat();}
_onClickAuthorName(ev){if(!this.message.author){return;}
this.message.author.openProfile();}
_onClickFailure(ev){this.message.openResendAction();}
_onClickModerationAccept(ev){ev.preventDefault();this.message.moderate('accept');}
_onClickModerationAllow(ev){ev.preventDefault();this.message.moderate('allow');}
_onClickModerationBan(ev){ev.preventDefault();this.state.hasModerationBanDialog=true;}
_onClickModerationDiscard(ev){ev.preventDefault();this.state.hasModerationDiscardDialog=true;}
_onClickModerationReject(ev){ev.preventDefault();this.state.hasModerationRejectDialog=true;}
_onClickOriginThread(ev){ev.preventDefault();this.message.originThread.open();}
_onClickStar(ev){ev.stopPropagation();this.message.toggleStar();}
_onClickMarkAsRead(ev){ev.stopPropagation();this.message.markAsRead();}
_onClickReply(ev){if(this._wasSelected){this.env.messaging.discuss.clearReplyingToMessage();}else{this.message.replyTo();}}
_onDialogClosedModerationBan(){this.state.hasModerationBanDialog=false;}
_onDialogClosedModerationDiscard(){this.state.hasModerationDiscardDialog=false;}
_onDialogClosedModerationReject(){this.state.hasModerationRejectDialog=false;}}
Object.assign(Message,{components,defaultProps:{hasCheckbox:false,hasMarkAsReadIcon:false,hasReplyIcon:false,isSelected:false,isSquashed:false,},props:{attachmentsDetailsMode:{type:String,optional:true,validate:prop=>['auto','card','hover','none'].includes(prop),},hasCheckbox:Boolean,hasMarkAsReadIcon:Boolean,hasReplyIcon:Boolean,isSelected:Boolean,isSquashed:Boolean,messageLocalId:String,threadViewLocalId:{type:String,optional:true,},},template:'mail.Message',});return Message;});;

/* /mail/static/src/components/message_author_prefix/message_author_prefix.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/message_author_prefix/message_author_prefix.js',function(require){'use strict';const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component}=owl;class MessageAuthorPrefix extends Component{constructor(...args){super(...args);useStore(props=>{const message=this.env.models['mail.message'].get(props.messageLocalId);const author=message?message.author:undefined;const thread=props.threadLocalId?this.env.models['mail.thread'].get(props.threadLocalId):undefined;return{author:author?author.__state:undefined,currentPartner:this.env.messaging.currentPartner?this.env.messaging.currentPartner.__state:undefined,message:message?message.__state:undefined,thread:thread?thread.__state:undefined,};});}
get message(){return this.env.models['mail.message'].get(this.props.messageLocalId);}
get thread(){return this.env.models['mail.thread'].get(this.props.threadLocalId);}}
Object.assign(MessageAuthorPrefix,{props:{messageLocalId:String,threadLocalId:{type:String,optional:true,},},template:'mail.MessageAuthorPrefix',});return MessageAuthorPrefix;});;

/* /mail/static/src/components/message_list/message_list.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/message_list/message_list.js',function(require){'use strict';const components={Message:require('mail/static/src/components/message/message.js'),};const useRefs=require('mail/static/src/component_hooks/use_refs/use_refs.js');const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component}=owl;const{useRef}=owl.hooks;class MessageList extends Component{constructor(...args){super(...args);useStore(props=>{const threadView=this.env.models['mail.thread_view'].get(props.threadViewLocalId);const thread=threadView?threadView.thread:undefined;const threadCache=threadView?threadView.threadCache:undefined;return{isDeviceMobile:this.env.messaging.device.isMobile,messages:threadCache?threadCache.orderedMessages.map(message=>message.__state):[],thread:thread?thread.__state:undefined,threadCache:threadCache?threadCache.__state:undefined,threadView:threadView?threadView.__state:undefined,};},{compareDepth:{messages:1,},});this._getRefs=useRefs();this._isAutoLoadOnScrollActive=true;this._loadMoreRef=useRef('loadMore');this._willPatchSnapshot=undefined;this.onScroll=_.throttle(this.onScroll.bind(this),100);}
mounted(){this._update();}
willPatch(){const lastMessageRef=this.lastMessageRef;this._willPatchSnapshot={isLastMessageVisible:lastMessageRef&&lastMessageRef.isBottomVisible({offset:10}),scrollHeight:this.el.scrollHeight,scrollTop:this.el.scrollTop,};}
patched(){this._update();}
async adjustFromComponentHints(){if(!this.threadView){return;}
for(const hint of this.threadView.componentHintList){switch(hint.type){case'change-of-thread-cache':this._adjustFromChangeOfThreadCache(hint);break;case'home-menu-hidden':this._adjustFromHomeMenuHidden(hint);break;case'home-menu-shown':this._adjustFromHomeMenuShown(hint);break;case'messages-loaded':this.threadView.markComponentHintProcessed(hint);break;case'message-received':this._adjustFromMessageReceived(hint);break;case'more-messages-loaded':this._adjustFromMoreMessagesLoaded(hint);break;case'new-messages-loaded':this.threadView.markComponentHintProcessed(hint);break;}}
this._willPatchSnapshot=undefined;}
getDateDay(message){const date=message.date.format('YYYY-MM-DD');if(date===moment().format('YYYY-MM-DD')){return this.env._t("Today");}else if(date===moment().subtract(1,'days').format('YYYY-MM-DD')){return this.env._t("Yesterday");}
return message.date.format('LL');}
getScrollHeight(){return this.el.scrollHeight;}
getScrollTop(){return this.el.scrollTop;}
get mostRecentMessageRef(){if(this.props.order==='desc'){return this.messageRefs[0];}
const{length:l,[l-1]:mostRecentMessageRef}=this.messageRefs;return mostRecentMessageRef;}
messageRefFromId(messageId){return this.messageRefs.find(ref=>ref.message.id===messageId);}
get messageRefs(){const refs=this._getRefs();const ascOrderedMessageRefs=Object.entries(refs).filter(([refId,ref])=>(refId.includes(this.env.models['mail.message'].modelName)&&ref.message)).map(([refId,ref])=>ref).sort((ref1,ref2)=>(ref1.message.id<ref2.message.id?-1:1));if(this.props.order==='desc'){return ascOrderedMessageRefs.reverse();}
return ascOrderedMessageRefs;}
get orderedMessages(){const threadCache=this.threadView.threadCache;if(this.props.order==='desc'){return[...threadCache.orderedMessages].reverse();}
return threadCache.orderedMessages;}
async setScrollTop(value){this._isAutoLoadOnScrollActive=false;this.el.scrollTop=value;await new Promise(resolve=>setTimeout(resolve,0));this._isAutoLoadOnScrollActive=true;}
shouldMessageBeSquashed(prevMessage,message){if(!this.props.hasSquashCloseMessages){return false;}
if(Math.abs(message.date.diff(prevMessage.date))>60000){return false;}
if(prevMessage.message_type!=='comment'||message.message_type!=='comment'){return false;}
if(prevMessage.author!==message.author){return false;}
if(prevMessage.originThread!==message.originThread){return false;}
if(prevMessage.moderation_status==='pending_moderation'||message.moderation_status==='pending_moderation'){return false;}
if(prevMessage.notifications.length>0||message.notifications.length>0){return false;}
const prevOriginThread=prevMessage.originThread;const originThread=message.originThread;if(prevOriginThread&&originThread&&prevOriginThread.model===originThread.model&&originThread.model!=='mail.channel'&&prevOriginThread.id!==originThread.id){return false;}
return true;}
get threadView(){return this.env.models['mail.thread_view'].get(this.props.threadViewLocalId);}
async _adjustFromChangeOfThreadCache(hint){const threadCache=this.threadView.threadCache;if(!threadCache.isLoaded){return;}
let isProcessed=false;if(threadCache.messages.length>0){if(this.threadView.threadCacheInitialScrollPosition!==undefined){if(this.props.hasScrollAdjust){if(this.el.scrollHeight===this.threadView.threadCacheInitialScrollHeight){this.el.scrollTop=this.threadView.threadCacheInitialScrollPosition;isProcessed=true;}}else{isProcessed=true;}}else{const lastMessage=threadCache.lastMessage;if(this.messageRefFromId(lastMessage.id)){if(this.props.hasScrollAdjust){this._scrollToMostRecentMessage();}
isProcessed=true;}}}else{isProcessed=true;}
if(isProcessed){this.threadView.markComponentHintProcessed(hint);}}
_adjustFromChatWindowUnfolded(hint){if(this._adjustScrollFromModel()){this.threadView.markComponentHintProcessed(hint);}}
_adjustFromHomeMenuHidden(hint){if(this._adjustScrollFromModel()){this.threadView.markComponentHintProcessed(hint);}}
_adjustFromHomeMenuShown(hint){if(this._adjustScrollFromModel()){this.threadView.markComponentHintProcessed(hint);}}
async _adjustFromMessageReceived(hint){const threadCache=this.threadView.threadCache;if(!threadCache.isLoaded){return;}
const{message}=hint.data;if(!threadCache.messages.includes(message)){return;}
if(!this.messageRefFromId(message.id)){return;}
if(!this.props.hasScrollAdjust){this.threadView.markComponentHintProcessed(hint);return;}
if(!this.threadView.hasAutoScrollOnMessageReceived){this.threadView.markComponentHintProcessed(hint);return;}
if(this.threadView.lastVisibleMessage&&(message.id<this.threadView.lastVisibleMessage.id)){this.threadView.markComponentHintProcessed(hint);return;}
await this._scrollToMessage(message.id);this.threadView.markComponentHintProcessed(hint);}
_adjustFromMoreMessagesLoaded(hint){if(!this._willPatchSnapshot){this.threadView.markComponentHintProcessed(hint);return;}
const{scrollHeight,scrollTop}=this._willPatchSnapshot;if(this.props.order==='asc'&&this.props.hasScrollAdjust){this.el.scrollTop=this.el.scrollHeight-scrollHeight+scrollTop;}
this.threadView.markComponentHintProcessed(hint);}
_adjustScrollFromModel(){if(this.threadView.threadCacheInitialScrollPosition!==undefined&&this.props.hasScrollAdjust){if(this.el.scrollHeight===this.threadView.threadCacheInitialScrollHeight){this.el.scrollTop=this.threadView.threadCacheInitialScrollPosition;return true;}else{return false;}}
return true;}
_checkMostRecentMessageIsVisible(){if(!this.threadView){return;}
const thread=this.threadView.thread;const threadCache=this.threadView.threadCache;const lastMessageIsVisible=threadCache&&threadCache.messages.length>0&&this.mostRecentMessageRef&&threadCache===thread.mainCache&&this.mostRecentMessageRef.isPartiallyVisible();if(lastMessageIsVisible){this.threadView.handleVisibleMessage(this.mostRecentMessageRef.message);}}
_isLoadMoreVisible(){const loadMore=this._loadMoreRef.el;if(!loadMore){return false;}
const loadMoreRect=loadMore.getBoundingClientRect();const elRect=this.el.getBoundingClientRect();const isInvisible=loadMoreRect.top>elRect.bottom||loadMoreRect.bottom<elRect.top;return!isInvisible;}
_loadMore(){this.threadView.threadCache.loadMoreMessages();}
async _scrollToMostRecentMessage(){if(!this.mostRecentMessageRef){return;}
this._isAutoLoadOnScrollActive=false;await this.mostRecentMessageRef.scrollIntoView();if(!this.el){this._isAutoLoadOnScrollActive=true;return;}
this.el.scrollTop=this.props.order==='asc'?this.el.scrollTop+15:this.el.scrollTop-15;this._isAutoLoadOnScrollActive=true;}
async _scrollToMessage(messageId){const messageRef=this.messageRefFromId(messageId);if(!messageRef){return;}
this._isAutoLoadOnScrollActive=false;await messageRef.scrollIntoView();if(!this.el){this._isAutoLoadOnScrollActive=true;return;}
this.el.scrollTop=this.props.order==='asc'?this.el.scrollTop+15:this.el.scrollTop-15;this._isAutoLoadOnScrollActive=true;}
_update(){this._checkMostRecentMessageIsVisible();}
_onClickLoadMore(ev){ev.preventDefault();this._loadMore();}
onScroll(ev){if(!this.el){return;}
if(!this.threadView||!this.threadView.threadViewer){return;}
const scrollTop=this.el.scrollTop;this.env.messagingBus.trigger('o-component-message-list-scrolled',{scrollTop,threadViewer:this.threadView.threadViewer,});const margin=4;const hasAutoScrollOnMessageReceived=(this.props.order==='asc')?scrollTop>=this.el.scrollHeight-this.el.clientHeight-margin:scrollTop<=margin;this.threadView.update({hasAutoScrollOnMessageReceived});this.threadView.threadViewer.saveThreadCacheScrollHeightAsInitial(this.el.scrollHeight);this.threadView.threadViewer.saveThreadCacheScrollPositionsAsInitial(scrollTop);if(!this._isAutoLoadOnScrollActive){return;}
if(this._isLoadMoreVisible()){this._loadMore();}
this._checkMostRecentMessageIsVisible();}}
Object.assign(MessageList,{components,defaultProps:{hasMessageCheckbox:false,hasScrollAdjust:true,hasSquashCloseMessages:false,haveMessagesMarkAsReadIcon:false,haveMessagesReplyIcon:false,order:'asc',},props:{hasMessageCheckbox:Boolean,hasSquashCloseMessages:Boolean,haveMessagesMarkAsReadIcon:Boolean,haveMessagesReplyIcon:Boolean,hasScrollAdjust:Boolean,order:{type:String,validate:prop=>['asc','desc'].includes(prop),},selectedMessageLocalId:{type:String,optional:true,},threadViewLocalId:String,},template:'mail.MessageList',});return MessageList;});;

/* /mail/static/src/components/message_seen_indicator/message_seen_indicator.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/message_seen_indicator/message_seen_indicator.js',function(require){'use strict';const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component}=owl;class MessageSeenIndicator extends Component{constructor(...args){super(...args);useStore(props=>{const message=this.env.models['mail.message'].get(props.messageLocalId);const thread=this.env.models['mail.thread'].get(props.threadLocalId);const messageSeenIndicator=this.env.models['mail.message_seen_indicator'].find(messageSeenIndicator=>messageSeenIndicator.message===message&&messageSeenIndicator.thread===thread);return{messageSeenIndicator:messageSeenIndicator?messageSeenIndicator.__state:undefined,};});}
get indicatorTitle(){if(!this.messageSeenIndicator){return'';}
if(this.messageSeenIndicator.hasEveryoneSeen){return this.env._t("Seen by Everyone");}
if(this.messageSeenIndicator.hasSomeoneSeen){const partnersThatHaveSeen=this.messageSeenIndicator.partnersThatHaveSeen.map(partner=>partner.name);if(partnersThatHaveSeen.length===1){return _.str.sprintf(this.env._t("Seen by %s"),partnersThatHaveSeen[0]);}
if(partnersThatHaveSeen.length===2){return _.str.sprintf(this.env._t("Seen by %s and %s"),partnersThatHaveSeen[0],partnersThatHaveSeen[1]);}
return _.str.sprintf(this.env._t("Seen by %s, %s and more"),partnersThatHaveSeen[0],partnersThatHaveSeen[1]);}
if(this.messageSeenIndicator.hasEveryoneFetched){return this.env._t("Received by Everyone");}
if(this.messageSeenIndicator.hasSomeoneFetched){const partnersThatHaveFetched=this.messageSeenIndicator.partnersThatHaveFetched.map(partner=>partner.name);if(partnersThatHaveFetched.length===1){return _.str.sprintf(this.env._t("Received by %s"),partnersThatHaveFetched[0]);}
if(partnersThatHaveFetched.length===2){return _.str.sprintf(this.env._t("Received by %s and %s"),partnersThatHaveFetched[0],partnersThatHaveFetched[1]);}
return _.str.sprintf(this.env._t("Received by %s, %s and more"),partnersThatHaveFetched[0],partnersThatHaveFetched[1]);}
return'';}
get message(){return this.env.models['mail.message'].get(this.props.messageLocalId);}
get messageSeenIndicator(){return this.env.models['mail.message_seen_indicator'].find(messageSeenIndicator=>messageSeenIndicator.message===this.message&&messageSeenIndicator.thread===this.thread);}
get thread(){return this.env.models['mail.thread'].get(this.props.threadLocalId);}}
Object.assign(MessageSeenIndicator,{props:{messageLocalId:String,threadLocalId:String,},template:'mail.MessageSeenIndicator',});return MessageSeenIndicator;});;

/* /mail/static/src/components/messaging_menu/messaging_menu.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/messaging_menu/messaging_menu.js',function(require){'use strict';const components={AutocompleteInput:require('mail/static/src/components/autocomplete_input/autocomplete_input.js'),MobileMessagingNavbar:require('mail/static/src/components/mobile_messaging_navbar/mobile_messaging_navbar.js'),NotificationList:require('mail/static/src/components/notification_list/notification_list.js'),};const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component}=owl;const{useRef}=owl.hooks;class MessagingMenu extends Component{constructor(...args){super(...args);this.id=_.uniqueId('o_messagingMenu_');useStore(props=>{return{isDeviceMobile:this.env.messaging&&this.env.messaging.device.isMobile,isDiscussOpen:this.env.messaging&&this.env.messaging.discuss.isOpen,isMessagingInitialized:this.env.isMessagingInitialized(),messagingMenu:this.env.messaging&&this.env.messaging.messagingMenu.__state,};});this._onMobileNewMessageInputSelect=this._onMobileNewMessageInputSelect.bind(this);this._onMobileNewMessageInputSource=this._onMobileNewMessageInputSource.bind(this);this._onClickCaptureGlobal=this._onClickCaptureGlobal.bind(this);}
mounted(){document.addEventListener('click',this._onClickCaptureGlobal,true);}
willUnmount(){document.removeEventListener('click',this._onClickCaptureGlobal,true);}
get discuss(){return this.env.messaging&&this.env.messaging.discuss;}
get messagingMenu(){return this.env.messaging&&this.env.messaging.messagingMenu;}
get mobileNewMessageInputPlaceholder(){return this.env._t("Search user...");}
get tabs(){return[{icon:'fa fa-envelope',id:'all',label:this.env._t("All"),},{icon:'fa fa-user',id:'chat',label:this.env._t("Chat"),},{icon:'fa fa-users',id:'channel',label:this.env._t("Channel"),}];}
_onClickCaptureGlobal(ev){if(!this.env.messaging){return;}
if(this.env.messaging.device.isMobile){return;}
if(this.el.contains(ev.target)){return;}
this.messagingMenu.close();}
_onClickDesktopTabButton(ev){this.messagingMenu.update({activeTabId:ev.currentTarget.dataset.tabId});}
_onClickNewMessage(ev){if(!this.env.messaging.device.isMobile){this.env.messaging.chatWindowManager.openNewMessage();this.messagingMenu.close();}else{this.messagingMenu.toggleMobileNewMessage();}}
_onClickToggler(ev){ev.preventDefault();if(!this.env.messaging){return;}
this.messagingMenu.toggleOpen();}
_onHideMobileNewMessage(ev){ev.stopPropagation();this.messagingMenu.toggleMobileNewMessage();}
_onMobileNewMessageInputSelect(ev,ui){this.env.messaging.openChat({partnerId:ui.item.id});}
_onMobileNewMessageInputSource(req,res){const value=_.escape(req.term);this.env.models['mail.partner'].imSearch({callback:partners=>{const suggestions=partners.map(partner=>{return{id:partner.id,value:partner.nameOrDisplayName,label:partner.nameOrDisplayName,};});res(_.sortBy(suggestions,'label'));},keyword:value,limit:10,});}
_onSelectMobileNavbarTab(ev){ev.stopPropagation();this.messagingMenu.update({activeTabId:ev.detail.tabId});}}
Object.assign(MessagingMenu,{components,props:{},template:'mail.MessagingMenu',});return MessagingMenu;});;

/* /mail/static/src/components/mobile_messaging_navbar/mobile_messaging_navbar.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/mobile_messaging_navbar/mobile_messaging_navbar.js',function(require){'use strict';const{Component}=owl;class MobileMessagingNavbar extends Component{_onClick(ev){this.trigger('o-select-mobile-messaging-navbar-tab',{tabId:ev.currentTarget.dataset.tabId,});}}
Object.assign(MobileMessagingNavbar,{defaultProps:{tabs:[],},props:{activeTabId:String,tabs:{type:Array,element:{type:Object,shape:{icon:{type:String,optional:true,},id:String,label:String,},},},},template:'mail.MobileMessagingNavbar',});return MobileMessagingNavbar;});;

/* /mail/static/src/components/moderation_ban_dialog/moderation_ban_dialog.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/moderation_ban_dialog/moderation_ban_dialog.js',function(require){'use strict';const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const components={Dialog:require('web.OwlDialog'),};const{Component}=owl;const{useRef}=owl.hooks;class ModerationBanDialog extends Component{constructor(...args){super(...args);useStore(props=>{const messages=props.messageLocalIds.map(localId=>this.env.models['mail.message'].get(localId));return{messages:messages.map(message=>message?message.__state:undefined),};},{compareDepth:{messages:1,},});this._dialogRef=useRef('dialog');}
get messages(){return this.props.messageLocalIds.map(localId=>this.env.models['mail.message'].get(localId));}
get CONFIRMATION(){return this.env._t("Confirmation");}
_onClickBan(){this._dialogRef.comp._close();this.env.models['mail.message'].moderate(this.messages,'ban');}
_onClickCancel(){this._dialogRef.comp._close();}}
Object.assign(ModerationBanDialog,{components,props:{messageLocalIds:{type:Array,element:String,},},template:'mail.ModerationBanDialog',});return ModerationBanDialog;});;

/* /mail/static/src/components/moderation_discard_dialog/moderation_discard_dialog.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/moderation_discard_dialog/moderation_discard_dialog.js',function(require){'use strict';const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const components={Dialog:require('web.OwlDialog'),};const{Component}=owl;const{useRef}=owl.hooks;class ModerationDiscardDialog extends Component{constructor(...args){super(...args);useStore(props=>{const messages=props.messageLocalIds.map(localId=>this.env.models['mail.message'].get(localId));return{messages:messages.map(message=>message?message.__state:undefined),};},{compareDepth:{messages:1,},});this._dialogRef=useRef('dialog');}
getBody(){if(this.messages.length===1){return this.env._t("You are going to discard 1 message.");}
return _.str.sprintf(this.env._t("You are going to discard %s messages."),this.messages.length);}
get messages(){return this.props.messageLocalIds.map(localId=>this.env.models['mail.message'].get(localId));}
getTitle(){return this.env._t("Confirmation");}
_onClickCancel(){this._dialogRef.comp._close();}
_onClickDiscard(){this._dialogRef.comp._close();this.env.models['mail.message'].moderate(this.messages,'discard');}}
Object.assign(ModerationDiscardDialog,{components,props:{messageLocalIds:{type:Array,element:String,},},template:'mail.ModerationDiscardDialog',});return ModerationDiscardDialog;});;

/* /mail/static/src/components/moderation_reject_dialog/moderation_reject_dialog.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/moderation_reject_dialog/moderation_reject_dialog.js',function(require){'use strict';const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const components={Dialog:require('web.OwlDialog'),};const{Component,useState}=owl;const{useRef}=owl.hooks;class ModerationRejectDialog extends Component{constructor(...args){super(...args);this.state=useState({title:this.env._t("Message Rejected"),comment:this.env._t("Your message was rejected by moderator."),});useStore(props=>{const messages=props.messageLocalIds.map(localId=>this.env.models['mail.message'].get(localId));return{messages:messages.map(message=>message?message.__state:undefined),};},{compareDepth:{messages:1,},});this._dialogRef=useRef('dialog');}
get messages(){return this.props.messageLocalIds.map(localId=>this.env.models['mail.message'].get(localId));}
get SEND_EXPLANATION_TO_AUTHOR(){return this.env._t("Send explanation to author");}
_onClickCancel(){this._dialogRef.comp._close();}
_onClickReject(){this._dialogRef.comp._close();const kwargs={title:this.state.title,comment:this.state.comment,};this.env.models['mail.message'].moderate(this.messages,'reject',kwargs);}}
Object.assign(ModerationRejectDialog,{components,props:{messageLocalIds:{type:Array,element:String,},},template:'mail.ModerationRejectDialog',});return ModerationRejectDialog;});;

/* /mail/static/src/components/notification_alert/notification_alert.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/notification_alert/notification_alert.js',function(require){'use strict';const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component}=owl;class NotificationAlert extends Component{constructor(...args){super(...args);useStore(props=>{const isMessagingInitialized=this.env.isMessagingInitialized();return{isMessagingInitialized,isNotificationBlocked:this.isNotificationBlocked,};});}
get isNotificationBlocked(){if(!this.env.isMessagingInitialized()){return false;}
const windowNotification=this.env.browser.Notification;return(windowNotification&&windowNotification.permission!=="granted"&&!this.env.messaging.isNotificationPermissionDefault());}}
Object.assign(NotificationAlert,{props:{},template:'mail.NotificationAlert',});return NotificationAlert;});;

/* /mail/static/src/components/notification_group/notification_group.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/notification_group/notification_group.js',function(require){'use strict';const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component}=owl;const{useRef}=owl.hooks;class NotificationGroup extends Component{constructor(...args){super(...args);useStore(props=>{const group=this.env.models['mail.notification_group'].get(props.notificationGroupLocalId);return{group:group?group.__state:undefined,};});this._markAsReadRef=useRef('markAsRead');}
get group(){return this.env.models['mail.notification_group'].get(this.props.notificationGroupLocalId);}
image(){if(this.group.notification_type==='email'){return'/mail/static/src/img/smiley/mailfailure.jpg';}}
_onClick(ev){const markAsRead=this._markAsReadRef.el;if(markAsRead&&markAsRead.contains(ev.target)){return;}
this.group.openDocuments();if(!this.env.messaging.device.isMobile){this.env.messaging.messagingMenu.close();}}
_onClickMarkAsRead(ev){this.group.openCancelAction();if(!this.env.messaging.device.isMobile){this.env.messaging.messagingMenu.close();}}}
Object.assign(NotificationGroup,{props:{notificationGroupLocalId:String,},template:'mail.NotificationGroup',});return NotificationGroup;});;

/* /mail/static/src/components/notification_list/notification_list.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/notification_list/notification_list.js',function(require){'use strict';const components={NotificationGroup:require('mail/static/src/components/notification_group/notification_group.js'),NotificationRequest:require('mail/static/src/components/notification_request/notification_request.js'),ThreadNeedactionPreview:require('mail/static/src/components/thread_needaction_preview/thread_needaction_preview.js'),ThreadPreview:require('mail/static/src/components/thread_preview/thread_preview.js'),};const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component}=owl;class NotificationList extends Component{constructor(...args){super(...args);this.storeProps=useStore((...args)=>this._useStoreSelector(...args),{compareDepth:{notifications:2,},});}
mounted(){this._loadPreviews();}
get notifications(){const{notifications}=this.storeProps;return notifications;}
async _loadPreviews(){const threads=this.notifications.filter(notification=>notification.thread&&notification.thread.exists()).map(notification=>notification.thread);this.env.models['mail.thread'].loadPreviews(threads);}
_useStoreSelector(props){const threads=this._useStoreSelectorThreads(props);let threadNeedactionNotifications=[];if(props.filter==='all'){threadNeedactionNotifications=this.env.models['mail.thread'].all(t=>t.model!=='mail.box'&&t.needactionMessages.length>0).sort((t1,t2)=>{if(t1.needactionMessages.length>0&&t2.needactionMessages.length===0){return-1;}
if(t1.needactionMessages.length===0&&t2.needactionMessages.length>0){return 1;}
if(t1.lastNeedactionMessage&&t2.lastNeedactionMessage){return t1.lastNeedactionMessage.date.isBefore(t2.lastNeedactionMessage.date)?1:-1;}
if(t1.lastNeedactionMessage){return-1;}
if(t2.lastNeedactionMessage){return 1;}
return t1.id<t2.id?-1:1;}).map(thread=>{return{thread,type:'thread_needaction',uniqueId:thread.localId+'_needaction',};});}
const threadNotifications=threads.sort((t1,t2)=>{if(t1.localMessageUnreadCounter>0&&t2.localMessageUnreadCounter===0){return-1;}
if(t1.localMessageUnreadCounter===0&&t2.localMessageUnreadCounter>0){return 1;}
if(t1.lastMessage&&t2.lastMessage){return t1.lastMessage.date.isBefore(t2.lastMessage.date)?1:-1;}
if(t1.lastMessage){return-1;}
if(t2.lastMessage){return 1;}
return t1.id<t2.id?-1:1;}).map(thread=>{return{thread,type:'thread',uniqueId:thread.localId,};});let notifications=threadNeedactionNotifications.concat(threadNotifications);if(props.filter==='all'){const notificationGroups=this.env.messaging.notificationGroupManager.groups;notifications=Object.values(notificationGroups).sort((group1,group2)=>group1.date.isAfter(group2.date)?-1:1).map(notificationGroup=>{return{notificationGroup,uniqueId:notificationGroup.localId,};}).concat(notifications);}
if(props.filter==='all'&&this.env.messaging.isNotificationPermissionDefault()){notifications.unshift({type:'odoobotRequest',uniqueId:'odoobotRequest',});}
return{isDeviceMobile:this.env.messaging.device.isMobile,notifications,};}
_useStoreSelectorThreads(props){if(props.filter==='mailbox'){return this.env.models['mail.thread'].all(thread=>thread.isPinned&&thread.model==='mail.box').sort((mailbox1,mailbox2)=>{if(mailbox1===this.env.messaging.inbox){return-1;}
if(mailbox2===this.env.messaging.inbox){return 1;}
if(mailbox1===this.env.messaging.starred){return-1;}
if(mailbox2===this.env.messaging.starred){return 1;}
const mailbox1Name=mailbox1.displayName;const mailbox2Name=mailbox2.displayName;mailbox1Name<mailbox2Name?-1:1;});}else if(props.filter==='channel'){return this.env.models['mail.thread'].all(thread=>thread.channel_type==='channel'&&thread.isPinned&&thread.model==='mail.channel').sort((c1,c2)=>c1.displayName<c2.displayName?-1:1);}else if(props.filter==='chat'){return this.env.models['mail.thread'].all(thread=>thread.isChatChannel&&thread.isPinned&&thread.model==='mail.channel').sort((c1,c2)=>c1.displayName<c2.displayName?-1:1);}else if(props.filter==='all'){return this.env.models['mail.thread'].all(thread=>thread.isPinned&&thread.model==='mail.channel').sort((c1,c2)=>c1.displayName<c2.displayName?-1:1);}else{throw new Error(`Unsupported filter ${props.filter}`);}}}
Object.assign(NotificationList,{_allowedFilters:['all','mailbox','channel','chat'],components,defaultProps:{filter:'all',},props:{filter:{type:String,validate:prop=>NotificationList._allowedFilters.includes(prop),},},template:'mail.NotificationList',});return NotificationList;});;

/* /mail/static/src/components/notification_popover/notification_popover.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/notification_popover/notification_popover.js',function(require){'use strict';const{Component}=owl;const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');class NotificationPopover extends Component{constructor(...args){super(...args);useStore(props=>{const notifications=props.notificationLocalIds.map(notificationLocalId=>this.env.models['mail.notification'].get(notificationLocalId));return{notifications:notifications.map(notification=>notification?notification.__state:undefined),};},{compareDepth:{notifications:1,},});}
get iconClass(){switch(this.notification.notification_status){case'sent':return'fa fa-check';case'bounce':return'fa fa-exclamation';case'exception':return'fa fa-exclamation';case'ready':return'fa fa-send-o';case'canceled':return'fa fa-trash-o';}
return'';}
get iconTitle(){switch(this.notification.notification_status){case'sent':return this.env._t("Sent");case'bounce':return this.env._t("Bounced");case'exception':return this.env._t("Error");case'ready':return this.env._t("Ready");case'canceled':return this.env._t("Canceled");}
return'';}
get notifications(){return this.props.notificationLocalIds.map(notificationLocalId=>this.env.models['mail.notification'].get(notificationLocalId));}}
Object.assign(NotificationPopover,{props:{notificationLocalIds:{type:Array,element:String,},},template:'mail.NotificationPopover',});return NotificationPopover;});;

/* /mail/static/src/components/notification_request/notification_request.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/notification_request/notification_request.js',function(require){'use strict';const components={PartnerImStatusIcon:require('mail/static/src/components/partner_im_status_icon/partner_im_status_icon.js'),};const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component}=owl;class NotificationRequest extends Component{constructor(...args){super(...args);useStore(props=>{return{isDeviceMobile:this.env.messaging.device.isMobile,partnerRoot:this.env.messaging.partnerRoot?this.env.messaging.partnerRoot.__state:undefined,};});}
getHeaderText(){return _.str.sprintf(this.env._t("%s has a request"),this.env.messaging.partnerRoot.nameOrDisplayName);}
_handleResponseNotificationPermission(value){this.env.messaging.messagingMenu.update();if(value!=='granted'){this.env.services['bus_service'].sendNotification(this.env._t("Permission denied"),this.env._t("Odoo will not have the permission to send native notifications on this device."));}}
_onClick(){const windowNotification=this.env.browser.Notification;const def=windowNotification&&windowNotification.requestPermission();if(def){def.then(this._handleResponseNotificationPermission.bind(this));}
if(!this.env.messaging.device.isMobile){this.env.messaging.messagingMenu.close();}}}
Object.assign(NotificationRequest,{components,props:{},template:'mail.NotificationRequest',});return NotificationRequest;});;

/* /mail/static/src/components/partner_im_status_icon/partner_im_status_icon.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/partner_im_status_icon/partner_im_status_icon.js',function(require){'use strict';const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component}=owl;class PartnerImStatusIcon extends Component{constructor(...args){super(...args);useStore(props=>{const partner=this.env.models['mail.partner'].get(props.partnerLocalId);return{partner:partner?partner.__state:undefined,partnerRoot:this.env.messaging.partnerRoot?this.env.messaging.partnerRoot.__state:undefined,};});}
get partner(){return this.env.models['mail.partner'].get(this.props.partnerLocalId);}
_onClick(ev){if(!this.props.hasOpenChat){return;}
this.partner.openChat();}}
Object.assign(PartnerImStatusIcon,{defaultProps:{hasBackground:true,hasOpenChat:false,},props:{partnerLocalId:String,hasBackground:Boolean,hasOpenChat:Boolean,},template:'mail.PartnerImStatusIcon',});return PartnerImStatusIcon;});;

/* /mail/static/src/components/thread_icon/thread_icon.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/thread_icon/thread_icon.js',function(require){'use strict';const components={ThreadTypingIcon:require('mail/static/src/components/thread_typing_icon/thread_typing_icon.js'),};const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component}=owl;class ThreadIcon extends Component{constructor(...args){super(...args);useStore(props=>{const thread=this.env.models['mail.thread'].get(props.threadLocalId);const correspondent=thread?thread.correspondent:undefined;return{correspondent:correspondent?correspondent.__state:undefined,partnerRoot:this.env.messaging.partnerRoot?this.env.messaging.partnerRoot.__state:undefined,thread:thread?thread.__state:undefined,};});}
get thread(){return this.env.models['mail.thread'].get(this.props.threadLocalId);}}
Object.assign(ThreadIcon,{components,props:{threadLocalId:String,},template:'mail.ThreadIcon',});return ThreadIcon;});;

/* /mail/static/src/components/thread_needaction_preview/thread_needaction_preview.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/thread_needaction_preview/thread_needaction_preview.js',function(require){'use strict';const components={MessageAuthorPrefix:require('mail/static/src/components/message_author_prefix/message_author_prefix.js'),PartnerImStatusIcon:require('mail/static/src/components/partner_im_status_icon/partner_im_status_icon.js'),};const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const mailUtils=require('mail.utils');const{Component}=owl;const{useRef}=owl.hooks;class ThreadNeedactionPreview extends Component{constructor(...args){super(...args);useStore(props=>{const thread=this.env.models['mail.thread'].get(props.threadLocalId);const mainThreadCache=thread?thread.mainCache:undefined;let lastNeedactionMessageAuthor;let lastNeedactionMessage;let threadCorrespondent;if(thread){lastNeedactionMessage=mainThreadCache.lastNeedactionMessage;threadCorrespondent=thread.correspondent;}
if(lastNeedactionMessage){lastNeedactionMessageAuthor=lastNeedactionMessage.author;}
return{isDeviceMobile:this.env.messaging.device.isMobile,lastNeedactionMessage:lastNeedactionMessage?lastNeedactionMessage.__state:undefined,lastNeedactionMessageAuthor:lastNeedactionMessageAuthor?lastNeedactionMessageAuthor.__state:undefined,thread:thread?thread.__state:undefined,threadCorrespondent:threadCorrespondent?threadCorrespondent.__state:undefined,};});this._markAsReadRef=useRef('markAsRead');}
image(){if(this.thread.moduleIcon){return this.thread.moduleIcon;}
if(this.thread.correspondent){return this.thread.correspondent.avatarUrl;}
if(this.thread.model==='mail.channel'){return`/web/image/mail.channel/${this.thread.id}/image_128`;}
return'/mail/static/src/img/smiley/avatar.jpg';}
get inlineLastNeedactionMessageBody(){if(!this.thread.lastNeedactionMessage){return'';}
return mailUtils.htmlToTextContentInline(this.thread.lastNeedactionMessage.prettyBody);}
get thread(){return this.env.models['mail.thread'].get(this.props.threadLocalId);}
_onClick(ev){const markAsRead=this._markAsReadRef.el;if(markAsRead&&markAsRead.contains(ev.target)){return;}
this.thread.markNeedactionMessagesAsRead();this.thread.open();if(!this.env.messaging.device.isMobile){this.env.messaging.messagingMenu.close();}}
_onClickMarkAsRead(ev){this.thread.markNeedactionMessagesAsRead();}}
Object.assign(ThreadNeedactionPreview,{components,props:{threadLocalId:String,},template:'mail.ThreadNeedactionPreview',});return ThreadNeedactionPreview;});;

/* /mail/static/src/components/thread_preview/thread_preview.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/thread_preview/thread_preview.js',function(require){'use strict';const components={MessageAuthorPrefix:require('mail/static/src/components/message_author_prefix/message_author_prefix.js'),PartnerImStatusIcon:require('mail/static/src/components/partner_im_status_icon/partner_im_status_icon.js'),};const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const mailUtils=require('mail.utils');const{Component}=owl;const{useRef}=owl.hooks;class ThreadPreview extends Component{constructor(...args){super(...args);useStore(props=>{const thread=this.env.models['mail.thread'].get(props.threadLocalId);let lastMessageAuthor;let lastMessage;if(thread){const orderedMessages=thread.orderedMessages;lastMessage=orderedMessages[orderedMessages.length-1];}
if(lastMessage){lastMessageAuthor=lastMessage.author;}
return{isDeviceMobile:this.env.messaging.device.isMobile,lastMessage:lastMessage?lastMessage.__state:undefined,lastMessageAuthor:lastMessageAuthor?lastMessageAuthor.__state:undefined,thread:thread?thread.__state:undefined,threadCorrespondent:thread&&thread.correspondent?thread.correspondent.__state:undefined,};});this._markAsReadRef=useRef('markAsRead');}
image(){if(this.thread.correspondent){return this.thread.correspondent.avatarUrl;}
return`/web/image/mail.channel/${this.thread.id}/image_128`;}
get inlineLastMessageBody(){if(!this.thread.lastMessage){return'';}
return mailUtils.htmlToTextContentInline(this.thread.lastMessage.prettyBody);}
get thread(){return this.env.models['mail.thread'].get(this.props.threadLocalId);}
_onClick(ev){const markAsRead=this._markAsReadRef.el;if(markAsRead&&markAsRead.contains(ev.target)){return;}
this.thread.open();if(!this.env.messaging.device.isMobile){this.env.messaging.messagingMenu.close();}}
_onClickMarkAsRead(ev){if(this.thread.lastNonTransientMessage){this.thread.markAsSeen(this.thread.lastNonTransientMessage);}}}
Object.assign(ThreadPreview,{components,props:{threadLocalId:String,},template:'mail.ThreadPreview',});return ThreadPreview;});;

/* /mail/static/src/components/thread_textual_typing_status/thread_textual_typing_status.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/thread_textual_typing_status/thread_textual_typing_status.js',function(require){'use strict';const components={ThreadTypingIcon:require('mail/static/src/components/thread_typing_icon/thread_typing_icon.js'),};const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component}=owl;class ThreadTextualTypingStatus extends Component{constructor(...args){super(...args);useStore(props=>{const thread=this.env.models['mail.thread'].get(props.threadLocalId);return{thread:thread?thread.__state:undefined,};});}
get thread(){return this.env.models['mail.thread'].get(this.props.threadLocalId);}}
Object.assign(ThreadTextualTypingStatus,{components,props:{threadLocalId:String,},template:'mail.ThreadTextualTypingStatus',});return ThreadTextualTypingStatus;});;

/* /mail/static/src/components/thread_typing_icon/thread_typing_icon.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/thread_typing_icon/thread_typing_icon.js',function(require){'use strict';const{Component}=owl;class ThreadTypingIcon extends Component{}
Object.assign(ThreadTypingIcon,{defaultProps:{animation:'none',size:'small',},props:{animation:{type:String,validate:prop=>['bounce','none','pulse'].includes(prop),},size:{type:String,validate:prop=>['small','medium'].includes(prop),},title:{type:String,optional:true,}},template:'mail.ThreadTypingIcon',});return ThreadTypingIcon;});;

/* /mail/static/src/components/thread_view/thread_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/components/thread_view/thread_view.js',function(require){'use strict';const components={Composer:require('mail/static/src/components/composer/composer.js'),MessageList:require('mail/static/src/components/message_list/message_list.js'),};const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component}=owl;const{useRef}=owl.hooks;class ThreadView extends Component{constructor(...args){super(...args);useStore((...args)=>this._useStoreSelector(...args));this._composerRef=useRef('composer');this._messageListRef=useRef('messageList');}
mounted(){this._update();}
patched(){this._update();}
focus(){if(!this._composerRef.comp){return;}
this._composerRef.comp.focus();}
focusout(){if(!this._composerRef.comp){return;}
this._composerRef.comp.focusout();}
getScrollHeight(){if(!this._messageListRef.comp){return undefined;}
return this._messageListRef.comp.getScrollHeight();}
getScrollTop(){if(!this._messageListRef.comp){return undefined;}
return this._messageListRef.comp.getScrollTop();}
onScroll(ev){if(!this._messageListRef.comp){return;}
this._messageListRef.comp.onScroll(ev);}
get threadView(){return this.env.models['mail.thread_view'].get(this.props.threadViewLocalId);}
_update(){const messageList=this._messageListRef.comp;this.trigger('o-rendered');if(messageList){messageList.adjustFromComponentHints();}}
_useStoreSelector(props){const threadView=this.env.models['mail.thread_view'].get(props.threadViewLocalId);const thread=threadView?threadView.thread:undefined;const threadCache=threadView?threadView.threadCache:undefined;return{isDeviceMobile:this.env.messaging.device.isMobile,thread:thread?thread.__state:undefined,threadCache:threadCache?threadCache.__state:undefined,threadView:threadView?threadView.__state:undefined,};}}
Object.assign(ThreadView,{components,defaultProps:{composerAttachmentsDetailsMode:'auto',hasComposer:false,hasMessageCheckbox:false,hasSquashCloseMessages:false,haveMessagesMarkAsReadIcon:false,haveMessagesReplyIcon:false,order:'asc',showComposerAttachmentsExtensions:true,showComposerAttachmentsFilenames:true,},props:{composerAttachmentsDetailsMode:{type:String,validate:prop=>['auto','card','hover','none'].includes(prop),},hasComposer:Boolean,hasComposerCurrentPartnerAvatar:{type:Boolean,optional:true,},hasComposerSendButton:{type:Boolean,optional:true,},hasComposerThreadTyping:{type:Boolean,optional:true,},hasMessageCheckbox:Boolean,hasScrollAdjust:{type:Boolean,optional:true,},hasSquashCloseMessages:Boolean,haveMessagesMarkAsReadIcon:Boolean,haveMessagesReplyIcon:Boolean,order:{type:String,validate:prop=>['asc','desc'].includes(prop),},selectedMessageLocalId:{type:String,optional:true,},showComposerAttachmentsExtensions:Boolean,showComposerAttachmentsFilenames:Boolean,threadViewLocalId:String,},template:'mail.ThreadView',});return ThreadView;});;

/* /mail/static/src/model/model_core.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/model/model_core.js',function(require){'use strict';const registry={};function _getEntryFromModelName(modelName){if(!registry[modelName]){registry[modelName]={dependencies:[],factory:undefined,name:modelName,patches:[],};}
return registry[modelName];}
function _registerPatchModel(modelName,patchName,patch,{type='instance'}={}){const entry=_getEntryFromModelName(modelName);Object.assign(entry,{patches:(entry.patches||[]).concat([{name:patchName,patch,type,}]),});}
function registerClassPatchModel(modelName,patchName,patch){_registerPatchModel(modelName,patchName,patch,{type:'class'});}
function registerFieldPatchModel(modelName,patchName,patch){_registerPatchModel(modelName,patchName,patch,{type:'field'});}
function registerInstancePatchModel(modelName,patchName,patch){_registerPatchModel(modelName,patchName,patch,{type:'instance'});}
function registerNewModel(name,factory,dependencies=[]){const entry=_getEntryFromModelName(name);let entryDependencies=[...dependencies];if(name!=='mail.model'){entryDependencies=[...new Set(entryDependencies.concat(['mail.model']))];}
if(entry.factory){throw new Error(`Model "${name}" has already been registered!`);}
Object.assign(entry,{dependencies:entryDependencies,factory,name,});}
return{registerClassPatchModel,registerFieldPatchModel,registerInstancePatchModel,registerNewModel,registry,};});;

/* /mail/static/src/model/model_errors.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/model/model_errors.js',function(require){'use strict';class RecordDeletedError extends Error{constructor(recordLocalId,...args){super(...args);this.recordLocalId=recordLocalId;this.name='RecordDeletedError';}}
return{RecordDeletedError,};});;

/* /mail/static/src/model/model_field.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/model/model_field.js',function(require){'use strict';const{FieldCommand}=require('mail/static/src/model/model_field_command.js');class ModelField{constructor({compute,default:def,dependencies=[],dependents=[],env,fieldName,fieldType,hashes:extraHashes=[],inverse,isCausal=false,related,relationType,to,}={}){const id=_.uniqueId('field_');this.compute=compute;this.default=def;this.dependencies=dependencies;this.dependents=dependents;this.env=env;this.fieldName=fieldName;this.fieldType=fieldType;this.hashes=extraHashes.concat([id]);this.id=id;this.inverse=inverse;this.isCausal=isCausal;this.related=related;this.relationType=relationType;this.to=to;if(!this.default&&this.fieldType==='relation'){this.default=[];}}
static attr(options){return Object.assign({fieldType:'attribute'},options);}
static many2many(modelName,options){return ModelField._relation(modelName,Object.assign({},options,{relationType:'many2many'}));}
static many2one(modelName,options){return ModelField._relation(modelName,Object.assign({},options,{relationType:'many2one'}));}
static one2many(modelName,options){return ModelField._relation(modelName,Object.assign({},options,{relationType:'one2many'}));}
static one2one(modelName,options){return ModelField._relation(modelName,Object.assign({},options,{relationType:'one2one'}));}
clear(record,options){let hasChanged=false;if(this.fieldType==='relation'){if(this.parseAndExecuteCommands(record,[['unlink-all']],options)){hasChanged=true;}}
if(this.parseAndExecuteCommands(record,this.default,options)){hasChanged=true;}
return hasChanged;}
combine(field){return new ModelField(Object.assign({},this,{dependencies:this.dependencies.concat(field.dependencies),hashes:this.hashes.concat(field.hashes),}));}
computeRelated(record){const[relationName,relatedFieldName]=this.related.split('.');const Model=record.constructor;const relationField=Model.__fieldMap[relationName];if(['one2many','many2many'].includes(relationField.relationType)){const newVal=[];for(const otherRecord of record[relationName]){const OtherModel=otherRecord.constructor;const otherField=OtherModel.__fieldMap[relatedFieldName];const otherValue=otherField.get(otherRecord);if(otherValue){if(otherValue instanceof Array){for(const v of otherValue){newVal.push(v);}}else{newVal.push(otherValue);}}}
if(this.fieldType==='relation'){return[['replace',newVal]];}
return newVal;}
const otherRecord=record[relationName];if(otherRecord){const OtherModel=otherRecord.constructor;const otherField=OtherModel.__fieldMap[relatedFieldName];const newVal=otherField.get(otherRecord);if(this.fieldType==='relation'){if(newVal){return[['replace',newVal]];}else{return[['unlink-all']];}}
return newVal;}
if(this.fieldType==='relation'){return[];}}
get(record){if(this.fieldType==='attribute'){return this.read(record);}
if(this.fieldType==='relation'){if(['one2one','many2one'].includes(this.relationType)){return this.read(record);}
return[...this.read(record)];}
throw new Error(`cannot get field with unsupported type ${this.fieldType}.`);}
parseAndExecuteCommands(record,newVal,options){if(newVal instanceof FieldCommand){return newVal.execute(this,record,options);}
if(typeof newVal instanceof Array&&newVal[0]instanceof FieldCommand){let hasChanged=false;for(const command of newVal){if(command.execute(this,record,options)){hasChanged=true;}}
return hasChanged;}
return this.set(record,newVal,options);}
read(record){return record.__values[this.fieldName];}
set(record,newVal,options){const currentValue=this.read(record);if(this.fieldType==='attribute'){if(currentValue===newVal){return false;}
record.__values[this.fieldName]=newVal;return true;}
if(this.fieldType==='relation'){let hasChanged=false;for(const val of newVal){switch(val[0]){case'create':if(this._setRelationCreate(record,val[1],options)){hasChanged=true;}
break;case'insert':if(this._setRelationInsert(record,val[1],options)){hasChanged=true;}
break;case'insert-and-replace':if(this._setRelationInsertAndReplace(record,val[1],options)){hasChanged=true;}
break;case'link':if(this._setRelationLink(record,val[1],options)){hasChanged=true;}
break;case'replace':if(this._setRelationReplace(record,val[1],options)){hasChanged=true;}
break;case'unlink':if(this._setRelationUnlink(record,val[1],options)){hasChanged=true;}
break;case'unlink-all':if(this._setRelationUnlink(record,currentValue,options)){hasChanged=true;}
break;}}
return hasChanged;}}
static _relation(modelName,options){return Object.assign({fieldType:'relation',to:modelName,},options);}
_convertX2ManyValue(newValue,{hasToVerify=true}={}){if(typeof newValue[Symbol.iterator]==='function'){if(hasToVerify){for(const value of newValue){this._verifyRelationalValue(value);}}
return newValue;}
if(hasToVerify){this._verifyRelationalValue(newValue);}
return[newValue];}
_setRelationCreate(record,data,options){const OtherModel=this.env.models[this.to];const other=this.env.modelManager._create(OtherModel,data);return this._setRelationLink(record,other,options);}
_setRelationInsert(record,data,options){const OtherModel=this.env.models[this.to];const other=this.env.modelManager._insert(OtherModel,data);return this._setRelationLink(record,other,options);}
_setRelationInsertAndReplace(record,data,options){const OtherModel=this.env.models[this.to];const newValue=this.env.modelManager._insert(OtherModel,data);return this._setRelationReplace(record,newValue,options);}
_setRelationLink(record,newValue,options){switch(this.relationType){case'many2many':case'one2many':return this._setRelationLinkX2Many(record,newValue,options);case'many2one':case'one2one':return this._setRelationLinkX2One(record,newValue,options);}}
_setRelationLinkX2Many(record,newValue,{hasToUpdateInverse=true}={}){const recordsToLink=this._convertX2ManyValue(newValue);const otherRecords=this.read(record);let hasChanged=false;for(const recordToLink of recordsToLink){if(otherRecords.has(recordToLink)){continue;}
hasChanged=true;otherRecords.add(recordToLink);if(hasToUpdateInverse){this.env.modelManager._update(recordToLink,{[this.inverse]:[['link',record]]},{hasToUpdateInverse:false});}}
return hasChanged;}
_setRelationLinkX2One(record,recordToLink,{hasToUpdateInverse=true}={}){this._verifyRelationalValue(recordToLink);const prevOtherRecord=this.read(record);if(prevOtherRecord===recordToLink){return false;}
this._setRelationUnlinkX2One(record,{hasToUpdateInverse});record.__values[this.fieldName]=recordToLink;if(hasToUpdateInverse){this.env.modelManager._update(recordToLink,{[this.inverse]:[['link',record]]},{hasToUpdateInverse:false});}
return true;}
_setRelationReplace(record,newValue,options){if(['one2one','many2one'].includes(this.relationType)){return this._setRelationLinkX2One(record,newValue,options);}
let hasChanged=false;let hasToReorder=false;const otherRecordsSet=this.read(record);const otherRecordsList=[...otherRecordsSet];const recordsToReplaceList=[...this._convertX2ManyValue(newValue)];const recordsToReplaceSet=new Set(recordsToReplaceList);const recordsToLink=[];for(let i=0;i<recordsToReplaceList.length;i++){const recordToReplace=recordsToReplaceList[i];if(!otherRecordsSet.has(recordToReplace)){recordsToLink.push(recordToReplace);}
if(otherRecordsList[i]!==recordToReplace){hasToReorder=true;}}
if(this._setRelationLinkX2Many(record,recordsToLink,options)){hasChanged=true;}
const recordsToUnlink=[];for(let i=0;i<otherRecordsList.length;i++){const otherRecord=otherRecordsList[i];if(!recordsToReplaceSet.has(otherRecord)){recordsToUnlink.push(otherRecord);}
if(recordsToReplaceList[i]!==otherRecord){hasToReorder=true;}}
if(this._setRelationUnlinkX2Many(record,recordsToUnlink,options)){hasChanged=true;}
if(hasToReorder){otherRecordsSet.clear();for(const record of recordsToReplaceList){otherRecordsSet.add(record);}
hasChanged=true;}
return hasChanged;}
_setRelationUnlink(record,newValue,options){switch(this.relationType){case'many2many':case'one2many':return this._setRelationUnlinkX2Many(record,newValue,options);case'many2one':case'one2one':return this._setRelationUnlinkX2One(record,options);}}
_setRelationUnlinkX2Many(record,newValue,{hasToUpdateInverse=true}={}){const recordsToUnlink=this._convertX2ManyValue(newValue,{hasToVerify:false});const otherRecords=this.read(record);let hasChanged=false;for(const recordToUnlink of recordsToUnlink){const wasLinked=otherRecords.delete(recordToUnlink);if(!wasLinked){continue;}
hasChanged=true;if(hasToUpdateInverse){if(!recordToUnlink.exists()){continue;}
this.env.modelManager._update(recordToUnlink,{[this.inverse]:[['unlink',record]]},{hasToUpdateInverse:false});if(this.isCausal){this.env.modelManager._delete(recordToUnlink);}}}
return hasChanged;}
_setRelationUnlinkX2One(record,{hasToUpdateInverse=true}={}){const otherRecord=this.read(record);if(!otherRecord){return false;}
record.__values[this.fieldName]=undefined;if(hasToUpdateInverse){if(!otherRecord.exists()){return;}
this.env.modelManager._update(otherRecord,{[this.inverse]:[['unlink',record]]},{hasToUpdateInverse:false});if(this.isCausal){this.env.modelManager._delete(otherRecord);}}
return true;}
_verifyRelationalValue(record){const OtherModel=this.env.models[this.to];if(!OtherModel.get(record.localId,{isCheckingInheritance:true})){throw Error(`Record ${record.localId} is not valid for relational field ${this.fieldName}.`);}}}
return ModelField;});;

/* /mail/static/src/model/model_field_command.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/model/model_field_command.js',function(require){'use strict';class FieldCommand{constructor(func){this.func=func;}
execute(field,record,options){return this.func(field,record,options);}}
function clear(){return new FieldCommand((field,record,options)=>field.clear(record,options));}
return{FieldCommand,clear,};});;

/* /mail/static/src/model/model_manager.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/model/model_manager.js',function(require){'use strict';const{registry}=require('mail/static/src/model/model_core.js');const ModelField=require('mail/static/src/model/model_field.js');const{patchClassMethods,patchInstanceMethods}=require('mail/static/src/utils/utils.js');const DEPENDENT_INNER_SEPARATOR="--//--//--";class ModelManager{constructor(env){this.DEPENDENT_INNER_SEPARATOR=DEPENDENT_INNER_SEPARATOR;this.env=env;this._createdRecords=new Set();this._hasAnyChangeDuringCycle=false;this._updatedRecords=new Set();this._toComputeFields=new Map();this._toUpdateAfters=new Map();}
start(){Object.assign(this.env.models,this._generateModels());}
all(Model,filterFunc){const allRecords=Object.values(Model.__records);if(filterFunc){return allRecords.filter(filterFunc);}
return allRecords;}
create(Model,data={}){const res=this._create(Model,data);this._flushUpdateCycle();return res;}
delete(record){this._delete(record);this._flushUpdateCycle();}
deleteAll(){for(const Model of Object.values(this.env.models)){for(const record of Object.values(Model.__records)){this._delete(record);}}
this._flushUpdateCycle();}
exists(Model,record){return Model.__records[record.localId]?true:false;}
find(Model,findFunc){return this.all(Model).find(findFunc);}
findFromIdentifyingData(Model,data){const localId=Model._createRecordLocalId(data);return Model.get(localId);}
get(Model,localId,{isCheckingInheritance=false}={}){if(!localId){return;}
const record=Model.__records[localId];if(record){return record;}
if(!isCheckingInheritance){return;}
for(const SubModel of Object.values(this.env.models)){if(!(SubModel.prototype instanceof Model)){continue;}
const record=SubModel.__records[localId];if(record){return record;}}
return;}
insert(Model,data){const res=this._insert(Model,data);this._flushUpdateCycle();return res;}
update(record,data){const res=this._update(record,data);this._flushUpdateCycle();return res;}
_applyModelPatchFields(Model,patch){for(const[fieldName,field]of Object.entries(patch)){if(!Model.fields[fieldName]){Model.fields[fieldName]=field;}else{Object.assign(Model.fields[fieldName].dependencies,field.dependencies);}}}
_checkDeclaredFieldsOnModels(Models){for(const Model of Object.values(Models)){for(const fieldName in Model.fields){const field=Model.fields[fieldName];const parentedMatchingFields=[];let TargetModel=Model.__proto__;while(Models[TargetModel.modelName]){if(TargetModel.fields){const matchingField=TargetModel.fields[fieldName];if(matchingField){parentedMatchingFields.push(matchingField);}}
TargetModel=TargetModel.__proto__;}
if(!(['attribute','relation'].includes(field.fieldType))){throw new Error(`Field "${Model.modelName}/${fieldName}" has unsupported type ${field.fieldType}.`);}
if(field.fieldType==='attribute'){const invalidKeys=Object.keys(field).filter(key=>!['compute','default','dependencies','fieldType','related',].includes(key));if(invalidKeys.length>0){throw new Error(`Field "${Model.modelName}/${fieldName}" contains some invalid keys: "${invalidKeys.join(", ")}".`);}}
if(field.fieldType==='relation'){const invalidKeys=Object.keys(field).filter(key=>!['compute','default','dependencies','fieldType','inverse','isCausal','related','relationType','to',].includes(key));if(invalidKeys.length>0){throw new Error(`Field "${Model.modelName}/${fieldName}" contains some invalid keys: "${invalidKeys.join(", ")}".`);}
if(!Models[field.to]){throw new Error(`Relational field "${Model.modelName}/${fieldName}" targets to unknown model name "${field.to}".`);}
if(field.isCausal&&!(['one2many','one2one'].includes(field.relationType))){throw new Error(`Relational field "${Model.modelName}/${fieldName}" has "isCausal" true with a relation of type "${field.relationType}" but "isCausal" is only supported for "one2many" and "one2one".`);}}
if(field.compute&&!(typeof field.compute==='string')){throw new Error(`Field "${Model.modelName}/${fieldName}" property "compute" must be a string (instance method name).`);}
if(field.compute&&!(Model.prototype[field.compute])){throw new Error(`Field "${Model.modelName}/${fieldName}" property "compute" does not refer to an instance method of this Model.`);}
if(field.dependencies&&(!field.compute&&!parentedMatchingFields.some(field=>field.compute))){throw new Error(`Field "${Model.modelName}/${fieldName} contains dependendencies but no compute method in itself or parented matching fields (dependencies only make sense for compute fields)."`);}
if((field.compute||parentedMatchingFields.some(field=>field.compute))&&(field.dependencies||parentedMatchingFields.some(field=>field.dependencies))){if(!(field.dependencies instanceof Array)){throw new Error(`Compute field "${Model.modelName}/${fieldName}" dependencies must be an array of field names.`);}
const unknownDependencies=field.dependencies.every(dependency=>!(Model.fields[dependency]));if(unknownDependencies.length>0){throw new Error(`Compute field "${Model.modelName}/${fieldName}" contains some unknown dependencies: "${unknownDependencies.join(", ")}".`);}}
if(field.compute&&field.related){throw new Error(`Field "${Model.modelName}/${fieldName}" cannot be a related and compute field at the same time.`);}
if(field.related){if(!(typeof field.related==='string')){throw new Error(`Field "${Model.modelName}/${fieldName}" property "related" has invalid format.`);}
const[relationName,relatedFieldName,other]=field.related.split('.');if(!relationName||!relatedFieldName||other){throw new Error(`Field "${Model.modelName}/${fieldName}" property "related" has invalid format.`);}
let relatedRelation;let TargetModel=Model;while(Models[TargetModel.modelName]&&!relatedRelation){if(TargetModel.fields){relatedRelation=TargetModel.fields[relationName];}
TargetModel=TargetModel.__proto__;}
if(!relatedRelation){throw new Error(`Related field "${Model.modelName}/${fieldName}" relates to unknown relation name "${relationName}".`);}
if(relatedRelation.fieldType!=='relation'){throw new Error(`Related field "${Model.modelName}/${fieldName}" relates to non-relational field "${relationName}".`);}
const RelatedModel=Models[relatedRelation.to];let relatedField;TargetModel=RelatedModel;while(Models[TargetModel.modelName]&&!relatedField){if(TargetModel.fields){relatedField=TargetModel.fields[relatedFieldName];}
TargetModel=TargetModel.__proto__;}
if(!relatedField){throw new Error(`Related field "${Model.modelName}/${fieldName}" relates to unknown related model field "${relatedFieldName}".`);}
if(relatedField.fieldType!==field.fieldType){throw new Error(`Related field "${Model.modelName}/${fieldName}" has mismatch type with its related model field.`);}
if(relatedField.fieldType==='relation'&&relatedField.to!==field.to){throw new Error(`Related field "${Model.modelName}/${fieldName}" has mismatch target model name with its related model field.`);}}}}}
_checkProcessedFieldsOnModels(Models){for(const Model of Object.values(Models)){for(const fieldName in Model.fields){const field=Model.fields[fieldName];if(!(['attribute','relation'].includes(field.fieldType))){throw new Error(`Field "${Model.modelName}/${fieldName}" has unsupported type ${field.fieldType}.`);}
if(field.compute&&field.related){throw new Error(`Field "${Model.modelName}/${fieldName}" cannot be a related and compute field at the same time.`);}
if(field.fieldType==='attribute'){continue;}
if(!field.relationType){throw new Error(`Field "${Model.modelName}/${fieldName}" must define a relation type in "relationType".`);}
if(!(['one2one','one2many','many2one','many2many'].includes(field.relationType))){throw new Error(`Field "${Model.modelName}/${fieldName}" has invalid relation type "${field.relationType}".`);}
if(!field.inverse){throw new Error(`Field "${
                            Model.modelName
                        }/${
                            fieldName
                        }" must define an inverse relation name in "inverse".`);}
if(!field.to){throw new Error(`Relation "${
                            Model.modelNames
                        }/${
                            fieldName
                        }" must define a model name in "to" (1st positional parameter of relation field helpers).`);}
const RelatedModel=Models[field.to];if(!RelatedModel){throw new Error(`Model name of relation "${Model.modelName}/${fieldName}" does not exist.`);}
const inverseField=RelatedModel.fields[field.inverse];if(!inverseField){throw new Error(`Relation "${
                            Model.modelName
                        }/${
                            fieldName
                        }" has no inverse field "${RelatedModel.modelName}/${field.inverse}".`);}
if(inverseField.inverse!==fieldName){throw new Error(`Inverse field name of relation "${
                            Model.modelName
                        }/${
                            fieldName
                        }" does not match with field name of relation "${
                            RelatedModel.modelName
                        }/${
                            inverseField.inverse
                        }".`);}
const allSelfAndParentNames=[];let TargetModel=Model;while(TargetModel){allSelfAndParentNames.push(TargetModel.modelName);TargetModel=TargetModel.__proto__;}
if(!allSelfAndParentNames.includes(inverseField.to)){throw new Error(`Relation "${
                            Model.modelName
                        }/${
                            fieldName
                        }" has inverse relation "${
                            RelatedModel.modelName
                        }/${
                            field.inverse
                        }" misconfigured (currently "${
                            inverseField.to
                        }", should instead refer to this model or parented models: ${
                            allSelfAndParentNames.map(name => `"${name}"`).join(', ')
                        }?)`);}
if((field.relationType==='many2many'&&inverseField.relationType!=='many2many')||(field.relationType==='one2one'&&inverseField.relationType!=='one2one')||(field.relationType==='one2many'&&inverseField.relationType!=='many2one')||(field.relationType==='many2one'&&inverseField.relationType!=='one2many')){throw new Error(`Mismatch relations types "${
                            Model.modelName
                        }/${
                            fieldName
                        }" (${
                            field.relationType
                        }) and "${
                            RelatedModel.modelName
                        }/${
                            field.inverse
                        }" (${
                            inverseField.relationType
                        }).`);}}}}
_create(Model,data={}){const isMulti=typeof data[Symbol.iterator]==='function';const dataList=isMulti?data:[data];const records=[];for(const data of dataList){const localId=Model._createRecordLocalId(data);if(Model.get(localId)){throw Error(`A record already exists for model "${Model.modelName}" with localId "${localId}".`);}
const record=new Model({valid:true});Object.assign(record,{env:this.env,localId,__values:{},__state:0,});for(const field of Model.__fieldList){if(field.fieldType==='relation'){if(['one2many','many2many'].includes(field.relationType)){record.__values[field.fieldName]=new Set();}}}
Model.__records[record.localId]=record;record._willCreate();const data2={};for(const field of Model.__fieldList){if(data[field.fieldName]!==undefined){data2[field.fieldName]=data[field.fieldName];}else{data2[field.fieldName]=field.default;}
if(field.compute||field.related){this._registerToComputeField(record,field);}}
this._update(record,data2);this._createdRecords.add(record);this._hasAnyChangeDuringCycle=true;records.push(record);}
return isMulti?records:records[0];}
_delete(record){const Model=record.constructor;if(!record.exists()){throw Error(`Cannot delete already deleted record ${record.localId}.`);}
record._willDelete();for(const field of Model.__fieldList){if(field.fieldType==='relation'){field.parseAndExecuteCommands(record,[['unlink-all']]);}}
this._hasAnyChangeDuringCycle=true;this._toComputeFields.delete(record);this._toUpdateAfters.delete(record);delete Model.__records[record.localId];}
_flushUpdateCycle(func){while(this._toComputeFields.size>0){for(const[record,fields]of this._toComputeFields){this._toComputeFields.delete(record);if(!record.exists()){throw Error(`Cannot execute computes for already deleted record ${record.localId}.`);}
while(fields.size>0){for(const field of fields){fields.delete(field);if(field.compute){this._update(record,{[field.fieldName]:record[field.compute]()});continue;}
if(field.related){this._update(record,{[field.fieldName]:field.computeRelated(record)});continue;}
throw new Error("No compute method defined on this field definition");}}}}
while(this._toUpdateAfters.size>0){for(const[record,previous]of this._toUpdateAfters){this._toUpdateAfters.delete(record);if(!record.exists()){throw Error(`Cannot _updateAfter for already deleted record ${record.localId}.`);}
record._updateAfter(previous);}}
while(this._createdRecords.size>0){for(const record of this._createdRecords){this._createdRecords.delete(record);if(!record.exists()){throw Error(`Cannot call _created for already deleted record ${record.localId}.`);}
record._created();}}
for(const record of this._updatedRecords){record.__state++;}
this._updatedRecords.clear();if(this._hasAnyChangeDuringCycle){this.env.store.state.messagingRevNumber++;this._hasAnyChangeDuringCycle=false;}}
_generateModels(){const allNames=Object.keys(registry);const Models={};const generatedNames=[];let toGenerateNames=[...allNames];while(toGenerateNames.length>0){const generatable=toGenerateNames.map(name=>registry[name]).find(entry=>{let isGenerateable=true;for(const dependencyName of entry.dependencies){if(!generatedNames.includes(dependencyName)){isGenerateable=false;}}
return isGenerateable;});if(!generatable){throw new Error(`Cannot generate following Model: ${toGenerateNames.join(', ')}`);}
const Model=generatable.factory(Models);Model.env=this.env;Model.__records={};for(const patch of generatable.patches){switch(patch.type){case'class':patchClassMethods(Model,patch.name,patch.patch);break;case'instance':patchInstanceMethods(Model,patch.name,patch.patch);break;case'field':this._applyModelPatchFields(Model,patch.patch);break;}}
if(!Object.prototype.hasOwnProperty.call(Model,'modelName')){throw new Error(`Missing static property "modelName" on Model class "${Model.name}".`);}
if(generatedNames.includes(Model.modelName)){throw new Error(`Duplicate model name "${Model.modelName}" shared on 2 distinct Model classes.`);}
Models[Model.modelName]=Model;generatedNames.push(Model.modelName);toGenerateNames=toGenerateNames.filter(name=>name!==Model.modelName);}
this._checkDeclaredFieldsOnModels(Models);this._processDeclaredFieldsOnModels(Models);this._checkProcessedFieldsOnModels(Models);return Models;}
_insert(Model,data){const isMulti=typeof data[Symbol.iterator]==='function';const dataList=isMulti?data:[data];const records=[];for(const data of dataList){let record=Model.findFromIdentifyingData(data);if(!record){record=this._create(Model,data);}else{this._update(record,data);}
records.push(record);}
return isMulti?records:records[0];}
_makeInverseRelationField(Model,field){const relFunc=field.relationType==='many2many'?ModelField.many2many:field.relationType==='many2one'?ModelField.one2many:field.relationType==='one2many'?ModelField.many2one:field.relationType==='one2one'?ModelField.one2one:undefined;if(!relFunc){throw new Error(`Cannot compute inverse Relation of "${Model.modelName}/${field.fieldName}".`);}
const inverseField=new ModelField(Object.assign({},relFunc(Model.modelName,{inverse:field.fieldName}),{env:this.env,fieldName:`_inverse_${Model.modelName}/${field.fieldName}`,modelManager:this,}));return inverseField;}
_processDeclaredFieldsOnModels(Models){for(const Model of Object.values(Models)){if(!Object.prototype.hasOwnProperty.call(Model,'fields')){Model.fields={};}
Model.inverseRelations=[];for(const[fieldName,fieldData]of Object.entries(Model.fields)){Model.fields[fieldName]=new ModelField(Object.assign({},fieldData,{env:this.env,fieldName,modelManager:this,}));}}
for(const Model of Object.values(Models)){for(const field of Object.values(Model.fields)){if(field.fieldType!=='relation'){continue;}
if(field.inverse){continue;}
const RelatedModel=Models[field.to];const inverseField=this._makeInverseRelationField(Model,field);field.inverse=inverseField.fieldName;RelatedModel.fields[inverseField.fieldName]=inverseField;}}
for(const Model of Object.values(Models)){for(const field of Object.values(Model.fields)){for(const dependencyFieldName of field.dependencies){let TargetModel=Model;let dependencyField=TargetModel.fields[dependencyFieldName];while(!dependencyField){TargetModel=TargetModel.__proto__;dependencyField=TargetModel.fields[dependencyFieldName];}
const dependent=[field.id,field.fieldName].join(DEPENDENT_INNER_SEPARATOR);dependencyField.dependents=[...new Set(dependencyField.dependents.concat([dependent]))];}
if(field.related){const[relationName,relatedFieldName]=field.related.split('.');let TargetModel=Model;let relationField=TargetModel.fields[relationName];while(!relationField){TargetModel=TargetModel.__proto__;relationField=TargetModel.fields[relationName];}
const relationFieldDependent=[field.id,field.fieldName,].join(DEPENDENT_INNER_SEPARATOR);relationField.dependents=[...new Set(relationField.dependents.concat([relationFieldDependent]))];const OtherModel=Models[relationField.to];let OtherTargetModel=OtherModel;let relatedField=OtherTargetModel.fields[relatedFieldName];while(!relatedField){OtherTargetModel=OtherTargetModel.__proto__;relatedField=OtherTargetModel.fields[relatedFieldName];}
const relatedFieldDependent=[field.id,relationField.inverse,field.fieldName,].join(DEPENDENT_INNER_SEPARATOR);relatedField.dependents=[...new Set(relatedField.dependents.concat([relatedFieldDependent]))];}}}
for(const Model of Object.values(Models)){Model.__combinedFields={};for(const field of Object.values(Model.fields)){Model.__combinedFields[field.fieldName]=field;}
let TargetModel=Model.__proto__;while(TargetModel&&TargetModel.fields){for(const targetField of Object.values(TargetModel.fields)){const field=Model.__combinedFields[targetField.fieldName];if(field){Model.__combinedFields[targetField.fieldName]=field.combine(targetField);}else{Model.__combinedFields[targetField.fieldName]=targetField;}}
TargetModel=TargetModel.__proto__;}}
for(const Model of Object.values(Models)){Model.__fieldMap=Model.__combinedFields;Model.__fieldList=Object.values(Model.__fieldMap);for(const field of Model.__fieldList){Object.defineProperty(Model.prototype,field.fieldName,{get(){return field.get(this);},});}
delete Model.__combinedFields;}}
_registerComputeOfDependents(record,field){const Model=record.constructor;for(const dependent of field.dependents){const[hash,fieldName1,fieldName2]=dependent.split(this.DEPENDENT_INNER_SEPARATOR);const field1=Model.__fieldMap[fieldName1];if(fieldName2){if(['one2many','many2many'].includes(field1.relationType)){for(const otherRecord of record[fieldName1]){const OtherModel=otherRecord.constructor;const field2=OtherModel.__fieldMap[fieldName2];if(field2&&field2.hashes.includes(hash)){this._registerToComputeField(otherRecord,field2);}}}else{const otherRecord=record[fieldName1];if(!otherRecord){continue;}
const OtherModel=otherRecord.constructor;const field2=OtherModel.__fieldMap[fieldName2];if(field2&&field2.hashes.includes(hash)){this._registerToComputeField(otherRecord,field2);}}}else{if(field1&&field1.hashes.includes(hash)){this._registerToComputeField(record,field1);}}}}
_registerToComputeField(record,field){if(!this._toComputeFields.has(record)){this._toComputeFields.set(record,new Set());}
this._toComputeFields.get(record).add(field);}
_update(record,data,options){if(!record.exists()){throw Error(`Cannot update already deleted record ${record.localId}.`);}
if(!this._toUpdateAfters.has(record)){this._toUpdateAfters.set(record,record._updateBefore());}
const Model=record.constructor;let hasChanged=false;for(const fieldName of Object.keys(data)){if(data[fieldName]===undefined){continue;}
const field=Model.__fieldMap[fieldName];if(!field){throw new Error(`Cannot create/update record with data unrelated to a field. (model: "${Model.modelName}", non-field attempted update: "${fieldName}")`);}
const newVal=data[fieldName];if(!field.parseAndExecuteCommands(record,newVal,options)){continue;}
hasChanged=true;this._registerComputeOfDependents(record,field);}
if(hasChanged){this._updatedRecords.add(record);this._hasAnyChangeDuringCycle=true;}
return hasChanged;}}
return ModelManager;});;

/* /mail/static/src/models/activity/activity.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/activity/activity/js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{attr,many2many,many2one}=require('mail/static/src/model/model_field.js');const{clear}=require('mail/static/src/model/model_field_command.js');function factory(dependencies){class Activity extends dependencies['mail.model']{async deleteServerRecord(){await this.async(()=>this.env.services.rpc({model:'mail.activity',method:'unlink',args:[[this.id]],}));this.delete();}
static convertData(data){const data2={};if('activity_category'in data){data2.category=data.activity_category;}
if('can_write'in data){data2.canWrite=data.can_write;}
if('create_data'in data){data2.dateCreate=data.create_date;}
if('date_deadline'in data){data2.dateDeadline=data.date_deadline;}
if('force_next'in data){data2.force_next=data.force_next;}
if('icon'in data){data2.icon=data.icon;}
if('id'in data){data2.id=data.id;}
if('note'in data){data2.note=data.note;}
if('state'in data){data2.state=data.state;}
if('summary'in data){data2.summary=data.summary;}
if('activity_type_id'in data){if(!data.activity_type_id){data2.type=[['unlink-all']];}else{data2.type=[['insert',{displayName:data.activity_type_id[1],id:data.activity_type_id[0],}],];}}
if('create_uid'in data){if(!data.create_uid){data2.creator=[['unlink-all']];}else{data2.creator=[['insert',{id:data.create_uid[0],display_name:data.create_uid[1],}],];}}
if('mail_template_ids'in data){data2.mailTemplates=[['insert',data.mail_template_ids]];}
if('res_id'in data&&'res_model'in data){data2.thread=[['insert',{id:data.res_id,model:data.res_model,}]];}
if('user_id'in data){if(!data.user_id){data2.assignee=[['unlink-all']];}else{data2.assignee=[['insert',{id:data.user_id[0],display_name:data.user_id[1],}],];}}
if('request_partner_id'in data){if(!data.request_partner_id){data2.requestingPartner=[['unlink']];}else{data2.requestingPartner=[['insert',{id:data.request_partner_id[0],display_name:data.request_partner_id[1],}],];}}
return data2;}
edit(){const action={type:'ir.actions.act_window',name:this.env._t("Schedule Activity"),res_model:'mail.activity',view_mode:'form',views:[[false,'form']],target:'new',context:{default_res_id:this.thread.id,default_res_model:this.thread.model,},res_id:this.id,};this.env.bus.trigger('do-action',{action,options:{on_close:()=>this.fetchAndUpdate()},});}
async fetchAndUpdate(){const[data]=await this.async(()=>this.env.services.rpc({model:'mail.activity',method:'activity_format',args:[this.id],},{shadow:true}));if(data){this.update(this.constructor.convertData(data));this.thread.refresh();}else{this.thread.refresh();this.delete();}}
async markAsDone({attachments=[],feedback=false}){const attachmentIds=attachments.map(attachment=>attachment.id);await this.async(()=>this.env.services.rpc({model:'mail.activity',method:'action_feedback',args:[[this.id]],kwargs:{attachment_ids:attachmentIds,feedback,},}));this.thread.refresh();this.delete();}
async markAsDoneAndScheduleNext({feedback}){const action=await this.async(()=>this.env.services.rpc({model:'mail.activity',method:'action_feedback_schedule_next',args:[[this.id]],kwargs:{feedback},}));this.thread.refresh();const thread=this.thread;this.delete();if(!action){thread.refreshActivities();return;}
this.env.bus.trigger('do-action',{action,options:{on_close:()=>{thread.refreshActivities();},},});}
static _createRecordLocalId(data){return`${this.modelName}_${data.id}`;}
_computeIsCurrentPartnerAssignee(){if(!this.assigneePartner||!this.messagingCurrentPartner){return false;}
return this.assigneePartner===this.messagingCurrentPartner;}
_computeMessaging(){return[['link',this.env.messaging]];}
_computeNote(){if(this.note==='<p><br></p>'){return clear();}
return this.note;}}
Activity.fields={assignee:many2one('mail.user'),assigneePartner:many2one('mail.partner',{related:'assignee.partner',}),attachments:many2many('mail.attachment',{inverse:'activities',}),canWrite:attr({default:false,}),category:attr(),creator:many2one('mail.user'),dateCreate:attr(),dateDeadline:attr(),force_next:attr({default:false,}),icon:attr(),id:attr(),isCurrentPartnerAssignee:attr({compute:'_computeIsCurrentPartnerAssignee',default:false,dependencies:['assigneePartner','messagingCurrentPartner',],}),mailTemplates:many2many('mail.mail_template',{inverse:'activities',}),messaging:many2one('mail.messaging',{compute:'_computeMessaging',}),messagingCurrentPartner:many2one('mail.partner',{related:'messaging.currentPartner',}),note:attr({compute:'_computeNote',dependencies:['note',],}),requestingPartner:many2one('mail.partner'),state:attr(),summary:attr(),thread:many2one('mail.thread',{inverse:'activities',}),type:many2one('mail.activity_type',{inverse:'activities',}),};Activity.modelName='mail.activity';return Activity;}
registerNewModel('mail.activity',factory);});;

/* /mail/static/src/models/activity_type/activity_type.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/activity_type/activity_type.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{attr,one2many}=require('mail/static/src/model/model_field.js');function factory(dependencies){class ActivityType extends dependencies['mail.model']{static _createRecordLocalId(data){return`${this.modelName}_${data.id}`;}}
ActivityType.fields={activities:one2many('mail.activity',{inverse:'type',}),displayName:attr(),id:attr(),};ActivityType.modelName='mail.activity_type';return ActivityType;}
registerNewModel('mail.activity_type',factory);});;

/* /mail/static/src/models/attachment/attachment.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/attachment/attachment.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{attr,many2many,many2one}=require('mail/static/src/model/model_field.js');const{clear}=require('mail/static/src/model/model_field_command.js');function factory(dependencies){let nextTemporaryId=-1;function getAttachmentNextTemporaryId(){const id=nextTemporaryId;nextTemporaryId-=1;return id;}
class Attachment extends dependencies['mail.model']{static convertData(data){const data2={};if('filename'in data){data2.filename=data.filename;}
if('id'in data){data2.id=data.id;}
if('mimetype'in data){data2.mimetype=data.mimetype;}
if('name'in data){data2.name=data.name;}
if('res_id'in data&&'res_model'in data){data2.originThread=[['insert',{id:data.res_id,model:data.res_model,}]];}
return data2;}
static create(data){const isMulti=typeof data[Symbol.iterator]==='function';const dataList=isMulti?data:[data];for(const data of dataList){if(!data.id){data.id=getAttachmentNextTemporaryId();}}
return super.create(...arguments);}
static view({attachment,attachments}){const hasOtherAttachments=attachments&&attachments.length>0;if(!attachment&&!hasOtherAttachments){return;}
if(!attachment&&hasOtherAttachments){attachment=attachments[0];}else if(attachment&&!hasOtherAttachments){attachments=[attachment];}
if(!attachments.includes(attachment)){return;}
this.env.messaging.dialogManager.open('mail.attachment_viewer',{attachment:[['link',attachment]],attachments:[['replace',attachments]],});}
async remove(){if(!this.isTemporary){await this.async(()=>this.env.services.rpc({model:'ir.attachment',method:'unlink',args:[this.id],},{shadow:true}));}else if(this.uploadingAbortController){this.uploadingAbortController.abort();}
this.delete();}
static _createRecordLocalId(data){return`${this.modelName}_${data.id}`;}
_computeComposers(){if(this.isTemporary){return[];}
const relatedTemporaryAttachment=this.env.models['mail.attachment'].find(attachment=>attachment.filename===this.filename&&attachment.isTemporary);if(relatedTemporaryAttachment){const composers=relatedTemporaryAttachment.composers;relatedTemporaryAttachment.delete();return[['replace',composers]];}
return[];}
_computeDefaultSource(){if(this.fileType==='image'){return`/web/image/${this.id}?unique=1&amp;signature=${this.checksum}&amp;model=ir.attachment`;}
if(this.fileType==='application/pdf'){return`/web/static/lib/pdfjs/web/viewer.html?file=/web/content/${this.id}?model%3Dir.attachment`;}
if(this.fileType&&this.fileType.includes('text')){return`/web/content/${this.id}?model%3Dir.attachment`;}
if(this.fileType==='youtu'){const urlArr=this.url.split('/');let token=urlArr[urlArr.length-1];if(token.includes('watch')){token=token.split('v=')[1];const amp=token.indexOf('&');if(amp!==-1){token=token.substring(0,amp);}}
return`https://www.youtube.com/embed/${token}`;}
if(this.fileType==='video'){return`/web/image/${this.id}?model=ir.attachment`;}
return clear();}
_computeDisplayName(){const displayName=this.name||this.filename;if(displayName){return displayName;}
return clear();}
_computeExtension(){const extension=this.filename&&this.filename.split('.').pop();if(extension){return extension;}
return clear();}
_computeFileType(){if(this.type==='url'&&!this.url){return clear();}else if(!this.mimetype){return clear();}
const match=this.type==='url'?this.url.match('(youtu|.png|.jpg|.gif)'):this.mimetype.match('(image|video|application/pdf|text)');if(!match){return clear();}
if(match[1].match('(.png|.jpg|.gif)')){return'image';}
return match[1];}
_computeIsLinkedToComposer(){return this.composers.length>0;}
_computeIsTextFile(){if(!this.fileType){return false;}
return this.fileType.includes('text');}
_computeIsViewable(){return(this.mediaType==='image'||this.mediaType==='video'||this.mimetype==='application/pdf'||this.isTextFile);}
_computeMediaType(){return this.mimetype&&this.mimetype.split('/').shift();}
_computeUploadingAbortController(){if(this.isTemporary){if(!this.uploadingAbortController){const abortController=new AbortController();abortController.signal.onabort=()=>{this.env.messagingBus.trigger('o-attachment-upload-abort',{attachment:this});};return abortController;}
return this.uploadingAbortController;}
return undefined;}}
Attachment.fields={activities:many2many('mail.activity',{inverse:'attachments',}),attachmentViewer:many2many('mail.attachment_viewer',{inverse:'attachments',}),checkSum:attr(),composers:many2many('mail.composer',{compute:'_computeComposers',inverse:'attachments',}),defaultSource:attr({compute:'_computeDefaultSource',dependencies:['checkSum','fileType','id','url',],}),displayName:attr({compute:'_computeDisplayName',dependencies:['filename','name',],}),extension:attr({compute:'_computeExtension',dependencies:['filename'],}),filename:attr(),fileType:attr({compute:'_computeFileType',dependencies:['mimetype','type','url',],}),id:attr(),isLinkedToComposer:attr({compute:'_computeIsLinkedToComposer',dependencies:['composers'],}),isTemporary:attr({default:false,}),isTextFile:attr({compute:'_computeIsTextFile',dependencies:['fileType'],}),isViewable:attr({compute:'_computeIsViewable',dependencies:['mediaType','isTextFile','mimetype',],}),mediaType:attr({compute:'_computeMediaType',dependencies:['mimetype'],}),messages:many2many('mail.message',{inverse:'attachments',}),mimetype:attr({default:'',}),name:attr(),originThread:many2one('mail.thread',{inverse:'originThreadAttachments',}),size:attr(),threads:many2many('mail.thread',{inverse:'attachments',}),type:attr(),uploadingAbortController:attr({compute:'_computeUploadingAbortController',dependencies:['isTemporary','uploadingAbortController',],}),url:attr(),};Attachment.modelName='mail.attachment';return Attachment;}
registerNewModel('mail.attachment',factory);});;

/* /mail/static/src/models/attachment_viewer/attachment_viewer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/attachment_viewer/attachment_viewer.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{attr,many2many,many2one}=require('mail/static/src/model/model_field.js');function factory(dependencies){class AttachmentViewer extends dependencies['mail.model']{close(){const dialog=this.env.models['mail.dialog'].find(dialog=>dialog.record===this);if(dialog){dialog.delete();}}}
AttachmentViewer.fields={angle:attr({default:0,}),attachment:many2one('mail.attachment'),attachments:many2many('mail.attachment',{inverse:'attachmentViewer',}),isImageLoading:attr({default:false,}),scale:attr({default:1,}),};AttachmentViewer.modelName='mail.attachment_viewer';return AttachmentViewer;}
registerNewModel('mail.attachment_viewer',factory);});;

/* /mail/static/src/models/canned_response/canned_response.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/canned_response/canned_response.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{attr}=require('mail/static/src/model/model_field.js');function factory(dependencies){class CannedResponse extends dependencies['mail.model']{}
CannedResponse.fields={id:attr(),source:attr(),substitution:attr(),};CannedResponse.modelName='mail.canned_response';return CannedResponse;}
registerNewModel('mail.canned_response',factory);});;

/* /mail/static/src/models/channel_command/channel_command.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/channel_command/channel_command.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{attr}=require('mail/static/src/model/model_field.js');function factory(dependencies){class ChannelCommand extends dependencies['mail.model']{}
ChannelCommand.fields={channel_types:attr(),help:attr(),name:attr(),};ChannelCommand.modelName='mail.channel_command';return ChannelCommand;}
registerNewModel('mail.channel_command',factory);});;

/* /mail/static/src/models/chat_window/chat_window.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/chat_window/chat_window.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{attr,many2one,one2many,one2one}=require('mail/static/src/model/model_field.js');const{clear}=require('mail/static/src/model/model_field_command.js');function factory(dependencies){class ChatWindow extends dependencies['mail.model']{_created(){const res=super._created(...arguments);this._onShowHomeMenu.bind(this);this._onHideHomeMenu.bind(this);this.env.messagingBus.on('hide_home_menu',this,this._onHideHomeMenu);this.env.messagingBus.on('show_home_menu',this,this._onShowHomeMenu);return res;}
_willDelete(){this.env.messagingBus.off('hide_home_menu',this,this._onHideHomeMenu);this.env.messagingBus.off('show_home_menu',this,this._onShowHomeMenu);return super._willDelete(...arguments);}
close({notifyServer=true}={}){const thread=this.thread;this.delete();if(thread&&notifyServer){thread.notifyFoldStateToServer('closed');}}
expand(){if(this.thread){this.thread.open({expanded:true});}}
focus(){this.update({isDoFocus:true});}
focusNextVisibleUnfoldedChatWindow(){const nextVisibleUnfoldedChatWindow=this._getNextVisibleUnfoldedChatWindow();if(nextVisibleUnfoldedChatWindow){nextVisibleUnfoldedChatWindow.focus();}}
focusPreviousVisibleUnfoldedChatWindow(){const previousVisibleUnfoldedChatWindow=this._getNextVisibleUnfoldedChatWindow({reverse:true});if(previousVisibleUnfoldedChatWindow){previousVisibleUnfoldedChatWindow.focus();}}
fold({notifyServer=true}={}){this.update({isFolded:true});if(this.thread&&notifyServer){this.thread.notifyFoldStateToServer('folded');}}
makeActive(options){this.makeVisible();this.unfold(options);this.focus();}
makeVisible(){if(this.isVisible){return;}
const lastVisible=this.manager.lastVisible;this.manager.swap(this,lastVisible);}
shiftLeft(){this.manager.shiftLeft(this);}
shiftRight(){this.manager.shiftRight(this);}
unfold({notifyServer=true}={}){this.update({isFolded:false});if(this.thread&&notifyServer){this.thread.notifyFoldStateToServer('open');}}
_computeHasNewMessageForm(){return this.isVisible&&!this.isFolded&&!this.thread;}
_computeHasShiftLeft(){if(!this.manager){return false;}
const allVisible=this.manager.allOrderedVisible;const index=allVisible.findIndex(visible=>visible===this);if(index===-1){return false;}
return index<allVisible.length-1;}
_computeHasShiftRight(){if(!this.manager){return false;}
const index=this.manager.allOrderedVisible.findIndex(visible=>visible===this);if(index===-1){return false;}
return index>0;}
_computeHasThreadView(){return this.isVisible&&!this.isFolded&&this.thread;}
_computeIsFolded(){const thread=this.thread;if(thread){return thread.foldState==='folded';}
return this.isFolded;}
_computeIsVisible(){if(!this.manager){return false;}
return this.manager.allOrderedVisible.includes(this);}
_computeName(){if(this.thread){return this.thread.displayName;}
return this.env._t("New message");}
_computeVisibleIndex(){if(!this.manager){return clear();}
const visible=this.manager.visual.visible;const index=visible.findIndex(visible=>visible.chatWindowLocalId===this.localId);if(index===-1){return clear();}
return index;}
_computeVisibleOffset(){if(!this.manager){return 0;}
const visible=this.manager.visual.visible;const index=visible.findIndex(visible=>visible.chatWindowLocalId===this.localId);if(index===-1){return 0;}
return visible[index].offset;}
_getNextVisibleUnfoldedChatWindow({reverse=false}={}){const orderedVisible=this.manager.allOrderedVisible;const _getNextIndex=index=>{const directionOffset=reverse?1:-1;let nextIndex=index+directionOffset;if(nextIndex>orderedVisible.length-1){nextIndex=0;}
if(nextIndex<0){nextIndex=orderedVisible.length-1;}
return nextIndex;};const currentIndex=orderedVisible.findIndex(visible=>visible===this);let nextIndex=_getNextIndex(currentIndex);let nextToFocus=orderedVisible[nextIndex];while(nextToFocus.isFolded){nextIndex=_getNextIndex(nextIndex);nextToFocus=orderedVisible[nextIndex];}
return nextToFocus;}
async _onHideHomeMenu(){if(!this.threadView){return;}
this.threadView.addComponentHint('home-menu-hidden');}
async _onShowHomeMenu(){if(!this.threadView){return;}
this.threadView.addComponentHint('home-menu-shown');}}
ChatWindow.fields={hasNewMessageForm:attr({compute:'_computeHasNewMessageForm',dependencies:['isFolded','isVisible','thread',],}),hasShiftLeft:attr({compute:'_computeHasShiftLeft',dependencies:['managerAllOrderedVisible'],default:false,}),hasShiftRight:attr({compute:'_computeHasShiftRight',dependencies:['managerAllOrderedVisible'],default:false,}),hasThreadView:attr({compute:'_computeHasThreadView',dependencies:['isFolded','isVisible','thread',],}),isDoFocus:attr({default:false,}),isFocused:attr({default:false,}),isFolded:attr({default:false,}),isVisible:attr({compute:'_computeIsVisible',dependencies:['managerAllOrderedVisible',],}),manager:many2one('mail.chat_window_manager',{inverse:'chatWindows',}),managerAllOrderedVisible:one2many('mail.chat_window',{related:'manager.allOrderedVisible',}),managerVisual:attr({related:'manager.visual',}),name:attr({compute:'_computeName',dependencies:['thread','threadDisplayName',],}),thread:one2one('mail.thread',{inverse:'chatWindow',}),threadDisplayName:attr({related:'thread.displayName',}),threadView:one2one('mail.thread_view',{related:'threadViewer.threadView',}),threadViewer:one2one('mail.thread_viewer',{default:[['create']],inverse:'chatWindow',isCausal:true,}),visibleIndex:attr({compute:'_computeVisibleIndex',dependencies:['manager','managerVisual',],}),visibleOffset:attr({compute:'_computeVisibleOffset',dependencies:['managerVisual'],}),};ChatWindow.modelName='mail.chat_window';return ChatWindow;}
registerNewModel('mail.chat_window',factory);});;

/* /mail/static/src/models/chat_window_manager/chat_window_manager.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/chat_window_manager/chat_window_manager.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{attr,many2one,one2many,one2one}=require('mail/static/src/model/model_field.js');function factory(dependencies){const BASE_VISUAL={availableVisibleSlots:0,hidden:{chatWindowLocalIds:[],isVisible:false,offset:0,},visible:[],};class ChatWindowManager extends dependencies['mail.model']{closeAll(){const chatWindows=this.allOrdered;for(const chatWindow of chatWindows){chatWindow.close();}}
closeHiddenMenu(){this.update({isHiddenMenuOpen:false});}
closeThread(thread,options){for(const chatWindow of this.chatWindows){if(chatWindow.thread===thread){chatWindow.close(options);}}}
openHiddenMenu(){this.update({isHiddenMenuOpen:true});}
openNewMessage(){let newMessageChatWindow=this.newMessageChatWindow;if(!newMessageChatWindow){newMessageChatWindow=this.env.models['mail.chat_window'].create({manager:[['link',this]],});}
newMessageChatWindow.makeActive();}
openThread(thread,{isFolded=false,makeActive=false,notifyServer=true,replaceNewMessage=false}={}){let chatWindow=this.chatWindows.find(chatWindow=>chatWindow.thread===thread);if(!chatWindow){chatWindow=this.env.models['mail.chat_window'].create({isFolded,manager:[['link',this]],thread:[['link',thread]],});}else{chatWindow.update({isFolded});}
if(replaceNewMessage&&this.newMessageChatWindow){this.swap(chatWindow,this.newMessageChatWindow);this.newMessageChatWindow.close();}
if(makeActive){chatWindow.makeActive({notifyServer:false});}
if(notifyServer){const foldState=chatWindow.isFolded?'folded':'open';thread.notifyFoldStateToServer(foldState);}}
shiftLeft(chatWindow){const chatWindows=this.allOrdered;const index=chatWindows.findIndex(cw=>cw===chatWindow);if(index===chatWindows.length-1){return;}
const otherChatWindow=chatWindows[index+1];const _newOrdered=[...this._ordered];_newOrdered[index]=otherChatWindow.localId;_newOrdered[index+1]=chatWindow.localId;this.update({_ordered:_newOrdered});chatWindow.focus();}
shiftRight(chatWindow){const chatWindows=this.allOrdered;const index=chatWindows.findIndex(cw=>cw===chatWindow);if(index===0){return;}
const otherChatWindow=chatWindows[index-1];const _newOrdered=[...this._ordered];_newOrdered[index]=otherChatWindow.localId;_newOrdered[index-1]=chatWindow.localId;this.update({_ordered:_newOrdered});chatWindow.focus();}
swap(chatWindow1,chatWindow2){const ordered=this.allOrdered;const index1=ordered.findIndex(chatWindow=>chatWindow===chatWindow1);const index2=ordered.findIndex(chatWindow=>chatWindow===chatWindow2);if(index1===-1||index2===-1){return;}
const _newOrdered=[...this._ordered];_newOrdered[index1]=chatWindow2.localId;_newOrdered[index2]=chatWindow1.localId;this.update({_ordered:_newOrdered});}
_compute_ordered(){const _ordered=this._ordered.filter(chatWindowLocalId=>this.chatWindows.includes(this.env.models['mail.chat_window'].get(chatWindowLocalId)));for(const chatWindow of this.chatWindows){if(!_ordered.includes(chatWindow.localId)){_ordered.push(chatWindow.localId);}}
return _ordered;}
_computeAllOrdered(){return[['replace',this._ordered.map(chatWindowLocalId=>this.env.models['mail.chat_window'].get(chatWindowLocalId))]];}
_computeAllOrderedHidden(){return[['replace',this.visual.hidden.chatWindowLocalIds.map(chatWindowLocalId=>this.env.models['mail.chat_window'].get(chatWindowLocalId))]];}
_computeAllOrderedVisible(){return[['replace',this.visual.visible.map(({chatWindowLocalId})=>this.env.models['mail.chat_window'].get(chatWindowLocalId))]];}
_computeHasHiddenChatWindows(){return this.allOrderedHidden.length>0;}
_computeHasVisibleChatWindows(){return this.allOrderedVisible.length>0;}
_computeLastVisible(){const{length:l,[l-1]:lastVisible}=this.allOrderedVisible;if(!lastVisible){return[['unlink']];}
return[['link',lastVisible]];}
_computeNewMessageChatWindow(){const chatWindow=this.allOrdered.find(chatWindow=>!chatWindow.thread);if(!chatWindow){return[['unlink']];}
return[['link',chatWindow]];}
_computeUnreadHiddenConversationAmount(){const allHiddenWithThread=this.allOrderedHidden.filter(chatWindow=>chatWindow.thread);let amount=0;for(const chatWindow of allHiddenWithThread){if(chatWindow.thread.localMessageUnreadCounter>0){amount++;}}
return amount;}
_computeVisual(){let visual=JSON.parse(JSON.stringify(BASE_VISUAL));if(!this.env.messaging){return visual;}
const device=this.env.messaging.device;const discuss=this.env.messaging.discuss;const BETWEEN_GAP_WIDTH=5;const CHAT_WINDOW_WIDTH=325;const END_GAP_WIDTH=device.isMobile?0:10;const GLOBAL_WINDOW_WIDTH=device.globalWindowInnerWidth;const HIDDEN_MENU_WIDTH=200;const START_GAP_WIDTH=device.isMobile?0:10;const chatWindows=this.allOrdered;if(!device.isMobile&&discuss.isOpen){return visual;}
if(!chatWindows.length){return visual;}
const relativeGlobalWindowWidth=GLOBAL_WINDOW_WIDTH-START_GAP_WIDTH-END_GAP_WIDTH;let maxAmountWithoutHidden=Math.floor(relativeGlobalWindowWidth/(CHAT_WINDOW_WIDTH+BETWEEN_GAP_WIDTH));let maxAmountWithHidden=Math.floor((relativeGlobalWindowWidth-HIDDEN_MENU_WIDTH-BETWEEN_GAP_WIDTH)/(CHAT_WINDOW_WIDTH+BETWEEN_GAP_WIDTH));if(device.isMobile){maxAmountWithoutHidden=1;maxAmountWithHidden=1;}
if(chatWindows.length<=maxAmountWithoutHidden){for(let i=0;i<chatWindows.length;i++){const chatWindowLocalId=chatWindows[i].localId;const offset=START_GAP_WIDTH+i*(CHAT_WINDOW_WIDTH+BETWEEN_GAP_WIDTH);visual.visible.push({chatWindowLocalId,offset});}
visual.availableVisibleSlots=maxAmountWithoutHidden;}else if(maxAmountWithHidden>0){for(let i=0;i<maxAmountWithHidden;i++){const chatWindowLocalId=chatWindows[i].localId;const offset=START_GAP_WIDTH+i*(CHAT_WINDOW_WIDTH+BETWEEN_GAP_WIDTH);visual.visible.push({chatWindowLocalId,offset});}
if(chatWindows.length>maxAmountWithHidden){visual.hidden.isVisible=!device.isMobile;visual.hidden.offset=visual.visible[maxAmountWithHidden-1].offset
+CHAT_WINDOW_WIDTH+BETWEEN_GAP_WIDTH;}
for(let j=maxAmountWithHidden;j<chatWindows.length;j++){visual.hidden.chatWindowLocalIds.push(chatWindows[j].localId);}
visual.availableVisibleSlots=maxAmountWithHidden;}else{visual.hidden.isVisible=!device.isMobile;visual.hidden.offset=START_GAP_WIDTH;visual.hidden.chatWindowLocalIds.concat(chatWindows.map(chatWindow=>chatWindow.localId));console.warn('cannot display any visible chat windows (screen is too small)');visual.availableVisibleSlots=0;}
return visual;}}
ChatWindowManager.fields={_ordered:attr({compute:'_compute_ordered',default:[],dependencies:['chatWindows',],}),allOrdered:one2many('mail.chat_window',{compute:'_computeAllOrdered',dependencies:['_ordered',],}),allOrderedThread:one2many('mail.thread',{related:'allOrdered.thread',}),allOrderedHidden:one2many('mail.chat_window',{compute:'_computeAllOrderedHidden',dependencies:['visual'],}),allOrderedHiddenThread:one2many('mail.thread',{related:'allOrderedHidden.thread',}),allOrderedHiddenThreadMessageUnreadCounter:attr({related:'allOrderedHiddenThread.localMessageUnreadCounter',}),allOrderedVisible:one2many('mail.chat_window',{compute:'_computeAllOrderedVisible',dependencies:['visual'],}),chatWindows:one2many('mail.chat_window',{inverse:'manager',isCausal:true,}),device:one2one('mail.device',{related:'messaging.device',}),deviceGlobalWindowInnerWidth:attr({related:'device.globalWindowInnerWidth',}),deviceIsMobile:attr({related:'device.isMobile',}),discuss:one2one('mail.discuss',{related:'messaging.discuss',}),discussIsOpen:attr({related:'discuss.isOpen',}),hasHiddenChatWindows:attr({compute:'_computeHasHiddenChatWindows',dependencies:['allOrderedHidden'],}),hasVisibleChatWindows:attr({compute:'_computeHasVisibleChatWindows',dependencies:['allOrderedVisible'],}),isHiddenMenuOpen:attr({default:false,}),lastVisible:many2one('mail.chat_window',{compute:'_computeLastVisible',dependencies:['allOrderedVisible'],}),messaging:one2one('mail.messaging',{inverse:'chatWindowManager',}),newMessageChatWindow:one2one('mail.chat_window',{compute:'_computeNewMessageChatWindow',dependencies:['allOrderedThread'],}),unreadHiddenConversationAmount:attr({compute:'_computeUnreadHiddenConversationAmount',dependencies:['allOrderedHiddenThreadMessageUnreadCounter'],}),visual:attr({compute:'_computeVisual',default:BASE_VISUAL,dependencies:['allOrdered','deviceGlobalWindowInnerWidth','deviceIsMobile','discussIsOpen',],}),};ChatWindowManager.modelName='mail.chat_window_manager';return ChatWindowManager;}
registerNewModel('mail.chat_window_manager',factory);});;

/* /mail/static/src/models/chatter/chatter.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/chatter/chatter.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{attr,many2one,one2one}=require('mail/static/src/model/model_field.js');function factory(dependencies){const getThreadNextTemporaryId=(function(){let tmpId=0;return()=>{tmpId-=1;return tmpId;};})();const getMessageNextTemporaryId=(function(){let tmpId=0;return()=>{tmpId-=1;return tmpId;};})();class Chatter extends dependencies['mail.model']{_willDelete(){this._stopAttachmentsLoading();return super._willDelete(...arguments);}
focus(){this.update({isDoFocus:true});}
async refresh(){if(this.hasActivities){this.thread.refreshActivities();}
if(this.hasFollowers){this.thread.refreshFollowers();this.thread.fetchAndUpdateSuggestedRecipients();}
if(this.hasMessageList){this.thread.refresh();}}
showLogNote(){this.update({isComposerVisible:true});this.thread.composer.update({isLog:true});this.focus();}
showSendMessage(){this.update({isComposerVisible:true});this.thread.composer.update({isLog:false});this.focus();}
toggleActivityBoxVisibility(){this.update({isActivityBoxVisible:!this.isActivityBoxVisible});}
_computeHasThreadView(){return this.thread&&this.hasMessageList;}
_computeIsDisabled(){return!this.thread||this.thread.isTemporary;}
_onThreadIdOrThreadModelChanged(){if(this.threadId){if(this.thread&&this.thread.isTemporary){this.thread.delete();}
this.update({isAttachmentBoxVisible:this.isAttachmentBoxVisibleInitially,thread:[['insert',{hasActivities:this.hasActivities?true:undefined,id:this.threadId,model:this.threadModel,}]],});if(this.hasActivities){this.thread.refreshActivities();}
if(this.hasFollowers){this.thread.refreshFollowers();this.thread.fetchAndUpdateSuggestedRecipients();}
if(this.hasMessageList){this.thread.refresh();}}else if(!this.thread||!this.thread.isTemporary){const currentPartner=this.env.messaging.currentPartner;const message=this.env.models['mail.message'].create({author:[['link',currentPartner]],body:this.env._t("Creating a new record..."),id:getMessageNextTemporaryId(),isTemporary:true,});const nextId=getThreadNextTemporaryId();this.update({isAttachmentBoxVisible:false,thread:[['insert',{areAttachmentsLoaded:true,id:nextId,isTemporary:true,model:this.threadModel,}]],});for(const cache of this.thread.caches){cache.update({messages:[['link',message]]});}}}
_onThreadIsLoadingAttachmentsChanged(){if(!this.thread.isLoadingAttachments){this._stopAttachmentsLoading();return;}
if(this._isPreparingAttachmentsLoading||this.isShowingAttachmentsLoading){return;}
this._prepareAttachmentsLoading();}
_prepareAttachmentsLoading(){this._isPreparingAttachmentsLoading=true;this._attachmentsLoaderTimeout=this.env.browser.setTimeout(()=>{this.update({isShowingAttachmentsLoading:true});this._isPreparingAttachmentsLoading=false;},this.env.loadingBaseDelayDuration);}
_stopAttachmentsLoading(){this.env.browser.clearTimeout(this._attachmentsLoaderTimeout);this._attachmentsLoaderTimeout=null;this.update({isShowingAttachmentsLoading:false});this._isPreparingAttachmentsLoading=false;}}
Chatter.fields={composer:many2one('mail.composer',{related:'thread.composer',}),context:attr({default:{},}),hasActivities:attr({default:true,}),hasExternalBorder:attr({default:true,}),hasFollowers:attr({default:true,}),hasMessageList:attr({default:true,}),hasMessageListScrollAdjust:attr({default:false,}),hasThreadView:attr({compute:'_computeHasThreadView',dependencies:['hasMessageList','thread',],}),hasTopbarCloseButton:attr({default:false,}),isActivityBoxVisible:attr({default:true,}),isAttachmentBoxVisible:attr({default:false,}),isAttachmentBoxVisibleInitially:attr({default:false,}),isComposerVisible:attr({default:false,}),isDisabled:attr({compute:'_computeIsDisabled',default:false,dependencies:['threadIsTemporary',],}),isDoFocus:attr({default:false,}),isShowingAttachmentsLoading:attr({default:false,}),onThreadIdOrThreadModelChanged:attr({compute:'_onThreadIdOrThreadModelChanged',dependencies:['threadId','threadModel',],}),onThreadIsLoadingAttachmentsChanged:attr({compute:'_onThreadIsLoadingAttachmentsChanged',dependencies:['threadIsLoadingAttachments',],}),thread:many2one('mail.thread'),threadId:attr(),threadIsLoadingAttachments:attr({related:'thread.isLoadingAttachments',}),threadIsTemporary:attr({related:'thread.isTemporary',}),threadModel:attr(),threadView:one2one('mail.thread_view',{related:'threadViewer.threadView',}),threadViewer:one2one('mail.thread_viewer',{default:[['create']],inverse:'chatter',isCausal:true,}),};Chatter.modelName='mail.chatter';return Chatter;}
registerNewModel('mail.chatter',factory);});;

/* /mail/static/src/models/composer/composer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/composer/composer.js',function(require){'use strict';const emojis=require('mail.emojis');const{registerNewModel}=require('mail/static/src/model/model_core.js');const{attr,many2many,many2one,one2one}=require('mail/static/src/model/model_field.js');const mailUtils=require('mail.utils');const{addLink,escapeAndCompactTextContent,parseAndTransform,}=require('mail.utils');function factory(dependencies){class Composer extends dependencies['mail.model']{closeSuggestions(){if(this.activeSuggestedRecordName){this.update({[this.activeSuggestedRecordName]:[['unlink']],});}
if(this.extraSuggestedRecordsListName){this.update({[this.extraSuggestedRecordsListName]:[['unlink-all']],});}
if(this.mainSuggestedRecordsListName){this.update({[this.mainSuggestedRecordsListName]:[['unlink-all']],});}
this.update({activeSuggestedRecordName:"",extraSuggestedRecordsListName:"",mainSuggestedRecordsListName:"",suggestionDelimiter:"",});}
detectSuggestionDelimiter(){const lastInputChar=this.textInputContent.substring(this.textInputCursorStart-1,this.textInputCursorStart);const suggestionDelimiters=['@',':','#','/'];if(suggestionDelimiters.includes(lastInputChar)&&!this.hasSuggestions){this.update({suggestionDelimiter:lastInputChar});}
const mentionKeyword=this._validateMentionKeyword(false);if(mentionKeyword!==false){switch(this.suggestionDelimiter){case'@':this.update({activeSuggestedRecordName:"activeSuggestedPartner",extraSuggestedRecordsListName:"extraSuggestedPartners",mainSuggestedRecordsListName:"mainSuggestedPartners",suggestionModelName:"mail.partner",});this._updateSuggestedPartners(mentionKeyword);break;case':':this.update({activeSuggestedRecordName:"activeSuggestedCannedResponse",mainSuggestedRecordsListName:"suggestedCannedResponses",suggestionModelName:"mail.canned_response",});this._updateSuggestedCannedResponses(mentionKeyword);break;case'/':this.update({activeSuggestedRecordName:"activeSuggestedChannelCommand",mainSuggestedRecordsListName:"suggestedChannelCommands",suggestionModelName:"mail.channel_command",});this._updateSuggestedChannelCommands(mentionKeyword);break;case'#':this.update({activeSuggestedRecordName:"activeSuggestedChannel",mainSuggestedRecordsListName:"suggestedChannels",suggestionModelName:"mail.thread",});this._updateSuggestedChannels(mentionKeyword);break;}}else{this.closeSuggestions();}}
discard(){if(this.discussAsReplying){this.discussAsReplying.clearReplyingToMessage();}}
focus(){const allComposers=this.env.models['mail.composer'].all();for(const otherComposer of allComposers){if(otherComposer!==this&&otherComposer.hasFocus){otherComposer.update({hasFocus:false});}}
this.update({hasFocus:true});}
insertIntoTextInput(content){const partA=this.textInputContent.slice(0,this.textInputCursorStart);const partB=this.textInputContent.slice(this.textInputCursorEnd,this.textInputContent.length);this.update({textInputContent:partA+content+partB,textInputCursorStart:this.textInputCursorStart+content.length,textInputCursorEnd:this.textInputCursorStart+content.length,});}
insertSuggestion(){const cursorPosition=this.textInputCursorStart;let textLeft=this.textInputContent.substring(0,this.textInputContent.substring(0,cursorPosition).lastIndexOf(this.suggestionDelimiter)+1);let textRight=this.textInputContent.substring(cursorPosition,this.textInputContent.length);if(this.suggestionDelimiter===':'){textLeft=this.textInputContent.substring(0,this.textInputContent.substring(0,cursorPosition).lastIndexOf(this.suggestionDelimiter));textRight=this.textInputContent.substring(cursorPosition,this.textInputContent.length);}
let recordReplacement="";switch(this.activeSuggestedRecordName){case'activeSuggestedCannedResponse':recordReplacement=this[this.activeSuggestedRecordName].substitution;break;case'activeSuggestedChannel':recordReplacement=this[this.activeSuggestedRecordName].name;this.update({mentionedChannels:[['link',this[this.activeSuggestedRecordName]]],});break;case'activeSuggestedChannelCommand':recordReplacement=this[this.activeSuggestedRecordName].name;break;case'activeSuggestedPartner':recordReplacement=this[this.activeSuggestedRecordName].name;this.update({mentionedPartners:[['link',this[this.activeSuggestedRecordName]]],});break;}
this.update({textInputContent:textLeft+recordReplacement+' '+textRight,textInputCursorEnd:textLeft.length+recordReplacement.length+1,textInputCursorStart:textLeft.length+recordReplacement.length+1,});}
_computeRecipients(){const recipients=[...this.mentionedPartners];if(this.thread&&!this.isLog){for(const recipient of this.thread.suggestedRecipientInfoList){if(recipient.partner&&recipient.isSelected){recipients.push(recipient.partner);}}}
return[['replace',recipients]];}
async openFullComposer(){const attachmentIds=this.attachments.map(attachment=>attachment.id);const context={default_attachment_ids:attachmentIds,default_body:mailUtils.escapeAndCompactTextContent(this.textInputContent),default_is_log:this.isLog,default_model:this.thread.model,default_partner_ids:this.recipients.map(partner=>partner.id),default_res_id:this.thread.id,mail_post_autofollow:true,};const action={type:'ir.actions.act_window',res_model:'mail.compose.message',view_mode:'form',views:[[false,'form']],target:'new',context:context,};const options={on_close:()=>{if(!this.exists()){return;}
this._reset();this.thread.loadNewMessages();},};await this.env.bus.trigger('do-action',{action,options});}
async postMessage(){const thread=this.thread;this.thread.unregisterCurrentPartnerIsTyping({immediateNotify:true});const escapedAndCompactContent=escapeAndCompactTextContent(this.textInputContent);let body=escapedAndCompactContent.replace(/&nbsp;/g,' ').trim();body=this._generateMentionsLinks(body);body=parseAndTransform(body,addLink);body=this._generateEmojisOnHtml(body);let postData={attachment_ids:this.attachments.map(attachment=>attachment.id),body,channel_ids:this.mentionedChannels.map(channel=>channel.id),context:{mail_post_autofollow:true,},message_type:'comment',partner_ids:this.recipients.map(partner=>partner.id),};if(this.subjectContent){postData.subject=this.subjectContent;}
let messageId;if(thread.model==='mail.channel'){const command=this._getCommandFromText(body);Object.assign(postData,{subtype_xmlid:'mail.mt_comment',});if(command){messageId=await this.async(()=>this.env.models['mail.thread'].performRpcExecuteCommand({channelId:thread.id,command:command.name,postData,}));}else{messageId=await this.async(()=>this.env.models['mail.thread'].performRpcMessagePost({postData,threadId:thread.id,threadModel:thread.model,}));}}else{Object.assign(postData,{subtype_xmlid:this.isLog?'mail.mt_note':'mail.mt_comment',});messageId=await this.async(()=>this.env.models['mail.thread'].performRpcMessagePost({postData,threadId:thread.id,threadModel:thread.model,}));const[messageData]=await this.async(()=>this.env.services.rpc({model:'mail.message',method:'message_format',args:[[messageId]],},{shadow:true}));this.env.models['mail.message'].insert(Object.assign({},this.env.models['mail.message'].convertData(messageData),{originThread:[['insert',{id:thread.id,model:thread.model,}]],}));thread.loadNewMessages();}
for(const threadView of this.thread.threadViews){threadView.update({hasAutoScrollOnMessageReceived:true});}
thread.refreshFollowers();thread.fetchAndUpdateSuggestedRecipients();this._reset();}
handleCurrentPartnerIsTyping(){if(!this.thread){return;}
if(this.thread.typingMembers.includes(this.env.messaging.currentPartner)){this.thread.refreshCurrentPartnerIsTyping();}else{this.thread.registerCurrentPartnerIsTyping();}}
setFirstSuggestionActive(){if(!this[this.mainSuggestedRecordsListName][0]){if(!this[this.extraSuggestedRecordsListName][0]){return;}
this.update({[this.activeSuggestedRecordName]:[['link',this[this.extraSuggestedRecordsListName][0]]],});}else{this.update({[this.activeSuggestedRecordName]:[['link',this[this.mainSuggestedRecordsListName][0]]],});}}
setLastSuggestionActive(){if(this[this.extraSuggestedRecordsListName].length===0){if(this[this.mainSuggestedRecordsListName].length===0){return;}
this.update({[this.activeSuggestedRecordName]:[['link',this[this.mainSuggestedRecordsListName][this[this.mainSuggestedRecordsListName].length-1]]],});}
this.update({[this.activeSuggestedRecordName]:[['link',this[this.extraSuggestedRecordsListName][this[this.extraSuggestedRecordsListName].length-1]]],});}
setNextSuggestionActive(){const fullList=this.extraSuggestedRecordsListName?this[this.mainSuggestedRecordsListName].concat(this[this.extraSuggestedRecordsListName]):this[this.mainSuggestedRecordsListName];if(fullList.length===0){return;}
const activeElementIndex=fullList.findIndex(suggestion=>suggestion===this[this.activeSuggestedRecordName]);if(activeElementIndex!==fullList.length-1){this.update({[this.activeSuggestedRecordName]:[['link',fullList[activeElementIndex+1]]],});}else{this.update({[this.activeSuggestedRecordName]:[['link',fullList[0]]],});}}
setPreviousSuggestionActive(){const fullList=this.extraSuggestedRecordsListName?this[this.mainSuggestedRecordsListName].concat(this[this.extraSuggestedRecordsListName]):this[this.mainSuggestedRecordsListName];if(fullList.length===0){return;}
const activeElementIndex=fullList.findIndex(suggestion=>suggestion===this[this.activeSuggestedRecordName]);if(activeElementIndex===-1){this.update({[this.activeSuggestedRecordName]:[['link',fullList[0]]]});}else if(activeElementIndex!==0){this.update({[this.activeSuggestedRecordName]:[['link',fullList[activeElementIndex-1]]],});}else{this.update({[this.activeSuggestedRecordName]:[['link',fullList[fullList.length-1]]],});}}
_computeActiveSuggestedRecord(){return this[this.activeSuggestedRecordName];}
_computeCanPostMessage(){if(!this.textInputContent&&this.attachments.length===0){return false;}
return!this.hasUploadingAttachment;}
_computeExtraSuggestedPartners(){return[['unlink',this.mainSuggestedPartners]];}
_computeExtraSuggestedRecordsList(){return this.extraSuggestedRecordsListName?this[this.extraSuggestedRecordsListName]:[];}
_computeHasSuggestions(){const hasMainSuggestedRecordsList=this.mainSuggestedRecordsListName?this[this.mainSuggestedRecordsListName].length>0:false;const hasExtraSuggestedRecordsList=this.extraSuggestedRecordsListName?this[this.extraSuggestedRecordsListName].length>0:false;return hasMainSuggestedRecordsList||hasExtraSuggestedRecordsList;}
_computeHasUploadingAttachment(){return this.attachments.some(attachment=>attachment.isTemporary);}
_computeMainSuggestedRecordsList(){return this.mainSuggestedRecordsListName?this[this.mainSuggestedRecordsListName]:[];}
_computeMentionedPartners(){const unmentionedPartners=[];const namesIndex={};for(const partner of this.mentionedPartners){const fromIndex=namesIndex[partner.name]!==undefined?namesIndex[partner.name]+1:0;const index=this.textInputContent.indexOf(`@${partner.name}`,fromIndex);if(index!==-1){namesIndex[partner.name]=index;}else{unmentionedPartners.push(partner);}}
return[['unlink',unmentionedPartners]];}
_computeMentionedChannels(){const unmentionedChannels=[];const namesIndex={};for(const channel of this.mentionedChannels){const fromIndex=namesIndex[channel.name]!==undefined?namesIndex[channel.name]+1:0;const index=this.textInputContent.indexOf(`#${channel.name}`,fromIndex);if(index!==-1){namesIndex[channel.name]=index;}else{unmentionedChannels.push(channel);}}
return[['unlink',unmentionedChannels]];}
_generateEmojisOnHtml(htmlString){for(const emoji of emojis){for(const source of emoji.sources){const escapedSource=String(source).replace(/([.*+?=^!:${}()|[\]/\\])/g,'\\$1');const regexp=new RegExp('(\\s|^)('+escapedSource+')(?=\\s|$)','g');htmlString=htmlString.replace(regexp,'$1'+emoji.unicode);}}
return htmlString;}
_generateMentionsLinks(body){const mentions=[];for(const partner of this.mentionedPartners){const placeholder=`@-mention-partner-${partner.id}`;const text=`@${owl.utils.escape(partner.name)}`;mentions.push({class:'o_mail_redirect',id:partner.id,model:'res.partner',placeholder,text,});body=body.replace(text,placeholder);}
for(const channel of this.mentionedChannels){const placeholder=`#-mention-channel-${channel.id}`;const text=`#${owl.utils.escape(channel.name)}`;mentions.push({class:'o_channel_redirect',id:channel.id,model:'mail.channel',placeholder,text,});body=body.replace(text,placeholder);}
const baseHREF=this.env.session.url('/web');for(const mention of mentions){const href=`href='${baseHREF}#model=${mention.model}&id=${mention.id}'`;const attClass=`class='${mention.class}'`;const dataOeId=`data-oe-id='${mention.id}'`;const dataOeModel=`data-oe-model='${mention.model}'`;const target=`target='_blank'`;const link=`<a ${href} ${attClass} ${dataOeId} ${dataOeModel} ${target}>${mention.text}</a>`;body=body.replace(mention.placeholder,link);}
return body;}
_getCommandFromText(content){if(content.startsWith('/')){const firstWord=content.substring(1).split(/\s/)[0];return this.env.messaging.commands.find(command=>{if(command.name!==firstWord){return false;}
if(command.channel_types){return command.channel_types.includes(this.thread.channel_type);}
return true;});}
return undefined;}
_reset(){this.closeSuggestions();this.update({attachments:[['unlink-all']],mentionedChannels:[['unlink-all']],mentionedPartners:[['unlink-all']],subjectContent:"",textInputContent:'',textInputCursorEnd:0,textInputCursorStart:0,});}
_updateSuggestedCannedResponses(mentionKeyword){this.update({suggestedCannedResponses:[['replace',this.env.messaging.cannedResponses.filter(cannedResponse=>cannedResponse.source.includes(mentionKeyword))]],});if(this.suggestedCannedResponses[0]){this.update({activeSuggestedCannedResponse:[['link',this.suggestedCannedResponses[0]]],hasToScrollToActiveSuggestion:true,});}else{this.update({activeSuggestedCannedResponse:[['unlink']],});}}
async _updateSuggestedChannels(mentionKeyword){const mentions=await this.async(()=>this.env.services.rpc({model:'mail.channel',method:'get_mention_suggestions',kwargs:{limit:8,search:mentionKeyword,},},{shadow:true}));this.update({suggestedChannels:[['insert-and-replace',mentions.map(data=>{const threadData=this.env.models['mail.thread'].convertData(data);return Object.assign({model:'mail.channel'},threadData);})]],});if(this.suggestedChannels[0]){this.update({activeSuggestedChannel:[['link',this.suggestedChannels[0]]],hasToScrollToActiveSuggestion:true,});}else{this.update({activeSuggestedChannel:[['unlink']],});}}
_updateSuggestedChannelCommands(mentionKeyword){const commands=this.env.messaging.commands.filter(command=>{if(!command.name.includes(mentionKeyword)){return false;}
if(command.channel_types){return command.channel_types.includes(this.thread.channel_type);}
return true;});this.update({suggestedChannelCommands:[['replace',commands]]});if(this.suggestedChannelCommands[0]){this.update({activeSuggestedChannelCommand:[['link',this.suggestedChannelCommands[0]]],hasToScrollToActiveSuggestion:true,});}else{this.update({activeSuggestedChannelCommand:[['unlink']],});}}
async _updateSuggestedPartners(mentionKeyword){const mentions=await this.async(()=>this.env.services.rpc({model:'res.partner',method:'get_mention_suggestions',kwargs:{limit:8,search:mentionKeyword,},},{shadow:true}));const mainSuggestedPartners=mentions[0];const extraSuggestedPartners=mentions[1];this.update({extraSuggestedPartners:[['insert-and-replace',extraSuggestedPartners.map(data=>this.env.models['mail.partner'].convertData(data))]],mainSuggestedPartners:[['insert-and-replace',mainSuggestedPartners.map(data=>this.env.models['mail.partner'].convertData(data))]],});if(this.mainSuggestedPartners[0]){this.update({activeSuggestedPartner:[['link',this.mainSuggestedPartners[0]]],hasToScrollToActiveSuggestion:true,});}else if(this.extraSuggestedPartners[0]){this.update({activeSuggestedPartner:[['link',this.extraSuggestedPartners[0]]],hasToScrollToActiveSuggestion:true,});}else{this.update({activeSuggestedPartner:[['unlink']],});}}
_validateMentionKeyword(beginningOnly){const leftString=this.textInputContent.substring(0,this.textInputCursorStart);const beforeSuggestionDelimiterPosition=leftString.lastIndexOf(this.suggestionDelimiter)-1;if(beginningOnly&&beforeSuggestionDelimiterPosition>0){return false;}
let searchStr=this.textInputContent.substring(beforeSuggestionDelimiterPosition,this.textInputCursorStart);const pattern="^"+this.suggestionDelimiter+"|^\\s"+this.suggestionDelimiter;const regexStart=new RegExp(pattern,'g');searchStr=searchStr.replace(/^\s\s*|^[\n\r]/g,'');if(regexStart.test(searchStr)&&searchStr.length){searchStr=searchStr.replace(pattern,'');return!searchStr.includes(' ')&&!/[\r\n]/.test(searchStr)?searchStr.replace(this.suggestionDelimiter,''):false;}
return false;}}
Composer.fields={activeSuggestedCannedResponse:many2one('mail.canned_response'),activeSuggestedChannel:many2one('mail.thread'),activeSuggestedChannelCommand:many2one('mail.channel_command'),activeSuggestedPartner:many2one('mail.partner'),activeSuggestedRecord:attr({compute:'_computeActiveSuggestedRecord',dependencies:['activeSuggestedCannedResponse','activeSuggestedChannel','activeSuggestedChannelCommand','activeSuggestedPartner','activeSuggestedRecordName',],}),activeSuggestedRecordName:attr({default:"",}),attachments:many2many('mail.attachment',{inverse:'composers',}),attachmentsAreTemporary:attr({related:'attachments.isTemporary',}),canPostMessage:attr({compute:'_computeCanPostMessage',dependencies:['attachments','hasUploadingAttachment','textInputContent',],default:false,}),discussAsReplying:one2one('mail.discuss',{inverse:'replyingToMessageOriginThreadComposer',}),extraSuggestedPartners:many2many('mail.partner',{compute:'_computeExtraSuggestedPartners',dependencies:['extraSuggestedPartners','mainSuggestedPartners',],}),extraSuggestedRecordsList:attr({compute:'_computeExtraSuggestedRecordsList',dependencies:['extraSuggestedPartners','extraSuggestedRecordsListName',],}),extraSuggestedRecordsListName:attr({default:"",}),hasUploadingAttachment:attr({compute:'_computeHasUploadingAttachment',dependencies:['attachments','attachmentsAreTemporary',],}),hasFocus:attr({default:false,}),hasSuggestions:attr({compute:'_computeHasSuggestions',dependencies:['extraSuggestedRecordsListName','extraSuggestedPartners','mainSuggestedRecordsListName','mainSuggestedPartners','suggestedCannedResponses','suggestedChannelCommands','suggestedChannels',],default:false,}),hasToScrollToActiveSuggestion:attr({default:false,}),isLog:attr({default:false,}),mainSuggestedRecordsList:attr({compute:'_computeMainSuggestedRecordsList',dependencies:['mainSuggestedPartners','mainSuggestedRecordsListName','suggestedCannedResponses','suggestedChannelCommands','suggestedChannels',],}),mainSuggestedRecordsListName:attr({default:"",}),mainSuggestedPartners:many2many('mail.partner'),mentionedChannels:many2many('mail.thread',{compute:'_computeMentionedChannels',dependencies:['textInputContent'],}),mentionedPartners:many2many('mail.partner',{compute:'_computeMentionedPartners',dependencies:['textInputContent'],}),recipients:many2many('mail.partner',{compute:'_computeRecipients',dependencies:['isLog','mentionedPartners','threadSuggestedRecipientInfoListIsSelected',]}),threadSuggestedRecipientInfoList:many2many('mail.suggested_recipient_info',{related:'thread.suggestedRecipientInfoList',}),threadSuggestedRecipientInfoListIsSelected:attr({related:'threadSuggestedRecipientInfoList.isSelected',}),subjectContent:attr({default:"",}),suggestedCannedResponses:many2many('mail.canned_response'),suggestedChannelCommands:many2many('mail.channel_command'),suggestedChannels:many2many('mail.thread'),suggestionDelimiter:attr({default:"",}),suggestionModelName:attr({default:"",}),textInputContent:attr({default:"",}),textInputCursorEnd:attr({default:0,}),textInputCursorStart:attr({default:0,}),thread:one2one('mail.thread',{inverse:'composer',}),};Composer.modelName='mail.composer';return Composer;}
registerNewModel('mail.composer',factory);});;

/* /mail/static/src/models/country/country.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/country/country.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{attr}=require('mail/static/src/model/model_field.js');const{clear}=require('mail/static/src/model/model_field_command.js');function factory(dependencies){class Country extends dependencies['mail.model']{static _createRecordLocalId(data){return`${this.modelName}_${data.id}`;}
_computeFlagUrl(){if(!this.code){return clear();}
return`/base/static/img/country_flags/${this.code}.png`;}}
Country.fields={code:attr(),flagUrl:attr({compute:'_computeFlagUrl',dependencies:['code',],}),id:attr(),name:attr(),};Country.modelName='mail.country';return Country;}
registerNewModel('mail.country',factory);});;

/* /mail/static/src/models/device/device.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/device/device.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{attr}=require('mail/static/src/model/model_field.js');function factory(dependencies){class Device extends dependencies['mail.model']{_created(){const res=super._created(...arguments);this._refresh();this._onResize=_.debounce(()=>this._refresh(),100);return res;}
_willDelete(){window.removeEventListener('resize',this._onResize);return super._willDelete(...arguments);}
start(){window.addEventListener('resize',this._onResize);}
_refresh(){this.update({globalWindowInnerHeight:this.env.browser.innerHeight,globalWindowInnerWidth:this.env.browser.innerWidth,isMobile:this.env.device.isMobile,});}}
Device.fields={globalWindowInnerHeight:attr(),globalWindowInnerWidth:attr(),isMobile:attr(),};Device.modelName='mail.device';return Device;}
registerNewModel('mail.device',factory);});;

/* /mail/static/src/models/dialog/dialog.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/dialog/dialog.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{many2one,one2one}=require('mail/static/src/model/model_field.js');function factory(dependencies){class Dialog extends dependencies['mail.model']{}
Dialog.fields={manager:many2one('mail.dialog_manager',{inverse:'dialogs',}),record:one2one('mail.model',{isCausal:true,}),};Dialog.modelName='mail.dialog';return Dialog;}
registerNewModel('mail.dialog',factory);});;

/* /mail/static/src/models/dialog_manager/dialog_manager.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/dialog_manager/dialog_manager.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{one2many}=require('mail/static/src/model/model_field.js');function factory(dependencies){class DialogManager extends dependencies['mail.model']{open(modelName,recordData){if(!modelName){throw new Error("Dialog should have a link to a model");}
const Model=this.env.models[modelName];if(!Model){throw new Error(`No model exists with name ${modelName}`);}
const record=Model.create(recordData);const dialog=this.env.models['mail.dialog'].create({manager:[['link',this]],record:[['link',record]],});return dialog;}}
DialogManager.fields={dialogs:one2many('mail.dialog',{inverse:'manager',isCausal:true,}),};DialogManager.modelName='mail.dialog_manager';return DialogManager;}
registerNewModel('mail.dialog_manager',factory);});;

/* /mail/static/src/models/discuss/discuss.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/discuss.discuss.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{attr,many2one,one2many,one2one}=require('mail/static/src/model/model_field.js');const{clear}=require('mail/static/src/model/model_field_command.js');function factory(dependencies){class Discuss extends dependencies['mail.model']{cancelThreadRenaming(thread){this.update({renamingThreads:[['unlink',thread]]});}
clearIsAddingItem(){this.update({addingChannelValue:"",isAddingChannel:false,isAddingChat:false,});}
clearReplyingToMessage(){this.update({replyingToMessage:[['unlink-all']]});}
close(){this.update({isOpen:false});}
focus(){this.update({isDoFocus:true});}
async handleAddChannelAutocompleteSelect(ev,ui){const name=this.addingChannelValue;this.clearIsAddingItem();if(ui.item.special){const channel=await this.async(()=>this.env.models['mail.thread'].performRpcCreateChannel({name,privacy:ui.item.special,}));channel.open();}else{const channel=await this.async(()=>this.env.models['mail.thread'].performRpcJoinChannel({channelId:ui.item.id,}));channel.open();}}
async handleAddChannelAutocompleteSource(req,res){const value=req.term;const escapedValue=owl.utils.escape(value);this.update({addingChannelValue:value});const result=await this.async(()=>this.env.services.rpc({model:'mail.channel',method:'channel_search_to_join',args:[value],}));const items=result.map(data=>{let escapedName=owl.utils.escape(data.name);return Object.assign(data,{label:escapedName,value:escapedName});});items.push({label:_.str.sprintf(`<strong>${this.env._t('Create %s')}</strong>`,`<em><span class="fa fa-hashtag"/>${escapedValue}</em>`,),escapedValue,special:'public'},{label:_.str.sprintf(`<strong>${this.env._t('Create %s')}</strong>`,`<em><span class="fa fa-lock"/>${escapedValue}</em>`,),escapedValue,special:'private'});res(items);}
handleAddChatAutocompleteSelect(ev,ui){this.env.messaging.openChat({partnerId:ui.item.id});this.clearIsAddingItem();}
handleAddChatAutocompleteSource(req,res){const value=owl.utils.escape(req.term);this.env.models['mail.partner'].imSearch({callback:partners=>{const suggestions=partners.map(partner=>{return{id:partner.id,value:partner.nameOrDisplayName,label:partner.nameOrDisplayName,};});res(_.sortBy(suggestions,'label'));},keyword:value,limit:10,});}
openInitThread(){const[model,id]=typeof this.initActiveId==='number'?['mail.channel',this.initActiveId]:this.initActiveId.split('_');const thread=this.env.models['mail.thread'].findFromIdentifyingData({id:model!=='mail.box'?Number(id):id,model,});if(!thread){return;}
thread.open();if(this.env.messaging.device.isMobile&&thread.channel_type){this.update({activeMobileNavbarTabId:thread.channel_type});}}
async openThread(thread){this.update({thread:[['link',thread]],});this.focus();if(!this.isOpen){this.env.bus.trigger('do-action',{action:'mail.action_discuss',options:{active_id:this.threadToActiveId(this),clear_breadcrumbs:false,on_reverse_breadcrumb:()=>this.close(),},});}}
async renameThread(thread,newName){await this.async(()=>thread.rename(newName));this.update({renamingThreads:[['unlink',thread]]});}
replyToMessage(message){this.update({replyingToMessage:[['link',message]]});this.replyingToMessageOriginThreadComposer.update({isLog:!message.is_discussion&&!message.is_notification});this.focus();}
setThreadRenaming(thread){this.update({renamingThreads:[['link',thread]]});}
threadToActiveId(thread){return`${thread.model}_${thread.id}`;}
_computeActiveId(){if(!this.thread){return clear();}
return this.threadToActiveId(this.thread);}
_computeAddingChannelValue(){if(!this.isOpen){return"";}
return this.addingChannelValue;}
_computeHasThreadView(){if(!this.thread||!this.isOpen){return false;}
if(this.env.messaging.device.isMobile&&(this.activeMobileNavbarTabId!=='mailbox'||this.thread.model!=='mail.box')){return false;}
return true;}
_computeIsAddingChannel(){if(!this.isOpen){return false;}
return this.isAddingChannel;}
_computeIsAddingChat(){if(!this.isOpen){return false;}
return this.isAddingChat;}
_computeIsReplyingToMessage(){return!!this.replyingToMessage;}
_computeReplyingToMessage(){if(!this.isOpen){return[['unlink-all']];}
return[];}
_computeThread(){let thread=this.thread;if(this.env.messaging&&this.env.messaging.inbox&&this.env.messaging.device.isMobile&&this.activeMobileNavbarTabId==='mailbox'&&this.initActiveId!=='mail.box_inbox'&&!thread){return[['replace',this.env.messaging.inbox]];}
if(!thread||!thread.isPinned){return[['unlink']];}
return[];}}
Discuss.fields={activeId:attr({compute:'_computeActiveId',dependencies:['thread','threadId','threadModel',],}),activeMobileNavbarTabId:attr({default:'mailbox',}),addingChannelValue:attr({compute:'_computeAddingChannelValue',default:"",dependencies:['isOpen'],}),device:one2one('mail.device',{related:'messaging.device',}),deviceIsMobile:attr({related:'device.isMobile',}),hasModerationDiscardDialog:attr({default:false,}),hasModerationRejectDialog:attr({default:false,}),hasThreadView:attr({compute:'_computeHasThreadView',dependencies:['activeMobileNavbarTabId','deviceIsMobile','isOpen','thread','threadModel',],}),initActiveId:attr({default:'mail.box_inbox',}),isAddingChannel:attr({compute:'_computeIsAddingChannel',default:false,dependencies:['isOpen'],}),isAddingChat:attr({compute:'_computeIsAddingChat',default:false,dependencies:['isOpen'],}),isDoFocus:attr({default:false,}),isOpen:attr({default:false,}),isReplyingToMessage:attr({compute:'_computeIsReplyingToMessage',default:false,dependencies:['replyingToMessage'],}),isThreadPinned:attr({related:'thread.isPinned',}),menu_id:attr({default:null,}),messaging:one2one('mail.messaging',{inverse:'discuss',}),messagingInbox:many2one('mail.thread',{related:'messaging.inbox',}),renamingThreads:one2many('mail.thread'),replyingToMessage:many2one('mail.message',{compute:'_computeReplyingToMessage',dependencies:['isOpen','replyingToMessage',],}),replyingToMessageOriginThread:many2one('mail.thread',{related:'replyingToMessage.originThread',}),replyingToMessageOriginThreadComposer:one2one('mail.composer',{inverse:'discussAsReplying',related:'replyingToMessageOriginThread.composer',}),sidebarQuickSearchValue:attr({default:"",}),stringifiedDomain:attr({default:'[]',}),thread:many2one('mail.thread',{compute:'_computeThread',dependencies:['activeMobileNavbarTabId','deviceIsMobile','isThreadPinned','messaging','messagingInbox','thread','threadModel',],}),threadId:attr({related:'thread.id',}),threadModel:attr({related:'thread.model',}),threadView:one2one('mail.thread_view',{related:'threadViewer.threadView',}),threadViewer:one2one('mail.thread_viewer',{default:[['create']],inverse:'discuss',isCausal:true,}),};Discuss.modelName='mail.discuss';return Discuss;}
registerNewModel('mail.discuss',factory);});;

/* /mail/static/src/models/follower/follower.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/follower.follower.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{attr,many2many,many2one}=require('mail/static/src/model/model_field.js');function factory(dependencies){class Follower extends dependencies['mail.model']{static convertData(data){const data2={};if('channel_id'in data){if(!data.channel_id){data2.channel=[['unlink-all']];}else{const channelData={id:data.channel_id,model:'mail.channel',name:data.name,};data2.channel=[['insert',channelData]];}}
if('id'in data){data2.id=data.id;}
if('is_active'in data){data2.isActive=data.is_active;}
if('is_editable'in data){data2.isEditable=data.is_editable;}
if('partner_id'in data){if(!data.partner_id){data2.partner=[['unlink-all']];}else{const partnerData={email:data.email,id:data.partner_id,name:data.name,};data2.partner=[['insert',partnerData]];}}
return data2;}
closeSubtypes(){this._subtypesListDialog.delete();this._subtypesListDialog=undefined;}
async openProfile(){if(this.partner){return this.partner.openProfile();}
return this.channel.openProfile();}
async remove(){const partner_ids=[];const channel_ids=[];if(this.partner){partner_ids.push(this.partner.id);}else{channel_ids.push(this.channel.id);}
await this.async(()=>this.env.services.rpc({model:this.followedThread.model,method:'message_unsubscribe',args:[[this.followedThread.id],partner_ids,channel_ids]}));const followedThread=this.followedThread;this.delete();followedThread.fetchAndUpdateSuggestedRecipients();}
selectSubtype(subtype){if(!this.selectedSubtypes.includes(subtype)){this.update({selectedSubtypes:[['link',subtype]]});}}
async showSubtypes(){const subtypesData=await this.async(()=>this.env.services.rpc({route:'/mail/read_subscription_data',params:{follower_id:this.id},}));this.update({subtypes:[['unlink-all']]});for(const data of subtypesData){const subtype=this.env.models['mail.follower_subtype'].insert(this.env.models['mail.follower_subtype'].convertData(data));this.update({subtypes:[['link',subtype]]});if(data.followed){this.update({selectedSubtypes:[['link',subtype]]});}else{this.update({selectedSubtypes:[['unlink',subtype]]});}}
this._subtypesListDialog=this.env.messaging.dialogManager.open('mail.follower_subtype_list',{follower:[['link',this]],});}
unselectSubtype(subtype){if(this.selectedSubtypes.includes(subtype)){this.update({selectedSubtypes:[['unlink',subtype]]});}}
async updateSubtypes(){if(this.selectedSubtypes.length===0){this.remove();}else{const kwargs={subtype_ids:this.selectedSubtypes.map(subtype=>subtype.id),};if(this.partner){kwargs.partner_ids=[this.partner.id];}else{kwargs.channel_ids=[this.channel.id];}
await this.async(()=>this.env.services.rpc({model:this.followedThread.model,method:'message_subscribe',args:[[this.followedThread.id]],kwargs,}));}
this.closeSubtypes();}
static _createRecordLocalId(data){return`${this.modelName}_${data.id}`;}
_computeName(){if(this.channel){return this.channel.name;}
if(this.partner){return this.partner.name;}
return'';}
_computeResId(){if(this.partner){return this.partner.id;}
if(this.channel){return this.channel.id;}
return 0;}
_computeResModel(){if(this.partner){return this.partner.model;}
if(this.channel){return this.channel.model;}
return'';}}
Follower.fields={resId:attr({compute:'_computeResId',default:0,dependencies:['channelId','partnerId',],}),channel:many2one('mail.thread'),channelId:attr({related:'channel.id',}),channelModel:attr({related:'channel.model',}),channelName:attr({related:'channel.name',}),followedThread:many2one('mail.thread',{inverse:'followers',}),id:attr(),isActive:attr({default:true,}),isEditable:attr({default:false,}),name:attr({compute:'_computeName',dependencies:['channelName','partnerName',],}),partner:many2one('mail.partner'),partnerId:attr({related:'partner.id',}),partnerModel:attr({related:'partner.model',}),partnerName:attr({related:'partner.name',}),resModel:attr({compute:'_computeResModel',default:'',dependencies:['channelModel','partnerModel',],}),selectedSubtypes:many2many('mail.follower_subtype'),subtypes:many2many('mail.follower_subtype'),};Follower.modelName='mail.follower';return Follower;}
registerNewModel('mail.follower',factory);});;

/* /mail/static/src/models/follower_subtype/follower_subtype.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/follower_subtype/follower_subtype.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{attr}=require('mail/static/src/model/model_field.js');function factory(dependencies){class FollowerSubtype extends dependencies['mail.model']{static convertData(data){const data2={};if('default'in data){data2.isDefault=data.default;}
if('id'in data){data2.id=data.id;}
if('internal'in data){data2.isInternal=data.internal;}
if('name'in data){data2.name=data.name;}
if('parent_model'in data){data2.parentModel=data.parent_model;}
if('res_model'in data){data2.resModel=data.res_model;}
if('sequence'in data){data2.sequence=data.sequence;}
return data2;}
static _createRecordLocalId(data){return`${this.modelName}_${data.id}`;}}
FollowerSubtype.fields={id:attr(),isDefault:attr({default:false,}),isInternal:attr({default:false,}),name:attr(),parentModel:attr(),resModel:attr(),sequence:attr(),};FollowerSubtype.modelName='mail.follower_subtype';return FollowerSubtype;}
registerNewModel('mail.follower_subtype',factory);});;

/* /mail/static/src/models/follower_subtype_list/follower_subtype_list.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/follower_subtype_list/follower_subtype_list.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{many2one}=require('mail/static/src/model/model_field.js');function factory(dependencies){class FollowerSubtypeList extends dependencies['mail.model']{}
FollowerSubtypeList.fields={follower:many2one('mail.follower'),};FollowerSubtypeList.modelName='mail.follower_subtype_list';return FollowerSubtypeList;}
registerNewModel('mail.follower_subtype_list',factory);});;

/* /mail/static/src/models/locale/locale.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/locale/locale.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{attr}=require('mail/static/src/model/model_field.js');function factory(dependencies){class Locale extends dependencies['mail.model']{_computeTextDirection(){return this.env._t.database.parameters.direction;}}
Locale.fields={textDirection:attr({compute:'_computeTextDirection',}),};Locale.modelName='mail.locale';return Locale;}
registerNewModel('mail.locale',factory);});;

/* /mail/static/src/models/mail_template/mail_template.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/mail_template/mail_template.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{attr,many2many}=require('mail/static/src/model/model_field.js');function factory(dependencies){class MailTemplate extends dependencies['mail.model']{preview(activity){const action={name:this.env._t("Compose Email"),type:'ir.actions.act_window',res_model:'mail.compose.message',views:[[false,'form']],target:'new',context:{default_res_id:activity.thread.id,default_model:activity.thread.model,default_use_template:true,default_template_id:this.id,force_email:true,},};this.env.bus.trigger('do-action',{action,options:{on_close:()=>{activity.thread.refresh();},},});}
async send(activity){await this.async(()=>this.env.services.rpc({model:activity.thread.model,method:'activity_send_mail',args:[[activity.thread.id],this.id],}));activity.thread.refresh();}
static _createRecordLocalId(data){return`${this.modelName}_${data.id}`;}}
MailTemplate.fields={activities:many2many('mail.activity',{inverse:'mailTemplates',}),id:attr(),name:attr(),};MailTemplate.modelName='mail.mail_template';return MailTemplate;}
registerNewModel('mail.mail_template',factory);});;

/* /mail/static/src/models/message/message.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/message/message.js',function(require){'use strict';const emojis=require('mail.emojis');const{registerNewModel}=require('mail/static/src/model/model_core.js');const{attr,many2many,many2one,one2many}=require('mail/static/src/model/model_field.js');const{addLink,htmlToTextContentInline,parseAndTransform}=require('mail.utils');const{str_to_datetime}=require('web.time');function factory(dependencies){class Message extends dependencies['mail.model']{static checkAll(thread,threadStringifiedDomain){const threadCache=thread.cache(threadStringifiedDomain);threadCache.update({checkedMessages:[['link',threadCache.messages]]});}
static convertData(data){const data2={};if('attachment_ids'in data){if(!data.attachment_ids){data2.attachments=[['unlink-all']];}else{data2.attachments=[['insert-and-replace',data.attachment_ids.map(attachmentData=>this.env.models['mail.attachment'].convertData(attachmentData))],];}}
if('author_id'in data){if(!data.author_id){data2.author=[['unlink-all']];}else if(data.author_id[0]!==0){data2.author=[['insert',{display_name:data.author_id[1],id:data.author_id[0],}],];}}
if('body'in data){data2.body=data.body;}
if('channel_ids'in data&&data.channel_ids){const channels=data.channel_ids.map(channelId=>this.env.models['mail.thread'].findFromIdentifyingData({id:channelId,model:'mail.channel',})).filter(channel=>!!channel);data2.serverChannels=[['replace',channels]];}
if('date'in data&&data.date){data2.date=moment(str_to_datetime(data.date));}
if('email_from'in data){data2.email_from=data.email_from;}
if('history_partner_ids'in data){data2.isHistory=data.history_partner_ids.includes(this.env.messaging.currentPartner.id);}
if('id'in data){data2.id=data.id;}
if('is_discussion'in data){data2.is_discussion=data.is_discussion;}
if('is_note'in data){data2.is_note=data.is_note;}
if('is_notification'in data){data2.is_notification=data.is_notification;}
if('message_type'in data){data2.message_type=data.message_type;}
if('model'in data&&'res_id'in data&&data.model&&data.res_id){const originThreadData={id:data.res_id,model:data.model,};if('record_name'in data&&data.record_name){originThreadData.name=data.record_name;}
if('res_model_name'in data&&data.res_model_name){originThreadData.model_name=data.res_model_name;}
if('module_icon'in data){originThreadData.moduleIcon=data.module_icon;}
data2.originThread=[['insert',originThreadData]];}
if('moderation_status'in data){data2.moderation_status=data.moderation_status;}
if('needaction_partner_ids'in data){data2.isNeedaction=data.needaction_partner_ids.includes(this.env.messaging.currentPartner.id);}
if('notifications'in data){data2.notifications=[['insert',data.notifications.map(notificationData=>this.env.models['mail.notification'].convertData(notificationData))]];}
if('starred_partner_ids'in data){data2.isStarred=data.starred_partner_ids.includes(this.env.messaging.currentPartner.id);}
if('subject'in data){data2.subject=data.subject;}
if('subtype_description'in data){data2.subtype_description=data.subtype_description;}
if('subtype_id'in data){data2.subtype_id=data.subtype_id;}
if('tracking_value_ids'in data){data2.tracking_value_ids=data.tracking_value_ids;}
return data2;}
static async markAllAsRead(domain){await this.env.services.rpc({model:'mail.message',method:'mark_all_as_read',kwargs:{domain},});}
static async markAsRead(messages){await this.env.services.rpc({model:'mail.message',method:'set_message_done',args:[messages.map(message=>message.id)]});}
static async moderate(messages,decision,kwargs){const messageIds=messages.map(message=>message.id);await this.env.services.rpc({model:'mail.message',method:'moderate',args:[messageIds,decision],kwargs:kwargs,});}
static async performRpcMessageFetch(domain,limit,moderated_channel_ids,context){const messagesData=await this.env.services.rpc({model:'mail.message',method:'message_fetch',kwargs:{context,domain,limit,moderated_channel_ids,},},{shadow:true});const messages=this.env.models['mail.message'].insert(messagesData.map(messageData=>this.env.models['mail.message'].convertData(messageData)));for(const message of messages){for(const thread of message.threads){if(thread.model!=='mail.channel'||thread.channel_type==='channel'){continue;}
this.env.models['mail.message_seen_indicator'].insert({channelId:thread.id,messageId:message.id,});}}
return messages;}
static uncheckAll(thread,threadStringifiedDomain){const threadCache=thread.cache(threadStringifiedDomain);threadCache.update({checkedMessages:[['unlink',threadCache.messages]]});}
static async unstarAll(){await this.env.services.rpc({model:'mail.message',method:'unstar_all',});}
isChecked(thread,threadStringifiedDomain){const relatedCheckedThreadCache=this.checkedThreadCaches.find(threadCache=>(threadCache.thread===thread&&threadCache.stringifiedDomain===threadStringifiedDomain));return!!relatedCheckedThreadCache;}
async markAsRead(){await this.async(()=>this.env.services.rpc({model:'mail.message',method:'set_message_done',args:[[this.id]]}));}
async moderate(decision,kwargs){await this.async(()=>this.constructor.moderate([this],decision,kwargs));}
openResendAction(){this.env.bus.trigger('do-action',{action:'mail.mail_resend_message_action',options:{additional_context:{mail_message_to_resend:this.id,},},});}
replyTo(){this.env.messaging.discuss.replyToMessage(this);}
toggleCheck(thread,threadStringifiedDomain){const threadCache=thread.cache(threadStringifiedDomain);if(threadCache.checkedMessages.includes(this)){threadCache.update({checkedMessages:[['unlink',this]]});}else{threadCache.update({checkedMessages:[['link',this]]});}}
async toggleStar(){await this.async(()=>this.env.services.rpc({model:'mail.message',method:'toggle_message_starred',args:[[this.id]]}));}
static _createRecordLocalId(data){return`${this.modelName}_${data.id}`;}
_computeFailureNotifications(){return[['replace',this.notifications.filter(notifications=>['exception','bounce'].includes(notifications.notification_status))]];}
_computeHasCheckbox(){return this.isModeratedByCurrentPartner;}
_computeIsCurrentPartnerAuthor(){return!!(this.author&&this.messagingCurrentPartner&&this.messagingCurrentPartner===this.author);}
_computeIsBodyEqualSubtypeDescription(){if(!this.body||!this.subtype_description){return false;}
const inlineBody=htmlToTextContentInline(this.body);return inlineBody.toLowerCase()===this.subtype_description.toLowerCase();}
_computeIsEmpty(){return((!this.body||htmlToTextContentInline(this.body)==='')&&this.attachments.length===0&&this.tracking_value_ids.length===0&&!this.subtype_description);}
_computeIsModeratedByCurrentPartner(){return(this.moderation_status==='pending_moderation'&&this.originThread&&this.originThread.isModeratedByCurrentPartner);}
_computeMessaging(){return[['link',this.env.messaging]];}
_computePrettyBody(){let prettyBody;for(const emoji of emojis){const{unicode}=emoji;const regexp=new RegExp(`(?:^|\\s|<[a-z]*>)(${unicode})(?=\\s|$|</[a-z]*>)`,"g");const originalBody=this.body;prettyBody=this.body.replace(regexp,` <span class="o_mail_emoji">${unicode}</span> `);if(_.str.count(prettyBody,"o_mail_emoji")>200){prettyBody=originalBody;}}
return parseAndTransform(prettyBody,addLink);}
_computeThreads(){const threads=[...this.serverChannels];if(this.isHistory){threads.push(this.env.messaging.history);}
if(this.isNeedaction){threads.push(this.env.messaging.inbox);}
if(this.isStarred){threads.push(this.env.messaging.starred);}
if(this.env.messaging.moderation&&this.isModeratedByCurrentPartner){threads.push(this.env.messaging.moderation);}
if(this.originThread){threads.push(this.originThread);}
return[['replace',threads]];}}
Message.fields={attachments:many2many('mail.attachment',{inverse:'messages',}),author:many2one('mail.partner',{inverse:'messagesAsAuthor',}),body:attr({default:"",}),checkedThreadCaches:many2many('mail.thread_cache',{inverse:'checkedMessages',}),date:attr({default:moment(),}),email_from:attr(),failureNotifications:one2many('mail.notification',{compute:'_computeFailureNotifications',dependencies:['notificationsStatus'],}),hasCheckbox:attr({compute:'_computeHasCheckbox',default:false,dependencies:['isModeratedByCurrentPartner'],}),id:attr(),isCurrentPartnerAuthor:attr({compute:'_computeIsCurrentPartnerAuthor',default:false,dependencies:['author','messagingCurrentPartner',],}),isBodyEqualSubtypeDescription:attr({compute:'_computeIsBodyEqualSubtypeDescription',default:false,dependencies:['body','subtype_description',],}),isEmpty:attr({compute:'_computeIsEmpty',dependencies:['attachments','body','tracking_value_ids',],}),isModeratedByCurrentPartner:attr({compute:'_computeIsModeratedByCurrentPartner',default:false,dependencies:['moderation_status','originThread','originThreadIsModeratedByCurrentPartner',],}),isTemporary:attr({default:false,}),isTransient:attr({default:false,}),is_discussion:attr({default:false,}),isHistory:attr({default:false,}),isNeedaction:attr({default:false,}),is_note:attr({default:false,}),is_notification:attr({default:false,}),isStarred:attr({default:false,}),message_type:attr(),messaging:many2one('mail.messaging',{compute:'_computeMessaging',}),messagingCurrentPartner:many2one('mail.partner',{related:'messaging.currentPartner',}),messagingHistory:many2one('mail.thread',{related:'messaging.history',}),messagingInbox:many2one('mail.thread',{related:'messaging.inbox',}),messagingModeration:many2one('mail.thread',{related:'messaging.moderation',}),messagingStarred:many2one('mail.thread',{related:'messaging.starred',}),moderation_status:attr(),notifications:one2many('mail.notification',{inverse:'message',isCausal:true,}),notificationsStatus:attr({default:[],related:'notifications.notification_status',}),originThread:many2one('mail.thread'),originThreadIsModeratedByCurrentPartner:attr({default:false,related:'originThread.isModeratedByCurrentPartner',}),prettyBody:attr({compute:'_computePrettyBody',dependencies:['body'],}),subject:attr(),subtype_description:attr(),subtype_id:attr(),threads:many2many('mail.thread',{compute:'_computeThreads',dependencies:['isHistory','isModeratedByCurrentPartner','isNeedaction','isStarred','messagingHistory','messagingInbox','messagingModeration','messagingStarred','originThread','serverChannels',],inverse:'messages',}),tracking_value_ids:attr({default:[],}),serverChannels:many2many('mail.thread',{inverse:'messagesAsServerChannel',}),};Message.modelName='mail.message';return Message;}
registerNewModel('mail.message',factory);});;

/* /mail/static/src/models/message_seen_indicator/message_seen_indicator.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/message_seen_indicator/message_seen_indicator.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{attr,many2many,many2one,one2many}=require('mail/static/src/model/model_field.js');function factory(dependencies){class MessageSeenIndicator extends dependencies['mail.model']{static recomputeFetchedValues(channel=undefined){const indicatorFindFunction=channel?localIndicator=>localIndicator.thread===channel:undefined;const indicators=this.env.models['mail.message_seen_indicator'].all(indicatorFindFunction);for(const indicator of indicators){indicator.update({hasEveryoneFetched:indicator._computeHasEveryoneFetched(),hasSomeoneFetched:indicator._computeHasSomeoneFetched(),partnersThatHaveFetched:indicator._computePartnersThatHaveFetched(),});}}
static recomputeSeenValues(channel=undefined){const indicatorFindFunction=channel?localIndicator=>localIndicator.thread===channel:undefined;const indicators=this.env.models['mail.message_seen_indicator'].all(indicatorFindFunction);for(const indicator of indicators){indicator.update({hasEveryoneSeen:indicator._computeHasEveryoneSeen(),hasSomeoneFetched:indicator._computeHasSomeoneFetched(),hasSomeoneSeen:indicator._computeHasSomeoneSeen(),isMessagePreviousToLastCurrentPartnerMessageSeenByEveryone:indicator._computeIsMessagePreviousToLastCurrentPartnerMessageSeenByEveryone(),partnersThatHaveFetched:indicator._computePartnersThatHaveFetched(),partnersThatHaveSeen:indicator._computePartnersThatHaveSeen(),});}}
static _createRecordLocalId(data){const{channelId,messageId}=data;return`${this.modelName}_${channelId}_${messageId}`;}
_computeHasEveryoneFetched(){if(!this.message||!this.thread||!this.thread.partnerSeenInfos){return false;}
const otherPartnerSeenInfosDidNotFetch=this.thread.partnerSeenInfos.filter(partnerSeenInfo=>partnerSeenInfo.partner!==this.message.author&&(!partnerSeenInfo.lastFetchedMessage||partnerSeenInfo.lastFetchedMessage.id<this.message.id));return otherPartnerSeenInfosDidNotFetch.length===0;}
_computeHasEveryoneSeen(){if(!this.message||!this.thread||!this.thread.partnerSeenInfos){return false;}
const otherPartnerSeenInfosDidNotSee=this.thread.partnerSeenInfos.filter(partnerSeenInfo=>partnerSeenInfo.partner!==this.message.author&&(!partnerSeenInfo.lastSeenMessage||partnerSeenInfo.lastSeenMessage.id<this.message.id));return otherPartnerSeenInfosDidNotSee.length===0;}
_computeHasSomeoneFetched(){if(!this.message||!this.thread||!this.thread.partnerSeenInfos){return false;}
const otherPartnerSeenInfosFetched=this.thread.partnerSeenInfos.filter(partnerSeenInfo=>partnerSeenInfo.partner!==this.message.author&&partnerSeenInfo.lastFetchedMessage&&partnerSeenInfo.lastFetchedMessage.id>=this.message.id);return otherPartnerSeenInfosFetched.length>0;}
_computeHasSomeoneSeen(){if(!this.message||!this.thread||!this.thread.partnerSeenInfos){return false;}
const otherPartnerSeenInfosSeen=this.thread.partnerSeenInfos.filter(partnerSeenInfo=>partnerSeenInfo.partner!==this.message.author&&partnerSeenInfo.lastSeenMessage&&partnerSeenInfo.lastSeenMessage.id>=this.message.id);return otherPartnerSeenInfosSeen.length>0;}
_computeIsMessagePreviousToLastCurrentPartnerMessageSeenByEveryone(){if(!this.message||!this.thread||!this.thread.lastCurrentPartnerMessageSeenByEveryone){return false;}
return this.message.id<this.thread.lastCurrentPartnerMessageSeenByEveryone.id;}
_computePartnersThatHaveFetched(){if(!this.message||!this.thread||!this.thread.partnerSeenInfos){return[['unlink-all']];}
const otherPartnersThatHaveFetched=this.thread.partnerSeenInfos.filter(partnerSeenInfo=>partnerSeenInfo.partner&&partnerSeenInfo.partner!==this.message.author&&partnerSeenInfo.lastFetchedMessage&&partnerSeenInfo.lastFetchedMessage.id>=this.message.id).map(partnerSeenInfo=>partnerSeenInfo.partner);if(otherPartnersThatHaveFetched.length===0){return[['unlink-all']];}
return[['replace',otherPartnersThatHaveFetched]];}
_computePartnersThatHaveSeen(){if(!this.message||!this.thread||!this.thread.partnerSeenInfos){return[['unlink-all']];}
const otherPartnersThatHaveSeen=this.thread.partnerSeenInfos.filter(partnerSeenInfo=>partnerSeenInfo.partner&&partnerSeenInfo.partner!==this.message.author&&partnerSeenInfo.lastSeenMessage&&partnerSeenInfo.lastSeenMessage.id>=this.message.id).map(partnerSeenInfo=>partnerSeenInfo.partner);if(otherPartnersThatHaveSeen.length===0){return[['unlink-all']];}
return[['replace',otherPartnersThatHaveSeen]];}
_computeMessage(){return[['insert',{id:this.messageId}]];}
_computeThread(){return[['insert',{id:this.channelId,model:'mail.channel',}]];}}
MessageSeenIndicator.modelName='mail.message_seen_indicator';MessageSeenIndicator.fields={channelId:attr(),hasEveryoneFetched:attr({compute:'_computeHasEveryoneFetched',default:false,dependencies:['messageAuthor','messageId','threadPartnerSeenInfos'],}),hasEveryoneSeen:attr({compute:'_computeHasEveryoneSeen',default:false,dependencies:['messageAuthor','messageId','threadPartnerSeenInfos'],}),hasSomeoneFetched:attr({compute:'_computeHasSomeoneFetched',default:false,dependencies:['messageAuthor','messageId','threadPartnerSeenInfos'],}),hasSomeoneSeen:attr({compute:'_computeHasSomeoneSeen',default:false,dependencies:['messageAuthor','messageId','threadPartnerSeenInfos'],}),id:attr(),isMessagePreviousToLastCurrentPartnerMessageSeenByEveryone:attr({compute:'_computeIsMessagePreviousToLastCurrentPartnerMessageSeenByEveryone',default:false,dependencies:['messageId','threadLastCurrentPartnerMessageSeenByEveryone',],}),message:many2one('mail.message',{compute:'_computeMessage',dependencies:['messageId',],}),messageAuthor:many2one('mail.partner',{related:'message.author',}),messageId:attr(),partnersThatHaveFetched:many2many('mail.partner',{compute:'_computePartnersThatHaveFetched',dependencies:['messageAuthor','messageId','threadPartnerSeenInfos'],}),partnersThatHaveSeen:many2many('mail.partner',{compute:'_computePartnersThatHaveSeen',dependencies:['messageAuthor','messageId','threadPartnerSeenInfos'],}),thread:many2one('mail.thread',{compute:'_computeThread',dependencies:['channelId',],inverse:'messageSeenIndicators'}),threadPartnerSeenInfos:one2many('mail.thread_partner_seen_info',{related:'thread.partnerSeenInfos',}),threadLastCurrentPartnerMessageSeenByEveryone:many2one('mail.message',{related:'thread.lastCurrentPartnerMessageSeenByEveryone',}),};return MessageSeenIndicator;}
registerNewModel('mail.message_seen_indicator',factory);});;

/* /mail/static/src/models/messaging/messaging.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/messaging/messaging.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{attr,many2one,one2many,one2one}=require('mail/static/src/model/model_field.js');function factory(dependencies){class Messaging extends dependencies['mail.model']{_willDelete(){this.env.services['bus_service'].off('window_focus',null,this._handleGlobalWindowFocus);return super._willDelete(...arguments);}
async start(){this._handleGlobalWindowFocus=this._handleGlobalWindowFocus.bind(this);this.env.services['bus_service'].on('window_focus',null,this._handleGlobalWindowFocus);await this.async(()=>this.initializer.start());this.notificationHandler.start();this.update({isInitialized:true});}
isNotificationPermissionDefault(){const windowNotification=this.env.browser.Notification;return windowNotification?windowNotification.permission==='default':false;}
async getChat({partnerId,userId}){if(userId){const user=this.env.models['mail.user'].insert({id:userId});return user.getChat();}
if(partnerId){const partner=this.env.models['mail.partner'].insert({id:partnerId});return partner.getChat();}}
async openChat(person,options){const chat=await this.async(()=>this.getChat(person));if(!chat){return;}
await this.async(()=>chat.open(options));return chat;}
async openDocument({id,model}){this.env.bus.trigger('do-action',{action:{type:'ir.actions.act_window',res_model:model,views:[[false,'form']],res_id:id,},});if(this.env.messaging.device.isMobile){this.env.messaging.messagingMenu.close();}}
async openProfile({id,model}){if(model==='res.partner'){const partner=this.env.models['mail.partner'].insert({id});return partner.openProfile();}
if(model==='res.users'){const user=this.env.models['mail.user'].insert({id});return user.openProfile();}
if(model==='mail.channel'){let channel=this.env.models['mail.thread'].findFromIdentifyingData({id,model:'mail.channel'});if(!channel){channel=(await this.async(()=>this.env.models['mail.thread'].performRpcChannelInfo({ids:[id]})))[0];}
if(!channel){this.env.services['notification'].notify({message:this.env._t("You can only open the profile of existing channels."),type:'warning',});return;}
return channel.openProfile();}
return this.env.messaging.openDocument({id,model});}
_handleGlobalWindowFocus(){this.update({outOfFocusUnreadMessageCounter:0});this.env.bus.trigger('set_title_part',{part:'_chat',});}}
Messaging.fields={cannedResponses:one2many('mail.canned_response'),chatWindowManager:one2one('mail.chat_window_manager',{default:[['create']],inverse:'messaging',isCausal:true,}),commands:one2many('mail.channel_command'),currentPartner:one2one('mail.partner'),currentUser:one2one('mail.user'),device:one2one('mail.device',{default:[['create']],isCausal:true,}),dialogManager:one2one('mail.dialog_manager',{default:[['create']],isCausal:true,}),discuss:one2one('mail.discuss',{default:[['create']],inverse:'messaging',isCausal:true,}),history:one2one('mail.thread'),inbox:one2one('mail.thread'),initializer:one2one('mail.messaging_initializer',{default:[['create']],inverse:'messaging',isCausal:true,}),isInitialized:attr({default:false,}),locale:one2one('mail.locale',{default:[['create']],isCausal:true,}),messagingMenu:one2one('mail.messaging_menu',{default:[['create']],inverse:'messaging',isCausal:true,}),moderation:one2one('mail.thread'),notificationGroupManager:one2one('mail.notification_group_manager',{default:[['create']],isCausal:true,}),notificationHandler:one2one('mail.messaging_notification_handler',{default:[['create']],inverse:'messaging',isCausal:true,}),outOfFocusUnreadMessageCounter:attr({default:0,}),partnerRoot:many2one('mail.partner'),publicPartner:many2one('mail.partner'),starred:one2one('mail.thread'),};Messaging.modelName='mail.messaging';return Messaging;}
registerNewModel('mail.messaging',factory);});;

/* /mail/static/src/models/messaging_initializer/messaging_initializer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/messaging_initializer/messaging_initializer.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{one2one}=require('mail/static/src/model/model_field.js');const{executeGracefully}=require('mail/static/src/utils/utils.js');function factory(dependencies){class MessagingInitializer extends dependencies['mail.model']{async start(){this.messaging.update({history:[['create',{id:'history',isServerPinned:true,model:'mail.box',name:this.env._t("History"),}]],inbox:[['create',{id:'inbox',isServerPinned:true,model:'mail.box',name:this.env._t("Inbox"),}]],moderation:[['create',{id:'moderation',model:'mail.box',name:this.env._t("Moderation"),}]],starred:[['create',{id:'starred',isServerPinned:true,model:'mail.box',name:this.env._t("Starred"),}]],});const device=this.messaging.device;device.start();const context=Object.assign({isMobile:device.isMobile,},this.env.session.user_context);const discuss=this.messaging.discuss;const data=await this.async(()=>this.env.services.rpc({route:'/mail/init_messaging',params:{context:context}},{shadow:true}));await this.async(()=>this._init(data));if(discuss.isOpen){discuss.openInitThread();}
if(this.env.autofetchPartnerImStatus){this.env.models['mail.partner'].startLoopFetchImStatus();}}
async _init({channel_slots,commands=[],current_partner,current_user_id,mail_failures={},mention_partner_suggestions=[],menu_id,moderation_channel_ids=[],moderation_counter=0,needaction_inbox_counter=0,partner_root,public_partner,shortcodes=[],starred_counter=0}){const discuss=this.messaging.discuss;this._initPartners({current_partner,current_user_id,moderation_channel_ids,partner_root,public_partner,});this._initMailboxes({moderation_channel_ids,moderation_counter,needaction_inbox_counter,starred_counter,});this._initCannedResponses(shortcodes);this._initCommands(commands);this._initMentionPartnerSuggestions(mention_partner_suggestions);await this.async(()=>this._initChannels(channel_slots));this._initMailFailures(mail_failures);discuss.update({menu_id});}
_initCannedResponses(cannedResponsesData){this.messaging.update({cannedResponses:[['insert',cannedResponsesData]],});}
async _initChannels({channel_channel=[],channel_direct_message=[],channel_private_group=[],}={}){const channelsData=channel_channel.concat(channel_direct_message,channel_private_group);return executeGracefully(channelsData.map(channelData=>()=>{const convertedData=this.env.models['mail.thread'].convertData(channelData);if(!convertedData.members){convertedData.members=[['link',this.env.messaging.currentPartner]];}
const channel=this.env.models['mail.thread'].insert(Object.assign({model:'mail.channel'},convertedData));if(!channel.isPinned){channel.pin();}}));}
_initCommands(commandsData){this.messaging.update({commands:[['insert',commandsData]],});}
_initMailboxes({moderation_channel_ids,moderation_counter,needaction_inbox_counter,starred_counter,}){this.env.messaging.inbox.update({counter:needaction_inbox_counter});this.env.messaging.starred.update({counter:starred_counter});if(moderation_channel_ids.length>0){this.messaging.moderation.update({counter:moderation_counter,isServerPinned:true,});}}
_initMailFailures(mailFailuresData){const messages=this.env.models['mail.message'].insert(mailFailuresData.map(messageData=>this.env.models['mail.message'].convertData(messageData)));for(const message of messages){if(!message.author&&this.messaging.currentPartner){message.update({author:[['link',this.messaging.currentPartner]]});}}
this.messaging.notificationGroupManager.computeGroups();this.messaging.messagingMenu.update();}
async _initMentionPartnerSuggestions(mentionPartnerSuggestionsData){return executeGracefully(mentionPartnerSuggestionsData.map(suggestions=>()=>{return executeGracefully(suggestions.map(suggestion=>()=>{const{email,id,name}=suggestion;this.env.models['mail.partner'].insert({email,id,name});}));}));}
_initPartners({current_partner,current_user_id:currentUserId,moderation_channel_ids=[],partner_root,public_partner,}){this.messaging.update({currentPartner:[['insert',Object.assign(this.env.models['mail.partner'].convertData(current_partner),{moderatedChannels:[['insert',moderation_channel_ids.map(id=>{return{id,model:'mail.channel',};})],],user:[['insert',{id:currentUserId}]],})]],currentUser:[['insert',{id:currentUserId}]],partnerRoot:[['insert',this.env.models['mail.partner'].convertData(partner_root)]],publicPartner:[['insert',this.env.models['mail.partner'].convertData(public_partner)]],});}}
MessagingInitializer.fields={messaging:one2one('mail.messaging',{inverse:'initializer',}),};MessagingInitializer.modelName='mail.messaging_initializer';return MessagingInitializer;}
registerNewModel('mail.messaging_initializer',factory);});;

/* /mail/static/src/models/messaging_menu/messaging_menu.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/messaging_menu/messaging_menu.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{attr,one2one}=require('mail/static/src/model/model_field.js');function factory(dependencies){class MessagingMenu extends dependencies['mail.model']{close(){this.update({activeTabId:'all',isMobileNewMessageToggled:false,isOpen:false,});}
toggleMobileNewMessage(){this.update({isMobileNewMessageToggled:!this.isMobileNewMessageToggled});}
toggleOpen(){this.update({isOpen:!this.isOpen});}
_computeInboxMessagesAutoloader(){if(!this.isOpen){return;}
const inbox=this.env.messaging.inbox;if(!inbox||!inbox.mainCache){return;}
inbox.mainCache.update({isCacheRefreshRequested:true});}
_updateCounter(){if(!this.env.messaging){return 0;}
const inboxMailbox=this.env.messaging.inbox;const unreadChannels=this.env.models['mail.thread'].all(thread=>thread.localMessageUnreadCounter>0&&thread.model==='mail.channel');let counter=unreadChannels.length;if(inboxMailbox){counter+=inboxMailbox.counter;}
if(this.messaging.notificationGroupManager){counter+=this.messaging.notificationGroupManager.groups.reduce((total,group)=>total+group.notifications.length,0);}
if(this.messaging.isNotificationPermissionDefault()){counter++;}
return counter;}
_updateAfter(previous){const counter=this._updateCounter();if(this.counter!==counter){this.update({counter});}}}
MessagingMenu.fields={activeTabId:attr({default:'all',}),counter:attr({default:0,}),inboxMessagesAutoloader:attr({compute:'_computeInboxMessagesAutoloader',dependencies:['isOpen','messagingInbox','messagingInboxMainCache',],}),isMobileNewMessageToggled:attr({default:false,}),isOpen:attr({default:false,}),messaging:one2one('mail.messaging',{inverse:'messagingMenu',}),messagingInbox:one2one('mail.thread',{related:'messaging.inbox',}),messagingInboxMainCache:one2one('mail.thread_cache',{related:'messagingInbox.mainCache',}),};MessagingMenu.modelName='mail.messaging_menu';return MessagingMenu;}
registerNewModel('mail.messaging_menu',factory);});;

/* /mail/static/src/models/messaging_notification_handler/messaging_notification_handler.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/messaging_notification_handler/messaging_notification_handler.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{one2one}=require('mail/static/src/model/model_field.js');const PREVIEW_MSG_MAX_SIZE=350;function factory(dependencies){class MessagingNotificationHandler extends dependencies['mail.model']{_willDelete(){this.env.services['bus_service'].off('notification');this.env.services['bus_service'].stopPolling();return super._willDelete(...arguments);}
start(){this.env.services.bus_service.onNotification(null,notifs=>this._handleNotifications(notifs));this.env.services.bus_service.startPolling();}
_filterNotificationsOnUnsubscribe(notifications){const unsubscribedNotif=notifications.find(notif=>notif[1].info==='unsubscribe');if(unsubscribedNotif){notifications=notifications.filter(notif=>notif[0][1]!=='mail.channel'||notif[0][2]!==unsubscribedNotif[1].id);}
return notifications;}
async _handleNotifications(notifications){const filteredNotifications=this._filterNotificationsOnUnsubscribe(notifications);const proms=filteredNotifications.map(notification=>{const[channel,message]=notification;if(typeof channel==='string'){return;}
const[,model,id]=channel;switch(model){case'ir.needaction':return this._handleNotificationNeedaction(message);case'mail.channel':return this._handleNotificationChannel(id,message);case'res.partner':if(id!==this.env.messaging.currentPartner.id){return;}
return this._handleNotificationPartner(Object.assign({},message));default:console.warn(`mail.messaging_notification_handler: Unhandled notification "${model}"`);return;}});await this.async(()=>Promise.all(proms));}
async _handleNotificationChannel(channelId,data){const{info,is_typing,last_message_id,partner_id,partner_name,}=data;switch(info){case'channel_fetched':return this._handleNotificationChannelFetched(channelId,{last_message_id,partner_id,});case'channel_seen':return this._handleNotificationChannelSeen(channelId,{last_message_id,partner_id,});case'typing_status':return this._handleNotificationChannelTypingStatus(channelId,{is_typing,partner_id,partner_name,});default:return this._handleNotificationChannelMessage(channelId,data);}}
async _handleNotificationChannelFetched(channelId,{last_message_id,partner_id,}){const channel=this.env.models['mail.thread'].findFromIdentifyingData({id:channelId,model:'mail.channel',});if(!channel){return;}
if(channel.channel_type==='channel'){return;}
this.env.models['mail.thread_partner_seen_info'].insert({channelId:channel.id,lastFetchedMessage:[['insert',{id:last_message_id}]],partnerId:partner_id,});channel.update({messageSeenIndicators:[['insert',{channelId:channel.id,messageId:last_message_id,}]],});this.env.models['mail.message_seen_indicator'].recomputeFetchedValues(channel);}
async _handleNotificationChannelMessage(channelId,messageData){let channel=this.env.models['mail.thread'].findFromIdentifyingData({id:channelId,model:'mail.channel',});const wasChannelExisting=!!channel;const convertedData=this.env.models['mail.message'].convertData(messageData);const oldMessage=this.env.models['mail.message'].findFromIdentifyingData(convertedData);const oldMessageModerationStatus=(oldMessage&&oldMessage.moderation_status);const oldMessageWasModeratedByCurrentPartner=(oldMessage&&oldMessage.isModeratedByCurrentPartner);if(!channel){channel=(await this.async(()=>this.env.models['mail.thread'].performRpcChannelInfo({ids:[channelId]})))[0];}
if(!channel.isPinned){channel.pin();}
const message=this.env.models['mail.message'].insert(convertedData);this._notifyThreadViewsMessageReceived(message);if(oldMessage){if(oldMessageModerationStatus==='pending_moderation'&&message.moderation_status!=='pending_moderation'&&oldMessageWasModeratedByCurrentPartner){const moderation=this.env.messaging.moderation;moderation.update({counter:moderation.counter-1});}
return;}
if(message.author===this.env.messaging.currentPartner){return;}
if(channel.mass_mailing&&this.env.session.notification_type==='email'){return;}
const isChatWithOdooBot=(channel.correspondent&&channel.correspondent===this.env.messaging.partnerRoot);if(!isChatWithOdooBot){const isOdooFocused=this.env.services['bus_service'].isOdooFocused();if(!isOdooFocused){this._notifyNewChannelMessageWhileOutOfFocus({channel,message,});}
if(channel.model==='mail.channel'&&channel.channel_type!=='channel'){channel.markAsFetched();}
if(channel.channel_type!=='channel'){this.env.messaging.chatWindowManager.openThread(channel);}}
if(!wasChannelExisting){return;}
this.messaging.messagingMenu.update();}
async _handleNotificationChannelSeen(channelId,{last_message_id,partner_id,}){const channel=this.env.models['mail.thread'].findFromIdentifyingData({id:channelId,model:'mail.channel',});if(!channel){return;}
const lastMessage=this.env.models['mail.message'].insert({id:last_message_id});const shouldComputeSeenIndicators=channel.channel_type!=='channel';const updateData={};if(shouldComputeSeenIndicators){this.env.models['mail.thread_partner_seen_info'].insert({channelId:channel.id,lastSeenMessage:[['link',lastMessage]],partnerId:partner_id,});Object.assign(updateData,{messageSeenIndicators:[['insert',{channelId:channel.id,messageId:lastMessage.id,},]],});}
if(this.env.messaging.currentPartner.id===partner_id){Object.assign(updateData,{lastSeenByCurrentPartnerMessageId:last_message_id,pendingSeenMessageId:undefined,});}
channel.update(updateData);if(shouldComputeSeenIndicators){this.env.models['mail.thread'].computeLastCurrentPartnerMessageSeenByEveryone(channel);this.env.models['mail.message_seen_indicator'].recomputeSeenValues(channel);}
this.messaging.messagingMenu.update();}
_handleNotificationChannelTypingStatus(channelId,{is_typing,partner_id,partner_name}){const channel=this.env.models['mail.thread'].findFromIdentifyingData({id:channelId,model:'mail.channel',});if(!channel){return;}
const partner=this.env.models['mail.partner'].insert({id:partner_id,name:partner_name,});if(partner===this.env.messaging.currentPartner){return;}
if(is_typing){if(channel.typingMembers.includes(partner)){channel.refreshOtherMemberTypingMember(partner);}else{channel.registerOtherMemberTypingMember(partner);}}else{if(!channel.typingMembers.includes(partner)){return;}
channel.unregisterOtherMemberTypingMember(partner);}}
_handleNotificationNeedaction(data){const message=this.env.models['mail.message'].insert(this.env.models['mail.message'].convertData(data));const inboxMailbox=this.env.messaging.inbox;inboxMailbox.update({counter:inboxMailbox.counter+1});for(const thread of message.threads){if(thread.channel_type==='channel'&&message.isNeedaction){thread.update({message_needaction_counter:thread.message_needaction_counter+1});}}
this.messaging.messagingMenu.update();}
async _handleNotificationPartner(data){const{info,type,}=data;if(type==='activity_updated'){this.env.bus.trigger('activity_updated',data);}else if(type==='author'){return this._handleNotificationPartnerAuthor(data);}else if(info==='channel_seen'){return this._handleNotificationChannelSeen(data.channel_id,data);}else if(type==='deletion'){return this._handleNotificationPartnerDeletion(data);}else if(type==='message_notification_update'){return this._handleNotificationPartnerMessageNotificationUpdate(data.elements);}else if(type==='mark_as_read'){return this._handleNotificationPartnerMarkAsRead(data);}else if(type==='moderator'){return this._handleNotificationPartnerModerator(data);}else if(type==='simple_notification'){const escapedTitle=owl.utils.escape(data.title);const escapedMessage=owl.utils.escape(data.message);this.env.services['notification'].notify({message:escapedMessage,sticky:data.sticky,title:escapedTitle,type:data.warning?'warning':'danger',});}else if(type==='toggle_star'){return this._handleNotificationPartnerToggleStar(data);}else if(info==='transient_message'){return this._handleNotificationPartnerTransientMessage(data);}else if(info==='unsubscribe'){return this._handleNotificationPartnerUnsubscribe(data.id);}else if(type==='user_connection'){return this._handleNotificationPartnerUserConnection(data);}else{return this._handleNotificationPartnerChannel(data);}}
_handleNotificationPartnerAuthor(data){this.env.models['mail.message'].insert(this.env.models['mail.message'].convertData(data.message));}
_handleNotificationPartnerChannel(data){const convertedData=this.env.models['mail.thread'].convertData(Object.assign({model:'mail.channel'},data));if(!convertedData.members){convertedData.members=[['link',this.env.messaging.currentPartner]];}
let channel=this.env.models['mail.thread'].findFromIdentifyingData(convertedData);const wasCurrentPartnerMember=(channel&&channel.members.includes(this.env.messaging.currentPartner));channel=this.env.models['mail.thread'].insert(convertedData);if(channel.channel_type==='channel'&&data.info!=='creation'&&!wasCurrentPartnerMember){this.env.services['notification'].notify({message:_.str.sprintf(this.env._t("You have been invited to: %s"),owl.utils.escape(channel.name)),title:this.env._t("Invitation"),type:'warning',});}
this.messaging.messagingMenu.update();}
_handleNotificationPartnerDeletion({message_ids}){const moderationMailbox=this.env.messaging.moderation;for(const id of message_ids){const message=this.env.models['mail.message'].find(message=>message.id===id);if(message){if(message.moderation_status==='pending_moderation'&&message.originThread.isModeratedByCurrentPartner){moderationMailbox.update({counter:moderationMailbox.counter-1});}
message.delete();}}
this.messaging.notificationGroupManager.computeGroups();this.messaging.messagingMenu.update();}
_handleNotificationPartnerMessageNotificationUpdate(data){for(const messageData of data){const message=this.env.models['mail.message'].insert(this.env.models['mail.message'].convertData(messageData));if(!message.author&&this.messaging.currentPartner){message.update({author:[['link',this.messaging.currentPartner]]});}}
this.messaging.notificationGroupManager.computeGroups();this.messaging.messagingMenu.update();}
_handleNotificationPartnerMarkAsRead({channel_ids,message_ids=[]}){const inboxMailbox=this.env.messaging.inbox;for(const message_id of message_ids){const message=this.env.models['mail.message'].find(m=>m.id===message_id);if(message){message.update({isNeedaction:false,isHistory:true,});}}
let channels;if(channel_ids){channels=channel_ids.map(id=>this.env.models['mail.thread'].find(thread=>thread.id===id&&thread.model==='mail.channel')).filter(thread=>!!thread);}else{channels=this.env.models['mail.thread'].all(thread=>thread.model==='mail.channel');}
for(const channel of channels){channel.update({message_needaction_counter:0});}
inboxMailbox.update({counter:inboxMailbox.counter-message_ids.length});this.messaging.messagingMenu.update();}
_handleNotificationPartnerModerator({message:data}){this.env.models['mail.message'].insert(this.env.models['mail.message'].convertData(data));const moderationMailbox=this.env.messaging.moderation;if(moderationMailbox){moderationMailbox.update({counter:moderationMailbox.counter+1});}
this.messaging.messagingMenu.update();}
_handleNotificationPartnerToggleStar({message_ids=[],starred}){const starredMailbox=this.env.messaging.starred;for(const messageId of message_ids){const message=this.env.models['mail.message'].find(message=>message.id===messageId);if(!message){continue;}
message.update({isStarred:starred});starredMailbox.update({counter:starred?starredMailbox.counter+1:starredMailbox.counter-1,});}}
_handleNotificationPartnerTransientMessage(data){const convertedData=this.env.models['mail.message'].convertData(data);const lastMessageId=this.env.models['mail.message'].all().reduce((lastMessageId,message)=>Math.max(lastMessageId,message.id),0);const partnerRoot=this.env.messaging.partnerRoot;const message=this.env.models['mail.message'].create(Object.assign(convertedData,{author:[['link',partnerRoot]],id:lastMessageId+0.01,isTransient:true,}));this._notifyThreadViewsMessageReceived(message);this.messaging.messagingMenu.update();}
_handleNotificationPartnerUnsubscribe(channelId){const channel=this.env.models['mail.thread'].find(thread=>thread.id===channelId&&thread.model==='mail.channel');if(!channel){return;}
let message;if(channel.correspondent){const correspondent=channel.correspondent;message=_.str.sprintf(this.env._t("You unpinned your conversation with <b>%s</b>."),owl.utils.escape(correspondent.name));}else{message=_.str.sprintf(this.env._t("You unsubscribed from <b>%s</b>."),owl.utils.escape(channel.name));}
channel.update({isServerPinned:false});this.env.services['notification'].notify({message,title:this.env._t("Unsubscribed"),type:'warning',});}
async _handleNotificationPartnerUserConnection({message,partner_id,title}){this.env.services['bus_service'].sendNotification(title,message);const chat=await this.async(()=>this.env.messaging.getChat({partnerId:partner_id}));if(!chat){return;}
this.env.messaging.chatWindowManager.openThread(chat);}
_notifyNewChannelMessageWhileOutOfFocus({channel,message}){const author=message.author;const messaging=this.env.messaging;let notificationTitle;if(!author){notificationTitle=this.env._t("New message");}else{const authorName=author.nameOrDisplayName;if(channel.channel_type==='channel'){const channelIcon=this.env.qweb.renderToString('mail.ThreadIcon',{env:this.env,thread:channel,});const channelName=owl.utils.escape(channel.displayName);const channelNameWithIcon=channelIcon+channelName;notificationTitle=_.str.sprintf(this.env._t("%s from %s"),owl.utils.escape(authorName),channelNameWithIcon);}else{notificationTitle=owl.utils.escape(authorName);}}
const notificationContent=message.prettyBody.substr(0,PREVIEW_MSG_MAX_SIZE);this.env.services['bus_service'].sendNotification(notificationTitle,notificationContent);messaging.update({outOfFocusUnreadMessageCounter:messaging.outOfFocusUnreadMessageCounter+1});const titlePattern=messaging.outOfFocusUnreadMessageCounter===1?this.env._t("%d Message"):this.env._t("%d Messages");this.env.bus.trigger('set_title_part',{part:'_chat',title:_.str.sprintf(titlePattern,messaging.outOfFocusUnreadMessageCounter),});}
_notifyThreadViewsMessageReceived(message){for(const thread of message.threads){for(const threadView of thread.threadViews){threadView.addComponentHint('message-received',{message});}}}}
MessagingNotificationHandler.fields={messaging:one2one('mail.messaging',{inverse:'notificationHandler',}),};MessagingNotificationHandler.modelName='mail.messaging_notification_handler';return MessagingNotificationHandler;}
registerNewModel('mail.messaging_notification_handler',factory);});;

/* /mail/static/src/models/model/model.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/Model',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{RecordDeletedError}=require('mail/static/src/model/model_errors.js');function factory(){class Model{constructor({valid=false}={}){if(!valid){throw new Error("Record must always be instantiated from static method 'create()'");}}
_willCreate(){}
_created(){}
_willDelete(){}
static all(filterFunc){return this.env.modelManager.all(this,filterFunc);}
static create(data){return this.env.modelManager.create(this,data);}
static find(findFunc){return this.env.modelManager.find(this,findFunc);}
static findFromIdentifyingData(data){return this.env.modelManager.findFromIdentifyingData(this,data);}
static get(localId,{isCheckingInheritance}={}){return this.env.modelManager.get(this,localId,{isCheckingInheritance});}
static insert(data){return this.env.modelManager.insert(this,data);}
async async(func){return new Promise((resolve,reject)=>{Promise.resolve(func()).then(result=>{if(this.exists()){resolve(result);}else{reject(new RecordDeletedError(this.localId));}}).catch(error=>{if(this.exists()){reject(error);}else{reject(new RecordDeletedError(this.localId));}});});}
delete(){this.env.modelManager.delete(this);}
exists(){return this.env.modelManager.exists(this.constructor,this);}
update(data={}){this.env.modelManager.update(this,data);}
static _createRecordLocalId(data){return _.uniqueId(`${this.modelName}_`);}
_updateAfter(previous){}
_updateBefore(){return{};}}
Model.fields={};Model.modelName='mail.model';return Model;}
registerNewModel('mail.model',factory);});;

/* /mail/static/src/models/notification/notification.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/notification/notification.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{attr,many2one}=require('mail/static/src/model/model_field.js');function factory(dependencies){class Notification extends dependencies['mail.model']{static convertData(data){const data2={};if('failure_type'in data){data2.failure_type=data.failure_type;}
if('id'in data){data2.id=data.id;}
if('notification_status'in data){data2.notification_status=data.notification_status;}
if('notification_type'in data){data2.notification_type=data.notification_type;}
if('res_partner_id'in data){if(!data.res_partner_id){data2.partner=[['unlink-all']];}else{data2.partner=[['insert',{display_name:data.res_partner_id[1],id:data.res_partner_id[0],}],];}}
return data2;}
static _createRecordLocalId(data){return`${this.modelName}_${data.id}`;}}
Notification.fields={failure_type:attr(),id:attr(),message:many2one('mail.message',{inverse:'notifications',}),notification_status:attr(),notification_type:attr(),partner:many2one('mail.partner'),};Notification.modelName='mail.notification';return Notification;}
registerNewModel('mail.notification',factory);});;

/* /mail/static/src/models/notification_group/notification_group.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/notification_group/notification_group.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{attr,many2one,one2many}=require('mail/static/src/model/model_field.js');function factory(dependencies){class NotificationGroup extends dependencies['mail.model']{openCancelAction(){if(this.notification_type!=='email'){return;}
this.env.bus.trigger('do-action',{action:'mail.mail_resend_cancel_action',options:{additional_context:{default_model:this.res_model,unread_counter:this.notifications.length,},},});}
openDocuments(){if(this.thread){this.thread.open();}else{this._openDocuments();}}
_computeThread(){if(this.res_id){return[['insert',{id:this.res_id,model:this.res_model,}]];}
return[['unlink']];}
static _createRecordLocalId(data){return`${this.modelName}_${data.id}`;}
_openDocuments(){if(this.notification_type!=='email'){return;}
this.env.bus.trigger('do-action',{action:{name:this.env._t("Mail Failures"),type:'ir.actions.act_window',view_mode:'kanban,list,form',views:[[false,'kanban'],[false,'list'],[false,'form']],target:'current',res_model:this.res_model,domain:[['message_has_error','=',true]],},});if(this.env.messaging.device.isMobile){this.env.messaging.messagingMenu.close();}}}
NotificationGroup.fields={date:attr(),id:attr(),notification_type:attr(),notifications:one2many('mail.notification'),res_id:attr(),res_model:attr(),res_model_name:attr(),thread:many2one('mail.thread',{compute:'_computeThread',dependencies:['res_id','res_model',],})};NotificationGroup.modelName='mail.notification_group';return NotificationGroup;}
registerNewModel('mail.notification_group',factory);});;

/* /mail/static/src/models/notification_group_manager/notification_group_manager.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/notification_group_manager/notification_group_manager.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{one2many}=require('mail/static/src/model/model_field.js');function factory(dependencies){class NotificationGroupManager extends dependencies['mail.model']{computeGroups(){for(const group of this.groups){group.delete();}
const groups=[];this.env.messaging.currentPartner.failureNotifications.forEach(notification=>{const thread=notification.message.originThread;const channelId=thread.model==='mail.channel'?thread.id:null;const id=`${thread.model}/${channelId}/${notification.notification_type}`;const group=this.env.models['mail.notification_group'].insert({id,notification_type:notification.notification_type,res_model:thread.model,res_model_name:thread.model_name,});group.update({notifications:[['link',notification]]});let res_id=group.res_id;if(group.res_id===undefined){res_id=thread.id;}else if(group.res_id!==thread.id){res_id=null;}
let date=group.date;if(!date){date=notification.message.date;}else{date=moment.max(group.date,notification.message.date);}
group.update({date,res_id,});if(!groups.includes(group)){groups.push(group);}});this.update({groups:[['link',groups]]});}}
NotificationGroupManager.fields={groups:one2many('mail.notification_group'),};NotificationGroupManager.modelName='mail.notification_group_manager';return NotificationGroupManager;}
registerNewModel('mail.notification_group_manager',factory);});;

/* /mail/static/src/models/partner/partner.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/partner/partner.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{attr,many2many,many2one,one2many,one2one}=require('mail/static/src/model/model_field.js');const utils=require('web.utils');function factory(dependencies){class Partner extends dependencies['mail.model']{static convertData(data){const data2={};if('active'in data){data2.active=data.active;}
if('country'in data){if(!data.country){data2.country=[['unlink-all']];}else{data2.country=[['insert',{id:data.country[0],name:data.country[1],}]];}}
if('display_name'in data){data2.display_name=data.display_name;}
if('email'in data){data2.email=data.email;}
if('id'in data){data2.id=data.id;}
if('im_status'in data){data2.im_status=data.im_status;}
if('name'in data){data2.name=data.name;}
if('user_id'in data){if(!data.user_id){data2.user=[['unlink-all']];}else{let user={};if(Array.isArray(data.user_id)){user={id:data.user_id[0],display_name:data.user_id[1],};}else{user={id:data.user_id,};}
data2.user=[['insert',user]];}}
return data2;}
static async imSearch({callback,keyword,limit=10}){let partners=[];const searchRegexp=new RegExp(_.str.escapeRegExp(utils.unaccent(keyword)),'i');const currentPartner=this.env.messaging.currentPartner;for(const partner of this.all(partner=>partner.active)){if(partners.length<limit){if(partner!==currentPartner&&searchRegexp.test(partner.name)){partners.push(partner);}}}
if(!partners.length){const partnersData=await this.env.services.rpc({model:'res.partner',method:'im_search',args:[keyword,limit]},{shadow:true});const newPartners=this.insert(partnersData.map(partnerData=>this.convertData(partnerData)));partners.push(...newPartners);}
callback(partners);}
static async startLoopFetchImStatus(){await this._fetchImStatus();this._loopFetchImStatus();}
async checkIsUser(){const userIds=await this.async(()=>this.env.services.rpc({model:'res.users',method:'search',args:[[['partner_id','=',this.id]]],kwargs:{context:{active_test:false},},},{shadow:true}));this.update({hasCheckedUser:true});if(userIds.length>0){this.update({user:[['insert',{id:userIds[0]}]]});}}
async getChat(){if(!this.user&&!this.hasCheckedUser){await this.async(()=>this.checkIsUser());}
if(!this.user){this.env.services['notification'].notify({message:this.env._t("You can only chat with partners that have a dedicated user."),type:'info',});return;}
return this.user.getChat();}
async openChat(options){const chat=await this.async(()=>this.getChat());if(!chat){return;}
await this.async(()=>chat.open(options));return chat;}
async openProfile(){return this.env.messaging.openDocument({id:this.id,model:'res.partner',});}
_computeAvatarUrl(){return`/web/image/res.partner/${this.id}/image_128`;}
static _createRecordLocalId(data){return`${this.modelName}_${data.id}`;}
static async _fetchImStatus(){const partnerIds=[];for(const partner of this.all()){if(partner.im_status!=='im_partner'&&partner.id>0){partnerIds.push(partner.id);}}
if(partnerIds.length===0){return;}
const dataList=await this.env.services.rpc({route:'/longpolling/im_status',params:{partner_ids:partnerIds,},},{shadow:true});this.insert(dataList);}
static _loopFetchImStatus(){setTimeout(async()=>{await this._fetchImStatus();this._loopFetchImStatus();},50*1000);}
_computeDisplayName(){return this.display_name||this.user&&this.user.display_name;}
_computeNameOrDisplayName(){return this.name||this.display_name;}}
Partner.fields={active:attr({default:true,}),avatarUrl:attr({compute:'_computeAvatarUrl',dependencies:['id',],}),correspondentThreads:one2many('mail.thread',{inverse:'correspondent',}),country:many2one('mail.country'),display_name:attr({compute:'_computeDisplayName',default:"",dependencies:['display_name','userDisplayName',],}),email:attr(),failureNotifications:one2many('mail.notification',{related:'messagesAsAuthor.failureNotifications',}),hasCheckedUser:attr({default:false,}),id:attr(),im_status:attr(),memberThreads:many2many('mail.thread',{inverse:'members',}),messagesAsAuthor:one2many('mail.message',{inverse:'author',}),model:attr({default:'res.partner',}),moderatedChannels:many2many('mail.thread',{inverse:'moderators',}),name:attr(),nameOrDisplayName:attr({compute:'_computeNameOrDisplayName',dependencies:['display_name','name',],}),user:one2one('mail.user',{inverse:'partner',}),userDisplayName:attr({related:'user.display_name',}),};Partner.modelName='mail.partner';return Partner;}
registerNewModel('mail.partner',factory);});;

/* /mail/static/src/models/suggested_recipient_info/suggested_recipient_info.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/suggested_recipient_info/suggested_recipient_info.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{attr,many2one}=require('mail/static/src/model/model_field.js');function factory(dependencies){class SuggestedRecipientInfo extends dependencies['mail.model']{_computeEmail(){return this.partner&&this.partner.email||this.email;}
_computeIsSelected(){return this.partner?this.isSelected:false;}
_computeName(){return this.partner&&this.partner.nameOrDisplayName||this.name;}}
SuggestedRecipientInfo.fields={email:attr({compute:'_computeEmail',dependencies:['email','partnerEmail',],}),isSelected:attr({compute:'_computeIsSelected',default:true,dependencies:['isSelected','partner',],}),name:attr({compute:'_computeName',dependencies:['name','partnerNameOrDisplayName',],}),partner:many2one('mail.partner'),partnerEmail:attr({related:'partner.email'}),partnerNameOrDisplayName:attr({related:'partner.nameOrDisplayName'}),reason:attr(),thread:many2one('mail.thread',{inverse:'suggestedRecipientInfoList',}),};SuggestedRecipientInfo.modelName='mail.suggested_recipient_info';return SuggestedRecipientInfo;}
registerNewModel('mail.suggested_recipient_info',factory);});;

/* /mail/static/src/models/thread/thread.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/thread/thread.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{attr,many2many,many2one,one2many,one2one}=require('mail/static/src/model/model_field.js');const{clear}=require('mail/static/src/model/model_field_command.js');const throttle=require('mail/static/src/utils/throttle/throttle.js');const Timer=require('mail/static/src/utils/timer/timer.js');const mailUtils=require('mail.utils');function factory(dependencies){class Thread extends dependencies['mail.model']{_willCreate(){const res=super._willCreate(...arguments);this._currentPartnerInactiveTypingTimer=new Timer(this.env,()=>this.async(()=>this._onCurrentPartnerInactiveTypingTimeout()),5*1000);this._currentPartnerLastNotifiedIsTyping=undefined;this._currentPartnerLongTypingTimer=new Timer(this.env,()=>this.async(()=>this._onCurrentPartnerLongTypingTimeout()),50*1000);this._forceNotifyNextCurrentPartnerTypingStatus=false;this._otherMembersLongTypingTimers=new Map();this._throttleNotifyCurrentPartnerTypingStatus=throttle(this.env,({isTyping})=>this.async(()=>this._notifyCurrentPartnerTypingStatus({isTyping})),2.5*1000);return res;}
_willDelete(){this._currentPartnerInactiveTypingTimer.clear();this._currentPartnerLongTypingTimer.clear();this._throttleNotifyCurrentPartnerTypingStatus.clear();for(const timer of this._otherMembersLongTypingTimers.values()){timer.clear();}
if(this.isTemporary){for(const message of this.messages){message.delete();}}
return super._willDelete(...arguments);}
static computeLastCurrentPartnerMessageSeenByEveryone(thread=undefined){const threads=thread?[thread]:this.env.models['mail.thread'].all();threads.map(localThread=>{localThread.update({lastCurrentPartnerMessageSeenByEveryone:localThread._computeLastCurrentPartnerMessageSeenByEveryone(),});});}
static convertData(data){const data2={messagesAsServerChannel:[],};if('model'in data){data2.model=data.model;}
if('channel_type'in data){data2.channel_type=data.channel_type;data2.model='mail.channel';}
if('create_uid'in data){data2.creator=[['insert',{id:data.create_uid}]];}
if('custom_channel_name'in data){data2.custom_channel_name=data.custom_channel_name;}
if('group_based_subscription'in data){data2.group_based_subscription=data.group_based_subscription;}
if('id'in data){data2.id=data.id;}
if('is_minimized'in data&&'state'in data){data2.serverFoldState=data.is_minimized?data.state:'closed';}
if('is_moderator'in data){data2.is_moderator=data.is_moderator;}
if('is_pinned'in data){data2.isServerPinned=data.is_pinned;}
if('last_message'in data&&data.last_message){data2.messagesAsServerChannel.push(['insert',{id:data.last_message.id}]);data2.serverLastMessageId=data.last_message.id;}
if('last_message_id'in data&&data.last_message_id){data2.messagesAsServerChannel.push(['insert',{id:data.last_message_id}]);data2.serverLastMessageId=data.last_message_id;}
if('mass_mailing'in data){data2.mass_mailing=data.mass_mailing;}
if('moderation'in data){data2.moderation=data.moderation;}
if('message_needaction_counter'in data){data2.message_needaction_counter=data.message_needaction_counter;}
if('message_unread_counter'in data){data2.serverMessageUnreadCounter=data.message_unread_counter;}
if('name'in data){data2.name=data.name;}
if('public'in data){data2.public=data.public;}
if('seen_message_id'in data){data2.lastSeenByCurrentPartnerMessageId=data.seen_message_id||0;}
if('uuid'in data){data2.uuid=data.uuid;}
if('members'in data){if(!data.members){data2.members=[['unlink-all']];}else{data2.members=[['insert-and-replace',data.members.map(memberData=>this.env.models['mail.partner'].convertData(memberData))],];}}
if('seen_partners_info'in data){if(!data.seen_partners_info){data2.partnerSeenInfos=[['unlink-all']];}else{data2.partnerSeenInfos=[['insert-and-replace',data.seen_partners_info.map(({fetched_message_id,partner_id,seen_message_id})=>{return{channelId:data2.id,lastFetchedMessage:[fetched_message_id?['insert',{id:fetched_message_id}]:['unlink-all']],lastSeenMessage:[seen_message_id?['insert',{id:seen_message_id}]:['unlink-all']],partnerId:partner_id,};})]];if(data.id||this.id){const messageIds=data.seen_partners_info.reduce((currentSet,{fetched_message_id,seen_message_id})=>{if(fetched_message_id){currentSet.add(fetched_message_id);}
if(seen_message_id){currentSet.add(seen_message_id);}
return currentSet;},new Set());if(messageIds.size>0){data2.messageSeenIndicators=[['insert',[...messageIds].map(messageId=>{return{channelId:data.id||this.id,messageId,};})]];}}}}
return data2;}
static async loadPreviews(threads){const channelIds=threads.reduce((list,thread)=>{if(thread.model==='mail.channel'){return list.concat(thread.id);}
return list;},[]);if(channelIds.length===0){return;}
const channelPreviews=await this.env.services.rpc({model:'mail.channel',method:'channel_fetch_preview',args:[channelIds],},{shadow:true});this.env.models['mail.message'].insert(channelPreviews.filter(p=>p.last_message).map(channelPreview=>this.env.models['mail.message'].convertData(channelPreview.last_message)));}
static async performRpcChannelFold(uuid,state){return this.env.services.rpc({model:'mail.channel',method:'channel_fold',kwargs:{state,uuid,}},{shadow:true});}
static async performRpcChannelInfo({ids}){const channelInfos=await this.env.services.rpc({model:'mail.channel',method:'channel_info',args:[ids],},{shadow:true});const channels=this.env.models['mail.thread'].insert(channelInfos.map(channelInfo=>this.env.models['mail.thread'].convertData(channelInfo)));this.env.messaging.messagingMenu.update();return channels;}
static async performRpcChannelSeen({ids,lastMessageId}){return this.env.services.rpc({model:'mail.channel',method:'channel_seen',args:[ids],kwargs:{last_message_id:lastMessageId,},},{shadow:true});}
static async performRpcChannelPin({pinned=false,uuid}){return this.env.services.rpc({model:'mail.channel',method:'channel_pin',kwargs:{uuid,pinned,},},{shadow:true});}
static async performRpcCreateChannel({name,privacy}){const device=this.env.messaging.device;const data=await this.env.services.rpc({model:'mail.channel',method:'channel_create',args:[name,privacy],kwargs:{context:Object.assign({},this.env.session.user_content,{isMobile:device.isMobile,}),},});return this.env.models['mail.thread'].insert(this.env.models['mail.thread'].convertData(data));}
static async performRpcCreateChat({partnerIds,pinForCurrentPartner}){const device=this.env.messaging.device;const data=await this.env.services.rpc({model:'mail.channel',method:'channel_get',kwargs:{context:Object.assign({},this.env.session.user_content,{isMobile:device.isMobile,}),partners_to:partnerIds,pin:pinForCurrentPartner,},});if(!data){return;}
return this.env.models['mail.thread'].insert(this.env.models['mail.thread'].convertData(data));}
static async performRpcJoinChannel({channelId}){const device=this.env.messaging.device;const data=await this.env.services.rpc({model:'mail.channel',method:'channel_join_and_get_info',args:[[channelId]],kwargs:{context:Object.assign({},this.env.session.user_content,{isMobile:device.isMobile,}),},});return this.env.models['mail.thread'].insert(this.env.models['mail.thread'].convertData(data));}
static async performRpcExecuteCommand({channelId,command,postData={}}){return this.env.services.rpc({model:'mail.channel',method:'execute_command',args:[[channelId]],kwargs:Object.assign({command},postData),});}
static async performRpcMessagePost({postData,threadId,threadModel}){return this.env.services.rpc({model:threadModel,method:'message_post',args:[threadId],kwargs:postData,});}
static async performRpcMailGetSuggestedRecipients({model,res_ids}){const data=await this.env.services.rpc({route:'/mail/get_suggested_recipients',params:{model,res_ids,},},{shadow:true});for(const id in data){const recipientInfoList=data[id].map(recipientInfoData=>{const[partner_id,emailInfo,reason]=recipientInfoData;const[name,email]=emailInfo&&mailUtils.parseEmail(emailInfo);return{email,name,partner:[partner_id?['insert',{id:partner_id}]:['unlink']],reason,};});this.insert({id:parseInt(id),model,suggestedRecipientInfoList:[['insert-and-replace',recipientInfoList]],});}}
cache(stringifiedDomain='[]'){let cache=this.caches.find(cache=>cache.stringifiedDomain===stringifiedDomain);if(!cache){cache=this.env.models['mail.thread_cache'].create({stringifiedDomain,thread:[['link',this]],});}
return cache;}
async fetchAttachments(){const attachmentsData=await this.async(()=>this.env.services.rpc({model:'ir.attachment',method:'search_read',domain:[['res_id','=',this.id],['res_model','=',this.model],],fields:['id','name','mimetype'],orderBy:[{name:'id',asc:false}],},{shadow:true}));this.update({originThreadAttachments:[['insert-and-replace',attachmentsData.map(data=>this.env.models['mail.attachment'].convertData(data))]],});this.update({areAttachmentsLoaded:true});}
async fetchAndUpdateSuggestedRecipients(){if(this.isTemporary){return;}
return this.env.models['mail.thread'].performRpcMailGetSuggestedRecipients({model:this.model,res_ids:[this.id],});}
async follow(){await this.async(()=>this.env.services.rpc({model:this.model,method:'message_subscribe',args:[[this.id]],kwargs:{partner_ids:[this.env.messaging.currentPartner.id],context:{},},}));this.refreshFollowers();this.fetchAndUpdateSuggestedRecipients();}
loadNewMessages(){this.mainCache.loadNewMessages();}
async markAsFetched(){await this.async(()=>this.env.services.rpc({model:'mail.channel',method:'channel_fetched',args:[[this.id]],},{shadow:true}));}
async markAsSeen(message){if(this.model!=='mail.channel'){return;}
if(this.pendingSeenMessageId&&message.id<=this.pendingSeenMessageId){return;}
if(this.lastSeenByCurrentPartnerMessageId&&message.id<=this.lastSeenByCurrentPartnerMessageId){return;}
this.update({pendingSeenMessageId:message.id});return this.env.models['mail.thread'].performRpcChannelSeen({ids:[this.id],lastMessageId:message.id,});}
async markNeedactionMessagesAsRead(){await this.async(()=>this.env.models['mail.message'].markAsRead(this.needactionMessages));}
async notifyFoldStateToServer(state){if(this.model!=='mail.channel'){return;}
if(!this.uuid){return;}
return this.env.models['mail.thread'].performRpcChannelFold(this.uuid,state);}
async notifyPinStateToServer(){if(this.isPendingPinned){await this.env.models['mail.thread'].performRpcChannelPin({pinned:true,uuid:this.uuid,});}else{this.env.models['mail.thread'].performRpcExecuteCommand({channelId:this.id,command:'leave',});}}
async open({expanded=false}={}){const discuss=this.env.messaging.discuss;if(!['mail.box','mail.channel'].includes(this.model)){if(expanded||discuss.isOpen){this.env.messaging.chatWindowManager.closeThread(this);return this.env.messaging.openDocument({id:this.id,model:this.model,});}}
const device=this.env.messaging.device;if((!device.isMobile&&(discuss.isOpen||expanded))||this.model==='mail.box'){return discuss.openThread(this);}
return this.env.messaging.chatWindowManager.openThread(this,{makeActive:true,});}
async openProfile(){return this.env.messaging.openDocument({id:this.id,model:this.model,});}
async pin(){this.update({isPendingPinned:true});await this.notifyPinStateToServer();}
promptAddChannelFollower(){this._promptAddFollower({mail_invite_follower_channel_only:true});}
promptAddPartnerFollower(){this._promptAddFollower({mail_invite_follower_channel_only:false});}
async refresh(){if(this.isTemporary){return;}
this.loadNewMessages();this.update({isLoadingAttachments:true});await this.async(()=>this.fetchAttachments());this.update({isLoadingAttachments:false});}
async refreshActivities(){if(!this.hasActivities){return;}
if(this.isTemporary){return;}
const[{activity_ids:newActivityIds}]=await this.async(()=>this.env.services.rpc({model:this.model,method:'read',args:[this.id,['activity_ids']]},{shadow:true}));const activitiesData=await this.async(()=>this.env.services.rpc({model:'mail.activity',method:'activity_format',args:[newActivityIds]},{shadow:true}));const activities=this.env.models['mail.activity'].insert(activitiesData.map(activityData=>this.env.models['mail.activity'].convertData(activityData)));this.update({activities:[['replace',activities]]});}
async refreshFollowers(){if(this.isTemporary){this.update({followers:[['unlink-all']]});return;}
const{followers}=await this.async(()=>this.env.services.rpc({route:'/mail/read_followers',params:{res_id:this.id,res_model:this.model,},},{shadow:true}));if(followers.length>0){this.update({followers:[['insert-and-replace',followers.map(data=>this.env.models['mail.follower'].convertData(data))]],});}else{this.update({followers:[['unlink-all']],});}}
refreshCurrentPartnerIsTyping(){this._currentPartnerInactiveTypingTimer.reset();}
refreshOtherMemberTypingMember(partner){this._otherMembersLongTypingTimers.get(partner).reset();}
async registerCurrentPartnerIsTyping(){this._currentPartnerInactiveTypingTimer.start();this._currentPartnerLongTypingTimer.start();const currentPartner=this.env.messaging.currentPartner;const newOrderedTypingMemberLocalIds=this.orderedTypingMemberLocalIds.filter(localId=>localId!==currentPartner.localId);newOrderedTypingMemberLocalIds.push(currentPartner.localId);this.update({orderedTypingMemberLocalIds:newOrderedTypingMemberLocalIds,typingMembers:[['link',currentPartner]],});await this._throttleNotifyCurrentPartnerTypingStatus({isTyping:true});}
registerOtherMemberTypingMember(partner){const timer=new Timer(this.env,()=>this.async(()=>this._onOtherMemberLongTypingTimeout(partner)),60*1000);this._otherMembersLongTypingTimers.set(partner,timer);timer.start();const newOrderedTypingMemberLocalIds=this.orderedTypingMemberLocalIds.filter(localId=>localId!==partner.localId);newOrderedTypingMemberLocalIds.push(partner.localId);this.update({orderedTypingMemberLocalIds:newOrderedTypingMemberLocalIds,typingMembers:[['link',partner]],});}
async rename(newName){if(this.channel_type==='chat'){await this.async(()=>this.env.services.rpc({model:'mail.channel',method:'channel_set_custom_name',args:[this.id],kwargs:{name:newName,},}));}
this.update({custom_channel_name:newName});}
async unfollow(){const currentPartnerFollower=this.followers.find(follower=>follower.partner===this.env.messaging.currentPartner);await this.async(()=>currentPartnerFollower.remove());}
async unpin(){this.update({isPendingPinned:false});await this.notifyPinStateToServer();}
async unregisterCurrentPartnerIsTyping({immediateNotify=false}={}){this._currentPartnerInactiveTypingTimer.clear();this._currentPartnerLongTypingTimer.clear();const currentPartner=this.env.messaging.currentPartner;const newOrderedTypingMemberLocalIds=this.orderedTypingMemberLocalIds.filter(localId=>localId!==currentPartner.localId);this.update({orderedTypingMemberLocalIds:newOrderedTypingMemberLocalIds,typingMembers:[['unlink',currentPartner]],});if(immediateNotify){this._throttleNotifyCurrentPartnerTypingStatus.clear();}
await this.async(()=>this._throttleNotifyCurrentPartnerTypingStatus({isTyping:false}));}
unregisterOtherMemberTypingMember(partner){this._otherMembersLongTypingTimers.get(partner).clear();this._otherMembersLongTypingTimers.delete(partner);const newOrderedTypingMemberLocalIds=this.orderedTypingMemberLocalIds.filter(localId=>localId!==partner.localId);this.update({orderedTypingMemberLocalIds:newOrderedTypingMemberLocalIds,typingMembers:[['unlink',partner]],});}
unsubscribe(){this.env.messaging.chatWindowManager.closeThread(this);this.unpin();}
static _createRecordLocalId(data){const{channel_type,id,model}=data;let threadModel=model;if(!threadModel&&channel_type){threadModel='mail.channel';}
return`${this.modelName}_${threadModel}_${id}`;}
_computeAllAttachments(){const allAttachments=[...new Set(this.originThreadAttachments.concat(this.attachments))].sort((a1,a2)=>{if(!a1.isTemporary&&a2.isTemporary){return 1;}
if(a1.isTemporary&&!a2.isTemporary){return-1;}
return Math.abs(a2.id)-Math.abs(a1.id);});return[['replace',allAttachments]];}
_computeCorrespondent(){if(this.channel_type==='channel'){return[['unlink']];}
const correspondents=this.members.filter(partner=>partner!==this.env.messaging.currentPartner);if(correspondents.length===1){return[['link',correspondents[0]]];}
if(this.members.length===1){return[['link',this.members[0]]];}
return[['unlink']];}
_computeDisplayName(){if(this.channel_type==='chat'&&this.correspondent){return this.custom_channel_name||this.correspondent.nameOrDisplayName;}
return this.name;}
_computeFutureActivities(){return[['replace',this.activities.filter(activity=>activity.state==='planned')]];}
_computeHasSeenIndicators(){if(this.model!=='mail.channel'){return false;}
if(this.mass_mailing){return false;}
return['chat','livechat'].includes(this.channel_type);}
_computeIsChatChannel(){return this.channel_type==='chat';}
_computeIsCurrentPartnerFollowing(){return this.followers.some(follower=>follower.partner&&follower.partner===this.env.messaging.currentPartner);}
_computeIsModeratedByCurrentPartner(){if(!this.messaging){return false;}
if(!this.messaging.currentPartner){return false;}
return this.moderators.includes(this.env.messaging.currentPartner);}
_computeIsPinned(){return this.isPendingPinned!==undefined?this.isPendingPinned:this.isServerPinned;}
_computeLastCurrentPartnerMessageSeenByEveryone(){const otherPartnerSeenInfos=this.partnerSeenInfos.filter(partnerSeenInfo=>partnerSeenInfo.partner!==this.messagingCurrentPartner);if(otherPartnerSeenInfos.length===0){return[['unlink-all']];}
const otherPartnersLastSeenMessageIds=otherPartnerSeenInfos.map(partnerSeenInfo=>partnerSeenInfo.lastSeenMessage?partnerSeenInfo.lastSeenMessage.id:0);if(otherPartnersLastSeenMessageIds.length===0){return[['unlink-all']];}
const lastMessageSeenByAllId=Math.min(...otherPartnersLastSeenMessageIds);const currentPartnerOrderedSeenMessages=this.orderedNonTransientMessages.filter(message=>message.author===this.messagingCurrentPartner&&message.id<=lastMessageSeenByAllId);if(!currentPartnerOrderedSeenMessages||currentPartnerOrderedSeenMessages.length===0){return[['unlink-all']];}
return[['link',currentPartnerOrderedSeenMessages.slice().pop()]];}
_computeLastMessage(){const{length:l,[l-1]:lastMessage,}=this.orderedMessages;if(lastMessage){return[['link',lastMessage]];}
return[['unlink']];}
_computeLastNonTransientMessage(){const{length:l,[l-1]:lastMessage,}=this.orderedNonTransientMessages;if(lastMessage){return[['link',lastMessage]];}
return[['unlink']];}
_computeLastSeenByCurrentPartnerMessageId(){const firstMessage=this.orderedMessages[0];if(firstMessage&&this.lastSeenByCurrentPartnerMessageId&&this.lastSeenByCurrentPartnerMessageId<firstMessage.id){return this.lastSeenByCurrentPartnerMessageId;}
let lastSeenByCurrentPartnerMessageId=this.lastSeenByCurrentPartnerMessageId;for(const message of this.orderedMessages){if(message.id<=this.lastSeenByCurrentPartnerMessageId){continue;}
if(message.author===this.env.messaging.currentPartner||message.isTransient){lastSeenByCurrentPartnerMessageId=message.id;continue;}
return lastSeenByCurrentPartnerMessageId;}
return lastSeenByCurrentPartnerMessageId;}
_computeLastNeedactionMessage(){const orderedNeedactionMessages=this.needactionMessages.sort((m1,m2)=>m1.id<m2.id?-1:1);const{length:l,[l-1]:lastNeedactionMessage,}=orderedNeedactionMessages;if(lastNeedactionMessage){return[['link',lastNeedactionMessage]];}
return[['unlink']];}
_computeMainCache(){return[['link',this.cache()]];}
_computeLocalMessageUnreadCounter(){let baseCounter=this.serverMessageUnreadCounter;let countFromId=this.serverLastMessageId;const firstMessage=this.orderedMessages[0];if(firstMessage&&this.lastSeenByCurrentPartnerMessageId&&this.lastSeenByCurrentPartnerMessageId>=firstMessage.id){baseCounter=0;countFromId=this.lastSeenByCurrentPartnerMessageId;}
return this.orderedMessages.reduce((total,message)=>{if(message.id<=countFromId){return total;}
return total+1;},baseCounter);}
_computeMessaging(){return[['link',this.env.messaging]];}
_computeNeedactionMessages(){return[['replace',this.messages.filter(message=>message.isNeedaction)]];}
_computeMessageAfterNewMessageSeparator(){if(this.model!=='mail.channel'){return[['unlink']];}
if(this.localMessageUnreadCounter===0){return[['unlink']];}
const index=this.orderedMessages.findIndex(message=>message.id===this.lastSeenByCurrentPartnerMessageId);const message=this.orderedMessages[index+1];if(!message){return[['unlink']];}
return[['link',message]];}
_computeOrderedMessages(){return[['replace',this.messages.sort((m1,m2)=>m1.id<m2.id?-1:1)]];}
_computeOrderedNonTransientMessages(){return[['replace',this.orderedMessages.filter(m=>!m.isTransient)]];}
_computeOrderedOtherTypingMembers(){return[['replace',this.orderedTypingMembers.filter(member=>member!==this.env.messaging.currentPartner),]];}
_computeOrderedTypingMembers(){return[['replace',this.orderedTypingMemberLocalIds.map(localId=>this.env.models['mail.partner'].get(localId)).filter(member=>!!member),]];}
_computeOverdueActivities(){return[['replace',this.activities.filter(activity=>activity.state==='overdue')]];}
_computeTodayActivities(){return[['replace',this.activities.filter(activity=>activity.state==='today')]];}
_computeTypingStatusText(){if(this.orderedOtherTypingMembers.length===0){return this.constructor.fields.typingStatusText.default;}
if(this.orderedOtherTypingMembers.length===1){return _.str.sprintf(this.env._t("%s is typing..."),this.orderedOtherTypingMembers[0].nameOrDisplayName);}
if(this.orderedOtherTypingMembers.length===2){return _.str.sprintf(this.env._t("%s and %s are typing..."),this.orderedOtherTypingMembers[0].nameOrDisplayName,this.orderedOtherTypingMembers[1].nameOrDisplayName);}
return _.str.sprintf(this.env._t("%s, %s and more are typing..."),this.orderedOtherTypingMembers[0].nameOrDisplayName,this.orderedOtherTypingMembers[1].nameOrDisplayName);}
async _notifyCurrentPartnerTypingStatus({isTyping}){if(this._forceNotifyNextCurrentPartnerTypingStatus||isTyping!==this._currentPartnerLastNotifiedIsTyping){if(this.model==='mail.channel'){await this.async(()=>this.env.services.rpc({model:'mail.channel',method:'notify_typing',args:[this.id],kwargs:{is_typing:isTyping},},{shadow:true}));}
if(isTyping&&this._currentPartnerLongTypingTimer.isRunning){this._currentPartnerLongTypingTimer.reset();}}
this._forceNotifyNextCurrentPartnerTypingStatus=false;this._currentPartnerLastNotifiedIsTyping=isTyping;}
_onIsServerPinnedChanged(){if(this.isServerPinned===this.isPendingPinned){this.update({isPendingPinned:clear()});}}
_onServerFoldStateChanged(){if(!this.env.messaging.chatWindowManager){return;}
if(this.serverFoldState==='closed'){this.env.messaging.chatWindowManager.closeThread(this,{notifyServer:false,});}else{this.env.messaging.chatWindowManager.openThread(this,{isFolded:this.serverFoldState==='folded',notifyServer:false,});}}
_promptAddFollower({mail_invite_follower_channel_only=false}={}){const self=this;const action={type:'ir.actions.act_window',res_model:'mail.wizard.invite',view_mode:'form',views:[[false,'form']],name:this.env._t("Invite Follower"),target:'new',context:{default_res_model:this.model,default_res_id:this.id,mail_invite_follower_channel_only,},};this.env.bus.trigger('do-action',{action,options:{on_close:async()=>{await this.async(()=>this.refreshFollowers());this.env.bus.trigger('mail.thread:promptAddFollower-closed');},},});}
async _onCurrentPartnerInactiveTypingTimeout(){await this.async(()=>this.unregisterCurrentPartnerIsTyping());}
async _onCurrentPartnerLongTypingTimeout(){this._forceNotifyNextCurrentPartnerTypingStatus=true;this._throttleNotifyCurrentPartnerTypingStatus.clear();await this.async(()=>this._throttleNotifyCurrentPartnerTypingStatus({isTyping:true}));}
async _onOtherMemberLongTypingTimeout(partner){if(!this.typingMembers.includes(partner)){this._otherMembersLongTypingTimers.delete(partner);return;}
this.unregisterOtherMemberTypingMember(partner);}}
Thread.fields={activities:one2many('mail.activity',{inverse:'thread',}),activitiesState:attr({related:'activities.state',}),allAttachments:many2many('mail.attachment',{compute:'_computeAllAttachments',dependencies:['attachments','originThreadAttachments',],}),areAttachmentsLoaded:attr({default:false,}),attachments:many2many('mail.attachment',{inverse:'threads',}),caches:one2many('mail.thread_cache',{inverse:'thread',isCausal:true,}),channel_type:attr(),chatWindow:one2one('mail.chat_window',{inverse:'thread',}),chatWindowIsFolded:attr({related:'chatWindow.isFolded',}),composer:one2one('mail.composer',{default:[['create']],inverse:'thread',isCausal:true,}),correspondent:many2one('mail.partner',{compute:'_computeCorrespondent',dependencies:['channel_type','members','messagingCurrentPartner',],inverse:'correspondentThreads',}),correspondentNameOrDisplayName:attr({related:'correspondent.nameOrDisplayName',}),counter:attr({default:0,}),creator:many2one('mail.user'),custom_channel_name:attr(),displayName:attr({compute:'_computeDisplayName',dependencies:['channel_type','correspondent','correspondentNameOrDisplayName','custom_channel_name','name',],}),followersPartner:many2many('mail.partner',{related:'followers.partner',}),followers:one2many('mail.follower',{inverse:'followedThread',}),futureActivities:one2many('mail.activity',{compute:'_computeFutureActivities',dependencies:['activitiesState'],}),group_based_subscription:attr({default:false,}),hasActivities:attr({default:false,}),hasSeenIndicators:attr({compute:'_computeHasSeenIndicators',default:false,dependencies:['channel_type','mass_mailing','model',],}),id:attr(),isChatChannel:attr({compute:'_computeIsChatChannel',dependencies:['channel_type',],default:false,}),isCurrentPartnerFollowing:attr({compute:'_computeIsCurrentPartnerFollowing',default:false,dependencies:['followersPartner','messagingCurrentPartner',],}),isLoadingAttachments:attr({default:false,}),isModeratedByCurrentPartner:attr({compute:'_computeIsModeratedByCurrentPartner',dependencies:['messagingCurrentPartner','moderators',],}),isPendingPinned:attr(),isPinned:attr({compute:'_computeIsPinned',dependencies:['isPendingPinned','isServerPinned',],}),isServerPinned:attr({default:false,}),isTemporary:attr({default:false,}),is_moderator:attr({default:false,}),lastCurrentPartnerMessageSeenByEveryone:many2one('mail.message',{compute:'_computeLastCurrentPartnerMessageSeenByEveryone',dependencies:['messagingCurrentPartner','orderedNonTransientMessages','partnerSeenInfos',],}),lastMessage:many2one('mail.message',{compute:'_computeLastMessage',dependencies:['orderedMessages'],}),lastNeedactionMessage:many2one('mail.message',{compute:'_computeLastNeedactionMessage',dependencies:['needactionMessages'],}),lastNonTransientMessage:many2one('mail.message',{compute:'_computeLastNonTransientMessage',dependencies:['orderedNonTransientMessages'],}),lastSeenByCurrentPartnerMessageId:attr({compute:'_computeLastSeenByCurrentPartnerMessageId',default:0,dependencies:['lastSeenByCurrentPartnerMessageId','messagingCurrentPartner','orderedMessages','orderedMessagesIsTransient',],}),localMessageUnreadCounter:attr({compute:'_computeLocalMessageUnreadCounter',dependencies:['lastSeenByCurrentPartnerMessageId','messagingCurrentPartner','orderedMessages','serverLastMessageId','serverMessageUnreadCounter',],}),mainCache:one2one('mail.thread_cache',{compute:'_computeMainCache',}),mass_mailing:attr({default:false,}),members:many2many('mail.partner',{inverse:'memberThreads',}),messageAfterNewMessageSeparator:many2one('mail.message',{compute:'_computeMessageAfterNewMessageSeparator',dependencies:['lastSeenByCurrentPartnerMessageId','localMessageUnreadCounter','model','orderedMessages',],}),message_needaction_counter:attr({default:0,}),messages:many2many('mail.message',{inverse:'threads',}),messagesAsServerChannel:many2many('mail.message',{inverse:'serverChannels',}),messageSeenIndicators:one2many('mail.message_seen_indicator',{inverse:'thread',isCausal:true,}),messaging:many2one('mail.messaging',{compute:'_computeMessaging',}),messagingCurrentPartner:many2one('mail.partner',{related:'messaging.currentPartner',}),model:attr(),model_name:attr(),moderation:attr({default:false,}),moderators:many2many('mail.partner',{inverse:'moderatedChannels',}),moduleIcon:attr(),name:attr(),needactionMessages:many2many('mail.message',{compute:'_computeNeedactionMessages',dependencies:['messages'],}),onIsServerPinnedChanged:attr({compute:'_onIsServerPinnedChanged',dependencies:['isServerPinned',],}),onServerFoldStateChanged:attr({compute:'_onServerFoldStateChanged',dependencies:['serverFoldState',],}),orderedMessages:many2many('mail.message',{compute:'_computeOrderedMessages',dependencies:['messages'],}),orderedMessagesIsTransient:attr({related:'orderedMessages.isTransient',}),orderedNonTransientMessages:many2many('mail.message',{compute:'_computeOrderedNonTransientMessages',dependencies:['orderedMessages','orderedMessagesIsTransient',],}),orderedOtherTypingMembers:many2many('mail.partner',{compute:'_computeOrderedOtherTypingMembers',dependencies:['orderedTypingMembers'],}),orderedTypingMembers:many2many('mail.partner',{compute:'_computeOrderedTypingMembers',dependencies:['orderedTypingMemberLocalIds','typingMembers',],}),orderedTypingMemberLocalIds:attr({default:[],}),originThreadAttachments:one2many('mail.attachment',{inverse:'originThread',}),overdueActivities:one2many('mail.activity',{compute:'_computeOverdueActivities',dependencies:['activitiesState'],}),partnerSeenInfos:one2many('mail.thread_partner_seen_info',{inverse:'thread',isCausal:true,}),pendingSeenMessageId:attr(),public:attr(),serverFoldState:attr({default:'closed',}),serverLastMessageId:attr({default:0,}),serverMessageUnreadCounter:attr({default:0,}),suggestedRecipientInfoList:one2many('mail.suggested_recipient_info',{inverse:'thread',}),threadViews:one2many('mail.thread_view',{inverse:'thread',}),todayActivities:one2many('mail.activity',{compute:'_computeTodayActivities',dependencies:['activitiesState'],}),typingMembers:many2many('mail.partner'),typingStatusText:attr({compute:'_computeTypingStatusText',default:'',dependencies:['orderedOtherTypingMembers'],}),uuid:attr(),};Thread.modelName='mail.thread';return Thread;}
registerNewModel('mail.thread',factory);});;

/* /mail/static/src/models/thread_cache/thread_cache.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/thread_cache/thread_cache.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{attr,many2many,many2one,one2many}=require('mail/static/src/model/model_field.js');function factory(dependencies){class ThreadCache extends dependencies['mail.model']{async loadMoreMessages(){if(this.isAllHistoryLoaded||this.isLoading){return;}
if(!this.isLoaded){this.update({isCacheRefreshRequested:true});return;}
this.update({isLoadingMore:true});const messageIds=this.fetchedMessages.map(message=>message.id);const limit=30;const fetchedMessages=await this.async(()=>this._loadMessages({extraDomain:[['id','<',Math.min(...messageIds)]],limit,}));for(const threadView of this.threadViews){threadView.addComponentHint('more-messages-loaded',{fetchedMessages});}
this.update({isLoadingMore:false});if(fetchedMessages.length<limit){this.update({isAllHistoryLoaded:true});}
return fetchedMessages;}
async loadNewMessages(){if(this.isLoading){return;}
if(!this.isLoaded){this.update({isCacheRefreshRequested:true});return;}
const messageIds=this.fetchedMessages.map(message=>message.id);const fetchedMessages=this._loadMessages({extraDomain:[['id','>',Math.max(...messageIds)]],limit:false,});for(const threadView of this.threadViews){threadView.addComponentHint('new-messages-loaded',{fetchedMessages});}
return fetchedMessages;}
static _createRecordLocalId(data){const{stringifiedDomain='[]',thread:[[commandInsert,thread]],}=data;return`${this.modelName}_[${thread.localId}]_<${stringifiedDomain}>`;}
_computeCheckedMessages(){const messagesWithoutCheckbox=this.checkedMessages.filter(message=>!message.hasCheckbox);return[['unlink',messagesWithoutCheckbox]];}
_computeFetchedMessages(){if(!this.thread){return[['unlink-all']];}
const toUnlinkMessages=[];for(const message of this.fetchedMessages){if(!this.thread.messages.includes(message)){toUnlinkMessages.push(message);}}
return[['unlink',toUnlinkMessages]];}
_computeLastFetchedMessage(){const{length:l,[l-1]:lastFetchedMessage,}=this.orderedFetchedMessages;if(!lastFetchedMessage){return[['unlink']];}
return[['link',lastFetchedMessage]];}
_computeLastMessage(){const{length:l,[l-1]:lastMessage,}=this.orderedMessages;if(!lastMessage){return[['unlink']];}
return[['link',lastMessage]];}
_computeMessages(){if(!this.thread){return[['unlink-all']];}
let messages=this.fetchedMessages;if(this.stringifiedDomain!=='[]'){return[['replace',messages]];}
let newerMessages;if(!this.lastFetchedMessage){newerMessages=this.thread.messages;}else{newerMessages=this.thread.messages.filter(message=>message.id>this.lastFetchedMessage.id);}
messages=messages.concat(newerMessages);return[['replace',messages]];}
_computeNonEmptyMessages(){return[['replace',this.messages.filter(message=>!message.isEmpty)]]}
_computeOrderedFetchedMessages(){return[['replace',this.fetchedMessages.sort((m1,m2)=>m1.id<m2.id?-1:1)]];}
_computeOrderedMessages(){return[['replace',this.messages.sort((m1,m2)=>m1.id<m2.id?-1:1)]];}
_computeHasToLoadMessages(){if(!this.thread){return false;}
const wasCacheRefreshRequested=this.isCacheRefreshRequested;this.update({isCacheRefreshRequested:false});if(this.thread.isTemporary){return false;}
if(!wasCacheRefreshRequested&&this.threadViews.length===0){return false;}
if(this.isLoading){return false;}
if(!wasCacheRefreshRequested&&this.isLoaded){return false;}
const isMainCache=this.thread.mainCache===this;if(isMainCache&&this.isLoaded){return false;}
return true;}
_computeUncheckedMessages(){return[['replace',this.messages.filter(message=>message.hasCheckbox&&!this.checkedMessages.includes(message))]];}
_extendMessageDomain(domain){const thread=this.thread;if(thread.model==='mail.channel'){return domain.concat([['channel_ids','in',[thread.id]]]);}else if(thread===this.env.messaging.inbox){return domain.concat([['needaction','=',true]]);}else if(thread===this.env.messaging.starred){return domain.concat([['starred_partner_ids','in',[this.env.messaging.currentPartner.id]],]);}else if(thread===this.env.messaging.history){return domain.concat([['needaction','=',false]]);}else if(thread===this.env.messaging.moderation){return domain.concat([['moderation_status','=','pending_moderation']]);}else{return domain.concat([['message_type','!=','user_notification'],['model','=',thread.model],['res_id','=',thread.id],]);}}
async _loadMessages({extraDomain,limit=30}={}){this.update({isLoading:true});const searchDomain=JSON.parse(this.stringifiedDomain);let domain=searchDomain.length?searchDomain:[];domain=this._extendMessageDomain(domain);if(extraDomain){domain=extraDomain.concat(domain);}
const context=this.env.session.user_context;const moderated_channel_ids=this.thread.moderation?[this.thread.id]:undefined;const messages=await this.async(()=>this.env.models['mail.message'].performRpcMessageFetch(domain,limit,moderated_channel_ids,context,));this.update({fetchedMessages:[['link',messages]],isLoaded:true,isLoading:false,});if(!extraDomain&&messages.length<limit){this.update({isAllHistoryLoaded:true});}
this.env.messagingBus.trigger('o-thread-cache-loaded-messages',{fetchedMessages:messages,threadCache:this,});return messages;}
_onHasToLoadMessagesChanged(){if(!this.hasToLoadMessages){return;}
this._loadMessages().then(fetchedMessages=>{for(const threadView of this.threadViews){threadView.addComponentHint('messages-loaded',{fetchedMessages});}});}
_onMessagesChanged(){if(!this.thread){return;}
if(this.thread.mainCache!==this){return;}
for(const threadView of this.thread.threadViews){if(threadView.threadCache){threadView.threadCache.update({isCacheRefreshRequested:true});}}}}
ThreadCache.fields={checkedMessages:many2many('mail.message',{compute:'_computeCheckedMessages',dependencies:['checkedMessages','messagesCheckboxes',],inverse:'checkedThreadCaches',}),fetchedMessages:many2many('mail.message',{compute:'_computeFetchedMessages',dependencies:['threadMessages'],}),hasToLoadMessages:attr({compute:'_computeHasToLoadMessages',dependencies:['isCacheRefreshRequested','isLoaded','isLoading','thread','threadIsTemporary','threadMainCache','threadViews',],}),isAllHistoryLoaded:attr({default:false,}),isLoaded:attr({default:false,}),isLoading:attr({default:false,}),isLoadingMore:attr({default:false,}),isCacheRefreshRequested:attr({default:false,}),lastFetchedMessage:many2one('mail.message',{compute:'_computeLastFetchedMessage',dependencies:['orderedFetchedMessages'],}),lastMessage:many2one('mail.message',{compute:'_computeLastMessage',dependencies:['orderedMessages'],}),messagesCheckboxes:attr({related:'messages.hasCheckbox',}),messages:many2many('mail.message',{compute:'_computeMessages',dependencies:['fetchedMessages','threadMessages',],}),messagesAreEmpty:attr({related:'messages.isEmpty'}),nonEmptyMessages:many2many('mail.message',{compute:'_computeNonEmptyMessages',dependencies:['messages','messagesAreEmpty',],}),onHasToLoadMessagesChanged:attr({compute:'_onHasToLoadMessagesChanged',dependencies:['hasToLoadMessages',],}),onMessagesChanged:attr({compute:'_onMessagesChanged',dependencies:['messages','thread','threadMainCache',],}),orderedFetchedMessages:many2many('mail.message',{compute:'_computeOrderedFetchedMessages',dependencies:['fetchedMessages'],}),orderedMessages:many2many('mail.message',{compute:'_computeOrderedMessages',dependencies:['messages'],}),stringifiedDomain:attr({default:'[]',}),thread:many2one('mail.thread',{inverse:'caches',}),threadIsTemporary:attr({related:'thread.isTemporary',}),threadMainCache:many2one('mail.thread_cache',{related:'thread.mainCache',}),threadMessages:many2many('mail.message',{related:'thread.messages',}),threadViews:one2many('mail.thread_view',{inverse:'threadCache',}),uncheckedMessages:many2many('mail.message',{compute:'_computeUncheckedMessages',dependencies:['checkedMessages','messagesCheckboxes','messages',],}),};ThreadCache.modelName='mail.thread_cache';return ThreadCache;}
registerNewModel('mail.thread_cache',factory);});;

/* /mail/static/src/models/thread_partner_seen_info/thread_partner_seen_info.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/thread_partner_seen_info/thread_partner_seen_info.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{attr,many2one}=require('mail/static/src/model/model_field.js');function factory(dependencies){class ThreadPartnerSeenInfo extends dependencies['mail.model']{static _createRecordLocalId(data){const{channelId,partnerId}=data;return`${this.modelName}_${channelId}_${partnerId}`;}
_computePartner(){return[['insert',{id:this.partnerId}]];}
_computeThread(){return[['insert',{id:this.channelId,model:'mail.channel',}]];}}
ThreadPartnerSeenInfo.modelName='mail.thread_partner_seen_info';ThreadPartnerSeenInfo.fields={channelId:attr(),lastFetchedMessage:many2one('mail.message'),lastSeenMessage:many2one('mail.message'),partner:many2one('mail.partner',{compute:'_computePartner',dependencies:['partnerId'],}),partnerId:attr(),thread:many2one('mail.thread',{compute:'_computeThread',dependencies:['channelId'],inverse:'partnerSeenInfos',}),};return ThreadPartnerSeenInfo;}
registerNewModel('mail.thread_partner_seen_info',factory);});;

/* /mail/static/src/models/thread_view/thread_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/thread_view/thread_view.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{RecordDeletedError}=require('mail/static/src/model/model_errors.js');const{attr,many2many,many2one,one2one}=require('mail/static/src/model/model_field.js');const{clear}=require('mail/static/src/model/model_field_command.js');function factory(dependencies){class ThreadView extends dependencies['mail.model']{_willDelete(){this.env.browser.clearTimeout(this._loaderTimeout);return super._willDelete(...arguments);}
addComponentHint(hintType,hintData){const hint={data:hintData,type:hintType};this.update({componentHintList:this.componentHintList.concat([hint]),});}
markComponentHintProcessed(hint){let filterFun;switch(hint.type){case'message-received':filterFun=h=>h.type!==hint.type&&h.message!==hint.data.message;break;default:filterFun=h=>h.type!==hint.type;break;}
this.update({componentHintList:this.componentHintList.filter(filterFun),});this.env.messagingBus.trigger('o-thread-view-hint-processed',{hint,threadViewer:this.threadViewer,});}
handleVisibleMessage(message){if(!this.lastVisibleMessage||this.lastVisibleMessage.id<message.id){this.update({lastVisibleMessage:[['link',message]]});}}
_computeThreadCacheInitialScrollHeight(){if(!this.threadCache){return clear();}
const threadCacheInitialScrollHeight=this.threadCacheInitialScrollHeights[this.threadCache.localId];if(threadCacheInitialScrollHeight!==undefined){return threadCacheInitialScrollHeight;}
return clear();}
_computeThreadCacheInitialScrollPosition(){if(!this.threadCache){return clear();}
const threadCacheInitialScrollPosition=this.threadCacheInitialScrollPositions[this.threadCache.localId];if(threadCacheInitialScrollPosition!==undefined){return threadCacheInitialScrollPosition;}
return clear();}
_computeThreadShouldBeSetAsSeen(){if(!this.thread){return;}
if(!this.thread.lastNonTransientMessage){return;}
if(!this.lastVisibleMessage){return;}
if(this.lastVisibleMessage!==this.lastMessage){return;}
if(!this.hasComposerFocus){return;}
this.thread.markAsSeen(this.thread.lastNonTransientMessage).catch(e=>{if(!(e instanceof RecordDeletedError)){throw e;}});}
_onThreadCacheChanged(){this.addComponentHint('change-of-thread-cache');if(this.threadCache){this.threadCache.update({isCacheRefreshRequested:true});}
this.update({lastVisibleMessage:[['unlink']]});}
_onThreadCacheIsLoadingChanged(){if(this.threadCache&&this.threadCache.isLoading){if(!this.isLoading&&!this.isPreparingLoading){this.update({isPreparingLoading:true});this.async(()=>new Promise(resolve=>{this._loaderTimeout=this.env.browser.setTimeout(resolve,400);})).then(()=>{const isLoading=this.threadCache?this.threadCache.isLoading:false;this.update({isLoading,isPreparingLoading:false});});}
return;}
this.env.browser.clearTimeout(this._loaderTimeout);this.update({isLoading:false,isPreparingLoading:false});}}
ThreadView.fields={checkedMessages:many2many('mail.message',{related:'threadCache.checkedMessages',}),componentHintList:attr({default:[],}),composer:many2one('mail.composer',{related:'thread.composer',}),hasComposerFocus:attr({related:'composer.hasFocus',}),isLoading:attr({default:false,}),isPreparingLoading:attr({default:false,}),hasAutoScrollOnMessageReceived:attr(),lastMessage:many2one('mail.message',{related:'thread.lastMessage',}),lastNonTransientMessage:many2one('mail.message',{related:'thread.lastNonTransientMessage',}),lastVisibleMessage:many2one('mail.message'),messages:many2many('mail.message',{related:'threadCache.messages',}),nonEmptyMessages:many2many('mail.message',{related:'threadCache.nonEmptyMessages',}),onThreadCacheChanged:attr({compute:'_onThreadCacheChanged',dependencies:['threadCache'],}),onThreadCacheIsLoadingChanged:attr({compute:'_onThreadCacheIsLoadingChanged',dependencies:['threadCache','threadCacheIsLoading',],}),stringifiedDomain:attr({related:'threadViewer.stringifiedDomain',}),thread:many2one('mail.thread',{inverse:'threadViews',related:'threadViewer.thread',}),threadCache:many2one('mail.thread_cache',{inverse:'threadViews',related:'threadViewer.threadCache',}),threadCacheInitialScrollHeight:attr({compute:'_computeThreadCacheInitialScrollHeight',dependencies:['threadCache','threadCacheInitialScrollHeights',],}),threadCacheInitialScrollPosition:attr({compute:'_computeThreadCacheInitialScrollPosition',dependencies:['threadCache','threadCacheInitialScrollPositions',],}),threadCacheIsLoading:attr({related:'threadCache.isLoading',}),threadCacheInitialScrollHeights:attr({default:{},related:'threadViewer.threadCacheInitialScrollHeights',}),threadCacheInitialScrollPositions:attr({default:{},related:'threadViewer.threadCacheInitialScrollPositions',}),threadShouldBeSetAsSeen:attr({compute:'_computeThreadShouldBeSetAsSeen',dependencies:['hasComposerFocus','lastMessage','lastNonTransientMessage','lastVisibleMessage','threadCache',],}),threadViewer:one2one('mail.thread_viewer',{inverse:'threadView',}),uncheckedMessages:many2many('mail.message',{related:'threadCache.uncheckedMessages',}),};ThreadView.modelName='mail.thread_view';return ThreadView;}
registerNewModel('mail.thread_view',factory);});;

/* /mail/static/src/models/thread_view/thread_viewer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/thread_viewer/thread_viewer.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{attr,many2one,one2one}=require('mail/static/src/model/model_field.js');function factory(dependencies){class ThreadViewer extends dependencies['mail.model']{saveThreadCacheScrollHeightAsInitial(scrollHeight){if(!this.threadCache){return;}
if(this.chatter){return;}
this.update({threadCacheInitialScrollHeights:Object.assign({},this.threadCacheInitialScrollHeights,{[this.threadCache.localId]:scrollHeight,}),});}
saveThreadCacheScrollPositionsAsInitial(scrollTop){if(!this.threadCache){return;}
if(this.chatter){return;}
this.update({threadCacheInitialScrollPositions:Object.assign({},this.threadCacheInitialScrollPositions,{[this.threadCache.localId]:scrollTop,}),});}
_computeHasThreadView(){if(this.chatter){return this.chatter.hasThreadView;}
if(this.chatWindow){return this.chatWindow.hasThreadView;}
if(this.discuss){return this.discuss.hasThreadView;}
return this.hasThreadView;}
_computeStringifiedDomain(){if(this.chatter){return'[]';}
if(this.chatWindow){return'[]';}
if(this.discuss){return this.discuss.stringifiedDomain;}
return this.stringifiedDomain;}
_computeThread(){if(this.chatter){if(!this.chatter.thread){return[['unlink']];}
return[['link',this.chatter.thread]];}
if(this.chatWindow){if(!this.chatWindow.thread){return[['unlink']];}
return[['link',this.chatWindow.thread]];}
if(this.discuss){if(!this.discuss.thread){return[['unlink']];}
return[['link',this.discuss.thread]];}
return[];}
_computeThreadCache(){if(!this.thread){return[['unlink']];}
return[['link',this.thread.cache(this.stringifiedDomain)]];}
_computeThreadView(){if(!this.hasThreadView){return[['unlink']];}
if(this.threadView){return[];}
return[['create']];}}
ThreadViewer.fields={chatter:one2one('mail.chatter',{inverse:'threadViewer',}),chatterHasThreadView:attr({related:'chatter.hasThreadView',}),chatterThread:many2one('mail.thread',{related:'chatter.thread',}),chatWindow:one2one('mail.chat_window',{inverse:'threadViewer',}),chatWindowHasThreadView:attr({related:'chatWindow.hasThreadView',}),chatWindowThread:many2one('mail.thread',{related:'chatWindow.thread',}),discuss:one2one('mail.discuss',{inverse:'threadViewer',}),discussHasThreadView:attr({related:'discuss.hasThreadView',}),discussStringifiedDomain:attr({related:'discuss.stringifiedDomain',}),discussThread:many2one('mail.thread',{related:'discuss.thread',}),hasThreadView:attr({compute:'_computeHasThreadView',default:false,dependencies:['chatterHasThreadView','chatWindowHasThreadView','discussHasThreadView',],}),stringifiedDomain:attr({compute:'_computeStringifiedDomain',default:'[]',dependencies:['discussStringifiedDomain',],}),thread:many2one('mail.thread',{compute:'_computeThread',dependencies:['chatterThread','chatWindowThread','discussThread',],}),threadCache:many2one('mail.thread_cache',{compute:'_computeThreadCache',dependencies:['stringifiedDomain','thread',],}),threadCacheInitialScrollHeights:attr({default:{},}),threadCacheInitialScrollPositions:attr({default:{},}),threadView:one2one('mail.thread_view',{compute:'_computeThreadView',dependencies:['hasThreadView',],inverse:'threadViewer',isCausal:true,}),};ThreadViewer.modelName='mail.thread_viewer';return ThreadViewer;}
registerNewModel('mail.thread_viewer',factory);});;

/* /mail/static/src/models/user/user.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/models/user/user.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{attr,one2one}=require('mail/static/src/model/model_field.js');function factory(dependencies){class User extends dependencies['mail.model']{_willDelete(){if(this.env.messaging){if(this===this.env.messaging.currentUser){this.env.messaging.update({currentUser:[['unlink']]});}}
return super._willDelete(...arguments);}
static convertData(data){const data2={};if('id'in data){data2.id=data.id;}
if('partner_id'in data){if(!data.partner_id){data2.partner=[['unlink']];}else{const partnerNameGet=data['partner_id'];const partnerData={display_name:partnerNameGet[1],id:partnerNameGet[0],};data2.partner=[['insert',partnerData]];}}
return data2;}
static async performRpcRead({context,fields,ids}){const usersData=await this.env.services.rpc({model:'res.users',method:'read',args:[ids],kwargs:{context,fields,},},{shadow:true});return this.env.models['mail.user'].insert(usersData.map(userData=>this.env.models['mail.user'].convertData(userData)));}
async fetchPartner(){return this.env.models['mail.user'].performRpcRead({ids:[this.id],fields:['partner_id'],context:{active_test:false},});}
async getChat(){if(!this.partner){await this.async(()=>this.fetchPartner());}
if(!this.partner){this.env.services['notification'].notify({message:this.env._t("You can only chat with existing users."),type:'warning',});return;}
let chat=this.env.models['mail.thread'].find(thread=>thread.channel_type==='chat'&&thread.correspondent===this.partner&&thread.model==='mail.channel'&&thread.public==='private');if(!chat||!chat.isPinned){chat=await this.async(()=>this.env.models['mail.thread'].performRpcCreateChat({partnerIds:[this.partner.id],}));}
if(!chat){this.env.services['notification'].notify({message:this.env._t("An unexpected error occurred during the creation of the chat."),type:'warning',});return;}
return chat;}
async openChat(options){const chat=await this.async(()=>this.getChat());if(!chat){return;}
await this.async(()=>chat.open(options));return chat;}
async openProfile(){if(!this.partner){await this.async(()=>this.fetchPartner());}
if(!this.partner){this.env.services['notification'].notify({message:this.env._t("You can only open the profile of existing users."),type:'warning',});return;}
return this.partner.openProfile();}
static _createRecordLocalId(data){return`${this.modelName}_${data.id}`;}
_computeDisplayName(){return this.display_name||this.partner&&this.partner.display_name;}
_computeNameOrDisplayName(){return this.partner&&this.partner.nameOrDisplayName||this.display_name;}}
User.fields={id:attr(),display_name:attr({compute:'_computeDisplayName',dependencies:['display_name','partnerDisplayName',],}),model:attr({default:'res.user',}),nameOrDisplayName:attr({compute:'_computeNameOrDisplayName',dependencies:['display_name','partnerNameOrDisplayName',]}),partner:one2one('mail.partner',{inverse:'user',}),partnerDisplayName:attr({related:'partner.display_name',}),partnerNameOrDisplayName:attr({related:'partner.nameOrDisplayName',}),};User.modelName='mail.user';return User;}
registerNewModel('mail.user',factory);});;

/* /mail/static/src/services/chat_window_service/chat_window_service.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/services/chat_window_service/chat_window_service.js',function(require){'use strict';const components={ChatWindowManager:require('mail/static/src/components/chat_window_manager/chat_window_manager.js'),};const AbstractService=require('web.AbstractService');const{bus,serviceRegistry}=require('web.core');const ChatWindowService=AbstractService.extend({start(){this._super(...arguments);this._webClientReady=false;this._listenHomeMenu();},destroy(){if(this.component){this.component.destroy();this.component=undefined;}},_getParentNode(){return document.querySelector('body');},_listenHomeMenu(){bus.on('hide_home_menu',this,this._onHideHomeMenu.bind(this));bus.on('show_home_menu',this,this._onShowHomeMenu.bind(this));bus.on('web_client_ready',this,this._onWebClientReady.bind(this));},async _mount(){if(this.component){this.component.destroy();this.component=undefined;}
const ChatWindowManagerComponent=components.ChatWindowManager;this.component=new ChatWindowManagerComponent(null);const parentNode=this._getParentNode();await this.component.mount(parentNode);},async _onHideHomeMenu(){if(!this._webClientReady){return;}
if(document.querySelector('.o_ChatWindowManager')){return;}
await this._mount();},async _onShowHomeMenu(){if(!this._webClientReady){return;}
if(document.querySelector('.o_ChatWindowManager')){return;}
await this._mount();},async _onWebClientReady(){await this._mount();this._webClientReady=true;},});serviceRegistry.add('chat_window',ChatWindowService);return ChatWindowService;});;

/* /mail/static/src/services/dialog_service/dialog_service.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/services/dialog_service/dialog_service.js',function(require){'use strict';const components={DialogManager:require('mail/static/src/components/dialog_manager/dialog_manager.js'),};const AbstractService=require('web.AbstractService');const{bus,serviceRegistry}=require('web.core');const DialogService=AbstractService.extend({start(){this._super(...arguments);this._webClientReady=false;this._listenHomeMenu();},destroy(){if(this.component){this.component.destroy();this.component=undefined;}},_getParentNode(){return document.querySelector('body');},_listenHomeMenu(){bus.on('hide_home_menu',this,this._onHideHomeMenu.bind(this));bus.on('show_home_menu',this,this._onShowHomeMenu.bind(this));bus.on('web_client_ready',this,this._onWebClientReady.bind(this));},async _mount(){if(this.component){this.component.destroy();this.component=undefined;}
const DialogManagerComponent=components.DialogManager;this.component=new DialogManagerComponent(null);const parentNode=this._getParentNode();await this.component.mount(parentNode);},async _onHideHomeMenu(){if(!this._webClientReady){return;}
if(document.querySelector('.o_DialogManager')){return;}
await this._mount();},async _onShowHomeMenu(){if(!this._webClientReady){return;}
if(document.querySelector('.o_DialogManager')){return;}
await this._mount();},async _onWebClientReady(){await this._mount();this._webClientReady=true;}});serviceRegistry.add('dialog',DialogService);return DialogService;});;

/* /mail/static/src/utils/deferred/deferred.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/utils/deferred/deferred.js',function(require){'use strict';function makeDeferred(){let resolve;let reject;const prom=new Promise(function(res,rej){resolve=res.bind(this);reject=rej.bind(this);});prom.resolve=(...args)=>resolve(...args);prom.reject=(...args)=>reject(...args);return prom;}
return{makeDeferred};});;

/* /mail/static/src/utils/throttle/throttle.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/utils/throttle/throttle.js',function(require){'use strict';const{makeDeferred}=require('mail/static/src/utils/deferred/deferred.js');class ThrottleCanceledError extends Error{constructor(throttleId,...args){super(...args);this.name='ThrottleCanceledError';this.throttleId=throttleId;}}
class ThrottleReinvokedError extends Error{constructor(throttleId,...args){super(...args);this.name='ThrottleReinvokedError';this.throttleId=throttleId;}}
class _ThrottleFlushedError extends Error{constructor(throttleId,...args){super(...args);this.name='_ThrottleFlushedError';this.throttleId=throttleId;}}
class Throttle{constructor(env,func,duration){this.env=env;this.id=_.uniqueId('throttle_');this._coolingDownDeferred=undefined;this._duration=duration;this._function=func;this._isCoolingDown=false;this._pendingInvokeDeferred=undefined;}
cancel(){if(!this._isCoolingDown){return;}
if(!this._pendingInvokeDeferred){return;}
this._pendingInvokeDeferred.reject(new ThrottleCanceledError(this.id));}
clear(){this.cancel();this.flush();}
async do(...args){if(!this._isCoolingDown){return this._invokeFunction(...args);}
if(this._pendingInvokeDeferred){this._pendingInvokeDeferred.reject(new ThrottleReinvokedError(this.id));}
try{this._pendingInvokeDeferred=makeDeferred();await Promise.race([this._coolingDownDeferred,this._pendingInvokeDeferred]);}catch(error){if(!(error instanceof _ThrottleFlushedError)||error.throttleId!==this.id){throw error;}}finally{this._pendingInvokeDeferred=undefined;}
return this._invokeFunction(...args);}
flush(){if(!this._isCoolingDown){return;}
const coolingDownDeferred=this._coolingDownDeferred;this._coolingDownDeferred=undefined;this._isCoolingDown=false;coolingDownDeferred.reject(new _ThrottleFlushedError(this.id));}
_invokeFunction(...args){const res=this._function(...args);this._startCoolingDown();return res;}
async _startCoolingDown(){if(this._coolingDownDeferred){throw new Error("Cannot start cooling down if there's already a cooling down in progress.");}
const coolingDownDeferred=makeDeferred();this._coolingDownDeferred=coolingDownDeferred;this._isCoolingDown=true;const cooldownTimeoutId=this.env.browser.setTimeout(()=>coolingDownDeferred.resolve(),this._duration);let unexpectedError;try{await coolingDownDeferred;}catch(error){if(!(error instanceof _ThrottleFlushedError)||error.throttleId!==this.id){unexpectedError=error;}}finally{this.env.browser.clearTimeout(cooldownTimeoutId);this._coolingDownDeferred=undefined;this._isCoolingDown=false;}
if(unexpectedError){throw unexpectedError;}}}
function throttle(env,func,duration,{silentCancelationErrors=true}={}){const throttleObj=new Throttle(env,func,duration);const callable=async(...args)=>{try{return await throttleObj.do(...args);}catch(error){const isSelfReinvokedError=(error instanceof ThrottleReinvokedError&&error.throttleId===throttleObj.id);const isSelfCanceledError=(error instanceof ThrottleCanceledError&&error.throttleId===throttleObj.id);if(silentCancelationErrors&&(isSelfReinvokedError||isSelfCanceledError)){return new Promise(()=>{});}else{throw error;}}};Object.assign(callable,{cancel:()=>throttleObj.cancel(),clear:()=>throttleObj.clear(),flush:()=>throttleObj.flush(),});return callable;}
Object.assign(throttle,{ThrottleReinvokedError,ThrottleCanceledError,});return throttle;});;

/* /mail/static/src/utils/timer/timer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/utils/timer/timer.js',function(require){'use strict';const{makeDeferred}=require('mail/static/src/utils/deferred/deferred.js');class TimerClearedError extends Error{constructor(timerId,...args){super(...args);this.name='TimerClearedError';this.timerId=timerId;}}
class Timer{constructor(env,onTimeout,duration,{silentCancelationErrors=true}={}){this.env=env;this.isRunning=false;this._duration=duration;this._hasSilentCancelationErrors=silentCancelationErrors;this._onTimeout=onTimeout;this._timeoutDeferred=undefined;this._timeoutId=undefined;}
clear(){this.env.browser.clearTimeout(this._timeoutId);this.isRunning=false;if(!this._timeoutDeferred){return;}
this._timeoutDeferred.reject(new TimerClearedError(this.id));}
async reset(){this.clear();await this.start();}
async start(){if(this.isRunning){throw new Error("Cannot start a timer that is currently running.");}
this.isRunning=true;const timeoutDeferred=makeDeferred();this._timeoutDeferred=timeoutDeferred;const timeoutId=this.env.browser.setTimeout(()=>{this.isRunning=false;timeoutDeferred.resolve(this._onTimeout());},this._duration);this._timeoutId=timeoutId;let result;try{result=await timeoutDeferred;}catch(error){if(!this._hasSilentCancelationErrors||!(error instanceof TimerClearedError)||error.timerId!==this.id){throw error;}}finally{this.env.browser.clearTimeout(timeoutId);this._timeoutDeferred=undefined;this.isRunning=false;}
return result;}}
Object.assign(Timer,{TimerClearedError,});return Timer;});;

/* /mail/static/src/utils/utils.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/utils/utils.js',function(require){'use strict';const{delay}=require('web.concurrency');const{patch:webUtilsPatch,unpatch:webUtilsUnpatch,}=require('web.utils');const classPatchMap=new WeakMap();const eventHandledWeakMap=new WeakMap();async function executeGracefully(functions,maxTimeFrame=100){let startDate=new Date();for(const func of functions){if(new Date()-startDate>maxTimeFrame){await new Promise(resolve=>setTimeout(resolve));startDate=new Date();}
await func();}}
function isEventHandled(ev,markName){if(!eventHandledWeakMap.get(ev)){return false;}
return eventHandledWeakMap.get(ev).includes(markName);}
function markEventHandled(ev,markName){if(!eventHandledWeakMap.get(ev)){eventHandledWeakMap.set(ev,[]);}
eventHandledWeakMap.get(ev).push(markName);}
async function nextTick(){await delay(0);}
function patchClassMethods(Class,patchName,patch){let metadata=classPatchMap.get(Class);if(!metadata){metadata={origMethods:{},patches:{},current:[]};classPatchMap.set(Class,metadata);}
if(metadata.patches[patchName]){throw new Error(`Patch [${patchName}] already exists`);}
metadata.patches[patchName]=patch;applyPatch(Class,patch);metadata.current.push(patchName);function applyPatch(Class,patch){Object.keys(patch).forEach(function(methodName){const method=patch[methodName];if(typeof method==="function"){const original=Class[methodName];if(!(methodName in metadata.origMethods)){metadata.origMethods[methodName]=original;}
Class[methodName]=function(...args){const previousSuper=this._super;this._super=original;const res=method.call(this,...args);this._super=previousSuper;return res;};}});}
return()=>unpatchClassMethods.bind(Class,patchName);}
function patchInstanceMethods(Class,patchName,patch){return webUtilsPatch(Class,patchName,patch);}
function unpatchClassMethods(Class,patchName){let metadata=classPatchMap.get(Class);if(!metadata){return;}
classPatchMap.delete(Class);for(let k in metadata.origMethods){Class[k]=metadata.origMethods[k];}
for(let name of metadata.current){if(name!==patchName){patchClassMethods(Class,name,metadata.patches[name]);}}}
function unpatchInstanceMethods(Class,patchName){return webUtilsUnpatch(Class,patchName);}
return{executeGracefully,isEventHandled,markEventHandled,nextTick,patchClassMethods,patchInstanceMethods,unpatchClassMethods,unpatchInstanceMethods,};});;

/* /mail/static/src/widgets/discuss/discuss.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/widgets/discuss/discuss.js',function(require){'use strict';const components={Discuss:require('mail/static/src/components/discuss/discuss.js'),};const InvitePartnerDialog=require('mail/static/src/widgets/discuss_invite_partner_dialog/discuss_invite_partner_dialog.js');const AbstractAction=require('web.AbstractAction');const{action_registry,qweb}=require('web.core');const{Component}=owl;const DiscussWidget=AbstractAction.extend({template:'mail.widgets.Discuss',hasControlPanel:true,loadControlPanel:true,withSearchBar:true,searchMenuTypes:['filter','favorite'],init(parent,action,options={}){this._super(...arguments);this.$buttons=$(qweb.render('mail.widgets.Discuss.DiscussControlButtons'));this.$buttons.find('button').css({display:'inline-block'});this.$buttons.on('click','.o_invite',ev=>this._onClickInvite(ev));this.$buttons.on('click','.o_widget_Discuss_controlPanelButtonMarkAllRead',ev=>this._onClickMarkAllAsRead(ev));this.$buttons.on('click','.o_mobile_new_channel',ev=>this._onClickMobileNewChannel(ev));this.$buttons.on('click','.o_mobile_new_message',ev=>this._onClickMobileNewMessage(ev));this.$buttons.on('click','.o_unstar_all',ev=>this._onClickUnstarAll(ev));this.$buttons.on('click','.o_widget_Discuss_controlPanelButtonSelectAll',ev=>this._onClickSelectAll(ev));this.$buttons.on('click','.o_widget_Discuss_controlPanelButtonUnselectAll',ev=>this._onClickUnselectAll(ev));this.$buttons.on('click','.o_widget_Discuss_controlPanelButtonModeration.o-accept',ev=>this._onClickModerationAccept(ev));this.$buttons.on('click','.o_widget_Discuss_controlPanelButtonModeration.o-discard',ev=>this._onClickModerationDiscard(ev));this.$buttons.on('click','.o_widget_Discuss_controlPanelButtonModeration.o-reject',ev=>this._onClickModerationReject(ev));this.action=action;this.actionManager=parent;this.searchModelConfig.modelName='mail.message';this.discuss=undefined;this.options=options;this.component=undefined;this._lastPushStateActiveThread=null;},async willStart(){await this._super(...arguments);this.env=Component.env;await this.env.messagingCreatedPromise;const initActiveId=this.options.active_id||(this.action.context&&this.action.context.active_id)||(this.action.params&&this.action.params.default_active_id)||'mail.box_inbox';this.discuss=this.env.messaging.discuss;this.discuss.update({initActiveId});},destroy(){if(this.component){this.component.destroy();this.component=undefined;}
if(this.$buttons){this.$buttons.off().remove();}
this._super(...arguments);},on_attach_callback(){this._super(...arguments);if(this.component){return;}
const DiscussComponent=components.Discuss;this.component=new DiscussComponent();this._pushStateActionManagerEventListener=ev=>{ev.stopPropagation();if(this._lastPushStateActiveThread===this.discuss.thread){return;}
this._pushStateActionManager();this._lastPushStateActiveThread=this.discuss.thread;};this._showRainbowManEventListener=ev=>{ev.stopPropagation();this._showRainbowMan();};this._updateControlPanelEventListener=ev=>{ev.stopPropagation();this._updateControlPanel();};this.el.addEventListener('o-push-state-action-manager',this._pushStateActionManagerEventListener);this.el.addEventListener('o-show-rainbow-man',this._showRainbowManEventListener);this.el.addEventListener('o-update-control-panel',this._updateControlPanelEventListener);return this.component.mount(this.el);},on_detach_callback(){this._super(...arguments);if(this.component){this.component.destroy();}
this.component=undefined;this.el.removeEventListener('o-push-state-action-manager',this._pushStateActionManagerEventListener);this.el.removeEventListener('o-show-rainbow-man',this._showRainbowManEventListener);this.el.removeEventListener('o-update-control-panel',this._updateControlPanelEventListener);},_pushStateActionManager(){this.actionManager.do_push_state({action:this.action.id,active_id:this.discuss.activeId,});},_shouldHaveInviteButton(){return(this.discuss.thread&&this.discuss.thread.channel_type==='channel');},_showRainbowMan(){this.trigger_up('show_effect',{message:this.env._t("Congratulations, your inbox is empty!"),type:'rainbow_man',});},_updateControlPanel(){if(this._shouldHaveInviteButton()){this.$buttons.find('.o_invite').removeClass('o_hidden');}else{this.$buttons.find('.o_invite').addClass('o_hidden');}
if(this.discuss.threadView&&this.discuss.thread&&this.discuss.thread===this.env.messaging.inbox){this.$buttons.find('.o_widget_Discuss_controlPanelButtonMarkAllRead').removeClass('o_hidden').prop('disabled',this.discuss.threadView.messages.length===0);}else{this.$buttons.find('.o_widget_Discuss_controlPanelButtonMarkAllRead').addClass('o_hidden');}
if(this.discuss.threadView&&this.discuss.thread&&this.discuss.thread===this.env.messaging.starred){this.$buttons.find('.o_unstar_all').removeClass('o_hidden').prop('disabled',this.discuss.threadView.messages.length===0);}else{this.$buttons.find('.o_unstar_all').addClass('o_hidden');}
if(this.env.messaging.device.isMobile&&this.discuss.activeMobileNavbarTabId==='channel'){this.$buttons.find('.o_mobile_new_channel').removeClass('o_hidden');}else{this.$buttons.find('.o_mobile_new_channel').addClass('o_hidden');}
if(this.env.messaging.device.isMobile&&this.discuss.activeMobileNavbarTabId==='chat'){this.$buttons.find('.o_mobile_new_message').removeClass('o_hidden');}else{this.$buttons.find('.o_mobile_new_message').addClass('o_hidden');}
const $selectAll=this.$buttons.find('.o_widget_Discuss_controlPanelButtonSelectAll');const $unselectAll=this.$buttons.find('.o_widget_Discuss_controlPanelButtonUnselectAll');if(this.discuss.threadView&&(this.discuss.threadView.checkedMessages.length>0||this.discuss.threadView.uncheckedMessages.length>0)){$selectAll.removeClass('o_hidden');$selectAll.toggleClass('disabled',this.discuss.threadView.uncheckedMessages.length===0);$unselectAll.removeClass('o_hidden');$unselectAll.toggleClass('disabled',this.discuss.threadView.checkedMessages.length===0);}else{$selectAll.addClass('o_hidden');$selectAll.addClass('disabled');$unselectAll.addClass('o_hidden');$unselectAll.addClass('disabled');}
const $moderationButtons=this.$buttons.find('.o_widget_Discuss_controlPanelButtonModeration');if(this.discuss.threadView&&this.discuss.threadView.checkedMessages.length>0&&this.discuss.threadView.checkedMessages.filter(message=>!message.isModeratedByCurrentPartner).length===0){$moderationButtons.removeClass('o_hidden');}else{$moderationButtons.addClass('o_hidden');}
let title;if(this.env.messaging.device.isMobile||!this.discuss.thread){title=this.env._t("Discuss");}else{const prefix=this.discuss.thread.channel_type==='channel'&&this.discuss.thread.public!=='private'?'#':'';title=`${prefix}${this.discuss.thread.displayName}`;}
this.updateControlPanel({cp_content:{$buttons:this.$buttons,},title,});},_onClickInvite(){new InvitePartnerDialog(this,{activeThreadLocalId:this.discuss.thread.localId,messagingEnv:this.env,}).open();},_onClickMarkAllAsRead(){this.env.models['mail.message'].markAllAsRead(this.domain);},_onClickMobileNewChannel(){this.discuss.update({isAddingChannel:true});},_onClickMobileNewMessage(){this.discuss.update({isAddingChat:true});},_onClickModerationAccept(){this.env.models['mail.message'].moderate(this.discuss.threadView.checkedMessages,'accept');},_onClickModerationDiscard(){this.discuss.update({hasModerationDiscardDialog:true});},_onClickModerationReject(){this.discuss.update({hasModerationRejectDialog:true});},_onClickSelectAll(){this.env.models['mail.message'].checkAll(this.discuss.thread,this.discuss.stringifiedDomain);},_onClickUnselectAll(){this.env.models['mail.message'].uncheckAll(this.discuss.thread,this.discuss.stringifiedDomain);},_onClickUnstarAll(){this.env.models['mail.message'].unstarAll();},_onSearch:function(searchQuery){this.discuss.update({stringifiedDomain:JSON.stringify(searchQuery.domain),});},});action_registry.add('mail.widgets.discuss',DiscussWidget);return DiscussWidget;});;

/* /mail/static/src/widgets/discuss_invite_partner_dialog/discuss_invite_partner_dialog.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/widgets/discuss_invite_partner_dialog/discuss_invite_partner_dialog.js',function(require){'use strict';const core=require('web.core');const Dialog=require('web.Dialog');const _lt=core._lt;const QWeb=core.qweb;const PartnerInviteDialog=Dialog.extend({dialog_title:_lt("Invite people"),template:'mail.widgets.DiscussInvitePartnerDialog',init(parent,{activeThreadLocalId,messagingEnv}){const env=messagingEnv;const channel=env.models['mail.thread'].get(activeThreadLocalId);this.channelId=channel.id;this.env=env;this._super(parent,{title:_.str.sprintf(this.env._t("Invite people to #%s"),channel.displayName),size:'medium',buttons:[{text:this.env._t("Invite"),close:true,classes:'btn-primary',click:ev=>this._invite(ev),}],});},start(){this.$input=this.$('.o_input');this.$input.select2({width:'100%',allowClear:true,multiple:true,formatResult:item=>{let status;if(item.id==='odoobot'){status='bot';}else{const partner=this.env.models['mail.partner'].find(partner=>partner.id===item.id);status=partner.im_status;}
const $status=QWeb.render('mail.widgets.UserStatus',{status});return $('<span>').text(item.text).prepend($status);},query:query=>{this.env.models['mail.partner'].imSearch({callback:partners=>{let results=partners.map(partner=>{return{id:partner.id,label:partner.nameOrDisplayName,text:partner.nameOrDisplayName,value:partner.nameOrDisplayName,};});results=_.sortBy(results,'label');query.callback({results});},keyword:query.term,limit:20,});}});return this._super(...arguments);},async _invite(){const data=this.$input.select2('data');if(data.length===0){return;}
await this._rpc({model:'mail.channel',method:'channel_invite',args:[this.channelId],kwargs:{partner_ids:_.pluck(data,'id')},});const names=_.escape(_.pluck(data,'text').join(', '));const notification=_.str.sprintf(this.env._t("You added <b>%s</b> to the conversation."),names);this.env.services['notification'].notify({message:notification,title:this.env._t("New people"),type:'warning',});},});return PartnerInviteDialog;});;

/* /mail/static/src/widgets/form_renderer/form_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/widgets/form_renderer/form_renderer.js',function(require){"use strict";const components={ChatterContainer:require('mail/static/src/components/chatter_container/chatter_container.js'),};const FormRenderer=require('web.FormRenderer');const{ComponentWrapper}=require('web.OwlCompatibility');class ChatterContainerWrapperComponent extends ComponentWrapper{}
FormRenderer.include({init(parent,state,params){this._super(...arguments);this.chatterFields=params.chatterFields;this.mailFields=params.mailFields;this._chatterContainerComponent=undefined;this._chatterContainerTarget=undefined;this._isFromFormViewDialog=params.isFromFormViewDialog;},destroy(){this._super(...arguments);this._chatterContainerComponent=undefined;this.off('o_attachments_changed',this);this.off('o_chatter_rendered',this);this.off('o_message_posted',this);owl.Component.env.bus.off('mail.thread:promptAddFollower-closed',this);},_hasChatter(){return!!this._chatterContainerTarget;},_makeChatterContainerComponent(){const props=this._makeChatterContainerProps();this._chatterContainerComponent=new ChatterContainerWrapperComponent(this,components.ChatterContainer,props);this.on('o_chatter_rendered',this,ev=>this._onChatterRendered(ev));if(this.chatterFields.hasRecordReloadOnMessagePosted){this.on('o_message_posted',this,ev=>{if(!this.state.isDirty()){this.trigger_up('reload')}});}
if(this.chatterFields.hasRecordReloadOnAttachmentsChanged){this.on('o_attachments_changed',this,ev=>this.trigger_up('reload'));}
if(this.chatterFields.hasRecordReloadOnFollowersUpdate){owl.Component.env.bus.on('mail.thread:promptAddFollower-closed',this,ev=>this.trigger_up('reload'));}},_makeChatterContainerProps(){return{hasActivities:this.chatterFields.hasActivityIds,hasFollowers:this.chatterFields.hasMessageFollowerIds,hasMessageList:this.chatterFields.hasMessageIds,isAttachmentBoxVisibleInitially:this.chatterFields.isAttachmentBoxVisibleInitially,threadId:this.state.res_id,threadModel:this.state.model,};},_makeChatterContainerTarget(){const $el=$('<div class="o_FormRenderer_chatterContainer"/>');this._chatterContainerTarget=$el[0];return $el;},async _mountChatterContainerComponent(){try{await this._chatterContainerComponent.mount(this._chatterContainerTarget);}catch(error){if(error.message!=="Mounting operation cancelled"){throw error;}}},_renderNode(node){if(node.tag==='div'&&node.attrs.class==='oe_chatter'){if(this._isFromFormViewDialog){return $('<div/>');}
return this._makeChatterContainerTarget();}
return this._super(...arguments);},async _renderView(){await this._super(...arguments);if(this._hasChatter()){if(!this._chatterContainerComponent){this._makeChatterContainerComponent();}else{await this._updateChatterContainerComponent();}
await this._mountChatterContainerComponent();}},async _updateChatterContainerComponent(){const props=this._makeChatterContainerProps();try{await this._chatterContainerComponent.update(props);}catch(error){if(error.message!=="Mounting operation cancelled"){throw error;}}},_onChatterRendered(ev){},});});;

/* /mail/static/src/widgets/messaging_menu/messaging_menu.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/widgets/messaging_menu/messaging_menu.js',function(require){'use strict';const components={MessagingMenu:require('mail/static/src/components/messaging_menu/messaging_menu.js'),};const SystrayMenu=require('web.SystrayMenu');const Widget=require('web.Widget');const MessagingMenu=Widget.extend({template:'mail.widgets.MessagingMenu',init(){this._super(...arguments);this.component=undefined;},destroy(){if(this.component){this.component.destroy();}
this._super(...arguments);},async on_attach_callback(){const MessagingMenuComponent=components.MessagingMenu;this.component=new MessagingMenuComponent(null);await this.component.mount(this.el);this.el.parentNode.insertBefore(this.component.el,this.el);this.el.parentNode.removeChild(this.el);},});const activityMenuIndex=SystrayMenu.Items.findIndex(SystrayMenuItem=>SystrayMenuItem.prototype.name==='activity_menu');if(activityMenuIndex>0){SystrayMenu.Items.splice(activityMenuIndex,0,MessagingMenu);}else{SystrayMenu.Items.push(MessagingMenu);}
return MessagingMenu;});;

/* /mail/static/src/widgets/notification_alert/notification_alert.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail/static/src/widgets/notification_alert/notification_alert.js',function(require){"use strict";const components={NotificationAlert:require('mail/static/src/components/notification_alert/notification_alert.js'),};const{ComponentWrapper,WidgetAdapterMixin}=require('web.OwlCompatibility');const Widget=require('web.Widget');const widgetRegistry=require('web.widget_registry');class NotificationAlertWrapper extends ComponentWrapper{}
const NotificationAlert=Widget.extend(WidgetAdapterMixin,{init(){this._super(...arguments);this.component=undefined;},async start(){await this._super(...arguments);this.component=new NotificationAlertWrapper(this,components.NotificationAlert,{});await this.component.mount(this.el);},});widgetRegistry.add('notification_alert',NotificationAlert);return NotificationAlert;});;

/* /pad/static/src/js/pad.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('pad.pad',function(require){"use strict";var AbstractField=require('web.AbstractField');var core=require('web.core');var fieldRegistry=require('web.field_registry');var _t=core._t;var FieldPad=AbstractField.extend({template:'FieldPad',content:"",events:{'click .oe_pad_switch':'_onToggleFullScreen',},willStart:function(){if(this.isPadConfigured===undefined){return this._rpc({method:'pad_is_configured',model:this.model,}).then(function(result){FieldPad.prototype.isPadConfigured=result;});}
return this._super.apply(this,arguments);},start:function(){if(!this.isPadConfigured){this.$(".oe_unconfigured").removeClass('d-none');this.$(".oe_configured").addClass('d-none');return Promise.resolve();}
if(this.mode==='edit'&&_.str.startsWith(this.value,'http')){this.url=this.value;var url={};url.toJSON=_.constant(this.url);this._setValue(url,{doNotSetDirty:true});}
return this._super.apply(this,arguments);},commitChanges:function(){return this.urlDef;},isSet:function(){return true;},_renderEdit:function(){if(this.url){var userName=encodeURIComponent(this.getSession().name);var url=this.url+'?showChat=false&userName='+userName;var content='<iframe width="100%" height="100%" frameborder="0" src="'+url+'"></iframe>';this.$('.oe_pad_content').html(content);}else if(this.value){this.$('.oe_pad_content').text(this.value);}else{var self=this;this.urlDef=this._rpc({method:'pad_generate_url',model:this.model,context:{model:this.model,field_name:this.name,object_id:this.res_id},},{shadow:true}).then(function(result){self.url=result.url;self._setValue(result.url,{doNotSetDirty:true});});}},_renderReadonly:function(){if(_.str.startsWith(this.value,'http')){var self=this;this.$('.oe_pad_content').addClass('oe_pad_loading').text(_t("Loading"));this._rpc({method:'pad_get_content',model:this.model,args:[this.value]},{shadow:true}).then(function(data){self.$('.oe_pad_content').removeClass('oe_pad_loading').html('<div class="oe_pad_readonly"><div>');self.$('.oe_pad_readonly').html(data);}).guardedCatch(function(){self.$('.oe_pad_content').text(_t('Unable to load pad'));});}else{this.$('.oe_pad_content').addClass('oe_pad_loading').show().text(_t("This pad will be initialized on first edit"));}},_onToggleFullScreen:function(){this.$el.toggleClass('oe_pad_fullscreen mb0');this.$('.oe_pad_switch').toggleClass('fa-expand fa-compress');this.$el.parents('.o_touch_device').toggleClass('o_scroll_hidden');},});fieldRegistry.add('pad',FieldPad);return FieldPad;});;

/* /web_map/static/src/js/map_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_map.MapController',function(require){"use strict";const AbstractController=require('web.AbstractController');const core=require('web.core');const qweb=core.qweb;const MapController=AbstractController.extend({custom_events:_.extend({},AbstractController.prototype.custom_events,{'pin_clicked':'_onPinClick','get_itinerary_clicked':'_onGetItineraryClicked','open_clicked':'_onOpenClicked','pager_changed':'_onPagerChanged','coordinate_fetched':'_onCoordinateFetched',}),init:function(parent,model,renderer,params){this._super.apply(this,arguments);this.actionName=params.actionName;},renderButtons:function($node){let url='https://www.google.com/maps/dir/?api=1';if(this.model.data.records.length){const coordinates=this.model.data.records.filter(record=>record.partner&&record.partner.partner_latitude&&record.partner.partner_longitude).map(record=>record.partner.partner_latitude+','+record.partner.partner_longitude);url+=`&waypoints=${_.uniq(coordinates).join('|')}`;}
this.$buttons=$(qweb.render("MapView.buttons"),{widget:this});this.$buttons.find('a').attr('href',url);if($node){this.$buttons.appendTo($node);}},update:async function(){await this._super(...arguments);this._updatePaging();},_getPagingInfo:function(){const state=this.model.get();return{currentMinimum:state.offset+1,limit:state.limit,size:state.count,};},_onCoordinateFetched:function(ev){ev.stopPropagation();this.update({},{reload:false});},_onGetItineraryClicked:function(ev){window.open(`https://www.google.com/maps/dir/?api=1&destination=${ev.data.lat},${ev.data.lon}`);},_onOpenClicked:function(ev){if(ev.data.ids.length>1){this.do_action({type:'ir.actions.act_window',name:this.actionName,views:[[false,'list'],[false,'form']],res_model:this.modelName,domain:[['id','in',ev.data.ids]],});}else{this.trigger_up('switch_view',{view_type:'form',res_id:ev.data.ids[0],mode:'readonly',model:this.modelName});}},async _onPagerChanged(ev){const{currentMinimum,limit}=ev.data;await this.reload({limit,offset:currentMinimum-1});},});return MapController;});;

/* /web_map/static/src/js/map_model.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_map.MapModel',function(require){"use strict";const AbstractModel=require('web.AbstractModel');const session=require('web.session');const core=require('web.core');const _t=core._t;const MapModel=AbstractModel.extend({COORDINATE_FETCH_DELAY:1000,init:function(){this._super.apply(this,arguments);this.data={};this.data.mapBoxToken=session.map_box_token;},__get:function(){return this.data;},__load:function(params){this.data.count=0;this.data.offset=0;this.data.limit=params.limit;this.partnerToCache=[];this.partnerIds=[];this.resPartnerField=params.resPartnerField;this.model=params.modelName;this.context=params.context;this.fields=params.fieldNames;this.fieldsInfo=params.fieldsInfo;this.domain=params.domain;this.params=params;this.orderBy=params.orderBy;this.routing=params.routing;this.numberOfLocatedRecords=0;this.coordinateFetchingTimeoutHandle=undefined;this.data.shouldUpdatePosition=true;this.data.fetchingCoordinates=false;this.data.groupBy=params.groupedBy.length?params.groupedBy[0]:false;return this._fetchData();},__reload:function(handle,params){const options=params||{};this.partnerToCache=[];this.partnerIds=[];this.numberOfLocatedRecords=0;this.data.shouldUpdatePosition=true;this.data.fetchingCoordinates=false;if(this.coordinateFetchingTimeoutHandle!==undefined){clearInterval(this.coordinateFetchingTimeoutHandle);this.coordinateFetchingTimeoutHandle=undefined;}
if(options.domain!==undefined){this.domain=options.domain;}
if(options.limit!==undefined){this.data.limit=options.limit;}
if(options.offset!==undefined){this.data.offset=options.offset;}
if(options.groupBy!==undefined&&options.groupBy[0]!==this.data.groupBy){this.data.groupBy=options.groupBy.length?options.groupBy[0]:false;}
return this._fetchData();},_addPartnerToRecord:function(){this.data.records.forEach((record)=>{this.data.partners.forEach((partner)=>{let recordPartnerId;if(this.model==="res.partner"&&this.resPartnerField==="id"){recordPartnerId=record.id;}else{recordPartnerId=record[this.resPartnerField][0];}
if(recordPartnerId==partner.id){record.partner=partner;this.numberOfLocatedRecords++;}});});},_checkCoordinatesValidity:function(partner){if(partner.partner_latitude&&partner.partner_longitude&&partner.partner_latitude>=-90&&partner.partner_latitude<=90&&partner.partner_longitude>=-180&&partner.partner_longitude<=180){return true;}
return false;},_fetchCoordinatesFromAddressMB:function(record){const address=encodeURIComponent(record.contact_address_complete);const token=this.data.mapBoxToken;const encodedUrl=`https://api.mapbox.com/geocoding/v5/mapbox.places/${address}.json?access_token=${token}&cachebuster=1552314159970&autocomplete=true`;return new Promise((resolve,reject)=>{$.get(encodedUrl).then(resolve).catch(reject);});},_fetchCoordinatesFromAddressOSM:function(record){const address=encodeURIComponent(record.contact_address_complete.replace('/',' '));const encodedUrl=`https://nominatim.openstreetmap.org/search/${address}?format=jsonv2`;return new Promise(function(resolve,reject){$.get(encodedUrl).then(resolve).catch(reject);});},_fetchData:async function(){if(!this.resPartnerField){this.data.recordGroups=[];this.data.records=[];this.data.routeInfo={routes:[]};return;}
const results=await this._fetchRecordData();this.data.records=results.records;this.data.count=results.length;if(this.data.groupBy){this.data.recordGroups=this._getRecordGroups();}else{this.data.recordGroups={};}
this.partnerIds=[];if(this.model==="res.partner"&&this.resPartnerField==="id"){this.data.records.forEach((record)=>{this.partnerIds.push(record.id);record.partner_id=[record.id];});}else{this._fillPartnerIds(this.data.records);}
this.partnerIds=_.uniq(this.partnerIds);return this._partnerFetching(this.partnerIds);},_fetchRecordData:function(){return this._rpc({route:'/web/dataset/search_read',model:this.model,context:this.context,fields:this.data.groupBy?this.fields.concat(this.data.groupBy.split(':')[0]):this.fields,domain:this.domain,orderBy:this.orderBy,limit:this.data.limit,offset:this.data.offset});},_getRecordGroups:function(){const[fieldName,subGroup]=this.data.groupBy.split(':');const dateGroupFormats={year:'YYYY',quarter:'[Q]Q YYYY',month:'MMMM YYYY',week:'[W]WW YYYY',day:'DD MMM YYYY',};const groups={};for(const record of this.data.records){const value=record[fieldName];let id,name;if(['date','datetime'].includes(this.fieldsInfo[fieldName].type)){const date=moment(value);id=name=date.format(dateGroupFormats[subGroup]);}else{id=Array.isArray(value)?value[0]:value;name=Array.isArray(value)?value[1]:value;}
if(!groups[id]){groups[id]={name,records:[],};}
groups[id].records.push(record);}
return groups;},_fetchRecordsPartner:function(ids){return this._rpc({model:'res.partner',method:'search_read',fields:['contact_address_complete','partner_latitude','partner_longitude'],domain:[['contact_address_complete','!=','False'],['id','in',ids]],});},_fetchRoute:function(){const coordinatesParam=this.data.records.filter(record=>record.partner.partner_latitude&&record.partner.partner_longitude).map(record=>record.partner.partner_longitude+','+record.partner.partner_latitude);const address=encodeURIComponent(coordinatesParam.join(';'));const token=this.data.mapBoxToken;const encodedUrl=`https://api.mapbox.com/directions/v5/mapbox/driving/${address}?access_token=${token}&steps=true&geometries=geojson`;return new Promise(function(resolve,reject){$.get(encodedUrl).then(resolve).catch(reject);});},_fillPartnerIds:function(records){return records.forEach(record=>{if(record[this.resPartnerField]){this.partnerIds.push(record[this.resPartnerField][0]);}});},_getErrorMessage:function(message){const ERROR_MESSAGES={'Too many coordinates; maximum number of coordinates is 25':_t("Too many routing points (maximum 25)"),'Route exceeds maximum distance limitation':_t("Some routing points are too far apart"),'Too Many Requests':_t("Too many requests, try again in a few minutes"),};return ERROR_MESSAGES[message];},_maxBoxAPI:function(){const promises=[];this.data.partners.forEach(partner=>{if(partner.contact_address_complete&&(!partner.partner_latitude||!partner.partner_longitude)){promises.push(this._fetchCoordinatesFromAddressMB(partner).then(coordinates=>{if(coordinates.features.length){partner.partner_longitude=coordinates.features[0].geometry.coordinates[0];partner.partner_latitude=coordinates.features[0].geometry.coordinates[1];this.partnerToCache.push(partner);}}));}else if(!this._checkCoordinatesValidity(partner)){partner.partner_latitude=undefined;partner.partner_longitude=undefined;}});return Promise.all(promises).then(()=>{this.data.routeInfo={routes:[]};if(this.numberOfLocatedRecords>1&&this.routing&&!this.data.groupBy){return this._fetchRoute().then(routeResult=>{if(routeResult.routes){this.data.routeInfo=routeResult;}else{this.data.routingError=this._getErrorMessage(routeResult.message);}});}else{return Promise.resolve();}});},_mapBoxErrorHandling:function(err){switch(err.status){case 401:this.do_warn(_t('Token invalid'),_t('The view has switched to another provider but functionalities will be limited'));break;case 403:this.do_warn(_t('Unauthorized connection'),_t('The view has switched to another provider but functionalities will be limited'));break;case 422:case 429:this.data.routingError=this._getErrorMessage(err.responseJSON.message);break;case 500:this.do_warn(_t('MapBox servers unreachable'),_t('The view has switched to another provider but functionalities will be limited'));}},_notifyFetchedCoordinate:function(){this._writeCoordinatesUsers();this.data.shouldUpdatePosition=false;this.trigger_up('coordinate_fetched');},_openStreetMapAPI:function(){this._openStreetMapAPIAsync();return Promise.resolve();},_openStreetMapAPIAsync:function(){const addressPartnerMap=new Map();for(const partner of this.data.partners){if(partner.contact_address_complete&&(!partner.partner_latitude||!partner.partner_longitude)){if(!addressPartnerMap.has(partner.contact_address_complete)){addressPartnerMap.set(partner.contact_address_complete,[]);}
addressPartnerMap.get(partner.contact_address_complete).push(partner);partner.fetchingCoordinate=true;}else if(!this._checkCoordinatesValidity(partner)){partner.partner_latitude=undefined;partner.partner_longitude=undefined;}}
this.data.fetchingCoordinates=addressPartnerMap.size>0;const fetch=async()=>{const partnersList=Array.from(addressPartnerMap.values());for(let i=0;i<partnersList.length;i++){const partners=partnersList[i];try{const coordinates=await this._fetchCoordinatesFromAddressOSM(partners[0]);if(coordinates.length){for(const partner of partners){partner.partner_longitude=coordinates[0].lon;partner.partner_latitude=coordinates[0].lat;this.partnerToCache.push(partner);}}}finally{for(const partner of partners){partner.fetchingCoordinate=false;}
this.data.fetchingCoordinates=(i<partnersList.length-1);this._notifyFetchedCoordinate();await new Promise((resolve)=>{this.coordinateFetchingTimeoutHandle=setTimeout(resolve,this.COORDINATE_FETCH_DELAY);});}}}
return fetch();},_partnerFetching:async function(partnerIds){this.data.partners=partnerIds.length?await this._fetchRecordsPartner(partnerIds):[];this._addPartnerToRecord();if(this.data.mapBoxToken){return this._maxBoxAPI().then(()=>{this._writeCoordinatesUsers();}).catch((err)=>{this._mapBoxErrorHandling(err);this.data.mapBoxToken='';return this._openStreetMapAPI();});}else{return this._openStreetMapAPI().then(()=>{this._writeCoordinatesUsers();});}},_writeCoordinatesUsers:function(){if(this.partnerToCache.length){this._rpc({model:'res.partner',method:'update_latitude_longitude',context:self.context,args:[this.partnerToCache]});this.partnerToCache=[];}},});return MapModel;});;

/* /web_map/static/src/js/map_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_map.MapRenderer',function(require){"use strict";const AbstractRendererOwl=require('web.AbstractRendererOwl');const{useRef,useState}=owl.hooks;const apiTilesRouteWithToken='https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}';const apiTilesRouteWithoutToken='https://a.tile.openstreetmap.org/{z}/{x}/{y}.png';const colors=['#F06050','#6CC1ED','#F7CD1F','#814968','#30C381','#D6145F','#475577','#F4A460','#EB7E7F','#2C8397',];const mapTileAttribution=`
         <a href="https://www.mapbox.com/about/maps/">Mapbox</a>
         <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>
        <strong>
            <a href="https://www.mapbox.com/map-feedback/" target="_blank">
                Improve this map
            </a>
        </strong>`;class MapRenderer extends AbstractRendererOwl{constructor(){super(...arguments);this.leafletMap=null;this.markers=[];this.polylines=[];this.mapContainerRef=useRef('mapContainer');this.state=useState({closedGroupIds:[],});}
async willStart(){const p={method:'GET'};[this._pinCircleSVG,this._pinNoCircleSVG]=await Promise.all([this.env.services.httpRequest('web_map/static/img/pin-circle.svg',p,'text'),this.env.services.httpRequest('web_map/static/img/pin-no-circle.svg',p,'text'),]);return super.willStart(...arguments);}
mounted(){this.leafletMap=L.map(this.mapContainerRef.el,{maxBounds:[L.latLng(180,-180),L.latLng(-180,180)],});L.tileLayer(this.apiTilesRoute,{attribution:mapTileAttribution,tileSize:512,zoomOffset:-1,minZoom:2,maxZoom:19,id:'mapbox/streets-v11',accessToken:this.props.mapBoxToken,}).addTo(this.leafletMap);this._updateMap();super.mounted(...arguments);}
patched(){this._updateMap();super.patched(...arguments);}
willUpdateProps(nextProps){if(this.props.groupBy!==nextProps.groupBy){this.state.closedGroupIds=[];}
return super.willUpdateProps(...arguments);}
willUnmount(){for(const marker of this.markers){marker.off('click');}
for(const polyline of this.polylines){polyline.off('click');}
this.leafletMap.remove();super.willUnmount(...arguments);}
get apiTilesRoute(){return this.props.mapBoxToken?apiTilesRouteWithToken:apiTilesRouteWithoutToken;}
_addMarkers(){this._removeMarkers();const markersInfo={};let records=this.props.records;if(this.props.groupBy){records=Object.entries(this.props.recordGroups).filter(([key])=>!this.state.closedGroupIds.includes(key)).flatMap(([,value])=>value.records);}
for(const record of records){const partner=record.partner;if(partner&&partner.partner_latitude&&partner.partner_longitude){const key=`${partner.partner_latitude}-${partner.partner_longitude}`;if(key in markersInfo){markersInfo[key].record=record;markersInfo[key].ids.push(record.id);}else{markersInfo[key]={record:record,ids:[record.id]};}}}
for(const markerInfo of Object.values(markersInfo)){const params={count:markerInfo.ids.length,isMulti:markerInfo.ids.length>1,number:this.props.records.indexOf(markerInfo.record)+1,numbering:this.props.numbering,pinSVG:(this.props.numbering?this._pinNoCircleSVG:this._pinCircleSVG),};if(this.props.groupBy){const group=Object.entries(this.props.recordGroups).find(([,value])=>value.records.includes(markerInfo.record));params.color=this._getGroupColor(group[0]);}
const iconInfo={className:'o_map_marker',html:this.env.qweb.renderToString('web_map.marker',params),};const marker=L.marker([markerInfo.record.partner.partner_latitude,markerInfo.record.partner.partner_longitude],{icon:L.divIcon(iconInfo)});marker.addTo(this.leafletMap);marker.on('click',()=>{this._createMarkerPopup(markerInfo);});this.markers.push(marker);}}
_addRoutes(){this._removeRoutes();if(!this.props.mapBoxToken||!this.props.routeInfo.routes.length){return;}
for(const leg of this.props.routeInfo.routes[0].legs){const latLngs=[];for(const step of leg.steps){for(const coordinate of step.geometry.coordinates){latLngs.push(L.latLng(coordinate[1],coordinate[0]));}}
const polyline=L.polyline(latLngs,{color:'blue',weight:5,opacity:0.3,}).addTo(this.leafletMap);const polylines=this.polylines;polyline.on('click',function(){for(const polyline of polylines){polyline.setStyle({color:'blue',opacity:0.3});}
this.setStyle({color:'darkblue',opacity:1.0});});this.polylines.push(polyline);}}
_createMarkerPopup(markerInfo){const popupFields=this._getMarkerPopupFields(markerInfo);const partner=markerInfo.record.partner;const popupHtml=this.env.qweb.renderToString('web_map.markerPopup',{fields:popupFields,hasFormView:this.props.hasFormView,url:`https://www.google.com/maps/dir/?api=1&destination=${partner.partner_latitude},${partner.partner_longitude}`,});const popup=L.popup({offset:[0,-30]}).setLatLng([partner.partner_latitude,partner.partner_longitude]).setContent(popupHtml).openOn(this.leafletMap);const openBtn=popup.getElement().querySelector('button.o_open');if(openBtn){openBtn.onclick=()=>{this.trigger('open_clicked',{ids:markerInfo.ids});};}}
_getGroupColor(groupId){const index=Object.keys(this.props.recordGroups).indexOf(groupId);return colors[index%colors.length];}
_getLatLng(){const tabLatLng=[];for(const record of this.props.records){const partner=record.partner;if(partner&&partner.partner_latitude&&partner.partner_longitude){tabLatLng.push(L.latLng(partner.partner_latitude,partner.partner_longitude));}}
if(!tabLatLng.length){return false;}
return L.latLngBounds(tabLatLng);}
_getMarkerPopupFields(markerInfo){const record=markerInfo.record;const fieldsView=[];if(markerInfo.ids.length>1){if(!this.props.hideAddress){fieldsView.push({value:record.partner.contact_address_complete,string:this.env._t("Address"),});}
return fieldsView;}
if(!this.props.hideName){fieldsView.push({value:record.display_name,string:this.env._t("Name"),});}
if(!this.props.hideAddress){fieldsView.push({value:record.partner.contact_address_complete,string:this.env._t("Address"),});}
for(const field of this.props.fieldNamesMarkerPopup){if(record[field.fieldName]){const fieldName=record[field.fieldName]instanceof Array?record[field.fieldName][1]:record[field.fieldName];fieldsView.push({value:fieldName,string:field.string,});}}
return fieldsView;}
_removeMarkers(){for(const marker of this.markers){this.leafletMap.removeLayer(marker);}
this.markers=[];}
_removeRoutes(){for(const polyline of this.polylines){this.leafletMap.removeLayer(polyline);}
this.polylines=[];}
_updateMap(){if(this.props.shouldUpdatePosition){const initialCoord=this._getLatLng();if(initialCoord){this.leafletMap.flyToBounds(initialCoord,{animate:false});}else{this.leafletMap.fitWorld();}
this.leafletMap.closePopup();}
this._addMarkers();this._addRoutes();}
_centerAndOpenPin(record){this._createMarkerPopup({record:record,ids:[record.id],});this.leafletMap.panTo([record.partner.partner_latitude,record.partner.partner_longitude,],{animate:true,});}
_toggleGroup(id){if(this.state.closedGroupIds.includes(id)){const index=this.state.closedGroupIds.indexOf(id);this.state.closedGroupIds.splice(index,1);}else{this.state.closedGroupIds.push(id);}}}
MapRenderer.props={arch:Object,count:Number,defaultOrder:{type:String,optional:true,},fetchingCoordinates:Boolean,fieldNamesMarkerPopup:{type:Array,element:{type:Object,shape:{fieldName:String,string:String,},},},groupBy:[String,Boolean],hasFormView:Boolean,hideAddress:Boolean,hideName:Boolean,isEmbedded:Boolean,limit:Number,mapBoxToken:{type:[Boolean,String],optional:1},noContentHelp:{type:String,optional:true,},numbering:Boolean,hideTitle:Boolean,panelTitle:String,offset:Number,partners:{type:[Array,Boolean],optional:1},recordGroups:Object,records:Array,routeInfo:{type:Object,optional:true,},routing:Boolean,routingError:{type:String,optional:true,},shouldUpdatePosition:Boolean,};MapRenderer.template='web_map.MapRenderer';return MapRenderer;});;

/* /web_map/static/src/js/map_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_map.MapView',function(require){"use strict";const MapModel=require('web_map.MapModel');const MapController=require('web_map.MapController');const MapRenderer=require('web_map.MapRenderer');const AbstractView=require('web.AbstractView');const RendererWrapper=require('web.RendererWrapper');const utils=require('web.utils');const viewRegistry=require('web.view_registry');const _t=require('web.core')._t;const MapView=AbstractView.extend({jsLibs:['/web_map/static/lib/leaflet/leaflet.js',],config:_.extend({},AbstractView.prototype.config,{Model:MapModel,Controller:MapController,Renderer:MapRenderer,}),icon:'fa-map-marker',display_name:'Map',viewType:'map',mobile_friendly:true,searchMenuTypes:['filter','groupBy','favorite'],init:function(viewInfo,params){this._super.apply(this,arguments);const fieldNames=[];const fieldNamesMarkerPopup=[];this.loadParams.resPartnerField=this.arch.attrs.res_partner;fieldNames.push(this.arch.attrs.res_partner);fieldNames.push('display_name');if(this.arch.attrs.default_order){this.loadParams.orderBy=[{name:this.arch.attrs.default_order||'display_name',asc:true}];}
const routing=["true","True","1"].includes(this.arch.attrs.routing);this.loadParams.limit=this.arch.attrs.limit?parseInt(this.arch.attrs.limit,10):params.limit||80;this.loadParams.routing=routing;this.rendererParams.routing=routing;this.rendererParams.numbering=this.arch.attrs.routing?true:false;this.rendererParams.defaultOrder=this.arch.attrs.default_order;this.rendererParams.panelTitle=this.arch.attrs.panel_title||params.displayName||_t('Items');this.rendererParams.hideTitle=utils.toBoolElse(this.arch.attrs.hide_title||'',false);const hideName=utils.toBoolElse(this.arch.attrs.hide_name||'',false);this.rendererParams.hideName=hideName;if(!hideName){fieldNames.push('display_name');}
this.rendererParams.hideAddress=utils.toBoolElse(this.arch.attrs.hide_address||'',false);this.arch.children.forEach(node=>{if(node.tag==='field'){fieldNames.push(node.attrs.name);fieldNamesMarkerPopup.push({fieldName:node.attrs.name,string:node.attrs.string});}});this.loadParams.fieldsInfo=this.fields;this.loadParams.fieldNames=_.uniq(fieldNames);this.rendererParams.fieldNamesMarkerPopup=fieldNamesMarkerPopup;this.rendererParams.hasFormView=params.actionViews.some(view=>view.type==="form");this.controllerParams.actionName=params.action?params.action.name:_t("Untitled");},getRenderer(parent,state){state=Object.assign({},state,this.rendererParams);return new RendererWrapper(null,this.config.Renderer,state);},});viewRegistry.add('map',MapView);return MapView;});;

/* /barcodes_mobile/static/src/js/barcode_events.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('barcodes_mobile.BarcodeEvents',function(require){"use strict";var BarcodeEvents=require('barcodes.BarcodeEvents');const mobile=require('web_mobile.core');if(!mobile.methods.closeVirtualKeyboard){return;}
var barcodeEvents=BarcodeEvents.BarcodeEvents;barcodeEvents.$barcodeInput.on('focus',function(){setTimeout(mobile.methods.closeVirtualKeyboard,0);});barcodeEvents._blurBarcodeInput=function(){if(this.$barcodeInput){this.$barcodeInput.val('');}}
barcodeEvents.__blurBarcodeInput=_.debounce(barcodeEvents._blurBarcodeInput,barcodeEvents.inputTimeOut);});;

/* /barcodes_mobile/static/src/js/barcode_mobile_mixin.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_mobile.barcode_mobile_mixin',function(require){"use strict";const mobile=require('web_mobile.core');return{events:{'click .o_mobile_barcode':'open_mobile_scanner'},async start(){const res=await this._super(...arguments);if(!mobile.methods.scanBarcode){this.$el.find(".o_mobile_barcode").remove();}
return res;},async open_mobile_scanner(){const response=await mobile.methods.scanBarcode();const barcode=response.data;if(barcode){this._onBarcodeScanned(barcode);mobile.methods.vibrate({'duration':100});}else{mobile.methods.showToast({'message':'Please, Scan again !!'});}}};});;

/* /base_automation/static/src/js/base_automation_error_dialog.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('base_automation.BaseAutomatioErrorDialog',function(require){"use strict";const CrashManager=require('web.CrashManager');const ErrorDialog=CrashManager.ErrorDialog;const ErrorDialogRegistry=require('web.ErrorDialogRegistry');const session=require('web.session');const BaseAutomationErrorDialog=ErrorDialog.extend({xmlDependencies:(ErrorDialog.prototype.xmlDependencies||[]).concat(['/base_automation/static/src/xml/base_automation_error_dialog.xml']),template:'CrashManager.BaseAutomationError',events:{'click .o_disable_action_button':'_onDisableAction','click .o_edit_action_button':'_onEditAction',},init:function(parent,options,error){this._super.apply(this,arguments);this.base_automation=error.data.context.base_automation;this.is_admin=session.is_admin;},_onDisableAction:function(ev){ev.preventDefault();this._rpc({model:'base.automation',method:'write',args:[[this.base_automation.id],{active:false,}],}).then(this.destroy.bind(this));},_onEditAction:function(ev){ev.preventDefault();this.do_action({name:'Automated Actions',res_model:'base.automation',res_id:this.base_automation.id,views:[[false,'form']],type:'ir.actions.act_window',view_mode:'form',});},});ErrorDialogRegistry.add('base_automation',BaseAutomationErrorDialog);});;

/* /calendar/static/src/js/base_calendar.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('base_calendar.base_calendar',function(require){"use strict";var BasicModel=require('web.BasicModel');var fieldRegistry=require('web.field_registry');var Notification=require('web.Notification');var relationalFields=require('web.relational_fields');var session=require('web.session');var WebClient=require('web.WebClient');var FieldMany2ManyTags=relationalFields.FieldMany2ManyTags;var CalendarNotification=Notification.extend({template:"CalendarNotification",xmlDependencies:(Notification.prototype.xmlDependencies||[]).concat(['/calendar/static/src/xml/notification_calendar.xml']),init:function(parent,params){this._super(parent,params);this.eid=params.eventID;this.sticky=true;this.events=_.extend(this.events||{},{'click .link2event':function(){var self=this;this._rpc({route:'/web/action/load',params:{action_id:'calendar.action_calendar_event_notify',},}).then(function(r){r.res_id=self.eid;return self.do_action(r);});},'click .link2recall':function(){this.close();},'click .link2showed':function(){this._rpc({route:'/calendar/notify_ack'}).then(this.close.bind(this,false),this.close.bind(this,false));},});},});WebClient.include({display_calendar_notif:function(notifications){var self=this;var last_notif_timer=0;clearTimeout(this.get_next_calendar_notif_timeout);_.each(this.calendar_notif_timeouts,clearTimeout);this.calendar_notif_timeouts={};_.each(notifications,function(notif){var key=notif.event_id+','+notif.alarm_id;if(key in self.calendar_notif){return;}
self.calendar_notif_timeouts[key]=setTimeout(function(){var notificationID=self.call('notification','notify',{Notification:CalendarNotification,title:notif.title,message:notif.message,eventID:notif.event_id,onClose:function(){delete self.calendar_notif[key];},});self.calendar_notif[key]=notificationID;},notif.timer*1000);last_notif_timer=Math.max(last_notif_timer,notif.timer);});if(last_notif_timer>0){this.get_next_calendar_notif_timeout=setTimeout(this.get_next_calendar_notif.bind(this),last_notif_timer*1000);}},get_next_calendar_notif:function(){session.rpc("/calendar/notify",{},{shadow:true}).then(this.display_calendar_notif.bind(this)).guardedCatch(function(reason){var err=reason.message;var ev=reason.event;if(err.code===-32098){ev.preventDefault();}});},show_application:function(){this.calendar_notif_timeouts={};this.calendar_notif={};this.call('bus_service','onNotification',this,function(notifications){_.each(notifications,(function(notification){if(notification[0][1]==='calendar.alarm'){this.display_calendar_notif(notification[1]);}}).bind(this));});return this._super.apply(this,arguments).then(this.get_next_calendar_notif.bind(this));},});BasicModel.include({_fetchSpecialAttendeeStatus:function(record,fieldName){var context=record.getContext({fieldName:fieldName});var attendeeIDs=record.data[fieldName]?this.localData[record.data[fieldName]].res_ids:[];var meetingID=_.isNumber(record.res_id)?record.res_id:false;return this._rpc({model:'res.partner',method:'get_attendee_detail',args:[attendeeIDs,meetingID],context:context,}).then(function(result){return _.map(result,function(d){return _.object(['id','display_name','status','color'],d);});});},});var Many2ManyAttendee=FieldMany2ManyTags.extend({tag_template:"Many2ManyAttendeeTag",specialData:"_fetchSpecialAttendeeStatus",_getRenderTagsContext:function(){var result=this._super.apply(this,arguments);result.attendeesData=this.record.specialData.partner_ids;return result;},});fieldRegistry.add('many2manyattendee',Many2ManyAttendee);});;

/* /calendar/static/src/js/calendar_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('calendar.CalendarRenderer',function(require){"use strict";const CalendarRenderer=require('web.CalendarRenderer');const CalendarPopover=require('web.CalendarPopover');const session=require('web.session');const AttendeeCalendarPopover=CalendarPopover.extend({template:'Calendar.attendee.status.popover',events:_.extend({},CalendarPopover.prototype.events,{'click .o-calendar-attendee-status .dropdown-item':'_onClickAttendeeStatus'}),init:function(){var self=this;this._super.apply(this,arguments);if(this.isCurrentPartnerAttendee()){this.statusColors={accepted:'text-success',declined:'text-danger',tentative:'text-muted',needsAction:'text-dark'};this.statusInfo={};_.each(this.fields.attendee_status.selection,function(selection){self.statusInfo[selection[0]]={text:selection[1],color:self.statusColors[selection[0]]};});this.selectedStatusInfo=this.statusInfo[this.event.extendedProps.record.attendee_status];}},isCurrentPartnerAttendee(){return this.event.extendedProps.record.partner_ids.includes(session.partner_id);},isEventDeletable(){return this._super()&&(this._isEventPrivate()?this.isCurrentPartnerAttendee():true);},isEventDetailsVisible(){return this._isEventPrivate()?this.isCurrentPartnerAttendee():this._super();},isEventEditable(){return this._isEventPrivate()?this.isCurrentPartnerAttendee():this._super();},_isEventPrivate(){return this.event.extendedProps.record.privacy==='private';},_onClickAttendeeStatus:function(ev){ev.preventDefault();var self=this;var selectedStatus=$(ev.currentTarget).attr('data-action');this._rpc({model:'calendar.event',method:'change_attendee_status',args:[parseInt(this.event.id),selectedStatus],}).then(function(){self.event.extendedProps.record.attendee_status=selectedStatus;self.$('.o-calendar-attendee-status-text').text(self.statusInfo[selectedStatus].text);self.$('.o-calendar-attendee-status-icon').removeClass(_.values(self.statusColors).join(' ')).addClass(self.statusInfo[selectedStatus].color);});},});const AttendeeCalendarRenderer=CalendarRenderer.extend({config:_.extend({},CalendarRenderer.prototype.config,{CalendarPopover:AttendeeCalendarPopover,}),});return AttendeeCalendarRenderer});;

/* /calendar/static/src/js/calendar_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('calendar.CalendarController',function(require){"use strict";const Controller=require('web.CalendarController');const Dialog=require('web.Dialog');const{qweb,_t}=require('web.core');const CalendarController=Controller.extend({_askRecurrenceUpdatePolicy(){return new Promise((resolve,reject)=>{new Dialog(this,{title:_t('Edit Recurrent event'),size:'small',$content:$(qweb.render('calendar.RecurrentEventUpdate')),buttons:[{text:_t('Confirm'),classes:'btn-primary',close:true,click:function(){resolve(this.$('input:checked').val());},}],}).open();});},async _onDropRecord(event){const _super=this._super;if(event.data.record.recurrency){const recurrenceUpdate=await this._askRecurrenceUpdatePolicy();event.data=_.extend({},event.data,{'recurrenceUpdate':recurrenceUpdate,});}
_super.apply(this,arguments);},async _onUpdateRecord(event){const _super=this._super;if(event.data.record.recurrency){const recurrenceUpdate=await this._askRecurrenceUpdatePolicy();event.data=_.extend({},event.data,{'recurrenceUpdate':recurrenceUpdate,});}
_super.apply(this,arguments);},});return CalendarController;});;

/* /calendar/static/src/js/calendar_model.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('calendar.CalendarModel',function(require){"use strict";const Model=require('web.CalendarModel');const CalendarModel=Model.extend({calendarEventToRecord(event){const data=this._super(event);return _.extend({},data,{'recurrence_update':event.recurrenceUpdate,});}});return CalendarModel;});;

/* /calendar/static/src/js/calendar_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('calendar.CalendarView',function(require){"use strict";var CalendarController=require('calendar.CalendarController');var CalendarModel=require('calendar.CalendarModel');const CalendarRenderer=require('calendar.CalendarRenderer');var CalendarView=require('web.CalendarView');var viewRegistry=require('web.view_registry');var AttendeeCalendarView=CalendarView.extend({config:_.extend({},CalendarView.prototype.config,{Renderer:CalendarRenderer,Controller:CalendarController,Model:CalendarModel,}),});viewRegistry.add('attendee_calendar',AttendeeCalendarView);return AttendeeCalendarView});;

/* /calendar/static/src/js/mail_activity.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('calendar.Activity',function(require){"use strict";var Activity=require('mail.Activity');var Dialog=require('web.Dialog');var core=require('web.core');var _t=core._t;Activity.include({_onEditActivity:function(event,options){var self=this;var activity_id=$(event.currentTarget).data('activity-id');var activity=_.find(this.activities,function(act){return act.id===activity_id;});if(activity&&activity.activity_category==='meeting'&&activity.calendar_event_id){return self._super(event,_.extend({res_model:'calendar.event',res_id:activity.calendar_event_id[0],}));}
return self._super(event,options);},_onUnlinkActivity:function(event,options){event.preventDefault();var self=this;var activity_id=$(event.currentTarget).data('activity-id');var activity=_.find(this.activities,function(act){return act.id===activity_id;});if(activity&&activity.activity_category==='meeting'&&activity.calendar_event_id){Dialog.confirm(self,_t("The activity is linked to a meeting. Deleting it will remove the meeting as well. Do you want to proceed ?"),{confirm_callback:function(){return self._rpc({model:'mail.activity',method:'unlink_w_meeting',args:[[activity_id]],}).then(self._reload.bind(self,{activity:true}));},});}
else{return self._super(event,options);}},});});;

/* /calendar/static/src/js/systray_activity_menu.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('calendar.systray.ActivityMenu',function(require){"use strict";var ActivityMenu=require('mail.systray.ActivityMenu');var fieldUtils=require('web.field_utils');ActivityMenu.include({_getActivityData:function(){var self=this;return this._super.apply(this,arguments).then(function(){var meeting=_.find(self._activities,{type:'meeting'});if(meeting&&meeting.meetings){_.each(meeting.meetings,function(res){res.start=fieldUtils.parse.datetime(res.start,false,{isUTC:true});});}});},_onActivityFilterClick:function(ev){var $el=$(ev.currentTarget);var data=_.extend({},$el.data());if(data.res_model==="calendar.event"&&data.filter==="my"){this.do_action('calendar.action_calendar_event',{additional_context:{default_mode:'day',search_default_mymeetings:1,},clear_breadcrumbs:true,});}else{this._super.apply(this,arguments);}},});});;

/* /hr/static/src/bugfix/bugfix.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('hr/static/src/bugfix/bugfix.js',function(require){'use strict';});;

/* /hr/static/src/js/chat.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('hr.employee_chat',function(require){'use strict';var viewRegistry=require('web.view_registry');var FormController=require('web.FormController');var FormView=require('web.FormView');var FormRenderer=require('web.FormRenderer');var KanbanController=require('web.KanbanController');var KanbanView=require('web.KanbanView');var KanbanRenderer=require('web.KanbanRenderer');var KanbanRecord=require('web.KanbanRecord');const{Component}=owl;var ChatMixin={_render:function(){var self=this;return this._super.apply(this,arguments).then(function(){var $chat_button=self.$el.find('.o_employee_chat_btn');$chat_button.off('click').on('click',self._onOpenChat.bind(self));});},destroy:function(){this.$el.find('.o_employee_chat_btn').off('click');return this._super();},_onOpenChat:function(ev){ev.preventDefault();ev.stopImmediatePropagation();const env=Component.env;env.messaging.openChat({employeeId:this.state.data.id});return true;},};var EmployeeFormRenderer=FormRenderer.extend(ChatMixin);var EmployeeFormView=FormView.extend({config:_.extend({},FormView.prototype.config,{Controller:FormController,Renderer:EmployeeFormRenderer}),});viewRegistry.add('hr_employee_form',EmployeeFormView);var EmployeeKanbanRecord=KanbanRecord.extend(ChatMixin);var EmployeeKanbanRenderer=KanbanRenderer.extend({config:Object.assign({},KanbanRenderer.prototype.config,{KanbanRecord:EmployeeKanbanRecord,}),});var EmployeeKanbanView=KanbanView.extend({config:_.extend({},KanbanView.prototype.config,{Controller:KanbanController,Renderer:EmployeeKanbanRenderer}),});viewRegistry.add('hr_employee_kanban',EmployeeKanbanView);});;

/* /hr/static/src/js/language.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('hr.employee_language',function(require){'use strict';var FormController=require('web.FormController');var FormView=require('web.FormView');var viewRegistry=require('web.view_registry');var EmployeeFormController=FormController.extend({saveRecord:function(){var self=this;return this._super.apply(this,arguments).then(function(){if(arguments[0].indexOf('lang')>=0){self.do_action('reload_context');}});},});var EmployeeProfileFormView=FormView.extend({config:_.extend({},FormView.prototype.config,{Controller:EmployeeFormController,}),});viewRegistry.add('hr_employee_profile_form',EmployeeProfileFormView);return EmployeeProfileFormView;});;

/* /hr/static/src/js/many2one_avatar_employee.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('hr.Many2OneAvatarEmployee',function(require){"use strict";const fieldRegistry=require('web.field_registry');const{Many2OneAvatarUser,KanbanMany2OneAvatarUser}=require('mail.Many2OneAvatarUser');const{Component}=owl;const Many2OneAvatarEmployeeMixin={supportedModels:['hr.employee','hr.employee.public'],async _onAvatarClicked(ev){ev.stopPropagation();const env=Component.env;await env.messaging.openChat({employeeId:this.value.res_id});}};const Many2OneAvatarEmployee=Many2OneAvatarUser.extend(Many2OneAvatarEmployeeMixin);const KanbanMany2OneAvatarEmployee=KanbanMany2OneAvatarUser.extend(Many2OneAvatarEmployeeMixin);fieldRegistry.add('many2one_avatar_employee',Many2OneAvatarEmployee);fieldRegistry.add('kanban.many2one_avatar_employee',KanbanMany2OneAvatarEmployee);return{Many2OneAvatarEmployee,KanbanMany2OneAvatarEmployee,};});;

/* /hr/static/src/js/standalone_m2o_avatar_employee.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('hr.StandaloneM2OAvatarEmployee',function(require){'use strict';const StandaloneFieldManagerMixin=require('web.StandaloneFieldManagerMixin');const Widget=require('web.Widget');const{Many2OneAvatarEmployee}=require('hr.Many2OneAvatarEmployee');const StandaloneM2OAvatarEmployee=Widget.extend(StandaloneFieldManagerMixin,{className:'o_standalone_avatar_employee',init(parent,value){this._super(...arguments);StandaloneFieldManagerMixin.init.call(this);this.value=value;},willStart(){return Promise.all([this._super(...arguments),this._makeAvatarWidget()]);},start(){this.avatarWidget.$el.appendTo(this.$el);return this._super(...arguments);},async _makeAvatarWidget(){const modelName='hr.employee';const fieldName='employee_id';const recordId=await this.model.makeRecord(modelName,[{name:fieldName,relation:modelName,type:'many2one',value:this.value,}]);const state=this.model.get(recordId);this.avatarWidget=new Many2OneAvatarEmployee(this,fieldName,state);this._registerWidget(recordId,fieldName,this.avatarWidget);return this.avatarWidget.appendTo(document.createDocumentFragment());},});return StandaloneM2OAvatarEmployee;});;

/* /hr/static/src/models/employee/employee.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('hr/static/src/models/employee/employee.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{attr,one2one}=require('mail/static/src/model/model_field.js');function factory(dependencies){class Employee extends dependencies['mail.model']{static convertData(data){const data2={};if('id'in data){data2.id=data.id;}
if('user_id'in data){data2.hasCheckedUser=true;if(!data.user_id){data2.user=[['unlink']];}else{const partnerNameGet=data['user_partner_id'];const partnerData={display_name:partnerNameGet[1],id:partnerNameGet[0],};const userNameGet=data['user_id'];const userData={id:userNameGet[0],partner:[['insert',partnerData]],display_name:userNameGet[1],};data2.user=[['insert',userData]];}}
return data2;}
static async performRpcRead({context,fields,ids}){const employeesData=await this.env.services.rpc({model:'hr.employee.public',method:'read',args:[ids],kwargs:{context,fields,},});this.env.models['hr.employee'].insert(employeesData.map(employeeData=>this.env.models['hr.employee'].convertData(employeeData)));}
static async performRpcSearchRead({context,domain,fields}){const employeesData=await this.env.services.rpc({model:'hr.employee.public',method:'search_read',kwargs:{context,domain,fields,},});this.env.models['hr.employee'].insert(employeesData.map(employeeData=>this.env.models['hr.employee'].convertData(employeeData)));}
async checkIsUser(){return this.env.models['hr.employee'].performRpcRead({ids:[this.id],fields:['user_id','user_partner_id'],context:{active_test:false},});}
async getChat(){if(!this.user&&!this.hasCheckedUser){await this.async(()=>this.checkIsUser());}
if(!this.user){this.env.services['notification'].notify({message:this.env._t("You can only chat with employees that have a dedicated user."),type:'info',});return;}
return this.user.getChat();}
async openChat(options){const chat=await this.async(()=>this.getChat());if(!chat){return;}
await this.async(()=>chat.open(options));return chat;}
async openProfile(){return this.env.messaging.openDocument({id:this.id,model:'hr.employee.public',});}
static _createRecordLocalId(data){return`${this.modelName}_${data.id}`;}}
Employee.fields={hasCheckedUser:attr({default:false,}),id:attr(),partner:one2one('mail.partner',{inverse:'employee',related:'user.partner',}),user:one2one('mail.user',{inverse:'employee',}),};Employee.modelName='hr.employee';return Employee;}
registerNewModel('hr.employee',factory);});;

/* /hr/static/src/models/messaging/messaging.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('hr/static/src/models/messaging/messaging.js',function(require){'use strict';const{registerInstancePatchModel,}=require('mail/static/src/model/model_core.js');registerInstancePatchModel('mail.messaging','hr/static/src/models/messaging/messaging.js',{async getChat({employeeId}){if(employeeId){const employee=this.env.models['hr.employee'].insert({id:employeeId});return employee.getChat();}
return this._super(...arguments);},async openProfile({id,model}){if(model==='hr.employee'||model==='hr.employee.public'){const employee=this.env.models['hr.employee'].insert({id});return employee.openProfile();}
return this._super(...arguments);},});});;

/* /hr/static/src/models/partner/partner.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('hr/static/src/models/partner/partner.js',function(require){'use strict';const{registerInstancePatchModel,registerFieldPatchModel,}=require('mail/static/src/model/model_core.js');const{attr,one2one}=require('mail/static/src/model/model_field.js');registerInstancePatchModel('mail.partner','hr/static/src/models/partner/partner.js',{async checkIsEmployee(){await this.async(()=>this.env.models['hr.employee'].performRpcSearchRead({context:{active_test:false},domain:[['user_partner_id','=',this.id]],fields:['user_id','user_partner_id'],}));this.update({hasCheckedEmployee:true});},async openProfile(){const _super=this._super.bind(this,...arguments);if(!this.employee&&!this.hasCheckedEmployee){await this.async(()=>this.checkIsEmployee());}
if(this.employee){return this.employee.openProfile();}
return _super();},});registerFieldPatchModel('mail.partner','hr/static/src/models/partner/partner.js',{employee:one2one('hr.employee',{inverse:'partner',}),hasCheckedEmployee:attr({default:false,}),});});;

/* /hr/static/src/models/user/user.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('hr/static/src/models/user/user.js',function(require){'use strict';const{registerFieldPatchModel,}=require('mail/static/src/model/model_core.js');const{one2one}=require('mail/static/src/model/model_field.js');registerFieldPatchModel('mail.user','hr/static/src/models/user/user.js',{employee:one2one('hr.employee',{inverse:'user',}),});});;

/* /lunch/static/src/js/lunch_controller_common.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('lunch.LunchControllerCommon',function(require){"use strict";var session=require('web.session');var core=require('web.core');var LunchWidget=require('lunch.LunchWidget');var LunchPaymentDialog=require('lunch.LunchPaymentDialog');var _t=core._t;var LunchControllerCommon={custom_events:{add_product:'_onAddProduct',change_location:'_onLocationChanged',change_user:'_onUserChanged',open_wizard:'_onOpenWizard',order_now:'_onOrderNow',remove_product:'_onRemoveProduct',unlink_order:'_onUnlinkOrder',},init:function(){this._super.apply(this,arguments);this.editMode=false;this.updated=false;this.widgetData=null;this.context=session.user_context;this.archiveEnabled=false;},start:function(){var self=this;this.$('.o_content').append($('<div>').addClass('o_lunch_content'));return this._super.apply(this,arguments).then(function(){self.$('.o_lunch_content').append(self.$('.o_lunch_view'));});},_fetchPaymentInfo:function(){return this._rpc({route:'/lunch/payment_message',params:{context:this.context,},});},_fetchWidgetData:async function(){this.widgetData=await this._rpc({route:'/lunch/infos',params:{user_id:this.searchModel.get('userId'),context:this.context,},});},_renderLunchWidget:function(){var self=this;var oldWidget=this.widget;this.widgetData.wallet=parseFloat(this.widgetData.wallet).toFixed(2);this.widget=new LunchWidget(this,_.extend(this.widgetData,{edit:this.editMode}));return this.widget.appendTo(document.createDocumentFragment()).then(function(){self.$('.o_lunch_content').prepend(self.widget.$el);if(oldWidget){oldWidget.destroy();}});},_showPaymentDialog:function(title){var self=this;title=title||'';this._fetchPaymentInfo().then(function(data){var paymentDialog=new LunchPaymentDialog(self,_.extend(data,{title:title}));paymentDialog.open();});},_update:function(){var def=this._fetchWidgetData().then(this._renderLunchWidget.bind(this));return Promise.all([def,this._super.apply(this,arguments)]);},_onAddProduct:function(ev){var self=this;ev.stopPropagation();this._rpc({model:'lunch.order',method:'update_quantity',args:[[ev.data.lineId],1],}).then(function(){self.reload();});},_onLocationChanged:function(ev){ev.stopPropagation();this.searchModel.dispatch('setLocationId',ev.data.locationId);},_onOpenWizard:function(ev){var self=this;ev.stopPropagation();var ctx=this.searchModel.get('userId')?{default_user_id:this.searchModel.get('userId')}:{};var options={on_close:function(){self.reload();},};var action={res_model:'lunch.order',name:_t('Configure Your Order'),type:'ir.actions.act_window',views:[[false,'form']],target:'new',context:_.extend(ctx,{default_product_id:ev.data.productId}),};if(ev.data.lineId){action=_.extend(action,{res_id:ev.data.lineId,context:_.extend(action.context,{active_id:ev.data.lineId,}),});}
this.do_action(action,options);},_onOrderNow:function(ev){var self=this;ev.stopPropagation();this._rpc({route:'/lunch/pay',params:{user_id:this.searchModel.get('userId'),context:this.context,},}).then(function(isPaid){if(isPaid){self.reload();}else{self._showPaymentDialog(_t("Not enough money in your wallet"));self.reload();}});},_onRemoveProduct:function(ev){var self=this;ev.stopPropagation();this._rpc({model:'lunch.order',method:'update_quantity',args:[[ev.data.lineId],-1],}).then(function(){self.reload();});},_onUserChanged:function(ev){ev.stopPropagation();this.searchModel.dispatch('updateUserId',ev.data.userId);},_onUnlinkOrder:function(ev){var self=this;ev.stopPropagation();this._rpc({route:'/lunch/trash',params:{user_id:this.searchModel.get('userId'),context:this.context,},}).then(function(){self.reload();});},};return LunchControllerCommon;});;

/* /lunch/static/src/js/lunch_widget.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('lunch.LunchWidget',function(require){"use strict";var core=require('web.core');var relationalFields=require('web.relational_fields');var session=require('web.session');var Widget=require('web.Widget');var _t=core._t;var FieldMany2One=relationalFields.FieldMany2One;var LunchMany2One=FieldMany2One.extend({start:function(){this.$el.addClass('w-100');return this._super.apply(this,arguments);}});var LunchWidget=Widget.extend({template:'LunchWidget',custom_events:{field_changed:'_onFieldChanged',},events:{'click .o_add_product':'_onAddProduct','click .o_lunch_widget_order_button':'_onOrderNow','click .o_remove_product':'_onRemoveProduct','click .o_lunch_widget_unlink':'_onUnlinkOrder','click .o_lunch_open_wizard':'_onLunchOpenWizard',},init:function(parent,params){this._super.apply(this,arguments);this.is_manager=params.is_manager||false;this.userimage=params.userimage||'';this.username=params.username||'';this.lunchUserField=null;this.group_portal_id=undefined;this.locations=params.locations||[];this.userLocation=params.user_location[1]||'';this.lunchLocationField=this._createMany2One('locations','lunch.location',this.userLocation);this.wallet=params.wallet||0;this.raw_state=params.raw_state||'new';this.state=params.state||_t('To Order');this.lines=params.lines||[];this.total=params.total||0;this.alerts=params.alerts||[];this.currency=params.currency||session.get_currency(session.company_currency_id);},willStart:function(){var self=this;var superDef=this._super.apply(this,arguments);var def=this._rpc({model:'ir.model.data',method:'xmlid_to_res_id',kwargs:{xmlid:'base.group_portal'},}).then(function(id){self.group_portal_id=id;if(self.is_manager){self.lunchUserField=self._createMany2One('users','res.users',self.username,function(){return[['groups_id','not in',[self.group_portal_id]]];});}});return Promise.all([superDef,def]);},renderElement:function(){this._super.apply(this,arguments);if(this.lunchUserField){this.lunchUserField.appendTo(this.$('.o_lunch_user_field'));}else{this.$('.o_lunch_user_field').text(this.username);}
this.lunchLocationField.appendTo(this.$('.o_lunch_location_field'));},_createMany2One:function(name,model,value,domain,context){var fields={};fields[name]={type:'many2one',relation:model,string:name};var data={};data[name]={data:{display_name:value}};var record={id:name,res_id:1,model:'dummy',fields:fields,fieldsInfo:{default:fields,},data:data,getDomain:domain||function(){return[];},getContext:context||function(){return{};},};var options={mode:'edit',noOpen:true,attrs:{can_create:false,can_write:false,}};return new LunchMany2One(this,name,record,options);},_onAddProduct:function(ev){ev.preventDefault();ev.stopPropagation();this.trigger_up('add_product',{lineId:$(ev.currentTarget).data('id')});},_onOrderNow:function(ev){ev.preventDefault();ev.stopPropagation();this.trigger_up('order_now',{});},_onLunchOpenWizard:function(ev){ev.preventDefault();ev.stopPropagation();var target=$(ev.currentTarget);this.trigger_up('open_wizard',{productId:target.data('product-id'),lineId:target.data('id')});},_onFieldChanged:function(ev){ev.stopPropagation();if(ev.data.dataPointID==='users'){this.trigger_up('change_user',{userId:ev.data.changes.users.id});}else if(ev.data.dataPointID==='locations'){this.trigger_up('change_location',{locationId:ev.data.changes.locations.id});}},_onRemoveProduct:function(ev){ev.preventDefault();ev.stopPropagation();this.trigger_up('remove_product',{lineId:$(ev.currentTarget).data('id')});},_onUnlinkOrder:function(ev){ev.preventDefault();ev.stopPropagation();this.trigger_up('unlink_order',{});},});return LunchWidget;});;

/* /lunch/static/src/js/lunch_mobile.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('lunch.LunchMobile',function(require){"use strict";var config=require('web.config');var LunchWidget=require('lunch.LunchWidget');var LunchKanbanController=require('lunch.LunchKanbanController');var LunchListController=require('lunch.LunchListController');if(!config.device.isMobile){return;}
LunchWidget.include({template:"LunchWidgetMobile",init:function(parent,params){this._super.apply(this,arguments);this.keepOpen=params.keepOpen||undefined;},});var mobileFunctions={init:function(){this._super.apply(this,arguments);this.openWidget=false;},_renderLunchWidget:function(){this.widgetData.keepOpen=this.openWidget;this.openWidget=false;return this._super.apply(this,arguments);},_onAddProduct:function(){this.openWidget=true;this._super.apply(this,arguments);},_onRemoveProduct:function(){this.openWidget=true;this._super.apply(this,arguments);},};LunchKanbanController.include(mobileFunctions);LunchListController.include(mobileFunctions);});;

/* /lunch/static/src/js/lunch_payment_dialog.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('lunch.LunchPaymentDialog',function(require){"use strict";var Dialog=require('web.Dialog');var LunchPaymentDialog=Dialog.extend({template:'lunch.LunchPaymentDialog',init:function(parent,options){this._super.apply(this,arguments);options=options||{};this.message=options.message||'';},});return LunchPaymentDialog;});;

/* /lunch/static/src/js/lunch_kanban_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('lunch.LunchKanbanView',function(require){"use strict";var LunchKanbanController=require('lunch.LunchKanbanController');var LunchKanbanRenderer=require('lunch.LunchKanbanRenderer');var core=require('web.core');var KanbanView=require('web.KanbanView');var view_registry=require('web.view_registry');var _lt=core._lt;var LunchKanbanView=KanbanView.extend({config:_.extend({},KanbanView.prototype.config,{Controller:LunchKanbanController,Renderer:LunchKanbanRenderer,}),display_name:_lt('Lunch Kanban'),_createSearchModel(params,extraExtensions={}){Object.assign(extraExtensions,{Lunch:{}});return this._super(params,extraExtensions);},});view_registry.add('lunch_kanban',LunchKanbanView);return LunchKanbanView;});;

/* /lunch/static/src/js/lunch_kanban_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('lunch.LunchKanbanController',function(require){"use strict";var KanbanController=require('web.KanbanController');var LunchControllerCommon=require('lunch.LunchControllerCommon');var LunchKanbanController=KanbanController.extend(LunchControllerCommon,{custom_events:_.extend({},KanbanController.prototype.custom_events,LunchControllerCommon.custom_events),});return LunchKanbanController;});;

/* /lunch/static/src/js/lunch_kanban_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('lunch.LunchKanbanRenderer',function(require){"use strict";var LunchKanbanRecord=require('lunch.LunchKanbanRecord');var KanbanRenderer=require('web.KanbanRenderer');var LunchKanbanRenderer=KanbanRenderer.extend({config:_.extend({},KanbanRenderer.prototype.config,{KanbanRecord:LunchKanbanRecord,}),start:function(){this.$el.addClass('o_lunch_view o_lunch_kanban_view position-relative align-content-start flex-grow-1 flex-shrink-1');return this._super.apply(this,arguments);},});return LunchKanbanRenderer;});;

/* /lunch/static/src/js/lunch_kanban_record.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('lunch.LunchKanbanRecord',function(require){"use strict";var KanbanRecord=require('web.KanbanRecord');var LunchKanbanRecord=KanbanRecord.extend({events:_.extend({},KanbanRecord.prototype.events,{'click':'_onSelectRecord',}),_onSelectRecord:function(ev){ev.preventDefault();if(!$(ev.target).hasClass('oe_kanban_action')){this.trigger_up('open_wizard',{productId:this.recordData.product_id?this.recordData.product_id.res_id:this.recordData.id});}},});return LunchKanbanRecord;});;

/* /lunch/static/src/js/lunch_model_extension.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("lunch/static/src/js/lunch_model_extension.js",function(require){"use strict";const ActionModel=require("web/static/src/js/views/action_model.js");class LunchModelExtension extends ActionModel.Extension{get(property){switch(property){case"domain":return this.getDomain();case"userId":return this.state.userId;}}
async load(){await this._updateLocationId();}
prepareState(){Object.assign(this.state,{locationId:null,userId:null,});}
getDomain(){if(this.state.locationId){return[["is_available_at","in",[this.state.locationId]]];}
return null;}
setLocationId(locationId){this.state.locationId=locationId;this.env.services.rpc({route:"/lunch/user_location_set",params:{context:this.env.session.user_context,location_id:this.state.locationId,user_id:this.state.userId,},});}
updateUserId(userId){this.state.userId=userId;this.shouldLoad=true;}
async _updateLocationId(){this.state.locationId=await this.env.services.rpc({route:"/lunch/user_location_get",params:{context:this.env.session.user_context,user_id:this.state.userId,},});}}
ActionModel.registry.add("Lunch",LunchModelExtension,20);return LunchModelExtension;});;

/* /lunch/static/src/js/lunch_list_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('lunch.LunchListView',function(require){"use strict";var LunchListController=require('lunch.LunchListController');var LunchListRenderer=require('lunch.LunchListRenderer');var core=require('web.core');var ListView=require('web.ListView');var view_registry=require('web.view_registry');var _lt=core._lt;var LunchListView=ListView.extend({config:_.extend({},ListView.prototype.config,{Controller:LunchListController,Renderer:LunchListRenderer,}),display_name:_lt('Lunch List'),_createSearchModel(params,extraExtensions={}){Object.assign(extraExtensions,{Lunch:{}});return this._super(params,extraExtensions);},});view_registry.add('lunch_list',LunchListView);return LunchListView;});;

/* /lunch/static/src/js/lunch_list_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('lunch.LunchListController',function(require){"use strict";var ListController=require('web.ListController');var LunchControllerCommon=require('lunch.LunchControllerCommon');var LunchListController=ListController.extend(LunchControllerCommon,{custom_events:_.extend({},ListController.prototype.custom_events,LunchControllerCommon.custom_events),});return LunchListController;});;

/* /lunch/static/src/js/lunch_list_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('lunch.LunchListRenderer',function(require){"use strict";var ListRenderer=require('web.ListRenderer');var LunchListRenderer=ListRenderer.extend({events:_.extend({},ListRenderer.prototype.events,{'click .o_data_row':'_onClickListRow',}),start:function(){this.$el.addClass('o_lunch_view o_lunch_list_view');return this._super.apply(this,arguments);},_renderRow:function(record){var tr=this._super.apply(this,arguments);tr.attr('data-product-id',record.data.id);return tr;},_onClickListRow:function(ev){ev.preventDefault();var productId=ev.currentTarget.dataset&&ev.currentTarget.dataset.productId?parseInt(ev.currentTarget.dataset.productId):null;if(productId){this.trigger_up('open_wizard',{productId:productId});}},});return LunchListRenderer;});;

/* /mail_bot/static/src/bugfix/bugfix.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail_bot/static/src/bugfix/bugfix.js',function(require){'use strict';});;

/* /mail_bot/static/src/models/messaging_initializer/messaging_initializer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail_bot/static/src/models/messaging_initializer/messaging_initializer.js',function(require){'use strict';const{registerInstancePatchModel}=require('mail/static/src/model/model_core.js');registerInstancePatchModel('mail.messaging_initializer','mail_bot/static/src/models/messaging_initializer/messaging_initializer.js',{async _initializeOdooBot(){const data=await this.async(()=>this.env.services.rpc({model:'mail.channel',method:'init_odoobot',}));if(!data){return;}
this.env.session.odoobot_initialized=true;},async start(){await this.async(()=>this._super());if('odoobot_initialized'in this.env.session&&!this.env.session.odoobot_initialized){this._initializeOdooBot();}},});});;

/* /mail_enterprise/static/src/js/attachment_viewer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail_enterprise.AttachmentViewer',function(require){"use strict";var core=require('web.core');var Widget=require('web.Widget');var QWeb=core.qweb;var AttachmentViewer=Widget.extend({className:'o_attachment_preview_container',events:{'click .arrow.o_move_next':'_onClickNext','click .arrow.o_move_previous':'_onClickPrevious',},init:function(parent,attachments){this._super.apply(this,arguments);this.attachments=attachments;this._setActive();},start:function(){this._renderAttachment();return this._super.apply(this,arguments);},updateContents:function(attachments,order){this.attachments=attachments;this._setActive();this._renderAttachment();},_renderAttachment:function(){this.$el.empty();this.$el.append(QWeb.render('mail_enterprise.AttachmentPreview',{widget:this}));},_setActive:function(){this.activeAttachment=_.find(this.attachments,function(attachment){return attachment.is_main;});if(!this.activeAttachment&&this.attachments.length){this.activeAttachment=this.attachments[0];this._rpc({model:'ir.attachment',method:'register_as_main_attachment',args:[[this.activeAttachment.id],this.activeAttachment.is_main===false],});}},_switch_main_attachment:function(index){var self=this;this.activeAttachment=this.attachments[index];this._rpc({model:'ir.attachment',method:'register_as_main_attachment',args:[[this.activeAttachment['id']]],}).then(function(){self._renderAttachment();});},_onClickNext:function(ev){ev.preventDefault();var index=_.findIndex(this.attachments,this.activeAttachment);index=index===this.attachments.length-1?0:index+1;this._switch_main_attachment(index);},_onClickPrevious:function(ev){ev.preventDefault();var index=_.findIndex(this.attachments,this.activeAttachment);index=index===0?this.attachments.length-1:index-1;this._switch_main_attachment(index);},});return AttachmentViewer;});;

/* /mail_enterprise/static/src/bugfix/bugfix.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail_enterprise/static/src/bugfix/bugfix.js',function(require){'use strict';const ChatterContainer=require('mail/static/src/components/chatter_container/chatter_container.js');const{attr}=require('mail/static/src/model/model_field.js');const{registerFieldPatchModel}=require('mail/static/src/model/model_core.js');registerFieldPatchModel('mail.chatter','mail/static/src/models/chatter/chatter.js',{isInFormSheetBg:attr({default:false,}),});Object.assign(ChatterContainer,{defaultProps:Object.assign(ChatterContainer.defaultProps||{},{isInFormSheetBg:false,}),props:Object.assign(ChatterContainer.props,{isInFormSheetBg:{type:Boolean,},})});});;

/* /mail_enterprise/static/src/widgets/form_renderer/form_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail_enterprise/static/src/widgets/form_renderer/form_renderer.js',function(require){"use strict";var config=require('web.config');var dom=require('web.dom');var pyUtils=require('web.py_utils');var FormRenderer=require('web.FormRenderer');var AttachmentViewer=require('mail_enterprise.AttachmentViewer');require('mail/static/src/widgets/form_renderer/form_renderer.js');FormRenderer.include({init:function(){this._super.apply(this,arguments);this.$attachmentPreview=undefined;this.attachmentPreviewResID=undefined;this.attachmentViewer=undefined;this._attachmentViewerThread=undefined;this._isChatterInFormSheetBg=false;this._onResizeWindow=_.debounce(this._onResizeWindow.bind(this),200);},destroy(){window.removeEventListener('resize',this._onResizeWindow);this._super();},start(){window.addEventListener('resize',this._onResizeWindow);return this._super(...arguments);},_isChatterAside(){const parent=this._chatterContainerTarget&&this._chatterContainerTarget.parentNode;return(config.device.size_class>=config.device.SIZES.XXL&&!this.attachmentViewer&&!(parent&&parent.classList&&parent.classList.contains('o_form_sheet')));},_interchangeChatter(enablePreview){if(config.device.size_class<config.device.SIZES.XXL){return;}
if(!this.$attachmentPreview){return;}
const $sheet=this.$('.o_form_sheet_bg');this._updateChatterContainerTarget();if(enablePreview){this.$attachmentPreview.insertAfter($sheet);dom.append($sheet,$(this._chatterContainerTarget),{callbacks:[{widget:this.chatter}],in_DOM:this._isInDom,});this._chatterContainerTarget.classList.add('o-isInFormSheetBg');this._isChatterInFormSheetBg=true;}else{$(this._chatterContainerTarget).insertAfter($sheet);dom.append($sheet,this.$attachmentPreview,{callbacks:[],in_DOM:this._isInDom,});this._chatterContainerTarget.classList.remove('o-isInFormSheetBg');this._isChatterInFormSheetBg=false;}
this._updateChatterContainerComponent();},_makeChatterContainerProps(){const props=this._super(...arguments);const isChatterAside=this._isChatterAside();return Object.assign(props,{hasExternalBorder:!isChatterAside,hasMessageListScrollAdjust:isChatterAside,isInFormSheetBg:this._isChatterInFormSheetBg,});},_makeChatterContainerTarget(){const $el=this._super(...arguments);this._updateChatterContainerTarget();return $el;},_renderNode:function(node){if(node.tag==='div'&&node.attrs.class==='o_attachment_preview'){if(this.attachmentViewer){if(this.attachmentPreviewResID!==this.state.res_id){this.attachmentViewer.destroy();this.attachmentViewer=undefined;}}else{this.$attachmentPreview=$('<div>',{class:'o_attachment_preview'});}
this._handleAttributes(this.$attachmentPreview,node);this._registerModifiers(node,this.state,this.$attachmentPreview);if(node.attrs.options){this.$attachmentPreview.data(pyUtils.py_eval(node.attrs.options));}
if(this.attachmentPreviewWidth){this.$attachmentPreview.css('width',this.attachmentPreviewWidth);}
return this.$attachmentPreview;}else{return this._super.apply(this,arguments);}},async _renderView(){await this._super(...arguments);if(!this._hasChatter()){return;}
this._updateChatterContainerTarget();const enablePreview=this.attachmentPreviewResID&&this.attachmentPreviewResID===this.state.res_id&&this.$attachmentPreview&&!this.$attachmentPreview.hasClass('o_invisible_modifier');this._interchangeChatter(enablePreview);},_updateChatterContainerTarget(){if(this._isChatterAside()){$(this._chatterContainerTarget).addClass('o-aside');}else{$(this._chatterContainerTarget).removeClass('o-aside');}},_onChatterRendered(ev){if(config.device.size_class<config.device.SIZES.XXL){return;}
if(!this.$attachmentPreview){return;}
var self=this;var options=_.defaults(this.$attachmentPreview.data(),{types:['pdf','image'],order:'asc'});var attachments=$.extend(true,{},ev.data.attachments);attachments=_.filter(attachments,function(attachment){var match=attachment.mimetype.match(options.types.join('|'));attachment.update({type:match?match[0]:false});return match;});const thread=ev.data.thread;if(options.order==='asc'){attachments.reverse();}
if(attachments.length||this.attachmentViewer){if(this.attachmentViewer){if(this._attachmentViewerThread!==thread||this.attachmentViewer.attachments.length!==attachments.length){if(!attachments.length){this.attachmentViewer.destroy();this.attachmentViewer=undefined;this.attachmentPreviewResID=undefined;this._interchangeChatter(false);}
else{this.attachmentViewer.updateContents(attachments,options.order);}}
this.trigger_up('preview_attachment_validation');this._updateChatterContainerTarget();}else{this.attachmentPreviewResID=this.state.res_id;this.attachmentViewer=new AttachmentViewer(this,attachments);this.attachmentViewer.appendTo(this.$attachmentPreview).then(function(){self.trigger_up('preview_attachment_validation');self.$attachmentPreview.resizable({handles:'w',minWidth:400,maxWidth:900,resize:function(event,ui){self.attachmentPreviewWidth=ui.size.width;},});self._interchangeChatter(!self.$attachmentPreview.hasClass('o_invisible_modifier'));});}}
this._attachmentViewerThread=thread;},_onResizeWindow(ev){if(this._chatterContainerComponent){this._updateChatterContainerComponent();this._updateChatterContainerTarget();}
this._applyFormSizeClass();}});});;

/* /note/static/src/js/systray_activity_menu.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('note.systray.ActivityMenu',function(require){"use strict";var ActivityMenu=require('mail.systray.ActivityMenu');var core=require('web.core');var datepicker=require('web.datepicker');var _t=core._t;ActivityMenu.include({events:_.extend({},ActivityMenu.prototype.events,{'click .o_note_show':'_onAddNoteClick','click .o_note_save':'_onNoteSaveClick','click .o_note_set_datetime':'_onNoteDateTimeSetClick','keydown input.o_note_input':'_onNoteInputKeyDown','click .o_note':'_onNewNoteClick',}),_getActivityData:function(){var self=this;return this._super.apply(this,arguments).then(function(){var reminderIndex=_.findIndex(self.activities,function(val){return val.model==='note.note';});if(reminderIndex>0){self.activities.splice(0,0,self.activities.splice(reminderIndex,1)[0]);}});},_saveNote:function(){var note=this.$('.o_note_input').val().trim();if(!note){return;}
var params={'note':note};var noteDateTime=this.noteDateTimeWidget.getValue();if(noteDateTime){params=_.extend(params,{'date_deadline':noteDateTime});}else{params=_.extend(params,{'date_deadline':moment()});}
this.$('.o_note_show').removeClass('d-none');this.$('.o_note').addClass('d-none');this._rpc({route:'/note/new',params:params,}).then(this._updateActivityPreview.bind(this));},_onActivityFilterClick:function(ev){var $el=$(ev.currentTarget);if(!$el.hasClass("o_note")){var data=_.extend({},$el.data(),$(ev.target).data());if(data.res_model==="note.note"&&data.filter==="my"){this.do_action({type:'ir.actions.act_window',name:data.model_name,res_model:data.res_model,views:[[false,'kanban'],[false,'form'],[false,'list']]},{clear_breadcrumbs:true,});}else{this._super.apply(this,arguments);}}},_onAddNoteClick:function(ev){var self=this;ev.stopPropagation();if(!this.noteDateTimeWidget){this.noteDateTimeWidget=new datepicker.DateWidget(this,{useCurrent:true});}
this.noteDateTimeWidget.appendTo(this.$('.o_note_datetime')).then(function(){self.noteDateTimeWidget.$input.attr('placeholder',_t("Today"));self.noteDateTimeWidget.setValue(false);self.$('.o_note_show, .o_note').toggleClass('d-none');self.$('.o_note_input').val('').focus();});},_onNewNoteClick:function(ev){ev.stopPropagation();},_onNoteDateTimeSetClick:function(ev){ev.preventDefault();ev.stopPropagation();this.noteDateTimeWidget.$input.click();},_onNoteSaveClick:function(ev){this._saveNote();},_onNoteInputKeyDown:function(ev){if(ev.which===$.ui.keyCode.ENTER){this._saveNote();}},});});;

/* /product/static/src/js/product_pricelist_report.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('product.generate_pricelist',function(require){'use strict';var AbstractAction=require('web.AbstractAction');var core=require('web.core');var FieldMany2One=require('web.relational_fields').FieldMany2One;var StandaloneFieldManagerMixin=require('web.StandaloneFieldManagerMixin');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var QtyTagWidget=Widget.extend({template:'product.report_pricelist_qty',events:{'click .o_remove_qty':'_onClickRemoveQty',},init:function(parent,defaulQuantities){this._super.apply(this,arguments);this.quantities=defaulQuantities;this.MAX_QTY=5;},_onClickAddQty:function(){if(this.quantities.length>=this.MAX_QTY){this.do_notify(false,_.str.sprintf(_t("At most %d quantities can be displayed simultaneously. Remove a selected quantity to add others."),this.MAX_QTY));return;}
const qty=parseInt(this.$('.o_product_qty').val());if(qty&&qty>0){if(this.quantities.indexOf(qty)===-1){this.quantities.push(qty);this.quantities=this.quantities.sort((a,b)=>a-b);this.trigger_up('qty_changed',{quantities:this.quantities});this.renderElement();}else{this.displayNotification({message:_.str.sprintf(_t("Quantity already present (%d)."),qty),type:'info'});}}else{this.do_notify(false,_t("Please enter a positive whole number"));}},_onClickRemoveQty:function(ev){const qty=parseInt($(ev.currentTarget).closest('.badge').data('qty'));this.quantities=this.quantities.filter(q=>q!==qty);this.trigger_up('qty_changed',{quantities:this.quantities});this.renderElement();},});var GeneratePriceList=AbstractAction.extend(StandaloneFieldManagerMixin,{hasControlPanel:true,events:{'click .o_action':'_onClickAction','submit form':'_onSubmitForm',},custom_events:Object.assign({},StandaloneFieldManagerMixin.custom_events,{field_changed:'_onFieldChanged',qty_changed:'_onQtyChanged',}),init:function(parent,params){this._super.apply(this,arguments);StandaloneFieldManagerMixin.init.call(this);this.context=params.context;if(params.params&&params.params.active_ids&&typeof(params.params.active_ids==='string')){try{this.context.active_ids=params.params.active_ids.split(',').map(id=>parseInt(id));this.context.active_model=params.params.active_model;}catch(e){console.log('unable to load ids from the url fragment ');}}
if(!this.context.active_model){this.context.active_model='product.template';}
this.context.quantities=[1,5,10];},willStart:function(){let getPricelit;if(this.context.default_pricelist){getPricelit=Promise.resolve([this.context.default_pricelist]);}else{getPricelit=this._rpc({model:'product.pricelist',method:'search',args:[[]],kwargs:{limit:1}})}
const fieldSetup=getPricelit.then(pricelistIds=>{return this.model.makeRecord('report.product.report_pricelist',[{name:'pricelist_id',type:'many2one',relation:'product.pricelist',value:pricelistIds[0],}]);}).then(recordID=>{const record=this.model.get(recordID);this.many2one=new FieldMany2One(this,'pricelist_id',record,{mode:'edit',attrs:{can_create:false,can_write:false,options:{no_open:true},},});this._registerWidget(recordID,'pricelist_id',this.many2one);});return Promise.all([fieldSetup,this._getHtml(),this._super()]);},start:function(){this.controlPanelProps.cp_content=this._renderComponent();return this._super.apply(this,arguments).then(()=>{this.$('.o_content').html(this.reportHtml);});},getState:function(){return{active_model:this.context.active_model,};},getTitle:function(){return _t('Pricelist Report');},_getHtml:function(){return this._rpc({model:'report.product.report_pricelist',method:'get_html',kwargs:{context:this.context},}).then(result=>{this.reportHtml=result;});},_reload:function(){return this._getHtml().then(()=>{this.$('.o_content').html(this.reportHtml);});},_renderComponent:function(){const $buttons=$('<button>',{class:'btn btn-primary',text:_t("Print"),}).on('click',this._onClickPrint.bind(this));const $searchview=$(QWeb.render('product.report_pricelist_search'));this.many2one.appendTo($searchview.find('.o_pricelist'));this.qtyTagWidget=new QtyTagWidget(this,this.context.quantities);this.qtyTagWidget.replace($searchview.find('.o_product_qty'));return{$buttons,$searchview};},_onClickAction:function(ev){ev.preventDefault();this.do_action({type:'ir.actions.act_window',res_model:$(ev.currentTarget).data('model'),res_id:$(ev.currentTarget).data('res-id'),views:[[false,'form']],target:'self',});},_onClickPrint:function(){const reportName=_.str.sprintf('product.report_pricelist?active_model=%s&active_ids=%s&pricelist_id=%s&quantities=%s',this.context.active_model,this.context.active_ids,this.context.pricelist_id||'',this.context.quantities.toString()||'1',);return this.do_action({type:'ir.actions.report',report_type:'qweb-pdf',report_name:reportName,report_file:'product.report_pricelist',});},_onFieldChanged:function(event){this.context.pricelist_id=event.data.changes.pricelist_id.id;StandaloneFieldManagerMixin._onFieldChanged.apply(this,arguments);this._reload();},_onQtyChanged:function(ev){this.context.quantities=ev.data.quantities;this._reload();},_onSubmitForm:function(ev){ev.preventDefault();ev.stopPropagation();this.qtyTagWidget._onClickAddQty();},});core.action_registry.add('generate_pricelist',GeneratePriceList);return{GeneratePriceList,QtyTagWidget};});;

/* /timer/static/src/js/timer_mixin.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('timer.Timer',function(require){"use strict";class Timer{constructor(hours,minutes,seconds){this.hours=hours;this.minutes=minutes;this.seconds=seconds;}
addHours(hours){this.hours+=hours;}
addMinutes(minutes){minutes+=this.minutes;this.minutes=minutes%60;this.addHours(Math.floor(minutes/60));}
addSeconds(seconds){seconds+=this.seconds;this.seconds=seconds%60;this.addMinutes(Math.floor(seconds/60));}
display2digits(number){return number>9?""+number:"0"+number;}
addSecond(){this.seconds+=1;if(this.seconds===60){this.minutes+=1;this.seconds=0;if(this.minutes===60){this.hours+=1;this.minutes=0;}}}
addTime(time){if(typeof time=='string'&&time.indexOf(':')!==-1){let[hour,minute,second]=time.split(':');hour=parseInt(hour);minute=parseInt(minute);second=(second===undefined)?0:parseInt(second);this.addSeconds(second);this.addMinutes(minute);this.addHours(hour);}}
convertToFloat(){return(this.hours*60+this.minutes)*60/3600;}
convertToSeconds(){return(this.hours*60+this.minutes)*60+this.seconds;}
toString(){const time={hours:this.display2digits(this.hours),minutes:this.display2digits(this.minutes),seconds:this.display2digits(this.seconds)};return`${time.hours}:${time.minutes}:${time.seconds}`;}}
Timer.convertFloatToTime=function(float){if(float===0){return new Timer(0,0,0);}
let minutes=float%1;const hours=float-minutes;minutes*=60;return new Timer(hours,Math.round(minutes),0);};Timer.createTimer=function(unit_amount,timer_start,serverTime){const timer=this.convertFloatToTime(unit_amount);timer.addTime(moment.utc(Math.abs(moment.utc(serverTime).diff(moment.utc(timer_start)))).format("HH:mm:ss"));return timer;};return Timer;});;

/* /timer/static/src/js/timer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('timer.timer',function(require){"use strict";var fieldRegistry=require('web.field_registry');var AbstractField=require('web.AbstractField');var Timer=require('timer.Timer');var TimerFieldWidget=AbstractField.extend({isSet:function(){return true;},_render:function(){this._super.apply(this,arguments);this._startTimeCounter();},destroy:function(){this._super.apply(this,arguments);clearInterval(this.timer);},_startTimeCounter:async function(){if(this.record.data.timer_start){const serverTime=this.record.data.timer_pause||await this._getServerTime();this.time=Timer.createTimer(0,this.record.data.timer_start,serverTime);this.$el.text(this.time.toString());this.timer=setInterval(()=>{if(this.record.data.timer_pause){clearInterval(this.timer);}else{this.time.addSecond();this.$el.text(this.time.toString());}},1000);}else if(!this.record.data.timer_pause){clearInterval(this.timer);}},_getServerTime:function(){return this._rpc({model:'timer.timer',method:'get_server_time',args:[]});}});fieldRegistry.add('timer_timer',TimerFieldWidget);});;

/* /timer/static/src/js/timer_toggle_button.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('timer.timer_toggle_button',function(require){"use strict";const fieldRegistry=require('web.field_registry');const{FieldToggleBoolean}=require("web.basic_fields");const{_lt}=require('web.core');const TimerToggleButton=FieldToggleBoolean.extend({_render:function(){const title=this.value?_lt('Stop'):_lt('Play');const name=this.value?'action_timer_stop':'action_timer_start';const label=this.value?_lt('Stop'):_lt('Start');this.$('i').addClass('fa').toggleClass('fa-stop-circle o-timer-stop-button',this.value).toggleClass('fa-play-circle o-timer-play-button',!this.value).attr('title',title);this.$el.addClass('o-timer-button');this.$el.attr('title',title);this.$el.attr('name',name);this.$el.attr('aria-label',label);this.$el.attr('aria-pressed',this.value);this.$el.attr('type','button');this.$el.attr('role','button');},_onToggleButton:async function(event){const context=this.record.getContext();event.stopPropagation();const result=await this._rpc({model:this.model,method:this._getActionButton(),context:context,args:[this.res_id]});this.trigger_up('timer_changed',{id:this.res_id,is_timer_running:!this.value});this._setValue(!this.value);},_getActionButton:function(){return this.value?'action_timer_stop':'action_timer_start';}});fieldRegistry.add('timer_toggle_button',TimerToggleButton);return TimerToggleButton;});;

/* /approvals/static/src/js/activity.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('approvals.Activity',function(require){"use strict";const field_registry=require('web.field_registry');require('mail.Activity');const KanbanActivity=field_registry.get('kanban_activity');KanbanActivity.include({events:Object.assign({},KanbanActivity.prototype.events,{'click .o_activity_action_approve':'_onValidateApproval','click .o_activity_action_refuse':'_onRefuseApproval',}),_onValidateApproval(event){const approverID=$(event.currentTarget).data('approver-id');this._rpc({model:'approval.approver',method:'action_approve',args:[[approverID]],}).then(result=>{this.trigger_up('reload')});},_onRefuseApproval(event){const approverID=$(event.currentTarget).data('approver-id');this._rpc({model:'approval.approver',method:'action_refuse',args:[[approverID]],}).then(result=>{this.trigger_up('reload');});},});});;

/* /approvals/static/src/bugfix/bugfix.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('approvals/static/src/bugfix/bugfix.js',function(require){'use strict';});;

/* /approvals/static/src/components/activity/activity.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('approvals/static/src/components/activity/activity.js',function(require){'use strict';const components={Activity:require('mail/static/src/components/activity/activity.js'),Approval:require('approvals/static/src/components/approval/approval.js'),};Object.assign(components.Activity.components,{Approval:components.Approval,});});;

/* /approvals/static/src/components/approval/approval.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('approvals/static/src/components/approval/approval.js',function(require){'use strict';const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component}=owl;class Approval extends Component{constructor(...args){super(...args);useStore(props=>{const approval=this.env.models['approvals.approval'].get(props.approvalLocalId);return{approval:approval?approval.__state:undefined,};});}
get approval(){return this.env.models['approvals.approval'].get(this.props.approvalLocalId);}
async _onClickApprove(){await this.approval.approve();this.trigger('o-approval-approved');}
async _onClickRefuse(){await this.approval.refuse();this.trigger('o-approval-refused');}}
Object.assign(Approval,{props:{approvalLocalId:String,},template:'approvals.Approval',});return Approval;});;

/* /approvals/static/src/models/activity/activity.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('approvals/static/src/models/activity/activity.js',function(require){'use strict';const{registerClassPatchModel,registerFieldPatchModel,}=require('mail/static/src/model/model_core.js');const{one2one}=require('mail/static/src/model/model_field.js');registerClassPatchModel('mail.activity','approvals/static/src/models/activity/activity.js',{convertData(data){const data2=this._super(data);if('approver_id'in data&&'approver_status'in data){if(!data.approver_id){data2.approval=[['unlink-all']];}else{data2.approval=[['insert',{id:data.approver_id,status:data.approver_status}],];}}
return data2;},});registerFieldPatchModel('mail.activity','approvals/static/src/models/activity/activity.js',{approval:one2one('approvals.approval',{inverse:'activity',}),});});;

/* /approvals/static/src/models/approval/approval.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('approvals/static/src/models/approval/approval.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{attr,one2one}=require('mail/static/src/model/model_field.js');function factory(dependencies){class Approval extends dependencies['mail.model']{async approve(){await this.async(()=>this.env.services.rpc({model:'approval.approver',method:'action_approve',args:[[this.id]],}));if(this.activity){this.activity.delete();}
this.delete();}
async refuse(){await this.async(()=>this.env.services.rpc({model:'approval.approver',method:'action_refuse',args:[[this.id]],}));if(this.activity){this.activity.delete();}
this.delete();}
static _createRecordLocalId(data){return`${this.modelName}_${data.id}`;}}
Approval.fields={activity:one2one('mail.activity',{inverse:'approval',}),id:attr(),isCurrentPartnerApprover:attr({default:false,related:'activity.isCurrentPartnerAssignee',}),status:attr(),};Approval.modelName='approvals.approval';return Approval;}
registerNewModel('approvals.approval',factory);});;

/* /approvals/static/src/widgets/form_renderer/form_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('approvals/static/src/widgets/form_renderer/form_renderer.js',function(require){"use strict";require('mail/static/src/widgets/form_renderer/form_renderer.js');const FormRenderer=require('web.FormRenderer');FormRenderer.include({_destroyChatterContainer(){this.off('o_approval_approved',this);this.off('o_approval_refused',this);this._super(...arguments);},_makeChatterContainerComponent(){this._super(...arguments);this.on('o_approval_approved',this,ev=>this.trigger_up('reload'));this.on('o_approval_refused',this,ev=>this.trigger_up('reload'));},});});;

/* /hr_gamification/static/src/js/gamification.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('hr_gamification.hr_gamification',function(require){"use strict";var KanbanRecord=require('web.KanbanRecord');KanbanRecord.include({_openRecord:function(){if(this.modelName==='gamification.badge.user'){var action={type:'ir.actions.act_window',res_model:'gamification.badge',view_mode:'form',views:[[false,'form']],res_id:this.record.badge_id.raw_value};this.do_action(action);}else{this._super.apply(this,arguments);}}});});;

/* /hr_gantt/static/src/js/hr_gantt_row.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('hr_gantt.GanttRow',function(require){'use strict';const GanttRow=require('web_gantt.GanttRow');const StandaloneM2OAvatarEmployee=require('hr.StandaloneM2OAvatarEmployee');const HrGanttRow=GanttRow.extend({template:'HrGanttView.Row',init(parent,pillsInfo,viewInfo,options){this._super(...arguments);const isGroupedByEmployee=pillsInfo.groupedByField==='employee_id';const isEmptyGroup=pillsInfo.groupId==='empty';this.showEmployeeAvatar=(isGroupedByEmployee&&!isEmptyGroup&&!!pillsInfo.resId);},willStart(){const defs=[this._super(...arguments)];if(this.showEmployeeAvatar){defs.push(this._preloadAvatarWidget());}
return Promise.all(defs);},start(){if(this.showEmployeeAvatar){this.avatarWidget.$el.appendTo(this.$('.o_gantt_row_employee_avatar'));}
return this._super(...arguments);},async _preloadAvatarWidget(){const employee=[this.resId,this.name];this.avatarWidget=new StandaloneM2OAvatarEmployee(this,employee);return this.avatarWidget.appendTo(document.createDocumentFragment());},});return HrGanttRow;});;

/* /hr_gantt/static/src/js/hr_gantt_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('hr_gantt.GanttRenderer',function(require){'use strict';const GanttRenderer=require('web_gantt.GanttRenderer');const HrGanttRow=require('hr_gantt.GanttRow');const HrGanttRenderer=GanttRenderer.extend({config:Object.assign({},GanttRenderer.prototype.config,{GanttRow:HrGanttRow}),});return HrGanttRenderer;});;

/* /hr_gantt/static/src/js/hr_gantt_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('hr_gantt.GanttView',function(require){'use strict';const viewRegistry=require('web.view_registry');const GanttView=require('web_gantt.GanttView');const HrGanttRenderer=require('hr_gantt.GanttRenderer');const HrGanttView=GanttView.extend({config:Object.assign({},GanttView.prototype.config,{Renderer:HrGanttRenderer,}),});viewRegistry.add('hr_gantt',HrGanttView);return HrGanttView;});;

/* /hr_holidays/static/src/js/time_off_calendar.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('hr_holidays.dashboard.view_custo',function(require){'use strict';var core=require('web.core');var CalendarPopover=require('web.CalendarPopover');var CalendarController=require("web.CalendarController");var CalendarRenderer=require("web.CalendarRenderer");var CalendarView=require("web.CalendarView");var viewRegistry=require('web.view_registry');var _t=core._t;var QWeb=core.qweb;var TimeOffCalendarPopover=CalendarPopover.extend({template:'hr_holidays.calendar.popover',init:function(parent,eventInfo){this._super.apply(this,arguments);const state=this.event.extendedProps.record.state;this.canDelete=state&&['validate','refuse'].indexOf(state)===-1;this.canEdit=state!==undefined;this.displayFields=[];if(this.modelName==="hr.leave.report.calendar"){const duration=this.event.extendedProps.record.display_name.split(':').slice(-1);this.display_name=_.str.sprintf(_t("Time Off : %s"),duration);}else{this.display_name=this.event.extendedProps.record.display_name;}},});var TimeOffCalendarController=CalendarController.extend({events:_.extend({},CalendarController.prototype.events,{'click .btn-time-off':'_onNewTimeOff','click .btn-allocation':'_onNewAllocation',}),start:function(){this.$el.addClass('o_timeoff_calendar');return this._super(...arguments);},renderButtons:function($node){this._super.apply(this,arguments);$(QWeb.render('hr_holidays.dashboard.calendar.button',{time_off:_t('New Time Off'),request:_t('New Allocation'),})).appendTo(this.$buttons);if($node){this.$buttons.appendTo($node);}else{this.$('.o_calendar_buttons').replaceWith(this.$buttons);}},_onNewTimeOff:function(){var self=this;this.do_action('hr_holidays.hr_leave_action_my_request',{on_close:function(){self.reload();}});},_onNewAllocation:function(){var self=this;this.do_action({type:'ir.actions.act_window',res_model:'hr.leave.allocation',name:'New Allocation Request',views:[[false,'form']],context:{'form_view_ref':'hr_holidays.hr_leave_allocation_view_form_dashboard'},target:'new',},{on_close:function(){self.reload();}});},});var TimeOffPopoverRenderer=CalendarRenderer.extend({config:_.extend({},CalendarRenderer.prototype.config,{CalendarPopover:TimeOffCalendarPopover,}),_getPopoverParams:function(eventData){let params=this._super.apply(this,arguments);let calendarIcon;let state=eventData.extendedProps.record.state;if(state==='validate'){calendarIcon='fa-calendar-check-o';}else if(state==='refuse'){calendarIcon='fa-calendar-times-o';}else if(state){calendarIcon='fa-calendar-o';}
params['title']=eventData.extendedProps.record.display_name.split(':').slice(0,-1).join(':');params['template']=QWeb.render('hr_holidays.calendar.popover.placeholder',{color:this.getColor(eventData.color_index),calendarIcon:calendarIcon});return params;},_render:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.$el.parent().find('.o_calendar_mini').hide();});},});var TimeOffCalendarRenderer=TimeOffPopoverRenderer.extend({_render:function(){var self=this;return this._super.apply(this,arguments).then(function(){return self._rpc({model:'hr.leave.type',method:'get_days_all_request',context:self.context,});}).then(function(result){self.$el.parent().find('.o_calendar_mini').hide();self.$el.parent().find('.o_timeoff_container').remove();var elem=QWeb.render('hr_holidays.dashboard_calendar_header',{timeoffs:result,});self.$el.before(elem);});},});var TimeOffCalendarView=CalendarView.extend({config:_.extend({},CalendarView.prototype.config,{Controller:TimeOffCalendarController,Renderer:TimeOffCalendarRenderer,}),});var TimeOffCalendarAllView=CalendarView.extend({config:_.extend({},CalendarView.prototype.config,{Renderer:TimeOffPopoverRenderer,}),});viewRegistry.add('time_off_calendar',TimeOffCalendarView);viewRegistry.add('time_off_calendar_all',TimeOffCalendarAllView);});;

/* /hr_holidays/static/src/js/leave_stats_widget.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('hr_holidays.LeaveStatsWidget',function(require){"use strict";var time=require('web.time');var Widget=require('web.Widget');var widget_registry=require('web.widget_registry');var LeaveStatsWidget=Widget.extend({template:'hr_holidays.leave_stats',init:function(parent,params){this._setState(params);this._super(parent);},willStart:function(){return Promise.all([this._super(),this._fetchLeaveTypesData(),this._fetchDepartmentLeaves()]);},updateState:function(state){var self=this;var to_await=[];var updatedFields=this._setState(state);if(_.intersection(updatedFields,['employee','date']).length){to_await.push(this._fetchLeaveTypesData());}
if(_.intersection(updatedFields,['department','date']).length){to_await.push(this._fetchDepartmentLeaves());}
return Promise.all(to_await).then(function(){self.renderElement();});},_setState:function(state){var updatedFields=[];if(state.data.employee_id.res_id!==(this.employee&&this.employee.res_id)){updatedFields.push('employee');this.employee=state.data.employee_id;}
if(state.data.department_id.res_id!==(this.department&&this.department.res_id)){updatedFields.push('department');this.department=state.data.department_id;}
if(state.data.date_from!==this.date){updatedFields.push('date');this.date=state.data.date_from;}
return updatedFields;},_fetchDepartmentLeaves:function(){if(!this.date||!this.department){this.departmentLeaves=null;return Promise.resolve();}
var self=this;var month_date_from=this.date.clone().startOf('month');var month_date_to=this.date.clone().endOf('month');return this._rpc({model:'hr.leave',method:'search_read',args:[[['department_id','=',this.department.res_id],['state','=','validate'],['holiday_type','=','employee'],['date_from','<=',month_date_to],['date_to','>=',month_date_from]],['employee_id','date_from','date_to','number_of_days'],],}).then(function(data){var dateFormat=time.getLangDateFormat();self.departmentLeaves=data.map(function(leave){return _.extend(leave,{date_from:moment(leave.date_from).format(dateFormat),date_to:moment(leave.date_to).format(dateFormat),number_of_days:leave.number_of_days,});});});},_fetchLeaveTypesData:function(){if(!this.date||!this.employee){this.leavesPerType=null;return Promise.resolve();}
var self=this;var year_date_from=this.date.clone().startOf('year');var year_date_to=this.date.clone().endOf('year');return this._rpc({model:'hr.leave',method:'read_group',kwargs:{domain:[['employee_id','=',this.employee.res_id],['state','=','validate'],['date_from','<=',year_date_to],['date_to','>=',year_date_from]],fields:['holiday_status_id','number_of_days:sum'],groupby:['holiday_status_id'],},}).then(function(data){self.leavesPerType=data;});}});widget_registry.add('hr_leave_stats',LeaveStatsWidget);return LeaveStatsWidget;});;

/* /hr_holidays/static/src/bugfix/bugfix.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('hr_holidays/static/src/bugfix/bugfix.js',function(require){'use strict';});;

/* /hr_holidays/static/src/components/thread_view/thread_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('hr_holidays/static/src/components/thread_view/thread_view.js',function(require){'use strict';const components={ThreadView:require('mail/static/src/components/thread_view/thread_view.js'),};const{str_to_datetime}=require('web.time');const{patch}=require('web.utils');patch(components.ThreadView,'hr_holidays/static/src/components/thread_view/thread_view.js',{getOutOfOfficeText(){if(!this.threadView.thread.correspondent){return"";}
if(!this.threadView.thread.correspondent.out_of_office_date_end){return"";}
const currentDate=new Date();const date=str_to_datetime(this.threadView.thread.correspondent.out_of_office_date_end);const options={day:'numeric',month:'short'};if(currentDate.getFullYear()!==date.getFullYear()){options.year='numeric';}
const formattedDate=date.toLocaleDateString(window.navigator.language,options);return _.str.sprintf(this.env._t("Out of office until %s."),formattedDate);},_useStoreSelector(props){const res=this._super(...arguments);const threadView=this.env.models['mail.thread_view'].get(props.threadViewLocalId);const thread=threadView?threadView.thread:undefined;const correspondent=thread?thread.correspondent:undefined;return Object.assign({},res,{correspondent:correspondent?correspondent.__state:undefined,});},});});;

/* /hr_mobile/static/src/js/language_mobile.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_mobile.employee_language',function(require){'use strict';const EmployeeProfileFormView=require('hr.employee_language');const{UpdateDeviceAccountControllerMixin}=require('web_mobile.mixins');EmployeeProfileFormView.prototype.config.Controller.include(UpdateDeviceAccountControllerMixin);});;

/* /hr_org_chart/static/src/js/hr_org_chart.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.OrgChart',function(require){"use strict";var AbstractField=require('web.AbstractField');var concurrency=require('web.concurrency');var core=require('web.core');var field_registry=require('web.field_registry');var session=require('web.session');var QWeb=core.qweb;var _t=core._t;var FieldOrgChart=AbstractField.extend({events:{"click .o_employee_redirect":"_onEmployeeRedirect","click .o_employee_sub_redirect":"_onEmployeeSubRedirect","click .o_employee_more_managers":"_onEmployeeMoreManager"},init:function(parent,options){this._super.apply(this,arguments);this.dm=new concurrency.DropMisordered();this.employee=null;},_getOrgData:function(){var self=this;return this.dm.add(this._rpc({route:'/hr/get_org_chart',params:{employee_id:this.employee,context:session.user_context,},})).then(function(data){return data;});},_getSubordinatesData:function(employee_id,type){return this.dm.add(this._rpc({route:'/hr/get_subordinates',params:{employee_id:employee_id,subordinates_type:type,context:session.user_context,},}));},_render:function(){if(!this.recordData.id){return this.$el.html(QWeb.render("hr_org_chart",{managers:[],children:[],}));}
else if(!this.employee){this.employee=this.recordData.employee_ids!==undefined?this.recordData.employee_ids.res_ids[0]:this.recordData.id;}
var self=this;return this._getOrgData().then(function(orgData){if(_.isEmpty(orgData)){orgData={managers:[],children:[],}}
orgData.view_employee_id=self.recordData.id;self.$el.html(QWeb.render("hr_org_chart",orgData));self.$('[data-toggle="popover"]').each(function(){$(this).popover({html:true,title:function(){var $title=$(QWeb.render('hr_orgchart_emp_popover_title',{employee:{name:$(this).data('emp-name'),id:$(this).data('emp-id'),},}));$title.on('click','.o_employee_redirect',_.bind(self._onEmployeeRedirect,self));return $title;},container:this,placement:'left',trigger:'focus',content:function(){var $content=$(QWeb.render('hr_orgchart_emp_popover_content',{employee:{id:$(this).data('emp-id'),name:$(this).data('emp-name'),direct_sub_count:parseInt($(this).data('emp-dir-subs')),indirect_sub_count:parseInt($(this).data('emp-ind-subs')),},}));$content.on('click','.o_employee_sub_redirect',_.bind(self._onEmployeeSubRedirect,self));return $content;},template:QWeb.render('hr_orgchart_emp_popover',{}),});});});},_onEmployeeMoreManager:function(event){event.preventDefault();this.employee=parseInt($(event.currentTarget).data('employee-id'));this._render();},_onEmployeeRedirect:function(event){var self=this;event.preventDefault();var employee_id=parseInt($(event.currentTarget).data('employee-id'));return this._rpc({model:'hr.employee',method:'get_formview_action',args:[employee_id],}).then(function(action){return self.do_action(action);});},_onEmployeeSubRedirect:function(event){event.preventDefault();var employee_id=parseInt($(event.currentTarget).data('employee-id'));var employee_name=$(event.currentTarget).data('employee-name');var type=$(event.currentTarget).data('type')||'direct';var self=this;if(employee_id){this._getSubordinatesData(employee_id,type).then(function(data){var domain=[['id','in',data]];return self._rpc({model:'hr.employee',method:'get_formview_action',args:[employee_id],}).then(function(action){action=_.extend(action,{'view_mode':'kanban,list,form','views':[[false,'kanban'],[false,'list'],[false,'form']],'domain':domain,});return self.do_action(action);});});}},});field_registry.add('hr_org_chart',FieldOrgChart);return FieldOrgChart;});;

/* /hr_skills/static/src/js/resume_widget.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web.FieldResume',function(require){"use strict";var time=require('web.time');var FieldOne2Many=require('web.relational_fields').FieldOne2Many;var FieldProgressBar=require('web.basic_fields').FieldProgressBar;var ListRenderer=require('web.ListRenderer');var field_registry=require('web.field_registry');var core=require('web.core');var qweb=core.qweb;var _t=core._t;var AbstractGroupedOne2ManyRenderer=ListRenderer.extend({groupBy:'',groupTitleTemplate:'hr_default_group_row',dataRowTemplate:'',addLineButtonTemplate:'group_add_item',_freezeColumnWidths:function(){},_renderHeader:function(){return $('<thead/>');},_renderFooter:function(){return $('<tfoot/>');},_renderGroupRow:function(display_name){return qweb.render(this.groupTitleTemplate,{display_name:display_name});},_formatData:function(data){return data;},_renderRow:function(record,isLast){return $(qweb.render(this.dataRowTemplate,{id:record.id,data:this._formatData(record.data),is_last:isLast,}));},_getCreateLineContext:function(group){return{};},_renderTrashIcon:function(){return qweb.render('hr_trash_button');},_renderAddItemButton:function(group){return qweb.render(this.addLineButtonTemplate,{context:JSON.stringify(this._getCreateLineContext(group)),});},_renderBody:function(){var self=this;var grouped_by=_.groupBy(this.state.data,function(record){return record.data[self.groupBy].res_id;});var groupTitle;var $body=$('<tbody>');for(var key in grouped_by){var group=grouped_by[key];if(key==='undefined'){groupTitle=_t("Other");}else{groupTitle=group[0].data[self.groupBy].data.display_name;}
var $title_row=$(self._renderGroupRow(groupTitle));$body.append($title_row);group.forEach(function(record,index){var isLast=(index+1===group.length);var $row=self._renderRow(record,isLast);if(self.addTrashIcon)$row.append(self._renderTrashIcon());$body.append($row);});if(self.addCreateLine){$title_row.find('.o_group_name').append(self._renderAddItemButton(group));}}
if($body.is(':empty')&&self.addCreateLine){$body.append(this._renderAddItemButton());}
return $body;},});var ResumeLineRenderer=AbstractGroupedOne2ManyRenderer.extend({groupBy:'line_type_id',groupTitleTemplate:'hr_resume_group_row',dataRowTemplate:'hr_resume_data_row',_formatData:function(data){var dateFormat=time.getLangDateFormat();var date_start=data.date_start&&data.date_start.format(dateFormat)||"";var date_end=data.date_end&&data.date_end.format(dateFormat)||_t("Current");return _.extend(data,{date_start:date_start,date_end:date_end,});},_getCreateLineContext:function(group){var ctx=this._super(group);return group?_.extend({default_line_type_id:group[0].data[this.groupBy]&&group[0].data[this.groupBy].data.id||""},ctx):ctx;},_render:function(){var self=this;return this._super().then(function(){self.$el.find('table').removeClass('table-striped o_list_table_ungrouped');self.$el.find('table').addClass('o_resume_table table-borderless');});},});var SkillsRenderer=AbstractGroupedOne2ManyRenderer.extend({groupBy:'skill_type_id',dataRowTemplate:'hr_skill_data_row',_renderRow:function(record){var $row=this._super(record);var $td=$('<td/>',{class:'o_data_cell o_skill_cell'});var progress=new FieldProgressBar(this,'level_progress',record,{current_value:record.data.level_progress,attrs:this.arch.attrs,});progress.appendTo($td);return $row.append($td);},_getCreateLineContext:function(group){var ctx=this._super(group);return group?_.extend({default_skill_type_id:group[0].data[this.groupBy].data.id},ctx):ctx;},_render:function(){var self=this;return this._super().then(function(){self.$el.find('table').toggleClass('table-striped');});},});var FieldResume=FieldOne2Many.extend({_getRenderer:function(){return ResumeLineRenderer;},});var FieldSkills=FieldOne2Many.extend({_getRenderer:function(){return SkillsRenderer;},});field_registry.add('hr_resume',FieldResume);field_registry.add('hr_skills',FieldSkills);return FieldResume;});;

/* /mail_mobile/static/src/js/mobile_device_register.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mail_mobile.ocn',function(require){"use strict";const mobile=require('web_mobile.core');var ajax=require('web.ajax');if(mobile.methods.getFCMKey){var sessionInfo=odoo.session_info;var registerDevice=function(fcm_project_id){mobile.methods.getFCMKey({project_id:fcm_project_id,inbox_action:sessionInfo.inbox_action,}).then(function(response){if(response.success){ajax.rpc('/web/dataset/call_kw/res.config.settings/register_device',{model:'res.config.settings',method:'register_device',args:[response.data.subscription_id,response.data.device_name],kwargs:{},}).then(function(ocn_token){if(mobile.methods.setOCNToken){mobile.methods.setOCNToken({ocn_token:ocn_token});}});}});};if(sessionInfo.fcm_project_id){registerDevice(sessionInfo.fcm_project_id);}else{ajax.rpc('/web/dataset/call_kw/res.config.settings/get_fcm_project_id',{model:'res.config.settings',method:'get_fcm_project_id',args:[],kwargs:{},}).then(function(response){if(response){registerDevice(response);}});}}});;

/* /partner_autocomplete/static/src/js/partner_autocomplete_core.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('partner.autocomplete.Mixin',function(require){'use strict';var concurrency=require('web.concurrency');var core=require('web.core');var Qweb=core.qweb;var utils=require('web.utils');var _t=core._t;var PartnerAutocompleteMixin={_dropPreviousOdoo:new concurrency.DropPrevious(),_dropPreviousClearbit:new concurrency.DropPrevious(),_timeout:1000,_autocomplete:function(value){var self=this;value=value.trim();var isVAT=this._isVAT(value);var odooSuggestions=[];var clearbitSuggestions=[];return new Promise(function(resolve,reject){var odooPromise=self._getOdooSuggestions(value,isVAT).then(function(suggestions){odooSuggestions=suggestions;});var clearbitPromise=isVAT?false:self._getClearbitSuggestions(value).then(function(suggestions){clearbitSuggestions=suggestions;});var concatResults=function(){if(clearbitSuggestions&&clearbitSuggestions.length){var websites=odooSuggestions.map(function(suggestion){return suggestion.website;});clearbitSuggestions.forEach(function(suggestion){if(websites.indexOf(suggestion.domain)<0){websites.push(suggestion.domain);odooSuggestions.push(suggestion);}});}
odooSuggestions=_.filter(odooSuggestions,function(suggestion){return!suggestion.ignored;});_.each(odooSuggestions,function(suggestion){delete suggestion.ignored;});return resolve(odooSuggestions);};self._whenAll([odooPromise,clearbitPromise]).then(concatResults,concatResults);});},_enrichCompany:function(company){return this._rpc({model:'res.partner',method:'enrich_company',args:[company.website,company.partner_gid,company.vat],});},_getCompanyLogo:function(url){return this._getBase64Image(url).then(function(base64Image){return base64Image?base64Image.replace(/^data:image[^;]*;base64,?/,''):false;}).catch(function(){return false;});},_getCreateData:function(company){var self=this;var removeUselessFields=function(company){var fields='label,description,domain,logo,legal_name,ignored,email'.split(',');fields.forEach(function(field){delete company[field];});var notEmptyFields="country_id,state_id".split(',');notEmptyFields.forEach(function(field){if(!company[field])delete company[field];});};return new Promise(function(resolve){var enrichPromise=self._enrichCompany(company);var logoPromise=company.logo?self._getCompanyLogo(company.logo):false;self._whenAll([enrichPromise,logoPromise]).then(function(result){var company_data=result[0];var logo_data=result[1];if(company_data.error&&company_data.vat){company.vat=company_data.vat;}
if(company_data.error){if(company_data.error_message==='Insufficient Credit'){self._notifyNoCredits();}else if(company_data.error_message==='No Account Token'){self._notifyAccountToken();}else{self.do_notify(false,company_data.error_message);}
company_data=company;}
if(_.isEmpty(company_data)){company_data=company;}
removeUselessFields(company_data);if(company.vat){company_data.vat=company.vat;}
resolve({company:company_data,logo:logo_data});});});},_isOnline:function(){return navigator&&navigator.onLine;},_validateSearchTerm:function(search_val,onlyVAT){if(onlyVAT)return this._isVAT(search_val);else return search_val&&search_val.length>2;},_getBase64Image:function(url){return new Promise(function(resolve,reject){var xhr=new XMLHttpRequest();xhr.onload=function(){utils.getDataURLFromFile(xhr.response).then(resolve);};xhr.open('GET',url);xhr.responseType='blob';xhr.onerror=reject;xhr.send();});},_getClearbitSuggestions:function(value){var url='https://autocomplete.clearbit.com/v1/companies/suggest?query='+value;var def=$.ajax({url:url,dataType:'json',timeout:this._timeout,success:function(suggestions){suggestions.map(function(suggestion){suggestion.label=suggestion.name;suggestion.website=suggestion.domain;suggestion.description=suggestion.website;return suggestion;});return suggestions;},});return this._dropPreviousClearbit.add(def);},_getOdooSuggestions:function(value,isVAT){var method=isVAT?'read_by_vat':'autocomplete';var def=this._rpc({model:'res.partner',method:method,args:[value],},{shadow:true,}).then(function(suggestions){suggestions.map(function(suggestion){suggestion.logo=suggestion.logo||'';suggestion.label=suggestion.legal_name||suggestion.name;if(suggestion.vat)suggestion.description=suggestion.vat;else if(suggestion.website)suggestion.description=suggestion.website;if(suggestion.country_id&&suggestion.country_id.display_name){if(suggestion.description)suggestion.description+=_.str.sprintf(' (%s)',suggestion.country_id.display_name);else suggestion.description+=suggestion.country_id.display_name;}
return suggestion;});return suggestions;});return this._dropPreviousOdoo.add(def);},_isVAT:function(search_val){var str=this._sanitizeVAT(search_val);return checkVATNumber(str);},_sanitizeVAT:function(search_value){return search_value?search_value.replace(/[^A-Za-z0-9]/g,''):'';},_whenAll:function(promises){return Promise.all(promises.map(function(p){return Promise.resolve(p);}));},_notifyNoCredits:function(){var self=this;return this._rpc({model:'iap.account',method:'get_credits_url',args:['partner_autocomplete'],}).then(function(url){var title=_t('Not enough credits for Partner Autocomplete');var content=Qweb.render('partner_autocomplete.insufficient_credit_notification',{credits_url:url});self.do_notify(title,content,false,'o_partner_autocomplete_no_credits_notify');});},_notifyAccountToken:function(){var self=this;return this._rpc({model:'iap.account',method:'get_config_account_url',args:[]}).then(function(url){var title=_t('IAP Account Token missing');if(url){var content=Qweb.render('partner_autocomplete.account_token',{account_url:url});self.do_notify(title,content,false,'o_partner_autocomplete_no_credits_notify');}
else{self.do_notify(title);}});},};return PartnerAutocompleteMixin;});;

/* /partner_autocomplete/static/src/js/partner_autocomplete_fieldchar.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('partner.autocomplete.fieldchar',function(require){'use strict';var basic_fields=require('web.basic_fields');var core=require('web.core');var field_registry=require('web.field_registry');var AutocompleteMixin=require('partner.autocomplete.Mixin');var QWeb=core.qweb;var FieldChar=basic_fields.FieldChar;var FieldAutocomplete=FieldChar.extend(AutocompleteMixin,{className:'o_field_partner_autocomplete',debounceSuggestions:400,resetOnAnyFieldChange:true,jsLibs:['/partner_autocomplete/static/lib/jsvat.js'],events:_.extend({},FieldChar.prototype.events,{'keyup':'_onKeyup','mousedown .o_partner_autocomplete_suggestion':'_onMousedown','focusout':'_onFocusout','mouseenter .o_partner_autocomplete_suggestion':'_onHoverDropdown','click .o_partner_autocomplete_suggestion':'_onSuggestionClicked',}),init:function(){this._super.apply(this,arguments);this.onlyVAT=this.name==='vat';if(this.mode==='edit'){this.tagName='div';this.className+=' dropdown open';}
if(this.debounceSuggestions>0){this._suggestCompanies=_.debounce(this._suggestCompanies.bind(this),this.debounceSuggestions);}},_isActive:function(){return this.model==='res.company'||(this.model==='res.partner'&&this.record.data.is_company&&!(this.record.data&&this.record.data.id));},_removeDropdown:function(){if(this.$dropdown){this.$dropdown.remove();this.$dropdown=undefined;}},_renderEdit:function(){this.$el.empty();this._prepareInput().appendTo(this.$el);},_selectCompany:function(company){var self=this;this._getCreateData(company).then(function(data){if(data.logo){var logoField=self.model==='res.partner'?'image_1920':'logo';data.company[logoField]=data.logo;}
if(self.model==='res.company'){var fields='comment,child_ids,bank_ids,additional_info'.split(',');fields.forEach(function(field){delete data.company[field];});}
self._setOne2ManyField('bank_ids',data.company.bank_ids);delete data.company.bank_ids;self.trigger_up('field_changed',{dataPointID:self.dataPointID,changes:data.company,onSuccess:function(){if(self.onlyVAT)
self.$input.val(self._formatValue(company.vat));else
self.$input.val(self._formatValue(company.name));},});});this._removeDropdown();},_setOne2ManyField:function(field,list){var self=this;var viewType=this.record.viewType;if(list&&this.record.fieldsInfo[viewType]&&this.record.fieldsInfo[viewType][field]){list.forEach(function(item){var changes={};changes[field]={operation:'CREATE',data:item,};self.trigger_up('field_changed',{dataPointID:self.dataPointID,changes:changes,});});}},_showDropdown:function(){this._removeDropdown();if(this.suggestions.length>0){this.$dropdown=$(QWeb.render('partner_autocomplete.dropdown',{suggestions:this.suggestions,}));this.$dropdown.appendTo(this.$el);}},_suggestCompanies:function(value){var self=this;if(this._validateSearchTerm(value,this.onlyVAT)&&this._isOnline()){return this._autocomplete(value).then(function(suggestions){if(suggestions&&suggestions.length){self.suggestions=suggestions;self._showDropdown();}else{self._removeDropdown();}});}else{this._removeDropdown();}},_onFocusout:function(){this._removeDropdown();},_onHoverDropdown:function(e){this.$dropdown.find('.active').removeClass('active');$(e.currentTarget).parent().addClass('active');},_onInput:function(){this._super.apply(this,arguments);if(this._isActive()){this._suggestCompanies(this.$input.val());}},_onKeydown:function(e){switch(e.which){case $.ui.keyCode.UP:case $.ui.keyCode.DOWN:if(!this.$dropdown){break;}
e.preventDefault();var $suggestions=this.$dropdown.children();var $active=$suggestions.filter('.active');var $to;if($active.length){$to=e.which===$.ui.keyCode.DOWN?$active.next():$active.prev();}else{$to=$suggestions.first();}
if($to.length){$active.removeClass('active');$to.addClass('active');}
return;}
this._super.apply(this,arguments);},_onKeyup:function(e){switch(e.which){case $.ui.keyCode.ESCAPE:e.preventDefault();this._removeDropdown();break;case $.ui.keyCode.ENTER:if(!this.$dropdown){break;}
e.preventDefault();var $active=this.$dropdown.find('.o_partner_autocomplete_suggestion.active');if(!$active.length){return;}
this._selectCompany(this.suggestions[$active.data('index')]);break;}},_onMousedown:function(e){e.preventDefault();},_onSuggestionClicked:function(e){e.preventDefault();this._selectCompany(this.suggestions[$(e.currentTarget).data('index')]);},});field_registry.add('field_partner_autocomplete',FieldAutocomplete);return FieldAutocomplete;});;

/* /partner_autocomplete/static/src/js/partner_autocomplete_many2one.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('partner.autocomplete.many2one',function(require){'use strict';var FieldMany2One=require('web.relational_fields').FieldMany2One;var core=require('web.core');var AutocompleteMixin=require('partner.autocomplete.Mixin');var field_registry=require('web.field_registry');var _t=core._t;var PartnerField=FieldMany2One.extend(AutocompleteMixin,{jsLibs:['/partner_autocomplete/static/lib/jsvat.js'],init:function(){this._super.apply(this,arguments);this._addAutocompleteSource(this._searchSuggestions,{placeholder:_t('Searching Autocomplete...'),order:20,validation:this._validateSearchTerm,});this.additionalContext['show_vat']=true;},_createPartner:function(company){var self=this;self.$('input').val('');return self._getCreateData(company).then(function(data){var context={'default_is_company':true};_.each(data.company,function(val,key){context['default_'+key]=val&&val.id?val.id:val;});if(data.logo)context.default_image_1920=data.logo;return self._searchCreatePopup("form",false,context);});},_getDisplayNameWithoutVAT:function(value){return value.split('  ')[0];},_modifyAutompleteRendering:function(){var api=this.$input.data('ui-autocomplete');if(!api){return;}
api._renderItem=function(ul,item){ul.addClass('o_partner_autocomplete_dropdown');var $a=$('<a/>')["html"](item.label);if(item.logo){var $img=$('<img/>').attr('src',item.logo);$a.append($img);}
return $("<li></li>").data("item.autocomplete",item).append($a).appendTo(ul).addClass(item.classname);};},_renderEdit:function(){this.m2o_value=this._getDisplayNameWithoutVAT(this.m2o_value);this._super.apply(this,arguments);this._modifyAutompleteRendering();},_searchSuggestions:function(search_val){var self=this;return new Promise(function(resolve,reject){if(self._isOnline()){self._autocomplete(search_val).then(function(suggestions){var choices=[];if(suggestions&&suggestions.length){_.each(suggestions,function(suggestion){var label='<i class="fa fa-magic text-muted"/> ';label+=_.str.sprintf('%s, <span class="text-muted">%s</span>',suggestion.label,suggestion.description);choices.push({label:label,action:function(){self._createPartner(suggestion);},logo:suggestion.logo,classname:'o_partner_autocomplete_dropdown_item',});});}
resolve(choices);});}else{resolve([]);}});},});field_registry.add('res_partner_many2one',PartnerField);return PartnerField;});;

/* /sms/static/src/js/fields_phone_widget.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sms.fields',function(require){"use strict";var basic_fields=require('web.basic_fields');var core=require('web.core');var session=require('web.session');var _t=core._t;var Phone=basic_fields.FieldPhone;Phone.include({init(){this._super.apply(this,arguments);this.enableSMS='enable_sms'in this.attrs.options?this.attrs.options.enable_sms:true;this.attrs.options.enable_sms=this.enableSMS;},getFocusableElement(){if(this.enableSMS&&this.mode==='readonly'){return this.$el.filter('.'+this.className);}
return this._super.apply(this,arguments);},_onClickSMS:function(ev){ev.preventDefault();ev.stopPropagation();var context=session.user_context;context=_.extend({},context,{default_res_model:this.model,default_res_id:parseInt(this.res_id),default_number_field_name:this.name,default_composition_mode:'comment',});var self=this;return this.do_action({title:_t('Send SMS Text Message'),type:'ir.actions.act_window',res_model:'sms.composer',target:'new',views:[[false,'form']],context:context,},{on_close:function(){self.trigger_up('reload');}});},_renderReadonly:function(){var def=this._super.apply(this,arguments);if(this.enableSMS&&this.value){var $composerButton=$('<a>',{title:_t('Send SMS Text Message'),href:'',class:'ml-3 d-inline-flex align-items-center o_field_phone_sms',html:$('<small>',{class:'font-weight-bold ml-1',html:'SMS'}),});$composerButton.prepend($('<i>',{class:'fa fa-mobile'}));$composerButton.on('click',this._onClickSMS.bind(this));this.$el=this.$el.add($composerButton);}
return def;},});return Phone;});;

/* /sms/static/src/js/fields_sms_widget.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sms.sms_widget',function(require){"use strict";var core=require('web.core');var fieldRegistry=require('web.field_registry');var FieldTextEmojis=require('mail.field_text_emojis');var _t=core._t;var SmsWidget=FieldTextEmojis.extend({className:'o_field_text',enableEmojis:false,init:function(){this._super.apply(this,arguments);this.nbrChar=0;this.nbrSMS=0;this.encoding='GSM7';this.enableEmojis=!!this.nodeOptions.enable_emojis;},on_attach_callback:function(){if(this.enableEmojis){this._super.apply(this,arguments);}},_renderEdit:function(){var def=this._super.apply(this,arguments);this._compute();$('.o_sms_container').remove();var $sms_container=$('<div class="o_sms_container"/>');$sms_container.append(this._renderSMSInfo());$sms_container.append(this._renderIAPButton());this.$el=this.$el.add($sms_container);return def;},_compute:function(){var content=this._getValue();this.encoding=this._extractEncoding(content);this.nbrChar=content.length;this.nbrChar+=(content.match(/\n/g)||[]).length;this.nbrSMS=this._countSMS(this.nbrChar,this.encoding);},_countSMS:function(){if(this.nbrChar===0){return 0;}
if(this.encoding==='UNICODE'){if(this.nbrChar<=70){return 1;}
return Math.ceil(this.nbrChar/67);}
if(this.nbrChar<=160){return 1;}
return Math.ceil(this.nbrChar/153);},_extractEncoding:function(content){if(String(content).match(RegExp("^[@$\\n\\r_ !\\\"#%&'()*+,-./0123456789:;<=>?ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz]*$"))){return'GSM7';}
return'UNICODE';},_renderIAPButton:function(){return $('<a>',{'href':'https://iap-services.odoo.com/iap/sms/pricing','target':'_blank','title':_t('SMS Pricing'),'aria-label':_t('SMS Pricing'),'class':'fa fa-lg fa-info-circle',});},_renderSMSInfo:function(){var string=_.str.sprintf(_t('%s characters, fits in %s SMS (%s) '),this.nbrChar,this.nbrSMS,this.encoding);var $span=$('<span>',{'class':'text-muted o_sms_count',});$span.text(string);return $span;},_updateSMSInfo:function(){this._compute();var string=_.str.sprintf(_t('%s characters, fits in %s SMS (%s) '),this.nbrChar,this.nbrSMS,this.encoding);this.$('.o_sms_count').text(string);},_onBlur:function(){var content=this._getValue();if(!content.trim().length&&content.length>0){this.do_warn(_t("Your SMS Text Message must include at least one non-whitespace character"));this.$input.val(content.trim());this._updateSMSInfo();}},_onChange:function(){this._super.apply(this,arguments);this._updateSMSInfo();},_onInput:function(){this._super.apply(this,arguments);this._updateSMSInfo();},});fieldRegistry.add('sms_widget',SmsWidget);return SmsWidget;});;

/* /sms/static/src/bugfix/bugfix.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sms/static/src/bugfix/bugfix.js',function(require){'use strict';});;

/* /sms/static/src/components/notification_group/notification_group.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sms/static/src/components/notification_group/notification_group.js',function(require){'use strict';const components={NotificationGroup:require('mail/static/src/components/notification_group/notification_group.js'),};const{patch}=require('web.utils');patch(components.NotificationGroup,'sms/static/src/components/notification_group/notification_group.js',{image(){if(this.group.notification_type==='sms'){return'/sms/static/img/sms_failure.svg';}
return this._super(...arguments);},});});;

/* /sms/static/src/models/message/message.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sms/static/src/models/message/message.js',function(require){'use strict';const{registerInstancePatchModel,}=require('mail/static/src/model/model_core.js');registerInstancePatchModel('mail.message','sms/static/src/models/message/message.js',{openResendAction(){if(this.message_type==='sms'){this.env.bus.trigger('do-action',{action:'sms.sms_resend_action',options:{additional_context:{default_mail_message_id:this.id,},},});}else{this._super(...arguments);}},});});;

/* /sms/static/src/models/notification_group/notification_group.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sms/static/src/models/notification_group/notification_group.js',function(require){'use strict';const{registerInstancePatchModel,}=require('mail/static/src/model/model_core.js');registerInstancePatchModel('mail.notification_group','sms/static/src/models/notification_group/notification_group.js',{openCancelAction(){if(this.notification_type!=='sms'){return this._super(...arguments);}
this.env.bus.trigger('do-action',{action:'sms.sms_cancel_action',options:{additional_context:{default_model:this.res_model,unread_counter:this.notifications.length,},},});},_openDocuments(){if(this.notification_type!=='sms'){return this._super(...arguments);}
this.env.bus.trigger('do-action',{action:{name:this.env._t("SMS Failures"),type:'ir.actions.act_window',view_mode:'kanban,list,form',views:[[false,'kanban'],[false,'list'],[false,'form']],target:'current',res_model:this.res_model,domain:[['message_has_sms_error','=',true]],},});if(this.env.messaging.device.isMobile){this.messagingMenu.close();}},});});;

/* /snailmail/static/src/bugfix/bugfix.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('snailmail/static/src/bugfix/bugfix.js',function(require){'use strict';});;

/* /snailmail/static/src/components/message/message.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('snailmail/static/src/components/message/message.js',function(require){'use strict';const components={Message:require('mail/static/src/components/message/message.js'),SnailmailErrorDialog:require('snailmail/static/src/components/snailmail_error_dialog/snailmail_error_dialog.js'),SnailmailNotificationPopover:require('snailmail/static/src/components/snailmail_notification_popover/snailmail_notification_popover.js'),};const{patch}=require('web.utils');const{useState}=owl;Object.assign(components.Message.components,{SnailmailErrorDialog:components.SnailmailErrorDialog,SnailmailNotificationPopover:components.SnailmailNotificationPopover,});patch(components.Message,'snailmail/static/src/components/message/message.js',{_constructor(){this._super(...arguments);this.snailmailState=useState({hasDialog:false,});},_onClickFailure(){if(this.message.message_type==='snailmail'){switch(this.message.notifications[0].failure_type){case'sn_credit':this.env.messaging.fetchSnailmailCreditsUrl();this.snailmailState.hasDialog=true;break;case'sn_error':this.snailmailState.hasDialog=true;break;case'sn_fields':this.message.openMissingFieldsLetterAction();break;case'sn_format':this.message.openFormatLetterAction();break;case'sn_price':this.snailmailState.hasDialog=true;break;case'sn_trial':this.env.messaging.fetchSnailmailCreditsUrlTrial();this.snailmailState.hasDialog=true;break;}}else{this._super(...arguments);}},_onDialogClosedSnailmailError(){this.snailmailState.hasDialog=false;},});});;

/* /snailmail/static/src/components/notification_group/notification_group.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('snailmail/static/src/components/notification_group/notification_group.js',function(require){'use strict';const components={NotificationGroup:require('mail/static/src/components/notification_group/notification_group.js'),};const{patch}=require('web.utils');patch(components.NotificationGroup,'snailmail/static/src/components/notification_group/notification_group.js',{image(){if(this.group.notification_type==='snail'){return'/snailmail/static/img/snailmail_failure.png';}
return this._super(...arguments);},});});;

/* /snailmail/static/src/components/snailmail_error_dialog/snailmail_error_dialog.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('snailmail/static/src/components/snailmail_error_dialog/snailmail_error_dialog.js',function(require){'use strict';const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const Dialog=require('web.OwlDialog');const{Component}=owl;const{useRef}=owl.hooks;class SnailmailErrorDialog extends Component{constructor(...args){super(...args);useStore(props=>{const message=this.env.models['mail.message'].get(props.messageLocalId);const notifications=message?message.notifications:[];return{message:message?message.__state:undefined,notifications:notifications.map(notification=>notification?notification.__state:undefined),snailmail_credits_url:this.env.messaging.snailmail_credits_url,snailmail_credits_url_trial:this.env.messaging.snailmail_credits_url_trial,};},{compareDepth:{notifications:1,},});this._dialogRef=useRef('dialog');}
get hasCreditsError(){return(this.notification.failure_type==='sn_credit'||this.notification.failure_type==='sn_trial');}
get message(){return this.env.models['mail.message'].get(this.props.messageLocalId);}
get notification(){return this.message.notifications[0];}
get title(){return this.env._t("Failed letter");}
_onClickCancelLetter(){this._dialogRef.comp._close();this.message.cancelLetter();}
_onClickClose(){this._dialogRef.comp._close();}
_onClickResendLetter(){this._dialogRef.comp._close();this.message.resendLetter();}}
Object.assign(SnailmailErrorDialog,{components:{Dialog},props:{messageLocalId:String,},template:'snailmail.SnailmailErrorDialog',});return SnailmailErrorDialog;});;

/* /snailmail/static/src/components/snailmail_notification_popover/snailmail_notification_popover.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('snailmail/static/src/components/snailmail_notification_popover/snailmail_notification_popover.js',function(require){'use strict';const{Component}=owl;const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');class SnailmailNotificationPopover extends Component{constructor(...args){super(...args);useStore(props=>{const message=this.env.models['mail.message'].get(props.messageLocalId);const notifications=message?message.notifications:[];return{message:message?message.__state:undefined,notifications:notifications.map(notification=>notification?notification.__state:undefined),};},{compareDepth:{notifications:1,},});}
get iconClass(){switch(this.notification.notification_status){case'sent':return'fa fa-check';case'ready':return'fa fa-clock-o';case'canceled':return'fa fa-trash-o';default:return'fa fa-exclamation text-danger';}}
get iconTitle(){switch(this.notification.notification_status){case'sent':return this.env._t("Sent");case'ready':return this.env._t("Awaiting Dispatch");case'canceled':return this.env._t("Canceled");default:return this.env._t("Error");}}
get message(){return this.env.models['mail.message'].get(this.props.messageLocalId);}
get notification(){return this.message.notifications[0];}}
Object.assign(SnailmailNotificationPopover,{props:{messageLocalId:String,},template:'snailmail.SnailmailNotificationPopover',});return SnailmailNotificationPopover;});;

/* /snailmail/static/src/models/message/message.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('snailmail/static/src/models/message.message.js',function(require){'use strict';const{registerInstancePatchModel}=require('mail/static/src/model/model_core.js');registerInstancePatchModel('mail.message','snailmail/static/src/models/message.message.js',{async cancelLetter(){await this.async(()=>this.env.services.rpc({model:'mail.message',method:'cancel_letter',args:[[this.id]],}));},openFormatLetterAction(){this.env.bus.trigger('do-action',{action:'snailmail.snailmail_letter_format_error_action',options:{additional_context:{message_id:this.id,},},});},async openMissingFieldsLetterAction(){const letterIds=await this.async(()=>this.env.services.rpc({model:'snailmail.letter',method:'search',args:[[['message_id','=',this.id]]],}));this.env.bus.trigger('do-action',{action:'snailmail.snailmail_letter_missing_required_fields_action',options:{additional_context:{default_letter_id:letterIds[0],},},});},async resendLetter(){await this.async(()=>this.env.services.rpc({model:'mail.message',method:'send_letter',args:[[this.id]],}));},});});;

/* /snailmail/static/src/models/messaging/messaging.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('snailmail/static/src/models/messaging/messaging.js',function(require){'use strict';const{registerInstancePatchModel,registerFieldPatchModel,}=require('mail/static/src/model/model_core.js');const{attr}=require('mail/static/src/model/model_field.js');registerInstancePatchModel('mail.messaging','snailmail/static/src/models/messaging/messaging.js',{async fetchSnailmailCreditsUrl(){const snailmail_credits_url=await this.async(()=>this.env.services.rpc({model:'iap.account',method:'get_credits_url',args:['snailmail'],}));this.update({snailmail_credits_url,});},async fetchSnailmailCreditsUrlTrial(){const snailmail_credits_url_trial=await this.async(()=>this.env.services.rpc({model:'iap.account',method:'get_credits_url',args:['snailmail','',0,true],}));this.update({snailmail_credits_url_trial,});},});registerFieldPatchModel('mail.messaging','snailmail/static/src/models/messaging/messaging.js',{snailmail_credits_url:attr(),snailmail_credits_url_trial:attr(),});});;

/* /snailmail/static/src/models/notification_group/notification_group.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('snailmail/static/src/models/notification_group/notification_group.js',function(require){'use strict';const{registerInstancePatchModel,}=require('mail/static/src/model/model_core.js');registerInstancePatchModel('mail.notification_group','snailmail/static/src/models/notification_group/notification_group.js',{openCancelAction(){if(this.notification_type!=='snail'){return this._super(...arguments);}
this.env.bus.trigger('do-action',{action:'snailmail.snailmail_letter_cancel_action',options:{additional_context:{default_model:this.res_model,unread_counter:this.notifications.length,},},});},_openDocuments(){if(this.notification_type!=='snail'){return this._super(...arguments);}
this.env.bus.trigger('do-action',{action:{name:this.env._t("Snailmail Failures"),type:'ir.actions.act_window',view_mode:'kanban,list,form',views:[[false,'kanban'],[false,'list'],[false,'form']],target:'current',res_model:this.res_model,domain:[['message_ids.snailmail_error','=',true]],},});if(this.env.messaging.device.isMobile){this.env.messaging.messagingMenu.close();}},});});;

/* /social/static/src/js/social_post_formatter_mixin.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('social.post_formatter_mixin',function(require){"use strict";var SocialEmojisMixin=require('mail.emoji_mixin');return{_formatPost:function(formattedValue){formattedValue=SocialEmojisMixin._formatText(formattedValue);formattedValue=formattedValue.replace(/http(s)?:\/\/(www\.)?[a-zA-Z0-9@:%_+~#=~#?&//=\-\.]{3,256}/g,"<a href='$&' target='_blank' rel='noreferrer noopener'>$&</a>");return formattedValue;},_getMediaType:function(){if(this.mediaType){return this.mediaType;}else if(this.attrs&&this.attrs.media_type){return this.attrs.media_type;}},};});;

/* /social_twitter/static/src/js/social_post_formatter_mixin.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('social_twitter.post_formatter_mixin',function(require){"use strict";var SocialPostFormatterMixin=require('social.post_formatter_mixin');var _superFormatPost=SocialPostFormatterMixin._formatPost;SocialPostFormatterMixin._formatPost=function(formattedValue){formattedValue=_superFormatPost.apply(this,arguments);var mediaType=SocialPostFormatterMixin._getMediaType.apply(this,arguments);if(mediaType==='twitter'){formattedValue=formattedValue.replace(/\B#([a-zA-Z\d-_]+)/g,`<a href='https://twitter.com/hashtag/$1?src=hash' target='_blank'>#$1</a>`);formattedValue=formattedValue.replace(/\B@([\w\d--]+)/g,`<a href='https://twitter.com/$1' target='_blank'>@$1</a>`);}
return formattedValue;};});;

/* /social_linkedin/static/src/js/social_post_formatter_mixin.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('social_linkedin.post_formatter_mixin',function(require){"use strict";var SocialPostFormatterMixin=require('social.post_formatter_mixin');var _superFormatPost=SocialPostFormatterMixin._formatPost;SocialPostFormatterMixin._formatPost=function(formattedValue){formattedValue=_superFormatPost.apply(this,arguments);var mediaType=SocialPostFormatterMixin._getMediaType.apply(this,arguments);if(mediaType==='linkedin'){formattedValue=formattedValue.replace(/\B#([a-zA-Z\d-_]+)/g,`<a href='https://www.linkedin.com/feed/hashtag/$1' target='_blank'>#$1</a>`);}
return formattedValue;};});;

/* /social_facebook/static/src/js/social_post_formatter_mixin.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('social_facebook.post_formatter_mixin',function(require){"use strict";var SocialPostFormatterMixin=require('social.post_formatter_mixin');var _superFormatPost=SocialPostFormatterMixin._formatPost;SocialPostFormatterMixin._formatPost=function(formattedValue){formattedValue=_superFormatPost.apply(this,arguments);var mediaType=SocialPostFormatterMixin._getMediaType.apply(this,arguments);if(mediaType==='facebook'||mediaType==='facebook_preview'){formattedValue=formattedValue.replace(/\B#([a-zA-Z\d-_]+)/g,`<a href='https://www.facebook.com/hashtag/$1' target='_blank'>#$1</a>`);if(mediaType!=='facebook_preview'){var accountId=this.accountId||this.recordData.account_id.res_id;formattedValue=formattedValue.replace(/\B@\[([0-9]*)\]\s([\w\d--]+)/g,`<a href='/social_facebook/redirect_to_profile/`+accountId+`/$1?name=$2' target='_blank'>$2</a>`);}}
return formattedValue;};});;

/* /social/static/src/js/kanban_social_field_stream_post.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('social.kanban_field_stream_post',function(require){"use strict";var FieldRegistry=require('web.field_registry');var FieldText=require('web.basic_fields').FieldText;var MailEmojisMixin=require('mail.emoji_mixin');var SocialStreamPostFormatterMixin=require('social.post_formatter_mixin');var SocialKanbanMessageWrapper=FieldText.extend(MailEmojisMixin,SocialStreamPostFormatterMixin,{_render:function(){if(this.value){this.$el.html(this._formatPost(this.value));}},});FieldRegistry.add('social_kanban_field_stream_post',SocialKanbanMessageWrapper);return SocialKanbanMessageWrapper;});;

/* /social/static/src/js/social_post_preview_field.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('social.form_field_post_preview',function(require){"use strict";var FieldHtml=require('web_editor.field.html');var fieldRegistry=require('web.field_registry');var MailEmojisMixin=require('mail.emoji_mixin');var SocialPostFormatterMixin=require('social.post_formatter_mixin');var FieldPostPreview=FieldHtml.extend(MailEmojisMixin,SocialPostFormatterMixin,{_textToHtml:function(text){var html=this._super.apply(this,arguments);var $html=$(html);var $previewMessage=$html.find('.o_social_preview_message');$previewMessage.html(this._formatPost($previewMessage.text().trim()));return $html[0].outerHTML;}});fieldRegistry.add('social_post_preview',FieldPostPreview);return FieldPostPreview;});;

/* /social/static/src/js/add_stream_modal.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('social.social_post_kanban_add_stream_modal',function(require){"use strict";var core=require('web.core');var Dialog=require('web.Dialog');var _t=core._t;var AddStreamModal=Dialog.extend({template:'social.AddStreamModal',events:_.extend({},Dialog.prototype.events,{'click .o_social_account_card':'_onClickSocialAccount','click .o_social_media':'_onClickSocialMedia',}),init:function(parent,options){options=_.defaults(options||{},{title:_t('Add a Stream'),size:'medium',renderFooter:false,});this.isSocialManager=options.isSocialManager;this.socialMedia=options.socialMedia;this.socialAccounts=options.socialAccounts;this._super.apply(this,arguments);},_onClickSocialAccount:function(ev){var $target=$(ev.currentTarget);this.trigger_up('new_stream_account_clicked',{mediaId:$target.data('mediaId'),accountId:$target.data('accountId')});this.close();},_onClickSocialMedia:function(ev){var mediaId=$(ev.currentTarget).data('mediaId');this.trigger_up('new_stream_media_clicked',{'mediaId':mediaId});}});return AddStreamModal;});;

/* /social/static/src/js/post_kanban_images_carousel.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('social.social_post_kanban_images_carousel',function(require){"use strict";var core=require('web.core');var Dialog=require('web.Dialog');var _t=core._t;var PostKanbanImagesCarousel=Dialog.extend({template:'social.PostKanbanImagesCarousel',init:function(parent,options){options=_.defaults(options||{},{title:_t('Post Images'),renderFooter:false,dialogClass:'p-0 bg-900'});this.images=options.images;this.activeIndex=options.activeIndex||0;this._super.apply(this,arguments);}});return PostKanbanImagesCarousel;});;

/* /social/static/src/js/post_kanban_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('social.social_post_kanban_controller',function(require){"use strict";var KanbanController=require('web.KanbanController');var PostKanbanImagesCarousel=require('social.social_post_kanban_images_carousel');var PostKanbanController=KanbanController.extend({events:{'click .o_social_stream_post_image_more, .o_social_stream_post_image_click':'_onClickMoreImages'},_onClickMoreImages:function(ev){ev.stopPropagation();var $target=$(ev.currentTarget);new PostKanbanImagesCarousel(this,{'activeIndex':$target.data('currentIndex'),'images':$target.closest('.o_social_stream_post_image').data('images')}).open();},});return PostKanbanController;});;

/* /social/static/src/js/post_kanban_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('social.PostKanbanView',function(require){"use strict";var KanbanView=require('web.KanbanView');var viewRegistry=require('web.view_registry');var PostKanbanController=require('social.social_post_kanban_controller');var PostKanbanView=KanbanView.extend({config:_.extend({},KanbanView.prototype.config,{Controller:PostKanbanController,})});viewRegistry.add('social_post_kanban_view',PostKanbanView);return PostKanbanView;});;

/* /social/static/src/js/stream_post_comment_delete.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('social.social_post_kanban_comments_delete',function(require){"use strict";var core=require('web.core');var Dialog=require('web.Dialog');var _t=core._t;var StreamPostCommentDelete=Dialog.extend({template:'social.StreamPostCommentDeleteModal',init:function(parent,options){options=_.defaults(options||{},{title:_t('Delete Comment'),buttons:[{classes:'btn-primary',text:_t('Ok'),click:this._onConfirmCommentDelete.bind(this)},{text:_t('Cancel'),close:true}]});this.postId=options.postId;this.commentId=options.commentId;this.commentName=options.commentName;this.deleteCommentEndpoint=options.deleteCommentEndpoint;this._super.apply(this,arguments);},willStart:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.$modal.addClass('o_social_comment_delete_modal');return Promise.resolve();});},_onConfirmCommentDelete:function(ev){var self=this;this._rpc({model:'social.stream.post',method:this.deleteCommentEndpoint,args:[[this.postId],this.commentId]}).then(function(){self.trigger('comment_deleted');self.close();});}});return StreamPostCommentDelete;});;

/* /social/static/src/js/stream_post_comments.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('social.social_post_kanban_comments',function(require){var BasicFields=require('web.basic_fields');var core=require('web.core');var Dialog=require('web.Dialog');var dom=require('web.dom');var emojis=require('mail.emojis');var PostKanbanImagesCarousel=require('social.social_post_kanban_images_carousel');var MailEmojisMixin=require('mail.emoji_mixin');var SocialStreamPostFormatterMixin=require('social.post_formatter_mixin');var time=require('web.time');var _t=core._t;var FieldBinaryImage=BasicFields.FieldBinaryImage;var QWeb=core.qweb;var DATE_TIME_FORMAT=time.getLangDatetimeFormat();var StreamPostCommentDelete=require('social.social_post_kanban_comments_delete');var StreamPostComments=Dialog.extend(MailEmojisMixin,SocialStreamPostFormatterMixin,{template:'social.StreamPostComments',events:{'keydown .o_social_add_comment':'_onAddComment','click .o_social_comment_add_image':'_onAddImage','change .o_input_file':'_onImageChange','click .o_social_write_reply .fa-times':'_onImageRemove','click .o_social_write_reply .o_mail_emoji':'_onEmojiClick','click .o_social_comment_like':'_onLikeComment','click .o_social_edit_comment':'_onEditComment','click .o_social_edit_comment_cancel':'_onEditCommentCancel','click .o_social_delete_comment':'_onDeleteComment','click .o_social_comment_reply':'_onReplyComment','click .o_social_load_more_comments':'_onLoadMoreComments','click .o_social_comment_load_replies':'_onLoadReplies','click .o_social_original_post_image_more, .o_social_original_post_image_click':'_onClickMoreImages',},init:function(parent,options){options=_.defaults(options||{},{title:options.title||_t('Comments'),renderFooter:false,size:'medium',});this.accountId=options.accountId;this.originalPost=options.originalPost;this.emojis=emojis;this.postId=options.postId;this.comments=options.comments;this.commentName=options.commentName;this._super.apply(this,arguments);},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){dom.autoresize(self.$('textarea').first(),{parent:self,min_height:60});});},getAuthorPictureSrc:function(comment){return"";},getCommentLink:function(comment){return"";},isCommentDeletable:function(comment){return false;},isCommentEditable:function(){return false;},isCommentLikable:function(){return true;},getAuthorLink:function(comment){return"";},getLikesClass:function(){return"fa-thumbs-up";},getAddCommentEndpoint:function(){return null;},getDeleteCommentEndpoint:function(){return null;},canAddImage:function(){return true;},showMoreComments:function(result){return false;},_onAddComment:function(ev){if(ev.keyCode!==$.ui.keyCode.ENTER||ev.ctrlKey||ev.shiftKey){return;}
ev.preventDefault();var $textarea=$(ev.currentTarget);if($textarea.val().trim()===''){return;}
var isCommentReply=$textarea.data('isCommentReply');var isCommentEdit=$textarea.data('isCommentEdit');var commentId=$textarea.data('commentId');this._addComment($textarea,isCommentReply,commentId,isCommentEdit);this.$('.o_social_no_comment_message').remove();},_onAddImage:function(ev){ev.preventDefault();$(ev.currentTarget).closest('.o_social_write_reply').find('.o_input_file').first().click();},_onImageChange:function(ev){var $target=$(ev.currentTarget);var fileNode=ev.target;var fileReader=new FileReader();var file=fileNode.files[0];if(!file){return;}
fileReader.readAsDataURL(file);fileReader.onloadend=function(upload){var data=upload.target.result.split(',')[1];var $replyEl=$target.closest('.o_social_write_reply');var $imagePreview=$replyEl.find('.o_social_comment_image_preview');$imagePreview.removeClass('d-none');var fileType=FieldBinaryImage.prototype.file_type_magic_word[data[0]]||'png';$imagePreview.find('img').attr('src','data:image/'+fileType+';base64,'+data);$replyEl.find('textarea').removeAttr('data-existing-attachment-id').removeData('existingAttachmentId');};},_onImageRemove:function(ev){var $target=$(ev.currentTarget);var $replyEl=$target.closest('.o_social_write_reply');$replyEl.find('.o_social_comment_image_preview').addClass('d-none');$replyEl.find('.o_input_file').val('');$replyEl.find('textarea').removeAttr('data-existing-attachment-id').removeData('existingAttachmentId');},_onEditComment:function(ev){ev.preventDefault();var $targetComment=$(ev.currentTarget).closest('.o_social_comment');var $editComment=$(QWeb.render("social.StreamPostReply",{widget:this,comment:{id:$targetComment.data('commentId')},isCommentEdit:true,initialValue:$targetComment.find('.o_social_comment_text').first().data('originalMessage'),existingAttachmentId:$targetComment.data('existingAttachmentId'),existingAttachmentSrc:$targetComment.data('existingAttachmentSrc'),}));$targetComment.find('.o_social_comment_wrapper').first().hide();$targetComment.find('.o_social_comment_commands').first().hide();$targetComment.find('.o_social_comment_attachment').first().hide();$targetComment.prepend($editComment);dom.autoresize($editComment.find('textarea').first(),{parent:this,min_height:60});},_onEditCommentCancel:function(ev){ev.preventDefault();var $targetComment=$(ev.currentTarget).closest('.o_social_comment');$targetComment.find('.o_social_write_reply').first().remove();$targetComment.find('.o_social_comment_wrapper').first().show();$targetComment.find('.o_social_comment_commands').first().show();$targetComment.find('.o_social_comment_attachment').first().show();},_onDeleteComment:function(ev){ev.preventDefault();var postDeleteWindow=new StreamPostCommentDelete(this,{postId:this.postId,commentName:this.commentName,deleteCommentEndpoint:this.getDeleteCommentEndpoint(),commentId:$(ev.currentTarget).closest('.o_social_comment').data('commentId')}).open();postDeleteWindow.on('comment_deleted',null,function(){$(ev.currentTarget).closest('.o_social_comment').remove();});},_onReplyComment:function(ev){ev.preventDefault();var $target=$(ev.currentTarget);var $targetComment=$target.closest('.o_social_root_comment');var $textarea=$targetComment.find('.o_social_write_comment_reply').removeClass('d-none').find('textarea').focus();$textarea.focus();dom.autoresize($textarea,{parent:this,min_height:60});},_onLoadReplies:function(ev){ev.preventDefault();var self=this;var $target=$(ev.currentTarget);var innerComments=$target.data('innerComments');var $commentsRepliesContainer=$target.closest('.o_social_comment').find('.o_social_comment_replies');innerComments.forEach(function(innerComment){var $innerComment=$(QWeb.render("social.StreamPostComment",{widget:self,isSubComment:true,comment:innerComment}));$commentsRepliesContainer.append($innerComment);});$commentsRepliesContainer.removeClass('d-none');$target.remove();},_onClickMoreImages:function(ev){var $target=$(ev.currentTarget);new PostKanbanImagesCarousel(this,{'activeIndex':$target.data('currentIndex'),'images':this.originalPost.postImages}).open();},_addComment:function($textarea,isCommentReply,commentId,isEdit){var self=this;var $replyEl=$textarea.closest('.o_social_write_reply');var formData=new FormData($replyEl.find('form').first()[0]);formData.append('csrf_token',odoo.csrf_token);formData.append('post_id',this.postId);if(isEdit){formData.append('is_edit',isEdit);}
if(isCommentReply||isEdit){formData.append('comment_id',commentId);}
$textarea.prop('disabled',true);var existingAttachmentId=$textarea.data('existingAttachmentId');if(existingAttachmentId){formData.append('existing_attachment_id',existingAttachmentId);}
this._ajaxRequest(this.getAddCommentEndpoint(),{data:formData,processData:false,contentType:false,type:'POST'}).then(function(comment){comment=JSON.parse(comment);var $newMessage=$(QWeb.render("social.StreamPostComment",{widget:self,comment:comment,isSubComment:isCommentReply}));if(isCommentReply){self._addCommentReply($textarea,$newMessage);}else if(isEdit){var $targetComment=$textarea.closest('.o_social_comment');$targetComment.after($newMessage);$targetComment.remove();}else{self.$('.o_social_comments_messages').prepend($newMessage);}
$textarea.val('');$replyEl.find('.o_social_comment_image_preview').addClass('d-none');$replyEl.find('.o_input_file').val('');$textarea.prop('disabled',false);$textarea.focus();});},_ajaxRequest:function(endpoint,params){return $.ajax(endpoint,params);},_htmlEscape:function(s){if(s==null){return'';}
return String(s).replace(/</g,'&lt;').replace(/>/g,'&gt;');},_addCommentReply:function($textarea,$newMessage){var $repliesContainer=$textarea.closest('.o_social_root_comment').find('.o_social_comment_replies');var $loadReplies=$textarea.closest('.o_social_root_comment').find('.o_social_comment_load_replies');if($loadReplies.length!==0){$loadReplies.click();}else{$repliesContainer.removeClass('d-none');}
$repliesContainer.append($newMessage);},_updateLikesCount:function($target){var userLikes=$target.data('userLikes');$target.data('userLikes',!userLikes);var $likesTotal=$target.closest('.o_social_comment').find('.o_social_comment_likes_total').eq(0);var likesCount=$likesTotal.find('.o_social_likes_count').text();likesCount=likesCount===''?0:parseInt(likesCount);if(userLikes){if(likesCount>0){likesCount--;}}else{likesCount++;}
$likesTotal.find('.o_social_likes_count').text(likesCount);if(likesCount===0){$likesTotal.addClass('d-none');}else{$likesTotal.removeClass('d-none');}},_formatDateTime:function(date){return moment(date).format(DATE_TIME_FORMAT);},_formatCommentStreamPost:function(message){return this._formatPost(message);},_getTargetTextElement($emoji){return $emoji.closest('.o_social_write_reply').find('textarea');}});return StreamPostComments;});;

/* /social/static/src/js/stream_post_kanban_model.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('social.social_stream_post_kanban_model',function(require){"use strict";var KanbanModel=require('web.KanbanModel');var StreamPostKanbanModel=KanbanModel.extend({_refreshStreams:function(){return this._rpc({model:'social.stream',method:'refresh_all'},{shadow:true});},_refreshAccountsStats:function(){this._rpc({model:'social.live.post',method:'refresh_statistics'},{shadow:true});return this._rpc({model:'social.account',method:'refresh_statistics'},{shadow:true});},_loadAccountsStats:function(){return this._rpc({model:'social.account',method:'search_read',domain:[['has_account_stats','=',true]],fields:['id','name','is_media_disconnected','audience','audience_trend','engagement','engagement_trend','stories','stories_trend','has_trends','media_id','stats_link','image',],});},});return StreamPostKanbanModel;});;

/* /social/static/src/js/stream_post_kanban_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('social.social_stream_post_kanban_renderer',function(require){"use strict";var core=require('web.core');var KanbanColumn=require('web.KanbanColumn');var KanbanRenderer=require('web.KanbanRenderer');var QWeb=core.qweb;var StreamPostKanbanColumn=KanbanColumn.extend({template:'social.KanbanView.Group'});var StreamPostKanbanRenderer=KanbanRenderer.extend({config:_.extend({},KanbanRenderer.prototype.config,{KanbanColumn:StreamPostKanbanColumn}),start:function(){var self=this;this.$before=this._createBeforeSectionElement();return this._super.apply(this,arguments).then(function(){self.$el.before(self.$before);self.$el.closest('.o_content').addClass('o_social_stream_post_kanban_view_wrapper bg-100');self._prependNewContentElement();});},_prependNewContentElement:function(){var self=this;this.$el.closest('.o_content').prepend($('<a>',{class:'o_social_stream_post_kanban_new_content alert alert-info mb-0 text-center border-bottom'+(this.refreshRequired?'':' d-none'),href:'#',text:_('New content available.')}).append($('<i>',{class:'fa fa-refresh ml-2 mr-1'})).append($('<b>',{text:_('Click to refresh.')})).on('click',function(ev){ev.preventDefault();$(ev.currentTarget).addClass('d-none');self.refreshRequired=false;self.trigger_up('new_content_clicked');}));},_setState:function(){var socialAccountsStats=this.state.socialAccountsStats;this._super.apply(this,arguments);this.state.socialAccountsStats=socialAccountsStats;},_render:function(){var self=this;return this._super.apply(this,arguments).then(function(){if(!self.refreshRequired){self.$el.closest('.o_content').find('.o_social_stream_post_kanban_new_content').addClass('d-none');}
self._renderAccountStats();});},_renderAccountStats:function(){this.$before.empty();if(this.state.socialAccountsStats&&this.state.socialAccountsStats.length!==0){var $socialAccountsStats=QWeb.render('social.AccountsStats',{socialAccounts:this.state.socialAccountsStats});if(this.$before.find('.o_social_stream_stat_box').length>0){var $newElement=this._createBeforeSectionElement();$newElement.append($socialAccountsStats);this.$before.replaceWith($newElement);}else{this.$before.append($socialAccountsStats);}
var $popoverElement=this.$before.find('[data-toggle="popover"]');$popoverElement.popover({trigger:'hover',delay:{"show":500,"hide":0},});$popoverElement.on("remove",()=>{$popoverElement.popover('dispose');});}},_createBeforeSectionElement:function(){return $('<section/>',{class:'o_social_stream_post_kanban_before d-flex flex-nowrap border-bottom'});},_toggleNoContentHelper:function(remove){var displayNoContentHelper=!remove&&!this._hasContent()&&!!this.noContentHelp&&!(this.quickCreate&&!this.quickCreate.folded);var $noContentHelper=this.$('.o_view_nocontent');if(displayNoContentHelper&&!$noContentHelper.length){this._renderNoContentHelper();}
if(!displayNoContentHelper&&$noContentHelper.length){$noContentHelper.remove();}},_refreshStreamsRequired:function(){this.refreshRequired=true;if(this.$el){this.$el.closest('.o_content').find('.o_social_stream_post_kanban_new_content').removeClass('d-none');}},_refreshStats:function(socialAccountsStats){this.state.socialAccountsStats=socialAccountsStats;if(this.$el){this._renderAccountStats();}}});return StreamPostKanbanRenderer;});;

/* /social/static/src/js/stream_post_kanban_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('social.social_stream_post_kanban_controller',function(require){"use strict";var AddStreamModal=require('social.social_post_kanban_add_stream_modal');var core=require('web.core');var dialogs=require('web.view_dialogs');var KanbanController=require('web.KanbanController');var PostKanbanImagesCarousel=require('social.social_post_kanban_images_carousel');var _t=core._t;var QWeb=core.qweb;var StreamPostKanbanController=KanbanController.extend({events:_.extend({},KanbanController.prototype.events,{'click .o_social_stream_post_image_more, .o_social_stream_post_image_click':'_onClickMoreImages','click .o_social_js_add_stream':'_onNewStream','click .o_social_account_link_disconnected':'_onRelinkAccount','click .o_social_stream_post_kanban_global:not(a,i)':'_onClickRecord'}),custom_events:_.extend({},KanbanController.prototype.custom_events,{'new_stream_account_clicked':'_onNewSteamAccountClicked','new_stream_media_clicked':'_onNewSteamMediaClicked','new_content_clicked':'_onClickNewContent',}),willStart:function(){var self=this;var superPromise=this._super.apply(this,arguments);var isSocialManagerPromise=this.getSession().user_has_group('social.group_social_manager').then(function(hasGroup){self.isSocialManager=hasGroup;});var hasAccountsPromise=this._rpc({model:'social.account',method:'search_count',args:[[]]}).then(function(accountsCount){self.hasAccounts=accountsCount>0;return Promise.resolve();});return Promise.all([superPromise,isSocialManagerPromise,hasAccountsPromise]);},renderButtons:function($node){this.$buttons=$(QWeb.render('StreamPostKanbanView.buttons',{hasAccounts:this.hasAccounts}));this.$buttons.on('click','.o_stream_post_kanban_new_post',this._onNewPost.bind(this));this.$buttons.on('click','.o_stream_post_kanban_new_stream',this._onNewStream.bind(this));this.$buttons.on('click','.o_stream_post_kanban_refresh_now',this._onRefreshNow.bind(this));this.updateButtons();if($node){this.$buttons.appendTo($node);}},_onClickMoreImages:function(ev){var $target=$(ev.currentTarget);new PostKanbanImagesCarousel(this,{'activeIndex':$target.data('currentIndex'),'images':$target.closest('.o_social_stream_post_image').data('images')}).open();},_onNewPost:function(ev){ev.preventDefault();this.do_action({name:_t('New Post'),type:'ir.actions.act_window',res_model:'social.post',views:[[false,'form']]});},_onNewStream:function(ev){ev.preventDefault();if(this.renderer.state.socialAccountsStats.length>0||this.isSocialManager){this._addNewStream();}else{this.do_warn(false,_t("No social accounts configured, please contact your administrator."));}},_onRelinkAccount:function(ev){ev.preventDefault();var mediaId=$(ev.currentTarget).data('mediaId');if(this.isSocialManager){this._rpc({model:'social.media',method:'action_add_account',args:[[mediaId]]}).then(function(action){document.location=action.url;});}else{this.do_warn(false,_t("Sorry, you're not allowed to re-link this account, please contact your administrator."));}},_onClickNewContent:function(){this.reload();},_onNewSteamAccountClicked:function(event){new dialogs.FormViewDialog(this,{title:_t('Add a stream'),res_model:'social.stream',context:{default_media_id:event.data.mediaId,default_account_id:event.data.accountId},disable_multiple_selection:true,on_saved:this.reload.bind(this,{}),save_text:_t('Add'),}).open();},_onNewSteamMediaClicked:function(event){this._rpc({model:'social.media',method:'action_add_account',args:[[event.data.mediaId]]}).then(function(action){document.location=action.url;});},_onRefreshNow:function(){var self=this;this.$buttons.find('.o_stream_post_kanban_refresh_now').addClass('disabled');this.$buttons.find('.o_stream_post_kanban_refresh_now .fa-spinner').removeClass('d-none');Promise.all([this.model._refreshStreams(),this.model._refreshAccountsStats()]).then(function(results){var streamsNeedRefresh=results[0];var socialAccountsStats=results[1];if(streamsNeedRefresh){self.renderer._refreshStreamsRequired();}
if(socialAccountsStats){self.renderer._refreshStats(socialAccountsStats);}
self.$buttons.find('.o_stream_post_kanban_refresh_now').removeClass('disabled');self.$buttons.find('.o_stream_post_kanban_refresh_now .fa-spinner').addClass('d-none');});},_onClickRecord:function(ev){var $target=$(ev.target);if($target.closest('a,.o_social_subtle_btn,img').length!==0){return;}
ev.preventDefault();$(ev.currentTarget).find('.o_social_comments').click();},_updateLikesCount:function($target){var userLikes=$target.data('userLikes');$target.data('userLikes',!userLikes);var likesCount=$target.find('.o_social_kanban_likes_count').text();likesCount=likesCount===''?0:parseInt(likesCount);if(userLikes){if(likesCount>0){likesCount--;}}else{likesCount++;}
if(likesCount===0){likesCount='';}
$target.find('.o_social_kanban_likes_count').text(likesCount);},_addNewStream:function(){var self=this;this._fetchSocialMedia().then(function(socialMedia){new AddStreamModal(self,{isSocialManager:self.isSocialManager,socialMedia:socialMedia,socialAccounts:self.renderer.state.socialAccountsStats}).open();});},_fetchSocialMedia:function(){if(this.socialMedia){return Promise.resolve(this.socialMedia);}else{var self=this;return new Promise(function(resolve){self._rpc({model:'social.media',method:'search_read',domain:[['has_streams','=','True']],fields:['id','name',],}).then(function(result){self.socialMedia=result;resolve(self.socialMedia);});});}}});return StreamPostKanbanController;});;

/* /social/static/src/js/stream_post_kanban_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('social.social_stream_post_kanban_view',function(require){"use strict";var KanbanView=require('web.KanbanView');var StreamPostKanbanController=require('social.social_stream_post_kanban_controller');var StreamPostKanbanModel=require('social.social_stream_post_kanban_model');var StreamPostKanbanRenderer=require('social.social_stream_post_kanban_renderer');var viewRegistry=require('web.view_registry');var StreamPostKanbanView=KanbanView.extend({icon:'fa-share-alt',config:_.extend({},KanbanView.prototype.config,{Model:StreamPostKanbanModel,Renderer:StreamPostKanbanRenderer,Controller:StreamPostKanbanController,}),getController:function(parent){var model=this.getModel(parent);var superPromise=this._super.apply(this,arguments);Promise.all([superPromise,model._refreshStreams(),model._refreshAccountsStats()]).then(function(results){var controller=results[0];var streamsNeedRefresh=results[1];var socialAccountsStats=results[2];if(streamsNeedRefresh){controller.renderer._refreshStreamsRequired();}
if(socialAccountsStats){controller.renderer._refreshStats(socialAccountsStats);}});return superPromise;},_loadData:function(model){return Promise.all([model._loadAccountsStats(),this._super.apply(this,arguments)]).then(function(results){var socialAccountsStats=results[0];const{state,handle}=results[1];if(!state.socialAccountsStats){state.socialAccountsStats=socialAccountsStats;}
return{state,handle};});},});viewRegistry.add('social_stream_post_kanban_view',StreamPostKanbanView);return StreamPostKanbanView;});;

/* /social/static/src/js/tours/social.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('social.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('social_tour',{url:"/web",rainbowManMessage:`<strong> ${_t('Congrats! Come back in a few minutes to check your statistics.')} </strong>`,},[tour.stepUtils.showAppsMenuItem(),{trigger:'.o_app[data-menu-xmlid="social.menu_social_global"]',content:_t("Let's create your own <b>social media</b> dashboard."),position:'bottom',edition:'enterprise',},{trigger:'button.o_stream_post_kanban_new_stream',content:_t("Let's <b>connect</b> to Facebook, LinkedIn or Twitter."),position:'bottom',edition:'enterprise',},{trigger:'.o_social_media_cards',content:_t("Choose which <b>account</b> you would like to link first."),position:'bottom',edition:'enterprise',},{trigger:'button.o_stream_post_kanban_new_stream',content:_t("Let's add <b>another stream</b> to get a better overview of this channel."),position:'bottom',edition:'enterprise',},{trigger:'.o_social_add_stream_accounts',content:_t("Select the <b>account</b> you just added."),position:'bottom',edition:'enterprise',},{trigger:'.o_field_widget[name="stream_type_id"]',content:_t("Choose the type of <b>stream</b> you would like to add."),position:'bottom',edition:'enterprise',},{trigger:'.modal-footer .btn-primary',content:_t("Add it to your feed."),position:'bottom',edition:'enterprise',},{trigger:'button.o_stream_post_kanban_new_post',content:_t("Let's start posting."),position:'bottom',edition:'enterprise',},{trigger:'textarea[name="message"]',content:_t("Write a message to get a preview of your post."),position:'bottom',edition:'enterprise',},{trigger:'button[name="action_post"]',extra_trigger:'textarea[name="message"]:first:propValueContains()',content:_t("Happy with the result? Let's post it!"),position:'bottom',edition:'enterprise',},]);});;

/* /survey/static/src/js/fields_section_one2many.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('survey.question_page_one2many',function(require){"use strict";var Context=require('web.Context');var FieldOne2Many=require('web.relational_fields').FieldOne2Many;var FieldRegistry=require('web.field_registry');var ListRenderer=require('web.ListRenderer');var config=require('web.config');var SectionListRenderer=ListRenderer.extend({init:function(parent,state,params){this.sectionFieldName="is_page";this._super.apply(this,arguments);},_checkIfRecordIsSection:function(id){var record=this._findRecordById(id);return record&&record.data[this.sectionFieldName];},_findRecordById:function(id){return _.find(this.state.data,function(record){return record.id===id;});},_renderBodyCell:function(record,node,index,options){var $cell=this._super.apply(this,arguments);var isSection=record.data[this.sectionFieldName];if(isSection){if(node.attrs.widget==="handle"||node.attrs.name==="random_questions_count"){return $cell;}else if(node.attrs.name==="title"){var nbrColumns=this._getNumberOfCols();if(this.handleField){nbrColumns--;}
if(this.addTrashIcon){nbrColumns--;}
if(record.data.questions_selection==="random"){nbrColumns--;}
$cell.attr('colspan',nbrColumns);}else{$cell.removeClass('o_invisible_modifier');return $cell.addClass('o_hidden');}}
return $cell;},_renderRow:function(record,index){var $row=this._super.apply(this,arguments);if(record.data[this.sectionFieldName]){$row.addClass("o_is_section");}
return $row;},_renderView:function(){var def=this._super.apply(this,arguments);var self=this;return def.then(function(){self.$('table.o_list_table').addClass('o_section_list_view');});},_onRowClicked:function(ev){var parent=this.getParent();var recordId=$(ev.currentTarget).data('id');var is_section=this._checkIfRecordIsSection(recordId);if(is_section&&parent.mode==="edit"){this.editable="bottom";}else{this.editable=null;}
this._super.apply(this,arguments);},_onCellClick:function(ev){var parent=this.getParent();var recordId=$(ev.currentTarget.parentElement).data('id');var is_section=this._checkIfRecordIsSection(recordId);if(is_section&&parent.mode==="edit"){this.editable="bottom";}else{this.editable=null;this.unselectRow();}
this._super.apply(this,arguments);},_onNavigationMove:function(ev){this.unselectRow();},});var SectionFieldOne2Many=FieldOne2Many.extend({init:function(parent,name,record,options){this._super.apply(this,arguments);this.sectionFieldName="is_page";this.rendered=false;},_getRenderer:function(){if(this.view.arch.tag==='tree'){return SectionListRenderer;}
return this._super.apply(this,arguments);},_onAddRecord:function(ev){this.editable=null;if(!config.device.isMobile){var context_str=ev.data.context&&ev.data.context[0];var context=new Context(context_str).eval();if(context['default_'+this.sectionFieldName]){this.editable="bottom";}}
this._super.apply(this,arguments);},});FieldRegistry.add('question_page_one2many',SectionFieldOne2Many);});;

/* /survey/static/src/js/fields_form_page_description.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('survey.fields_form',function(require){"use strict";var FieldRegistry=require('web.field_registry');var FieldChar=require('web.basic_fields').FieldChar;var FormDescriptionPage=FieldChar.extend({_renderEdit:function(){var def=this._super.apply(this,arguments);this.$el.addClass('col');var $inputGroup=$('<div class="input-group">');this.$el=$inputGroup.append(this.$el);var $button=$('<div class="input-group-append">\
                <button type="button" title="Open section" class="btn oe_edit_only o_icon_button">\
                    <i class="fa fa-fw o_button_icon fa-info-circle"/>\
                </button>\
            </div>');this.$el=this.$el.append($button);$button.on('click',this._onClickEdit.bind(this));return def;},_onClickEdit:function(ev){ev.stopPropagation();var id=this.record.id;if(id){this.trigger_up('open_record',{id:id,target:ev.target});}},});FieldRegistry.add('survey_description_page',FormDescriptionPage);});;

/* /sign/static/src/js/sign_backend.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sign.views_custo',function(require){'use strict';var config=require('web.config');var core=require('web.core');var KanbanController=require("web.KanbanController");var KanbanColumn=require("web.KanbanColumn");var KanbanRecord=require("web.KanbanRecord");var ListController=require("web.ListController");var utils=require('web.utils');var session=require('web.session');var _t=core._t;KanbanController.include(_make_custo("button.o-kanban-button-new"));KanbanColumn.include({init:function(){this._super.apply(this,arguments);if(this.modelName==="sign.request"){this.draggable=false;}},});KanbanRecord.include({_openRecord:function(){var self=this;if(this.modelName==='sign.template'&&this.$el.parents('.o_sign_template_kanban').length){if(config.device.isMobile){return;}
self._rpc({model:'sign.template',method:'go_to_custom_template',args:[self.recordData.id],}).then(function(action){self.do_action(action);});}else if(this.modelName==='sign.request'&&this.$el.parents('.o_sign_request_kanban').length){this._rpc({model:'sign.request',method:'go_to_document',args:[self.recordData.id],}).then(function(action){self.do_action(action);});}else{this._super.apply(this,arguments);}},async _render(){await this._super(...arguments);if(config.device.isMobile&&(this.modelName==="sign.template"||this.modelName==="sign.request")){this.$('.o_kanban_record_bottom .oe_kanban_bottom_left button:not(.o_kanban_sign_directly)').attr('data-mobile','{"fullscreen": true}');}}});ListController.include(_make_custo(".o_list_button_add"));function _make_custo(selector_button){return{renderButtons:function(){this._super.apply(this,arguments);if(!this.$buttons){return;}
if(this.modelName==="sign.template"){this._sign_upload_file_button();this.$buttons.find('button.o_button_import').hide();}else if(this.modelName==="sign.request"){if(this.$buttons){this._sign_create_request_button();this.$buttons.find('button.o_button_import').hide();}}},_sign_upload_file_button:function(){var self=this;this.$buttons.find(selector_button).text(_t('UPLOAD A PDF TO SIGN')).off("click").on("click",function(e){e.preventDefault();e.stopPropagation();_sign_upload_file.call(self,true,false,'sign_send_request');});if(config.device.isMobile){this.$buttons.find(selector_button).hide();return;}
session.user_has_group('sign.group_sign_user').then(function(has_group){if(has_group){self.$buttons.find(selector_button).after($('<button class="btn btn-link o-kanban-button-new ml8" type="button">'+_t('UPLOAD A PDF TEMPLATE')+'</button>').off('click').on('click',function(e){e.preventDefault();e.stopPropagation();_sign_upload_file.call(self,false,false,'sign_template_edit');}));}});},_sign_create_request_button:function(){var self=this;this.$buttons.find(selector_button).text(_t('UPLOAD A PDF TO SIGN')).off("click").on("click",function(e){e.preventDefault();e.stopImmediatePropagation();_sign_upload_file.call(self,true,false,'sign_send_request');});},};}
function _sign_upload_file(inactive,sign_directly_without_mail,sign_edit_context){var self=this;var sign_directly_without_mail=sign_directly_without_mail||false;var $upload_input=$('<input type="file" name="files[]" accept="application/pdf, application/x-pdf, application/vnd.cups-pdf"/>');$upload_input.on('change',function(e){var f=e.target.files[0];utils.getDataURLFromFile(f).then(function(result){var args;if(inactive){args=[f.name,result,false];}else{args=[f.name,result];}
self._rpc({model:'sign.template',method:'upload_template',args:args,}).then(function(data){self.do_action({type:"ir.actions.client",tag:'sign.Template',name:_('Template ')+' "'+f.name+'"',context:{sign_edit_call:sign_edit_context,id:data.template,sign_directly_without_mail:sign_directly_without_mail,},});}).then(function(){$upload_input.removeAttr('disabled');$upload_input.val("");}).guardedCatch(function(){$upload_input.removeAttr('disabled');$upload_input.val("");});});});$upload_input.click();}});odoo.define('sign.template',function(require){'use strict';var AbstractAction=require('web.AbstractAction');var config=require('web.config');var core=require('web.core');var Dialog=require('web.Dialog');var framework=require('web.framework');var session=require('web.session');var Widget=require('web.Widget');var PDFIframe=require('sign.PDFIframe');var sign_utils=require('sign.utils');var StandaloneFieldManagerMixin=require('web.StandaloneFieldManagerMixin');var FormFieldMany2ManyTags=require('web.relational_fields').FormFieldMany2ManyTags;const SmoothScrollOnDrag=require('web/static/src/js/core/smooth_scroll_on_drag.js');var FormFieldSelection=require('web.relational_fields').FieldSelection;var _t=core._t;var SignItemCustomPopover=Widget.extend({template:'sign.sign_item_custom_popover',events:{'click .o_sign_delete_field_button':function(e){this.$currentTarget.popover("hide");this.$currentTarget.trigger('itemDelete');},'click .o_sign_validate_field_button':function(e){this.hide();}},init:function(parent,parties,options,select_options){options=options||{};this._super(parent,options);this.parties=parties;this.select_options=select_options;this.debug=config.isDebug();},start:function(){this.$responsibleSelect=this.$('.o_sign_responsible_select');this.$optionsSelect=this.$('.o_sign_options_select');sign_utils.resetResponsibleSelectConfiguration();sign_utils.resetOptionsSelectConfiguration();var self=this;return this._super().then(function(){sign_utils.setAsResponsibleSelect(self.$responsibleSelect.find('select'),self.$currentTarget.data('responsible'),self.parties);sign_utils.setAsOptionsSelect(self.$optionsSelect.find('input'),self.$currentTarget.data('itemId'),self.$currentTarget.data('option_ids'),self.select_options);self.$('input[type="checkbox"]').prop('checked',self.$currentTarget.data('required'));self.$('#o_sign_name').val(self.$currentTarget.data('name'));self.title=self.$currentTarget.prop('field-name');if(self.$currentTarget.prop('field-type')!=='selection'){self.$('.o_sign_options_group').hide();}});},create:function($targetEl){var self=this;this.$currentTarget=$targetEl;this.$elPopover=$("<div class='o_sign_item_popover'/>");var buttonClose='<button class="o_sign_close_button">&times;</button>';this.appendTo(this.$elPopover).then(function(){var options={title:self.title+buttonClose,content:function(){return self.$el;},html:true,placement:'right',trigger:'focus',};self.$currentTarget.popover(options).one('inserted.bs.popover',function(e){$('.popover').addClass('o_popover_offset');$('.o_sign_close_button').on('click',function(e){self.$currentTarget.popover("hide");});});self.$currentTarget.popover("toggle");if(self.$currentTarget.prop('field-type')==='checkbox'){$('.o_popover_placeholder').text('');}});},hide:function(){var self=this;var resp=parseInt(this.$responsibleSelect.find('select').val());var selected_options=this.$optionsSelect.find('#o_sign_options_select_input').data('item_options');var required=this.$('input[type="checkbox"]').prop('checked');var name=this.$('#o_sign_name').val();this.getParent().currentRole=resp;if(!name){name=self.$currentTarget.prop('field-name');}
if(self.$currentTarget.prop('field-type')!="checkbox"){this.$currentTarget.find(".o_placeholder").text(name);}
this.$currentTarget.data({responsible:resp,required:required,name:name,option_ids:selected_options}).trigger('itemChange');this.$currentTarget.popover("hide");}});var InitialAllPagesDialog=Dialog.extend({template:'sign.initial_all_pages_dialog',init:function(parent,parties,options){options=options||{};options.title=options.title||_t("Add Initials");options.size=options.size||"medium";if(!options.buttons){options.buttons=[];options.buttons.push({text:_t('Add once'),classes:'btn-primary',close:true,click:function(e){this.updateTargetResponsible();this.$currentTarget.trigger('itemChange');}});options.buttons.push({text:_t('Add on all pages'),classes:'btn-secondary',close:true,click:function(e){this.updateTargetResponsible();this.$currentTarget.draggable('destroy').resizable('destroy');this.$currentTarget.trigger('itemClone');}});}
this._super(parent,options);this.parties=parties;},start:function(){this.$responsibleSelect=this.$('.o_sign_responsible_select_initials');var self=this;return this._super.apply(this,arguments).then(function(){sign_utils.setAsResponsibleSelect(self.$responsibleSelect.find('select'),self.getParent().currentRole,self.parties);});},open:function($signatureItem){this.$currentTarget=$signatureItem;this._super.apply(this,arguments);},updateTargetResponsible:function(){var resp=parseInt(this.$responsibleSelect.find('select').val());this.getParent().currentRole=resp;this.$currentTarget.data('responsible',resp);},});var EditablePDFIframe=PDFIframe.extend({init:function(){this._super.apply(this,arguments);if(this.editMode){document.body.classList.add('o_block_scroll');}
this.customPopovers={};this.events=_.extend(this.events||{},{'itemChange .o_sign_sign_item':function(e){this.updateSignItem($(e.target));this.$iframe.trigger('templateChange');},'itemDelete .o_sign_sign_item':function(e){this.deleteSignItem($(e.target));this.$iframe.trigger('templateChange');},'itemClone .o_sign_sign_item':function(e){var $target=$(e.target);this.updateSignItem($target);page_loop:for(var i=1;i<=this.nbPages;i++){for(var j=0;j<this.configuration[i].length;j++){if(this.types[this.configuration[i][j].data('type')].item_type==='signature'){continue page_loop;}}
var $newElem=$target.clone(true);this.enableCustom($newElem);this.configuration[i].push($newElem);}
this.deleteSignItem($target);this.refreshSignItems();this.$iframe.trigger('templateChange');},});},destroy:function(){this._super(...arguments);if(this.editMode){document.body.classList.remove('o_block_scroll');}},doPDFPostLoad:function(){var self=this;this.fullyLoaded.then(function(){if(self.editMode){if(self.$iframe.prop('disabled')){var $div=$('<div/>').css({position:"absolute",top:0,left:0,width:"100%",height:"100%",'z-index':110,opacity:0.75});self.$('#viewer').css('position','relative').prepend($div);$div.on('click mousedown mouseup mouveover mouseout',function(e){return false;});}else{var rotateText=_t("Rotate Clockwise");var rotateButton=$("<button id='rotateCw' class='toolbarButton o_sign_rotate rotateCw' title='"+rotateText+"'/>");rotateButton.insertBefore(self.$('#print'));rotateButton.on('click',function(e){rotateButton.prepend('<i class="fa fa-spin fa-spinner"/>');rotateButton.attr('disabled',true);self._rotateDocument();});self.$hBarTop=$('<div/>');self.$hBarBottom=$('<div/>');self.$hBarTop.add(self.$hBarBottom).css({position:'fixed',"border-top":"1px dashed orange",width:"100%",height:0,"z-index":103,left:0});self.$vBarLeft=$('<div/>');self.$vBarRight=$('<div/>');self.$vBarLeft.add(self.$vBarRight).css({position:'fixed',"border-left":"1px dashed orange",width:0,height:"100%","z-index":103,top:0});var typesArr=_.toArray(self.types);var $fieldTypeButtons=$(core.qweb.render('sign.type_buttons',{sign_item_types:typesArr}));self.$fieldTypeToolbar=$('<div/>').addClass('o_sign_field_type_toolbar d-flex flex-column');self.$fieldTypeToolbar.prependTo(self.$('body'));self.$('#outerContainer').addClass('o_sign_field_type_toolbar_visible');const smoothScrollOptions={scrollBoundaries:{right:false,left:false},jQueryDraggableOptions:{cancel:false,distance:0,cursorAt:{top:5,left:5},helper:function(e){var type=self.types[$(this).data('item-type-id')];var $signatureItem=self.createSignItem(type,true,self.currentRole,0,0,type.default_width,type.default_height,'',[]);if(!e.ctrlKey){self.$('.o_sign_sign_item').removeClass('ui-selected');}
$signatureItem.addClass('o_sign_sign_item_to_add ui-selected');self.$('.page').first().append($signatureItem);self.updateSignItem($signatureItem);$signatureItem.css('width',$signatureItem.css('width')).css('height',$signatureItem.css('height'));self.updateSignItemFontSize($signatureItem,self.normalSize());$signatureItem.detach();return $signatureItem;}}};self.buttonsDraggableComponent=new SmoothScrollOnDrag(this,$fieldTypeButtons.appendTo(self.$fieldTypeToolbar).filter('button'),self.$('#viewerContainer'),smoothScrollOptions);$fieldTypeButtons.each(function(i,el){self.enableCustomBar($(el));});self.$('.page').droppable({accept:'*',tolerance:'touch',drop:function(e,ui){if(!ui.helper.hasClass('o_sign_sign_item_to_add')){return true;}
var $parent=$(e.target);const pageNo=parseInt($parent.data('page-number'));ui.helper.removeClass('o_sign_sign_item_to_add');var $signatureItem=ui.helper.clone(true).removeClass().addClass('o_sign_sign_item o_sign_sign_item_required');var posX=(ui.offset.left-$parent.find('.textLayer').offset().left)/$parent.innerWidth();var posY=(ui.offset.top-$parent.find('.textLayer').offset().top)/$parent.innerHeight();$signatureItem.data({posx:posX,posy:posY});self.configuration[pageNo].push($signatureItem);self.refreshSignItems();self.updateSignItem($signatureItem);self.enableCustom($signatureItem);self.$iframe.trigger('templateChange');if(self.types[$signatureItem.data('type')].item_type==='initial'){(new InitialAllPagesDialog(self,self.parties)).open($signatureItem);}
return false;}});self.$('#viewer').selectable({appendTo:self.$('body'),filter:'.o_sign_sign_item',});$(document).add(self.$el).on('keyup',function(e){if(e.which!==46){return true;}
self.$('.ui-selected').each(function(i,el){self.deleteSignItem($(el));var popovers=window.document.querySelectorAll('[id^="popover"]');for(let i=0;i<popovers.length;i+=1){document.getElementById(popovers[i].id).remove();}});self.$iframe.trigger('templateChange');});}
self.$('.o_sign_sign_item').each(function(i,el){self.enableCustom($(el));});}});this._super.apply(this,arguments);},enableCustom:function($signatureItem){var self=this;$signatureItem.prop('field-type',this.types[$signatureItem.data('type')].item_type);$signatureItem.prop('field-name',this.types[$signatureItem.data('type')].name);var itemId=$signatureItem.data('itemId');var $configArea=$signatureItem.find('.o_sign_config_area');$configArea.find('.o_sign_item_display').off('mousedown').on('mousedown',function(e){e.stopPropagation();self.$('.ui-selected').removeClass('ui-selected');$signatureItem.addClass('ui-selected');_.each(_.keys(self.customPopovers),function(keyId){if(keyId!=itemId&&self.customPopovers[keyId]&&((keyId&&itemId)||(keyId!='undefined'&&!itemId))){self.customPopovers[keyId].$currentTarget.popover('hide');self.customPopovers[keyId]=false;}});if(self.customPopovers[itemId]){self.customPopovers[itemId].$currentTarget.popover('hide');self.customPopovers[itemId]=false;}else{self.customPopovers[itemId]=new SignItemCustomPopover(self,self.parties,{'field_name':$signatureItem[0]['field-name'],'field_type':$signatureItem[0]['field-type']},self.select_options);self.customPopovers[itemId].create($signatureItem);}});$configArea.find('.fa.fa-arrows').off('mouseup').on('mouseup',function(e){if(!e.ctrlKey){self.$('.o_sign_sign_item').filter(function(i){return(this!==$signatureItem[0]);}).removeClass('ui-selected');}
$signatureItem.toggleClass('ui-selected');});const smoothScrollOptions={scrollBoundaries:{right:false,left:false},jQueryDraggableOptions:{containment:"parent",distance:0,handle:".fa-arrows",scroll:false,}};this.signItemsDraggableComponent=new SmoothScrollOnDrag(this,$signatureItem,self.$('#viewerContainer'),smoothScrollOptions);$signatureItem.resizable({containment:"parent"}).css('position','absolute');$signatureItem.off('dragstart resizestart').on('dragstart resizestart',function(e,ui){if(!e.ctrlKey){self.$('.o_sign_sign_item').removeClass('ui-selected');}
$signatureItem.addClass('ui-selected');});$signatureItem.off('dragstop').on('dragstop',function(e,ui){$signatureItem.data({posx:Math.round((ui.position.left/$signatureItem.parent().innerWidth())*1000)/1000,posy:Math.round((ui.position.top/$signatureItem.parent().innerHeight())*1000)/1000,});});$signatureItem.off('resizestop').on('resizestop',function(e,ui){$signatureItem.data({width:Math.round(ui.size.width/$signatureItem.parent().innerWidth()*1000)/1000,height:Math.round(ui.size.height/$signatureItem.parent().innerHeight()*1000)/1000,});});$signatureItem.on('dragstop resizestop',function(e,ui){self.updateSignItem($signatureItem);self.$iframe.trigger('templateChange');$signatureItem.removeClass('ui-selected');});this.enableCustomBar($signatureItem);},enableCustomBar:function($item){var self=this;$item.on('dragstart resizestart',function(e,ui){var $target=$(e.target);if(!$target.hasClass('ui-draggable')&&!$target.hasClass('ui-resizable')){return;}
start.call(self,ui.helper);});$item.find('.o_sign_config_area .fa.fa-arrows').on('mousedown',function(e){start.call(self,$item);process.call(self,$item);});$item.on('drag resize',function(e,ui){var $target=$(e.target);if(!$target.hasClass('ui-draggable')&&!$target.hasClass('ui-resizable')){return;}
process.call(self,ui.helper);});$item.on('dragstop resizestop',function(e,ui){end.call(self);});$item.find('.o_sign_config_area .fa.fa-arrows').on('mouseup',function(e){end.call(self);});function start($helper){this.$hBarTop.detach().insertAfter($helper).show();this.$hBarBottom.detach().insertAfter($helper).show();this.$vBarLeft.detach().insertAfter($helper).show();this.$vBarRight.detach().insertAfter($helper).show();}
function process($helper){const helperBoundingClientRect=$helper.get(0).getBoundingClientRect();this.$hBarTop.css('top',helperBoundingClientRect.top);this.$hBarBottom.css('top',helperBoundingClientRect.top+parseFloat($helper.css('height'))-1);this.$vBarLeft.css('left',helperBoundingClientRect.left);this.$vBarRight.css('left',helperBoundingClientRect.left+parseFloat($helper.css('width'))-1);}
function end(){this.$hBarTop.hide();this.$hBarBottom.hide();this.$vBarLeft.hide();this.$vBarRight.hide();}},updateSignItem:function($signatureItem){this._super.apply(this,arguments);if(this.editMode){var responsibleName=this.parties[$signatureItem.data('responsible')].name;$signatureItem.find('.o_sign_responsible_display').text(responsibleName).prop('title',responsibleName);var option_ids=$signatureItem.data('option_ids')||[];var $options_display=$signatureItem.find('.o_sign_select_options_display');this.display_select_options($options_display,this.select_options,option_ids);}},_rotateDocument:function(){var self=this;this._rpc({model:'sign.template',method:'rotate_pdf',args:[this.getParent().templateID],}).then(function(response){if(response){self.$('#pageRotateCw').click();self.$('#rotateCw').text('');self.$('#rotateCw').attr('disabled',false);self.refreshSignItems();}else{Dialog.alert(self,_t('Somebody is already filling a document which uses this template'),{confirm_callback:function(){self.getParent().go_back_to_kanban();},});}});},});var Template=AbstractAction.extend(StandaloneFieldManagerMixin,{hasControlPanel:true,events:{'click .fa-pencil':function(e){this.$templateNameInput.focus().select();},'input .o_sign_template_name_input':function(e){this.$templateNameInput.attr('size',this.$templateNameInput.val().length+1);},'change .o_sign_template_name_input':function(e){this.saveTemplate();if(this.$templateNameInput.val()===""){this.$templateNameInput.val(this.initialTemplateName);}},'keydown .o_sign_template_name_input':function(e){if(e.keyCode===13){this.$templateNameInput.blur();}},'templateChange iframe.o_sign_pdf_iframe':function(e){this.saveTemplate();},'click .o_sign_template_send':function(e){this.do_action('sign.action_sign_send_request',{additional_context:{'active_id':this.templateID,'sign_directly_without_mail':false,},});},'click .o_sign_template_sign_now':function(e){this.do_action('sign.action_sign_send_request',{additional_context:{'active_id':this.templateID,'sign_directly_without_mail':true,},});},'click .o_sign_template_share':function(e){this.do_action('sign.action_sign_template_share',{additional_context:{active_id:this.templateID,},});},'click .o_sign_template_save':function(e){return this.do_action('sign.sign_template_action',{clear_breadcrumbs:true});},'click .o_sign_template_duplicate':function(e){this.saveTemplate(true);},},custom_events:Object.assign({},StandaloneFieldManagerMixin.custom_events,{field_changed:'_onFieldChanged',}),go_back_to_kanban:function(){return this.do_action("sign.sign_template_action",{clear_breadcrumbs:true,});},init:function(parent,options){this._super.apply(this,arguments);StandaloneFieldManagerMixin.init.call(this);if(options.context.id===undefined){return;}
this.templateID=options.context.id;this.actionType=options.context.sign_edit_call?options.context.sign_edit_call:'';this.rolesToChoose={};},renderButtons:function(){this.$buttons=$(core.qweb.render("sign.template_cp_buttons",{'widget':this,'action_type':this.actionType}));},willStart:function(){if(this.templateID===undefined){return this._super.apply(this,arguments);}
return Promise.all([this._super(),this.perform_rpc()]);},createTemplateTagsField:function(){var self=this;var params={modelName:'sign.template',res_id:self.templateID,fields:{id:{type:'integer',},name:{type:'char',},tag_ids:{relation:'sign.template.tag',type:'many2many',relatedFields:{id:{type:'integer',},display_name:{type:'char',},color:{type:'integer',}},fields:{id:{type:'integer',},display_name:{type:'char',},color:{type:'integer',}},},group_ids:{relation:'res.groups',type:'many2many',relatedFields:{id:{type:'integer',},display_name:{type:'char',},color:{type:'integer',}},fields:{id:{type:'integer',},display_name:{type:'char',},color:{type:'integer',}},},privacy:{type:'selection',selection:[['employee','All Users'],['invite','On Invitation']]}},fieldsInfo:{default:{id:{type:'integer',},name:{type:'char',},tag_ids:{relatedFields:{id:{type:'integer',},display_name:{type:'char',},color:{type:'integer',}},fieldsInfo:{default:{id:{type:'integer',},display_name:{type:'char',},color:{type:'integer',}}},viewType:'default'},group_ids:{relatedFields:{id:{type:'integer',},display_name:{type:'char',},color:{type:'integer',}},fieldsInfo:{default:{id:{type:'integer',},display_name:{type:'char',},color:{type:'integer',}}},viewType:'default'},privacy:{relatedFields:{id:{type:'selection',},display_name:{type:'char',}},fieldsInfo:{default:{id:{type:'selection',},display_name:{type:'char',}}},viewType:'default'}},},};return this.model.load(params).then(function(recordId){self.handleRecordId=recordId;self.record=self.model.get(self.handleRecordId);self.tag_idsMany2Many=new FormFieldMany2ManyTags(self,'tag_ids',self.record,{mode:'edit',create:true,attrs:{options:{color_field:'color'}}});self._registerWidget(self.handleRecordId,'tag_ids',self.tag_idsMany2Many);self.tag_idsMany2Many.appendTo(self.$('.o_sign_template_tags'));if(config.isDebug()){self.privacy=new FormFieldSelection(self,'privacy',self.record,{mode:'edit'});self._registerWidget(self.handleRecordId,'privacy',self.privacy);self.privacy.appendTo(self.$('.o_sign_template_privacy'));self.group_idsMany2many=new FormFieldMany2ManyTags(self,'group_ids',self.record,{mode:'edit',create:false,attrs:{options:{color_field:'color'}}});self._registerWidget(self.handleRecordId,'group_ids',self.group_idsMany2many);self.group_idsMany2many.appendTo(self.$('.o_sign_template_group_id'));}});},_onFieldChanged:function(event){var self=this;var $majInfo=this.$(event.target.$el).parent().next('.o_sign_template_saved_info');StandaloneFieldManagerMixin._onFieldChanged.apply(this,arguments);this.model.save(this.handleRecordId,{reload:true}).then(function(fieldNames){self.record=self.model.get(self.handleRecordId);self.tag_idsMany2Many.reset(self.record);$majInfo.stop().css('opacity',1).animate({'opacity':0},1500);});},perform_rpc:function(){var self=this;var defTemplates=this._rpc({model:'sign.template',method:'read',args:[[this.templateID]],}).then(function prepare_template(template){if(template.length===0){self.templateID=undefined;self.do_notify(_t("Warning"),_t("The template doesn't exist anymore."));return Promise.resolve();}
template=template[0];self.sign_template=template;self.has_sign_requests=(template.sign_request_ids.length>0);var defSignItems=self._rpc({model:'sign.item',method:'search_read',args:[[['template_id','=',template.id]]],kwargs:{context:session.user_context},}).then(function(sign_items){self.sign_items=sign_items;return self._rpc({model:'sign.item.option',method:'search_read',args:[[],['id','value']],kwargs:{context:session.user_context},});});var defIrAttachments=self._rpc({model:'ir.attachment',method:'read',args:[[template.attachment_id[0]],['mimetype','name']],kwargs:{context:session.user_context},}).then(function(attachment){attachment=attachment[0];self.sign_template.attachment_id=attachment;self.isPDF=(attachment.mimetype.indexOf('pdf')>-1);});return Promise.all([defSignItems,defIrAttachments]);});var defSelectOptions=this._rpc({model:'sign.item.option',method:'search_read',args:[[]],kwargs:{context:session.user_context},}).then(function(options){self.sign_item_options=options;});var defParties=this._rpc({model:'sign.item.role',method:'search_read',kwargs:{context:session.user_context},}).then(function(parties){self.sign_item_parties=parties;});var defItemTypes=this._rpc({model:'sign.item.type',method:'search_read',kwargs:{context:session.user_context},}).then(function(types){self.sign_item_types=types;});return Promise.all([defTemplates,defParties,defItemTypes,defSelectOptions]);},start:function(){var self=this;if(this.templateID===undefined){return this.go_back_to_kanban();}
return this._super().then(function(){self.renderButtons();var status={cp_content:{$buttons:self.$buttons},};return self.updateControlPanel(status);}).then(function(){self.initialize_content();self.createTemplateTagsField();if(self.$('iframe').length){core.bus.on('DOM_updated',self,init_iframe);}
$('body').on('click',function(e){$('div.popover').each(function(){if(!$(self).is(e.target)&&$(self).has(e.target).length===0&&$('.popover').has(e.target).length===0){$(self).find('.o_sign_validate_field_button').click();}});});self.$('.o_content').addClass('o_sign_template');});function init_iframe(){if(this.$el.parents('html').length&&!this.$el.parents('html').find('.modal-dialog').length){var self=this;framework.blockUI({overlayCSS:{opacity:0},blockMsgClass:'o_hidden'});this.iframeWidget=new EditablePDFIframe(this,'/web/content/'+this.sign_template.attachment_id.id,true,{parties:this.sign_item_parties,types:this.sign_item_types,signatureItems:this.sign_items,select_options:this.sign_item_options,});return this.iframeWidget.attachTo(this.$('iframe')).then(function(){framework.unblockUI();self.iframeWidget.currentRole=self.sign_item_parties[0].id;});}}},initialize_content:function(){this.$('.o_content').empty();this.debug=config.isDebug();this.$('.o_content').append(core.qweb.render('sign.template',{widget:this}));this.$('iframe,.o_sign_template_name_input').prop('disabled',this.has_sign_requests);this.$templateNameInput=this.$('.o_sign_template_name_input').first();this.$templateNameInput.trigger('input');this.initialTemplateName=this.$templateNameInput.val();},do_show:function(){this._super();var self=this;return this.perform_rpc().then(function(){if(self.iframeWidget){self.iframeWidget.destroy();self.iframeWidget=undefined;}
self.$('iframe').remove();self.initialize_content();});},prepareTemplateData:function(){this.rolesToChoose={};var data={},newId=0;var configuration=(this.iframeWidget)?this.iframeWidget.configuration:{};for(var page in configuration){for(var i=0;i<configuration[page].length;i++){var id=configuration[page][i].data('item-id')||(newId--);var resp=configuration[page][i].data('responsible');data[id]={'type_id':configuration[page][i].data('type'),'required':configuration[page][i].data('required'),'name':configuration[page][i].data('name'),'option_ids':configuration[page][i].data('option_ids'),'responsible_id':resp,'page':page,'posX':configuration[page][i].data('posx'),'posY':configuration[page][i].data('posy'),'width':configuration[page][i].data('width'),'height':configuration[page][i].data('height'),};this.rolesToChoose[resp]=this.iframeWidget.parties[resp];}}
return data;},saveTemplate:function(duplicate){duplicate=(duplicate===undefined)?false:duplicate;var data=this.prepareTemplateData();var $majInfo=this.$('.o_sign_template_saved_info').first();var self=this;this._rpc({model:'sign.template',method:'update_from_pdfviewer',args:[this.templateID,!!duplicate,data,this.$templateNameInput.val()||this.initialTemplateName],}).then(function(templateID){if(!templateID){Dialog.alert(self,_t('Somebody is already filling a document which uses this template'),{confirm_callback:function(){self.go_back_to_kanban();},});}
if(duplicate){self.do_action({type:"ir.actions.client",tag:'sign.Template',name:_t("Duplicated Template"),context:{id:templateID,},});}else{$majInfo.stop().css('opacity',1).animate({'opacity':0},1500);}});},});core.action_registry.add('sign.Template',Template);});odoo.define('sign.DocumentBackend',function(require){'use strict';var AbstractAction=require('web.AbstractAction');var core=require('web.core');var Document=require('sign.Document');var framework=require('web.framework');var _t=core._t;var DocumentBackend=AbstractAction.extend({hasControlPanel:true,destroy:function(){core.bus.off('DOM_updated',this,this._init_page);return this._super.apply(this,arguments);},go_back_to_kanban:function(){return this.do_action("sign.sign_request_action",{clear_breadcrumbs:true,});},init:function(parent,action){this._super.apply(this,arguments);var context=action.context;if(context.id===undefined){return;}
this.documentID=context.id;this.token=context.token;this.create_uid=context.create_uid;this.state=context.state;this.current_name=context.current_signor_name;this.token_list=context.token_list;this.name_list=context.name_list;this.cp_content={};},_init_page:function(){var self=this;if(this.$el.parents('html').length){return this.refresh_cp().then(function(){framework.blockUI({overlayCSS:{opacity:0},blockMsgClass:'o_hidden'});if(!self.documentPage){self.documentPage=new(self.get_document_class())(self);return self.documentPage.attachTo(self.$el);}else{return self.documentPage.initialize_iframe();}}).then(function(){framework.unblockUI();});}},start:function(){var self=this;if(this.documentID===undefined){return this.go_back_to_kanban();}
var def=this._rpc({route:'/sign/get_document/'+this.documentID+'/'+this.token,params:{message:this.message}}).then(function(html){var $html=$(html.trim());var $signDocumentButton=$html.find('.o_sign_sign_document_button').detach();self.$('.o_content').append($html);self.$('.o_content').addClass('o_sign_document');var $cols=self.$('.col-lg-4');var $buttonsContainer=$cols.first().remove();$cols.eq(1).toggleClass('col-lg-3 col-lg-4');$cols.eq(2).toggleClass('col-lg-9 col-lg-4');var url=$buttonsContainer.find('.o_sign_download_document_button').attr('href');var logUrl=$buttonsContainer.find('.o_sign_download_log_button').attr('href');self.$buttons=(self.cp_content&&self.cp_content.$buttons&&self.cp_content.$buttons.length)?self.cp_content.$buttons:$('');if(url){self.$downloadButton=$('<a/>',{html:_t("Download Document")}).addClass('btn btn-primary mr-2');self.$downloadButton.attr('href',url);self.$buttons=self.$buttons.add(self.$downloadButton);}
if(logUrl){self.$downloadLogButton=$('<a/>',{html:_t("Certificate")}).addClass(url?'btn btn-secondary':'btn btn-primary');self.$downloadLogButton.attr('href',logUrl);self.$buttons=self.$buttons.add(self.$downloadLogButton);}
if($signDocumentButton)
self.$buttons=$signDocumentButton.add(self.$buttons);if(self.$buttons.length){self.cp_content={$buttons:self.$buttons};}
core.bus.on('DOM_updated',self,self._init_page);});return Promise.all([this._super(),def]);},get_document_class:function(){return Document;},refresh_cp:function(){return this.updateControlPanel({cp_content:this.cp_content,});},});return DocumentBackend;});odoo.define('sign.document_edition',function(require){'use strict';var core=require('web.core');var session=require('web.session');var DocumentBackend=require('sign.DocumentBackend');var _t=core._t;var EditableDocumentBackend=DocumentBackend.extend({events:{'click .o_sign_resend_access_button':function(e){var $envelope=$(e.target);this._rpc({model:'sign.request.item',method:'resend_access',args:[parseInt($envelope.parent('.o_sign_signer_status').data('id'))],}).then(function(){$envelope.html(_t("Resent !"));});},},init:function(parent,action,options){this._super.apply(this,arguments);var self=this;this.is_author=(this.create_uid===session.uid);this.is_sent=(this.state==='sent');if(action&&action.context&&action.context.sign_token){var $signButton=$('<button/>',{html:_t("Sign Document"),type:"button",'class':'btn btn-primary mr-2'});$signButton.on('click',function(){self.do_action({type:"ir.actions.client",tag:'sign.SignableDocument',name:_t('Sign'),},{additional_context:_.extend({},action.context,{token:action.context.sign_token,}),});});if(this.cp_content){this.cp_content.$buttons=$signButton.add(this.cp_content.$buttons);}}},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){if(self.is_author&&self.is_sent){self.$('.o_sign_signer_status').not('.o_sign_signer_signed').each(function(i,el){$(el).append($('<button/>',{type:'button',title:_t("Resend the invitation"),text:_t('Resend'),class:'o_sign_resend_access_button btn btn-link ml-2 mr-2',style:'vertical-align: baseline;',}));});}});},});core.action_registry.add('sign.Document',EditableDocumentBackend);});odoo.define('sign.document_signing_backend',function(require){'use strict';var core=require('web.core');var DocumentBackend=require('sign.DocumentBackend');var document_signing=require('sign.document_signing');var _t=core._t;var NoPubThankYouDialog=document_signing.ThankYouDialog.extend({template:"sign.no_pub_thank_you_dialog",init:function(parent,RedirectURL,RedirectURLText,requestID,options){options=(options||{});if(!options.buttons){options.buttons=[{text:_t("Ok"),close:true}];}
this._super(parent,RedirectURL,RedirectURLText,requestID,options);},on_closed:function(){var self=this;self._rpc({model:'sign.request',method:'go_to_document',args:[self.requestID],}).then(function(action){self.do_action(action);self.destroy();});},});var SignableDocument2=document_signing.SignableDocument.extend({get_thankyoudialog_class:function(){return NoPubThankYouDialog;},});var SignableDocumentBackend=DocumentBackend.extend({get_document_class:function(){return SignableDocument2;},});core.action_registry.add('sign.SignableDocument',SignableDocumentBackend);});;

/* /sign/static/src/js/tours/sign.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sign.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('sign_tour',{url:"/web",rainbowManMessage:"<b>Congratulations</b>, your first document is fully signed!",},[tour.stepUtils.showAppsMenuItem(),{trigger:'.o_app[data-menu-xmlid="sign.menu_document"]',content:_t("Let's <b>prepare & sign</b> our first document."),position:'bottom',edition:'enterprise'},{trigger:'.o_nocontent_help p a:contains("'+_t('start with our sample template')+'")',content:_t("Try out this sample contract."),position:"bottom",},{trigger:'iframe .o_sign_field_type_toolbar .o_sign_field_type_button:contains("'+_t('Name')+'")',content:_t("<b>Drag & drop Name</b> into the document."),position:"right",},{trigger:'iframe .o_sign_field_type_toolbar .o_sign_field_type_button:contains("'+_t('Date')+'")',content:_t("<b>Drag & drop Date</b> into the document."),position:"right",},{trigger:'iframe .o_sign_field_type_toolbar .o_sign_field_type_button:contains("'+_t('Signature')+'")',content:_t("And finally, <b>drag & drop Signature</b> into the bottom of the document."),position:"right",},{trigger:'.o_control_panel .o_sign_template_sign_now',content:_t("Well done, your document is ready!<br>Let's sign it directly."),position:"bottom",},{trigger:'.modal-dialog button[name="sign_directly_without_mail"]',content:_t("Ok, lets sign the document now."),position:"bottom",},{trigger:'iframe .o_sign_sign_item_navigator',content:_t("Go to the first area you have to fill in."),position:"bottom",},{trigger:'iframe .o_sign_sign_item_navigator',alt_trigger:"iframe .o_sign_sign_item[placeholder='"+_t("Date")+"']",content:_t("Your name has been auto-completed. Lets continue!"),position:"bottom",},{trigger:'iframe .o_sign_sign_item_navigator',content:_t("Lets sign the document!"),position:"bottom",},{trigger:'iframe .o_sign_sign_item_navigator',alt_trigger:'iframe .o_sign_sign_item[data-signature]',content:_t("Draw your most beautiful signature!<br>You can also create one automatically or load a signature from your computer."),position:"bottom",},{trigger:'.modal-dialog button:contains("'+_t('Adopt and Sign')+'")',content:_t("Confirm and continue."),position:"bottom",},{trigger:'.o_sign_validate_banner button.o_validate_button',content:_t("Great, the document is signed!<br>Lets validate it."),position:"top",},{trigger:'.modal-dialog button:contains("'+_t('View Document')+'")',content:_t("Let's view the document you have just signed!"),position:"bottom",},]);});;

/* /social_facebook/static/src/js/stream_post_facebook_comments.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('social.social_facebook_post_kanban_comments',function(require){var core=require('web.core');var _t=core._t;var QWeb=core.qweb;var StreamPostComments=require('social.social_post_kanban_comments');var StreamPostFacebookComments=StreamPostComments.extend({init:function(parent,options){this.options=_.defaults(options||{},{title:_t('Facebook Comments'),commentName:_t('comment/reply')});this.accountId=options.accountId;this.totalLoadedComments=options.comments.length;this.nextRecordsToken=options.nextRecordsToken;this.summary=options.summary;this.mediaType='facebook';this._super.apply(this,arguments);},willStart:function(){var self=this;var superDef=this._super.apply(this,arguments);var pageInfoDef=this._rpc({model:'social.account',method:'read',args:[this.accountId,['name','facebook_account_id']],}).then(function(result){self.accountName=result[0].name;self.pageFacebookId=result[0].facebook_account_id;return Promise.resolve();});return Promise.all([superDef,pageInfoDef]);},getAuthorPictureSrc:function(comment){if(comment){if(comment.from&&comment.from.picture){return comment.from.picture.data.url;}else{return"/web/static/src/img/user_placeholder.jpg";}}else{return _.str.sprintf("https://graph.facebook.com/v3.3/%s/picture?height=48&width=48",this.pageFacebookId);}},getCommentLink:function(comment){return _.str.sprintf("https://www.facebook.com/%s",comment.id);},getAuthorLink:function(comment){if(comment.from.id){return _.str.sprintf("/social_facebook/redirect_to_profile/%s/%s?name=%s",this.accountId,comment.from.id,encodeURI(comment.from.name));}else{return"#";}},isCommentDeletable:function(comment){return comment.from.id===this.pageFacebookId;},isCommentEditable:function(comment){return comment.from.id===this.pageFacebookId;},getAddCommentEndpoint:function(){return'/social_facebook/comment';},getDeleteCommentEndpoint:function(){return'delete_facebook_comment';},showMoreComments:function(result){return this.totalLoadedComments<this.summary.total_count;},_onLikeComment:function(ev){ev.preventDefault();var $target=$(ev.currentTarget);var userLikes=$target.data('userLikes');this._rpc({model:'social.stream.post',method:'like_facebook_comment',args:[[this.postId],$target.data('commentId'),!userLikes]});$target.toggleClass('o_social_comment_user_likes');this._updateLikesCount($target);},_onLoadMoreComments:function(ev){var self=this;ev.preventDefault();this._rpc({model:'social.stream.post',method:'get_facebook_comments',args:[[this.postId],this.nextRecordsToken]}).then(function(result){var $moreComments=$(QWeb.render("social.StreamPostCommentsWrapper",{widget:self,comments:result.comments}));self.$('.o_social_comments_messages').append($moreComments);self.totalLoadedComments+=result.comments.length;if(self.totalLoadedComments>=self.summary.total_count){self.$('.o_social_load_more_comments').hide();}
self.nextRecordsToken=result.nextRecordsToken;});}});return StreamPostFacebookComments;});;

/* /social_facebook/static/src/js/stream_post_kanban_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('social_facebook.social_stream_post_kanban_controller',function(require){"use strict";var StreamPostKanbanController=require('social.social_stream_post_kanban_controller');var StreamPostFacebookComments=require('social.social_facebook_post_kanban_comments');StreamPostKanbanController.include({events:_.extend({},StreamPostKanbanController.prototype.events,{'click .o_social_facebook_comments':'_onFacebookCommentsClick','click .o_social_facebook_likes':'_onFacebookPostLike',}),_onFacebookCommentsClick:function(ev){var self=this;var $target=$(ev.currentTarget);var postId=$target.data('postId');this._rpc({model:'social.stream.post',method:'get_facebook_comments',args:[[postId]]}).then(function(result){new StreamPostFacebookComments(self,{postId:postId,accountId:$target.data('facebookPageId'),originalPost:$target.data(),comments:result.comments,summary:result.summary,nextRecordsToken:result.nextRecordsToken}).open();});},_onFacebookPostLike:function(ev){ev.preventDefault();var $target=$(ev.currentTarget);var userLikes=$target.data('userLikes');this._rpc({model:'social.stream.post',method:'like_facebook_post',args:[[$target.data('postId')],!userLikes]});this._updateLikesCount($target);$target.toggleClass('o_social_facebook_user_likes');},});return StreamPostKanbanController;});;

/* /social_linkedin/static/src/js/stream_post_kanban_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('social_linkedin.social_stream_post_kanban_controller',function(require){"use strict";var StreamPostKanbanController=require('social.social_stream_post_kanban_controller');var StreamPostLinkedInComments=require('social_linkedin.social_linkedin_post_kanban_comments');StreamPostKanbanController.include({events:_.extend({},StreamPostKanbanController.prototype.events,{'click .o_social_linkedin_comments':'_onLinkedInCommentsClick',}),_onLinkedInCommentsClick:function(ev){var self=this;var $target=$(ev.currentTarget);var postId=$target.data('postId');this._rpc({model:'social.stream.post',method:'get_linkedin_comments',args:[[postId]]}).then(function(result){new StreamPostLinkedInComments(self,{postId:postId,accountId:result.accountId,postAuthorImage:result.postAuthorImage,currentUserUrn:result.currentUserUrn,originalPost:$target.data(),comments:result.comments,summary:result.summary,offset:result.offset}).open();});},});return StreamPostKanbanController;});;

/* /social_linkedin/static/src/js/stream_post_linkedin_comments.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('social_linkedin.social_linkedin_post_kanban_comments',function(require){var core=require('web.core');var _t=core._t;var QWeb=core.qweb;var StreamPostComments=require('social.social_post_kanban_comments');var StreamPostLinkedInComments=StreamPostComments.extend({init:function(parent,options){this.options=_.defaults(options||{},{title:_t('LinkedIn Comments'),commentName:_t('comment/reply')});this.postAuthorImage=options.postAuthorImage;this.currentUserUrn=options.currentUserUrn;this.totalLoadedComments=options.comments.length;this.offset=options.offset;this.summary=options.summary;this._super.apply(this,arguments);},getAuthorPictureSrc:function(comment){return comment?comment.from.picture:this.postAuthorImage;},getCommentLink:function(comment){let activityUrn=comment.id.split('(')[1].split(',')[0];return`https://www.linkedin.com/feed/update/${activityUrn}?commentUrn=${comment.id}`;},getAuthorLink:function(comment){if(comment.from.isOrganization){return`https://www.linkedin.com/company/${comment.from.vanityName}`;}
return`https://www.linkedin.com/in/${comment.from.vanityName}`;},isCommentEditable:function(comment){return false;},isCommentLikable:function(comment){return false;},isCommentDeletable:function(comment){return comment.from.id===this.currentUserUrn;},canAddImage:function(){return false;},getAddCommentEndpoint:function(){return'/social_linkedin/comment';},getDeleteCommentEndpoint:function(){return'delete_linkedin_comment';},showMoreComments:function(result){return this.totalLoadedComments<this.summary.total_count;},_onLikeComment:function(ev){ev.preventDefault();},_onLoadMoreComments:function(ev){var self=this;ev.preventDefault();this._rpc({model:'social.stream.post',method:'get_linkedin_comments',args:[[this.postId],null,this.offset]}).then(function(result){var $moreComments=$(QWeb.render("social.StreamPostCommentsWrapper",{widget:self,comments:result.comments}));self.$('.o_social_comments_messages').append($moreComments);self.totalLoadedComments+=result.comments.length;if(self.totalLoadedComments>=self.summary.total_count){self.$('.o_social_load_more_comments').hide();}
self.offset=result.offset;});},_onLoadReplies:function(ev){ev.preventDefault();if(this.originalPost.mediaType==='linkedin'){var $target=$(ev.currentTarget);var data=$target.data('innerComments');var self=this;var superArguments=arguments;var superMethod=this._super;return this._rpc({model:'social.stream.post',method:'get_linkedin_comments',args:[[this.postId],data.parentUrn]}).then(function(result){$target.data('innerComments',result.comments);return superMethod.apply(self,superArguments);});}else{return this._super.apply(this,arguments);}},});return StreamPostLinkedInComments;});;

/* /social_twitter/static/src/js/twitter_users_autocomplete.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('social.users_autocomplete',function(require){'use strict';var basic_fields=require('web.basic_fields');var core=require('web.core');var field_registry=require('web.field_registry');var QWeb=core.qweb;var FieldChar=basic_fields.FieldChar;var TwitterUsersAutocomplete=FieldChar.extend({className:'o_field_twitter_users_autocomplete',events:_.extend({},FieldChar.prototype.events,{'click .o_twitter_users_autocomplete_suggestion':'_onSuggestionClicked',}),_renderEdit:function(){this._super.apply(this);var self=this;this.$input.autocomplete({classes:{'ui-autocomplete':'o_social_twitter_users_autocomplete'},source:function(request,response){var accountId=self.getParent().state.data.account_id.data.id;return self._rpc({model:'social.account',method:'twitter_search_users',args:[[accountId],request.term],}).then(function(suggestions){response(suggestions);});},select:function(ev,ui){self.$input.val(ui.item.name);self._selectTwitterUser(ui.item);ev.preventDefault();},html:true,minLength:2,delay:500,}).data('ui-autocomplete')._renderItem=function(ul,item){return $(QWeb.render('social_twitter.users_autocomplete_element',{suggestion:item})).appendTo(ul);};},_selectTwitterUser:function(twitterUser){var self=this;this._rpc({model:'social.twitter.account',method:'create',args:[{name:twitterUser.name,twitter_id:twitterUser.id_str}]}).then(function(id){self.trigger_up('field_changed',{dataPointID:self.dataPointID,changes:{twitter_followed_account_id:{id:id}},});});}});field_registry.add('twitter_users_autocomplete',TwitterUsersAutocomplete);return TwitterUsersAutocomplete;});;

/* /social_twitter/static/src/js/stream_post_twitter_comments.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('social.StreamPostTwitterComments',function(require){var core=require('web.core');var _t=core._t;var QWeb=core.qweb;var StreamPostComments=require('social.social_post_kanban_comments');var StreamPostTwitterComments=StreamPostComments.extend({init:function(parent,options){this.accountId=options.accountId;this.streamId=options.streamId;this.hasMoreComments=options.hasMoreComments;this.page=1;this.allComments=options.allComments;this.comments=this.allComments.slice(0,20);this.mediaType='twitter';this.options=_.defaults(options||{},{title:_t('Twitter Comments'),commentName:_t('tweet'),comments:this.comments});this._super.apply(this,arguments);},willStart:function(){var self=this;var superDef=this._super.apply(this,arguments);var pageInfoDef=this._rpc({model:'social.account',method:'read',args:[this.accountId,['name','twitter_user_id']],}).then(function(result){self.accountName=result[0].name;self.twitterUserId=result[0].twitter_user_id;return Promise.resolve();});return Promise.all([superDef,pageInfoDef]);},getAuthorPictureSrc:function(comment){if(comment){return comment.from.profile_image_url_https;}else{return _.str.sprintf('/web/image/social.account/%s/image/48x48',this.accountId);}},getLikesClass:function(){return"fa-heart";},getCommentLink:function(comment){return _.str.sprintf("https://www.twitter.com/%s/statuses/%s",comment.from.id,comment.id);},getAuthorLink:function(comment){return _.str.sprintf("https://twitter.com/intent/user?user_id=%s",comment.from.id);},isCommentDeletable:function(comment){return comment.from.id===this.twitterUserId;},getAddCommentEndpoint:function(){return _.str.sprintf('/social_twitter/%s/comment',this.streamId);},getDeleteCommentEndpoint:function(){return'delete_tweet';},isCommentEditable:function(){return false;},showMoreComments:function(result){return this.page*20<this.allComments.length;},_onLikeComment:function(ev){ev.preventDefault();var $target=$(ev.currentTarget);var userLikes=$target.data('userLikes');this._rpc({route:_.str.sprintf('social_twitter/%s/like_tweet',this.streamId),params:{tweet_id:$target.data('commentId'),like:!userLikes}});$target.toggleClass('o_social_comment_user_likes');this._updateLikesCount($target);},_onLoadMoreComments:function(ev){var self=this;ev.preventDefault();this.page+=1;var start=(this.page-1)*20;var end=start+20;var $moreComments=$(QWeb.render("social.StreamPostCommentsWrapper",{widget:this,comments:this.allComments.slice(start,end)}));self.$('.o_social_comments_messages').append($moreComments);if(end>=this.allComments.length){self.$('.o_social_load_more_comments').hide();}},});return StreamPostTwitterComments;});;

/* /social_twitter/static/src/js/stream_post_kanban_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('social_twitter.social_stream_post_kanban_controller',function(require){"use strict";var StreamPostKanbanController=require('social.social_stream_post_kanban_controller');var StreamPostTwitterComments=require('social.StreamPostTwitterComments');StreamPostKanbanController.include({events:_.extend({},StreamPostKanbanController.prototype.events,{'click .o_social_twitter_comments':'_onTwitterCommentsClick','click .o_social_twitter_likes':'_onTwitterTweetLike'}),_onTwitterCommentsClick:function(ev){var self=this;var $target=$(ev.currentTarget);var postId=$target.data('postId');this._rpc({model:'social.stream.post',method:'get_twitter_comments',args:[[postId]]}).then(function(result){new StreamPostTwitterComments(self,{postId:postId,originalPost:$target.data(),streamId:$target.data('streamId'),accountId:$target.data('twitterAccountId'),allComments:result.comments}).open();});},_onTwitterTweetLike:function(ev){ev.preventDefault();var $target=$(ev.currentTarget);var userLikes=$target.data('userLikes');this._rpc({route:_.str.sprintf('social_twitter/%s/like_tweet',$target.data('streamId')),params:{tweet_id:$target.data('twitterTweetId'),like:!userLikes}});this._updateLikesCount($target);$target.toggleClass('o_social_twitter_user_likes');}});return StreamPostKanbanController;});;

/* /web_studio/static/src/js/background_image.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_studio.BackgroundImage',function(require){"use strict";const session=require('web.session');const WebClient=require('web.WebClient');WebClient.include({async load_menus(){const menuData=await this._super(...arguments);if(menuData.background_image){const company_id=session.user_context.allowed_company_ids[0];const url=session.url('/web/image',{id:company_id,model:'res.company',field:'background_image',});this.homeMenuStyle=`background-image: url(${url})`;}
return menuData;},async toggleHomeMenu(display){this.el.classList.toggle('o_home_menu_background_custom',Boolean(display&&this.homeMenuStyle));return this._super(...arguments);},_instanciateHomeMenuWrapper(){const homeMenuManager=this._super(...arguments);if(this.homeMenuStyle){homeMenuManager.state.style=this.homeMenuStyle;}
return homeMenuManager;},});});;

/* /web_studio/static/src/js/approval_component.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_studio.ApprovalComponent',function(require){'use strict';const{Component,useState}=owl;const Dialog=require('web.OwlDialog');class ApprovalComponent extends Component{constructor(){super(...arguments);this.state=useState({entries:null,rules:null,showInfo:false,syncing:false,init:true,});}
mounted(){this.env.bus.on('refresh-approval',this,this._onRefresh);return super.mounted(...arguments);}
willUnmount(){this.env.bus.off('refresh-approval',this,this._onRefresh);return super.willUnmount(...arguments);}
async willStart(){return Promise.all([this._fetchApprovalData(),super.willStart(...arguments)]);}
async willUpdateProps(){return Promise.all([this._fetchApprovalData(),super.willUpdateProps(...arguments)]);}
getEntry(ruleId){return this.state.entries.find((e)=>e.rule_id[0]===ruleId);}
_cancelApproval(ruleId){this._setSyncing(true);this.rpc({model:'studio.approval.rule',method:'delete_approval',args:[[ruleId]],kwargs:{res_id:this.props.resId,},context:this.env.session.user_context,}).then(async()=>{this._notifyChange();await this._fetchApprovalData()
this._setSyncing(false);}).guardedCatch(async()=>{this._notifyChange();await this._fetchApprovalData()
this._setSyncing(false);});}
async _fetchApprovalData(){const spec=await this.rpc({model:'studio.approval.rule',method:'get_approval_spec',args:[this.props.model,this.props.method,this.props.action],kwargs:{res_id:!this.props.inStudio&&this.props.resId,},context:this.env.session.user_context,},{shadow:true});spec.entries.forEach((entry)=>{entry.long_date=moment.utc(entry.write_date).local().format('LLL');entry.short_date=moment.utc(entry.write_date).local().format('LL');});Object.assign(this.state,spec);this.state.init=false;}
_notifyChange(){this.env.bus.trigger('refresh-approval',{approvalSpec:[this.props.model,this.props.resId,this.props.method,this.props.action],});}
_setApproval(ruleId,approved){this._setSyncing(true);this.rpc({model:'studio.approval.rule',method:'set_approval',args:[[ruleId]],kwargs:{res_id:this.props.resId,approved:approved,},context:this.env.session.user_context,}).then(async()=>{this._notifyChange();await this._fetchApprovalData();this._setSyncing(false);}).guardedCatch(async()=>{this._notifyChange();await this._fetchApprovalData();this._setSyncing(false);});}
_setSyncing(value){this.state.syncing=value;}
_onRefresh(ev){if(ev.approvalSpec[0]===this.props.model&&ev.approvalSpec[1]===this.props.resId&&ev.approvalSpec[2]===this.props.method&&ev.approvalSpec[3]===this.props.action){this._fetchApprovalData();}}
_toggleInfo(ev){if(!this.props.inStudio){ev.stopPropagation();}
this.state.showInfo=!this.state.showInfo;}}
ApprovalComponent.template='Studio.ApprovalComponent';ApprovalComponent.components={Dialog};ApprovalComponent.props={action:[Number,Boolean],actionName:{type:String,optional:true},inStudio:Boolean,method:[String,Boolean],model:String,resId:{type:Number,optional:true},};return ApprovalComponent;});;

/* /web_studio/static/src/js/views/renderers/form_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_studio.FormRenderer',function(require){'use strict';const FormRenderer=require('web.FormRenderer');const{ComponentWrapper}=require('web.OwlCompatibility');const ApprovalComponent=require('web_studio.ApprovalComponent');FormRenderer.include({_renderHeaderButton(node){const $button=this._super(...arguments);this._addApprovalComponent($button,node);return $button;},_renderStatButton(node){const $button=this._super(...arguments);this._addApprovalComponent($button,node);return $button;},_renderTagButton(node){const $button=this._super(...arguments);this._addApprovalComponent($button,node);return $button;},async _addApprovalComponent($el,node){const attrs=node.attrs;const approvalEnabled=attrs.studio_approval&&attrs.studio_approval!=='False';const isInvisible=$el[0].classList.contains('o_invisible_modifier');if(approvalEnabled&&!isInvisible){const options={action:false,actionName:attrs.string,inStudio:Boolean(this.state.getContext().studio),method:false,model:this.state.model,resId:this.state.res_id,};if(attrs.type==='object'){options.method=attrs.name;}else if(attrs.type==='action'){options.action=parseInt(attrs.name);}
const approvalComponent=new ComponentWrapper(this,ApprovalComponent,options);await approvalComponent.mount($el[0]);}},});});;

/* /web_studio/static/src/js/views/controllers/form_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('web_studio.FormController',function(require){'use strict';const core=require('web.core');const FormController=require('web.FormController');const _t=core._t;FormController.include({async _callButtonAction(attrs,record){const _super=this._super;if(attrs.studio_approval&&attrs.studio_approval!=='False'){const appSpec=await this._checkApproval(attrs,record);if(!appSpec.approved){await this.update({},{reload:true});const missingApprovals=[];const doneApprovals=appSpec.entries.filter((e)=>e.approved).map((e)=>e.rule_id[0]);appSpec.rules.forEach((r)=>{if(!doneApprovals.includes(r.id)){missingApprovals.push(r);}});let msg='<ul>';missingApprovals.forEach((r)=>(msg+=`<li>${r.message || r.group_id[1]}</li>`));msg+='</ul>';this.displayNotification({subtitle:_t('The following approvals are missing:'),message:msg,type:'warning',});return Promise.reject();}}
return _super.apply(this,arguments);},async _checkApproval(attrs,record){const isAction=attrs.type==='action';const args=[this.modelName,parseInt(record.res_id),isAction?undefined:attrs.name,isAction?parseInt(attrs.name):undefined,];const result=await this._rpc({model:'studio.approval.rule',method:'check_approval',args:args,context:record.context,});core.bus.trigger('refresh-approval',{approvalSpec:args});return result;},});});;

/* /account/static/src/js/account_payment_field.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account.payment',function(require){"use strict";var AbstractField=require('web.AbstractField');var core=require('web.core');var field_registry=require('web.field_registry');var field_utils=require('web.field_utils');var QWeb=core.qweb;var _t=core._t;var ShowPaymentLineWidget=AbstractField.extend({events:_.extend({'click .outstanding_credit_assign':'_onOutstandingCreditAssign',},AbstractField.prototype.events),supportedFieldTypes:['char'],isSet:function(){return true;},_render:function(){var self=this;var info=JSON.parse(this.value);if(!info){this.$el.html('');return;}
_.each(info.content,function(k,v){k.index=v;k.amount=field_utils.format.float(k.amount,{digits:k.digits});if(k.date){k.date=field_utils.format.date(field_utils.parse.date(k.date,{},{isUTC:true}));}});this.$el.html(QWeb.render('ShowPaymentInfo',{lines:info.content,outstanding:info.outstanding,title:info.title}));_.each(this.$('.js_payment_info'),function(k,v){var isRTL=_t.database.parameters.direction==="rtl";var content=info.content[v];var options={content:function(){var $content=$(QWeb.render('PaymentPopOver',content));var unreconcile_button=$content.filter('.js_unreconcile_payment').on('click',self._onRemoveMoveReconcile.bind(self));$content.filter('.js_open_payment').on('click',self._onOpenPayment.bind(self));return $content;},html:true,placement:isRTL?'bottom':'left',title:'Payment Information',trigger:'focus',delay:{"show":0,"hide":100},container:$(k).parent(),};$(k).popover(options);});},_onOpenPayment:function(event){var paymentId=parseInt($(event.target).attr('payment-id'));var moveId=parseInt($(event.target).attr('move-id'));var res_model;var id;if(paymentId!==undefined&&!isNaN(paymentId)){res_model="account.payment";id=paymentId;}else if(moveId!==undefined&&!isNaN(moveId)){res_model="account.move";id=moveId;}
if(res_model&&id){this.do_action({type:'ir.actions.act_window',res_model:res_model,res_id:id,views:[[false,'form']],target:'current'});}},_onOutstandingCreditAssign:function(event){event.stopPropagation();event.preventDefault();var self=this;var id=$(event.target).data('id')||false;this._rpc({model:'account.move',method:'js_assign_outstanding_line',args:[JSON.parse(this.value).move_id,id],}).then(function(){self.trigger_up('reload');});},_onRemoveMoveReconcile:function(event){var self=this;var moveId=parseInt($(event.target).attr('move-id'));var partialId=parseInt($(event.target).attr('partial-id'));if(partialId!==undefined&&!isNaN(partialId)){this._rpc({model:'account.move',method:'js_remove_outstanding_partial',args:[moveId,partialId],}).then(function(){self.trigger_up('reload');});}},});field_registry.add('payment',ShowPaymentLineWidget);return{ShowPaymentLineWidget:ShowPaymentLineWidget};});;

/* /account/static/src/js/account_resequence_field.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account.ShowResequenceRenderer',function(require){"use strict";const{Component}=owl;const{useState}=owl.hooks;const AbstractFieldOwl=require('web.AbstractFieldOwl');const field_registry=require('web.field_registry_owl');class ChangeLine extends Component{}
ChangeLine.template='account.ResequenceChangeLine';ChangeLine.props=["changeLine",'ordering'];class ShowResequenceRenderer extends AbstractFieldOwl{constructor(...args){super(...args);this.data=this.value?JSON.parse(this.value):{changeLines:[],ordering:'date',};}
async willUpdateProps(nextProps){await super.willUpdateProps(nextProps);Object.assign(this.data,JSON.parse(this.value));}}
ShowResequenceRenderer.template='account.ResequenceRenderer';ShowResequenceRenderer.components={ChangeLine}
field_registry.add('account_resequence_widget',ShowResequenceRenderer);return ShowResequenceRenderer;});;

/* /account/static/src/js/grouped_view_widget.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account.ShowGroupedList',function(require){"use strict";const{Component}=owl;const{useState}=owl.hooks;const AbstractFieldOwl=require('web.AbstractFieldOwl');const field_registry=require('web.field_registry_owl');class ListItem extends Component{}
ListItem.template='account.GroupedItemTemplate';ListItem.props=["item_vals","options"];class ListGroup extends Component{}
ListGroup.template='account.GroupedItemsTemplate';ListGroup.components={ListItem}
ListGroup.props=["group_vals","options"];class ShowGroupedList extends AbstractFieldOwl{constructor(...args){super(...args);this.data=this.value?JSON.parse(this.value):{groups_vals:[],options:{discarded_number:'',columns:[],},};}
async willUpdateProps(nextProps){await super.willUpdateProps(nextProps);Object.assign(this.data,JSON.parse(this.value));}}
ShowGroupedList.template='account.GroupedListTemplate';ShowGroupedList.components={ListGroup}
field_registry.add('grouped_view_widget',ShowGroupedList);return ShowGroupedList;});;

/* /account/static/src/js/mail_activity.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account.activity',function(require){"use strict";var AbstractField=require('web.AbstractField');var core=require('web.core');var field_registry=require('web.field_registry');var QWeb=core.qweb;var _t=core._t;var VatActivity=AbstractField.extend({className:'o_journal_activity_kanban',events:{'click .see_all_activities':'_onOpenAll','click .see_activity':'_onOpenActivity',},init:function(){this.MAX_ACTIVITY_DISPLAY=5;this._super.apply(this,arguments);},_render:function(){var self=this;var info=JSON.parse(this.value);if(!info){this.$el.html('');return;}
info.more_activities=false;if(info.activities.length>this.MAX_ACTIVITY_DISPLAY){info.more_activities=true;info.activities=info.activities.slice(0,this.MAX_ACTIVITY_DISPLAY);}
this.$el.html(QWeb.render('accountJournalDashboardActivity',info));},_onOpenActivity:function(e){e.preventDefault();var self=this;self.do_action({type:'ir.actions.act_window',name:_t('Journal Entry'),target:'current',res_id:$(e.target).data('resId'),res_model:'account.move',views:[[false,'form']],});},_onOpenAll:function(e){e.preventDefault();var self=this;self.do_action({type:'ir.actions.act_window',name:_t('Journal Entries'),res_model:'account.move',views:[[false,'kanban'],[false,'form']],search_view_id:[false],domain:[['journal_id','=',self.res_id],['activity_ids','!=',false]],});}})
field_registry.add('kanban_vat_activity',VatActivity);return VatActivity;});;

/* /account/static/src/js/tax_group.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account.tax_group',function(require){"use strict";var core=require('web.core');var session=require('web.session');var fieldRegistry=require('web.field_registry');var AbstractField=require('web.AbstractField');var fieldUtils=require('web.field_utils');var QWeb=core.qweb;var TaxGroupCustomField=AbstractField.extend({events:{'click .tax_group_edit':'_onClick','keydown .oe_tax_group_editable .tax_group_edit_input input':'_onKeydown','blur .oe_tax_group_editable .tax_group_edit_input input':'_onBlur',},_changeTaxValueByTaxGroup:function(taxGroupId,deltaAmount){var self=this;var line_id=self.record.data.line_ids.data.find(elem=>elem.data.tax_group_id&&elem.data.tax_group_id.data.id===taxGroupId);var debitAmount=0;var creditAmount=0;var amount_currency=0;if(line_id.data.currency_id){if(this.record.data.move_type==="in_invoice"){amount_currency=line_id.data.amount_currency-deltaAmount;}else{amount_currency=line_id.data.amount_currency+deltaAmount;}}else{var balance=line_id.data.price_subtotal;balance-=deltaAmount;if(this.record.data.move_type==="in_invoice"){if(balance>0){debitAmount=balance;}else if(balance<0){creditAmount=-balance;}}else{if(balance>0){creditAmount=balance;}else if(balance<0){debitAmount=-balance;}}}
self.trigger_up('field_changed',{dataPointID:self.record.id,changes:{line_ids:{operation:"UPDATE",id:line_id.id,data:{amount_currency:amount_currency,debit:debitAmount,credit:creditAmount}}},initialEvent:{dataPointID:line_id.id,changes:{amount_currency:amount_currency,debit:debitAmount,credit:creditAmount},},});},_isPurchaseDocument:function(){return this.record.data.move_type==="in_invoice"||this.record.data.move_type==='in_refund';},_render:function(){var self=this;var displayEditWidget=self._isPurchaseDocument()&&this.record.data.state==='draft'&&this.getParent().mode==='edit';this.$el.html($(QWeb.render('AccountTaxGroupTemplate',{lines:self.value,displayEditWidget:displayEditWidget,})));},_onBlur:function(ev){ev.preventDefault();var $input=$(ev.target);var newValue=$input.val();var currency=session.get_currency(this.record.data.currency_id.data.id);try{newValue=fieldUtils.parse.float(newValue);newValue=fieldUtils.format.float(newValue,null,{digits:currency.digits});newValue=fieldUtils.parse.float(newValue);}catch(err){$input.addClass('o_field_invalid');return;}
var oldValue=$input.data('originalValue');if(newValue===oldValue||newValue===0){return this._render();}
var taxGroupId=$input.parents('.oe_tax_group_editable').data('taxGroupId');this._changeTaxValueByTaxGroup(taxGroupId,oldValue-newValue);},_onClick:function(ev){ev.preventDefault();var $taxGroupElement=$(ev.target).parents('.oe_tax_group_editable');$taxGroupElement.find('.tax_group_edit').addClass('d-none');$taxGroupElement.find('.tax_group_edit_input').removeClass('d-none');var $input=$taxGroupElement.find('.tax_group_edit_input input');var formatedOriginalValue=fieldUtils.format.float($input.data('originalValue'),{},{});$input.focus();$input.val(formatedOriginalValue);},_onKeydown:function(ev){switch(ev.which){case $.ui.keyCode.ENTER:case $.ui.keyCode.TAB:$(ev.target).blur();}},});fieldRegistry.add('tax-group-custom-field',TaxGroupCustomField)});;

/* /account/static/src/js/bank_statement.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account.bank_statement',function(require){"use strict";var KanbanController=require("web.KanbanController");var ListController=require("web.ListController");var includeDict={renderButtons:function(){this._super.apply(this,arguments);if(this.modelName==="account.bank.statement"){var data=this.model.get(this.handle);if(data.context.journal_type!=='cash'){this.$buttons.find('button.o_button_import').hide();}}}};KanbanController.include(includeDict);ListController.include(includeDict);});;

/* /account/static/src/js/section_and_note_fields_backend.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account.section_and_note_backend',function(require){"use strict";var FieldChar=require('web.basic_fields').FieldChar;var FieldOne2Many=require('web.relational_fields').FieldOne2Many;var fieldRegistry=require('web.field_registry');var ListFieldText=require('web.basic_fields').ListFieldText;var ListRenderer=require('web.ListRenderer');var SectionAndNoteListRenderer=ListRenderer.extend({_renderBodyCell:function(record,node,index,options){var $cell=this._super.apply(this,arguments);var isSection=record.data.display_type==='line_section';var isNote=record.data.display_type==='line_note';if(isSection||isNote){if(node.attrs.widget==="handle"){return $cell;}else if(node.attrs.name==="name"){var nbrColumns=this._getNumberOfCols();if(this.handleField){nbrColumns--;}
if(this.addTrashIcon){nbrColumns--;}
$cell.attr('colspan',nbrColumns);}else{$cell.removeClass('o_invisible_modifier');return $cell.addClass('o_hidden');}}
return $cell;},_renderRow:function(record,index){var $row=this._super.apply(this,arguments);if(record.data.display_type){$row.addClass('o_is_'+record.data.display_type);}
return $row;},_renderView:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.$('.o_list_table').addClass('o_section_and_note_list_view');});}});var SectionAndNoteFieldOne2Many=FieldOne2Many.extend({_getRenderer:function(){if(this.view.arch.tag==='tree'){return SectionAndNoteListRenderer;}
return this._super.apply(this,arguments);},});var SectionAndNoteFieldText=function(parent,name,record,options){var isSection=record.data.display_type==='line_section';var Constructor=isSection?FieldChar:ListFieldText;return new Constructor(parent,name,record,options);};fieldRegistry.add('section_and_note_one2many',SectionAndNoteFieldOne2Many);fieldRegistry.add('section_and_note_text',SectionAndNoteFieldText);return SectionAndNoteListRenderer;});;

/* /account/static/src/js/tours/account.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('account_tour',{url:"/web",},[...tour.stepUtils.goToAppSteps('account.menu_finance',_t('Send invoices to your customers in no time with the <b>Invoicing app</b>.')),{trigger:"a.o_onboarding_step_action[data-method=action_open_base_onboarding_company]",content:_t("Start by checking your company's data."),position:"bottom",},{trigger:"button[name=action_save_onboarding_company_step]",extra_trigger:"a.o_onboarding_step_action[data-method=action_open_base_onboarding_company]",content:_t("Looks good. Let's continue."),},{trigger:"a.o_onboarding_step_action[data-method=action_open_base_document_layout]",content:_t("Customize your layout."),position:"bottom",},{trigger:"button[name=document_layout_save]",extra_trigger:"a.o_onboarding_step_action[data-method=action_open_base_document_layout]",content:_t("Once everything is as you want it, validate."),},{trigger:"a.o_onboarding_step_action[data-method=action_open_account_onboarding_create_invoice]",content:_t("Now, we'll create a your first invoice."),position:"bottom",},{trigger:"input[name=name]",extra_trigger:"[name=move_type][raw-value=out_invoice]",content:_t("Customize the prefix and number to fit your needs."),run:'text SALE/0000000001'},{trigger:"div[name=partner_id] input",extra_trigger:"[name=move_type][raw-value=out_invoice]",content:_t("Write a company name to <b>create one</b> or <b>see suggestions</b>."),position:"bottom",},{trigger:".o_m2o_dropdown_option a:contains('Create')",extra_trigger:"[name=move_type][raw-value=out_invoice]",content:_t("Select first partner"),auto:true,},{trigger:".modal-content button.btn-primary",extra_trigger:"[name=move_type][raw-value=out_invoice]",content:_t("Once everything is set, you are good to continue. You will be able to edit this later in the <b>Customers</b> menu."),},{trigger:"div[name=invoice_line_ids] .o_field_x2many_list_row_add a:not([data-context])",extra_trigger:"[name=move_type][raw-value=out_invoice]",content:_t("Add a line to your invoice"),},{trigger:"div[name=invoice_line_ids] textarea[name=name]",extra_trigger:"[name=move_type][raw-value=out_invoice]",content:_t("Fill in the details of the line.<br><i>Tip: all the details can be set automatically if you configure your <b>products</b>.</i>"),position:"bottom",},{trigger:"div[name=invoice_line_ids] input[name=price_unit]",extra_trigger:"[name=move_type][raw-value=out_invoice]",content:_t("Set a price"),position:"bottom",run:'text 100',},{trigger:"button[name=action_post]",extra_trigger:"[name=move_type][raw-value=out_invoice]",content:_t("Once your invoice is ready, press CONFIRM."),},{trigger:"button[name=action_invoice_sent]",extra_trigger:"[name=move_type][raw-value=out_invoice]",content:_t("Send the invoice and check what the customer will receive."),},{trigger:"input[name=email]",extra_trigger:"[name=move_type][raw-value=out_invoice]",content:_t("Write here <b>your own email address</b> to test the flow."),run:'text customer@example.com',},{trigger:".modal-content button.btn-primary",extra_trigger:"[name=move_type][raw-value=out_invoice]",content:_t("Validate."),},{trigger:"button[name=send_and_print_action]",extra_trigger:"[name=move_type][raw-value=out_invoice]",content:_t("Let's send the invoice."),}]);});;

/* /account/static/src/js/bills_tree_upload.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account.upload.bill.mixin',function(require){"use strict";var core=require('web.core');var _t=core._t;var qweb=core.qweb;var UploadBillMixin={start:function(){this.fileUploadID=_.uniqueId('account_bill_file_upload');$(window).on(this.fileUploadID,this._onFileUploaded.bind(this));return this._super.apply(this,arguments);},_onAddAttachment:function(ev){var $input=$(ev.currentTarget).find('input.o_input_file');if($input.val()!==''){var $binaryForm=this.$('.o_vendor_bill_upload form.o_form_binary_form');$binaryForm.submit();}},_onFileUploaded:function(){var self=this;var attachments=Array.prototype.slice.call(arguments,1);var attachent_ids=attachments.reduce(function(filtered,record){if(record.id){filtered.push(record.id);}
return filtered;},[]);return this._rpc({model:'account.journal',method:'create_invoice_from_attachment',args:["",attachent_ids],context:this.initialState.context,}).then(function(result){self.do_action(result);});},_onUpload:function(event){var self=this;var $formContainer=this.$('.o_content').find('.o_vendor_bill_upload');if(!$formContainer.length){$formContainer=$(qweb.render('account.BillsHiddenUploadForm',{widget:this}));$formContainer.appendTo(this.$('.o_content'));}
this.$('.o_vendor_bill_upload .o_input_file').click();},}
return UploadBillMixin;});odoo.define('account.bills.tree',function(require){"use strict";var core=require('web.core');var ListController=require('web.ListController');var ListView=require('web.ListView');var UploadBillMixin=require('account.upload.bill.mixin');var viewRegistry=require('web.view_registry');var BillsListController=ListController.extend(UploadBillMixin,{buttons_template:'BillsListView.buttons',events:_.extend({},ListController.prototype.events,{'click .o_button_upload_bill':'_onUpload','change .o_vendor_bill_upload .o_form_binary_form':'_onAddAttachment',}),});var BillsListView=ListView.extend({config:_.extend({},ListView.prototype.config,{Controller:BillsListController,}),});viewRegistry.add('account_tree',BillsListView);});odoo.define('account.dashboard.kanban',function(require){"use strict";var core=require('web.core');var KanbanController=require('web.KanbanController');var KanbanView=require('web.KanbanView');var UploadBillMixin=require('account.upload.bill.mixin');var viewRegistry=require('web.view_registry');var DashboardKanbanController=KanbanController.extend(UploadBillMixin,{events:_.extend({},KanbanController.prototype.events,{'click .o_button_upload_bill':'_onUpload','change .o_vendor_bill_upload .o_form_binary_form':'_onAddAttachment',}),_onUpload:function(event){var kanbanRecord=$(event.currentTarget).closest('.o_kanban_record').data('record');this.initialState.context['default_journal_id']=kanbanRecord.id;if($(event.currentTarget).attr('journal_type')=='sale'){this.initialState.context['default_move_type']='out_invoice'}else if($(event.currentTarget).attr('journal_type')=='purchase'){this.initialState.context['default_move_type']='in_invoice'}
UploadBillMixin._onUpload.apply(this,arguments);}});var DashboardKanbanView=KanbanView.extend({config:_.extend({},KanbanView.prototype.config,{Controller:DashboardKanbanController,}),});viewRegistry.add('account_dashboard_kanban',DashboardKanbanView);});;

/* /account/static/src/js/account_selection.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account.hierarchy.selection',function(require){"use strict";var core=require('web.core');var relational_fields=require('web.relational_fields');var _t=core._t;var registry=require('web.field_registry');var FieldSelection=relational_fields.FieldSelection;var qweb=core.qweb;var HierarchySelection=FieldSelection.extend({_renderEdit:function(){var self=this;var prom=Promise.resolve()
if(!self.hierarchy_groups){prom=this._rpc({model:'account.account.type',method:'search_read',kwargs:{domain:[],fields:['id','internal_group','display_name'],},}).then(function(arg){self.values=_.map(arg,v=>[v['id'],v['display_name']])
self.hierarchy_groups=[{'name':_('Balance Sheet'),'children':[{'name':_t('Assets'),'ids':_.map(_.filter(arg,v=>v['internal_group']=='asset'),v=>v['id'])},{'name':_t('Liabilities'),'ids':_.map(_.filter(arg,v=>v['internal_group']=='liability'),v=>v['id'])},{'name':_t('Equity'),'ids':_.map(_.filter(arg,v=>v['internal_group']=='equity'),v=>v['id'])},],},{'name':_t('Profit & Loss'),'children':[{'name':_t('Income'),'ids':_.map(_.filter(arg,v=>v['internal_group']=='income'),v=>v['id'])},{'name':_t('Expense'),'ids':_.map(_.filter(arg,v=>v['internal_group']=='expense'),v=>v['id'])},],},{'name':_t('Other'),'ids':_.map(_.filter(arg,v=>!['asset','liability','equity','income','expense'].includes(v['internal_group'])),v=>v['id'])},]});}
Promise.resolve(prom).then(function(){self.$el.empty();self._addHierarchy(self.$el,self.hierarchy_groups,0);var value=self.value;if(self.field.type==='many2one'&&value){value=value.data.id;}
self.$el.val(JSON.stringify(value));});},_addHierarchy:function(el,group,level){var self=this;_.each(group,function(item){var optgroup=$('<optgroup/>').attr(({'label':$('<div/>').html('&nbsp;'.repeat(6*level)+item['name']).text(),}))
_.each(item['ids'],function(id){var value=_.find(self.values,v=>v[0]==id)
optgroup.append($('<option/>',{value:JSON.stringify(value[0]),text:value[1],}));})
el.append(optgroup)
if(item['children']){self._addHierarchy(el,item['children'],level+1);}})}});registry.add("account_hierarchy_selection",HierarchySelection);});;

/* /crm/static/src/js/crm_form.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("crm.crm_form",function(require){"use strict";var FormController=require('web.FormController');var FormView=require('web.FormView');var viewRegistry=require('web.view_registry');var CrmFormController=FormController.extend({_applyChanges:async function(dataPointID,changes,event){var result=await this._super(...arguments);if('stage_id'in changes){const message=await this._rpc({model:'crm.lead',method:'get_rainbowman_message',args:[[parseInt(event.target.res_id)]],});if(message){this.trigger_up('show_effect',{message:message,type:'rainbow_man',});}}
return result;},});var CrmFormView=FormView.extend({config:_.extend({},FormView.prototype.config,{Controller:CrmFormController,}),});viewRegistry.add('crm_form',CrmFormView);return{CrmFormController:CrmFormController,CrmFormView:CrmFormView,};});;

/* /crm/static/src/js/crm_kanban.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('crm.crm_kanban',function(require){"use strict";var KanbanModel=require('web.KanbanModel');var KanbanView=require('web.KanbanView');var viewRegistry=require('web.view_registry');var CrmKanbanModel=KanbanModel.extend({moveRecord:async function(recordID,groupID,parentID){var result=await this._super(...arguments);if(this.localData[parentID].groupedBy[0]===this.defaultGroupedBy[0]){const message=await this._rpc({model:'crm.lead',method:'get_rainbowman_message',args:[[parseInt(this.localData[recordID].res_id)]],});if(message){this.trigger_up('show_effect',{message:message,type:'rainbow_man',});}}
return result;},});var CrmKanbanView=KanbanView.extend({config:_.extend({},KanbanView.prototype.config,{Model:CrmKanbanModel,}),});viewRegistry.add('crm_kanban',CrmKanbanView);return{CrmKanbanModel:CrmKanbanModel,CrmKanbanView:CrmKanbanView,};});;

/* /crm/static/src/js/systray_activity_menu.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('crm.systray.ActivityMenu',function(require){"use strict";var ActivityMenu=require('mail.systray.ActivityMenu');ActivityMenu.include({_getViewsList(model){if(model==="crm.lead"){return[[false,'list'],[false,'kanban'],[false,'form'],[false,'calendar'],[false,'pivot'],[false,'graph'],[false,'activity']];}
return this._super(...arguments);},_onActivityFilterClick:function(event){var data=_.extend({},$(event.currentTarget).data(),$(event.target).data());var context={};if(data.res_model==="crm.lead"){if(data.filter==='my'){context['search_default_activities_overdue']=1;context['search_default_activities_today']=1;}else{context['search_default_activities_'+data.filter]=1;}
context['force_search_count']=1;this.do_action('crm.crm_lead_action_my_activities',{additional_context:context,clear_breadcrumbs:true,});}else{this._super.apply(this,arguments);}},});});;

/* /crm/static/src/js/tours/crm.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('crm.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('crm_tour',{url:"/web",rainbowManMessage:_t("Congrats, best of luck catching such big fish! :)"),sequence:5,},[tour.stepUtils.showAppsMenuItem(),{trigger:'.o_app[data-menu-xmlid="crm.crm_menu_root"]',content:_t('Ready to boost your sales? Let\'s have a look at your <b>Pipeline</b>.'),position:'bottom',edition:'community',},{trigger:'.o_app[data-menu-xmlid="crm.crm_menu_root"]',content:_t('Ready to boost your sales? Let\'s have a look at your <b>Pipeline</b>.'),position:'bottom',edition:'enterprise',},{trigger:'.o-kanban-button-new',extra_trigger:'.o_opportunity_kanban',content:_t("<b>Create your first opportunity.</b>"),position:'bottom',},{trigger:".o_kanban_quick_create .o_field_widget[name='partner_id']",content:_t('<b>Write a few letters</b> to look for a company, or create a new one.'),position:"bottom",run:function(actions){actions.text("Brandon Freeman",this.$anchor.find("input"));},},{trigger:".ui-menu-item > a",auto:true,in_modal:false,},{trigger:'.o_kanban_quick_create .o_field_monetary[name="expected_revenue"] input',content:_t("Define here the Expected Revenue of this Opportunity."),position:'right',run:"text 12.3",},{trigger:".o_kanban_quick_create .o_kanban_add",content:_t("Now, <b>add your Opportunity</b> to your Pipeline."),position:"bottom",},{trigger:".o_opportunity_kanban .o_kanban_group:first-child .o_kanban_record:last-child .oe_kanban_content",extra_trigger:".o_opportunity_kanban",content:_t("<b>Drag &amp; drop opportunities</b> between columns as you progress in your sales cycle."),position:"bottom",run:"drag_and_drop .o_opportunity_kanban .o_kanban_group:eq(2) ",},{trigger:".o_kanban_record:not(.o_updating) .o_activity_color_default",extra_trigger:".o_opportunity_kanban",content:_t("Looks like nothing is planned. :(<br><br><i>Tip : Schedule activities to keep track of everything you have to do!</i>"),position:"bottom",},{trigger:".o_schedule_activity",extra_trigger:".o_opportunity_kanban",content:_t("Let's <b>Schedule an Activity.</b>"),position:"bottom",width:200,},{trigger:'.modal-footer button[name="action_close_dialog"]',content:_t("All set. Lets <b>Schedule</b> it."),position:"bottom",run:function(actions){actions.auto('.modal-footer button[special=cancel]');},},{id:"drag_opportunity_to_won_step",trigger:".o_opportunity_kanban .o_kanban_record:last-child",content:_t("Drag your opportunity to <b>Won</b> when you get the deal. Congrats !"),position:"bottom",run:"drag_and_drop .o_opportunity_kanban .o_kanban_group:eq(3) ",},{trigger:".o_kanban_record",extra_trigger:".o_opportunity_kanban",content:_t("Lets have a look at an Opportunity."),position:"right",run:function(actions){actions.auto(".o_kanban_record");},},{trigger:".o_lead_opportunity_form .o_statusbar_status",content:_t("This bar also allows you to switch stage."),position:"bottom"},{trigger:".breadcrumb-item:not(.active):first",content:_t("Click on the breadcrumb to go back to the Pipeline."),position:"bottom",run:function(actions){actions.auto(".breadcrumb-item:not(.active):last");}}]);});;

/* /documents/static/src/js/documents_controller_mixin.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('documents.controllerMixin',function(require){'use strict';const DocumentsInspector=require('documents.DocumentsInspector');const DocumentViewer=require('documents.DocumentViewer');const{computeMultiSelection}=require('documents.utils');const components={ChatterContainer:require('mail/static/src/components/chatter_container/chatter_container.js'),};const{_t,qweb}=require('web.core');const fileUploadMixin=require('web.fileUploadMixin');const session=require('web.session');const{ComponentWrapper}=require('web.OwlCompatibility');class ChatterContainerWrapperComponent extends ComponentWrapper{}
const DocumentsControllerMixin=Object.assign({},fileUploadMixin,{events:{'click .o_documents_kanban_share_domain':'_onClickDocumentsShareDomain','click .o_documents_kanban_upload':'_onClickDocumentsUpload','click .o_documents_kanban_url':'_onClickDocumentsUploadFromUrl','click .o_documents_kanban_request':'_onClickDocumentsRequest','dragleave .o_documents_view':'_onDragleaveDocumentsView','dragover .o_documents_view':'_onDragoverDocumentsView','dragstart .o_document_draggable':'_onDragstartDocumentDraggable','drop .o_documents_view':'_onDropDocumentsView',},custom_events:Object.assign({},fileUploadMixin.custom_events,{archive_records:'_onArchiveRecords',delete_records:'_onDeleteRecords',document_viewer_attachment_changed:'_onDocumentViewerAttachmentChanged',download:'_onDownload',get_search_panel_tags:'_onGetSearchPanelTags',history_item_delete:'_onHistoryItemDelete',history_item_download:'_onHistoryItemDownload',history_item_restore:'_onHistoryItemRestore',kanban_image_clicked:'_onKanbanImageClicked',lock_attachment:'_onLockAttachment',o_close_chatter:'_onDocumentsCloseChatter',open_chatter:'_onOpenChatter',open_record:'_onOpenRecord',save_multi:'_onSaveMulti',select_record:'_onSelectRecord',set_focus_tag_input:'_onSetFocusTagInput',set_file:'_onSetFile',share_ids:'_onShareIds',trigger_rule:'_onTriggerRule',}),init(parent,model,renderer,params){this._anchorId=null;this._chatterContainerComponent=undefined;this._documentsInspector=null;this._isInspectorTagInputFocusOnMount=false;this._selectedRecordIds=params.selectedRecordIds||[];fileUploadMixin.init.call(this);},start(){this._updateSelection();},exportState(){const state=this._super(...arguments)||{};state.selectedRecordIds=this._selectedRecordIds;return state;},async reload(){this._updateSelection();await this._renderFileUploads();const folderIds=[...new Set(Object.values(this._fileUploads).map(upload=>upload.folderId))];this._updateSearchPanel({uploadingFolderIds:folderIds});},renderButtons($node){this.$buttons=$(qweb.render('DocumentsViews.buttons'));if($node){this.$buttons.appendTo($node);}},_closeChatter(){this.$('.o_content').removeClass('o_chatter_open');this.$('.o_document_chatter_container').remove();if(this._chatterContainerComponent){this._chatterContainerComponent.destroy();this._chatterContainerComponent=undefined;}},async _deferredRenderInspector(ev){const state=this.model.get(this.handle);return new Promise((resolve)=>{setTimeout(()=>{this._renderDocumentsInspector(state);resolve();});});},_getFileUploadRenderOptions(){const currentFolderId=this.searchModel.get('selectedFolderId');return{predicate:fileUpload=>{return!currentFolderId||fileUpload.recordId||currentFolderId===fileUpload.folderId;},targetCallback:fileUpload=>{const $targetCard=this.$(`.o_documents_attachment[data-id="${fileUpload.recordId}"]`);$targetCard.find('.o_record_selector').addClass('o_hidden');return $targetCard;},};},_getFileUploadRoute(){return'/documents/upload_attachment';},_getRules(documents){const ruleIdsByRecord=documents.map(record=>record.available_rule_ids.res_ids);const commonRuleIds=_.intersection.apply(_,ruleIdsByRecord);const record=documents[0];const rules=commonRuleIds.map(ruleId=>{const rule=record.available_rule_ids.data.find(record=>record.res_id===ruleId);return rule.data;});return rules.filter(rule=>!rule.limited_to_single_record);},_makeChatterContainerProps(){return{hasActivities:this.modelName==='documents.document',hasFollowers:true,hasTopbarCloseButton:true,threadId:this._selectedRecordIds[0],threadModel:this.modelName,};},_makeDragIcon({dataTransfer,lockedCount,draggedRecordIds}){let dragIconContent;if(lockedCount>0){dragIconContent=_.str.sprintf(_t("%s Documents (%s locked)"),draggedRecordIds.length,lockedCount);}else{dragIconContent=_.str.sprintf(_t("%s Documents"),draggedRecordIds.length);}
if(draggedRecordIds.length===1){const state=this.model.get(this.handle);const record=state.data.find(record=>record.res_id===draggedRecordIds[0]);if(record){dragIconContent=record.data.name?record.data.display_name:_t("Unnamed");}}
const $dragIcon=$(qweb.render('documents.dragIcon',{dragIconContent,})).appendTo($('body'));dataTransfer.setDragImage($dragIcon[0],-5,-5);setTimeout(()=>$dragIcon.remove());},_makeFileUpload({recordId}){return Object.assign({folderId:this.searchModel.get('selectedFolderId'),recordId,},fileUploadMixin._makeFileUpload.apply(this,arguments));},_makeFileUploadFormDataKeys({recordId}){const context=this.model.get(this.handle,{raw:true}).getContext();return{document_id:recordId,folder_id:this.searchModel.get('selectedFolderId'),owner_id:context&&context.default_owner_id,partner_id:context&&context.default_partner_id,};},_promptFileInput($uploadInput){$uploadInput.click();},async _renderChatter(){if(this._selectedRecordIds.length!==1){return;}
this._closeChatter();const props=this._makeChatterContainerProps();this._chatterContainerComponent=new ChatterContainerWrapperComponent(this,components.ChatterContainer,props);const $chatterContainer=$(qweb.render('documents.ChatterContainer'));this.$('.o_content').addClass('o_chatter_open').append($chatterContainer);const target=$chatterContainer[0].querySelector(':scope .o_documents_chatter_placeholder');await this._chatterContainerComponent.mount(target);},async _renderDocumentsInspector(state){let localState;if(this._documentsInspector){localState=this._documentsInspector.getLocalState();this._documentsInspector.destroy();}
this._documentsInspector=new DocumentsInspector(this,{focusTagInput:this._isInspectorTagInputFocusOnMount,folderId:this.searchModel.get('selectedFolderId'),folders:this.searchModel.get('folders'),recordIds:this._selectedRecordIds,state,tags:this.searchModel.get('tags'),viewType:this.viewType,});this._isInspectorTagInputFocusOnMount=false;await this._documentsInspector.insertAfter(this.renderer.$el);if(localState){this._documentsInspector.setLocalState(localState);}},async _shareDocuments(vals){if(!vals.folder_id){return;}
const result=await this._rpc({model:'documents.share',method:'create_share',args:[vals],});this.do_action(result);},async _triggerRule(ruleId,recordIds,{preventReload}={}){const result=await this._rpc({model:'documents.workflow.rule',method:'apply_actions',args:[[ruleId],recordIds],});if(preventReload){return;}
if(_.isObject(result)){await this.do_action(result);}else{await this.reload();}},async _update(state,{controllerState:{selectedRecordIds,}={},}={}){if(selectedRecordIds){this._selectedRecordIds=selectedRecordIds;}
const recordIds=state.data.map(record=>record.res_id);this._selectedRecordIds=_.intersection(this._selectedRecordIds,recordIds);await this._updateChatter();await this._renderDocumentsInspector(state);},updateButtons(){const selectedFolderId=this.searchModel.get('selectedFolderId');this.$buttons.find('.o_documents_kanban_upload').prop('disabled',!selectedFolderId);this.$buttons.find('.o_documents_kanban_url').prop('disabled',!selectedFolderId);this.$buttons.find('.o_documents_kanban_request').prop('disabled',!selectedFolderId);this.$buttons.find('.o_documents_kanban_share_domain').prop('disabled',!selectedFolderId);},async _updateChatter(){if(!this._chatterContainerComponent){return;}
if(this._selectedRecordIds.length===1){const props=this._makeChatterContainerProps();this._chatterContainerComponent.update(props);const chatterContainer=this.el.querySelector(':scope .o_document_chatter_container');const target=chatterContainer.querySelector(':scope .o_documents_chatter_placeholder');await this._chatterContainerComponent.mount(target);}else{this._closeChatter();}},_updateSelection(){this.renderer.updateSelection(this._selectedRecordIds);},_uploadFilesHandler(multiple){return(ev)=>{const recordId=ev.data?ev.data.id:undefined;const $uploadInput=this.hiddenUploadInputFile?this.hiddenUploadInputFile.off('change'):(this.hiddenUploadInputFile=$('<input>',{type:'file',name:'files[]',class:'o_hidden'}).appendTo(this.$el));$uploadInput.attr('multiple',multiple?true:null);const cleanup=$.prototype.remove.bind($uploadInput);$uploadInput.on('change',async changeEv=>{await this._uploadFiles(changeEv.target.files,{recordId}).finally(cleanup);});this._promptFileInput($uploadInput);};},async _onArchiveRecords(ev){ev.stopPropagation();const recordIds=ev.data.records.map(record=>record.id);await this.model.toggleActive(recordIds,this.handle);await this.update({},{reload:false});},async _onBeforeUpload(){fileUploadMixin._onBeforeUpload.apply(this,arguments);const folderIds=[...new Set(Object.values(this._fileUploads).map(upload=>upload.folderId))];this._updateSearchPanel({uploadingFolderIds:folderIds});},_onClickDocumentsRequest(ev){ev.preventDefault();const context=this.model.get(this.handle,{raw:true}).getContext();this.do_action('documents.action_request_form',{additional_context:{default_partner_id:context.default_partner_id||false,default_folder_id:this.searchModel.get('selectedFolderId'),default_tag_ids:[[6,0,this.searchModel.get('selectedTagIds')]],},on_close:()=>this.reload(),});},_onClickDocumentsShareDomain(){const state=this.model.get(this.handle,{raw:true});this._shareDocuments({domain:state.domain,folder_id:this.searchModel.get('selectedFolderId'),tag_ids:[[6,0,this.searchModel.get('selectedTagIds')]],type:'domain',});},_onClickDocumentsUpload(ev){this._uploadFilesHandler(true)(ev);},_onClickDocumentsUploadFromUrl(ev){ev.preventDefault();const context=this.model.get(this.handle,{raw:true}).getContext();this.do_action('documents.action_url_form',{additional_context:{default_partner_id:context.default_partner_id||false,default_folder_id:this.searchModel.get('selectedFolderId'),default_tag_ids:[[6,0,this.searchModel.get('selectedTagIds')]],},on_close:async()=>await this.reload()});},async _onDeleteRecords(ev){ev.stopPropagation();const recordIds=ev.data.records.map(record=>record.id);await this.model.deleteRecords(recordIds,this.modelName);const resIds=ev.data.records.map(record=>record.res_id);this._selectedRecordIds=_.difference(this._selectedRecordIds,resIds);await this.reload();},_onDocumentsCloseChatter(){this._closeChatter();},async _onDropDocumentsView(ev){if(!ev.originalEvent.dataTransfer.types.includes('Files')){return;}
ev.preventDefault();this.renderer.$el.removeClass('o_documents_drop_over');this.$('.o_documents_upload_text').remove();await this._uploadFiles(ev.originalEvent.dataTransfer.files);},async _onDocumentViewerAttachmentChanged(ev){ev.stopPropagation();if(ev.data.documentIds){this._selectedRecordIds=ev.data.documentIds;await this.reload();}else{await this.update({});}},_onDownload(ev){ev.stopPropagation();const resIds=ev.data.resIds;if(resIds.length===1){window.location=`/documents/content/${resIds[0]}`;}else{session.get_file({url:'/document/zip',data:{file_ids:resIds,zip_name:`documents-${moment().format('YYYY-MM-DD')}.zip`},});}},_onDragoverDocumentsView(ev){if(!this.searchModel.get('selectedFolderId')||!ev.originalEvent.dataTransfer.types.includes('Files')){return;}
ev.preventDefault();this.renderer.$el.addClass('o_documents_drop_over');if(this.$('.o_documents_upload_text').length===0){this.$('.o_content').append($(qweb.render('documents.uploadText')));}},_onDragleaveDocumentsView(ev){if($(ev.target).closest(this.renderer.$el)&&ev.target!==this.renderer.el){return;}
this.renderer.$el.removeClass('o_documents_drop_over');this.$('.o_documents_upload_text').remove();},_onDragstartDocumentDraggable(ev){let isTargetSelected;let resId;switch(this.viewType){case'kanban':isTargetSelected=ev.currentTarget.classList.contains('o_record_selected');resId=$(ev.currentTarget).data('id')
break;case'list':isTargetSelected=$(ev.currentTarget).find('.o_list_record_selector input').prop('checked');resId=$(ev.currentTarget).closest('.o_data_row').data('res-id');break;}
if(!isTargetSelected){this.trigger_up('select_record',{isKeepSelection:false,originalEvent:ev,resId,});}
const unlockedRecordIds=this.model.get(this.handle,{raw:true}).data.filter(record=>!record.data.lock_uid||record.data.lock_uid===session.uid).map(record=>record.res_id);const draggedRecordIds=_.intersection(this._selectedRecordIds,unlockedRecordIds);if(draggedRecordIds.length===0){ev.preventDefault();return;}
const lockedCount=this._selectedRecordIds.length-draggedRecordIds.length;ev.originalEvent.dataTransfer.setData('o_documents_data',JSON.stringify({recordIds:draggedRecordIds,lockedCount,}));this._makeDragIcon({dataTransfer:ev.originalEvent.dataTransfer,lockedCount,draggedRecordIds,});},_onGetSearchPanelTags(ev){ev.data.callback(this.searchModel.get('tags'));},async _onHistoryItemDelete(ev){ev.stopPropagation();await this._rpc({model:'ir.attachment',method:'unlink',args:[[ev.data.attachmentId]],});await this.reload();},_onHistoryItemDownload(ev){ev.stopPropagation();window.location=`/web/content/${ev.data.attachmentId}?download=true`;},async _onHistoryItemRestore(ev){ev.stopPropagation();await this._rpc({model:'documents.document',method:'write',args:[[ev.data.resId],{attachment_id:ev.data.attachmentId}],});await this.reload();},async _onKanbanImageClicked(ev){ev.stopPropagation();const documents=ev.data.recordList;const recordId=ev.data.recordId;const rules=this._getRules(documents);const documentViewer=new DocumentViewer(this,documents,recordId,{openPdfManager:ev.data.openPdfManager,rules,});await documentViewer.appendTo(this.$('.o_documents_view'));},async _onLockAttachment(ev){ev.stopPropagation();try{await this._rpc({model:'documents.document',method:'toggle_lock',args:[ev.data.resId],});}catch(err){}
await this.reload();},async _onOpenChatter(ev){ev.stopPropagation();await this._renderChatter();},async _onOpenRecord(ev){ev.stopPropagation();let viewId=false;try{viewId=await this._rpc({model:ev.data.resModel,method:'get_formview_id',args:[ev.data.resId],});}catch(err){}
this.do_action({res_id:ev.data.resId,res_model:ev.data.resModel,type:'ir.actions.act_window',views:[[viewId,'form']],});},async _onSaveMulti(ev){ev.stopPropagation();try{await this.model.saveMulti(ev.data.dataPointIds,ev.data.changes,this.handle);await this.reload({});}finally{ev.data.callback&&ev.data.callback();}},async _onSelectRecord(ev){const state=this.model.get(this.handle);const recordIds=state.data.map(record=>record.res_id);const{newSelection,anchor}=computeMultiSelection(recordIds,ev.data.resId,{anchor:this._anchorId,isKeepSelection:ev.data.isKeepSelection||ev.data.originalEvent.ctrlKey||ev.data.originalEvent.metaKey,isRangeSelection:ev.data.originalEvent.shiftKey&&this._anchorId,selected:this._selectedRecordIds,});this._selectedRecordIds=[...new Set(newSelection)];this._anchorId=anchor;await this._updateChatter();this._deferredRenderInspector(ev);this._updateSelection();},_onSetFocusTagInput(){this._isInspectorTagInputFocusOnMount=true;},_onSetFile(ev){this._uploadFilesHandler(false)(ev);},_onShareIds(ev){ev.stopPropagation();this._shareDocuments({document_ids:[[6,0,ev.data.resIds]],folder_id:this.searchModel.get('selectedFolderId'),type:'ids',});},async _onTriggerRule(ev){ev.stopPropagation();if(ev.data.recordIds){this._selectedRecordIds=ev.data.recordIds;}
const recordIds=ev.data.recordIds?ev.data.recordIds:ev.data.records.map(record=>record.res_id);await this._triggerRule(ev.data.ruleId,recordIds,{preventReload:ev.data.preventReload});},_onUploadLoad({xhr}){const result=xhr.status===200?JSON.parse(xhr.response):{error:_.str.sprintf(_t("status code: %s </br> message: %s"),xhr.status,xhr.response)};if(result.error){this.do_notify(_t("Error"),result.error,true);}else if(result.ids&&result.ids.length>0){this._selectedRecordIds=result.ids;}
fileUploadMixin._onUploadLoad.apply(this,arguments);},});return DocumentsControllerMixin;});;

/* /documents/static/src/js/documents_model_mixin.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('documents.modelMixin',function(require){'use strict';const DocumentsModelMixin={async fetchActivities(recordId){const record=this.localData[recordId];record.specialData.activity_ids=await this._fetchSpecialActivity(record,'activity_ids');},get(dataPointId){const result=this._super(...arguments);if(result&&result.type==='list'){const dataPoint=this.localData[dataPointId];result.size=dataPoint.size;}
return result;},async load(params){const prom=this._super(...arguments);const dataPointId=await this._fetchAdditionalData(prom,params);this._currentRootDataPointId=dataPointId;return dataPointId;},reload(id,options){const prom=this._super(...arguments);if(this._currentRootDataPointId===id){return this._fetchAdditionalData(prom,options);}else{return prom;}},saveMulti(recordIds,values,parentId){return this.mutex.exec(()=>this._saveMulti(recordIds,values,parentId));},async _fetchAdditionalData(prom,params){const proms=[prom];proms.push(this._fetchSize(params));const results=await Promise.all(proms);const dataPointId=results[0];const size=results[1];const dataPoint=this.localData[dataPointId];dataPoint.size=size;return dataPointId;},async _fetchSize({domain}={}){const result=await this._rpc({model:'documents.document',method:'read_group',domain:domain||[],fields:['file_size'],groupBy:[],});const size=result[0].file_size/(1000*1000);return Math.round(size*100)/100;},_saveMulti(recordIds,values,parentId){const parent=this.localData[parentId];const resIds=recordIds.map(recordId=>this.localData[recordId].res_id);const changes=_.mapObject(values,(value,fieldName)=>{const field=parent.fields[fieldName];if(field.type==='many2one'){value=value.id||false;}else if(field.type==='many2many'){const command=value.operation==='FORGET'?3:4;value=value.resIds.map(resId=>[command,resId]);}
return value;});return this._rpc({model:parent.model,method:'write',args:[resIds,changes],});},};return DocumentsModelMixin;});;

/* /documents/static/src/js/documents_utils.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('documents.utils',function(require){'use strict';const selection={computeMultiSelection(items,target,{anchor,isCheckbox=false,isKeepSelection=false,isRangeSelection=false,selected=[]}={}){if(isCheckbox){isKeepSelection=isRangeSelection?false:isKeepSelection;}
const wasSelected=selected.includes(target);const isBasicSelection=!isRangeSelection&&!isKeepSelection;let newSelection;if(isBasicSelection){if(selected.length>1){newSelection=[target];}else{newSelection=wasSelected?[]:[target];}}else{let selectedRecordsIds;if(isRangeSelection){const anchorIndex=items.indexOf(anchor);const selectedRecordIndex=items.indexOf(target);const lowerIndex=Math.min(anchorIndex,selectedRecordIndex);const upperIndex=Math.max(anchorIndex,selectedRecordIndex);selectedRecordsIds=items.slice(lowerIndex,upperIndex+1);}else{selectedRecordsIds=[target];}
if(isKeepSelection){newSelection=wasSelected?selected.filter(id=>id!==target):selected.concat(selectedRecordsIds);}else{newSelection=selectedRecordsIds;}}
if(!isRangeSelection){if(newSelection.includes(target)){anchor=target;}else{anchor=undefined;}}
return{newSelection,anchor};},};return selection;});;

/* /documents/static/src/js/documents_view_mixin.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('documents.viewMixin',function(require){'use strict';const DocumentsViewMixin={inspectorFields:['active','activity_ids','available_rule_ids','checksum','display_name','folder_id','lock_uid','message_attachment_count','message_follower_ids','message_ids','mimetype','name','owner_id','partner_id','previous_attachment_ids','res_id','res_model','res_model_name','res_name','share_ids','tag_ids','type','url',],init(viewInfo,{controllerState:{selectedRecordIds,}={},}={}){this._super(...arguments);this.withSearchPanel=true;this.rendererParams.withSearchPanel=true;this.controllerParams.selectedRecordIds=selectedRecordIds;_.defaults(this.fieldsInfo[this.viewType],_.pick(this.fields,this.inspectorFields));this.fieldsInfo[this.viewType].available_rule_ids=Object.assign({},{fieldsInfo:{default:{display_name:{},note:{},limited_to_single_record:{},},},relatedFields:{display_name:{type:'string'},note:{type:'string'},limited_to_single_record:{type:'boolean'},},viewType:'default',},this.fieldsInfo[this.viewType].available_rule_ids);},};return DocumentsViewMixin;});;

/* /documents/static/src/bugfix/bugfix.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('documents/static/src/bugfix/bugfix.js',function(require){'use strict';});;

/* /documents/static/src/js/documents_document_viewer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('documents.DocumentViewer',function(require){'use strict';const PdfManager=require('documents.component.PdfManager');const DocumentViewer=require('mail.DocumentViewer');const{_t}=require('web.core');const{ComponentWrapper,WidgetAdapterMixin}=require('web.OwlCompatibility');const DocumentsDocumentViewer=DocumentViewer.extend(WidgetAdapterMixin,{template:"DocumentsDocumentViewer",events:Object.assign({},DocumentViewer.prototype.events,{'click .o_documents_pdf_manager_button':'_onClickDocumentsPdfManagerButton',}),custom_events:Object.assign({},DocumentViewer.prototype.custom_events,{process_documents:'_onProcessDocuments',pdf_manager_error:'_onPdfManagerError',}),init(parent,attachments,activeAttachmentID,{openPdfManager,rules}={}){this._super(...arguments);this.modelName='documents.document';this._documents=attachments;this._isPdfManagerMounted=false;this._openPdfManager=openPdfManager;this._newDocumentIds=[];this._pdfManager=undefined;this._workflowRules=rules;},async start(){await this._super(...arguments);const isPdfOnly=this._documents.every(record=>record.mimetype==='application/pdf');if(this._openPdfManager&&isPdfOnly){await this._renderPdfManager(this._documents);}},destroy(){if(this._newDocumentIds.length){this.trigger_up('document_viewer_attachment_changed',{documentIds:this._newDocumentIds});}
this._pdfManager&&this._pdfManager.destroy();this._super(...arguments);},async _renderPdfManager(documents){const $documentViewerElements=this.$('.o_viewer_content, .move_previous, .move_next');$documentViewerElements.addClass('o_hidden');this.$('.o_viewer_content').addClass('o_pdf_minimize_height');this._pdfManager=new ComponentWrapper(this,PdfManager,{documents,rules:this._workflowRules,});await this._pdfManager.mount(this.el);this._isPdfManagerMounted=true;},async _onClickDocumentsPdfManagerButton(ev){ev.stopPropagation();await this._renderPdfManager([this.activeAttachment]);},_onKeyUp(e){if(this._isPdfManagerMounted){return;}
this._super(...arguments);},_onKeydown(e){if(this._isPdfManagerMounted){return;}
this._super(...arguments);},_onPdfManagerError(ev){ev.stopPropagation();const{message}=ev.data;this.do_notify(_t("Error"),message||'');},_onProcessDocuments(ev){ev.stopPropagation();const{documentIds,ruleId,exit}=ev.data||{};if(documentIds&&documentIds.length){this._newDocumentIds=[...new Set(this._newDocumentIds.concat(documentIds))];}
if(ruleId){this.trigger_up('trigger_rule',{recordIds:documentIds,ruleId,preventReload:!exit,});}
if(exit){this.destroy();}},});return DocumentsDocumentViewer;});;

/* /documents/static/src/js/documents_kanban_color_widget.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('documents.Many2ManyColorWidget',function(require){'use strict';const fieldRegistry=require('web.field_registry');const{KanbanFieldMany2ManyTags}=require('web.relational_fields');const Many2ManyColorWidget=KanbanFieldMany2ManyTags.extend({async start(){this.tags=[];this.trigger_up('get_search_panel_tags',{callback:val=>{this.tags=val;}});await this._super(...arguments);},_render(){if(!this.tags.length){return this._super(...arguments);}
this.$el.empty().addClass('o_field_many2manytags o_kanban_tags');const tagIDs=this.value.data.map(m2m=>m2m.data.id);for(const tag of this.tags){if(tagIDs.includes(tag.id)){const color=tag.group_hex_color||'#00000022';$('<span>',{class:'o_tag',text:tag.display_name,title:tag.group_name+' > '+tag.name,}).prepend($('<span>',{style:'color: '+color+';',text:'',})).appendTo(this.$el);}}},});fieldRegistry.add('documents_many2many_tags',Many2ManyColorWidget);});;

/* /documents/static/src/js/documents_kanban_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('documents.DocumentsKanbanController',function(require){'use strict';const DocumentsControllerMixin=require('documents.controllerMixin');const KanbanController=require('web.KanbanController');var DocumentsKanbanController=KanbanController.extend(DocumentsControllerMixin,{events:Object.assign({},KanbanController.prototype.events,DocumentsControllerMixin.events),custom_events:Object.assign({},KanbanController.prototype.custom_events,DocumentsControllerMixin.custom_events),init(){this._super(...arguments);DocumentsControllerMixin.init.apply(this,arguments);},async start(){this.$('.o_content').addClass('o_documents_content o_documents_kanban');await this._super(...arguments);DocumentsControllerMixin.start.apply(this,arguments);},async reload(){await this._super(...arguments);await DocumentsControllerMixin.reload.apply(this,arguments);},async _update(){await this._super(...arguments);await DocumentsControllerMixin._update.apply(this,arguments);},updateButtons(){this._super(...arguments);DocumentsControllerMixin.updateButtons.apply(this,arguments);},});return DocumentsKanbanController;});;

/* /documents/static/src/js/documents_kanban_controller_mobile.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('documents.DocumentsKanbanControllerMobile',function(require){"use strict";const config=require('web.config');if(!config.device.isMobile){return;}
const DocumentsKanbanController=require('documents.DocumentsKanbanController');const DocumentsListController=require('documents.DocumentsListController');const{qweb}=require('web.core');const DocumentControllerMobileMixin={renderButtons(){this._super(...arguments);const $buttons=this.$buttons.find('button');const $dropdownButton=$(qweb.render('documents.ControlPanelButtonsMobile'));$buttons.addClass('dropdown-item').appendTo($dropdownButton.find('.dropdown-menu'));this.$buttons=$dropdownButton;},async _deferredRenderInspector(ev){await this._super(...arguments);if(!ev.data.isKeepSelection&&this._selectedRecordIds.length===1){this._documentsInspector.open();}},async _onSelectRecord(ev){if(ev.data.isKeepSelection||this._selectedRecordIds.length!==1||this._selectedRecordIds[0]!==ev.data.resId){await this._super(...arguments);}},};DocumentsKanbanController.include(DocumentControllerMobileMixin);DocumentsListController.include(DocumentControllerMobileMixin);});;

/* /documents/static/src/js/documents_kanban_model.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('documents.DocumentsKanbanModel',function(require){"use strict";const DocumentsModelMixin=require('documents.modelMixin');const KanbanModel=require('web.KanbanModel');const DocumentsKanbanModel=KanbanModel.extend(DocumentsModelMixin);return DocumentsKanbanModel;});;

/* /documents/static/src/js/documents_kanban_record.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('documents.DocumentsKanbanRecord',function(require){'use strict';const KanbanRecord=require('web.KanbanRecord');const DocumentsKanbanRecord=KanbanRecord.extend({events:Object.assign({},KanbanRecord.prototype.events,{'click':'_onSelectRecord','click .o_record_selector':'_onAddRecordToSelection','click .oe_kanban_previewer':'_onImageClicked','click .o_request_image':'_onRequestImage',}),getResId(){return this.id;},async update(){const isSelected=this.$el.hasClass('o_record_selected');await this._super(...arguments);if(isSelected){this.$el.addClass('o_record_selected');}},updateSelection(selected){this.$el.toggleClass('o_record_selected',selected);},_toggleSelect(ev,{isKeepSelection=false}={}){this.trigger_up('select_record',{isKeepSelection,originalEvent:ev,resId:this.getResId(),});},_onAddRecordToSelection(ev){ev.preventDefault();ev.stopPropagation();this._toggleSelect(ev,{isKeepSelection:true});},_onImageClicked(ev){ev.preventDefault();ev.stopPropagation();this.trigger_up('kanban_image_clicked',{recordList:[this.recordData],recordId:this.recordData.id});},_onKeyDownOpenFirstLink(ev){switch(ev.keyCode){case $.ui.keyCode.ENTER:this._toggleSelect(ev,{isKeepSelection:false});break;}},_onRequestImage(ev){ev.preventDefault();ev.stopPropagation();this.trigger_up('set_file',{id:this.id});},_onSelectRecord(ev){ev.preventDefault();if(!$(ev.target).hasClass('oe_kanban_action')){this._toggleSelect(ev,{isKeepSelection:false});}},});return DocumentsKanbanRecord;});;

/* /documents/static/src/js/documents_kanban_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('documents.DocumentsKanbanRenderer',function(require){'use strict';const DocumentsKanbanRecord=require('documents.DocumentsKanbanRecord');const KanbanRenderer=require('web.KanbanRenderer');const DocumentsKanbanRenderer=KanbanRenderer.extend({config:Object.assign({},KanbanRenderer.prototype.config,{KanbanRecord:DocumentsKanbanRecord,}),async start(){this.$el.addClass('o_documents_kanban_view o_documents_view position-relative align-content-start flex-grow-1 flex-shrink-1');await this._super(...arguments);},updateSelection(selectedRecordIds){for(const widget of this.widgets){const isSelected=selectedRecordIds.includes(widget.getResId());widget.updateSelection(isSelected);}},});return DocumentsKanbanRenderer;});;

/* /documents/static/src/js/documents_kanban_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('documents.DocumentsKanbanView',function(require){'use strict';const DocumentsKanbanController=require('documents.DocumentsKanbanController');const DocumentsKanbanModel=require('documents.DocumentsKanbanModel');const DocumentsKanbanRenderer=require('documents.DocumentsKanbanRenderer');const DocumentsSearchPanel=require('documents.DocumentsSearchPanel');const DocumentsViewMixin=require('documents.viewMixin');const KanbanView=require('web.KanbanView');const viewRegistry=require('web.view_registry');const{_lt}=require('web.core');const DocumentsKanbanView=KanbanView.extend(DocumentsViewMixin,{config:Object.assign({},KanbanView.prototype.config,{Controller:DocumentsKanbanController,Model:DocumentsKanbanModel,Renderer:DocumentsKanbanRenderer,SearchPanel:DocumentsSearchPanel,}),display_name:_lt('Attachments Kanban'),searchMenuTypes:['filter','favorite'],});viewRegistry.add('documents_kanban',DocumentsKanbanView);return DocumentsKanbanView;});;

/* /documents/static/src/js/documents_list_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('documents.DocumentsListController',function(require){'use strict';const DocumentsControllerMixin=require('documents.controllerMixin');const ListController=require('web.ListController');const{qweb}=require('web.core');const DocumentsListController=ListController.extend(DocumentsControllerMixin,{events:Object.assign({},ListController.prototype.events,DocumentsControllerMixin.events),custom_events:Object.assign({},ListController.prototype.custom_events,DocumentsControllerMixin.custom_events,{documents_view_rendered:'_onDocumentsViewRendered',toggle_all:'_onToggleAll',}),init(){this._super(...arguments);DocumentsControllerMixin.init.apply(this,arguments);},async start(){this.$('.o_content').addClass('o_documents_content');await this._super(...arguments);DocumentsControllerMixin.start.apply(this,arguments);},async reload(){await this._super(...arguments);await DocumentsControllerMixin.reload.apply(this,arguments);},async _update(){await this._super(...arguments);await DocumentsControllerMixin._update.apply(this,arguments);},updateButtons(){this._super(...arguments);DocumentsControllerMixin.updateButtons.apply(this,arguments);},_onDocumentsViewRendered(){this.$('.o_data_row').attr('draggable',true).addClass('o_document_draggable o_document_list_record');const localData=this.model.localData;for(const key in localData){const $record=this.$(`.o_document_list_record[data-id="${key}"]`);$record.attr('data-res-id',localData[key].data.id);const lockLocalId=localData[key].data.lock_uid;if(lockLocalId){const lockUidData=localData[lockLocalId].data;$record.find('.o_data_cell:nth(0)').append(qweb.render('documents.lockIcon',{tooltip:lockUidData.display_name,}));}}},async _onToggleAll(ev){const state=this.model.get(this.handle);this._selectedRecordIds=ev.data.checked?state.data.map(record=>record.res_id):[];await Promise.all([this._updateChatter(state),this._renderDocumentsInspector(state)]);this._updateSelection();},});return DocumentsListController;});;

/* /documents/static/src/js/documents_list_model.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('documents.DocumentsListModel',function(require){'use strict';const ListModel=require('web.ListModel');const DocumentsModelMixin=require('documents.modelMixin');const DocumentsListModel=ListModel.extend(DocumentsModelMixin);return DocumentsListModel;});;

/* /documents/static/src/js/documents_list_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('documents.DocumentsListRenderer',function(require){'use strict';const ListRenderer=require('web.ListRenderer');const DocumentsListRenderer=ListRenderer.extend({events:Object.assign({},ListRenderer.prototype.events,{'click .o_data_row .o_list_record_selector':'_onClickListSelector',}),async start(){this.$el.addClass('o_documents_list_view o_documents_view');await this._super(...arguments);},updateSelection(selectedRecordIds){this.$('.o_data_row > .o_list_record_selector input:checked').prop('checked',false);for(const id of selectedRecordIds){this.$(`.o_document_list_record[data-res-id="${id}"] input`).prop('checked',true);}
this._updateSelection();},async _renderView(){await this._super(...arguments);this.trigger_up('documents_view_rendered');},_toggleSelect(ev,{isKeepSelection,resId}){if(!resId){return;}
this.trigger_up('select_record',{isKeepSelection,originalEvent:ev,resId,});},_onClickListSelector(ev){ev.preventDefault();ev.stopPropagation();const resId=$(ev.currentTarget).closest('.o_data_row').data('res-id');this._toggleSelect(ev,{isKeepSelection:true,resId,});},_onRowClicked(ev){ev.stopPropagation();this._toggleSelect(ev,{isKeepSelection:false,resId:$(ev.currentTarget).data('res-id'),});},_onToggleSelection(ev){const checked=$(ev.currentTarget).prop('checked')||false;this.trigger_up('toggle_all',{checked,});},});return DocumentsListRenderer;});;

/* /documents/static/src/js/documents_list_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('documents.DocumentsListView',function(require){"use strict";const DocumentsListController=require('documents.DocumentsListController');const DocumentsListModel=require('documents.DocumentsListModel');const DocumentsListRenderer=require('documents.DocumentsListRenderer');const DocumentsSearchPanel=require('documents.DocumentsSearchPanel');const DocumentsView=require('documents.viewMixin');const ListView=require('web.ListView');const viewRegistry=require('web.view_registry');const DocumentsListView=ListView.extend(DocumentsView,{config:Object.assign({},ListView.prototype.config,{Controller:DocumentsListController,Model:DocumentsListModel,Renderer:DocumentsListRenderer,SearchPanel:DocumentsSearchPanel,}),});viewRegistry.add('documents_list',DocumentsListView);return DocumentsListView;});;

/* /documents/static/src/js/documents_search_panel.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents.DocumentsSearchPanel",function(require){"use strict";const{device}=require("web.config");const SearchPanel=require("web/static/src/js/views/search_panel.js");const{sprintf}=require("web.utils");const VALUE_SELECTOR=[".o_search_panel_category_value",".o_search_panel_filter_value",].join();class DocumentsSearchPanel extends SearchPanel{_isUploading(valueId){return this.props.uploadingFolderIds.includes(Number(valueId));}
_isValidElement(target,dataTransfer){return(dataTransfer&&dataTransfer.types.includes("o_documents_data")&&target&&target.closest(VALUE_SELECTOR));}
_hasValidFieldName(sectionId){const{fieldName}=this.model.get("sections",s=>s.id===sectionId)[0];return["folder_id","tag_ids"].includes(fieldName);}
_updateDragOverClass(newDragFocus){const allSelected=this.el.querySelectorAll(":scope .o_drag_over_selector");for(const selected of allSelected){selected.classList.remove("o_drag_over_selector");}
if(newDragFocus){newDragFocus.classList.add("o_drag_over_selector");}}
_onDragEnter(sectionId,valueId,{currentTarget,dataTransfer}){if(valueId!==false&&this._isValidElement(currentTarget,dataTransfer)&&this._hasValidFieldName(sectionId)){this._updateDragOverClass(currentTarget);const[section]=this.model.get("sections",(s)=>s.id===sectionId);const{childrenIds}=section.values.get(valueId);if(childrenIds&&childrenIds.length){this.state.expanded[sectionId][valueId]=true;}}else{this._updateDragOverClass();}}
_onDragLeave({relatedTarget,dataTransfer}){if(!this._isValidElement(relatedTarget,dataTransfer)){this._updateDragOverClass(null);}}
async _onDrop(sectionId,valueId,{currentTarget,dataTransfer}){this._updateDragOverClass(null);if(valueId===false||currentTarget.classList.contains("active")||!this._isValidElement(currentTarget,dataTransfer)||!this._hasValidFieldName(sectionId)){return;}
const{fieldName}=this.model.get("sections",s=>s.id===sectionId)[0];const data=JSON.parse(dataTransfer.getData("o_documents_data"));if(data.lockedCount){return this.env.services.notification.notify({title:"Partial transfer",message:sprintf(this.env._t("%s file(s) not moved because they are locked by another user"),data.lockedCount),type:"warning",});}
if(fieldName==="folder_id"){this.model.dispatch("updateRecordFolderId",data.recordIds,valueId);}else{this.model.dispatch("updateRecordTagId",data.recordIds,valueId);}}}
DocumentsSearchPanel.modelExtension="DocumentsSearchPanel";DocumentsSearchPanel.defaultProps=Object.assign({},SearchPanel.defaultProps,{uploadingFolderIds:[]});DocumentsSearchPanel.props=Object.assign({},SearchPanel.props,{uploadingFolderIds:Array,});if(!device.isMobile){DocumentsSearchPanel.template="documents.SearchPanel";}
return DocumentsSearchPanel;});;

/* /documents/static/src/js/documents_search_panel_model_extension.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents/static/src/js/documents_search_panel_model_extension",function(require){"use strict";const ActionModel=require("web/static/src/js/views/action_model.js");const SearchPanelModelExtension=require("web/static/src/js/views/search_panel_model_extension.js");const isFolderCategory=(s)=>s.type==="category"&&s.fieldName==="folder_id";const isTagFilter=(s)=>s.type==="filter"&&s.fieldName==="tag_ids";class DocumentsSearchPanelModelExtension extends SearchPanelModelExtension{get(property){switch(property){case"folders":return this.getFolders();case"selectedFolderId":return this.getSelectedFolderId();case"selectedTagIds":return this.getSelectedTagIds();case"tags":return this.getTags();}
return super.get(...arguments);}
getFolders(){const{values}=this.getSections(isFolderCategory)[0];return[...values.values()];}
getSelectedFolderId(){const{activeValueId}=this.getSections(isFolderCategory)[0];return activeValueId;}
getSelectedTagIds(){const{values}=this.getSections(isTagFilter)[0];return[...values.values()].filter((value)=>value.checked).map((value)=>value.id);}
getTags(){const{values}=this.getSections(isTagFilter)[0];return[...values.values()].sort((a,b)=>{if(a.group_sequence===b.group_sequence){return a.sequence-b.sequence;}else{return a.group_sequence-b.group_sequence;}});}
toggleCategoryValue(sectionId,valueId){super.toggleCategoryValue(...arguments);const{fieldName}=this.state.sections.get(sectionId);const storageKey=this._getStorageKey(fieldName);this.env.services.local_storage.setItem(storageKey,valueId);}
async updateRecordFolderId(recordIds,valueId){await this.env.services.rpc({model:"documents.document",method:"write",args:[recordIds,{folder_id:valueId}],});}
async updateRecordTagId(recordIds,valueId){await this.env.services.rpc({model:"documents.document",method:"write",args:[recordIds,{tag_ids:[[4,valueId]]}],});}
_ensureCategoryValue(category,valueIds){if(valueIds.includes(category.activeValueId)){return;}
const storageKey=this._getStorageKey(category.fieldName);category.activeValueId=this.env.services.local_storage.getItem(storageKey);if(valueIds.includes(category.activeValueId)){return;}
category.activeValueId=valueIds[Math.min(valueIds.length-1,1)];}
_getStorageKey(fieldName){return`searchpanel_${this.config.modelName}_${fieldName}`;}
_shouldWaitForData(){return true;}}
ActionModel.registry.add("DocumentsSearchPanel",DocumentsSearchPanelModelExtension,30);return DocumentsSearchPanelModelExtension;});;

/* /documents/static/src/js/documents_inspector.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('documents.DocumentsInspector',function(require){'use strict';const{_t,qweb}=require('web.core');const fieldRegistry=require('web.field_registry');const session=require('web.session');const{str_to_datetime}=require('web.time');const dialogs=require('web.view_dialogs');const Widget=require('web.Widget');const TAGS_SEARCH_LIMIT=8;const DocumentsInspector=Widget.extend({template:'documents.DocumentsInspector',custom_events:{field_changed:'_onFieldChanged',},events:{'click .o_inspector_archive':'_onArchive','click .o_inspector_request_icon':'_onClickRequestIcon','click .o_inspector_delete':'_onDelete','click .o_inspector_download':'_onDownload','click .o_inspector_replace':'_onReplace','click .o_inspector_split':'_onClickSplit','click .o_inspector_history_item_delete':'_onClickHistoryItemDelete','click .o_inspector_history_item_download':'_onClickHistoryItemDownload','click .o_inspector_history_item_restore':'_onClickHistoryItemRestore','click .o_inspector_lock':'_onLock','click .o_inspector_share':'_onShare','click .o_inspector_open_chatter':'_onOpenChatter','click .o_inspector_tag_add':'_onTagInputClicked','click .o_inspector_tag_remove':'_onRemoveTag','click .o_inspector_trigger_rule':'_onTriggerRule','click .o_inspector_object_name':'_onOpenResource','click .o_preview_available':'_onOpenPreview','click .o_document_pdf':'_onOpenPDF','mouseover .o_inspector_trigger_hover':'_onMouseoverRule','mouseout .o_inspector_trigger_hover':'_onMouseoutRule',},init:function(parent,params){this._super(...arguments);this._viewType=params.viewType;this.nbDocuments=params.state.count;this.size=params.state.size;this.focusTagInput=params.focusTagInput;this.currentFolder=_.findWhere(params.folders,{id:params.folderId});this.recordsData={};this.records=[];for(const resId of params.recordIds){const record=params.state.data.find(record=>record.res_id===resId);if(record){let youtubeToken;let youtubeUrlMatch;if(record.data.url&&record.data.url.length){youtubeUrlMatch=record.data.url.match('youtu(?:\.be|be\.com)/(?:.*v(?:/|=)|(?:.*/)?)([a-zA-Z0-9-_]{11})');}
if(youtubeUrlMatch&&youtubeUrlMatch.length>1){youtubeToken=youtubeUrlMatch[1];}
this.recordsData[record.id]={isGif:new RegExp('image.*(gif)').test(record.data.mimetype),isImage:new RegExp('image.*(jpeg|jpg|png)').test(record.data.mimetype),isYouTubeVideo:!!youtubeToken,youtubeToken,};this.records.push(record);}}
this.tags=params.tags;const tagIdsByRecord=this.records.map(record=>record.data.tag_ids.res_ids);this.commonTagIds=_.intersection(...tagIdsByRecord);const ruleIdsByRecord=this.records.map(record=>record.data.available_rule_ids.res_ids);const commonRuleIds=_.intersection.apply(_,ruleIdsByRecord);const record=this.records[0];this._rules=commonRuleIds.map(ruleId=>{const rule=record.data.available_rule_ids.data.find(record=>record.res_id===ruleId);return rule.data;});this.pendingSavingRequests=0;this._isLocked=this.records.some(record=>record.data.lock_uid&&record.data.lock_uid.res_id!==session.uid);this.isPdfOnly=this.records.every(record=>record.data.mimetype==='application/pdf');},async start(){this._renderTags();this._renderHistory();this._renderRules();this._renderModel();this._updateButtons();await Promise.all([this._renderFields(),this._super(...arguments)]);this.$('.o_inspector_table .o_input').prop('disabled',this._isLocked);},getLocalState:function(){return{scrollTop:this.el.scrollTop,};},setLocalState:function(state){this.el.scrollTop=state.scrollTop;},_computeClasses:function(record){const classes=["o_document_preview"];const nbPreviews=this.records.length;const recordData=this.recordsData[record.id];if(record.data.type==='empty'){classes.push("o_document_request_preview");}
if(nbPreviews===1){classes.push("o_documents_single_preview");}
if((recordData.isImage||recordData.isYouTubeVideo)){classes.push("o_documents_preview_image");}else{classes.push("o_documents_preview_mimetype");}
if((recordData.isYouTubeVideo||recordData.isGif)){classes.push("o_non_image_preview");}
return classes.join(" ");},_generateCommonRecord:function(fieldName){const record=Object.assign({},this.records[0],{id:null,res_id:null,});record.data=Object.assign({},record.data);record.data[fieldName]={data:{display_name:_t('Multiple values'),id:null,},};return record;},_renderField:function(fieldName,options){options=options||{};const values=_.uniq(this.records.map(record=>{return record.data[fieldName]&&record.data[fieldName].res_id;}));let record;if(values.length>1){record=this._generateCommonRecord(fieldName);}else{record=this.records[0];}
const $row=$(qweb.render('documents.DocumentsInspector.infoRow'));const $label=$(qweb.render('documents.DocumentsInspector.fieldLabel',{icon:options.icon,label:options.label||record.fields[fieldName].string,name:fieldName,}));$label.appendTo($row.find('.o_inspector_label'));const type=record.fields[fieldName].type;const FieldWidget=fieldRegistry.get(type);options=Object.assign({},options,{noOpen:true,viewType:this._viewType,});const fieldWidget=new FieldWidget(this,fieldName,record,options);const prom=fieldWidget.appendTo($row.find('.o_inspector_value')).then(function(){fieldWidget.getFocusableElement().attr('id',fieldName);if(type==='many2one'&&values.length>1){fieldWidget.$el.addClass('o_multiple_values');}});$row.insertBefore(this.$('.o_inspector_fields tbody tr.o_inspector_divider'));return prom;},_renderFields:function(){const options={mode:'edit'};const proms=[];if(this.records.length===1){proms.push(this._renderField('name',options));if(this.records[0].data.type==='url'){proms.push(this._renderField('url',options));}
proms.push(this._renderField('partner_id',options));}
if(this.records.length>0){proms.push(this._renderField('owner_id',options));proms.push(this._renderField('folder_id',{icon:'fa fa-folder o_documents_folder_color',mode:'edit',}));}
return Promise.all(proms);},async _renderHistory(){const attachment_ids=this.records.length===1?this.records[0].data.previous_attachment_ids.res_ids:[];if(!attachment_ids){return;}
const attachments=await this._rpc({model:'ir.attachment',method:'read',args:[attachment_ids,['name','create_date','create_uid']],orderBy:[{name:'create_date',asc:false}],});$(qweb.render('documents.inspector.attachmentHistory',{attachments,str_to_datetime,})).appendTo(this.$('.o_inspector_history'));},_renderModel:function(){if(this.records.length!==1){return;}
const resModelName=this.records[0].data.res_model_name;if(!resModelName||this.records[0].data.res_model==='documents.document'){return;}
const $modelContainer=this.$('.o_model_container');const options={res_model:resModelName,res_name:this.records[0].data.res_name,};$modelContainer.append(qweb.render('documents.DocumentsInspector.resModel',options));},_renderRules:function(){if(!this.currentFolder||this._isLocked){return;}
for(const rule of this._rules){if(this.records.length===1||!rule.limited_to_single_record){const $rule=$(qweb.render('documents.DocumentsInspector.rule',rule));$rule.appendTo(this.$('.o_inspector_rules'));}}},_renderTags:function(){const $tags=this.$('.o_inspector_tags');const commonTags=this.tags.filter(tag=>this.commonTagIds.includes(tag.id));for(const tag of commonTags){if(tag){const $tag=$(qweb.render('documents.DocumentsInspector.tag',tag));$tag.appendTo(this.$('.o_inspector_tags'));}};if(this.tags.length>this.commonTagIds.length){this.$tagInput=$('<input>',{class:'o_input o_inspector_tag_add',type:'text',}).attr('placeholder',_t("+ Add a tag "));this.$tagInput.autocomplete({delay:0,minLength:0,autoFocus:true,select:(event,ui)=>{this.trigger_up('set_focus_tag_input');const currentId=ui.item.id;if(ui.item.special){if(ui.item.special==='more'){this._searchMore(this._lastSearchVal);}}else if(currentId){this._saveMulti({tag_ids:{operation:'ADD_M2M',resIds:[currentId],},});}},source:(req,resp)=>{resp(this._search(req.term));this._lastSearchVal=req.term;},});const disabled=this._isLocked||(this.records.length===1&&!this.records[0].data.active);$tags.closest('.o_inspector_custom_field').toggleClass('o_disabled',disabled);this.$tagInput.appendTo($tags);if(this.focusTagInput){this.$tagInput.focus();}}},_saveMulti:function(changes){this.pendingSavingRequests++;this.trigger_up('save_multi',{changes:changes,dataPointIds:_.pluck(this.records,'id'),callback:()=>{this.pendingSavingRequests--;},});},_search:function(value){const tags=[];for(const tag of this.tags){if(!_.contains(this.commonTagIds,tag.id)){tags.push({id:tag.id,label:tag.group_name+' > '+tag.display_name,});}}
const lowerValue=value.toLowerCase();const allSearchResults=tags.filter(tag=>tag.label.toLowerCase().includes(lowerValue));const searchResults=allSearchResults.slice(0,TAGS_SEARCH_LIMIT);if(allSearchResults.length>TAGS_SEARCH_LIMIT){searchResults.push({label:_t("Search more..."),special:'more',classname:'o_m2o_dropdown_option',});}
return searchResults;},_searchCreatePopup(dynamicFilters=[]){this.$('.o_inspector_tag_add').val('');return new dialogs.SelectCreateDialog(this,{domain:[['folder_id','=',this.currentFolder.id]],dynamicFilters:dynamicFilters||[],no_create:true,on_selected:records=>this._saveMulti({tag_ids:{operation:'ADD_M2M',resIds:records.map(record=>record.id),},}),res_model:'documents.tag',title:_t('Select tags'),}).open();},async _searchMore(value){let results;if(value){results=await this._rpc({model:'documents.tag',method:'search_read',fields:['id'],domain:['&','&',['id','not in',this.commonTagIds],['folder_id','=',this.currentFolder.id],'|',['facet_id.name','ilike',value],['name','ilike',value]],});}
let dynamicFilters;if(results){const ids=results.map(result=>result.id);dynamicFilters=[{description:_.str.sprintf(_t('Name or Category contains: %s'),value),domain:[['id','in',ids]],}];}
await this._searchCreatePopup(dynamicFilters);},_updateButtons:function(){const binary=this.records.some(record=>record.data.type==='binary');if(this._isLocked){this.$('.o_inspector_replace').prop('disabled',true);this.$('.o_inspector_delete').prop('disabled',true);this.$('.o_inspector_archive').prop('disabled',true);this.$('.o_inspector_lock').prop('disabled',true);this.$('.o_inspector_table .o_field_widget').prop('disabled',true);}
if(!binary&&(this.records.length>1||(this.records.length&&this.records[0].data.type==='empty'))){this.$('.o_inspector_download').prop('disabled',true);}},_onArchive:function(){this.trigger_up('archive_records',{records:this.records,});},_onClickHistoryItemDelete(ev){this.trigger_up('history_item_delete',{attachmentId:$(ev.currentTarget).data('id'),});},_onClickHistoryItemDownload(ev){this.trigger_up('history_item_download',{attachmentId:$(ev.currentTarget).data('id'),});},_onClickHistoryItemRestore(ev){this.trigger_up('history_item_restore',{resId:this.records[0].res_id,attachmentId:$(ev.currentTarget).data('id'),});},_onClickRequestIcon(ev){const documentId=$(ev.currentTarget).data('id');this.trigger_up('set_file',{id:documentId,});},_onClickSplit(ev){ev.preventDefault();ev.stopPropagation();if(this.pendingSavingRequests>0){return;}
const records=this.records.map(record=>record.data);this.trigger_up('kanban_image_clicked',{recordId:records[0].id,recordList:records,openPdfManager:true,});},_onDelete:function(){this.trigger_up('delete_records',{records:this.records,});},_onDownload:function(){this.trigger_up('download',{resIds:this.records.map(record=>record.res_id),});},_onFieldChanged:function(ev){ev.stopPropagation();this._saveMulti(ev.data.changes);},_onLock:function(){this.trigger_up('lock_attachment',{resId:this.records[0].res_id,});},_onMouseoverRule:function(ev){$(ev.currentTarget).closest('.o_inspector_trigger_hover_target').addClass('o_inspector_hover');},_onMouseoutRule:function(ev){$(ev.currentTarget).closest('.o_inspector_trigger_hover_target').removeClass('o_inspector_hover');},_onOpenChatter:function(){this.trigger_up('open_chatter');},_onOpenPreview:function(ev){ev.preventDefault();ev.stopPropagation();if(this.pendingSavingRequests>0)
return;const activeId=$(ev.currentTarget).data('id');if(activeId){const records=this.records.map(record=>record.data);this.trigger_up('kanban_image_clicked',{recordId:activeId,recordList:records});}},_onOpenResource:function(){const record=this.records[0];this.trigger_up('open_record',{resId:record.data.res_id,resModel:record.data.res_model,});},_onRemoveTag:function(ev){ev.stopPropagation();const tagId=$(ev.currentTarget).closest('.o_inspector_tag').data('id');const changes={tag_ids:{operation:'FORGET',resIds:[tagId],},};this._saveMulti(changes);},_onReplace:function(){this.trigger_up('set_file',{id:this.records[0].data.id,});},_onShare:function(){this.trigger_up('share_ids',{resIds:this.records.map(record=>record.res_id),});},_onTagInputClicked:function(){if(this.$tagInput.autocomplete("widget").is(":visible")){this.$tagInput.autocomplete("close");}else{this.$tagInput.autocomplete('search');}},_onTriggerRule:function(ev){const $btn=$(ev.currentTarget);const ruleId=$btn.closest('.o_inspector_rule').data('id');$btn.prop('disabled',true);this.trigger_up('trigger_rule',{records:this.records,ruleId:ruleId});},});return DocumentsInspector;});;

/* /documents/static/src/js/documents_inspector_mobile.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('documents.DocumentsInspectorMobile',function(require){"use strict";var config=require('web.config');if(!config.device.isMobile){return;}
var DocumentsInspector=require('documents.DocumentsInspector');DocumentsInspector.include({template:'documents.DocumentsInspectorMobile',getLocalState:function(){return _.extend({},this._super.apply(this,arguments),{open:this.el.getAttribute('open')==='',});},setLocalState:function(state){this._super.apply(this,arguments);if(state.open){this.open();}},open:function(){this.el.setAttribute('open','');},});});;

/* /documents/static/src/owl/components/pdf_manager/pdf_manager.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('documents.component.PdfManager',function(require){'use strict';const PdfGroupName=require('documents.component.PdfGroupName');const PdfPage=require('documents.component.PdfPage');const{computeMultiSelection}=require('documents.utils');const{isEventHandled,markEventHandled}=require('mail/static/src/utils/utils.js');const ajax=require('web.ajax');const{csrf_token,_t}=require('web.core');const{useState}=owl.hooks;class PdfManager extends owl.Component{constructor(){super(...arguments);this.state=useState({uploadingLock:false,groupData:{},groupIds:[],pages:{},viewedPage:undefined,archive:true,anchorId:undefined,lShiftKeyDown:false,rShiftKeyDown:false,});this._newFiles={};this._pageCanvas={};this._onGlobalKeydown=this._onGlobalKeydown.bind(this);this._onGlobalCaptureKeyup=this._onGlobalCaptureKeyup.bind(this);}
async willStart(){await this._loadAssets();}
mounted(){document.addEventListener('keydown',this._onGlobalKeydown);document.addEventListener('keyup',this._onGlobalCaptureKeyup,true);for(const pdf_document of this.props.documents){this._addFile(pdf_document.name,{url:`/documents/content/${pdf_document.id}`,documentId:pdf_document.id,});}}
willUnmount(){document.removeEventListener('keydown',this._onGlobalKeydown);document.removeEventListener('keyup',this._onGlobalCaptureKeyup);}
get ignoredPageIds(){return Object.keys(this.state.pages).filter(key=>!this.state.pages[key].isSelected&&this.state.pages[key].groupId);}
get activePageIds(){return Object.keys(this.state.pages).filter(key=>this.state.pages[key].isSelected&&this.state.pages[key].groupId);}
async _addFile(name,{documentId,file,url}){if(!url){if(!file&&!documentId){return;}
url=URL.createObjectURL(file);}
this.state.uploadingLock=true;const fileId=_.uniqueId('file');const pdf=await this._getPdf(url);if(file){this._newFiles[fileId]={type:'file',file};}else if(documentId){this._newFiles[fileId]={type:'document',documentId};}
name=name||_t("New File");const extIndex=name.indexOf('.pdf');if(extIndex>=0){name=name.substring(0,extIndex);}
const pageCount=pdf.numPages;const{pageIds,newPages}=this._createPages({fileId,name,pageCount});await this._loadCanvases({newPages,pageCount,pdf});this._newFiles[fileId].pageIds=this._newFiles[fileId].activePageIds=pageIds;this.state.uploadingLock=false;}
_addPage(pageId,groupId,{index}={}){if(!this.state.groupData[groupId]){return;}
this._removePage(pageId);if(index!==undefined){this.state.groupData[groupId].pageIds.splice(index,0,pageId);}else{this.state.groupData[groupId].pageIds.push(pageId);}
this.state.pages[pageId].groupId=groupId;}
async _applyChanges(ruleId){const processedPageIds=this.activePageIds;if(processedPageIds.length===0){this.trigger('pdf-manager-error',{message:_t("No document has been selected")});return;}
const pageIds=this.ignoredPageIds;for(const pageId of pageIds){this._removePage(pageId);}
const exit=!pageIds.length;try{const result=await this._sendChanges({exit,ruleId});const documentIds=JSON.parse(result);this.trigger('process-documents',{documentIds,ruleId,exit});if(!exit){for(const pageId of processedPageIds){this._removePage(pageId,{fromFile:true});}
this._createGroup({name:_t("Remaining Pages"),pageIds,isSelected:true});}}catch(error){this.trigger('pdf-manager-error',{message:error.message});if(pageIds.length){this._createGroup({name:_t("Remaining Pages"),pageIds:pageIds,isSelected:true});}}finally{this.state.uploadingLock=false;this.state.anchorId=undefined;}}
_createGroup({name,pageIds,index,isSelected}={}){const groupId=_.uniqueId('group');pageIds=pageIds||[];this.state.groupData[groupId]={groupId,name:name||_t("New Group"),pageIds,};for(const pageId of pageIds){this.state.pages[pageId].groupId=groupId;if(isSelected!==undefined){this.state.pages[pageId].isSelected=isSelected;}}
if(index){this.state.groupIds.splice(index,0,groupId);}else{this.state.groupIds.push(groupId);}
return groupId;}
_createPages({fileId,name,pageCount}){let groupId;let groupName=name;let groupLock=false;const pageIds=[];const newPages={};for(let pageNumber=1;pageNumber<=pageCount;pageNumber++){if(!groupLock){groupId=this._createGroup({name:groupName});groupLock=this.props.documents.length>1;groupName=`${name}-p${pageNumber + 1}`;}
const pageId=_.uniqueId('page');this.state.pages[pageId]={pageId,groupId,fileId,localPageNumber:pageNumber,isSelected:true,};newPages[pageNumber]=pageId;this._pageCanvas[pageId]={};this.state.groupData[groupId].pageIds.push(pageId);pageIds.push(pageId);}
return{pageIds,newPages};}
_createXhr(){return new window.XMLHttpRequest();}
async _getPdf(url){return window.pdfjsLib.getDocument(url).promise;}
async _loadAssets(){let asset;try{asset=await ajax.loadAsset('documents.pdf_js_assets');}catch(error){asset=await ajax.loadAsset('web.pdf_js_lib');}finally{await ajax.loadLibs(asset);}}
async _loadCanvases({newPages,pageCount,pdf}){for(let pageNumber=1;pageNumber<=pageCount;pageNumber++){const pageId=newPages[pageNumber];const page=await pdf.getPage(pageNumber);const canvas=await this._renderCanvas(page,{width:160,height:230,});this._pageCanvas[pageId]={page,canvas};const pdfPage=this.__owl__.refs[`PdfPage_${pageId}`];if(pdfPage){pdfPage.renderPage(canvas);}}}
_removeGroup(groupId){if(this.state.groupData[groupId].pageIds.length>0){return;}
for(const pageId in this.state.pages){const page=this.state.pages[pageId];if(page.groupId===groupId){page.groupId=false;}}
this.state.groupIds=this.state.groupIds.filter(listedGroupId=>listedGroupId!==groupId);delete this.state.groupData[groupId];}
_removePage(pageId,{fromFile}={}){const page=this.state.pages[pageId];if(!page){return;}
const pageIds=this.state.groupData[page.groupId].pageIds;this.state.groupData[page.groupId].pageIds=pageIds.filter(number=>number!==pageId);if(page.groupId){this._removeGroup(page.groupId);}
page.groupId=false;if(fromFile){const activePageIds=this._newFiles[page.fileId].activePageIds;this._newFiles[page.fileId].activePageIds=activePageIds.filter(number=>number!==pageId);if(this._newFiles[page.fileId].activePageIds.length===0){this._removeFile(page.fileId);}
page.fileId=false;}}
_removeFile(fileId){for(const pageId of this._newFiles[fileId].pageIds){delete this._pageCanvas[pageId];delete this.state.pages[pageId];}
delete this._newFiles[fileId];}
async _renderCanvas(page,{width,height}){const viewPort=page.getViewport({scale:1});const canvas=document.createElement("canvas");canvas.className="o_documents_pdf_canvas";canvas.width=width;canvas.height=height;const scale=Math.min(canvas.width/viewPort.width,canvas.height/viewPort.height);await page.render({canvasContext:canvas.getContext("2d"),viewport:page.getViewport({scale}),}).promise;return canvas;}
async _sendChanges({exit,ruleId}={}){this.state.uploadingLock=true;const data=new FormData();const fileIds=[];const files=[];for(const key in this._newFiles){if(this._newFiles[key].type==='file'){files.push(this._newFiles[key].file);fileIds.push(key);}}
const fileGroups=JSON.parse(JSON.stringify(this.state.groupData));const newFiles=Object.values(fileGroups);newFiles.forEach((newFile)=>{newFile.new_pages=[];for(const pageId of newFile.pageIds){const fileId=this.state.pages[pageId].fileId;const file=this._newFiles[fileId];const old_file_type=file.type;const old_file_index=old_file_type==='file'?fileIds.indexOf(fileId):file.documentId;newFile.new_pages.push({old_file_type,old_file_index,old_page_number:this.state.pages[pageId].localPageNumber,});}
delete newFile.pageIds;});return new Promise((resolve,reject)=>{const xhr=this._createXhr();xhr.open('POST','/documents/pdf_split');data.append('csrf_token',csrf_token);for(const file of files){data.append('ufile',file);}
data.append('new_files',JSON.stringify(newFiles));data.append('archive',this.state.archive);const document=this.props.documents[0];data.append('vals',JSON.stringify({folder_id:document.folder_id.res_id,tag_ids:document.tag_ids.res_ids,owner_id:document.owner_id.res_id,partner_id:document.partner_id.res_id,}));xhr.send(data);xhr.onload=()=>{if(xhr.status===200){resolve(xhr.response);}else{reject(xhr.response);}};xhr.onerror=()=>{reject();};});}
_onClickArchive(ev){ev.stopPropagation;ev.target.blur();this.state.archive=!this.state.archive;}
_onClickDropdown(ev){markEventHandled(ev,'PdfManager.toggleDropdown');}
_onClickGlobalAdd(ev){ev.stopPropagation();const $uploadInput=$('<input/>',{type:'file',name:'files[]',multiple:'multiple',accept:'application/pdf',});$uploadInput.on('change',async e=>{const files=$uploadInput[0].files;$uploadInput.remove();for(const file of files){await this._addFile(file.name,{file});}});$uploadInput.click();}
_onClickGlobalClose(ev){ev.stopPropagation();this.trigger('process-documents',{exit:true});}
_onSelectClicked(ev){const{pageId,isCheckbox,isRangeSelection,isKeepSelection}=ev.detail;const selectedPageIds=this.activePageIds;const anchorId=this.state.anchorId||selectedPageIds[0];const recordIds=[];for(const groupId of this.state.groupIds){recordIds.push(...this.state.groupData[groupId].pageIds);}
const{newSelection,anchor}=computeMultiSelection(recordIds,pageId,{anchor:anchorId,isCheckbox,isKeepSelection,isRangeSelection:isRangeSelection&&anchorId,selected:selectedPageIds,});const selectionSet=new Set(newSelection);this.state.anchorId=anchor;for(const pageId in this.state.pages){this.state.pages[pageId].isSelected=selectionSet.has(pageId);}}
_onClickManager(ev){if(isEventHandled(ev,'PdfManager.toggleDropdown')){return;}
ev.stopPropagation();this.previewCanvas=undefined;this.state.viewedPage=undefined;}
async _onClickPage(ev){ev.stopPropagation();const pageId=ev.detail;const page=this._pageCanvas[pageId].page;if(!page){return;}
this.previewCanvas=await this._renderCanvas(page,{width:1300,height:1800,});this.state.viewedPage=pageId;}
_onClickPageSeparator(pageId,groupId,ev){ev.stopPropagation();const page=this.state.pages[pageId];const groupPageIds=this.state.groupData[groupId].pageIds;const pageIndex=groupPageIds.indexOf(pageId);const groupIndex=this.state.groupIds.indexOf(groupId);const isLastPage=pageIndex===groupPageIds.length-1;if(isLastPage){const targetGroupId=this.state.groupIds[groupIndex+1];if(targetGroupId){const pageIds=this.state.groupData[targetGroupId].pageIds;for(const pageId of pageIds){this._addPage(pageId,page.groupId);}}}else{const newGroupPages=groupPageIds.slice(pageIndex+1);const name=this.state.groupData[groupId].name;const newGroupId=this._createGroup({name,index:groupIndex+1,});for(const page of newGroupPages){this._addPage(page,newGroupId);}}}
_onClickPreview(ev){ev.stopPropagation();this.previewCanvas=undefined;this.state.viewedPage=undefined;}
_onClickRule(ruleId,ev){ev.stopPropagation();this._applyChanges(ruleId);}
_onClickSplit(ev){ev.stopPropagation();this._applyChanges();}
_onEditName(ev){ev.stopPropagation();const groupId=ev.detail.groupId;this.state.groupData[groupId].name=ev.detail.name||_t("unnamed");}
_onGlobalCaptureKeyup(ev){if(ev.code==='ShiftLeft'){this.state.lShiftKeyDown=false;}else if(ev.code==='ShiftRight'){this.state.rShiftKeyDown=false;}}
_onGlobalKeydown(ev){if($(ev.target).is('input')){return;}
if(ev.key==='A'){for(const pageId in this.state.pages){this.state.pages[pageId].isSelected=true;}}else if(ev.code==='ShiftLeft'){this.state.lShiftKeyDown=true;}else if(ev.code==='ShiftRight'){this.state.rShiftKeyDown=true;}}
_onPageDragStart(ev){ev.stopPropagation();}
_onPageDrop(ev){ev.stopPropagation();const targetPageId=ev.detail.targetPageId;const pageId=ev.detail.pageId;const targetGroupId=this.state.pages[targetPageId].groupId;const index=this.state.groupData[targetGroupId].pageIds.indexOf(targetPageId);this._addPage(pageId,targetGroupId,{index});}}
PdfManager.components={PdfPage,PdfGroupName};PdfManager.defaultProps={rules:[],};PdfManager.props={documents:Array,rules:Array,};PdfManager.template='documents.component.PdfManager';return PdfManager;});;

/* /documents/static/src/owl/components/pdf_page/pdf_page.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('documents.component.PdfPage',function(require){'use strict';const{useState,useRef}=owl.hooks;class PdfPage extends owl.Component{constructor(){super(...arguments);this.state=useState({isHover:false,isRendered:false,});this.canvasWrapperRef=useRef("canvasWrapper");}
mounted(){this.renderPage(this.props.canvas);}
patched(){this.renderPage(this.props.canvas);}
renderPage(canvas){if(!canvas||this.isRendered){return;}
this.canvasWrapperRef.el.appendChild(canvas);this.isRendered=true;}
_onClickWrapper(ev){ev.stopPropagation();this.trigger('page-clicked',this.props.pageId);}
_onClickSelect(ev){ev.stopPropagation();this.trigger('select-clicked',{pageId:this.props.pageId,isCheckbox:true,isRangeSelection:ev.shiftKey,isKeepSelection:true,});}
_onDragEnter(ev){ev.stopPropagation();ev.preventDefault();this.state.isHover=true;}
_onDragLeave(ev){ev.stopPropagation();ev.preventDefault();this.state.isHover=false;}
_onDragOver(ev){ev.preventDefault();}
_onDragStart(ev){ev.stopPropagation();this.trigger('page-dragged');ev.dataTransfer.setData('o_documents_pdf_data',this.props.pageId);}
_onDrop(ev){this.state.isHover=false;if(!ev.dataTransfer.types.includes('o_documents_pdf_data')){return;}
const pageId=ev.dataTransfer.getData('o_documents_pdf_data');if(pageId===this.props.pageId){return;}
this.trigger('page-dropped',{targetPageId:this.props.pageId,pageId});}}
PdfPage.defaultProps={isPreview:false,isSelected:false,};PdfPage.props={canvas:{type:Object,optional:true,},isPreview:Boolean,isSelected:Boolean,pageId:String,};PdfPage.template='documents.component.PdfPage';return PdfPage;});;

/* /documents/static/src/owl/components/pdf_group_name/pdf_group_name.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('documents.component.PdfGroupName',function(require){'use strict';const{useRef,useState}=owl.hooks;class PdfGroupName extends owl.Component{constructor(){super(...arguments);this.state=useState({edit:false,});this.nameInputRef=useRef('nameInput');}
_onBlur(){this.trigger('edit-name',{groupId:this.props.groupId,name:this.nameInputRef.el.value,});this.state.edit=false;}
_onClickGroupName(ev){ev.stopPropagation();this.state.edit=true;}
_onKeyDown(ev){if(ev.code!=="Enter"){return;}
ev.stopPropagation();this.trigger('edit-name',{groupId:this.props.groupId,name:this.nameInputRef.el.value,});this.state.edit=false;}}
PdfGroupName.props={groupId:String,name:String,};PdfGroupName.template='documents.component.PdfGroupName';return PdfGroupName;});;

/* /documents/static/src/js/systray_activity_menu.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('documents.systray.ActivityMenu',function(require){"use strict";var ActivityMenu=require('mail.systray.ActivityMenu');const session=require('web.session');ActivityMenu.include({events:_.extend({},ActivityMenu.prototype.events,{'click .o_sys_documents_request':'_onRequestDocument',}),async willStart(){await this._super(...arguments);this.hasDocumentUserGroup=await session.user_has_group('documents.group_documents_user');},_onRequestDocument:function(ev){ev.preventDefault();ev.stopPropagation();this.do_action('documents.action_request_form');},});});;

/* /documents/static/src/js/tours/documents.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('documents.tour',function(require){"use strict";const{_t}=require('web.core');const tour=require('web_tour.tour');tour.register('documents_tour',{url:"/web",rainbowManMessage:_t("Wow... 6 documents processed in a few seconds, You're good.<br/>The tour is complete. Try uploading your own documents now."),},[{trigger:'.o_app[data-menu-xmlid="documents.menu_root"]',content:_t("Want to become a <b>paperless company</b>? Let's discover Odoo Documents."),position:'bottom',},{trigger:'img[src="https://img.youtube.com/vi/Ayab6wZ_U1A/0.jpg"]',content:_t("Click on a thumbnail to <b>preview the document</b>."),position:'bottom',run:function(actions){$('.o_close_btn').click();},},{trigger:'.o_search_panel_filter_value:eq(0)',extra_trigger:'.o_search_panel_label',content:_t("Let's process documents in your Inbox.<br/><i>Tip: Use Tags to filter documents and structure your process.</i>"),position:'bottom',run:function(actions){$('.o_search_panel_filter_value:eq(0) .o_search_panel_label_title').click();},},{trigger:'.o_kanban_record:contains(invoice.png)',extra_trigger:'.o_documents_kanban',content:_t("Click on a card to <b>select the document</b>."),position:'bottom',},{trigger:'.o_inspector_rule[data-id="3"] .o_inspector_trigger_rule',extra_trigger:'.o_documents_image_background',content:_t("Let's tag this bill as legal<br/> <i>Tips: actions can be tailored to your process, according to the workspace.</i>"),position:'bottom',},{trigger:'.o_kanban_record:nth(0):contains(Mails_inbox.pdf)',extra_trigger:'.o_documents_kanban',content:_t("Let's process this document, coming from our scanner."),position:'bottom',},{trigger:'.o_inspector_split',extra_trigger:'[title="Mails_inbox.pdf"]',content:_t("As this PDF contains multiple documents, let's split and process in bulk."),position:'bottom',},{trigger:'.o_page_splitter_wrapper:nth(3)',extra_trigger:'.o_documents_pdf_canvas:nth(5)',content:_t("Click on the <b>page separator</b>: we don't want to split these two pages as they belong to the same document."),position:'right',},{trigger:'.o_documents_pdf_page_selector:nth(5)',extra_trigger:'.o_documents_pdf_manager',content:_t("<b>Deselect this page</b> as we plan to process all bills first."),position:'left',},{trigger:'.o_pdf_rule_buttons:first',extra_trigger:'.o_documents_pdf_manager',content:_t("Let's process these bills: send to Finance workspace."),position:'bottom',},{trigger:'.o_pdf_rule_buttons:nth-last-child(2)',extra_trigger:'.o_pdf_rule_buttons:not(:disabled)',content:_t("Send this letter to the legal department, by assigning the right tags."),position:'bottom',}]);});;

/* /helpdesk/static/src/js/helpdesk_dashboard.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('helpdesk.dashboard',function(require){"use strict";var core=require('web.core');var KanbanController=require('web.KanbanController');var KanbanModel=require('web.KanbanModel');var KanbanRenderer=require('web.KanbanRenderer');var KanbanView=require('web.KanbanView');var session=require('web.session');var view_registry=require('web.view_registry');var QWeb=core.qweb;var _t=core._t;var _lt=core._lt;var HelpdeskDashboardRenderer=KanbanRenderer.extend({events:_.extend({},KanbanRenderer.prototype.events,{'click .o_dashboard_action':'_onDashboardActionClicked','click .o_target_to_set':'_onDashboardTargetClicked',}),_notifyTargetChange:function(target_name,value){this.trigger_up('dashboard_edit_target',{target_name:target_name,target_value:value,});},_render:function(){var self=this;return this._super.apply(this,arguments).then(function(){var values=self.state.dashboardValues;var helpdesk_dashboard=QWeb.render('helpdesk.HelpdeskDashboard',{widget:self,show_demo:values.show_demo,rating_enable:values.rating_enable,success_rate_enable:values.success_rate_enable,values:values,});self.$el.prepend(helpdesk_dashboard);});},_onDashboardActionClicked:function(e){var self=this;e.preventDefault();var $action=$(e.currentTarget);var action_ref=$action.attr('name');var title=$action.attr('title');var search_view_ref=$action.attr('search_view_ref');if($action.attr('show_demo')!='true'){if($action.attr('name').includes("helpdesk.")){this._rpc({model:'helpdesk.ticket',method:'create_action',args:[action_ref,title,search_view_ref],}).then(function(result){if(result.action){self.do_action(result.action,{additional_context:$action.attr('context')});}});}
else{this.trigger_up('dashboard_open_action',{action_name:$action.attr('name'),});}}},_onDashboardTargetClicked:function(e){var self=this;var $target=$(e.currentTarget);var target_name=$target.attr('name');var target_value=$target.attr('value');var $input=$('<input/>',{type:"text",name:target_name});if(target_value){$input.attr('value',target_value);}
$input.on('keyup input',function(e){if(e.which===$.ui.keyCode.ENTER){self._notifyTargetChange(target_name,$input.val());}});$input.on('blur',function(){self._notifyTargetChange(target_name,$input.val());});$input.replaceAll($target).focus().select();},});var HelpdeskDashboardModel=KanbanModel.extend({init:function(){this.dashboardValues={};this._super.apply(this,arguments);},__get:function(localID){var result=this._super.apply(this,arguments);if(_.isObject(result)){result.dashboardValues=this.dashboardValues[localID];}
return result;},__load:function(){return this._loadDashboard(this._super.apply(this,arguments));},__reload:function(){return this._loadDashboard(this._super.apply(this,arguments));},_loadDashboard:function(super_def){var self=this;var dashboard_def=this._rpc({model:'helpdesk.team',method:'retrieve_dashboard',});return Promise.all([super_def,dashboard_def]).then(function(results){var id=results[0];var dashboardValues=results[1];self.dashboardValues[id]=dashboardValues;return id;});},});var HelpdeskDashboardController=KanbanController.extend({custom_events:_.extend({},KanbanController.prototype.custom_events,{dashboard_open_action:'_onDashboardOpenAction',dashboard_edit_target:'_onDashboardEditTarget',}),_onDashboardEditTarget:function(e){var target_name=e.data.target_name;var target_value=e.data.target_value;if(isNaN(target_value)){this.do_warn(false,_t("Please enter an integer value"));}else{var values={};values[target_name]=parseInt(target_value);this._rpc({model:'res.users',method:'write',args:[[session.uid],values],}).then(this.reload.bind(this));}},_onDashboardOpenAction:function(e){var self=this;var action_name=e.data.action_name;if(_.contains(['action_view_rating_today','action_view_rating_7days'],action_name)){return this._rpc({model:this.modelName,method:action_name}).then(function(data){if(data){return self.do_action(data);}});}
return this.do_action(action_name);},});var HelpdeskDashboardView=KanbanView.extend({config:_.extend({},KanbanView.prototype.config,{Model:HelpdeskDashboardModel,Renderer:HelpdeskDashboardRenderer,Controller:HelpdeskDashboardController,}),display_name:_lt('Dashboard'),icon:'fa-dashboard',searchview_hidden:true,});view_registry.add('helpdesk_dashboard',HelpdeskDashboardView);return{Model:HelpdeskDashboardModel,Renderer:HelpdeskDashboardRenderer,Controller:HelpdeskDashboardController,};});;

/* /helpdesk/static/src/js/tours/helpdesk.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('helpdesk.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('helpdesk_tour',{url:"/web",},[{trigger:'.o_app[data-menu-xmlid="helpdesk.menu_helpdesk_root"]',content:_t('Want to <b>boost your customer satisfaction</b>?<br/><i>Click Helpdesk to start.</i>'),position:'bottom',},{trigger:'.oe_kanban_action_button',extra_trigger:'.o_kanban_primary_left',content:_t('Click here to view this team\'s tickets.'),position:'bottom',width:200,},{trigger:'.o-kanban-button-new',extra_trigger:'.o_kanban_helpdesk_ticket',content:_t('Let\'s create your first ticket.'),position:'bottom',width:200,},{trigger:'input.field_name',extra_trigger:'.o_form_editable',content:_t('Enter a subject or title for this ticket.<br/><i>(e.g. Problem with installation, Wrong order, Can\'t understand bill, etc.)</i>'),position:'right',},{trigger:'.o_field_widget.field_partner_id',extra_trigger:'.o_form_editable',content:_t('Enter the customer. Feel free to create it on the fly.'),position:'top',},{trigger:'.o_field_widget.field_user_id',extra_trigger:'.o_form_editable',content:_t('Assign the ticket to someone.'),position:'right',},{trigger:'.o_form_button_save',content:_t('Save this ticket and the modifications you\'ve made to it.'),position:'bottom',},{trigger:'.o_back_button',extra_trigger:'.o_form_view.o_form_readonly',content:_t('Use the breadcrumbs to go back to the Kanban view.'),position:'bottom',},{trigger:'.o_kanban_record',content:_t('Click these cards to open their form view, or <b>drag &amp; drop</b> them through the different stages of this team.'),position:'right',run:"drag_and_drop .o_kanban_group:eq(2) ",},{trigger:'.o_priority',extra_trigger:'.o_kanban_record',content:_t('<b>Stars</b> mark the <b>ticket priority</b>. You can change it directly from here!'),position:'bottom',run:"drag_and_drop .o_kanban_group:eq(2) ",},{trigger:".o_column_quick_create .o_quick_create_folded",content:_t('Add columns to configure <b>stages for your tickets</b>.<br/><i>e.g. Awaiting Customer Feedback, Customer Followup, ...</i>'),position:'right',}]);});;

/* /hr_recruitment/static/src/js/recruitment.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('job.update_kanban',function(require){'use strict';var KanbanRecord=require('web.KanbanRecord');KanbanRecord.include({_openRecord:function(){if(this.modelName==='hr.job'&&this.$(".o_hr_job_boxes a").length){this.$(".o_hr_job_boxes a").first().click();}else{this._super.apply(this,arguments);}}});});;

/* /hr_recruitment/static/src/js/tours/hr_recruitment.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('hr_recruitment.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('hr_recruitment_tour',{url:"/web",rainbowManMessage:_t("<div>Great job! You hired a new colleague!</div><div>Try the Website app to publish job offers online.</div>"),},[tour.stepUtils.showAppsMenuItem(),{trigger:'.o_app[data-menu-xmlid="hr_recruitment.menu_hr_recruitment_root"]',content:_t("Let's have a look at how to <b>improve</b> your <b>hiring process</b>."),position:'right',edition:'community'},{trigger:'.o_app[data-menu-xmlid="hr_recruitment.menu_hr_recruitment_root"]',content:_t("Let's have a look at how to <b>improve</b> your <b>hiring process</b>."),position:'bottom',edition:'enterprise'},{trigger:".o-kanban-button-new",content:_t("Create your first Job Position."),position:"bottom",width:195},{trigger:".o_job_name",extra_trigger:'.o_hr_job_simple_form',content:_t("What do you want to recruit today? Choose a job title..."),position:"right"},{trigger:".o_job_alias",extra_trigger:'.o_hr_job_simple_form',content:_t("Choose an application email."),position:"right"},{trigger:'.o_create_job',content:_t('Let\'s create the position. An email will be setup for applications, and a public job description, if you use the Website app.'),position:'bottom',run:function(actions){actions.auto('.modal:visible .btn.btn-primary');},},{trigger:".oe_kanban_action_button",extra_trigger:'.o_hr_recruitment_kanban',content:_t("Let\'s have a look at the applications pipeline."),position:"bottom"},{trigger:".o_copy_paste_email",content:_t("Copy this email address, to paste it in your email composer, to apply."),position:"bottom"},{trigger:".breadcrumb-item:not(.active):last",extra_trigger:'.o_kanban_applicant',content:_t("Lets go back to the dashboard."),position:"bottom"},{trigger:".oe_kanban_action_button",extra_trigger:'.o_hr_recruitment_kanban',content:_t("<b>Did you apply by sending an email?</b> Check incoming applications."),position:"bottom"},{trigger:".oe_kanban_card",extra_trigger:'.o_kanban_applicant',content:_t("<b>Drag this card</b>, to qualify him for a first interview."),position:"bottom",run:"drag_and_drop .o_kanban_group:eq(1) ",},{trigger:".oe_kanban_card",extra_trigger:'.o_kanban_applicant',content:_t("<b>Click to view</b> the application."),position:"bottom"},{trigger:".o_Chatter .o_ChatterTopbar_buttonSendMessage",extra_trigger:'.o_applicant_form',content:_t("<div><b>Try to send an email</b> to the applicant.</div><div><i>Tips: All emails sent or received are saved in the history here</i>"),position:"bottom"},{trigger:".o_Chatter .o_Composer_buttonSend",extra_trigger:'.o_applicant_form',content:_t("Send your email. Followers will get a copy of the communication."),position:"bottom"},{trigger:".o_Chatter .o_ChatterTopbar_buttonLogNote",extra_trigger:'.o_applicant_form',content:_t("Or talk about this applicant privately with your colleagues."),position:"bottom"},{trigger:".o_create_employee",extra_trigger:'.o_applicant_form',content:_t("Lets create this new employee now."),position:"bottom"},{trigger:".o_form_button_save",extra_trigger:".o_employee_form",content:_t("Save it !"),position:"bottom",width:80}]);});;

/* /im_livechat/static/src/js/im_livechat_channel_form_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('im_livechat.ImLivechatChannelFormView',function(require){"use strict";const ImLivechatChannelFormController=require('im_livechat.ImLivechatChannelFormController');const FormView=require('web.FormView');const viewRegistry=require('web.view_registry');const ImLivechatChannelFormView=FormView.extend({config:Object.assign({},FormView.prototype.config,{Controller:ImLivechatChannelFormController,}),});viewRegistry.add('im_livechat_channel_form_view_js',ImLivechatChannelFormView);return ImLivechatChannelFormView;});;

/* /im_livechat/static/src/js/im_livechat_channel_form_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('im_livechat.ImLivechatChannelFormController',function(require){'use strict';const FormController=require('web.FormController');const ImLivechatChannelFormController=FormController.extend({events:Object.assign({},FormController.prototype.events,{'click .o_im_livechat_channel_form_button_colors_reset_button':'_onClickLivechatButtonColorsResetButton','click .o_im_livechat_channel_form_chat_window_colors_reset_button':'_onClickLivechatChatWindowColorsResetButton',}),async _updateColors(colorValues){for(const name in colorValues){this.$(`[name="${name}"] .o_field_color`).css('background-color',colorValues[name]);}
const result=await this.model.notifyChanges(this.handle,colorValues);this._updateRendererState(this.model.get(this.handle),{fieldNames:result});},async _onClickLivechatButtonColorsResetButton(){await this._updateColors({button_background_color:"#878787",button_text_color:"#FFFFFF",});},async _onClickLivechatChatWindowColorsResetButton(){await this._updateColors({header_background_color:"#875A7B",title_color:"#FFFFFF",});},});return ImLivechatChannelFormController;});;

/* /im_livechat/static/src/bugfix/bugfix.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('im_livechat/static/src/bugfix/bugfix.js',function(require){'use strict';});;

/* /im_livechat/static/src/components/discuss/discuss.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('im_livechat/static/src/components/discuss/discuss.js',function(require){'use strict';const components={Discuss:require('mail/static/src/components/discuss/discuss.js'),};const{patch}=require('web.utils');patch(components.Discuss,'im_livechat/static/src/components/discuss/discuss.js',{mobileNavbarTabs(...args){return[...this._super(...args),{icon:'fa fa-comments',id:'livechat',label:this.env._t("Livechat"),}];}});});;

/* /im_livechat/static/src/components/discuss_sidebar/discuss_sidebar.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('im_livechat/static/src/components/discuss_sidebar/discuss_sidebar.js',function(require){'use strict';const components={DiscussSidebar:require('mail/static/src/components/discuss_sidebar/discuss_sidebar.js'),};const{patch}=require('web.utils');patch(components.DiscussSidebar,'im_livechat/static/src/components/discuss_sidebar/discuss_sidebar.js',{quickSearchOrderedAndPinnedLivechatList(){const allOrderedAndPinnedLivechats=this.env.models['mail.thread'].all(thread=>thread.channel_type==='livechat'&&thread.isPinned&&thread.model==='mail.channel').sort((c1,c2)=>{if(c1.lastMessage&&c2.lastMessage){return c2.lastMessage.id-c1.lastMessage.id;}
if(!c1.lastMessage){return-1;}
if(!c2.lastMessage){return 1;}
return c2.id-c1.id;});if(!this.discuss.sidebarQuickSearchValue){return allOrderedAndPinnedLivechats;}
const qsVal=this.discuss.sidebarQuickSearchValue.toLowerCase();return allOrderedAndPinnedLivechats.filter(livechat=>{const nameVal=livechat.displayName.toLowerCase();return nameVal.includes(qsVal);});},_useStoreCompareDepth(){return Object.assign(this._super(...arguments),{allOrderedAndPinnedLivechats:1,});},_useStoreSelector(props){return Object.assign(this._super(...arguments),{allOrderedAndPinnedLivechats:this.env.models['mail.thread'].all(thread=>thread.channel_type==='livechat'&&thread.isPinned&&thread.model==='mail.channel').map(livechat=>livechat.__state),});},});});;

/* /im_livechat/static/src/components/discuss_sidebar_item/discuss_sidebar_item.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('im_livechat/static/src/components/discuss_sidebar_item/discuss_sidebar_item.js',function(require){'use strict';const components={DiscussSidebarItem:require('mail/static/src/components/discuss_sidebar_item/discuss_sidebar_item.js'),};const{patch}=require('web.utils');patch(components.DiscussSidebarItem,'im_livechat/static/src/components/discuss_sidebar_item/discuss_sidebar_item.js',{hasUnpin(...args){const res=this._super(...args);return res||this.thread.channel_type==='livechat';}});});;

/* /im_livechat/static/src/components/notification_list/notification_list.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('im_livechat/static/src/components/notification_list/notification_list.js',function(require){'use strict';const components={NotificationList:require('mail/static/src/components/notification_list/notification_list.js'),};const{patch}=require('web.utils');components.NotificationList._allowedFilters.push('livechat');patch(components.NotificationList,'im_livechat/static/src/components/notification_list/notification_list.js',{_useStoreSelectorThreads(props){if(props.filter==='livechat'){return this.env.models['mail.thread'].all(thread=>thread.channel_type==='livechat'&&thread.isPinned&&thread.model==='mail.channel');}
return this._super(...arguments);},});});;

/* /im_livechat/static/src/components/thread_needaction_preview/thread_needaction_preview.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('im_livechat/static/src/components/thread_needaction_preview/thread_needaction_preview.js',function(require){'use strict';const components={ThreadNeedactionPreview:require('mail/static/src/components/thread_needaction_preview/thread_needaction_preview.js'),};const{patch}=require('web.utils');patch(components.ThreadNeedactionPreview,'thread_needaction_preview',{image(...args){if(this.thread.channel_type==='livechat'){return'/mail/static/src/img/smiley/avatar.jpg';}
return this._super(...args);}});});;

/* /im_livechat/static/src/components/thread_preview/thread_preview.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('im_livechat/static/src/components/thread_preview/thread_preview.js',function(require){'use strict';const components={ThreadPreview:require('mail/static/src/components/thread_preview/thread_preview.js'),};const{patch}=require('web.utils');patch(components.ThreadPreview,'im_livechat/static/src/components/thread_preview/thread_preview.js',{image(...args){if(this.thread.channel_type==='livechat'){return'/mail/static/src/img/smiley/avatar.jpg';}
return this._super(...args);}});});;

/* /im_livechat/static/src/models/messaging_initializer/messaging_initializer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('im_livechat/static/src/models/messaging_initializer/messaging_initializer.js',function(require){'use strict';const{registerInstancePatchModel}=require('mail/static/src/model/model_core.js');const{executeGracefully}=require('mail/static/src/utils/utils.js');registerInstancePatchModel('mail.messaging_initializer','im_livechat/static/src/models/messaging_initializer/messaging_initializer.js',{async _initChannels(initMessagingData){await this.async(()=>this._super(initMessagingData));const{channel_livechat=[]}=initMessagingData;return executeGracefully(channel_livechat.map(data=>()=>{const channel=this.env.models['mail.thread'].insert(this.env.models['mail.thread'].convertData(data),);if(!channel.isPinned){channel.pin();}}));},});});;

/* /im_livechat/static/src/models/messaging_notification_handler/messaging_notification_handler.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('im_livechat/static/src/models/messaging_notification_handler/messaging_notification_handler.js',function(require){'use strict';const{registerInstancePatchModel}=require('mail/static/src/model/model_core.js');registerInstancePatchModel('mail.messaging_notification_handler','im_livechat/static/src/models/messaging_notification_handler/messaging_notification_handler.js',{_handleNotificationChannelTypingStatus(channelId,data){const{partner_id,partner_name}=data;const channel=this.env.models['mail.thread'].findFromIdentifyingData({id:channelId,model:'mail.channel',});if(!channel){return;}
let partnerId;let partnerName;if(partner_id===this.env.messaging.publicPartner.id){partnerId=channel.correspondent.id;partnerName=channel.correspondent.name;}else{partnerId=partner_id;partnerName=partner_name;}
this._super(channelId,Object.assign(data,{partner_id:partnerId,partner_name:partnerName,}));},});});;

/* /im_livechat/static/src/models/partner/partner.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('im_livechat/static/src/models/partner/partner.js',function(require){'use strict';const{registerClassPatchModel,}=require('mail/static/src/model/model_core.js');let nextPublicId=-1;registerClassPatchModel('mail.partner','im_livechat/static/src/models/partner/partner.js',{getNextPublicId(){const id=nextPublicId;nextPublicId-=1;return id;},});});;

/* /im_livechat/static/src/models/thread/thread.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('im_livechat/static/src/models/thread/thread.js',function(require){'use strict';const{registerClassPatchModel,registerInstancePatchModel,}=require('mail/static/src/model/model_core.js');registerClassPatchModel('mail.thread','im_livechat/static/src/models/thread/thread.js',{convertData(data){const data2=this._super(data);if('livechat_visitor'in data&&data.livechat_visitor){if(!data2.members){data2.members=[];}
if(!data.livechat_visitor.id){data2.members.push(['unlink',this.env.messaging.publicPartner]);const partner=this.env.models['mail.partner'].create(Object.assign(this.env.models['mail.partner'].convertData(data.livechat_visitor),{id:this.env.models['mail.partner'].getNextPublicId()}));data2.members.push(['link',partner]);data2.correspondent=[['link',partner]];}else{const partnerData=this.env.models['mail.partner'].convertData(data.livechat_visitor);data2.members.push(['insert',partnerData]);data2.correspondent=[['insert',partnerData]];}}
return data2;},});registerInstancePatchModel('mail.thread','im_livechat/static/src/models/thread/thread.js',{_computeCorrespondent(){if(this.channel_type==='livechat'){return[];}
return this._super();},_computeDisplayName(){if(this.channel_type==='livechat'&&this.correspondent){if(this.correspondent.country){return`${this.correspondent.nameOrDisplayName} (${this.correspondent.country.name})`;}
return this.correspondent.nameOrDisplayName;}
return this._super();},_computeIsChatChannel(){return this.channel_type==='livechat'||this._super();},});});;

/* /im_livechat/static/src/widgets/discuss/discuss.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('im_livechat/static/src/widgets/discuss/discuss.js',function(require){'use strict';const Discuss=require('mail/static/src/widgets/discuss/discuss.js');Discuss.include({_shouldHaveInviteButton(){if(this.discuss.thread&&this.discuss.thread.channel_type==='livechat'){return true;}
return this._super();},});});;

/* /mass_mailing/static/src/js/mass_mailing.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mass_mailing.mass_mailing',function(require){"use strict";var KanbanColumn=require('web.KanbanColumn');KanbanColumn.include({init:function(){this._super.apply(this,arguments);if(this.modelName==='mailing.mailing'){this.draggable=false;}},});});;

/* /mass_mailing/static/src/js/mass_mailing_widget.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mass_mailing.FieldHtml',function(require){'use strict';var config=require('web.config');var core=require('web.core');var FieldHtml=require('web_editor.field.html');var fieldRegistry=require('web.field_registry');var convertInline=require('web_editor.convertInline');var _t=core._t;var MassMailingFieldHtml=FieldHtml.extend({xmlDependencies:(FieldHtml.prototype.xmlDependencies||[]).concat(["/mass_mailing/static/src/xml/mass_mailing.xml"]),jsLibs:['/mass_mailing/static/src/js/mass_mailing_link_dialog_fix.js',],custom_events:_.extend({},FieldHtml.prototype.custom_events,{snippets_loaded:'_onSnippetsLoaded',}),init:function(){this._super.apply(this,arguments);if(!this.nodeOptions.snippets){this.nodeOptions.snippets='mass_mailing.email_designer_snippets';}
this.__extraAssetsForIframe=[{jsLibs:['/mass_mailing/static/src/js/mass_mailing_snippets.js'],}];},commitChanges:function(){var self=this;if(config.isDebug()&&this.mode==='edit'){var layoutInfo=$.summernote.core.dom.makeLayoutInfo(this.wysiwyg.$editor);$.summernote.pluginEvents.codeview(undefined,undefined,layoutInfo,false);}
if(this.mode==='readonly'||!this.isRendered){return this._super();}
var fieldName=this.nodeOptions['inline-field'];if(this.$content.find('.o_basic_theme').length){this.$content.find('*').css('font-family','');}
var $editable=this.wysiwyg.getEditable();return this.wysiwyg.saveModifiedImages(this.$content).then(function(){return self.wysiwyg.save().then(function(result){self._isDirty=result.isDirty;convertInline.attachmentThumbnailToLinkImg($editable);convertInline.fontToImg($editable);convertInline.classToStyle($editable);self.trigger_up('field_changed',{dataPointID:self.dataPointID,changes:_.object([fieldName],[self._unWrap($editable.html())])});if(self._isDirty&&self.mode==='edit'){return self._doAction();}});});},getDatarecord:function(){return _.omit(this._super(),['mailing_domain','contact_list_ids','body_html','attachment_ids']);},_checkIfMustForceThemeChoice:function(){var firstChoice=this._editableAreaIsEmpty();this.$content.closest('body').toggleClass("o_force_mail_theme_choice",firstChoice);return firstChoice;},_editableAreaIsEmpty:function($layout){$layout=$layout||this.$content.find(".o_layout");var $mailWrapper=$layout.children(".o_mail_wrapper");var $mailWrapperContent=$mailWrapper.find('.o_mail_wrapper_td');if(!$mailWrapperContent.length){$mailWrapperContent=$mailWrapper;}
var value;if($mailWrapperContent.length>0){value=$mailWrapperContent.html();}else if($layout.length){value=$layout.html();}else{value=this.wysiwyg.getValue();}
var blankEditable="<p><br></p>";return value===""||value===blankEditable;},_renderEdit:function(){this._isFromInline=!!this.value;if(!this.value){this.value=this.recordData[this.nodeOptions['inline-field']];}
return this._super.apply(this,arguments);},_renderReadonly:function(){this.value=this.recordData[this.nodeOptions['inline-field']];return this._super.apply(this,arguments);},_renderTranslateButton:function(){var fieldName=this.nodeOptions['inline-field'];if(_t.database.multi_lang&&this.record.fields[fieldName].translate&&this.res_id){return $('<button>',{type:'button','class':'o_field_translate fa fa-globe btn btn-link',}).on('click',this._onTranslate.bind(this));}
return $();},_getSelectedTheme:function(themesParams){var $layout=this.$content.find(".o_layout");var selectedTheme=false;if($layout.length!==0){_.each(themesParams,function(themeParams){if($layout.hasClass(themeParams.className)){selectedTheme=themeParams;}});}
return selectedTheme;},_switchImages:function(themeParams,$container){if(!themeParams){return;}
$container.find("img").each(function(){var $img=$(this);var src=$img.attr("src");var m=src.match(/^\/web\/image\/\w+\.s_default_image_(?:theme_[a-z]+_)?(.+)$/);if(!m){m=src.match(/^\/\w+\/static\/src\/img\/(?:theme_[a-z]+\/)?s_default_image_(.+)\.[a-z]+$/);}
if(!m){return;}
var file=m[1];var img_info=themeParams.get_image_info(file);if(img_info.format){src="/"+img_info.module+"/static/src/img/theme_"+themeParams.name+"/s_default_image_"+file+"."+img_info.format;}else{src="/web/image/"+img_info.module+".s_default_image_theme_"+themeParams.name+"_"+file;}
$img.attr("src",src);});},_switchThemes:function(firstChoice,themeParams){if(!themeParams||this.switchThemeLast===themeParams){return;}
this.switchThemeLast=themeParams;this.$content.closest('body').removeClass(this._allClasses).addClass(themeParams.className);var $old_layout=this.$content.find('.o_layout');var $new_wrapper;var $newWrapperContent;if(themeParams.nowrap){$new_wrapper=$('<div/>',{class:'oe_structure'});$newWrapperContent=$new_wrapper;}else{$new_wrapper=$('<table/>',{class:'o_mail_wrapper'});$newWrapperContent=$('<td/>',{class:'o_mail_no_options o_mail_wrapper_td oe_structure'});$new_wrapper.append($('<tr/>').append($('<td/>',{class:'o_mail_no_resize o_not_editable',contenteditable:'false'}),$newWrapperContent,$('<td/>',{class:'o_mail_no_resize o_not_editable',contenteditable:'false'})));}
var $newLayout=$('<div/>',{class:'o_layout '+themeParams.className}).append($new_wrapper);var $contents;if(firstChoice){$contents=themeParams.template;}else if($old_layout.length){$contents=($old_layout.hasClass('oe_structure')?$old_layout:$old_layout.find('.oe_structure').first()).contents();}else{$contents=this.$content.find('.o_editable').contents();}
$newWrapperContent.append($contents);this._switchImages(themeParams,$newWrapperContent);this.$content.find('.o_editable').empty().append($newLayout);$old_layout.remove();if(firstChoice){$newWrapperContent.find('*').addBack().contents().filter(function(){return this.nodeType===3&&this.textContent.match(/\S/);}).parent().addClass('o_default_snippet_text');if(themeParams.name=='basic'){this.$content.focusIn();}}
this.wysiwyg.trigger('reload_snippet_dropzones');},_onLoadWysiwyg:function(){if(this._isFromInline){this._fromInline();}
if(this.snippetsLoaded){this._onSnippetsLoaded(this.snippetsLoaded);}
this._super();},_onSnippetsLoaded:function(ev){var self=this;if(!this.$content){this.snippetsLoaded=ev;return;}
var $snippetsSideBar=ev.data;var $themes=$snippetsSideBar.find("#email_designer_themes").children();var $snippets=$snippetsSideBar.find(".oe_snippet");var $snippets_menu=$snippetsSideBar.find("#snippets_menu");if(config.device.isMobile){$snippetsSideBar.hide();this.$content.attr('style','padding-left: 0px !important');}
if($themes.length===0){return;}
this._allClasses="";var themesParams=_.map($themes,function(theme){var $theme=$(theme);var name=$theme.data("name");var classname="o_"+name+"_theme";self._allClasses+=" "+classname;var imagesInfo=_.defaults($theme.data("imagesInfo")||{},{all:{}});_.each(imagesInfo,function(info){info=_.defaults(info,imagesInfo.all,{module:"mass_mailing",format:"jpg"});});return{name:name,className:classname||"",img:$theme.data("img")||"",template:$theme.html().trim(),nowrap:!!$theme.data('nowrap'),get_image_info:function(filename){if(imagesInfo[filename]){return imagesInfo[filename];}
return imagesInfo.all;}};});$themes.parent().remove();var $dropdown=$(core.qweb.render("mass_mailing.theme_selector",{themes:themesParams})).dropdown();var firstChoice=this._checkIfMustForceThemeChoice();var $mail_themes_upgrade=$dropdown.find(".o_mass_mailing_themes_upgrade");$mail_themes_upgrade.on("click",function(e){e.stopImmediatePropagation();e.preventDefault();self.do_action("mass_mailing.action_mass_mailing_configuration");});var selectedTheme=false;$dropdown.on("mouseenter",".dropdown-item",function(e){if(firstChoice){return;}
e.preventDefault();var themeParams=themesParams[$(e.currentTarget).index()];self._switchThemes(firstChoice,themeParams);});$dropdown.on("mouseleave",".dropdown-item",function(e){self._switchThemes(false,selectedTheme);});$dropdown.on("click",'[data-toggle="dropdown"]',function(e){var $menu=$dropdown.find('.dropdown-menu');var isVisible=$menu.hasClass('show');if(isVisible){e.preventDefault();e.stopImmediatePropagation();$menu.removeClass('show');}});$dropdown.on("click",".dropdown-item",function(e){e.preventDefault();e.stopImmediatePropagation();var themeParams=themesParams[$(e.currentTarget).index()];if(firstChoice){self._switchThemes(firstChoice,themeParams);self.$content.closest('body').removeClass("o_force_mail_theme_choice");firstChoice=false;if($mail_themes_upgrade.length){$dropdown.remove();$snippets_menu.empty();}}
self._switchImages(themeParams,$snippets);selectedTheme=themeParams;self.wysiwyg.getEditable().trigger('change');$dropdown.find('.dropdown-menu').removeClass('show');$dropdown.find('.dropdown-item.selected').removeClass('selected');$dropdown.find('.dropdown-item:eq('+themesParams.indexOf(selectedTheme)+')').addClass('selected');});$dropdown.on("shown.bs.dropdown",function(){selectedTheme=self._getSelectedTheme(themesParams);$dropdown.find(".dropdown-item").removeClass("selected").filter(function(){return($(this).has(".o_thumb[style=\""+"background-image: url("+(selectedTheme&&selectedTheme.img)+"_small.png)"+"\"]").length>0);}).addClass("selected");});$dropdown.on("hidden.bs.dropdown",function(){self._switchThemes(firstChoice,selectedTheme);});selectedTheme=this._getSelectedTheme(themesParams);if(selectedTheme){this.$content.closest('body').addClass(selectedTheme.className);$dropdown.find('.dropdown-item:eq('+themesParams.indexOf(selectedTheme)+')').addClass('selected');this._switchImages(selectedTheme,$snippets);}else if(this.$content.find('.o_layout').length){themesParams.push({name:'o_mass_mailing_no_theme',className:'o_mass_mailing_no_theme',img:"",template:this.$content.find('.o_layout').addClass('o_mass_mailing_no_theme').clone().find('oe_structure').empty().end().html().trim(),nowrap:true,get_image_info:function(){}});selectedTheme=this._getSelectedTheme(themesParams);}
$dropdown.insertAfter($snippets_menu);},_onTranslate:function(ev){this.trigger_up('translate',{fieldName:this.nodeOptions['inline-field'],id:this.dataPointID,isComingFromTranslationAlert:false,});},});fieldRegistry.add('mass_mailing_html',MassMailingFieldHtml);return MassMailingFieldHtml;});;

/* /mass_mailing/static/src/js/mass_mailing_list_kanban_record.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mass_mailing.ListKanbanRecord',function(require){"use strict";var KanbanRecord=require('web.KanbanRecord');var MassMailingListKanbanRecord=KanbanRecord.extend({_openRecord:function(){this.$('.o_mailing_list_kanban_boxes a').first().click();}});return MassMailingListKanbanRecord;});;

/* /mass_mailing/static/src/js/mass_mailing_list_kanban_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mass_mailing.ListKanbanRenderer',function(require){"use strict";var MassMailingListKanbanRecord=require('mass_mailing.ListKanbanRecord');var KanbanRenderer=require('web.KanbanRenderer');var MassMailingListKanbanRenderer=KanbanRenderer.extend({config:_.extend({},KanbanRenderer.prototype.config,{KanbanRecord:MassMailingListKanbanRecord,})});return MassMailingListKanbanRenderer;});;

/* /mass_mailing/static/src/js/mass_mailing_list_kanban_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mass_mailing.ListKanbanView',function(require){"use strict";var MassMailingListKanbanRenderer=require('mass_mailing.ListKanbanRenderer');var KanbanView=require('web.KanbanView');var view_registry=require('web.view_registry');var MassMailingListKanbanView=KanbanView.extend({config:_.extend({},KanbanView.prototype.config,{Renderer:MassMailingListKanbanRenderer,}),});view_registry.add('mass_mailing_list_kanban',MassMailingListKanbanView);return MassMailingListKanbanView;});;

/* /mass_mailing/static/src/js/unsubscribe.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mass_mailing.unsubscribe',function(require){'use strict';var session=require('web.session');var ajax=require('web.ajax');var core=require('web.core');require('web.dom_ready');var _t=core._t;var email=$("input[name='email']").val();var mailing_id=parseInt($("input[name='mailing_id']").val());var res_id=parseInt($("input[name='res_id']").val());var token=(location.search.split('token'+'=')[1]||'').split('&')[0];if(!$('.o_unsubscribe_form').length){return Promise.reject("DOM doesn't contain '.o_unsubscribe_form'");}
session.load_translations().then(function(){if(email!=''&&email!=undefined){ajax.jsonRpc('/mailing/blacklist/check','call',{'email':email,'mailing_id':mailing_id,'res_id':res_id,'token':token}).then(function(result){if(result=='unauthorized'){$('#button_add_blacklist').hide();$('#button_remove_blacklist').hide();}
else if(result==true){$('#button_remove_blacklist').show();toggle_opt_out_section(false);}
else if(result==false){$('#button_add_blacklist').show();toggle_opt_out_section(true);}
else{$('#subscription_info').html(_t('An error occured. Please try again later or contact us.'));$('#info_state').removeClass('alert-success').removeClass('alert-info').removeClass('alert-warning').addClass('alert-error');}}).guardedCatch(function(){$('#subscription_info').html(_t('An error occured. Please try again later or contact us.'));$('#info_state').removeClass('alert-success').removeClass('alert-info').removeClass('alert-warning').addClass('alert-error');});}
else{$('#div_blacklist').hide();}
var unsubscribed_list=$("input[name='unsubscribed_list']").val();if(unsubscribed_list){$('#subscription_info').html(_.str.sprintf(_t("You have been <strong>successfully unsubscribed from %s</strong>."),_.escape(unsubscribed_list)));}
else{$('#subscription_info').html(_t('You have been <strong>successfully unsubscribed</strong>.'));}});$('#unsubscribe_form').on('submit',function(e){e.preventDefault();var checked_ids=[];$("input[type='checkbox']:checked").each(function(i){checked_ids[i]=parseInt($(this).val());});var unchecked_ids=[];$("input[type='checkbox']:not(:checked)").each(function(i){unchecked_ids[i]=parseInt($(this).val());});ajax.jsonRpc('/mail/mailing/unsubscribe','call',{'opt_in_ids':checked_ids,'opt_out_ids':unchecked_ids,'email':email,'mailing_id':mailing_id,'res_id':res_id,'token':token}).then(function(result){if(result=='unauthorized'){$('#subscription_info').html(_t('You are not authorized to do this!'));$('#info_state').removeClass('alert-success').removeClass('alert-info').removeClass('alert-error').addClass('alert-warning');}
else if(result==true){$('#subscription_info').html(_t('Your changes have been saved.'));$('#info_state').removeClass('alert-info').addClass('alert-success');}
else{$('#subscription_info').html(_t('An error occurred. Your changes have not been saved, try again later.'));$('#info_state').removeClass('alert-info').addClass('alert-warning');}}).guardedCatch(function(){$('#subscription_info').html(_t('An error occurred. Your changes have not been saved, try again later.'));$('#info_state').removeClass('alert-info').addClass('alert-warning');});});$('#button_add_blacklist').click(function(e){e.preventDefault();ajax.jsonRpc('/mailing/blacklist/add','call',{'email':email,'mailing_id':mailing_id,'res_id':res_id,'token':token}).then(function(result){if(result=='unauthorized'){$('#subscription_info').html(_t('You are not authorized to do this!'));$('#info_state').removeClass('alert-success').removeClass('alert-info').removeClass('alert-error').addClass('alert-warning');}
else
{if(result){$('#subscription_info').html(_t('You have been successfully <strong>added to our blacklist</strong>. '
+'You will not be contacted anymore by our services.'));$('#info_state').removeClass('alert-warning').removeClass('alert-info').removeClass('alert-error').addClass('alert-success');toggle_opt_out_section(false);}
else{$('#subscription_info').html(_t('An error occured. Please try again later or contact us.'));$('#info_state').removeClass('alert-success').removeClass('alert-info').removeClass('alert-warning').addClass('alert-error');}
$('#button_add_blacklist').hide();$('#button_remove_blacklist').show();$('#unsubscribed_info').hide();}}).guardedCatch(function(){$('#subscription_info').html(_t('An error occured. Please try again later or contact us.'));$('#info_state').removeClass('alert-success').removeClass('alert-info').removeClass('alert-warning').addClass('alert-error');});});$('#button_remove_blacklist').click(function(e){e.preventDefault();ajax.jsonRpc('/mailing/blacklist/remove','call',{'email':email,'mailing_id':mailing_id,'res_id':res_id,'token':token}).then(function(result){if(result=='unauthorized'){$('#subscription_info').html(_t('You are not authorized to do this!'));$('#info_state').removeClass('alert-success').removeClass('alert-info').removeClass('alert-error').addClass('alert-warning');}
else
{if(result){$('#subscription_info').html(_t("You have been successfully <strong>removed from our blacklist</strong>. "
+"You are now able to be contacted by our services."));$('#info_state').removeClass('alert-warning').removeClass('alert-info').removeClass('alert-error').addClass('alert-success');toggle_opt_out_section(true);}
else{$('#subscription_info').html(_t('An error occured. Please try again later or contact us.'));$('#info_state').removeClass('alert-success').removeClass('alert-info').removeClass('alert-warning').addClass('alert-error');}
$('#button_add_blacklist').show();$('#button_remove_blacklist').hide();$('#unsubscribed_info').hide();}}).guardedCatch(function(){$('#subscription_info').html(_t('An error occured. Please try again later or contact us.'));$('#info_state').removeClass('alert-success').removeClass('alert-info').removeClass('alert-warning').addClass('alert-error');});});$('#button_feedback').click(function(e){var feedback=$("textarea[name='opt_out_feedback']").val();e.preventDefault();ajax.jsonRpc('/mailing/feedback','call',{'mailing_id':mailing_id,'res_id':res_id,'email':email,'feedback':feedback,'token':token}).then(function(result){if(result=='unauthorized'){$('#subscription_info').html(_t('You are not authorized to do this!'));$('#info_state').removeClass('alert-success').removeClass('alert-info').removeClass('alert-error').addClass('alert-warning');}
else if(result==true){$('#subscription_info').html(_t('Thank you! Your feedback has been sent successfully!'));$('#info_state').removeClass('alert-warning').removeClass('alert-info').removeClass('alert-error').addClass('alert-success');$("#div_feedback").hide();}
else{$('#subscription_info').html(_t('An error occured. Please try again later or contact us.'));$('#info_state').removeClass('alert-success').removeClass('alert-info').removeClass('alert-error').addClass('alert-warning');}}).guardedCatch(function(){$('#subscription_info').html(_t('An error occured. Please try again later or contact us.'));$('#info_state').removeClass('alert-info').removeClass('alert-success').removeClass('alert-error').addClass('alert-warning');});});});function toggle_opt_out_section(value){var result=!value;$("#div_opt_out").find('*').attr('disabled',result);$("#button_add_blacklist").attr('disabled',false);$("#button_remove_blacklist").attr('disabled',false);if(value){$('[name="button_subscription"]').addClass('clickable');}
else{$('[name="button_subscription"]').removeClass('clickable');}};

/* /planning/static/src/js/planning_gantt_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('planning.PlanningGanttController',function(require){'use strict';var GanttController=require('web_gantt.GanttController');var core=require('web.core');var _t=core._t;var Dialog=require('web.Dialog');var dialogs=require('web.view_dialogs');var QWeb=core.qweb;var PlanningGanttController=GanttController.extend({events:_.extend({},GanttController.prototype.events,{'click .o_gantt_button_copy_previous_week':'_onCopyWeekClicked','click .o_gantt_button_send_all':'_onSendAllClicked',}),renderButtons:function($node){var state=this.model.get();this.$buttons=$(QWeb.render('PlanningGanttView.buttons',{groupedBy:state.groupedBy,widget:this,SCALES:this.SCALES,activateScale:state.scale,allowedScales:this.allowedScales,activeActions:this.activeActions,}));if($node){this.$buttons.appendTo($node);}},_openDialog:function(resID,context){var self=this;var record=resID?_.findWhere(this.model.get().records,{id:resID,}):{};var title=resID?record.display_name:_t("Open");var dialog=new dialogs.FormViewDialog(this,{title:_.str.sprintf(title),res_model:this.modelName,view_id:this.dialogViews[0][0],res_id:resID,readonly:!this.is_action_enabled('edit'),deletable:this.is_action_enabled('edit')&&resID,context:_.extend({},this.context,context),on_saved:this.reload.bind(this,{}),on_remove:this._onDialogRemove.bind(this,resID),});dialog.on('closed',this,function(ev){self.reload();});dialog.on('execute_action',this,function(e){const action_name=e.data.action_data.name||e.data.action_data.special;const event_data=_.clone(e.data);let message;if(action_name==="unlink"){e.stopPropagation();message=_('Are you sure that you want to do delete this shift?');Dialog.confirm(self,message,{confirm_callback:function(evt){self.trigger_up('execute_action',event_data);_.delay(function(){self.dialog.destroy()},100);},cancel_callback:function(evt){self.dialog.$footer.find('button').removeAttr('disabled');}});}});self.dialog=dialog.open();return self.dialog;},_onCopyWeekClicked:function(ev){ev.preventDefault();var state=this.model.get();var self=this;self._rpc({model:self.modelName,method:'action_copy_previous_week',args:[self.model.convertToServerTime(state.startDate),this.model._getDomain(),],context:_.extend({},self.context||{}),}).then(function(){self.reload();});},_onSendAllClicked:function(ev){ev.preventDefault();var self=this;var state=this.model.get();var additional_context=_.extend({},this.context,{'default_start_datetime':this.model.convertToServerTime(state.startDate),'default_end_datetime':this.model.convertToServerTime(state.stopDate),'default_slot_ids':_.pluck(this.model.get().records,'id'),'scale':state.scale,'active_domain':this.model.domain,'active_ids':this.model.get().records,'default_employee_ids':_.filter(_.pluck(self.initialState.rows,'resId'),Boolean),});return this.do_action('planning.planning_send_action',{additional_context:additional_context,on_close:function(){self.reload();}});},_onScaleClicked:function(ev){this._super.apply(this,arguments);var $button=$(ev.currentTarget);var scale=$button.data('value');if(scale!=='week'){this.$('.o_gantt_button_copy_previous_week').hide();}else{this.$('.o_gantt_button_copy_previous_week').show();}},});return PlanningGanttController;});;

/* /planning/static/src/js/planning_gantt_row.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('planning.PlanningGanttRow',function(require){'use strict';const HrGanttRow=require('hr_gantt.GanttRow');const PlanningGanttRow=HrGanttRow.extend({template:'PlanningGanttView.Row'});return PlanningGanttRow;});;

/* /planning/static/src/js/planning_gantt_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('planning.PlanningGanttRenderer',function(require){'use strict';const HrGanttRenderer=require('hr_gantt.GanttRenderer');const PlanningGanttRow=require('planning.PlanningGanttRow');const PlanningGanttRenderer=HrGanttRenderer.extend({config:Object.assign({},HrGanttRenderer.prototype.config,{GanttRow:PlanningGanttRow}),sampleDataTargets:['.o_gantt_row:not([data-group-id=empty])',],async _renderView(){await this._super(...arguments);this.el.classList.add('o_planning_gantt');},_render:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.$el.addClass('o_planning_gantt');});},_renderRows:function(rows,groupedBy){const rowWidgets=this._super(rows,groupedBy);rowWidgets.forEach(rowWidget=>{this._generatePillLabels(rowWidget.pills,rowWidget.state.scale);});return rowWidgets;},_generatePillLabels:function(pills,scale){const dateFormat=moment.localeData().longDateFormat('l');const yearlessDateFormat=dateFormat.replace(/Y/gi,'').replace(/(\W)\1+/g,'$1').replace(/^\W|\W$/,'');pills.filter(pill=>!pill.consolidated).forEach(pill=>{const localStartDateTime=(pill.start_datetime||pill.startDate).clone().local();const localEndDateTime=(pill.end_datetime||pill.stopDate).clone().local();const spanAccrossDays=localStartDateTime.clone().startOf('day').diff(localEndDateTime.clone().startOf('day'),'days')!=0;const spanAccrossWeeks=localStartDateTime.clone().startOf('week').diff(localEndDateTime.clone().startOf('week'),'weeks')!=0;const spanAccrossMonths=localStartDateTime.clone().startOf('month').diff(localEndDateTime.clone().startOf('month'),'months')!=0;const labelElements=[];if(scale==='year'&&!spanAccrossDays){labelElements.push(localStartDateTime.format(yearlessDateFormat));}else if((scale==='day'&&spanAccrossDays)||(scale==='week'&&spanAccrossWeeks)||(scale==='month'&&spanAccrossMonths)||(scale==='year'&&spanAccrossDays)){labelElements.push(localStartDateTime.format(yearlessDateFormat));labelElements.push(localEndDateTime.format(yearlessDateFormat));}
if(!spanAccrossDays&&['week','month'].includes(scale)){labelElements.push(localStartDateTime.format('LT'),localEndDateTime.format('LT'));}
if(scale!=='month'||spanAccrossDays){labelElements.push(pill.display_name);}
pill.label=labelElements.filter(el=>!!el).join(' - ');});},});return PlanningGanttRenderer;});;

/* /planning/static/src/js/planning_gantt_model.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('planning.PlanningGanttModel',function(require){"use strict";var GanttModel=require('web_gantt.GanttModel');var _t=require('web.core')._t;var PlanningGanttModel=GanttModel.extend({__reload:function(handle,params){if('context'in params&&params.context.planning_groupby_role&&!params.groupBy.length){params.groupBy.unshift('employee_id');params.groupBy.unshift('role_id');}
return this._super(handle,params);},_generateRows:function(params){var rows=this._super(params);if(params.groupedBy&&params.groupedBy.length&&rows.length>1&&rows[0].resId){this._reorderEmptyRow(rows)}
this._renameOpenShifts(rows);if(!this.context.hide_open_shift&&!params.parentPath&&params.groupedBy&&params.groupedBy.includes('employee_id')){this._prependEmptyRow(rows,params.groupedBy);}
if(!this.context.hide_open_shift&&!params.parentPath&&params.groupedBy&&this._allowedEmptyGroups(params.groupedBy)){this._startGenerateEmptyRows(rows,params.groupedBy);}
return rows;},_generateEmptyRows:function(row,groupedBy,level=0,parentValues={},prependUndefined=false){var levelMax=groupedBy.length-1;var emptyRowId=row.id+'-empty';var emptyGroupId=row.id+'-empty';var undefinedGroupBy=groupedBy[level+1];parentValues[row.groupedByField]=row.resId?[row.resId,row.name]:false;if(prependUndefined){if(!row.rows||!row.rows.length||row.rows[0].resId){row.rows.unshift(this._createEmptyRow(emptyRowId,emptyGroupId,groupedBy.slice(level+1),row.path,level<levelMax-1));row.childrenRowIds.unshift(emptyRowId);if(level===levelMax-1){this._addGanttEmptyGroup(emptyGroupId,parentValues,undefinedGroupBy);}}
if(level<levelMax-1){this._generateEmptyRows(row.rows[0],groupedBy,level+1,parentValues,prependUndefined);}}else if(level<levelMax-1&&row.rows&&row.rows.length){row.rows.forEach((childRow)=>this._generateEmptyRows(childRow,groupedBy,level+1,parentValues));}else if(level===levelMax-1&&row.rows&&row.rows.length&&row.rows[0].resId){row.rows.unshift(this._createEmptyRow(emptyRowId,emptyGroupId,groupedBy.slice(level+1),row.path));row.childrenRowIds.unshift(emptyRowId);this._addGanttEmptyGroup(emptyGroupId,parentValues,undefinedGroupBy);}
if(row.rows){for(const subRow of row.rows){row.childrenRowIds=row.childrenRowIds.concat(subRow.childrenRowIds||[]);}
row.childrenRowIds=[...new Set(row.childrenRowIds)];}},_createEmptyRow:function(rowId,groupId,groupedBy,parentPath=null,isGroup=false){const groupedByField=groupedBy[0];const row={name:['employee_id','department_id'].includes(groupedByField)?_t('Open Shifts'):this._getFieldFormattedValue(false,this.ganttData.fields[groupedByField]),groupId:groupId,groupedBy,groupedByField,id:rowId,resId:false,isGroup:isGroup,isOpen:true,path:parentPath?parentPath+'/false':'false',records:[],unavailabilities:[],rows:isGroup?[]:null,childrenRowIds:isGroup?[]:null};this.allRows[rowId]=row;return row;},_addGanttEmptyGroup:function(groupId,parentValues,emptyKey){var group={id:groupId};Object.keys(parentValues).forEach((key)=>group[key]=parentValues[key]);group[emptyKey]=false;this.ganttData.groups.push(group);},_renameOpenShifts:function(rows){rows.filter(row=>['employee_id','department_id'].includes(row.groupedByField)&&!row.resId).forEach(row=>row.name=_t('Open Shifts'));},_reorderEmptyRow:function(rows){let emptyIndex=null;for(let i=0;i<rows.length;++i){if(!rows[i].resId){emptyIndex=i;break;}}
if(emptyIndex){const emptyRow=rows.splice(emptyIndex,1)[0];rows.unshift(emptyRow);}},_prependEmptyRow:function(rows,groupedBy){const prependEmptyRow=(rows.length===1&&!rows[0].id)||rows[0].resId;if(prependEmptyRow){if(!rows[0].id){rows.splice(0,1);}
rows.unshift(this._createEmptyRow('empty','empty',groupedBy,null,groupedBy.length>1));if(groupedBy.length===1){this._addGanttEmptyGroup('empty',{[groupedBy[0]]:false},groupedBy[0]);}}
if(groupedBy.length>1){this._generateEmptyRows(rows[0],groupedBy,0,{},true);}},_startGenerateEmptyRows:function(rows,groupedBy){if(groupedBy.length===1&&rows.length>0&&rows[0].resId){rows.unshift(this._createEmptyRow('empty','empty',groupedBy));this._addGanttEmptyGroup('empty',{},groupedBy[0]);}else if(groupedBy.length>1){rows.forEach((row)=>this._generateEmptyRows(row,groupedBy));}},_allowedEmptyGroups:function(groupedBy){return-1<this._getEmptyGroupsToDisplay().indexOf(groupedBy.join(','));},_getEmptyGroupsToDisplay:function(){return['role_id','role_id,employee_id','role_id,department_id','department_id','department_id,role_id','project_id','project_id,department_id','project_id,employee_id','project_id,role_id','project_id,task_id,employee_id','project_id,task_id,role_id','task_id','task_id,department_id','task_id,employee_id','task_id,role_id',];},});return PlanningGanttModel;});;

/* /planning/static/src/js/planning_gantt_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('planning.PlanningGanttView',function(require){'use strict';const HrGanttView=require('hr_gantt.GanttView');const PlanningGanttController=require('planning.PlanningGanttController');const PlanningGanttModel=require('planning.PlanningGanttModel');const PlanningGanttRenderer=require('planning.PlanningGanttRenderer');const view_registry=require('web.view_registry');const PlanningGanttView=HrGanttView.extend({config:Object.assign({},HrGanttView.prototype.config,{Renderer:PlanningGanttRenderer,Controller:PlanningGanttController,Model:PlanningGanttModel,}),});view_registry.add('planning_gantt',PlanningGanttView);return PlanningGanttView;});;

/* /planning/static/src/js/planning_calendar.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('planning.Calendar',function(require){"use strict";var core=require('web.core');var CalendarPopover=require('web.CalendarPopover');var CalendarRenderer=require('web.CalendarRenderer');var CalendarModel=require('web.CalendarModel');var CalendarView=require('web.CalendarView');var view_registry=require('web.view_registry');var QWeb=core.qweb;var PlanningCalendarPopover=CalendarPopover.extend({willStart:function(){const self=this;const check_group=this.getSession().user_has_group('planning.group_planning_manager').then(function(has_group){self.is_manager=has_group;});return Promise.all([this._super.apply(this,arguments),check_group]);},renderElement:function(){let render=$(QWeb.render(this.template,{widget:this}));if(!this.is_manager){render.find('.card-footer').remove();}
this._replaceElement(render);},_processFields:function(){var self=this;if(!CalendarPopover.prototype.origDisplayFields){CalendarPopover.prototype.origDisplayFields=_.extend({},this.displayFields);}else{this.displayFields=_.extend({},CalendarPopover.prototype.origDisplayFields);}
_.each(this.displayFields,function(def,field){if(self.event.extendedProps&&self.event.extendedProps.record&&!self.event.extendedProps.record[field]){delete self.displayFields[field];}});return this._super.apply(this,arguments);}});var PlanningCalendarModel=CalendarModel.extend({_loadCalendar:function(){var filter=this.data.filters['employee_id'].filters||{};const filteredCount=filter.reduce((n,value)=>n+value.active,0);this.data.context['planning_calendar_view']=true;this.data.context['planning_hide_employee']=filteredCount===1;return this._super.apply(this,arguments);}});var PlanningCalendarRenderer=CalendarRenderer.extend({config:_.extend({},CalendarRenderer.prototype.config,{CalendarPopover:PlanningCalendarPopover,}),});var PlanningCalendarView=CalendarView.extend({config:_.extend({},CalendarView.prototype.config,{Renderer:PlanningCalendarRenderer,Model:PlanningCalendarModel,}),});view_registry.add('planning_calendar',PlanningCalendarView);});;

/* /planning/static/src/js/tours/planning.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('planning.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('planning_tour',{'skip_enabled':false,},[{trigger:'.o_app[data-menu-xmlid="planning.planning_menu_root"]',content:_t("Let's start managing your employees' schedule!"),position:'bottom',},{trigger:".o_gantt_button_add",content:_t("Create your first shift by clicking on Add. Alternatively, you can use the (+) button on each cell."),position:"bottom",},{trigger:"button[special='save']",content:_t("Save this shift once it is ready."),position:"bottom",},{trigger:".o_gantt_button_send_all",content:_t("Send the schedule to your employees once it is ready."),position:"right",},{trigger:"button[name='action_send']",content:_t("Send the schedule and mark the shifts as published. Congratulations!"),position:"right",},]);});;

/* /project/static/src/js/project_kanban.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('project.project_kanban',function(require){'use strict';var KanbanController=require('web.KanbanController');var KanbanView=require('web.KanbanView');var KanbanColumn=require('web.KanbanColumn');var view_registry=require('web.view_registry');var KanbanRecord=require('web.KanbanRecord');KanbanRecord.include({_openRecord:function(){if(this.modelName==='project.project'&&this.$(".o_project_kanban_boxes a").length){this.$('.o_project_kanban_boxes a').first().click();}else{this._super.apply(this,arguments);}},});var ProjectKanbanController=KanbanController.extend({custom_events:_.extend({},KanbanController.prototype.custom_events,{'kanban_column_delete_wizard':'_onDeleteColumnWizard',}),_onDeleteColumnWizard:function(ev){ev.stopPropagation();const self=this;const column_id=ev.target.id;var state=this.model.get(this.handle,{raw:true});this._rpc({model:'project.task.type',method:'unlink_wizard',args:[column_id],context:state.getContext(),}).then(function(res){self.do_action(res);});}});var ProjectKanbanView=KanbanView.extend({config:_.extend({},KanbanView.prototype.config,{Controller:ProjectKanbanController}),});KanbanColumn.include({_onDeleteColumn:function(event){event.preventDefault();if(this.modelName==='project.task'){this.trigger_up('kanban_column_delete_wizard');return;}
this._super.apply(this,arguments);}});view_registry.add('project_kanban',ProjectKanbanView);return ProjectKanbanController;});;

/* /project/static/src/js/project_rating_reporting.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('project.project_rating_reporting',function(require){'use strict';const core=require('web.core');const _t=core._t;const viewRegistry=require('web.view_registry');const PivotController=require('web.PivotController');const PivotView=require('web.PivotView');const GraphController=require('web.GraphController');const GraphView=require('web.GraphView');var ProjectPivotController=PivotController.extend({init:function(){this._super.apply(this,arguments);var measures=JSON.parse(JSON.stringify(this.measures));if('res_id'in measures){measures.res_id.string=_t('Task');}
if('parent_res_id'in measures){measures.parent_res_id.string=_t('Project');}
if('rating'in measures){measures.rating.string=_t('Rating Value (/5)');}
this.measures=measures;},});var ProjectPivotView=PivotView.extend({config:_.extend({},PivotView.prototype.config,{Controller:ProjectPivotController,}),});viewRegistry.add('project_rating_pivot',ProjectPivotView);var ProjectGraphController=GraphController.extend({init:function(){this._super.apply(this,arguments);_.each(this.measures,measure=>{if(measure.fieldName==='res_id'){measure.description=_t('Task');}else if(measure.fieldName==='parent_res_id'){measure.description=_t('Project');}else if(measure.fieldName==='rating'){measure.description=_t('Rating Value (/5)');}});},});var ProjectGraphView=GraphView.extend({config:_.extend({},GraphView.prototype.config,{Controller:ProjectGraphController,}),});viewRegistry.add('project_rating_graph',ProjectGraphView);});;

/* /project/static/src/js/project_task_kanban_examples.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('project.task_kanban_examples',function(require){'use strict';var core=require('web.core');var kanbanExamplesRegistry=require('web.kanban_examples_registry');var _lt=core._lt;var greenBullet='<span class="o_status o_status_green"></span>';var redBullet='<span class="o_status o_status_red"></span>';var star='<a style="color: gold;" class="fa fa-star"/>';var clock='<a class="fa fa-clock-o" />'
var description_activities=escFormat(_lt('%s Use the %s icon to organize your daily activities.'),'<br/>',clock);var description=escFormat(_lt('Prioritize Tasks by using the %s icon.'+'%s Use the %s button to signalize to your colleagues that a task is ready for the next stage.'+'%s Use the %s to signalize a problem or a need for discussion on a task.'+'%s'),star,'<br/>',greenBullet,'<br/>',redBullet,description_activities);function escFormat(){var args=arguments;return{toString:function(){args[0]=_.escape(args[0]);return _.str.sprintf.apply(_.str,args);},};}
kanbanExamplesRegistry.add('project',{ghostColumns:[_lt('New'),_lt('Assigned'),_lt('In Progress'),_lt('Done')],applyExamplesText:_lt("Use This For My Project"),examples:[{name:_lt('Software Development'),columns:[_lt('Backlog'),_lt('Specifications'),_lt('Development'),_lt('Tests'),_lt('Delivered')],description:escFormat(_lt('Prioritize Tasks by using the %s icon.'+'%s Use the %s button to inform your colleagues that a task is ready for the next stage.'+'%s Use the %s to indicate a problem or a need for discussion on a task.'+'%s'),star,'<br/>',greenBullet,'<br/>',redBullet,description_activities),bullets:[greenBullet,redBullet,star],},{name:_lt('Agile Scrum'),columns:[_lt('Backlog'),_lt('Sprint Backlog'),_lt('Sprint in Progress'),_lt('Sprint Complete'),_lt('Old Completed Sprint')],description:escFormat(_lt('Waiting for the next stage: use %s and %s bullets. %s'),greenBullet,redBullet,description_activities),bullets:[greenBullet,redBullet],},{name:_lt('Digital Marketing'),columns:[_lt('Ideas'),_lt('Researching'),_lt('Writing'),_lt('Editing'),_lt('Done')],description:escFormat(_lt('Everyone can propose ideas, and the Editor marks the best ones '+'as %s. Attach all documents or links to the task directly, to have all information about '+'a research centralized. %s'),greenBullet,description_activities),bullets:[greenBullet,redBullet],},{name:_lt('Customer Feedback'),columns:[_lt('New'),_lt('In development'),_lt('Done'),_lt('Refused')],description:escFormat(_lt('Customers propose feedbacks by email; Odoo creates tasks '+'automatically, and you can communicate on the task directly. Your managers decide which '+'feedback is accepted %s and which feedback is moved to the %s column. %s'),greenBullet,_lt('"Refused"'),description_activities),bullets:[greenBullet,redBullet],},{name:_lt('Getting Things Done (GTD)'),columns:[_lt('Inbox'),_lt('Today'),_lt('This Week'),_lt('This Month'),_lt('Long Term')],description:escFormat(_lt('Fill your Inbox easily with the email gateway. Periodically review your '+'Inbox and schedule tasks by moving them to others columns. Every day, you review the '+'%s column to move important tasks %s. Every Monday, you review the %s column. %s'),_lt('"This Week"'),_lt('"Today"'),_lt('"This Month"'),description_activities),},{name:_lt('Consulting'),columns:[_lt('New Projects'),_lt('Resources Allocation'),_lt('In Progress'),_lt('Done')],description:escFormat(_lt('Manage the lifecycle of your project using the kanban view. Add newly acquired project, assign them and use the %s and %s to define if the project is ready for the next step. %s'),greenBullet,redBullet,description_activities),bullets:[greenBullet,redBullet],},{name:_lt('Research Project'),columns:[_lt('Brainstorm'),_lt('Research'),_lt('Draft'),_lt('Final Document')],description:escFormat(_lt('Handle your idea gathering within Tasks of your new Project and discuss them in the chatter of the tasks. Use the %s and %s to signalize what is the current status of your Idea. %s'),greenBullet,redBullet,description_activities),bullets:[greenBullet,redBullet],},{name:_lt('Website Redesign'),columns:[_lt('Page Ideas'),_lt('Copywriting'),_lt('Design'),_lt('Live')],description:escFormat(_lt('Handle your idea gathering within Tasks of your new Project and discuss them in the chatter of the tasks. Use the %s and %s to signalize what is the current status of your Idea. %s'),greenBullet,redBullet,description_activities),},{name:_lt('T-shirt Printing'),columns:[_lt('New Orders'),_lt('Logo Design'),_lt('To Print'),_lt('Done')],description:escFormat(_lt('Communicate with customers on the task using the email gateway. '+'Attach logo designs to the task, so that information flow from designers to the workers '+'who print the t-shirt. Organize priorities amongst orders %s using the icon. %s'),star,description_activities),bullets:[star],},{name:_lt('Design'),columns:[_lt('New Request'),_lt('Design'),_lt('Client Review'),_lt('Handoff')],description:description,bullets:[greenBullet,redBullet,star,clock],},{name:_lt('Publishing'),columns:[_lt('Ideas'),_lt('Writing'),_lt('Editing'),_lt('Published')],description:description,bullets:[greenBullet,redBullet,star,clock],},{name:_lt('Manufacturing'),columns:[_lt('New Orders'),_lt('Material Sourcing'),_lt('Manufacturing'),_lt('Assembling'),_lt('Delivered')],description:description,bullets:[greenBullet,redBullet,star,clock],},{name:_lt('Podcast and Video Production'),columns:[_lt('Research'),_lt('Script'),_lt('Recording'),_lt('Mixing'),_lt('Publishing')],description:description,bullets:[greenBullet,redBullet,star,clock],}],});});;

/* /project/static/src/js/tours/project.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('project.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('project_tour',{sequence:30,url:"/web",rainbowManMessage:"Congratulations, you are now a master of project management.",},[tour.stepUtils.showAppsMenuItem(),{trigger:'.o_app[data-menu-xmlid="project.menu_main_pm"]',content:_t('Want a better way to <b>manage your projects</b>? <i>It starts here.</i>'),position:'right',edition:'community',},{trigger:'.o_app[data-menu-xmlid="project.menu_main_pm"]',content:_t('Want a better way to <b>manage your projects</b>? <i>It starts here.</i>'),position:'bottom',edition:'enterprise',},{trigger:'.o-kanban-button-new',extra_trigger:'.o_project_kanban',content:_t('Let\'s create your first <b>project</b>.'),position:'bottom',width:200,},{trigger:'input.o_project_name',content:_t('Choose a <b>name</b> for your project. <i>It can be anything you want: the name of a customer,\
     of a product, of a team, of a construction site...</i>'),position:'right',},{trigger:'.o_open_tasks',content:_t('Let\'s create your first <b>project</b>.'),position:'top',run:function(actions){actions.auto('.modal:visible .btn.btn-primary');},},{trigger:".o_kanban_project_tasks .o_column_quick_create input",content:_t("Add columns to organize your tasks into <b>stages</b> <i>e.g. New - In Progress - Done</i>."),position:'bottom',},{trigger:".o_kanban_project_tasks .o_column_quick_create .o_kanban_add",auto:true,},{trigger:".o_kanban_project_tasks .o_column_quick_create input",extra_trigger:'.o_kanban_group',content:_t("Add columns to organize your tasks into <b>stages</b> <i>e.g. New - In Progress - Done</i>."),position:'bottom',},{trigger:".o_kanban_project_tasks .o_column_quick_create .o_kanban_add",auto:true,},{trigger:'.o-kanban-button-new',extra_trigger:'.o_kanban_group:eq(1)',content:_t("Let's create your first <b>task</b>."),position:'bottom',width:200,},{trigger:'.o_kanban_quick_create input.o_field_char[name=name]',extra_trigger:'.o_kanban_project_tasks',content:_t('Choose a task <b>name</b> <i>(e.g. Website Design, Purchase Goods...)</i>'),position:'right',},{trigger:'.o_kanban_quick_create .o_kanban_add',extra_trigger:'.o_kanban_project_tasks',content:_t("Add your task once it is ready."),position:"bottom",},{trigger:".o_kanban_record .oe_kanban_content",extra_trigger:'.o_kanban_project_tasks',content:_t("<b>Drag &amp; drop</b> the card to change your task from stage."),position:"bottom",run:"drag_and_drop .o_kanban_group:eq(1) ",},{trigger:".o_kanban_group:eq(1) > .o_kanban_record",extra_trigger:'.o_kanban_project_tasks',content:_t("Let's start working on your task."),position:"bottom",},{trigger:".o_ChatterTopbar_buttonSendMessage",content:_t("Use this chatter to <b>send emails</b> and communicate efficently with your customers. \
    Add new people in the followers list to make them aware about the main changes about this task."),width:350,position:"bottom",},{trigger:".o_ChatterTopbar_buttonLogNote",content:_t("<b>Log notes</b> for internal communications <i>(the people following this task won't be notified \
    of the note you are logging unless you specifically tag them)</i>. Use @ <b>mentions</b> to ping a colleague \
    or # <b>mentions</b> to reach an entire team."),width:350,position:"bottom"},{trigger:".o_ChatterTopbar_buttonScheduleActivity",content:_t("Use <b>activities</b> to organize your daily work."),},{trigger:".modal-dialog .btn-primary",content:"Schedule your activity once it is ready",position:"bottom",run:"click",},{trigger:".breadcrumb-item:not(.active):last",extra_trigger:'.o_form_project_tasks.o_form_readonly',content:_t("Let's go back to your <b>kanban view</b> to have an overview of your next tasks."),position:"right",run:'click',}]);});;

/* /project/static/src/js/project_calendar.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('project.ProjectCalendarView',function(require){"use strict";const CalendarController=require('web.CalendarController');const CalendarView=require('web.CalendarView');const viewRegistry=require('web.view_registry');const ProjectCalendarController=CalendarController.extend({_renderButtonsParameters(){return _.extend({},this._super(...arguments),{scaleDrop:true});},});const ProjectCalendarView=CalendarView.extend({config:_.extend({},CalendarView.prototype.config,{Controller:ProjectCalendarController,}),});viewRegistry.add('project_calendar',ProjectCalendarView);return ProjectCalendarView;});;

/* /stock/static/src/js/inventory_report_list_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('stock.InventoryReportListController',function(require){"use strict";var core=require('web.core');var ListController=require('web.ListController');var qweb=core.qweb;var InventoryReportListController=ListController.extend({init:function(parent,model,renderer,params){this.context=renderer.state.getContext();return this._super.apply(this,arguments);},renderButtons:function($node){this._super.apply(this,arguments);if(this.context.no_at_date){return;}
var $buttonToDate=$(qweb.render('InventoryReport.Buttons'));$buttonToDate.on('click',this._onOpenWizard.bind(this));this.$buttons.prepend($buttonToDate);},_onOpenWizard:function(){var state=this.model.get(this.handle,{raw:true});var stateContext=state.getContext();var context={active_model:this.modelName,};if(stateContext.default_product_id){context.product_id=stateContext.default_product_id;}else if(stateContext.product_tmpl_id){context.product_tmpl_id=stateContext.product_tmpl_id;}
this.do_action({res_model:'stock.quantity.history',views:[[false,'form']],target:'new',type:'ir.actions.act_window',context:context,});},});return InventoryReportListController;});;

/* /stock/static/src/js/inventory_report_list_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('stock.InventoryReportListView',function(require){"use strict";var ListView=require('web.ListView');var InventoryReportListController=require('stock.InventoryReportListController');var viewRegistry=require('web.view_registry');var InventoryReportListView=ListView.extend({config:_.extend({},ListView.prototype.config,{Controller:InventoryReportListController,}),});viewRegistry.add('inventory_report_list',InventoryReportListView);return InventoryReportListView;});;

/* /stock/static/src/js/inventory_singleton_list_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('stock.SingletonListController',function(require){"use strict";var core=require('web.core');var InventoryReportListController=require('stock.InventoryReportListController');var _t=core._t;var SingletonListController=InventoryReportListController.extend({_confirmSave:function(id){var newRecord=this.model.localData[id];var model=newRecord.model;var res_id=newRecord.res_id;var findSimilarRecords=function(record){if((record.groupedBy&&record.groupedBy.length>0)||record.data.length){var recordsToReturn=[];for(var i in record.data){var foundRecords=findSimilarRecords(record.data[i]);recordsToReturn=recordsToReturn.concat(foundRecords||[]);}
return recordsToReturn;}else{if(record.res_id===res_id&&record.model===model){if(record.count===0){return[record];}
else if(record.ref&&record.ref.indexOf('virtual')!==-1){return[record];}}}};var handle=this.model.get(this.handle);var similarRecords=findSimilarRecords(handle);if(similarRecords.length>1){var notification=_t("You tried to create a record who already exists."+"<br/>This last one has been modified instead.");this.do_notify(_t("This record already exists."),notification);this.reload();return Promise.reject();}
else{return this._super.apply(this,arguments);}},});return SingletonListController;});;

/* /stock/static/src/js/inventory_singleton_list_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('stock.SingletonListView',function(require){'use strict';var InventoryReportListView=require('stock.InventoryReportListView');var SingletonListController=require('stock.SingletonListController');var viewRegistry=require('web.view_registry');var SingletonListView=InventoryReportListView.extend({config:_.extend({},InventoryReportListView.prototype.config,{Controller:SingletonListController,}),});viewRegistry.add('singleton_list',SingletonListView);return SingletonListView;});;

/* /stock/static/src/js/inventory_validate_button_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('stock.InventoryValidationController',function(require){"use strict";var core=require('web.core');var ListController=require('web.ListController');var _t=core._t;var qweb=core.qweb;var InventoryValidationController=ListController.extend({events:_.extend({'click .o_button_validate_inventory':'_onValidateInventory'},ListController.prototype.events),init:function(parent,model,renderer,params){var context=renderer.state.getContext();this.inventory_id=context.active_id;return this._super.apply(this,arguments);},renderButtons:function(){this._super.apply(this,arguments);var $validationButton=$(qweb.render('InventoryLines.Buttons'));this.$buttons.prepend($validationButton);},_onValidateInventory:function(){var self=this;var prom=Promise.resolve();var recordID=this.renderer.getEditableRecordID();if(recordID){prom=this.saveRecord(recordID);}
prom.then(function(){self._rpc({model:'stock.inventory',method:'action_validate',args:[self.inventory_id]}).then(function(res){var exitCallback=function(infos){if(infos&&infos.special){return;}
self.do_notify(false,_t("The inventory has been validated"));self.trigger_up('history_back');};if(_.isObject(res)){self.do_action(res,{on_close:exitCallback});}else{return exitCallback();}});});},});return InventoryValidationController;});;

/* /stock/static/src/js/inventory_validate_button_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('stock.InventoryValidationView',function(require){"use strict";var InventoryValidationController=require('stock.InventoryValidationController');var ListView=require('web.ListView');var viewRegistry=require('web.view_registry');var InventoryValidationView=ListView.extend({config:_.extend({},ListView.prototype.config,{Controller:InventoryValidationController})});viewRegistry.add('inventory_validate_button',InventoryValidationView);});;

/* /stock/static/src/js/report_stock_forecasted.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('stock.ReplenishReport',function(require){"use strict";const clientAction=require('report.client_action');const core=require('web.core');const dom=require('web.dom');const GraphView=require('web.GraphView');const session=require('web.session');const qweb=core.qweb;const _t=core._t;const ReplenishReport=clientAction.extend({init:function(parent,action,options){this._super.apply(this,arguments);this.context=action.context;this.productId=this.context.active_id;this.resModel=this.context.active_model||'product.template';const isTemplate=this.resModel==='product.template';this.actionMethod=`action_product_${isTemplate ? 'tmpl_' : ''}forecast_report`;const reportName=`report_product_${isTemplate ? 'template' : 'product'}_replenishment`;this.report_url=`/report/html/stock.${reportName}/${this.productId}`;if(this.context.warehouse){this.active_warehouse={id:this.context.warehouse};}
this.report_url+=`?context=${JSON.stringify(this.context)}`;this._title=action.name;},start:function(){return Promise.all([this._super(...arguments),this._renderWarehouseFilters(),]).then(()=>{this._renderButtons();});},on_attach_callback:function(){this._super();this._createGraphView();},_createGraphView:async function(){let viewController;const appendGraph=()=>{promController.then(()=>{this.iframe.removeEventListener('load',appendGraph);const $reportGraphDiv=$(this.iframe).contents().find('.o_report_graph');dom.append(this.$el,viewController.$el,{in_DOM:true,callbacks:[{widget:viewController}],});const renderer=viewController.renderer;$('.o_control_panel:last').remove();const $graphPanel=$('.o_graph_controller');$graphPanel.appendTo($reportGraphDiv);if(!renderer.state.dataPoints.length){const graphHelper=renderer.$('.o_view_nocontent');const newMessage=qweb.render('View.NoContentHelper',{description:_t("Try to add some incoming or outgoing transfers."),});graphHelper.replaceWith(newMessage);}else{this.chart=renderer.chart;setTimeout(()=>{this.chart.canvas.height=300;this.chart.canvas.style.height="300px";this.chart.resize();},1);}});};this.iframe.addEventListener('load',appendGraph);const model='report.stock.quantity';const promController=this._rpc({model:model,method:'fields_view_get',kwargs:{view_type:'graph',}}).then(viewInfo=>{const params={modelName:model,domain:this._getReportDomain(),hasActionMenus:false,};const graphView=new GraphView(viewInfo,params);return graphView.getController(this);}).then(res=>{viewController=res;const fragment=document.createDocumentFragment();return viewController.appendTo(fragment);});},_getForecastedReportAction:function(){return this._rpc({model:this.resModel,method:this.actionMethod,args:[this.productId],context:this.context,});},_getReportDomain:function(){const domain=[['state','=','forecast'],['warehouse_id','=',this.active_warehouse.id],];if(this.resModel==='product.template'){domain.push(['product_tmpl_id','=',this.productId]);}else if(this.resModel==='product.product'){domain.push(['product_id','=',this.productId]);}
return domain;},_reloadReport:function(additionnalContext){return this._getForecastedReportAction().then((action)=>{action.context=Object.assign({active_id:this.productId,active_model:this.resModel,},this.context,additionnalContext);return this.do_action(action,{replace_last_action:true});});},_renderButtons:function(){const $newButtons=$(qweb.render('replenish_report_buttons',{}));this.$buttons.find('.o_report_print').replaceWith($newButtons);this.$buttons.on('click','.o_report_replenish_buy',this._onClickReplenish.bind(this));this.controlPanelProps.cp_content={$buttons:this.$buttons,};},_renderWarehouseFilters:function(){return this._rpc({model:'report.stock.report_product_product_replenishment',method:'get_filter_state',}).then((res)=>{const warehouses=res.warehouses;const active_warehouse=(this.active_warehouse&&this.active_warehouse.id)||res.active_warehouse;if(active_warehouse){this.active_warehouse=_.findWhere(warehouses,{id:active_warehouse});}else{this.active_warehouse=warehouses[0];}
const $filters=$(qweb.render('warehouseFilter',{active_warehouse:this.active_warehouse,warehouses:warehouses,displayWarehouseFilter:(warehouses.length>1),}));$filters.on('click','.warehouse_filter',this._onClickFilter.bind(this));this.$('.o_search_options').append($filters);});},_onClickReplenish:function(){const context=Object.assign({},this.context);if(this.resModel==='product.product'){context.default_product_id=this.productId;}else if(this.resModel==='product.template'){context.default_product_tmpl_id=this.productId;}
context.default_warehouse_id=this.active_warehouse.id;const on_close=function(res){if(res&&res.special){return;}
return this._reloadReport();};const action={res_model:'product.replenish',name:_t('Product Replenish'),type:'ir.actions.act_window',views:[[false,'form']],target:'new',context:context,};return this.do_action(action,{on_close:on_close.bind(this),});},_onClickFilter:function(ev){const data=ev.target.dataset;const warehouse_id=Number(data.warehouseId);return this._reloadReport({warehouse:warehouse_id});}});core.action_registry.add('replenish_report',ReplenishReport);});;

/* /stock/static/src/js/stock_orderpoint_list_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('stock.StockOrderpointListController',function(require){"use strict";var core=require('web.core');var ListController=require('web.ListController');var qweb=core.qweb;var StockOrderpointListController=ListController.extend({renderButtons:function(){this._super.apply(this,arguments);this.$buttons.find('.o_button_import').addClass('d-none');this.$buttons.find('.o_list_export_xlsx').addClass('d-none');this.$buttons.find('.o_list_button_add').removeClass('btn-primary').addClass('btn-secondary');var $buttons=$(qweb.render('StockOrderpoint.Buttons'));var $buttonOrder=$buttons.find('.o_button_order');var $buttonSnooze=$buttons.find('.o_button_snooze');$buttonOrder.on('click',this._onReplenish.bind(this));$buttonSnooze.on('click',this._onSnooze.bind(this));$buttons.prependTo(this.$buttons);},_onButtonClicked:function(ev){if(ev.data.attrs.class.split(' ').includes('o_replenish_buttons')){ev.stopPropagation();var self=this;this._callButtonAction(ev.data.attrs,ev.data.record).then(function(){self.reload();});}else{this._super.apply(this,arguments);}},_onReplenish:function(){var records=this.getSelectedRecords();this.model.replenish(records);},_onSelectionChanged:function(ev){this._super(ev);var $buttonOrder=this.$el.find('.o_button_order');var $buttonSnooze=this.$el.find('.o_button_snooze');if(this.getSelectedIds().length===0){$buttonOrder.addClass('d-none');$buttonSnooze.addClass('d-none');}else{$buttonOrder.removeClass('d-none');$buttonSnooze.removeClass('d-none');}},_onSnooze:function(){var records=this.getSelectedRecords();this.model.snooze(records);},});return StockOrderpointListController;});;

/* /stock/static/src/js/stock_orderpoint_list_model.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('stock.StockOrderpointListModel',function(require){"use strict";var core=require('web.core');var ListModel=require('web.ListModel');var qweb=core.qweb;var StockOrderpointListModel=ListModel.extend({replenish:function(records){var self=this;var model=records[0].model;var recordResIds=_.pluck(records,'res_id');var context=records[0].getContext();return this._rpc({model:model,method:'action_replenish',args:[recordResIds],context:context,}).then(function(){return self.do_action('stock.action_replenishment');});},snooze:function(records){var recordResIds=_.pluck(records,'res_id');var self=this;return this.do_action('stock.action_orderpoint_snooze',{additional_context:{default_orderpoint_ids:recordResIds},on_close:()=>self.do_action('stock.action_replenishment')});},});return StockOrderpointListModel;});;

/* /stock/static/src/js/stock_orderpoint_list_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('stock.StockOrderpointListView',function(require){"use strict";var ListView=require('web.ListView');var StockOrderpointListController=require('stock.StockOrderpointListController');var StockOrderpointListModel=require('stock.StockOrderpointListModel');var viewRegistry=require('web.view_registry');var StockOrderpointListView=ListView.extend({config:_.extend({},ListView.prototype.config,{Controller:StockOrderpointListController,Model:StockOrderpointListModel,}),});viewRegistry.add('stock_orderpoint_list',StockOrderpointListView);return StockOrderpointListView;});;

/* /stock/static/src/js/stock_traceability_report_backend.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('stock.stock_report_generic',function(require){'use strict';var AbstractAction=require('web.AbstractAction');var core=require('web.core');var session=require('web.session');var ReportWidget=require('stock.ReportWidget');var framework=require('web.framework');var QWeb=core.qweb;var stock_report_generic=AbstractAction.extend({hasControlPanel:true,init:function(parent,action){this._super.apply(this,arguments);this.actionManager=parent;this.given_context=Object.assign({},session.user_context);this.controller_url=action.context.url;if(action.context.context){this.given_context=action.context.context;}
this.given_context.active_id=action.context.active_id||action.params.active_id;this.given_context.model=action.context.active_model||false;this.given_context.ttype=action.context.ttype||false;this.given_context.auto_unfold=action.context.auto_unfold||false;this.given_context.lot_name=action.context.lot_name||false;},willStart:function(){return Promise.all([this._super.apply(this,arguments),this.get_html()]);},set_html:function(){var self=this;var def=Promise.resolve();if(!this.report_widget){this.report_widget=new ReportWidget(this,this.given_context);def=this.report_widget.appendTo(this.$('.o_content'));}
return def.then(function(){self.report_widget.$el.html(self.html);self.report_widget.$el.find('.o_report_heading').html('<h1>Traceability Report</h1>');if(self.given_context.auto_unfold){_.each(self.$el.find('.fa-caret-right'),function(line){self.report_widget.autounfold(line,self.given_context.lot_name);});}});},start:async function(){this.controlPanelProps.cp_content={$buttons:this.$buttons};await this._super(...arguments);this.set_html();},get_html:async function(){const{html}=await this._rpc({args:[this.given_context],method:'get_html',model:'stock.traceability.report',});this.html=html;this.renderButtons();},update_cp:function(){if(!this.$buttons){this.renderButtons();}
this.controlPanelProps.cp_content={$buttons:this.$buttons};return this.updateControlPanel();},renderButtons:function(){var self=this;this.$buttons=$(QWeb.render("stockReports.buttons",{}));this.$buttons.bind('click',function(){var $element=$(self.$el[0]).find('.o_stock_reports_table tbody tr');var dict=[];$element.each(function(index){var $el=$($element[index]);dict.push({'id':$el.data('id'),'model_id':$el.data('model_id'),'model_name':$el.data('model'),'unfoldable':$el.data('unfold'),'level':$el.find('td:first').data('level')||1});});framework.blockUI();var url_data=self.controller_url.replace('active_id',self.given_context.active_id);session.get_file({url:url_data.replace('output_format','pdf'),data:{data:JSON.stringify(dict)},complete:framework.unblockUI,error:(error)=>self.call('crash_manager','rpc_error',error),});});return this.$buttons;},do_show:function(){this._super();this.update_cp();},});core.action_registry.add("stock_report_generic",stock_report_generic);return stock_report_generic;});;

/* /stock/static/src/js/stock_traceability_report_widgets.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('stock.ReportWidget',function(require){'use strict';var core=require('web.core');var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var ReportWidget=Widget.extend({events:{'click span.o_stock_reports_foldable':'fold','click span.o_stock_reports_unfoldable':'unfold','click .o_stock_reports_web_action':'boundLink','click .o_stock_reports_stream':'updownStream','click .o_stock_report_lot_action':'actionOpenLot'},init:function(parent){this._super.apply(this,arguments);},start:function(){QWeb.add_template("/stock/static/src/xml/stock_traceability_report_line.xml");return this._super.apply(this,arguments);},boundLink:function(e){e.preventDefault();return this.do_action({type:'ir.actions.act_window',res_model:$(e.target).data('res-model'),res_id:$(e.target).data('active-id'),views:[[false,'form']],target:'current'});},actionOpenLot:function(e){e.preventDefault();var $el=$(e.target).parents('tr');this.do_action({type:'ir.actions.client',tag:'stock_report_generic',name:$el.data('lot_name')!==undefined&&$el.data('lot_name').toString(),context:{active_id:$el.data('lot_id'),active_model:'stock.production.lot',url:'/stock/output_format/stock/active_id'},});},updownStream:function(e){var $el=$(e.target).parents('tr');this.do_action({type:"ir.actions.client",tag:'stock_report_generic',name:_t("Traceability Report"),context:{active_id:$el.data('model_id'),active_model:$el.data('model'),auto_unfold:true,lot_name:$el.data('lot_name')!==undefined&&$el.data('lot_name').toString(),url:'/stock/output_format/stock/active_id'},});},removeLine:function(element){var self=this;var el,$el;var rec_id=element.data('id');var $stockEl=element.nextAll('tr[data-parent_id='+rec_id+']')
for(el in $stockEl){$el=$($stockEl[el]).find(".o_stock_reports_domain_line_0, .o_stock_reports_domain_line_1");if($el.length===0){break;}
else{var $nextEls=$($el[0]).parents("tr");self.removeLine($nextEls);$nextEls.remove();}
$el.remove();}
return true;},fold:function(e){this.removeLine($(e.target).parents('tr'));var active_id=$(e.target).parents('tr').find('td.o_stock_reports_foldable').data('id');$(e.target).parents('tr').find('td.o_stock_reports_foldable').attr('class','o_stock_reports_unfoldable '+active_id);$(e.target).parents('tr').find('span.o_stock_reports_foldable').replaceWith(QWeb.render("unfoldable",{lineId:active_id}));$(e.target).parents('tr').toggleClass('o_stock_reports_unfolded');},autounfold:function(target,lot_name){var self=this;var $CurretElement;$CurretElement=$(target).parents('tr').find('td.o_stock_reports_unfoldable');var active_id=$CurretElement.data('id');var active_model_name=$CurretElement.data('model');var active_model_id=$CurretElement.data('model_id');var row_level=$CurretElement.data('level');var $cursor=$(target).parents('tr');this._rpc({model:'stock.traceability.report',method:'get_lines',args:[parseInt(active_id,10)],kwargs:{'model_id':active_model_id,'model_name':active_model_name,'level':parseInt(row_level)+30||1},}).then(function(lines){_.each(lines,function(line){$cursor.after(QWeb.render("report_mrp_line",{l:line}));$cursor=$cursor.next();if($cursor&&line.unfoldable&&line.lot_name==lot_name){self.autounfold($cursor.find(".fa-caret-right"),lot_name);}});});$CurretElement.attr('class','o_stock_reports_foldable '+active_id);$(target).parents('tr').find('span.o_stock_reports_unfoldable').replaceWith(QWeb.render("foldable",{lineId:active_id}));$(target).parents('tr').toggleClass('o_stock_reports_unfolded');},unfold:function(e){this.autounfold($(e.target));},});return ReportWidget;});;

/* /stock/static/src/js/popover_widget.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('stock.popover_widget',function(require){'use strict';var AbstractField=require('web.AbstractField');var core=require('web.core');var QWeb=core.qweb;var Context=require('web.Context');var data_manager=require('web.data_manager');var fieldRegistry=require('web.field_registry');var PopoverWidgetField=AbstractField.extend({supportedFieldTypes:['char'],buttonTemplape:'stock.popoverButton',popoverTemplate:'stock.popoverContent',trigger:'focus',placement:'top',html:true,color:'text-primary',icon:'fa-info-circle',_render:function(){var value=JSON.parse(this.value);if(!value){this.$el.html('');return;}
this.$el.css('max-width','17px');this.$el.html(QWeb.render(this.buttonTemplape,_.defaults(value,{color:this.color,icon:this.icon})));this.$el.find('a').prop('special_click',true);this.$popover=$(QWeb.render(value.popoverTemplate||this.popoverTemplate,value));this.$popover.on('click','.action_open_forecast',this._openForecast.bind(this));this.$el.find('a').popover({content:this.$popover,html:this.html,placement:this.placement,title:value.title||this.title,trigger:this.trigger,delay:{'show':0,'hide':100},});},async _openForecast(ev){ev.stopPropagation();const reportContext={active_model:'product.product',active_id:this.recordData.product_id.data.id,};const action=await this._rpc({model:reportContext.active_model,method:'action_product_forecast_report',args:[[reportContext.active_id]],});action.context=new Context(action.context,reportContext);return this.do_action(action);},destroy:function(){this.$el.find('a').popover('dispose');this._super.apply(this,arguments);},});fieldRegistry.add('popover_widget',PopoverWidgetField);return PopoverWidgetField;});;

/* /stock/static/src/js/forecast_widget.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('stock.forecast_widget',function(require){'use strict';const AbstractField=require('web.AbstractField');const fieldRegistry=require('web.field_registry');const field_utils=require('web.field_utils');const utils=require('web.utils');const core=require('web.core');const QWeb=core.qweb;const ForecastWidgetField=AbstractField.extend({supportedFieldTypes:['float'],_render:function(){var data=Object.assign({},this.record.data,{forecast_availability_str:field_utils.format.float(this.record.data.forecast_availability,this.record.fields.forecast_availability,this.nodeOptions),reserved_availability_str:field_utils.format.float(this.record.data.reserved_availability,this.record.fields.reserved_availability,this.nodeOptions),forecast_expected_date_str:field_utils.format.date(this.record.data.forecast_expected_date,this.record.fields.forecast_expected_date),});if(data.forecast_expected_date&&data.date_deadline){data.forecast_is_late=data.forecast_expected_date>data.date_deadline;}
data.will_be_fulfilled=utils.round_decimals(data.forecast_availability,this.record.fields.forecast_availability.digits[1])>=utils.round_decimals(data.product_qty,this.record.fields.product_qty.digits[1]);this.$el.html(QWeb.render('stock.forecastWidget',data));this.$el.on('click',this._onOpenReport.bind(this));},isSet:function(){return true;},_onOpenReport:function(ev){ev.preventDefault();ev.stopPropagation();if(!this.recordData.id){return;}
this._rpc({model:'stock.move',method:'action_product_forecast_report',args:[this.recordData.id],}).then(action=>{action.context=Object.assign(action.context||{},{active_model:'product.product',active_id:this.recordData.product_id.res_id,});this.do_action(action);});},});fieldRegistry.add('forecast_widget',ForecastWidgetField);return ForecastWidgetField;});;

/* /stock/static/src/js/basic_model.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('stock.BasicModel',function(require){"use strict";var BasicModel=require('web.BasicModel');var localStorage=require('web.local_storage');BasicModel.include({_invalidateCache:function(dataPoint){this._super.apply(this,arguments);if(dataPoint.model==='stock.warehouse'&&!localStorage.getItem('running_tour')){this.do_action('reload_context');}}});});;

/* /stock/static/src/js/stock_rescheduling_popover.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('stock.PopoverStockPicking',function(require){"use strict";var core=require('web.core');var PopoverWidgetField=require('stock.popover_widget');var registry=require('web.field_registry');var _t=core._t;var PopoverStockPicking=PopoverWidgetField.extend({title:_t('Planning Issue'),trigger:'focus',color:'text-danger',icon:'fa-exclamation-triangle',_render:function(){this._super();if(this.$popover){var self=this;this.$popover.find('a').on('click',function(ev){ev.preventDefault();ev.stopPropagation();self.do_action({type:'ir.actions.act_window',res_model:ev.currentTarget.getAttribute('element-model'),res_id:parseInt(ev.currentTarget.getAttribute('element-id'),10),views:[[false,'form']],target:'current'});});}},});registry.add('stock_rescheduling_popover',PopoverStockPicking);return PopoverStockPicking;});;

/* /stock/static/tests/tours/stock_report_tests.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('stock.reports.setup.tour',function(require){"use strict";const tour=require('web_tour.tour');tour.register('test_stock_route_diagram_report',{test:true,},[{trigger:'.o_kanban_record',extra_trigger:'.breadcrumb',},{trigger:'.nav-item > a:contains("Inventory")',},{trigger:'.btn[id="stock.view_diagram_button"]',},{trigger:'iframe .o_report_stock_rule',},]);});;

/* /website/static/src/js/backend/button.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('website.backend.button',function(require){'use strict';var AbstractField=require('web.AbstractField');var core=require('web.core');var field_registry=require('web.field_registry');var _t=core._t;var WebsitePublishButton=AbstractField.extend({className:'o_stat_info',supportedFieldTypes:['boolean'],isSet:function(){return true;},_render:function(){this.$el.empty();var text=this.value?_t("Published"):_t("Unpublished");var hover=this.value?_t("Unpublish"):_t("Publish");var valColor=this.value?'text-success':'text-danger';var hoverColor=this.value?'text-danger':'text-success';var $val=$('<span>').addClass('o_stat_text o_not_hover '+valColor).text(text);var $hover=$('<span>').addClass('o_stat_text o_hover '+hoverColor).text(hover);this.$el.append($val).append($hover);},});var WidgetWebsiteButtonIcon=AbstractField.extend({template:'WidgetWebsiteButtonIcon',events:{'click':'_onClick',},start:function(){this.$icon=this.$('.o_button_icon');return this._super.apply(this,arguments);},isSet:function(){return true;},_render:function(){this._super.apply(this,arguments);var published=this.value;var info=published?_t("Published"):_t("Unpublished");this.$el.attr('aria-label',info).prop('title',info);this.$icon.toggleClass('text-danger',!published).toggleClass('text-success',published);},_onClick:function(){this.trigger_up('button_clicked',{attrs:{type:'object',name:'open_website_url',},record:this.record,});},});field_registry.add('website_redirect_button',WidgetWebsiteButtonIcon).add('website_publish_button',WebsitePublishButton);});;

/* /website/static/src/js/backend/dashboard.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('website.backend.dashboard',function(require){'use strict';var AbstractAction=require('web.AbstractAction');var ajax=require('web.ajax');var core=require('web.core');var Dialog=require('web.Dialog');var field_utils=require('web.field_utils');var session=require('web.session');var time=require('web.time');var web_client=require('web.web_client');var _t=core._t;var QWeb=core.qweb;var COLORS=["#1f77b4","#aec7e8"];var FORMAT_OPTIONS={humanReadable:function(value){return Math.abs(value)>=1000;},minDigits:1,decimals:2,formatterCallback:function(str){return str;},};var Dashboard=AbstractAction.extend({hasControlPanel:true,contentTemplate:'website.WebsiteDashboardMain',jsLibs:['/web/static/lib/Chart/Chart.js',],events:{'click .js_link_analytics_settings':'on_link_analytics_settings','click .o_dashboard_action':'on_dashboard_action','click .o_dashboard_action_form':'on_dashboard_action_form',},init:function(parent,context){this._super(parent,context);this.DATE_FORMAT=time.getLangDateFormat();this.date_range='week';this.date_from=moment.utc().subtract(1,'week');this.date_to=moment.utc();this.dashboards_templates=['website.dashboard_header','website.dashboard_content'];this.graphs=[];this.chartIds={};},willStart:function(){var self=this;return Promise.all([ajax.loadLibs(this),this._super()]).then(function(){return self.fetch_data();}).then(function(){var website=_.findWhere(self.websites,{selected:true});self.website_id=website?website.id:false;});},start:function(){var self=this;return this._super().then(function(){self.update_cp();self.render_graphs();});},on_attach_callback:function(){this._isInDom=true;this.render_graphs();this._super.apply(this,arguments);},on_detach_callback:function(){this._isInDom=false;this._super.apply(this,arguments);},fetch_data:function(){var self=this;var prom=this._rpc({route:'/website/fetch_dashboard_data',params:{website_id:this.website_id||false,date_from:this.date_from.year()+'-'+(this.date_from.month()+1)+'-'+this.date_from.date(),date_to:this.date_to.year()+'-'+(this.date_to.month()+1)+'-'+this.date_to.date(),},});prom.then(function(result){self.data=result;self.dashboards_data=result.dashboards;self.currency_id=result.currency_id;self.groups=result.groups;self.websites=result.websites;});return prom;},on_link_analytics_settings:function(ev){ev.preventDefault();var self=this;var dialog=new Dialog(this,{size:'medium',title:_t('Connect Google Analytics'),$content:QWeb.render('website.ga_dialog_content',{ga_key:this.dashboards_data.visits.ga_client_id,ga_analytics_key:this.dashboards_data.visits.ga_analytics_key,}),buttons:[{text:_t("Save"),classes:'btn-primary',close:true,click:function(){var ga_client_id=dialog.$el.find('input[name="ga_client_id"]').val();var ga_analytics_key=dialog.$el.find('input[name="ga_analytics_key"]').val();self.on_save_ga_client_id(ga_client_id,ga_analytics_key);},},{text:_t("Cancel"),close:true,},],}).open();},on_go_to_website:function(ev){ev.preventDefault();var website=_.findWhere(this.websites,{selected:true});window.location.href=$.param.querystring(website.domain+'/',{'fw':website.id});},on_save_ga_client_id:function(ga_client_id,ga_analytics_key){var self=this;return this._rpc({route:'/website/dashboard/set_ga_data',params:{'website_id':self.website_id,'ga_client_id':ga_client_id,'ga_analytics_key':ga_analytics_key,},}).then(function(result){if(result.error){self.do_warn(result.error.title,result.error.message);return;}
self.on_date_range_button('week');});},render_dashboards:function(){var self=this;_.each(this.dashboards_templates,function(template){self.$('.o_website_dashboard').append(QWeb.render(template,{widget:self}));});},render_graph:function(div_to_display,chart_values,chart_id){var self=this;this.$(div_to_display).empty();var $canvasContainer=$('<div/>',{class:'o_graph_canvas_container'});this.$canvas=$('<canvas/>').attr('id',chart_id);$canvasContainer.append(this.$canvas);this.$(div_to_display).append($canvasContainer);var labels=chart_values[0].values.map(function(date){return moment(date[0],"YYYY-MM-DD",'en');});var datasets=chart_values.map(function(group,index){return{label:group.key,data:group.values.map(function(value){return value[1];}),dates:group.values.map(function(value){return value[0];}),fill:false,borderColor:COLORS[index],};});var ctx=this.$canvas[0];this.chart=new Chart(ctx,{type:'line',data:{labels:labels,datasets:datasets,},options:{legend:{display:false,},maintainAspectRatio:false,scales:{yAxes:[{type:'linear',ticks:{beginAtZero:true,callback:this.formatValue.bind(this),},}],xAxes:[{ticks:{callback:function(moment){return moment.format(self.DATE_FORMAT);},}}],},tooltips:{mode:'index',intersect:false,bodyFontColor:'rgba(0,0,0,1)',titleFontSize:13,titleFontColor:'rgba(0,0,0,1)',backgroundColor:'rgba(255,255,255,0.6)',borderColor:'rgba(0,0,0,0.2)',borderWidth:2,callbacks:{title:function(tooltipItems,data){return data.datasets[0].label;},label:function(tooltipItem,data){var moment=data.labels[tooltipItem.index];var date=tooltipItem.datasetIndex===0?moment:moment.subtract(1,self.date_range);return date.format(self.DATE_FORMAT)+': '+self.formatValue(tooltipItem.yLabel);},labelColor:function(tooltipItem,chart){var dataset=chart.data.datasets[tooltipItem.datasetIndex];return{borderColor:dataset.borderColor,backgroundColor:dataset.borderColor,};},}}}});},render_graphs:function(){var self=this;if(this._isInDom){_.each(this.graphs,function(e){var renderGraph=self.groups[e.group]&&self.dashboards_data[e.name].summary.order_count;if(!self.chartIds[e.name]){self.chartIds[e.name]=_.uniqueId('chart_'+e.name);}
var chart_id=self.chartIds[e.name];if(renderGraph){self.render_graph('.o_graph_'+e.name,self.dashboards_data[e.name].graph,chart_id);}});this.render_graph_analytics(this.dashboards_data.visits.ga_client_id);}},render_graph_analytics:function(client_id){if(!this.dashboards_data.visits||!this.dashboards_data.visits.ga_client_id){return;}
this.load_analytics_api();var $analytics_components=this.$('.js_analytics_components');this.addLoader($analytics_components);var self=this;gapi.analytics.ready(function(){$analytics_components.empty();var $analytics_auth=$('<div>').addClass('col-lg-12');window.onOriginError=function(){$analytics_components.find('.js_unauthorized_message').remove();self.display_unauthorized_message($analytics_components,'not_initialized');};gapi.analytics.auth.authorize({container:$analytics_auth[0],clientid:client_id});$analytics_auth.appendTo($analytics_components);self.handle_analytics_auth($analytics_components);gapi.analytics.auth.on('signIn',function(){delete window.onOriginError;self.handle_analytics_auth($analytics_components);});});},on_date_range_button:function(date_range){if(date_range==='week'){this.date_range='week';this.date_from=moment.utc().subtract(1,'weeks');}else if(date_range==='month'){this.date_range='month';this.date_from=moment.utc().subtract(1,'months');}else if(date_range==='year'){this.date_range='year';this.date_from=moment.utc().subtract(1,'years');}else{console.log('Unknown date range. Choose between [week, month, year]');return;}
var self=this;Promise.resolve(this.fetch_data()).then(function(){self.$('.o_website_dashboard').empty();self.render_dashboards();self.render_graphs();});},on_website_button:function(website_id){var self=this;this.website_id=website_id;Promise.resolve(this.fetch_data()).then(function(){self.$('.o_website_dashboard').empty();self.render_dashboards();self.render_graphs();});},on_reverse_breadcrumb:function(){var self=this;web_client.do_push_state({});this.update_cp();this.fetch_data().then(function(){self.$('.o_website_dashboard').empty();self.render_dashboards();self.render_graphs();});},on_dashboard_action:function(ev){ev.preventDefault();var $action=$(ev.currentTarget);var additional_context={};if(this.date_range==='week'){additional_context={search_default_week:true};}else if(this.date_range==='month'){additional_context={search_default_month:true};}else if(this.date_range==='year'){additional_context={search_default_year:true};}
this.do_action($action.attr('name'),{additional_context:additional_context,on_reverse_breadcrumb:this.on_reverse_breadcrumb});},on_dashboard_action_form:function(ev){ev.preventDefault();var $action=$(ev.currentTarget);this.do_action({name:$action.attr('name'),res_model:$action.data('res_model'),res_id:$action.data('res_id'),views:[[false,'form']],type:'ir.actions.act_window',},{on_reverse_breadcrumb:this.on_reverse_breadcrumb});},update_cp:function(){var self=this;if(!this.$searchview){this.$searchview=$(QWeb.render("website.DateRangeButtons",{widget:this,}));this.$searchview.find('button.js_date_range').click(function(ev){self.$searchview.find('button.js_date_range.active').removeClass('active');$(ev.target).addClass('active');self.on_date_range_button($(ev.target).data('date'));});this.$searchview.find('button.js_website').click(function(ev){self.$searchview.find('button.js_website.active').removeClass('active');$(ev.target).addClass('active');self.on_website_button($(ev.target).data('website-id'));});}
var $buttons=$(QWeb.render("website.GoToButtons"));$buttons.on('click',this.on_go_to_website.bind(this));this.updateControlPanel({cp_content:{$searchview:this.$searchview,$buttons:$buttons,},});},load_analytics_api:function(){var self=this;if(!("gapi"in window)){(function(w,d,s,g,js,fjs){g=w.gapi||(w.gapi={});g.analytics={q:[],ready:function(cb){this.q.push(cb);}};js=d.createElement(s);fjs=d.getElementsByTagName(s)[0];js.src='https://apis.google.com/js/platform.js';fjs.parentNode.insertBefore(js,fjs);js.onload=function(){g.load('analytics');};}(window,document,'script'));gapi.analytics.ready(function(){self.analytics_create_components();});}},handle_analytics_auth:function($analytics_components){$analytics_components.find('.js_unauthorized_message').remove();if(!gapi.analytics.auth.getAuthResponse()){this.display_unauthorized_message($analytics_components,'not_connected');}else if(gapi.analytics.auth.getAuthResponse()&&gapi.analytics.auth.getAuthResponse().scope.indexOf('https://www.googleapis.com/auth/analytics')===-1){this.display_unauthorized_message($analytics_components,'no_right');}else{this.make_analytics_calls($analytics_components);}},display_unauthorized_message:function($analytics_components,reason){$analytics_components.prepend($(QWeb.render('website.unauthorized_analytics',{reason:reason})));},make_analytics_calls:function($analytics_components){var $analytics_users=$('<div>');var activeUsers=new gapi.analytics.ext.ActiveUsers({container:$analytics_users[0],pollingInterval:10,});$analytics_users.appendTo($analytics_components);var $analytics_view_selector=$('<div>').addClass('col-lg-12 o_properties_selection');var viewSelector=new gapi.analytics.ViewSelector({container:$analytics_view_selector[0],});viewSelector.execute();$analytics_view_selector.appendTo($analytics_components);var start_date='7daysAgo';if(this.date_range==='month'){start_date='30daysAgo';}else if(this.date_range==='year'){start_date='365daysAgo';}
var $analytics_chart_2=$('<div>').addClass('col-lg-6 col-12');var breakdownChart=new gapi.analytics.googleCharts.DataChart({query:{'dimensions':'ga:date','metrics':'ga:sessions','start-date':start_date,'end-date':'yesterday'},chart:{type:'LINE',container:$analytics_chart_2[0],options:{title:'All',width:'100%',tooltip:{isHtml:true},}}});$analytics_chart_2.appendTo($analytics_components);var $analytics_chart_1=$('<div>').addClass('col-lg-6 col-12');var mainChart=new gapi.analytics.googleCharts.DataChart({query:{'dimensions':'ga:medium','metrics':'ga:sessions','sort':'-ga:sessions','max-results':'6'},chart:{type:'TABLE',container:$analytics_chart_1[0],options:{width:'100%'}}});$analytics_chart_1.appendTo($analytics_components);var table_row_listener;viewSelector.on('change',function(ids){var options={query:{ids:ids}};activeUsers.set({ids:ids}).execute();mainChart.set(options).execute();breakdownChart.set(options).execute();if(table_row_listener){google.visualization.events.removeListener(table_row_listener);}});mainChart.on('success',function(response){var chart=response.chart;var dataTable=response.dataTable;table_row_listener=google.visualization.events.addListener(chart,'select',function(){var options;if(chart.getSelection().length){var row=chart.getSelection()[0].row;var medium=dataTable.getValue(row,0);options={query:{filters:'ga:medium=='+medium,},chart:{options:{title:medium,}}};}else{options={chart:{options:{title:'All',}}};delete breakdownChart.get().query.filters;}
breakdownChart.set(options).execute();});});activeUsers.once('success',function(){var element=this.container.firstChild;var timeout;this.on('change',function(data){element=this.container.firstChild;var animationClass=data.delta>0?'is-increasing':'is-decreasing';element.className+=(' '+animationClass);clearTimeout(timeout);timeout=setTimeout(function(){element.className=element.className.replace(/ is-(increasing|decreasing)/g,'');},3000);});});},analytics_create_components:function(){gapi.analytics.createComponent('ActiveUsers',{initialize:function(){this.activeUsers=0;gapi.analytics.auth.once('signOut',this.handleSignOut_.bind(this));},execute:function(){if(this.polling_){this.stop();}
this.render_();if(gapi.analytics.auth.isAuthorized()){this.pollActiveUsers_();}else{gapi.analytics.auth.once('signIn',this.pollActiveUsers_.bind(this));}},stop:function(){clearTimeout(this.timeout_);this.polling_=false;this.emit('stop',{activeUsers:this.activeUsers});},render_:function(){var opts=this.get();this.container=typeof opts.container==='string'?document.getElementById(opts.container):opts.container;this.container.innerHTML=opts.template||this.template;this.container.querySelector('b').innerHTML=this.activeUsers;},pollActiveUsers_:function(){var options=this.get();var pollingInterval=(options.pollingInterval||5)*1000;if(isNaN(pollingInterval)||pollingInterval<5000){throw new Error('Frequency must be 5 seconds or more.');}
this.polling_=true;gapi.client.analytics.data.realtime.get({ids:options.ids,metrics:'rt:activeUsers'}).then(function(response){var result=response.result;var newValue=result.totalResults?+result.rows[0][0]:0;var oldValue=this.activeUsers;this.emit('success',{activeUsers:this.activeUsers});if(newValue!==oldValue){this.activeUsers=newValue;this.onChange_(newValue-oldValue);}
if(this.polling_){this.timeout_=setTimeout(this.pollActiveUsers_.bind(this),pollingInterval);}}.bind(this));},onChange_:function(delta){var valueContainer=this.container.querySelector('b');if(valueContainer){valueContainer.innerHTML=this.activeUsers;}
this.emit('change',{activeUsers:this.activeUsers,delta:delta});if(delta>0){this.emit('increase',{activeUsers:this.activeUsers,delta:delta});}else{this.emit('decrease',{activeUsers:this.activeUsers,delta:delta});}},handleSignOut_:function(){this.stop();gapi.analytics.auth.once('signIn',this.handleSignIn_.bind(this));},handleSignIn_:function(){this.pollActiveUsers_();gapi.analytics.auth.once('signOut',this.handleSignOut_.bind(this));},template:'<div class="ActiveUsers">'+'Active Users: <b class="ActiveUsers-value"></b>'+'</div>'});},addLoader:function(selector){var loader='<span class="fa fa-3x fa-spin fa-spinner fa-pulse"/>';selector.html("<div class='o_loader'>"+loader+"</div>");},getValue:function(d){return d[1];},format_number:function(value,type,digits,symbol){if(type==='currency'){return this.render_monetary_field(value,this.currency_id);}else{return field_utils.format[type](value||0,{digits:digits})+' '+symbol;}},formatValue:function(value){var formatter=field_utils.format.float;var formatedValue=formatter(value,undefined,FORMAT_OPTIONS);return formatedValue;},render_monetary_field:function(value,currency_id){var currency=session.get_currency(currency_id);var formatted_value=field_utils.format.float(value||0,{digits:currency&&currency.digits});if(currency){if(currency.position==="after"){formatted_value+=currency.symbol;}else{formatted_value=currency.symbol+formatted_value;}}
return formatted_value;},});core.action_registry.add('backend_dashboard',Dashboard);return Dashboard;});;

/* /website/static/src/js/backend/res_config_settings.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('website.settings',function(require){const BaseSettingController=require('base.settings').Controller;const core=require('web.core');const Dialog=require('web.Dialog');const FieldBoolean=require('web.basic_fields').FieldBoolean;const fieldRegistry=require('web.field_registry');const FormController=require('web.FormController');const QWeb=core.qweb;const _t=core._t;BaseSettingController.include({_onButtonClicked:function(ev){if(ev.data.attrs.name==='website_go_to'||ev.data.attrs.name==='install_theme_on_current_website'){FormController.prototype._onButtonClicked.apply(this,arguments);}else{this._super.apply(this,arguments);}},});const WebsiteCookiesbarField=FieldBoolean.extend({xmlDependencies:['/website/static/src/xml/website.res_config_settings.xml'],_onChange:function(){const checked=this.$input[0].checked;if(!checked){return this._setValue(checked);}
const cancelCallback=()=>this.$input[0].checked=!checked;Dialog.confirm(this,null,{title:_t("Please confirm"),$content:QWeb.render('website.res_config_settings.cookies_modal_main'),buttons:[{text:'Do not activate',classes:'btn-primary',close:true,click:cancelCallback,},{text:'Activate anyway',close:true,click:()=>this._setValue(checked),}],cancel_callback:cancelCallback,});},});fieldRegistry.add('website_cookiesbar_field',WebsiteCookiesbarField);});;

/* /website/static/src/js/widget_iframe.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('website.iframe_widget',function(require){"use strict";var AbstractField=require('web.AbstractField');var core=require('web.core');var fieldRegistry=require('web.field_registry');var QWeb=core.qweb;var FieldIframePreview=AbstractField.extend({className:'d-block o_field_iframe_preview m-0 h-100',_render:function(){this.$el.html(QWeb.render('website.iframeWidget',{url:this.value,}));},});fieldRegistry.add('iframe',FieldIframePreview);return FieldIframePreview;});;

/* /website/static/src/js/theme_preview_kanban.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('website.theme_preview_kanban',function(require){"use strict";var KanbanController=require('web.KanbanController');var KanbanView=require('web.KanbanView');var ViewRegistry=require('web.view_registry');const ThemePreviewControllerCommon=require('website.theme_preview_form').ThemePreviewControllerCommon;var core=require('web.core');var _lt=core._lt;var ThemePreviewKanbanController=KanbanController.extend(ThemePreviewControllerCommon,{start:async function(){await this._super(...arguments);this.el.classList.add('o_view_kanban_theme_preview_controller');const websiteLink=Object.assign(document.createElement('a'),{className:'btn btn-secondary ml-3 text-black-75',href:'/',innerHTML:'<i class="fa fa-close"></i>',});const smallBreadcumb=Object.assign(document.createElement('small'),{className:'mx-2 text-muted',innerHTML:_lt("Don't worry, you can switch later."),});this._controlPanelWrapper.el.querySelector('.o_cp_top .o_cp_top_left .breadcrumb li.active').classList.add('text-black-75');this._controlPanelWrapper.el.querySelector('.o_cp_top').appendChild(websiteLink);this._controlPanelWrapper.el.querySelector('div.o_cp_top_left li').appendChild(smallBreadcumb);},_onButtonClicked:function(ev){const attrName=ev.data.attrs.name;if(attrName==='button_choose_theme'||attrName==='button_refresh_theme'){this._handleThemeAction(ev.data.record.res_id,attrName);}else{this._super(...arguments);}},});var ThemePreviewKanbanView=KanbanView.extend({withSearchBar:false,config:_.extend({},KanbanView.prototype.config,{Controller:ThemePreviewKanbanController,}),});ViewRegistry.add('theme_preview_kanban',ThemePreviewKanbanView);});;

/* /website/static/src/js/theme_preview_form.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('website.theme_preview_form',function(require){"use strict";var FormController=require('web.FormController');var FormView=require('web.FormView');var viewRegistry=require('web.view_registry');var core=require('web.core');var qweb=core.qweb;const ThemePreviewControllerCommon={init(){this._super(...arguments);this.$loader=$(qweb.render('website.ThemePreview.Loader'));},_handleThemeAction(res_id,action){let actionCallback=undefined;this._addLoader();switch(action){case'button_choose_theme':actionCallback=result=>this.do_action(result);break;case'button_refresh_theme':actionCallback=()=>this._removeLoader();break;}
const rpcData={model:'ir.module.module',method:action,args:[res_id],context:this.initialState.context,};const rpcOptions={shadow:true,};this._rpc(rpcData,rpcOptions).then(actionCallback).guardedCatch(()=>this._removeLoader());},_addLoader(){$('body').append(this.$loader);},_removeLoader(){this.$loader.remove();}};var ThemePreviewController=FormController.extend(ThemePreviewControllerCommon,{events:Object.assign({},FormController.prototype.events,{'click .o_use_theme':'_onStartNowClick','click .o_switch_theme':'_onSwitchThemeClick','change input[name="viewer"]':'_onSwitchButtonChange',}),start:function(){this.$el.addClass('o_view_form_theme_preview_controller');return this._super.apply(this,arguments);},renderButtons:function($node){this.$buttons=$(qweb.render('website.ThemePreview.Buttons'));if($node){$node.html(this.$buttons);}},updateButtons:function(){},_updateControlPanelProps:async function(){const props=this._super(...arguments);const $switchModeButton=$(qweb.render('website.ThemePreview.SwitchModeButton'));this.controlPanelProps.cp_content.$pager=$switchModeButton;return props;},_onSwitchButtonChange:function(){this.$('.o_preview_frame').toggleClass('is_mobile');},_onSwitchThemeClick:function(){this.trigger_up('history_back');},_onStartNowClick:function(){this._handleThemeAction(this.getSelectedIds()[0],'button_choose_theme');},});var ThemePreviewFormView=FormView.extend({config:_.extend({},FormView.prototype.config,{Controller:ThemePreviewController}),});viewRegistry.add('theme_preview_form',ThemePreviewFormView);return{ThemePreviewControllerCommon:ThemePreviewControllerCommon}});;

/* /website_calendar/static/src/js/appointment_employee_url.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('website_calendar.appointment_employee_url',function(require){'use strict';var AbstractField=require('web.AbstractField');var core=require('web.core');var fieldRegistry=require('web.field_registry');var _t=core._t;var FieldemployeeUrl=AbstractField.extend({events:_.extend({},AbstractField.prototype.events,{'click .o_website_calendar_copy_icon':'_stopPropagation','click .o_form_uri':'_stopPropagation',}),supportedFieldTypes:[],init:function(){this._super.apply(this,arguments);this.tagName='div';this.url=false;var base_url=this.getSession()['web.base.url'];var appointmentURL=this.record.getContext({fieldName:'id'}).url;if(appointmentURL){this.url=base_url+appointmentURL.replace("/appointment","")+'?employee_id='+this.value;}},_render:function(){if(!this.url){return;}
var $link=$('<a>',{class:'o_form_uri fa-o_text_overflow',href:this.url,text:this.url,});var $icon=$('<div>',{class:'fa fa-clipboard o_website_calendar_copy_icon'});$icon.tooltip({title:_t("Copied !"),trigger:"manual",placement:"right"});var clipboard=new window.ClipboardJS($icon[0],{text:this.url.trim.bind(this.url),});clipboard.on("success",function(e){_.defer(function(){$icon.tooltip("show");_.delay(function(){$icon.tooltip("hide");},800);});});this.$el.empty().append($link).append($icon);},_stopPropagation:function(ev){ev.stopPropagation();},});fieldRegistry.add('appointment_employee_url',FieldemployeeUrl)});;

/* /account_accountant/static/src/js/move_line_list_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account_accountant.MoveLineListView',function(require){"use strict";var AttachmentViewer=require('mail_enterprise.AttachmentViewer');var config=require('web.config');var core=require('web.core');var ListController=require('web.ListController');var ListModel=require('web.ListModel');var ListRenderer=require('web.ListRenderer');var ListView=require('web.ListView');var viewRegistry=require('web.view_registry');var _t=core._t;var AccountMoveListModel=ListModel.extend({_fetchRelatedData:function(list,toFetch,fieldName){if(fieldName==='move_attachment_ids'&&config.device.size_class>=config.device.SIZES.XXL){var fieldsInfo=list.fieldsInfo[list.viewType][fieldName];fieldsInfo.__no_fetch=false;fieldsInfo.relatedFields={mimetype:{type:'char'},};}
return this._super.apply(this,arguments);},});var AccountMoveListController=ListController.extend({events:_.extend({},ListController.prototype.events,{'click .o_attachment_control':'_onToggleAttachment',}),custom_events:_.extend({},ListController.prototype.custom_events,{row_selected:'_onRowSelected',}),init:function(){this._super.apply(this,arguments);this.currentAttachments=[];this.hide_attachment=!!this.initialState.context.hide_attachment;this.last_selected=false;},_update:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.$('.o_content').addClass('o_move_line_list_view');self.currentAttachments=[];if(!self.$attachmentPreview&&config.device.size_class>=config.device.SIZES.XXL){self.$attachmentPreview=$('<div>',{class:'o_attachment_preview',}).append($('<p>',{class:'o_move_line_empty',text:_t("Choose a line to preview its attachments."),})).append($('<div>',{class:'o_attachment_control',}));self.$attachmentPreview.appendTo(self.$('.o_content'));self.$attachmentPreview.toggleClass('hidden',self.hide_attachment);}}).then(self._renderAttachmentPreview());},_renderAttachmentPreview:function(recordId){var self=this;if(_.filter(this.model.localData,function(value,key,object){return value.groupData==self.last_selected}).length){recordId=_.filter(this.model.localData,function(value,key,object){return value.groupData==self.last_selected})[0].data[0]}
if(!recordId){return Promise.resolve()}
var record=this.model.get(recordId||this.last_selected);var types=['pdf','image'];if(record.type==='list'){return;}
let attachments=record.data.move_attachment_ids.data.map(function(attachment){return{id:attachment.res_id,filename:attachment.data.filename,mimetype:attachment.data.mimetype,url:'/web/content/'+attachment.res_id+'?download=true',};});attachments=_.filter(attachments,function(attachment){var match=attachment.mimetype.match(types.join('|'));attachment.type=match?match[0]:false;return match;});var prom;if(!_.isEqual(_.pluck(this.currentAttachments,'id'),_.pluck(attachments,'id'))){if(this.attachmentViewer){this.attachmentViewer.updateContents(attachments);}else{this.attachmentViewer=new AttachmentViewer(this,attachments);}
prom=this.attachmentViewer.appendTo(this.$attachmentPreview.empty()).then(function(){self.$attachmentPreview.resizable({handles:'w',minWidth:400,maxWidth:900,});});}
return Promise.resolve(prom).then(function(){self.currentAttachments=attachments;if(!attachments.length){var $empty=$('<p>',{class:'o_move_line_without_attachment',text:_t("No attachments linked."),});self.$attachmentPreview.empty().append($empty);}
$('<div>',{class:'o_attachment_control'}).appendTo(self.$attachmentPreview);});},_onToggleAttachment:function(){this.hide_attachment=!this.hide_attachment;this.$attachmentPreview.toggleClass('hidden');},_onRowSelected:function(ev){if(config.device.size_class>=config.device.SIZES.XXL){this.last_selected=ev.data.recordId;if(this.last_selected.includes('line')){this._renderAttachmentPreview(ev.data.recordId);}}},});var AccountMoveListRenderer=ListRenderer.extend({events:Object.assign({},ListRenderer.prototype.events,{'mouseover .o_list_table_grouped tbody tr':'_onToggleGroupButton','mouseout .o_list_table_grouped tbody tr':'_onToggleGroupButton',}),_selectRow:function(rowIndex){var self=this;var recordId=this._getRecordID(rowIndex);var currentRow=this.currentRow;return this._super.apply(this,arguments).then(function(){if(rowIndex!==currentRow){self.trigger_up('row_selected',{recordId:recordId,});}});},_onRowClicked:function(ev){ev.stopPropagation();var id=$(ev.currentTarget).data('id');if(id){this.trigger_up('row_selected',{recordId:id,});}
return this._super.apply(this,arguments);},_findConnectedCell:function($cell,direction,colIndex){var res=this._super.apply(this,arguments);var id=res.closest('tr').data('id');if(id){this.trigger_up('row_selected',{recordId:id,});}
return res;},_renderGroupRow:function(group,groupLevel){var ret=this._super.apply(this,arguments);if(this.state.context.name_groupby){var $th=ret.find('th.o_group_name');$th.addClass('o_group_name_custom');var text_node=$th.contents().filter(function(){return this.nodeType==3;})[0];text_node.nodeValue=text_node.nodeValue.replace(/(\*\*)(.*)\1/g,'<strong>$2</strong>').replace(/\s+\([0-9]+\)/,'');$(text_node).replaceWith($('<span>'+text_node.nodeValue+'</span>'));}
return ret;},_onToggleGroup:function(ev){var group=$(ev.currentTarget).closest('tr').data('group');if(group.model==='account.move.line'&&group.groupData&&group.groupData.model==='account.move'){this.trigger_up('row_selected',{recordId:group.groupData.id,});}
this._super.apply(this,arguments);},_onToggleGroupButton:function(ev){let tr=ev.currentTarget;let groupHeader;if(tr.classList.contains('o_group_header')&&tr.querySelector(".o_group_buttons")){groupHeader=tr;}else{let tbody=ev.currentTarget.closest('tbody');while(tbody&&!tbody.querySelector(".o_group_buttons")){tbody=tbody.previousElementSibling;}
if(tbody){groupHeader=tbody.querySelector(".o_group_header.o_group_open");}}
if(groupHeader){groupHeader.classList.toggle("show_group_buttons");}},});var AccountMoveListView=ListView.extend({config:_.extend({},ListView.prototype.config,{Controller:AccountMoveListController,Model:AccountMoveListModel,Renderer:AccountMoveListRenderer,}),});viewRegistry.add('account_move_line_list',AccountMoveListView);return{AccountMoveListView:AccountMoveListView,AccountMoveListController:AccountMoveListController,AccountMoveListModel:AccountMoveListModel,AccountMoveListRenderer:AccountMoveListRenderer}});;

/* /account_accountant/static/src/js/tours/account_accountant.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account_accountant.tour',function(require){"use strict";const core=require('web.core');const tour=require('web_tour.tour');const _t=core._t;tour.tours.account_tour.steps.splice(0,3,..._.map(tour.stepUtils.goToAppSteps('account_accountant.menu_accounting',_t('Go to invoicing')),step=>_.extend(step,{auto:true})),{trigger:'a[data-menu-xmlid="account.menu_finance_receivables"]',content:_t('Go to invoicing'),auto:true,},{trigger:'a[data-menu-xmlid="account.menu_action_move_out_invoice_type"]',content:_t('Go to invoicing'),auto:true,})
tour.register('account_accountant_tour',{rainbowManMessage:function(){var message=_t('<strong><b>Good job!</b> You went through all steps of this tour.</strong>');if(!tour._isTourConsumed('account_tour')){message+=_t('<br>See how to manage your customer invoices in the <b>Customers/Invoices</b> menu');}
return message;},url:"/web",},[...tour.stepUtils.goToAppSteps('account_accountant.menu_accounting',_t('Lets automate your bills, bank transactions and accounting processes.')),{trigger:'a[data-method="setting_upload_bill_wizard"].o_onboarding_step_action',content:_t('Create your first vendor bill.<br/><br/><i>Tip: If you dont have one on hand, use our sample bill.</i>'),position:'bottom',},{trigger:'button[name="apply"]',content:_t('Great! Lets continue.'),position:'bottom',},{trigger:'.o_data_cell',extra_trigger:'tr:not(.o_sample_data_disabled)>td:has(span[name="payment_state"])',content:_t('Lets see how a bill looks like in form view.'),position:'bottom',},{trigger:'button.btn-primary[name="action_post"]',extra_trigger:'body:has(div[name="waiting_extraction"].o_invisible_modifier)',content:_t('Check & validate the bill. If no vendor has been found, add one before validating.'),position:'bottom',},{trigger:'a[data-menu-xmlid="account.menu_board_journal_1"]',extra_trigger:'button[data-value="posted"].btn-primary',content:_t('Lets go back to the dashboard.'),position:'bottom',},{trigger:'a[data-method="setting_init_bank_account_action"].o_onboarding_step_action',content:_t('Connect your bank and get your latest transactions.'),position:'bottom',run:function(){tour.tours.account_accountant_tour.current_step+=3
$('.js_cancel').click();}},{trigger:'button[data-name="action_open_reconcile"]',content:_t('Lets reconcile the fetched bank transactions.'),},{trigger:'.o_reconciliation_lines .accounting_view button:visible',content:_t('Process this transaction.')},{trigger:'.breadcrumb-item:not(.active):first',content:_t('Get back to the dashboard using your previous path'),position:'bottom',}]);tour.register('account_accountant_tour_upload_ocr_step',{rainbowMan:false,},[{trigger:'button.btn-primary[name="check_status"]',content:_t('Lets use AI to fill in the form<br/><br/><i>Tip: If the OCR is not done yet, wait a few more seconds and try again.</i>'),position:'bottom',}])});;

/* /account_accountant/static/src/js/reconciliation/reconciliation_action.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account.ReconciliationClientAction',function(require){"use strict";var AbstractAction=require('web.AbstractAction');var ReconciliationModel=require('account.ReconciliationModel');var ReconciliationRenderer=require('account.ReconciliationRenderer');var core=require('web.core');var QWeb=core.qweb;var StatementAction=AbstractAction.extend({hasControlPanel:true,withSearchBar:true,loadControlPanel:true,title:core._t('Bank Reconciliation'),contentTemplate:'reconciliation',custom_events:{change_mode:'_onAction',change_filter:'_onAction',change_offset:'_onAction',change_partner:'_onAction',add_proposition:'_onAction',remove_proposition:'_onAction',update_proposition:'_onAction',create_proposition:'_onAction',getPartialAmount:'_onActionPartialAmount',quick_create_proposition:'_onAction',partial_reconcile:'_onAction',validate:'_onValidate',close_statement:'_onCloseStatement',load_more:'_onLoadMore',reload:'reload',navigation_move:'_onNavigationMove',},config:_.extend({},AbstractAction.prototype.config,{Model:ReconciliationModel.StatementModel,ActionRenderer:ReconciliationRenderer.StatementRenderer,LineRenderer:ReconciliationRenderer.LineRenderer,params:['statement_line_ids'],limitMoveLines:15,}),_onNavigationMove:function(ev){var non_reconciled_keys=_.keys(_.pick(this.model.lines,function(value,key,object){return!value.reconciled}));var currentIndex=_.indexOf(non_reconciled_keys,ev.data.handle);var widget=false;switch(ev.data.direction){case'up':ev.stopPropagation();widget=this._getWidget(non_reconciled_keys[currentIndex-1]);break;case'down':ev.stopPropagation();widget=this._getWidget(non_reconciled_keys[currentIndex+1]);break;case'validate':ev.stopPropagation();widget=this._getWidget(non_reconciled_keys[currentIndex]);widget.$('caption .o_buttons button:visible').click();break;}
if(widget)widget.$el.focus();},init:function(parent,params){this._super.apply(this,arguments);this.action_manager=parent;this.params=params;this.searchModelConfig.modelName='account.bank.statement.line';this.controlPanelProps.cp_content={};this.model=new this.config.Model(this,{modelName:"account.reconciliation.widget",limitMoveLines:params.params&&params.params.limitMoveLines||this.config.limitMoveLines,});this.widgets=[];_.each(params.params,function(value,name){params.context[name]=name.indexOf('_ids')!==-1?_.map((value+'').split(','),parseFloat):value;});params.params={};_.each(this.config.params,function(name){if(params.context[name]){params.params[name]=params.context[name];}});},willStart:function(){var self=this;var def=this.model.load(this.params.context).then(this._super.bind(this));return def.then(function(){if(!self.model.context||!self.model.context.active_id){self.model.context={'active_id':self.params.context.active_id};}
if(self.params.context.journal_id){self.model.context.active_id=self.params.context.journal_id;}
if(self.model.context.active_id){var promise=self._rpc({model:'account.journal',method:'read',args:[self.model.context.active_id,['display_name']],});}else{var promise=Promise.resolve();}
return promise.then(function(result){var title=result&&result[0]?result[0]['display_name']:self.params.display_name||''
self.controlPanelProps.title=title;self.renderer=new self.config.ActionRenderer(self,self.model,{'bank_statement_line_id':self.model.bank_statement_line_id,'valuenow':self.model.valuenow,'valuemax':self.model.valuemax,'title':title,});});});},reload:async function(){var self=this;self.$('.o_reconciliation_lines').addClass('d-none');_.each(this.widgets,function(widget){widget.destroy();});this.widgets=[];self.$('.o_reconciliation_lines').removeClass('d-none');await this.model.reload();await this._renderLinesOrRainbow();this.updateControlPanel();},_renderLinesOrRainbow:function(){var self=this;return self._renderLines().then(function(){var initialState=self.renderer._initialState;var valuenow=self.model.statement?self.model.statement.value_min:initialState.valuenow;var valuemax=self.model.statement?self.model.statement.value_max:initialState.valuemax;if(valuenow===valuemax){initialState.valuenow=valuenow;initialState.context=self.model.getContext();self.renderer.showRainbowMan(initialState);self.controlPanelProps.cp_content={$buttons:$(),$pager:$(),};}else{if(initialState.valuenow>0)
self.renderer._renderNotifications(self.model.statement.notifications);self._openFirstLine();self.renderer.$('[data-toggle="tooltip"]').tooltip();self.do_show();}});},start:function(){var self=this;var args=arguments;var sup=this._super;return this.renderer.prependTo(self.$('.o_form_sheet')).then(function(){return self._renderLinesOrRainbow().then(function(){self.do_show();return sup.apply(self,args);});});},do_show:function(){this._super.apply(this,arguments);if(this.action_manager){this.$pager=$(QWeb.render('reconciliation.control.pager',{widget:this.renderer}));this.controlPanelProps.cp_content={$buttons:$(),$pager:this.$pager,};this.renderer.$progress=this.$pager;$(this.renderer.$progress).parent().css('width','100%').css('padding-left','0');}},_getWidget:function(handle){return _.find(this.widgets,function(widget){return widget.handle===handle;});},_loadMore:function(qty){var self=this;return this.model.loadMore(qty).then(function(){return self._renderLines();});},_openFirstLine:function(previous_handle){var self=this;previous_handle=previous_handle||'rline0';var handle=_.compact(_.map(this.model.lines,function(line,handle){return(line.reconciled||(parseInt(handle.substr(5))<parseInt(previous_handle.substr(5))))?null:handle;}))[0];if(handle){var line=this.model.getLine(handle);this.model.changeMode(handle,'default').then(function(){self._getWidget(handle).update(line);}).guardedCatch(function(){self._getWidget(handle).update(line);}).then(function(){self._getWidget(handle).$el.focus();});}
return handle;},_forceUpdate:function(){var self=this;_.each(this.model.lines,function(handle){var widget=self._getWidget(handle['handle']);if(widget&&handle.need_update){widget.update(handle);widget.need_update=false;}})},_renderLines:function(){var self=this;var linesToDisplay=this.model.getStatementLines();var linePromises=[];_.each(linesToDisplay,function(line,handle){var widget=new self.config.LineRenderer(self,self.model,line);widget.handle=handle;self.widgets.push(widget);linePromises.push(widget.appendTo(self.$('.o_reconciliation_lines')));});return Promise.all(linePromises);},_onAction:function(event){var self=this;var handle=event.target.handle;var current_line=this.model.getLine(handle);this.model[_.str.camelize(event.name)](handle,event.data.data).then(function(){var widget=self._getWidget(handle);if(widget){widget.update(current_line);}
if(current_line.mode!=='inactive'){_.each(self.model.lines,function(line,_handle){if(line.mode!=='inactive'&&_handle!==handle){self.model.changeMode(_handle,'inactive');var widget=self._getWidget(_handle);if(widget){widget.update(line);}}});}});},_onSearch:function(searchQuery){var self=this;this.model.domain=searchQuery.domain;this.model.display_context='search';self.reload().then(function(){self.renderer._updateProgressBar({'valuenow':self.model.valuenow,'valuemax':self.model.valuemax,});});},_onActionPartialAmount:function(event){var self=this;var handle=event.target.handle;var line=this.model.getLine(handle);var amount=this.model.getPartialReconcileAmount(handle,event.data);self._getWidget(handle).updatePartialAmount(event.data.data,amount);},_onCloseStatement:function(event){var self=this;return this.model.closeStatement().then(function(result){self.do_action({name:'Bank Statements',res_model:'account.bank.statement',res_id:result,views:[[false,'form']],type:'ir.actions.act_window',view_mode:'form',});$('.o_reward').remove();});},_onValidate:function(event){var self=this;var handle=event.target.handle;this.model.validate(handle).then(function(result){self.renderer.update({'valuenow':self.model.valuenow,'valuemax':self.model.valuemax,'title':self.title,'time':Date.now()-self.time,'notifications':result.notifications,'context':self.model.getContext(),});self._forceUpdate();_.each(result.handles,function(handle){var widget=self._getWidget(handle);if(widget){widget.destroy();var index=_.findIndex(self.widgets,function(widget){return widget.handle===handle;});self.widgets.splice(index,1);}});self._openFirstLine(handle);});},});var ManualAction=StatementAction.extend({title:core._t('Journal Items to Reconcile'),withSearchBar:false,config:_.extend({},StatementAction.prototype.config,{Model:ReconciliationModel.ManualModel,ActionRenderer:ReconciliationRenderer.ManualRenderer,LineRenderer:ReconciliationRenderer.ManualLineRenderer,params:['company_ids','mode','partner_ids','account_ids'],limitMoveLines:15,}),_onValidate:function(event){var self=this;var handle=event.target.handle;var method='validate';this.model[method](handle).then(function(result){_.each(result.reconciled,function(handle){self._getWidget(handle).destroy();});_.each(result.updated,function(handle){self._getWidget(handle).update(self.model.getLine(handle));});self.renderer.update({valuenow:_.compact(_.invoke(self.widgets,'isDestroyed')).length,valuemax:self.widgets.length,title:self.title,time:Date.now()-self.time,});if(!_.any(result.updated,function(handle){return self.model.getLine(handle).mode!=='inactive';})){self._openFirstLine(handle);}});},});core.action_registry.add('bank_statement_reconciliation_view',StatementAction);core.action_registry.add('manual_reconciliation_view',ManualAction);return{StatementAction:StatementAction,ManualAction:ManualAction,};});;

/* /account_accountant/static/src/js/reconciliation/reconciliation_model.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account.ReconciliationModel',function(require){"use strict";var BasicModel=require('web.BasicModel');var field_utils=require('web.field_utils');var utils=require('web.utils');var session=require('web.session');var WarningDialog=require('web.CrashManager').WarningDialog;var core=require('web.core');var _t=core._t;var StatementModel=BasicModel.extend({avoidCreate:false,quickCreateFields:['account_id','amount','analytic_account_id','name','tax_ids','force_tax_included','analytic_tag_ids','to_check'],modes:['create','match_rp','match_other'],init:function(parent,options){this._super.apply(this,arguments);this.reconcileModels=[];this.lines={};this.valuenow=0;this.valuemax=0;this.alreadyDisplayed=[];this.domain=[];this.limitMoveLines=options&&options.limitMoveLines||15;this.display_context='init';},addProposition:function(handle,mv_line_id){var self=this;var line=this.getLine(handle);var prop=_.clone(_.find(line['mv_lines_'+line.mode],{'id':mv_line_id}));if(!prop.is_liquidity_line){var balance=line.balance.amount
var prop_amount=prop.partial_amount||prop.amount;var format_options={currency_id:line.st_line.currency_id};if(balance>0.0&&prop_amount>balance){prop.partial_amount=balance
prop.partial_amount_str=field_utils.format.monetary(prop.partial_amount,{},format_options);}else if(balance<0.0&&prop_amount<balance){prop.partial_amount=balance
prop.partial_amount_str=field_utils.format.monetary(-prop.partial_amount,{},format_options);}}
this._addProposition(line,prop);line.limit_override=(line.offset+1)+this.limitMoveLines;line.reconciliation_proposition=_.filter(line.reconciliation_proposition,function(prop){return!prop.invalid;});if(!line.st_line.partner_id&&line.reconciliation_proposition&&line.reconciliation_proposition.length==1&&prop.partner_id&&line.type===undefined){return this.changePartner(handle,{'id':prop.partner_id,'display_name':prop.partner_name},true).then(function(){return Promise.all([self._computeLine(line),self._performMoveLine(handle,'match_rp'),self._performMoveLine(handle,'match_other')]);});}
return Promise.all([this._computeLine(line),this._performMoveLine(handle,'match_rp'),self._performMoveLine(handle,'match_other')]);},changeFilter:function(handle,filter){var line=this.getLine(handle);line['filter_'+line.mode]=filter;line.offset=0;return this._performMoveLine(handle,line.mode);},changeMode:function(handle,mode){var self=this;var line=this.getLine(handle);if(mode==='default'){var match_requests=self.modes.filter(x=>x.startsWith('match')).map(x=>this._performMoveLine(handle,x))
return Promise.all(match_requests).then(function(){return self.changeMode(handle,self._getDefaultMode(handle));});}
if(mode==='next'){var available_modes=self._getAvailableModes(handle)
mode=available_modes[(available_modes.indexOf(line.mode)+1)%available_modes.length];}
line.mode=mode;if(['match_rp','match_other'].includes(line.mode)){if(!(line['mv_lines_'+line.mode]&&line['mv_lines_'+line.mode].length)){return this._performMoveLine(handle,line.mode);}else{return this._formatMoveLine(handle,line.mode,line['mv_lines_'+line.mode]);}}
if(line.mode==='create'){return this.createProposition(handle);}
return Promise.resolve();},changeOffset:function(handle,offset){var line=this.getLine(handle);line.offset+=(offset>0?1:-1)*this.limitMoveLines;return this._performMoveLine(handle,line.mode);},changePartner:function(handle,partner,preserveMode){var self=this;var line=this.getLine(handle);line.st_line.partner_id=partner&&partner.id;line.st_line.partner_name=partner&&partner.display_name||'';return Promise.resolve(partner&&this._changePartner(handle,partner.id)).then(function(){if(line.st_line.partner_id){_.each(line.reconciliation_proposition,function(prop){if(prop.partner_id!=line.st_line.partner_id){line.reconciliation_proposition=[];return false;}});}
return self._computeLine(line);}).then(function(){return self.changeMode(handle,preserveMode?line.mode:'default',true);})},closeStatement:function(){var self=this;return this._rpc({model:'account.bank.statement',method:'button_validate',args:[self.statement.statement_id],}).then(function(){return self.statement.statement_id;});},createProposition:function(handle){var line=this.getLine(handle);var prop=_.filter(line.reconciliation_proposition,'__focus');prop=this._formatQuickCreate(line);line.reconciliation_proposition.push(prop);line.createForm=_.pick(prop,this.quickCreateFields);return this._computeLine(line);},getContext:function(){return this.context;},getStatementLines:function(){var self=this;var linesToDisplay=_.pick(this.lines,function(value,key,object){if(value.visible===true&&self.alreadyDisplayed.indexOf(key)===-1){self.alreadyDisplayed.push(key);return object;}});return linesToDisplay;},getLine:function(handle){return this.lines[handle];},__load:function(context){var self=this;this.context=context;this.statement_line_ids=context.statement_line_ids;if(this.statement_line_ids===undefined){return self._rpc({model:'account.bank.statement.line',method:'search_read',fields:['id'],domain:[['journal_id','=?',context.active_id]],}).then(function(result){self.statement_line_ids=result.map(r=>r.id);return self.reload()})}else{return self.reload();}},loadData:function(ids,excluded_ids){var self=this;return self._rpc({model:'account.reconciliation.widget',method:'get_bank_statement_line_data',args:[ids,excluded_ids],context:self.context,}).then(function(res){return self._formatLine(res['lines']);})},__reload:function(){var self=this;self.alreadyDisplayed=[];self.lines={};var def_statement=this._rpc({model:'account.reconciliation.widget',method:'get_bank_statement_data',kwargs:{"bank_statement_line_ids":self.statement_line_ids,"srch_domain":self.domain},context:self.context,}).then(function(statement){self.statement=statement;self.bank_statement_line_id=self.statement_line_ids.length===1?{id:self.statement_line_ids[0],display_name:statement.statement_name}:false;self.valuenow=self.valuenow||statement.value_min;self.valuemax=self.valuemax||statement.value_max;self.context.journal_id=statement.journal_id;_.each(statement.lines,function(res){var handle=_.uniqueId('rline');self.lines[handle]={id:res.st_line.id,partner_id:res.st_line.partner_id,handle:handle,reconciled:false,mode:'inactive',mv_lines_match_rp:[],mv_lines_match_other:[],offset:0,filter_match_rp:"",filter_match_other:"",reconciliation_proposition:[],reconcileModels:[],};});});var domainReconcile=[];if(self.context&&self.context.company_ids){domainReconcile.push(['company_id','in',self.context.company_ids]);}
if(self.context&&self.context.active_model==='account.journal'&&self.context.active_ids){domainReconcile.push('|');domainReconcile.push(['match_journal_ids','=',false]);domainReconcile.push(['match_journal_ids','in',self.context.active_ids]);}
var def_reconcileModel=this._loadReconciliationModel({domainReconcile:domainReconcile});var def_account=this._rpc({model:'account.account',method:'search_read',fields:['code'],}).then(function(accounts){self.accounts=_.object(_.pluck(accounts,'id'),_.pluck(accounts,'code'));});var def_taxes=self._loadTaxes();return Promise.all([def_statement,def_reconcileModel,def_account,def_taxes]).then(function(){_.each(self.lines,function(line){line.reconcileModels=self.reconcileModels;});return self._formatLine(self.statement.lines);});},_readAnalyticTags:function(params){var self=this;this.analyticTags={};if(!params||!params.res_ids||!params.res_ids.length){return $.when();}
var fields=(params&&params.fields||[]).concat(['id','display_name']);return this._rpc({model:'account.analytic.tag',method:'read',args:[params.res_ids,fields,],}).then(function(tags){for(var i=0;i<tags.length;i++){var tag=tags[i];self.analyticTags[tag.id]=tag;}});},_loadReconciliationModel:function(params){var self=this;return this._rpc({model:'account.reconcile.model',method:'search_read',domain:params.domainReconcile||[],}).then(function(reconcileModels){var analyticTagIds=[];for(var i=0;i<reconcileModels.length;i++){var modelTags=reconcileModels[i].analytic_tag_ids||[];for(var j=0;j<modelTags.length;j++){if(analyticTagIds.indexOf(modelTags[j])===-1){analyticTagIds.push(modelTags[j]);}}}
return self._readAnalyticTags({res_ids:analyticTagIds}).then(function(){for(var i=0;i<reconcileModels.length;i++){var recModel=reconcileModels[i];var analyticTagData=[];var modelTags=reconcileModels[i].analytic_tag_ids||[];for(var j=0;j<modelTags.length;j++){var tagId=modelTags[j];analyticTagData.push([tagId,self.analyticTags[tagId].display_name])}
recModel.analytic_tag_ids=analyticTagData;}
self.reconcileModels=reconcileModels;});});},_loadTaxes:function(){var self=this;self.taxes={};return this._rpc({model:'account.tax',method:'search_read',fields:['price_include','name'],}).then(function(taxes){_.each(taxes,function(tax){self.taxes[tax.id]={price_include:tax.price_include,display_name:tax.name,};});return taxes;});},quickCreateProposition:function(handle,reconcile_model_id){var self=this;var line=this.getLine(handle);return this._rpc({model:'account.reconciliation.widget',method:'get_reconciliation_dict_from_model',args:[reconcile_model_id,line.st_line.id,-line.balance.amount],}).then(function(result){return self.prepare_propositions_from_server(line,result);})},prepare_propositions_from_server:function(widget_line,server_lines){var lastBaseLineId=null;_.each(server_lines,function(r){r.id=_.uniqueId('createLine');r.display=true;r.invalid=false;r.__tax_to_recompute=false;r.amount=-r.balance;r.base_amount=r.amount;if(!r.tax_repartition_line_id){lastBaseLineId=r.id;r.__focus=true;}else{r.is_tax=true;r.link=lastBaseLineId;}})
widget_line.reconciliation_proposition.push(...server_lines);if(server_lines.length>0){widget_line.reconcile_model_id=server_lines[0].reconcile_model_id;}
var prop=_.last(_.filter(widget_line.reconciliation_proposition,'__focus'))
widget_line.createForm=_.pick(prop,this.quickCreateFields);return this._computeLine(widget_line);},removeProposition:function(handle,id){var self=this;var line=this.getLine(handle);var defs=[];line.limit_override=(line.offset+1)+this.limitMoveLines;var prop=_.find(line.reconciliation_proposition,{'id':id});if(prop){line.reconciliation_proposition=_.filter(line.reconciliation_proposition,function(p){return p.id!==prop.id&&p.id!==prop.link&&p.link!==prop.id&&(!p.link||p.link!==prop.link);});if(!isNaN(id)){if(['receivable','payable','liquidity'].includes(prop.account_type)){line.mv_lines_match_rp.unshift(prop);}else{line.mv_lines_match_other.unshift(prop);}}
if(line.reconciliation_proposition.length==0&&line.st_line.has_no_partner)
defs.push(self.changePartner(line.handle));}
var write_off=_.find(line.write_off_vals,{'id':id});if(write_off){line.write_off_vals=_.filter(line.write_off_vals,function(w){return w.id!==write_off.id;});}
line.mode=(id||line.mode!=="create")&&isNaN(id)?'create':'match_rp';defs.push(this._computeLine(line));self._refresh_partial_rec_preview(line);return Promise.all(defs).then(function(){return self.changeMode(handle,line.mode,true);})},getPartialReconcileAmount:function(handle,data){var line=this.getLine(handle);var formatOptions={currency_id:line.st_line.currency_id,noSymbol:true,};var prop=_.find(line.reconciliation_proposition,{'id':data.data});if(prop){var amount=prop.partial_amount||prop.amount;var partial=Math.abs(line.balance.amount+amount);if(Math.abs(line.balance.amount)<Math.abs(amount)&&partial<=Math.abs(prop.amount)&&partial>=0){amount=partial;}
return field_utils.format.monetary(Math.abs(amount),{},formatOptions);}},partialReconcile:function(handle,data){var line=this.getLine(handle);var prop=_.find(line.reconciliation_proposition,{'id':data.mvLineId});if(prop){var amount=data.amount;try{amount=field_utils.parse.float(data.amount);}
catch(err){amount=NaN;}
if(amount>=Math.abs(prop.amount)||amount<=0||isNaN(amount)){delete prop.partial_amount_str;delete prop.partial_amount;if(isNaN(amount)||amount<0){this.do_warn(_.str.sprintf(_t('The amount %s is not a valid partial amount'),data.amount));}
return this._computeLine(line);}
else{var format_options={currency_id:line.st_line.currency_id};prop.partial_amount=(prop.amount>0?1:-1)*amount;prop.partial_amount_str=field_utils.format.monetary(Math.abs(prop.partial_amount),{},format_options);}}
return this._computeLine(line);},updateProposition:function(handle,values){var self=this;var line=this.getLine(handle);var prop=_.last(_.filter(line.reconciliation_proposition,'__focus'));if('to_check'in values&&values.to_check===false){prop.to_check=line.reconciliation_proposition.some(function(rec_prop,index){return rec_prop.id!==prop.id&&rec_prop.to_check;});}
if(!prop){prop=this._formatQuickCreate(line);line.reconciliation_proposition.push(prop);}
_.each(values,function(value,fieldName){if(fieldName==='analytic_tag_ids'){switch(value.operation){case"ADD_M2M":var vids=_.isArray(value.ids)?value.ids:[value.ids];_.each(vids,function(val){if(!_.findWhere(prop.analytic_tag_ids,{id:val.id})){prop.analytic_tag_ids.push(val);}});break;case"FORGET":var id=self.localData[value.ids[0]].ref;prop.analytic_tag_ids=_.filter(prop.analytic_tag_ids,function(val){return val.id!==id;});break;}}
else if(fieldName==='tax_ids'){switch(value.operation){case"ADD_M2M":prop.__tax_to_recompute=true;var vids=_.isArray(value.ids)?value.ids:[value.ids];_.each(vids,function(val){if(!_.findWhere(prop.tax_ids,{id:val.id})){value.ids.price_include=self.taxes[val.id]?self.taxes[val.id].price_include:false;prop.tax_ids.push(val);}});break;case"FORGET":prop.__tax_to_recompute=true;var id=self.localData[value.ids[0]].ref;prop.tax_ids=_.filter(prop.tax_ids,function(val){return val.id!==id;});break;}}
else{prop[fieldName]=values[fieldName];}});if('account_id'in values){prop.account_code=prop.account_id?this.accounts[prop.account_id.id]:'';}
if('amount'in values){prop.base_amount=values.amount;}
if('force_tax_included'in values||'amount'in values||'account_id'in values){prop.__tax_to_recompute=true;}
line.createForm=_.pick(prop,this.quickCreateFields);if(prop.base_amount)
line.createForm.amount=prop.base_amount;if(!prop.tax_ids||prop.tax_ids.length!==1){prop.amount=prop.base_amount;line.createForm.force_tax_included=false;}
return this._computeLine(line);},validate:function(handle){var self=this;this.display_context='validate';var handles=[];if(handle){handles=[handle];}else{_.each(this.lines,function(line,handle){if(!line.reconciled&&line.balance&&!line.balance.amount&&line.reconciliation_proposition.length){handles.push(handle);}});}
var ids=[];var values=[];var handlesPromises=[];_.each(handles,function(handle){var line=self.getLine(handle);var props=_.filter(line.reconciliation_proposition,function(prop){return!prop.invalid;});var computeLinePromise;if(props.length===0){props.push(self._formatQuickCreate(line,{account_id:[line.st_line.open_balance_account_id,self.accounts[line.st_line.open_balance_account_id]],}));line.reconciliation_proposition.push(props[0]);computeLinePromise=self._computeLine(line);}
ids.push(line.id);handlesPromises.push(Promise.resolve(computeLinePromise).then(function(){var move_line_values=_.map(_.filter(props,function(prop){return!isNaN(prop.id)&&!prop.is_liquidity_line;}),self._formatToProcessReconciliation.bind(self,line));move_line_values.push(..._.map(_.filter(props,function(prop){return!isNaN(prop.id)&&prop.is_liquidity_line;}),self._formatToProcessReconciliation.bind(self,line)))
move_line_values.push(..._.map(_.filter(props,function(prop){return isNaN(prop.id)&&prop.display;}),self._formatToProcessReconciliation.bind(self,line)))
values.push({partner_id:line.st_line.partner_id,lines_vals_list:move_line_values,to_check:line.to_check,});line.reconciled=true;self.valuenow++;}));_.each(self.lines,function(other_line){if(other_line!=line){var filtered_prop=other_line.reconciliation_proposition.filter(p=>!line.reconciliation_proposition.map(l=>l.id).includes(p.id));if(filtered_prop.length!=other_line.reconciliation_proposition.length){other_line.need_update=true;other_line.reconciliation_proposition=filtered_prop;}
self._computeLine(line);}})});return Promise.all(handlesPromises).then(function(){return self._rpc({model:'account.reconciliation.widget',method:'process_bank_statement_line',args:[ids,values],context:self.context,}).then(self._validatePostProcess.bind(self)).then(function(){return{handles:handles};});});},_addProposition:function(line,prop){line.reconciliation_proposition.push(prop);},_blurProposition:function(handle){var line=this.getLine(handle);line.reconciliation_proposition=_.filter(line.reconciliation_proposition,function(l){l.__focus=false;return!l.invalid;});},_changePartner:function(handle,partner_id){var self=this;return this._rpc({model:'res.partner',method:'read',args:[partner_id,["property_account_receivable_id","property_account_payable_id"]],}).then(function(result){if(result.length>0){var line=self.getLine(handle);self.lines[handle].st_line.open_balance_account_id=line.balance.amount<0?result[0]['property_account_payable_id'][0]:result[0]['property_account_receivable_id'][0];}});},_computeLine:function(line){var self=this;var tax_defs=[];var reconciliation_proposition=[];var formatOptions={currency_id:line.st_line.currency_id,};line.to_check=false;_.each(line.reconciliation_proposition,function(prop){if(prop.to_check){line.to_check=true;}
if(prop.tax_repartition_line_id){if(!_.find(line.reconciliation_proposition,{'id':prop.link}).__tax_to_recompute){reconciliation_proposition.push(prop);}
prop.amount_str=field_utils.format.monetary(Math.abs(prop.amount),{},formatOptions);return;}
if(!prop.is_liquidity_line&&parseInt(prop.id)){prop.is_move_line=true;}
reconciliation_proposition.push(prop);if(prop.tax_ids&&prop.tax_ids.length&&prop.__tax_to_recompute&&prop.base_amount){var args=[prop.tax_ids.map(function(el){return el.id;}),prop.base_amount,formatOptions.currency_id];var add_context={'round':true};if(prop.tax_ids.length===1&&line.createForm.force_tax_included)
add_context.force_price_include=true;tax_defs.push(self._rpc({model:'account.tax',method:'json_friendly_compute_all',args:args,context:$.extend({},self.context||{},add_context),}).then(function(result){_.each(result.taxes,function(tax){var tax_prop=self._formatQuickCreate(line,{'link':prop.id,'tax_ids':tax.tax_ids,'tax_repartition_line_id':tax.tax_repartition_line_id,'tax_tag_ids':tax.tag_ids,'amount':tax.amount,'name':prop.name?prop.name+" "+tax.name:tax.name,'date':prop.date,'account_id':tax.account_id?[tax.account_id,null]:prop.account_id,'analytic':tax.analytic,'__focus':false});prop.tax_exigible=tax.tax_exigibility==='on_payment'?true:undefined;prop.amount=tax.base;prop.amount_str=field_utils.format.monetary(Math.abs(prop.amount),{},formatOptions);prop.invalid=!self._isValid(prop);tax_prop.amount_str=field_utils.format.monetary(Math.abs(tax_prop.amount),{},formatOptions);tax_prop.invalid=prop.invalid;reconciliation_proposition.push(tax_prop);});prop.tax_tag_ids=self._formatMany2ManyTagsTax(result.base_tags||[]);}));}else{prop.amount_str=field_utils.format.monetary(Math.abs(prop.amount),{},formatOptions);prop.display=self._isDisplayedProposition(prop);prop.invalid=!self._isValid(prop);}});return Promise.all(tax_defs).then(function(){_.each(reconciliation_proposition,function(prop){prop.__tax_to_recompute=false;});line.reconciliation_proposition=reconciliation_proposition;var amount_currency=0;var total=line.st_line.amount||0;var isOtherCurrencyId=_.uniq(_.pluck(_.reject(reconciliation_proposition,'invalid'),'currency_id'));isOtherCurrencyId=isOtherCurrencyId.length===1&&!total&&isOtherCurrencyId[0]!==formatOptions.currency_id?isOtherCurrencyId[0]:false;_.each(reconciliation_proposition,function(prop){if(!prop.invalid){total-=prop.partial_amount||prop.amount;if(isOtherCurrencyId){amount_currency-=(prop.amount<0?-1:1)*Math.abs(prop.amount_currency);}}});var company_currency=session.get_currency(line.st_line.currency_id);var company_precision=company_currency&&company_currency.digits[1]||2;total=utils.round_decimals(total,company_precision)||0;if(isOtherCurrencyId){var other_currency=session.get_currency(isOtherCurrencyId);var other_precision=other_currency&&other_currency.digits[1]||2;amount_currency=utils.round_decimals(amount_currency,other_precision);}
line.balance={amount:total,amount_str:field_utils.format.monetary(Math.abs(total),{},formatOptions),currency_id:isOtherCurrencyId,amount_currency:isOtherCurrencyId?amount_currency:total,amount_currency_str:isOtherCurrencyId?field_utils.format.monetary(Math.abs(amount_currency),{},{currency_id:isOtherCurrencyId}):false,account_code:self.accounts[line.st_line.open_balance_account_id],};line.balance.show_balance=line.balance.amount_currency!=0;line.balance.type=line.balance.amount_currency?(line.st_line.partner_id?0:-1):1;});},_formatNameGet:function(value){return value?(value.id?value:{'id':value[0],'display_name':value[1]}):false;},_formatMany2ManyTags:function(value){var res=[];for(var i=0,len=value.length;i<len;i++){res[i]={'id':value[i][0],'display_name':value[i][1]};}
return res;},_formatMany2ManyTagsTax:function(value){var res=[];for(var i=0;i<value.length;i++){res.push({id:value[i],display_name:this.taxes[value[i]]?this.taxes[value[i]].display_name:''});}
return res;},_formatLineProposition:function(line,props){var self=this;if(props.length){_.each(props,function(prop){prop.amount=prop.debit||-prop.credit;prop.account_id=self._formatNameGet(prop.account_id||line.account_id);prop.is_partially_reconciled=prop.amount_str!==prop.total_amount_str;prop.to_check=!!prop.to_check;});}},_formatLine:function(lines){var self=this;var defs=[];_.each(lines,function(data){var line=_.find(self.lines,function(l){return l.id===data.st_line.id;});line.visible=true;line.limitMoveLines=self.limitMoveLines;_.extend(line,data);self._refresh_partial_rec_preview(line);self._formatLineProposition(line,line.reconciliation_proposition);if(!line.reconciliation_proposition.length){delete line.reconciliation_proposition;}
defs.push(self._computeLine(line).then(function(){if(!line.st_line.partner_id&&line.reconciliation_proposition.length>0){var hasDifferentPartners=function(prop){return!prop.partner_id||prop.partner_id!=line.reconciliation_proposition[0].partner_id;};if(!_.any(line.reconciliation_proposition,hasDifferentPartners)){return self.changePartner(line.handle,{'id':line.reconciliation_proposition[0].partner_id,'display_name':line.reconciliation_proposition[0].partner_name,},true);}}else if(!line.st_line.partner_id&&line.partner_id&&line.partner_name){return self.changePartner(line.handle,{'id':line.partner_id,'display_name':line.partner_name,},true);}
return true;}).then(function(){if(data.write_off_vals){return self.prepare_propositions_from_server(line,data.write_off_vals)}
return true;}).then(function(){if(!line.st_line.partner_id&&self.context.partner_id&&self.context.partner_name){return self.changePartner(line.handle,{'id':self.context.partner_id,'display_name':self.context.partner_name,},true);}
return true;}));});return Promise.all(defs);},_refresh_partial_rec_preview:function(line){var st_line_balance_left=line.st_line.amount;_.each(line.reconciliation_proposition,function(proposition){var prop_amount=st_line_balance_left<0?proposition.credit:proposition.debit;var write_off_balances=(line.write_off_vals||[]).map(function(elem){return elem['balance'];})
var write_off_amount=write_off_balances.reduce(function(prev,cur){return prev+cur;},0);var prop_impact=Math.min(Math.abs(st_line_balance_left+write_off_amount),prop_amount);var signed_impact=prop_impact*(proposition.credit>0?-1:1);st_line_balance_left-=signed_impact;if(prop_impact>0&&prop_impact!=prop_amount){proposition.partial_amount=signed_impact;proposition.partial_amount_str=field_utils.format.monetary(Math.abs(proposition.partial_amount),{},{currency_id:line.st_line.currency_id});}
else{delete proposition.partial_amount;delete proposition.partial_amount_str;}});},_formatMoveLine:function(handle,mode,mv_lines){var self=this;var line=this.getLine(handle);if(line.offset===0||line.limit_override){line['mv_lines_'+mode]=mv_lines;delete line.limit_override;}else{line['mv_lines_'+mode]=line['mv_lines_'+mode].concat(mv_lines);}
this._formatLineProposition(line,mv_lines);if((line.mode=='match_other'||line.mode=="match_rp")&&!line['mv_lines_'+mode].length&&!line['filter_'+mode].length){line.mode=self._getDefaultMode(handle);if(line.mode!=='match_rp'&&line.mode!=='match_other'&&line.mode!=='inactive'){return this._computeLine(line).then(function(){return self.createProposition(handle);});}}else{return this._computeLine(line);}},_getDefaultMode:function(handle){var line=this.getLine(handle);if(line.balance.amount===0&&(!line.st_line.mv_lines_match_rp||line.st_line.mv_lines_match_rp.length===0)&&(!line.st_line.mv_lines_match_other||line.st_line.mv_lines_match_other.length===0)){return'inactive';}
if(line.mv_lines_match_rp&&line.mv_lines_match_rp.length){return'match_rp';}
if(line.mv_lines_match_other&&line.mv_lines_match_other.length){return'match_other';}
return'create';},_getAvailableModes:function(handle){var line=this.getLine(handle);var modes=[]
if(line.mv_lines_match_rp&&line.mv_lines_match_rp.length){modes.push('match_rp')}
if(line.mv_lines_match_other&&line.mv_lines_match_other.length){modes.push('match_other')}
modes.push('create')
return modes},_formatQuickCreate:function(line,values){values=values||{};var today=new moment().utc().format();var account=this._formatNameGet(values.account_id);var formatOptions={currency_id:line.st_line.currency_id,};var amount=values.amount!==undefined?values.amount:line.balance.amount;var prop={'id':_.uniqueId('createLine'),'name':values.name||line.st_line.name,'account_id':account,'account_code':account?this.accounts[account.id]:'','analytic_account_id':this._formatNameGet(values.analytic_account_id),'analytic_tag_ids':this._formatMany2ManyTags(values.analytic_tag_ids||[]),'journal_id':this._formatNameGet(values.journal_id),'tax_ids':this._formatMany2ManyTagsTax(values.tax_ids||[]),'tax_tag_ids':this._formatMany2ManyTagsTax(values.tax_tag_ids||[]),'tax_repartition_line_id':values.tax_repartition_line_id,'debit':0,'credit':0,'date':values.date?values.date:field_utils.parse.date(today,{},{isUTC:true}),'force_tax_included':values.force_tax_included||false,'base_amount':amount,'link':values.link,'display':true,'invalid':true,'to_check':!!values.to_check,'__tax_to_recompute':true,'__focus':'__focus'in values?values.__focus:true,};if(prop.base_amount){var sign=prop.base_amount<0?-1:1;var amount=field_utils.format.monetary(Math.abs(prop.base_amount),{},formatOptions);prop.base_amount=sign*field_utils.parse.monetary(amount,{},formatOptions);}
prop.amount=prop.base_amount;return prop;},_getExcludedIds:function(){var excludedIds=[];_.each(this.lines,function(line){if(line.reconciliation_proposition){_.each(line.reconciliation_proposition,function(prop){if(parseInt(prop['id'])){excludedIds.push(prop['id']);}});}});return excludedIds;},_isDisplayedProposition:function(prop){return!isNaN(prop.id)||!!prop.account_id;},_isValid:function(prop){return!isNaN(prop.id)||prop.account_id&&prop.amount&&prop.name&&!!prop.name.length;},_performMoveLine:function(handle,mode){var line=this.getLine(handle);var excluded_ids=_.map(line.reconciliation_proposition,function(prop){return _.isNumber(prop.id)?prop.id:null;}).filter(id=>id!=null);var filter=line['filter_'+mode]||"";var limit=this.limitMoveLines;var offset=line.offset;if(line.limit_override){offset=0;limit=line.limit_override;}
return this._rpc({model:'account.reconciliation.widget',method:'get_move_lines_for_bank_statement_line',args:[line.id,line.st_line.partner_id,excluded_ids,filter,offset,limit,mode==='match_rp'?'rp':'other'],context:this.context,}).then(this._formatMoveLine.bind(this,handle,mode));},_formatToProcessReconciliation:function(line,prop){var amount=-prop.amount;if(prop.partial_amount){amount=-prop.partial_amount;}
var result={name:prop.name,balance:amount,tax_exigible:prop.tax_exigible,analytic_tag_ids:[[6,null,_.pluck(prop.analytic_tag_ids,'id')]]};if(!isNaN(prop.id)){result.id=prop.id;}else{result.account_id=prop.account_id.id;if(prop.journal_id){result.journal_id=prop.journal_id.id;}}
if(prop.analytic_account_id)result.analytic_account_id=prop.analytic_account_id.id;if(prop.tax_ids&&prop.tax_ids.length)result.tax_ids=[[6,null,_.pluck(prop.tax_ids,'id')]];if(prop.tax_tag_ids&&prop.tax_tag_ids.length)result.tax_tag_ids=[[6,null,_.pluck(prop.tax_tag_ids,'id')]];if(prop.tax_repartition_line_id)result.tax_repartition_line_id=prop.tax_repartition_line_id;if(prop.reconcile_model_id)result.reconcile_model_id=prop.reconcile_model_id
if(prop.currency_id)result.currency_id=prop.currency_id;return result;},_validatePostProcess:function(data){var self=this;return Promise.resolve();},});var ManualModel=StatementModel.extend({quickCreateFields:['account_id','journal_id','amount','analytic_account_id','name','tax_ids','force_tax_included','analytic_tag_ids','date','to_check'],modes:['create','match'],addProposition:function(handle,mv_line_id){var line=this.getLine(handle);var res=this._super(handle,mv_line_id);_.each(line.reconciliation_proposition,function(prop){delete prop["partial_amount"]
delete prop["partial_amount_str"]});return res;},__load:function(context){var self=this;this.context=context;var domain_account_id=[];if(context&&context.company_ids){domain_account_id.push(['company_id','in',context.company_ids]);}
var def_account=this._rpc({model:'account.account',method:'search_read',domain:domain_account_id,fields:['code'],}).then(function(accounts){self.account_ids=_.pluck(accounts,'id');self.accounts=_.object(self.account_ids,_.pluck(accounts,'code'));});var domainReconcile=[];var session_allowed_company_ids=session.user_context.allowed_company_ids||[]
var company_ids=context&&context.company_ids||session_allowed_company_ids.slice(0,1);if(company_ids){domainReconcile.push(['company_id','in',company_ids]);}
var def_reconcileModel=this._loadReconciliationModel({domainReconcile:domainReconcile});var def_taxes=this._loadTaxes();return Promise.all([def_reconcileModel,def_account,def_taxes]).then(function(){switch(context.mode){case'customers':case'suppliers':var mode=context.mode==='customers'?'receivable':'payable';var args=['partner',context.partner_ids||null,mode];return self._rpc({model:'account.reconciliation.widget',method:'get_data_for_manual_reconciliation',args:args,context:context,}).then(function(result){self.manualLines=result;self.valuenow=0;self.valuemax=Object.keys(self.manualLines).length;return self.loadData(self.manualLines);});case'accounts':return self._rpc({model:'account.reconciliation.widget',method:'get_data_for_manual_reconciliation',args:['account',context.account_ids||self.account_ids],context:context,}).then(function(result){self.manualLines=result;self.valuenow=0;self.valuemax=Object.keys(self.manualLines).length;return self.loadData(self.manualLines);});default:var partner_ids=context.partner_ids||null;var account_ids=context.account_ids||self.account_ids||null;return self._rpc({model:'account.reconciliation.widget',method:'get_all_data_for_manual_reconciliation',args:[partner_ids,account_ids],context:context,}).then(function(result){self.manualLines=[].concat(result.accounts,result.customers,result.suppliers);self.valuenow=0;self.valuemax=Object.keys(self.manualLines).length;return self.loadData(self.manualLines);});}});},__reload:function(){this.lines={};return this.load(this.context);},loadData:function(lines){var self=this;var defs=[];_.each(lines,function(l){defs.push(self._formatLine(l.mode,l));});return Promise.all(defs);},validate:function(handle){var self=this;var handles=[];if(handle){handles=[handle];}else{_.each(this.lines,function(line,handle){if(!line.reconciled&&!line.balance.amount&&line.reconciliation_proposition.length){handles.push(handle);}});}
var def=Promise.resolve();var process_reconciliations=[];var reconciled=[];_.each(handles,function(handle){var line=self.getLine(handle);if(line.reconciled){return;}
var props=line.reconciliation_proposition;if(!props.length){self.valuenow++;reconciled.push(handle);line.reconciled=true;process_reconciliations.push({id:line.type==='accounts'?line.account_id:line.partner_id,type:line.type,mv_line_ids:[],new_mv_line_dicts:[],});}else{var mv_line_ids=_.pluck(_.filter(props,function(prop){return!isNaN(prop.id);}),'id');var new_mv_line_dicts=_.map(_.filter(props,function(prop){return isNaN(prop.id)&&prop.display;}),self._formatToProcessReconciliation.bind(self,line));process_reconciliations.push({id:null,type:null,mv_line_ids:mv_line_ids,new_mv_line_dicts:new_mv_line_dicts});}
line.reconciliation_proposition=[];});if(process_reconciliations.length){def=self._rpc({model:'account.reconciliation.widget',method:'process_move_lines',args:[process_reconciliations],});}
return def.then(function(){var defs=[];var account_ids=[];var partner_ids=[];_.each(handles,function(handle){var line=self.getLine(handle);if(line.reconciled){return;}
line.filter_match="";line.offset=0;defs.push(self._performMoveLine(handle,'match').then(function(){if(!line.mv_lines_match.length){self.valuenow++;reconciled.push(handle);line.reconciled=true;if(line.type==='accounts'){account_ids.push(line.account_id.id);}else{partner_ids.push(line.partner_id.id);}}}));});return Promise.all(defs).then(function(){if(partner_ids.length){self._rpc({model:'res.partner',method:'mark_as_reconciled',args:[partner_ids],});}
return{reconciled:reconciled,updated:_.difference(handles,reconciled)};});});},removeProposition:function(handle,id){var self=this;var line=this.getLine(handle);var defs=[];var prop=_.find(line.reconciliation_proposition,{'id':id});if(prop){line.reconciliation_proposition=_.filter(line.reconciliation_proposition,function(p){return p.id!==prop.id&&p.id!==prop.link&&p.link!==prop.id&&(!p.link||p.link!==prop.link);});line.mv_lines_match=line.mv_lines_match||[];line.mv_lines_match.unshift(prop);if(line.reconciliation_proposition.length==0&&line.st_line.has_no_partner)
defs.push(self.changePartner(line.handle));}
line.mode=(id||line.mode!=="create")&&isNaN(id)?'create':'match';defs.push(this._computeLine(line));self._refresh_partial_rec_preview(line);return Promise.all(defs).then(function(){return self.changeMode(handle,line.mode,true);})},_computeLine:function(line){return this._super(line).then(function(){var props=_.reject(line.reconciliation_proposition,'invalid');_.each(line.reconciliation_proposition,function(p){delete p.is_move_line;});line.balance.type=-1;if(!line.balance.amount_currency&&props.length){line.balance.type=1;}else if(_.any(props,function(prop){return prop.amount>0;})&&_.any(props,function(prop){return prop.amount<0;})){line.balance.type=0;}});},_formatLine:function(type,data){var line=this.lines[_.uniqueId('rline')]=_.extend(data,{type:type,reconciled:false,mode:'inactive',offset:0,limitMoveLines:this.limitMoveLines,filter_match:"",reconcileModels:this.reconcileModels,account_id:this._formatNameGet([data.account_id,data.account_name]),st_line:data,visible:true});this._formatLineProposition(line,line.reconciliation_proposition);if(!line.reconciliation_proposition.length){delete line.reconciliation_proposition;}
return this._computeLine(line);},_formatLineProposition:function(line,props){var self=this;this._super(line,props);if(props.length){_.each(props,function(prop){var tmp_value=prop.debit||prop.credit;prop.credit=prop.credit!==0?0:tmp_value;prop.debit=prop.debit!==0?0:tmp_value;prop.amount=-prop.amount;prop.journal_id=self._formatNameGet(prop.journal_id||line.journal_id);prop.to_check=!!prop.to_check;});}},_formatQuickCreate:function(line,values){if(values&&values.journal_id===undefined&&line&&line.createForm&&line.createForm.journal_id){values.journal_id=line.createForm.journal_id;}
return this._super(line,values);},_isDisplayedProposition:function(prop){return!!prop.journal_id&&this._super(prop);},_isValid:function(prop){return prop.journal_id&&this._super(prop);},_performMoveLine:function(handle,mode){var line=this.getLine(handle);var excluded_ids=_.map(line.reconciliation_proposition,function(prop){return _.isNumber(prop.id)?prop.id:null;}).filter(id=>id!=null);var filter=line.filter_match||"";var limit=this.limitMoveLines;var offset=line.offset;if(line.limit_override){limit=line.limit_override;offset=0;}
var args=[line.account_id.id,line.partner_id,excluded_ids,filter,offset,limit];return this._rpc({model:'account.reconciliation.widget',method:'get_move_lines_for_manual_reconciliation',args:args,context:this.context,}).then(this._formatMoveLine.bind(this,handle,''));},_formatToProcessReconciliation:function(line,prop){var result=this._super(line,prop);result['date']=prop.date;return result;},_getDefaultMode:function(handle){var line=this.getLine(handle);if(line.balance.amount===0&&(!line.st_line.mv_lines_match||line.st_line.mv_lines_match.length===0)){return'inactive';}
return line.mv_lines_match.length>0?'match':'create';},_formatMoveLine:function(handle,mode,mv_lines){var self=this;var line=this.getLine(handle);if(line.offset===0||line.limit_override){line.mv_lines_match=mv_lines;delete line.limit_override;}else{line.mv_lines_match=line.mv_lines_match.concat(mv_lines);}
this._formatLineProposition(line,mv_lines);if(line.mode!=='create'&&!line.mv_lines_match.length&&!line.filter_match.length){line.mode=this.avoidCreate||!line.balance.amount?'inactive':'create';if(line.mode==='create'){return this._computeLine(line).then(function(){return self.createProposition(handle);});}}else{return this._computeLine(line);}},});return{StatementModel:StatementModel,ManualModel:ManualModel,};});;

/* /account_accountant/static/src/js/reconciliation/reconciliation_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account.ReconciliationRenderer',function(require){"use strict";var Widget=require('web.Widget');var FieldManagerMixin=require('web.FieldManagerMixin');var relational_fields=require('web.relational_fields');var basic_fields=require('web.basic_fields');var core=require('web.core');var time=require('web.time');var session=require('web.session');var qweb=core.qweb;var _t=core._t;var StatementRenderer=Widget.extend(FieldManagerMixin,{template:'reconciliation.statement',events:{'click *[rel="do_action"]':'_onDoAction',},init:function(parent,model,state){this._super(parent);this.model=model;this._initialState=state;},start:function(){var self=this;var defs=[this._super.apply(this,arguments)];this.time=Date.now();this.$progress=$('');return Promise.all(defs);},showRainbowMan:function(state){if(this.model.display_context!=='validate'){return}
var dt=Date.now()-this.time;var $done=$(qweb.render("reconciliation.done",{'duration':moment(dt).utc().format(time.getLangTimeFormat()),'number':state.valuenow,'timePerTransaction':Math.round(dt/1000/state.valuemax),'context':state.context,}));$done.find('*').addClass('o_reward_subcontent');$done.find('.button_close_statement').click(this._onCloseBankStatement.bind(this));$done.find('.button_back_to_statement').click(this._onGoToBankStatement.bind(this));if(session.show_effect){this.trigger_up('show_effect',{type:'rainbow_man',fadeout:'no',message:$done,});this.$el.css('min-height','450px');}else{$done.appendTo(this.$el);}},update:function(state){var self=this;this._updateProgressBar(state);if(state.valuenow===state.valuemax&&!this.$('.done_message').length){this.showRainbowMan(state);}
if(state.notifications){this._renderNotifications(state.notifications);}},_updateProgressBar:function(state){this.$progress.find('.valuenow').text(state.valuenow);this.$progress.find('.valuemax').text(state.valuemax);this.$progress.find('.progress-bar').attr('aria-valuenow',state.valuenow).attr('aria-valuemax',state.valuemax).css('width',(state.valuenow/state.valuemax*100)+'%');},_renderNotifications:function(notifications){this.$(".notification_area").empty();for(var i=0;i<notifications.length;i++){var $notification=$(qweb.render("reconciliation.notification",notifications[i])).hide();$notification.appendTo(this.$(".notification_area")).slideDown(300);}},_onCloseBankStatement:function(e){this.trigger_up('close_statement');},_onDoAction:function(e){e.preventDefault();var name=e.currentTarget.dataset.action_name;var model=e.currentTarget.dataset.model;if(e.currentTarget.dataset.ids){var ids=e.currentTarget.dataset.ids.split(",").map(Number);var domain=[['id','in',ids]];}else{var domain=e.currentTarget.dataset.domain;}
var context=e.currentTarget.dataset.context;var tag=e.currentTarget.dataset.tag;if(tag){this.do_action({type:'ir.actions.client',tag:tag,context:context,})}else{this.do_action({name:name,res_model:model,domain:domain,context:context,views:[[false,'list'],[false,'form']],type:'ir.actions.act_window',view_mode:"list"});}},_onGoToBankStatement:function(e){var journalId=$(e.target).attr('data_journal_id');if(journalId){journalId=parseInt(journalId);}
$('.o_reward').remove();this.do_action({name:'Bank Statements',res_model:'account.bank.statement',views:[[false,'list'],[false,'form']],type:'ir.actions.act_window',context:{search_default_journal_id:journalId,'journal_type':'bank'},view_mode:'form',});},});var LineRenderer=Widget.extend(FieldManagerMixin,{template:"reconciliation.line",events:{'click .accounting_view caption .o_buttons button':'_onValidate','click .accounting_view tfoot':'_onChangeTab','click':'_onTogglePanel','click .o_field_widget':'_onStopPropagation','keydown .o_input, .edit_amount_input':'_onStopPropagation','click .o_notebook li a':'_onChangeTab','click .cell':'_onEditAmount','change input.filter':'_onFilterChange','click .match .load-more a':'_onLoadMore','click .match .mv_line td':'_onSelectMoveLine','click .accounting_view tbody .mv_line td':'_onSelectProposition','click .o_reconcile_models button':'_onQuickCreateProposition','click .create .add_line':'_onCreateProposition','click .reconcile_model_create':'_onCreateReconcileModel','click .reconcile_model_edit':'_onEditReconcileModel','keyup input':'_onInputKeyup','blur input':'_onInputKeyup','keydown':'_onKeydown',},custom_events:_.extend({},FieldManagerMixin.custom_events,{'field_changed':'_onFieldChanged',}),_avoidFieldUpdate:{},MV_LINE_DEBOUNCE:200,_onKeydown:function(ev){switch(ev.which){case $.ui.keyCode.ENTER:this.trigger_up('navigation_move',{direction:'validate',handle:this.handle});break;case $.ui.keyCode.UP:ev.stopPropagation();ev.preventDefault();this.trigger_up('navigation_move',{direction:'up',handle:this.handle});break;case $.ui.keyCode.DOWN:ev.stopPropagation();ev.preventDefault();this.trigger_up('navigation_move',{direction:'down',handle:this.handle});break;}},init:function(parent,model,state){this._super(parent);FieldManagerMixin.init.call(this);this.model=model;this._initialState=state;if(this.MV_LINE_DEBOUNCE){this._onSelectMoveLine=_.debounce(this._onSelectMoveLine,this.MV_LINE_DEBOUNCE,true);}else{this._onSelectMoveLine=this._onSelectMoveLine;}},start:function(){var self=this;var def1=this._makePartnerRecord(this._initialState.st_line.partner_id,this._initialState.st_line.partner_name).then(function(recordID){self.fields={partner_id:new relational_fields.FieldMany2One(self,'partner_id',self.model.get(recordID),{mode:'edit',attrs:{placeholder:self._initialState.st_line.communication_partner_name||_t('Select Partner'),}})};self.fields.partner_id.insertAfter(self.$('.accounting_view caption .o_buttons'));});$('<span class="line_info_button fa fa-info-circle"/>').appendTo(this.$('thead .cell_info_popover')).attr("data-content",qweb.render('reconciliation.line.statement_line.details',{'state':this._initialState}));this.$el.popover({'selector':'.line_info_button','placement':'left','container':this.$el,'html':true,'sanitize':false,'trigger':'hover','animation':false,'toggle':'popover'});var def2=this._super.apply(this,arguments);var def3=session.user_has_group('analytic.group_analytic_tags').then(function(has_group){self.group_tags=has_group;});var def4=session.user_has_group('analytic.group_analytic_accounting').then(function(has_group){self.group_acc=has_group;});return Promise.all([def1,def2,def3,def4]);},update:function(state){var self=this;var to_check_checked=!!(state.to_check);this.$('caption .o_buttons button.o_validate').toggleClass('d-none',!!state.balance.type&&!to_check_checked);this.$('caption .o_buttons button.o_reconcile').toggleClass('d-none',state.balance.type<=0||to_check_checked);this.$('caption .o_buttons .o_no_valid').toggleClass('d-none',state.balance.type>=0);self.$('caption .o_buttons button.o_validate').toggleClass('text-warning',to_check_checked);this._makePartnerRecord(state.st_line.partner_id,state.st_line.partner_name).then(function(recordID){self.fields.partner_id.reset(self.model.get(recordID));self.$el.attr('data-partner',state.st_line.partner_id);});this.$el.data('mode',state.mode).attr('data-mode',state.mode);this.$('.o_notebook li a').attr('aria-selected',false);this.$('.o_notebook li a').removeClass('active');this.$('.o_notebook .tab-content .tab-pane').removeClass('active');this.$('.o_notebook li a[href*="notebook_page_'+state.mode+'"]').attr('aria-selected',true);this.$('.o_notebook li a[href*="notebook_page_'+state.mode+'"]').addClass('active');this.$('.o_notebook .tab-content .tab-pane[id*="notebook_page_'+state.mode+'"]').addClass('active');this.$('.create, .match').each(function(){$(this).removeAttr('style');});var $props=this.$('.accounting_view tbody').empty();var props=[];var balance=state.balance.amount_currency;_.each(state.reconciliation_proposition,function(prop){if(prop.display){props.push(prop);}});_.each(props,function(line){var $line=$(qweb.render("reconciliation.line.mv_line",{'line':line,'state':state,'proposition':true}));if(!isNaN(line.id)){$('<span class="line_info_button fa fa-info-circle"/>').appendTo($line.find('.cell_info_popover')).attr("data-content",qweb.render('reconciliation.line.mv_line.details',{'line':line}));}
$props.append($line);});var matching_modes=self.model.modes.filter(x=>x.startsWith('match'));for(let i=0;i<matching_modes.length;i++){var stateMvLines=state['mv_lines_'+matching_modes[i]]||[];var recs_count=stateMvLines.length>0?stateMvLines[0].recs_count:0;var remaining=recs_count-stateMvLines.length;var $mv_lines=this.$('div[id*="notebook_page_'+matching_modes[i]+'"] .match table tbody').empty();this.$('.o_notebook li a[href*="notebook_page_'+matching_modes[i]+'"]').parent().toggleClass('d-none',stateMvLines.length===0&&!state['filter_'+matching_modes[i]]);_.each(stateMvLines,function(line){var $line=$(qweb.render("reconciliation.line.mv_line",{'line':line,'state':state}));if(!isNaN(line.id)){$('<span class="line_info_button fa fa-info-circle"/>').appendTo($line.find('.cell_info_popover')).attr("data-content",qweb.render('reconciliation.line.mv_line.details',{'line':line}));}
$mv_lines.append($line);});this.$('div[id*="notebook_page_'+matching_modes[i]+'"] .match div.load-more').toggle(remaining>0);this.$('div[id*="notebook_page_'+matching_modes[i]+'"] .match div.load-more span').text(remaining);}
this.$('.popover').remove();this.$('table tfoot').html(qweb.render("reconciliation.line.balance",{'state':state}));if(state.createForm){var createPromise;if(!this.fields.account_id){createPromise=this._renderCreate(state);}
Promise.resolve(createPromise).then(function(){var data=self.model.get(self.handleCreateRecord).data;return self.model.notifyChanges(self.handleCreateRecord,state.createForm).then(function(){return self.model.notifyChanges(self.handleCreateRecord,{analytic_tag_ids:{operation:'REPLACE_WITH',ids:[]}})}).then(function(){var defs=[];_.each(state.createForm.analytic_tag_ids,function(tag){defs.push(self.model.notifyChanges(self.handleCreateRecord,{analytic_tag_ids:{operation:'ADD_M2M',ids:tag}}));});return Promise.all(defs);}).then(function(){return self.model.notifyChanges(self.handleCreateRecord,{tax_ids:{operation:'REPLACE_WITH',ids:[]}})}).then(function(){var defs=[];_.each(state.createForm.tax_ids,function(tag){defs.push(self.model.notifyChanges(self.handleCreateRecord,{tax_ids:{operation:'ADD_M2M',ids:tag}}));});return Promise.all(defs);}).then(function(){var record=self.model.get(self.handleCreateRecord);_.each(self.fields,function(field,fieldName){if(self._avoidFieldUpdate[fieldName])return;if(fieldName==="partner_id")return;if((data[fieldName]||state.createForm[fieldName])&&!_.isEqual(state.createForm[fieldName],data[fieldName])){field.reset(record);}
if(fieldName==='tax_ids'){if(!state.createForm[fieldName]||!state.createForm[fieldName].length||state.createForm[fieldName].length>1){$('.create_force_tax_included').addClass('d-none');}
else{$('.create_force_tax_included').removeClass('d-none');var price_include=state.createForm[fieldName][0].price_include;var force_tax_included=state.createForm[fieldName][0].force_tax_included;self.$('.create_force_tax_included input').prop('checked',force_tax_included);self.$('.create_force_tax_included input').prop('disabled',price_include);}}});if(state.to_check){self.$('.create_to_check input').prop('checked',state.to_check).change();}
return true;});});}
this.$('.create .add_line').toggle(!!state.balance.amount_currency);},updatePartialAmount:function(line_id,amount){var $line=this.$('.mv_line[data-line-id='+line_id+']');$line.find('.edit_amount').addClass('d-none');$line.find('.edit_amount_input').removeClass('d-none');$line.find('.edit_amount_input').focus();$line.find('.edit_amount_input').val(amount);$line.find('.line_amount').addClass('d-none');},_destroyPopover:function($el){var popover=$el.data('bs.popover');if(popover){popover.dispose();}},_makePartnerRecord:function(partnerID,partnerName){var field={relation:'res.partner',type:'many2one',name:'partner_id',};if(partnerID){field.value=[partnerID,partnerName];}
return this.model.makeRecord('account.bank.statement.line',[field],{partner_id:{domain:["|",["is_company","=",true],["parent_id","=",false]],options:{no_open:true}}});},_renderCreate:function(state){var self=this;return this.model.makeRecord('account.bank.statement.line',[{relation:'account.account',type:'many2one',name:'account_id',domain:[['company_id','=',state.st_line.company_id],['deprecated','=',false]],},{relation:'account.journal',type:'many2one',name:'journal_id',domain:[['company_id','=',state.st_line.company_id]],},{relation:'account.tax',type:'many2many',name:'tax_ids',domain:[['company_id','=',state.st_line.company_id]],},{relation:'account.analytic.account',type:'many2one',name:'analytic_account_id',},{relation:'account.analytic.tag',type:'many2many',name:'analytic_tag_ids',},{type:'boolean',name:'force_tax_included',},{type:'char',name:'name',},{type:'float',name:'amount',},{type:'char',name:'date',},{type:'boolean',name:'to_check',}],{account_id:{string:_t("Account"),},name:{string:_t("Label")},amount:{string:_t("Account")},}).then(function(recordID){self.handleCreateRecord=recordID;var record=self.model.get(self.handleCreateRecord);self.fields.account_id=new relational_fields.FieldMany2One(self,'account_id',record,{mode:'edit',attrs:{can_create:false}});self.fields.journal_id=new relational_fields.FieldMany2One(self,'journal_id',record,{mode:'edit'});self.fields.tax_ids=new relational_fields.FieldMany2ManyTags(self,'tax_ids',record,{mode:'edit',additionalContext:{append_type_to_tax_name:true}});self.fields.analytic_account_id=new relational_fields.FieldMany2One(self,'analytic_account_id',record,{mode:'edit'});self.fields.analytic_tag_ids=new relational_fields.FieldMany2ManyTags(self,'analytic_tag_ids',record,{mode:'edit'});self.fields.force_tax_included=new basic_fields.FieldBoolean(self,'force_tax_included',record,{mode:'edit'});self.fields.name=new basic_fields.FieldChar(self,'name',record,{mode:'edit'});self.fields.amount=new basic_fields.FieldFloat(self,'amount',record,{mode:'edit'});self.fields.date=new basic_fields.FieldDate(self,'date',record,{mode:'edit'});self.fields.to_check=new basic_fields.FieldBoolean(self,'to_check',record,{mode:'edit'});var $create=$(qweb.render("reconciliation.line.create",{'state':state,'group_tags':self.group_tags,'group_acc':self.group_acc}));self.fields.account_id.appendTo($create.find('.create_account_id .o_td_field')).then(addRequiredStyle.bind(self,self.fields.account_id));self.fields.journal_id.appendTo($create.find('.create_journal_id .o_td_field'));self.fields.tax_ids.appendTo($create.find('.create_tax_id .o_td_field'));self.fields.analytic_account_id.appendTo($create.find('.create_analytic_account_id .o_td_field'));self.fields.analytic_tag_ids.appendTo($create.find('.create_analytic_tag_ids .o_td_field'));self.fields.force_tax_included.appendTo($create.find('.create_force_tax_included .o_td_field'));self.fields.name.appendTo($create.find('.create_label .o_td_field')).then(addRequiredStyle.bind(self,self.fields.name));self.fields.amount.appendTo($create.find('.create_amount .o_td_field')).then(addRequiredStyle.bind(self,self.fields.amount));self.fields.date.appendTo($create.find('.create_date .o_td_field'));self.fields.to_check.appendTo($create.find('.create_to_check .o_td_field'));self.$('.create').append($create);function addRequiredStyle(widget){widget.$el.addClass('o_required_modifier');}});},_onStopPropagation:function(ev){ev.stopPropagation();},_onCreateReconcileModel:function(event){event.preventDefault();var self=this;var propositions_for_model=[];var base_lines_balance=0;for(var i=0;i<this._initialState.reconciliation_proposition.length;i++){var rec_proposition=this._initialState.reconciliation_proposition[i];if(Number.isInteger(rec_proposition.id)){base_lines_balance+=rec_proposition.amount;}
else if(!rec_proposition.tax_repartition_line_id&&rec_proposition.account_id){propositions_for_model.push({label:rec_proposition.name,amount:rec_proposition.amount,account_id:rec_proposition.account_id.id,tax_ids:rec_proposition.tax_ids&&rec_proposition.tax_ids.map(x=>x.id)||[],label:rec_proposition.name,})}}
var st_line_vals=this._initialState.st_line;var proposition_base_amount=st_line_vals.amount!=undefined?st_line_vals.amount:base_lines_balance;return this._rpc({model:'account.reconciliation.widget',method:'open_rec_model_creation_widget',args:[propositions_for_model,Math.abs(proposition_base_amount),this._initialState.to_check],}).then(function(rslt){self.do_action(rslt,{'on_close':function(){self.trigger_up('reload');}})})},_editAmount:function(event){event.stopPropagation();var $line=$(event.target);var moveLineId=$line.closest('.mv_line').data('line-id');this.trigger_up('partial_reconcile',{'data':{mvLineId:moveLineId,'amount':$line.val()}});},_onEditAmount:function(event){event.preventDefault();event.stopPropagation();if(!$(event.target).hasClass('edit_amount_input')){var $line=$(event.target);this.trigger_up('getPartialAmount',{'data':$line.closest('.mv_line').data('line-id')});}},_onEditReconcileModel:function(event){event.preventDefault();var self=this;this.do_action({type:'ir.actions.act_window',res_model:'account.reconcile.model',views:[[false,'list'],[false,'form']],view_mode:"list",target:'current'},{on_reverse_breadcrumb:function(){self.trigger_up('reload');},});},_onFieldChanged:function(event){event.stopPropagation();var fieldName=event.target.name;if(fieldName==='partner_id'){var partner_id=event.data.changes.partner_id;this.trigger_up('change_partner',{'data':partner_id});}else{if(event.data.changes.amount&&isNaN(event.data.changes.amount)){return;}
this.trigger_up('update_proposition',{'data':event.data.changes});}},_onTogglePanel:function(){if(this.$el[0].getAttribute('data-mode')=='inactive')
this.trigger_up('change_mode',{'data':'default'});},_onChangeTab:function(event){if(event.currentTarget.nodeName==='TFOOT'){this.trigger_up('change_mode',{'data':'next'});}else{var modes=this.model.modes;var selected_mode=modes.find(function(e){return event.target.getAttribute('href').includes(e)});if(selected_mode){this.trigger_up('change_mode',{'data':selected_mode});}}},_onFilterChange:function(event){this.trigger_up('change_filter',{'data':_.str.strip($(event.target).val())});},_onInputKeyup:function(event){var target_partner_id=$(event.target).parents('[name="partner_id"]');if(target_partner_id.length===1){return;}
if(event.keyCode===13){if($(event.target).hasClass('edit_amount_input')){$(event.target).blur();return;}
var created_lines=_.findWhere(this.model.lines,{mode:'create'});if(created_lines&&created_lines.balance.amount){this._onCreateProposition();}
return;}
if($(event.target).hasClass('edit_amount_input')){if(event.type==='keyup'){return;}
else{return this._editAmount(event);}}
var self=this;for(var fieldName in this.fields){var field=this.fields[fieldName];if(!field.$el.is(event.target)){continue;}
this._avoidFieldUpdate[field.name]=event.type!=='focusout';field.value=false;field._setValue($(event.target).val()).then(function(){self._avoidFieldUpdate[field.name]=false;});break;}},_onLoadMore:function(ev){ev.preventDefault();this.trigger_up('change_offset',{'data':1});},_onSelectMoveLine:function(event){var $el=$(event.target);$el.prop('disabled',true);this._destroyPopover($el);var moveLineId=$el.closest('.mv_line').data('line-id');this.trigger_up('add_proposition',{'data':moveLineId});},_onSelectProposition:function(event){var $el=$(event.target);this._destroyPopover($el);var moveLineId=$el.closest('.mv_line').data('line-id');this.trigger_up('remove_proposition',{'data':moveLineId});},_onQuickCreateProposition:function(event){document.activeElement&&document.activeElement.blur();this.trigger_up('quick_create_proposition',{'data':$(event.target).data('reconcile-model-id')});},_onCreateProposition:function(){document.activeElement&&document.activeElement.blur();var invalid=[];_.each(this.fields,function(field){if(!field.isValid()){invalid.push(field.string);}});if(invalid.length){this.do_warn(_t("Some fields are undefined"),invalid.join(', '));return;}
this.trigger_up('create_proposition');},_onValidate:function(){this.trigger_up('validate');}});var ManualRenderer=StatementRenderer.extend({template:"reconciliation.manual.statement",});var ManualLineRenderer=LineRenderer.extend({template:"reconciliation.manual.line",removeProposition:function(handle,id){if(!id){return Promise.resolve();}
return this._super(handle,id);},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){return self.model.makeRecord('account.move.line',[{relation:'account.account',type:'many2one',name:'account_id',value:[self._initialState.account_id.id,self._initialState.account_id.display_name],}]).then(function(recordID){self.fields.title_account_id=new relational_fields.FieldMany2One(self,'account_id',self.model.get(recordID),{mode:'readonly'});}).then(function(){return self.fields.title_account_id.appendTo(self.$('.accounting_view thead td:eq(0) span:first'));});});},update:function(state){this._super(state);var props=_.filter(state.reconciliation_proposition,{'display':true});if(!props.length){var $line=$(qweb.render("reconciliation.line.mv_line",{'line':{},'state':state}));this.$('.accounting_view tbody').append($line);}},_renderCreate:function(state){var self=this;var parentPromise=this._super(state).then(function(){self.$('.create .create_journal_id').show();self.$('.create .create_date').removeClass('d-none');self.$('.create .create_journal_id .o_input').addClass('o_required_modifier');});return parentPromise;},});return{StatementRenderer:StatementRenderer,ManualRenderer:ManualRenderer,LineRenderer:LineRenderer,ManualLineRenderer:ManualLineRenderer,};});;

/* /account_invoice_extract/static/src/bugfix/bugfix.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account_invoice_extract/static/src/bugfix/bugfix.js',function(require){'use strict';});;

/* /account_invoice_extract/static/src/js/invoice_extract_box.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account_invoice_extract.Box',function(require){"use strict";var Widget=require('web.Widget');var InvoiceExtractBox=Widget.extend({events:{'click':'_onClick'},template:'account_invoice_extract.Box',init:function(parent,data){this._super.apply(this,arguments);this._angle=data.box_angle;this._fieldName=data.feature;this._height=data.box_height;this._id=data.id;this._isOcrChosen=data.selected_status!==0;this._isSelected=data.user_selected;this._midX=data.box_midX;this._midY=data.box_midY;this._text=data.text;this._width=data.box_width;this._$boxLayer=data.$boxLayer;},start:function(){if(this._isSelected){this.trigger_up('select_invoice_extract_box',{box:this,});}
if(this._isOcrChosen){this.trigger_up('choice_ocr_invoice_extract_box',{box:this,});}
return this._super.apply(this,arguments);},destroy:function(){this.trigger_up('destroy_invoice_extract_box',{box:this,});this._super.apply(this,arguments);},getFieldName:function(){return this._fieldName;},getID:function(){return this._id;},getStyle:function(){return'left:'+(this._midX*parseInt(this._$boxLayer[0].style.width))+'px;'+'top:'+(this._midY*parseInt(this._$boxLayer[0].style.height))+'px;'+'width:'+((this._width)*parseInt(this._$boxLayer[0].style.width))+'px;'+'height:'+((this._height)*parseInt(this._$boxLayer[0].style.height))+'px;'+'transform: translate(-50%, -50%) rotate('+this._angle+'deg);'+'-ms-transform: translate(-50%, -50%) rotate('+this._angle+'deg);'+'-webkit-transform: translate(-50%, -50%) rotate('+this._angle+'deg);';},isOcrChosen:function(){return this._isOcrChosen;},isSelected:function(){return this._isSelected;},setSelected:function(){if(!this._isSelected){this._isSelected=true;this.$el.addClass('selected');}},unsetOcrChosen:function(){if(this._isOcrChosen){this._isOcrChosen=false;this.$el.removeClass('ocr_chosen');}},unsetSelected:function(){if(this._isSelected){this._isSelected=false;this.$el.removeClass('selected');}},_onClick:function(ev){ev.stopPropagation();this.trigger_up('click_invoice_extract_box',{box:this,});},});return InvoiceExtractBox;});;

/* /account_invoice_extract/static/src/js/invoice_extract_box_layer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account_invoice_extract.BoxLayer',function(require){"use strict";var InvoiceExtractBox=require('account_invoice_extract.Box');var Widget=require('web.Widget');var InvoiceExtractBoxLayer=Widget.extend({events:{'click':'_onClick',},className:'boxLayer',init:function(parent,data){var self=this;this._super.apply(this,arguments);this._boxes=[];this._boxesData=data.boxesData;this._mode=data.mode;this._pageNum=data.pageNum||0;this._$buttons=data.$buttons;this._$page=data.$page;this._$textLayer=data.$textLayer;this._boxesData=_.filter(this._boxesData,function(boxData){return boxData.page===self._pageNum;});},start:function(){var self=this;if(this._isOnPDF()){this.el.style.width=this._$textLayer[0].style.width;this.el.style.height=this._$textLayer[0].style.height;this._$page[0].style.height='calc(100% - '+this._$buttons.height()+'px)';}else if(this._isOnImg()){this.el.style.width=this._$page[0].clientWidth+'px';this.el.style.height=this._$page[0].clientHeight+'px';this.el.style.left=this._$page[0].offsetLeft+'px';this.el.style.top=this._$page[0].offsetTop+'px';}
this._boxes=[];_.forEach(this._boxesData,function(boxData){var box=new InvoiceExtractBox(self,_.extend({},boxData,{$boxLayer:self.$el,}));box.appendTo(self.$el).then(function(){box.do_hide();self._boxes.push(box);});});return this._super.apply(this,arguments);},displayBoxes:function(params){var selectedFieldName=params.fieldName;_.each(this._boxes,function(box){if(box.getFieldName()===selectedFieldName){box.do_show();}else{box.do_hide();}});},setTextLayer:function(params){var $textLayer=params.$textLayer;this._$textLayer=$textLayer;},_isOnImg:function(){return this._mode==='img';},_isOnPDF:function(){return this._mode==='pdf';},_onClick:function(ev){this.trigger_up('click_invoice_extract_box_layer');},});return InvoiceExtractBoxLayer;});;

/* /account_invoice_extract/static/src/js/invoice_extract_field.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account_invoice_extract.Field',function(require){"use strict";var InvoiceExtractFieldButton=require('account_invoice_extract.FieldButton');var Class=require('web.Class');var field_utils=require('web.field_utils');var Mixins=require('web.mixins');var InvoiceExtractField=Class.extend(Mixins.EventDispatcherMixin,{custom_events:{click_invoice_extract_field_button:'_onClickInvoiceExtractFieldButton'},init:function(parent,params){Mixins.EventDispatcherMixin.init.call(this,arguments);this.setParent(parent);this._button=undefined;this._isActive=false;this._name=params.fieldName;this._text=params.text;this._ocrChosenBox=undefined;this._selectedBox=undefined;},getSelectedBox:function(){return this._selectedBox;},getName:function(){return this._name;},handleFieldChanged:function(params){var fieldChangedInfo=params.fieldChangedInfo;var state=params.state;var changes={};switch(this._name){case'date':changes={invoice_date:field_utils.parse.date(fieldChangedInfo.split(' ')[0])};break;case'supplier':if(_.isNumber(fieldChangedInfo)){changes={partner_id:{id:fieldChangedInfo}};}
break;case'VAT_Number':changes={partner_id:{id:fieldChangedInfo}};break;case'due_date':changes={invoice_date_due:field_utils.parse.date(fieldChangedInfo.split(' ')[0])};break;case'invoice_id':changes={ref:fieldChangedInfo};break;case'currency':changes={currency_id:{id:fieldChangedInfo}};break;}
return changes;},isActive:function(){return this._isActive;},renderButton:function(params){this._button=new InvoiceExtractFieldButton(this,{fieldName:this._name,isActive:this._isActive,text:this._text,});return this._button.appendTo(params.$container);},setActive:function(){if(!this._isActive){this._isActive=true;if(this._button){this._button.setActive();}}},setInactive:function(){if(this._isActive){this._isActive=false;if(this._button){this._button.setInactive();}}},resetSelection:function(){this._ocrChosenBox=undefined;this._selectedBox=undefined;},setOcrChosenBox:function(box){this._ocrChosenBox=box;if(!this._selectedBox){this._selectedBox=this._ocrChosenBox;this._ocrChosenBox.setSelected();}},setSelectedBox:function(box){if(this._selectedBox){this._selectedBox.unsetSelected();}
this._selectedBox=box;if(this._ocrChosenBox&&this._selectedBox!==this._ocrChosenBox){this._ocrChosenBox.unsetSelected();}
this._selectedBox.setSelected();},unselectBox:function(){if(!this._selectedBox){return;}
if(this._ocrChosenBox&&this._ocrChosenBox.isSelected()){this._selectedBox=undefined;this._ocrChosenBox.unsetSelected();this._ocrChosenBox.unsetOcrChosen();this._ocrChosenBox=undefined;}else if(this._ocrChosenBox){this._selectedBox.unsetSelected();this._selectedBox=this._ocrChosenBox;this._ocrChosenBox.setSelected();}else{this._selectedBox.unsetSelected();this._selectedBox=undefined;}},unsetBox:function(box){if(this._ocrChosenBox===this._selectedBox&&this._ocrChosenBox===box){this._ocrChosenBox=this._selectedBox=undefined;}else if(this._ocrChosenBox===box){this._ocrChosenBox=undefined;}else{this._selectedBox=this._ocrSelectedBox;}},_onClickInvoiceExtractFieldButton:function(ev){ev.stopPropagation();this.trigger_up('active_invoice_extract_field',{fieldName:this._name,});},});return InvoiceExtractField;});;

/* /account_invoice_extract/static/src/js/invoice_extract_field_button.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account_invoice_extract.FieldButton',function(require){"use strict";var Widget=require('web.Widget');var InvoiceExtractFieldButton=Widget.extend({events:{'click':'_onClick',},template:'account_invoice_extract.Button',init:function(parent,params){this._super.apply(this,arguments);this._fieldName=params.fieldName;this._isActive=params.isActive||false;this._text=params.text;},getFieldName:function(){return this._fieldName;},getText:function(){return this._text;},isActive:function(){return this._isActive;},setActive:function(){this._isActive=true;if(this.$el){this.$el.addClass('active');}},setInactive:function(){this._isActive=false;if(this.$el){this.$el.removeClass('active');}},_onClick:function(ev){ev.stopPropagation();this.trigger_up('click_invoice_extract_field_button');},});return InvoiceExtractFieldButton;});;

/* /account_invoice_extract/static/src/js/invoice_extract_fields.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account_invoice_extract.Fields',function(require){"use strict";var InvoiceExtractField=require('account_invoice_extract.Field');var Class=require('web.Class');var Mixins=require('web.mixins');var ServicesMixin=require('web.ServicesMixin');var session=require('web.session');var InvoiceExtractFields=Class.extend(Mixins.EventDispatcherMixin,ServicesMixin,{custom_events:{active_invoice_extract_field:'_onActiveInvoiceExtractField',},init:function(parent,is_customer_invoice=false){var self=this;Mixins.EventDispatcherMixin.init.call(this,arguments);this.setParent(parent);var vendor_text='Vendor';if(is_customer_invoice){vendor_text='Customer';}
this._fields=[new InvoiceExtractField(this,{text:'VAT',fieldName:'VAT_Number'}),new InvoiceExtractField(this,{text:vendor_text,fieldName:'supplier'}),new InvoiceExtractField(this,{text:'Date',fieldName:'date'}),new InvoiceExtractField(this,{text:'Due Date',fieldName:'due_date'}),new InvoiceExtractField(this,{text:'Vendor Reference',fieldName:'invoice_id'}),];this._fields[0].setActive();session.user_has_group('base.group_multi_currency').then(function(has_multi_currency){if(has_multi_currency){self._fields.push(new InvoiceExtractField(self,{text:'Currency',fieldName:'currency'}));}});},getActiveField:function(){return _.find(this._fields,function(field){return field.isActive();});},getField:function(params){params=params||{};if(!params.name){return this.getActiveField();}
return _.find(this._fields,function(field){return field.getName()===params.name;});},renderButtons:function(params){var proms=[];_.each(this._fields,function(field){proms.push(field.renderButton(params));});return Promise.all(proms);},resetActive:function(){var oldActiveField=this.getActiveField();if(!oldActiveField){return;}
oldActiveField.setInactive();this._fields[0].setActive();},resetFieldsSelections:function(){_.each(this._fields,function(field){field.resetSelection();});},_onActiveInvoiceExtractField:function(ev){var oldActiveField=this.getActiveField();if(!oldActiveField){return;}
oldActiveField.setInactive();var field=this.getField({name:ev.data.fieldName});if(!field){return;}
field.setActive();},});return InvoiceExtractFields;});;

/* /account_invoice_extract/static/src/js/invoice_extract_form_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account_invoice_extract.FormRenderer',function(require){"use strict";var InvoiceExtractBoxLayer=require('account_invoice_extract.BoxLayer');var InvoiceExtractFields=require('account_invoice_extract.Fields');var FormRenderer=require('web.FormRenderer');var InvoiceExtractFormRenderer=FormRenderer.extend({custom_events:_.extend({},FormRenderer.prototype.custom_events,{active_invoice_extract_field:'_onActiveInvoiceExtractField',preview_attachment_validation:'_onAttachmentPreviewValidation',choice_ocr_invoice_extract_box:'_onChoiceOcrInvoiceExtractBox',click_invoice_extract_box:'_onClickInvoiceExtractBox',click_invoice_extract_box_layer:'_onClickInvoiceExtractBoxLayer',destroy_invoice_extract_box:'_onDestroyInvoiceExtractBox',select_invoice_extract_box:'_onSelectInvoiceExtractBox',}),init:function(){this._super.apply(this,arguments);this._res_id=-1;this._invoiceExtractBoxData=[];this._invoiceExtractBoxLayers=[];var is_customer_invoice=false;if(this.state.context.default_move_type=='out_invoice'||this.state.context.default_move_type=='out_refund')
is_customer_invoice=true;this._invoiceExtractFields=new InvoiceExtractFields(this,is_customer_invoice);this._$invoiceExtractButtons=[];},_destroyInvoiceExtract:function(){_.invoke(this._invoiceExtractBoxLayers,'destroy');this._res_id=-1;this._invoiceExtractBoxData=[];this._invoiceExtractBoxLayers=[];this._invoiceExtractFields.resetActive();if(this._$invoiceExtractButtons.length){this._$invoiceExtractButtons.remove();}
this._$invoiceExtractButtons=[];},_displayInvoiceExtractBoxes:function(){var field=this._invoiceExtractFields.getActiveField();if(!field){return;}
_.each(this._invoiceExtractBoxLayers,function(boxLayer){boxLayer.displayBoxes({fieldName:field.getName()});});},_handleInvoiceExtractFieldChanged:function(params){var fieldChangedInfo=params.fieldChangedInfo;var field=this._invoiceExtractFields.getActiveField();if(!field){return;}
var changes=field.handleFieldChanged({fieldChangedInfo:fieldChangedInfo,state:this.state,});if(!_.isEmpty(changes)){this.trigger_up('field_changed',{dataPointID:this.state.id,changes:changes,});}},_initInvoiceExtract:function($page){var self=this;this._res_id=this.state.res_id;this._rpc({model:'account.move',method:'get_boxes',args:[this.state.res_id],}).then(function(boxesData){self._invoiceExtractBoxData=boxesData;self._renderInvoiceExtractBoxLayers({$page:$page,}).then(function(){self._displayInvoiceExtractBoxes();});});},_renderInvoiceExtractButtons:function(){return this._invoiceExtractFields.renderButtons({$container:this._$invoiceExtractButtons,});},_renderInvoiceExtractBoxLayers:function(params){var $page=params.$page;var boxLayer;var proms=[];if($page.hasClass('img-fluid')){if(this._invoiceExtractBoxLayers.length>0){for(const oldBoxLayer of this._invoiceExtractBoxLayers){oldBoxLayer.destroy();}}
boxLayer=new InvoiceExtractBoxLayer(this,{boxesData:this._invoiceExtractBoxData,mode:'img',$page:$page,});proms.push(boxLayer.insertAfter($page));this._invoiceExtractBoxLayers=[boxLayer];}
if($page.is('iframe')){var $document=$page.contents();$document.find('head').append('<link rel="stylesheet" type="text/css" href="/account_invoice_extract/static/src/css/account_invoice_extract_box_layer.css"></link>');var $textLayers=$document.find('.textLayer');for(var index=0;index<$textLayers.length;index++){var $textLayer=$textLayers.eq(index);var pageNum=$textLayer[0].parentElement.dataset['pageNumber']-1;var existingBoxLayer=this._invoiceExtractBoxLayers.find(function(bl){return bl._pageNum==pageNum;});if(existingBoxLayer){existingBoxLayer.setTextLayer({$textLayer:$textLayer,});proms.push(existingBoxLayer.insertAfter($textLayer));}
else{boxLayer=new InvoiceExtractBoxLayer(this,{boxesData:this._invoiceExtractBoxData,mode:'pdf',pageNum:pageNum,$buttons:this._$invoiceExtractButtons,$page:$page,$textLayer:$textLayer,});proms.push(boxLayer.insertAfter($textLayer));this._invoiceExtractBoxLayers.push(boxLayer);}}}
return Promise.all(proms);},_startInvoiceExtract:function($attachment){var $ocrSuccess=this.$('.o_success_ocr');if($attachment.length!==0&&$ocrSuccess.length>0&&!$ocrSuccess.hasClass('o_invisible_modifier')&&this.mode==='edit'){if(this._res_id!=this.state.res_id){this._destroyInvoiceExtract();this._initInvoiceExtract($attachment);}
else if(this._invoiceExtractBoxData.length>0){var self=this;this._renderInvoiceExtractBoxLayers({$page:$attachment,}).then(function(){self._displayInvoiceExtractBoxes();});}
if(this._$invoiceExtractButtons.length==0){this._$invoiceExtractButtons=$('<div class="o_invoice_extract_buttons"/>');$attachment.before(this._$invoiceExtractButtons);this._renderInvoiceExtractButtons();}}else{this._destroyInvoiceExtract();}},_onActiveInvoiceExtractField:function(ev){ev.stopPropagation();this._displayInvoiceExtractBoxes();},_onAttachmentPreviewValidation:function(ev){ev.stopPropagation();var self=this;if(this.$attachmentPreview===undefined){return;}
this.$attachmentPreview.find('iframe').on("load",function(){var $iframe=self.$attachmentPreview.find('iframe');var $iframeDoc=self.$attachmentPreview.find('iframe').contents();$iframeDoc[0].addEventListener('pagerendered',function(){self._startInvoiceExtract($iframe);});});var $documentImg=self.$attachmentPreview.find('.img-fluid');var $attachment=$('#attachment_img');if($attachment.length&&$attachment[0].complete){this._startInvoiceExtract($documentImg);}else{this.$attachmentPreview.find('.img-fluid').on("load",function(){self._startInvoiceExtract($documentImg);});}},_onClickInvoiceExtractBox:function(ev){ev.stopPropagation();var self=this;var box=ev.data.box;var field=this._invoiceExtractFields.getActiveField();if(!field){return;}
this._rpc({model:'account.move',method:'set_user_selected_box',args:[[this.state.res_id],box.getID()],}).then(function(fieldChangedInfo){field.setSelectedBox(box);self._handleInvoiceExtractFieldChanged({fieldChangedInfo:fieldChangedInfo,});});},_onClickInvoiceExtractBoxLayer:function(ev){ev.stopPropagation();var self=this;var field=this._invoiceExtractFields.getActiveField();if(!field){return;}
var box=field.getSelectedBox();if(!box){return;}
field.unselectBox();this._rpc({model:'account.move',method:'remove_user_selected_box',args:[[this.state.res_id],box.getID()],}).then(function(fieldChangedInfo){self._handleInvoiceExtractFieldChanged({fieldChangedInfo:fieldChangedInfo,});});},_onChoiceOcrInvoiceExtractBox:function(ev){ev.stopPropagation();var box=ev.data.box;var field=this._invoiceExtractFields.getField({name:box.getFieldName(),});if(!field){return;}
field.setOcrChosenBox(box);},_onDestroyInvoiceExtractBox:function(ev){ev.stopPropagation();var box=ev.data.box;if(!box.isOcrChosen()&&!box.isSelected()){return;}
var field=this._invoiceExtractFields.getField({name:box.getFieldName(),});if(!field){return;}
field.unsetBox(box);},_onSelectInvoiceExtractBox:function(ev){ev.stopPropagation();var box=ev.data.box;var field=this._invoiceExtractFields.getField({name:box.getFieldName(),});if(!field){return;}
field.setSelectedBox(box);},});return InvoiceExtractFormRenderer;});;

/* /account_invoice_extract/static/src/js/invoice_extract_form_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account_invoice_extract.FormView',function(require){"use strict";var InvoiceExtractFormRenderer=require('account_invoice_extract.FormRenderer');var FormView=require('web.FormView');var view_registry=require('web.view_registry');var InvoiceExtractFormView=FormView.extend({config:_.extend({},FormView.prototype.config,{Renderer:InvoiceExtractFormRenderer,}),});view_registry.add('account_invoice_extract_preview',InvoiceExtractFormView);return InvoiceExtractFormView;});;

/* /account_online_sync/static/src/js/online_sync.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account_online_sync.acc_config_widget',function(require){"use strict";var core=require('web.core');var framework=require('web.framework');var AbstractAction=require('web.AbstractAction');var QWeb=core.qweb;var OnlineSyncAccountInstitutionSelector=AbstractAction.extend({template:'OnlineSyncSearchBank',init:function(parent,context){this._super(parent,context);this.search_allowed=true;this.starred_inst=context.params.starred_inst;this.sync_error_message=context.params.sync_error_message;this.results=this.starred_inst;if(context.context!==undefined){this.context=context.context;this.country=context.context.country;}
this.state=(this.sync_error_message!=='')?'error':'dashboard';},start:function(){this.displayState();},displayState:function(){var self=this;if(this.state==='error'){self.$('.sync_error').removeClass('d-none');self.renderSyncError();}
else if(this.state==='search'||(this.state==='dashboard'&&this.results.length>0)){self.$('.institutions_search').removeClass('d-none');self.$('.favorite_institutions_no_result').addClass('d-none');if(self.results.length>0){self.$('.institution_no_result').addClass('d-none');self.$('.institution_result').removeClass('d-none');self.renderSearchResult();}
else{self.$('.institution_no_result').removeClass('d-none');self.$('.institution_result').addClass('d-none');}}
else{self.$('.favorite_institutions_no_result').removeClass('d-none');self.$('.institutions_search').addClass('d-none');}},openInstitution:function($node){var self=this;if(self.willDisappear===true){return true;}
self.willDisappear=true;var provider=$node.data('provider');var instId=$node.data('instId');var beta=$node.data('beta')||false;self._rpc({model:'account.online.provider',method:'get_login_form',args:[[],instId,provider,beta],context:self.context,}).then(function(result){self.do_action(result);}).guardedCatch(function(){self.willDisappear=false;});},renderButtons:function($node){var self=this;this.$buttons=$(QWeb.render("OnlineSyncSearchBankFooter",{'widget':this}));this.$buttons.find('.js_cancel').click(function(e){self.do_action({type:'ir.actions.act_window_close'});});this.$buttons.find('.js_select_institution').click(function(e){if(self.selected){self.openInstitution(self.$('.js_institution[data-inst-id='+self.selected+']'));}});this.$buttons.find('.js_configure_manually').click(function(){return self.configure_manually()});this.$('.institution_no_result').find('.js_configure_manually').click(function(){return self.configure_manually()});if($node){this.$buttons.appendTo($node);}},configure_manually:function(){var self=this;return self._rpc({model:'account.online.provider',method:'get_manual_configuration_form',context:self.context,}).then(function(action){self.do_action(action,{on_close:function(){core.bus.trigger("refresh_account_dashboard");},});});},renderElement:function(){var self=this;this._super();this.$('#search_form').submit(function(event){event.preventDefault();event.stopPropagation();self.searchInstitution();});this.$('#click_search_institution').click(function(){self.searchInstitution();});this.$('#search_institution').blur(function(){if(self.state!=='dashboard'&&self.$('#search_institution').val()===''){self.state='dashboard';self.displayState();}});this.$('.o_institution').click(function(e){self.openInstitution($(this));});this.$('.switch_country').click(function(e){if($(e.target).attr('value')!==self.country){self.switchCountry();}});},renderSyncError:function(){var self=this
self.$('.sync_error').html('');var $errorMessage=$(QWeb.render('OnlineSyncErrorMessage',{sync_error_message:self.sync_error_message}));$errorMessage.find('.js_configure_manually').click(function(){return self.configure_manually()});$errorMessage.appendTo(self.$('.sync_error'));},renderSearchResult:function(){var self=this;self.$('.institution_result').html('');var $searchResults=$(QWeb.render('OnlineSyncSearchBankTable',{institutions:self.results}));$searchResults.find('.js_institution').click(function(e){var instId=$(e.target).data('instId')||$(e.target).parents('.js_institution').data('instId');if(self.selected===instId){self.selected=false;self.$('.js_institution[data-inst-id='+instId+']').removeClass('selected');self.$buttons.find('.js_select_institution').prop('disabled',true);self.$buttons.find('.js_select_institution').toggleClass('btn-primary btn-secondary');}
else{self.selected=instId;self.$buttons.find('.js_select_institution').prop('disabled',false);self.$('.js_institution').removeClass('selected');self.$('.js_institution[data-inst-id='+instId+']').addClass('selected');self.$buttons.find('.js_select_institution').removeClass('btn-secondary');self.$buttons.find('.js_select_institution').addClass('btn-primary');}
self.$('.js_institution_detail:not(.d-none):not(#'+instId+')').addClass('d-none');self.$('#'+instId+'').toggleClass('d-none');});$searchResults.appendTo(self.$('.institution_result'));},searchInstitution:function(){var self=this;if(self.$('#search_institution').val()===''){self.state='dashboard';self.displayState();return true;}
if(self.search_allowed===true){self.search_allowed=false;self.selected=false;self.state='search';self.$buttons.find('.js_select_institution').prop('disabled',true);framework.blockUI();return this._rpc({model:'account.online.provider',method:'get_institutions',args:[[],self.$('#search_institution').val(),self.country==='worldwide'?false:self.country],}).then(function(result){framework.unblockUI();var results=JSON.parse(result);self.results=results.match||[];self.displayState();self.search_allowed=true;}).guardedCatch(function(){framework.unblockUI();self.search_allowed=true;self.$buttons.find('.js_select_institution').prop('disabled',false);});}},switchCountry:function(){if(this.country==='worldwide'){this.country=this.context.country;}
else{this.country='worldwide';}
this.displayState();if(this.$('#search_institution').val().length>0){this.searchInstitution();}},});core.action_registry.add('online_sync_institution_selector',OnlineSyncAccountInstitutionSelector);return{OnlineSyncAccountInstitutionSelector:OnlineSyncAccountInstitutionSelector,}});;

/* /crm_enterprise/static/src/js/systray_activity_menu.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('crm_enterprise.systray.ActivityMenu',function(require){"use strict";var ActivityMenu=require('mail.systray.ActivityMenu');require('crm.systray.ActivityMenu');ActivityMenu.include({_getViewsList(model){if(model==="crm.lead"){return[[false,'list'],[false,'kanban'],[false,'form'],[false,'calendar'],[false,'pivot'],[false,'graph'],[false,'cohort'],[false,'dashboard'],[false,'map'],[false,'activity']];}
return this._super(...arguments);},});});;

/* /documents_spreadsheet/static/src/js/o-spreadsheet/o_spreadsheet.js defined in bundle 'point_of_sale.pos_assets_backend' */
(function(exports,owl){'use strict';function _interopNamespace(e){if(e&&e.__esModule){return e;}else{var n=Object.create(null);if(e){Object.keys(e).forEach(function(k){if(k!=='default'){var d=Object.getOwnPropertyDescriptor(e,k);Object.defineProperty(n,k,d.get?d:{enumerable:true,get:function(){return e[k];}});}});}
n['default']=e;return Object.freeze(n);}}
var owl__namespace=_interopNamespace(owl);let _t=(s)=>s;function setTranslationMethod(tfn){_t=tfn;}
const _lt=function(s){return{toString:function(){return _t(s);},};};function numberToLetters(n){if(n<26){return String.fromCharCode(65+n);}
else{return numberToLetters(Math.floor(n/26)-1)+numberToLetters(n%26);}}
function lettersToNumber(letters){let result=0;const l=letters.length;for(let i=0;i<l;i++){let n=letters.charCodeAt(i)-65+(i<l-1?1:0);result+=n*26**(l-i-1);}
return result;}
function toCartesian(xc){xc=xc.toUpperCase();const[m,letters,numbers]=xc.match(/\$?([A-Z]*)\$?([0-9]*)/);if(m!==xc){throw new Error(_lt(`Invalid cell description: ${xc}`));}
const col=lettersToNumber(letters);const row=parseInt(numbers,10)-1;return[col,row];}
function toXC(col,row){return numberToLetters(col)+String(row+1);}
function stringify(obj){return JSON.stringify(obj,Object.keys(obj).sort());}
function getUnquotedSheetName(sheetName){if(sheetName.startsWith("'")){sheetName=sheetName.slice(1,-1).replace(/''/g,"'");}
return sheetName;}
function getComposerSheetName(sheetName){if(sheetName.includes(" ")){sheetName=`'${sheetName}'`;}
return sheetName;}
function clip(val,min,max){return val<min?min:val>max?max:val;}
const DEBUG={};function toZone(xc){xc=xc.split("!").pop();const ranges=xc.replace("$","").split(":");let top,bottom,left,right;let c=toCartesian(ranges[0].trim());left=right=c[0];top=bottom=c[1];if(ranges.length===2){let d=toCartesian(ranges[1].trim());right=d[0];bottom=d[1];if(right<left){[right,left]=[left,right];}
if(bottom<top){[bottom,top]=[top,bottom];}}
return{top,bottom,left,right};}
function zoneToXc(zone){const{top,bottom,left,right}=zone;const isOneCell=top===bottom&&left===right;return isOneCell?toXC(left,top):`${toXC(left, top)}:${toXC(right, bottom)}`;}
function union(z1,z2){return{top:Math.min(z1.top,z2.top),left:Math.min(z1.left,z2.left),bottom:Math.max(z1.bottom,z2.bottom),right:Math.max(z1.right,z2.right),};}
function isEqual(z1,z2){return(z1.left===z2.left&&z1.right===z2.right&&z1.top===z2.top&&z1.bottom===z2.bottom);}
function overlap(z1,z2){if(z1.bottom<z2.top||z2.bottom<z1.top){return false;}
if(z1.right<z2.left||z2.right<z1.left){return false;}
return true;}
function isInside(col,row,zone){const{left,right,top,bottom}=zone;return col>=left&&col<=right&&row>=top&&row<=bottom;}
function recomputeZones(zones,toRemoveZones){const zonesPerColumn={};for(let z of zones){const zone=toZone(z);for(let col=zone.left;col<=zone.right;col++){if(zonesPerColumn[col]===undefined){zonesPerColumn[col]=[];}
zonesPerColumn[col].push({top:zone.top,bottom:zone.bottom,remove:false,});}}
for(let z of toRemoveZones){const zone=toZone(z);for(let col=zone.left;col<=zone.right;col++){if(zonesPerColumn[col]===undefined){zonesPerColumn[col]=[];}
zonesPerColumn[col].push({top:zone.top,bottom:zone.bottom,remove:true,});}}
const OptimizedZonePerColumn=[];for(let[col,zones]of Object.entries(zonesPerColumn)){OptimizedZonePerColumn.push({col:parseInt(col),ranges:optimiseColumn(zones),});}
const result=mergeColumns(OptimizedZonePerColumn);return result.map(zoneToXc);}
function optimiseColumn(zones){const toKeep=new Set();const toRemove=new Set();for(let zone of zones){for(let x=zone.top;x<=zone.bottom;x++){zone.remove?toRemove.add(x):toKeep.add(x);}}
const finalElements=[...toKeep].filter((x)=>!toRemove.has(x)).sort((a,b)=>{return a-b;});const newZones=[];let currentZone;for(let x of finalElements){if(!currentZone){currentZone={top:x,bottom:x};}
else if(x===currentZone.bottom+1){currentZone.bottom=x;}
else{newZones.push({top:currentZone.top,bottom:currentZone.bottom});currentZone={top:x,bottom:x};}}
if(currentZone){newZones.push({top:currentZone.top,bottom:currentZone.bottom});}
return newZones;}
function mergeColumns(zonePerCol){const orderedZones=zonePerCol.sort((a,b)=>{return a.col-b.col;});const finalZones=[];let inProgressZones=[];let currentCol=0;for(let index=0;index<=orderedZones.length-1;index++){let newInProgress=[];if(currentCol+1===orderedZones[index].col){for(let z1 of orderedZones[index].ranges){let merged=false;for(let z2 of inProgressZones){if(z1.top==z2.top&&z1.bottom==z2.bottom){newInProgress.push(z2);merged=true;}}
if(!merged){newInProgress.push({top:z1.top,bottom:z1.bottom,startCol:orderedZones[index].col});}}}
else{newInProgress=orderedZones[index].ranges.map((zone)=>{return{top:zone.top,bottom:zone.bottom,startCol:orderedZones[index].col,};});}
const difference=inProgressZones.filter((x)=>!newInProgress.includes(x));for(let x of difference){finalZones.push({top:x.top,bottom:x.bottom,left:x.startCol,right:currentCol});}
currentCol=orderedZones[index].col;inProgressZones=newInProgress;}
for(let x of inProgressZones){finalZones.push({top:x.top,bottom:x.bottom,left:x.startCol,right:currentCol});}
return finalZones;}
function mapCellsInZone(zone,sheet,callback,emptyCellValue=undefined){const{top,bottom,left,right}=zone;const result=new Array(right-left+1);for(let c=left;c<=right;c++){let col=new Array(bottom-top+1);result[c-left]=col;for(let r=top;r<=bottom;r++){let cell=sheet.rows[r].cells[c];col[r-top]=cell?callback(cell):emptyCellValue;}}
return result;}
const colors=["#ff851b","#0074d9","#ffdc00","#7fdbff","#b10dc9","#0ecc40","#39cccc","#f012be","#3d9970","#111111","#01ff70","#ff4136","#aaaaaa","#85144b","#001f3f",];function colorNumberString(color){return color.toString(16).padStart(6,"0");}
let colorIndex=0;function getNextColor(){colorIndex=++colorIndex%colors.length;return colors[colorIndex];}
const formulaNumberRegexp=/^-?\d+(\.?\d*(e\d+)?)?(\s*%)?|^-?\.\d+(\s*%)?/;const numberRegexp=/^-?\d+(,\d+)*(\.?\d*(e\d+)?)?(\s*%)?$|^-?\.\d+(\s*%)?$/;function isNumber(value){return numberRegexp.test(value.trim());}
const commaRegexp=/,/g;function parseNumber(str){let n=Number(str.replace(commaRegexp,""));if(isNaN(n)&&str.includes("%")){n=Number(str.split("%")[0]);if(!isNaN(n)){return n/100;}}
return n;}
const decimalStandardRepresentation=new Intl.NumberFormat("en-US",{useGrouping:false,maximumFractionDigits:10,});function formatStandardNumber(n){if(Number.isInteger(n)){return n.toString();}
return decimalStandardRepresentation.format(n);}
let decimalRepresentations=[];const maximumDecimalPlaces=20;function formatDecimal(n,decimals,sep=""){if(n<0){return"-"+formatDecimal(-n,decimals);}
const maxDecimals=decimals>=maximumDecimalPlaces?maximumDecimalPlaces:decimals;let formatter=decimalRepresentations[maxDecimals];if(!formatter){formatter=new Intl.NumberFormat("en-US",{minimumFractionDigits:maxDecimals,maximumFractionDigits:maxDecimals,useGrouping:false,});decimalRepresentations[maxDecimals]=formatter;}
let result=formatter.format(n);if(sep){let p=result.indexOf(".");result=result.replace(/\d(?=(?:\d{3})+(?:\.|$))/g,(m,i)=>p<0||i<p?`${m}${sep}`:m);}
return result;}
function formatNumber(value,format){const parts=format.split(";");const l=parts.length;if(value<0){if(l>1){return _formatValue(-value,parts[1]);}
else{return"-"+_formatValue(-value,parts[0]);}}
const index=l===3&&value===0?2:0;return _formatValue(value,parts[index]);}
function _formatValue(value,format){const parts=format.split(".");const decimals=parts.length===1?0:parts[1].match(/0/g).length;const separator=parts[0].includes(",")?",":"";const isPercent=format.includes("%");if(isPercent){value=value*100;}
const rawNumber=formatDecimal(value,decimals,separator);if(isPercent){return rawNumber+"%";}
return rawNumber;}
function updateRemoveColumns(range,columns){let{left,right,top,bottom}=toZone(range);columns=columns.slice().sort((a,b)=>b-a);for(let column of columns){if(left>column){left-=1;}
if(left>=column||right>=column){right-=1;}}
if(left>right){return null;}
return toXC(left,top)+":"+toXC(right,bottom);}
function updateRemoveRows(range,rows){let{left,right,top,bottom}=toZone(range);rows=rows.slice().sort((a,b)=>b-a);for(let row of rows){if(top>row){top-=1;}
if(top>=row||bottom>=row){bottom-=1;}}
if(top>bottom){return null;}
return toXC(left,top)+":"+toXC(right,bottom);}
function updateAddColumns(range,column,step){let{left,right,top,bottom}=toZone(range);if(left>=column){left+=step;}
if(left>=column||right>=column){right+=step;}
if(left>right){return null;}
return toXC(left,top)+":"+toXC(right,bottom);}
function updateAddRows(range,row,step){let{left,right,top,bottom}=toZone(range);if(top>=row){top+=step;}
if(top>=row||bottom>=row){bottom+=step;}
if(top>bottom){return null;}
return toXC(left,top)+":"+toXC(right,bottom);}
function uuidv4(){if(window.crypto&&window.crypto.getRandomValues){return([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(c)=>(c^(crypto.getRandomValues(new Uint8Array(1))[0]&(15>>(c/4)))).toString(16));}
else{return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=(Math.random()*16)|0,v=c=="x"?r:(r&0x3)|0x8;return v.toString(16);});}}
const expectNumberValueError=(value)=>_lt(`The function [[FUNCTION_NAME]] expects a number value, but '${value}' is a string, and cannot be coerced to a number.`);function toNumber(value){switch(typeof value){case"number":return value;case"boolean":return value?1:0;case"string":if(isNumber(value)||value===""){return parseNumber(value);}
throw new Error(expectNumberValueError(value));default:return value||0;}}
function strictToNumber(value){if(value===""){throw new Error(expectNumberValueError(value));}
return toNumber(value);}
function visitNumbers(args,cb){for(let n of args){if(Array.isArray(n)){for(let i of n){for(let j of i){if(typeof j==="number"){cb(j);}}}}
else{cb(strictToNumber(n));}}}
function visitNumbersTextAs0(args,cb){for(let n of args){if(Array.isArray(n)){for(let i of n){for(let j of i){if(j!==undefined&&j!==null){if(typeof j==="number"){cb(j);}
else if(typeof j==="boolean"){cb(toNumber(j));}
else{cb(0);}}}}}
else{cb(toNumber(n));}}}
function visitAny(arg,cb){if(Array.isArray(arg)){for(let col of arg){for(let cell of col){cb(cell);}}}
else{cb(arg);}}
function visitAnys(args,rangeCb,argCb){for(let arg of args){if(Array.isArray(arg)){for(let col of arg){for(let cell of col){if(!rangeCb(cell))
return;}}}
else{if(!argCb(arg))
return;}}}
function reduceArgs(args,cb,initialValue){let val=initialValue;for(let arg of args){visitAny(arg,(a)=>{val=cb(val,a);});}
return val;}
function reduceNumbers(args,cb,initialValue){let val=initialValue;visitNumbers(args,(a)=>{val=cb(val,a);});return val;}
function reduceNumbersTextAs0(args,cb,initialValue){let val=initialValue;visitNumbersTextAs0(args,(a)=>{val=cb(val,a);});return val;}
function toString(value){switch(typeof value){case"string":return value;case"number":return value.toString();case"boolean":return value?"TRUE":"FALSE";default:return"";}}
const expectBooleanValueError=(value)=>_lt(`The function [[FUNCTION_NAME]] expects a boolean value, but '${value}' is a text, and cannot be coerced to a number.`);function toBoolean(value){switch(typeof value){case"boolean":return value;case"string":if(value){let uppercaseVal=value.toUpperCase();if(uppercaseVal==="TRUE"){return true;}
if(uppercaseVal==="FALSE"){return false;}
throw new Error(expectBooleanValueError(value));}
else{return false;}
case"number":return value?true:false;default:return false;}}
function strictToBoolean(value){if(value===""){throw new Error(expectBooleanValueError(value));}
return toBoolean(value);}
function visitBooleans(args,cb){visitAnys(args,(cell)=>{if(typeof cell==="boolean"){return cb(cell);}
if(typeof cell==="number"){return cb(cell?true:false);}
return true;},(arg)=>(arg!==null?cb(strictToBoolean(arg)):true));}
function getPredicate(descr,isQuery){let operator;let operand;let subString=descr.substring(0,2);if(subString==="<="||subString===">="||subString==="<>"){operator=subString;operand=descr.substring(2);}
else{subString=descr.substring(0,1);if(subString==="<"||subString===">"||subString==="="){operator=subString;operand=descr.substring(1);}
else{operator="=";operand=descr;}}
if(isNumber(operand)){operand=toNumber(operand);}
else if(operand==="TRUE"||operand==="FALSE"){operand=toBoolean(operand);}
const result={operator,operand};if(typeof operand==="string"){if(isQuery){operand+="*";}
result.regexp=operandToRegExp(operand);}
return result;}
function operandToRegExp(operand){let exp="";let predecessor="";for(let char of operand){if(char==="?"&&predecessor!=="~"){exp+=".";}
else if(char==="*"&&predecessor!=="~"){exp+=".*";}
else{if(char==="*"||char==="?"){exp=exp.slice(0,-1);}
if(["^",".","[","]","$","(",")","*","+","?","|","{","}","\\"].includes(char)){exp+="\\";}
exp+=char;}
predecessor=char;}
return new RegExp("^"+exp+"$","i");}
function evaluatePredicate(value,criterion){const{operator,operand}=criterion;if(typeof operand==="number"&&operator==="="){return toString(value)===toString(operand);}
if(operator==="<>"||operator==="="){let result;if(typeof value===typeof operand){if(criterion.regexp){result=criterion.regexp.test(value);}
else{result=value===operand;}}
else{result=false;}
return operator==="="?result:!result;}
if(typeof value===typeof operand){switch(operator){case"<":return value<operand;case">":return value>operand;case"<=":return value<=operand;case">=":return value>=operand;}}
return false;}
function visitMatchingRanges(args,cb,isQuery=false){const countArg=args.length;if(countArg%2===1){throw new Error(_lt(`Function [[FUNCTION_NAME]] expects criteria_range and criterion to be in pairs.`));}
const dimRow=args[0].length;const dimCol=args[0][0].length;let predicates=[];for(let i=0;i<countArg-1;i+=2){const criteriaRange=args[i];if(criteriaRange.length!==dimRow||criteriaRange[0].length!==dimCol){throw new Error(_lt(`Function [[FUNCTION_NAME]] expects criteria_range to have the same dimension`));}
const description=toString(args[i+1]);predicates.push(getPredicate(description,isQuery));}
for(let i=0;i<dimRow;i++){for(let j=0;j<dimCol;j++){let validatedPredicates=true;for(let k=0;k<countArg-1;k+=2){const criteriaValue=args[k][i][j];const criterion=predicates[k/2];validatedPredicates=evaluatePredicate(criteriaValue,criterion);if(!validatedPredicates){break;}}
if(validatedPredicates){cb(i,j);}}}}
function dichotomicPredecessorSearch(range,target){const typeofTarget=typeof target;let min=0;let max=range.length-1;let avg=Math.ceil((min+max)/2);let current=range[avg];while(max-min>0){if(typeofTarget===typeof current&&current<=target){min=avg;}
else{max=avg-1;}
avg=Math.ceil((min+max)/2);current=range[avg];}
if(target<current){return-1;}
return avg;}
function dichotomicSuccessorSearch(range,target){const typeofTarget=typeof target;let min=0;let max=range.length-1;let avg=Math.floor((min+max)/2);let current=range[avg];while(max-min>0){if(typeofTarget===typeof current&&target>=current){max=avg;}
else{min=avg+1;}
avg=Math.floor((min+max)/2);current=range[avg];}
if(target>current){return avg-1;}
return avg;}
class Registry{constructor(){this.content={};}
add(key,value){this.content[key]=value;return this;}
get(key){if(!(key in this.content)){throw new Error(_lt(`Cannot find ${key} in this registry!`));}
return this.content[key];}
getAll(){return Object.values(this.content);}
remove(key){delete this.content[key];}}
const ARG_REGEXP=/(.*?)\((.*?)\)(.*)/;const ARG_TYPES=["ANY","BOOLEAN","NUMBER","STRING","DATE","RANGE","RANGE<BOOLEAN>","RANGE<NUMBER>","RANGE<STRING>",];function args(strings){let lines=strings.split("\n");const result=[];for(let l of lines){l=l.trim();if(l){result.push(makeArg(l));}}
return result;}
function makeArg(str){let parts=str.match(ARG_REGEXP);let name=parts[1].trim();let types=[];let isOptional=false;let isRepeating=false;let isLazy=false;let defaultVal;for(let param of parts[2].split(",")){const key=param.trim().toUpperCase();let type=ARG_TYPES.find((t)=>key===t);if(type){types.push(type);}
else if(key==="RANGE<ANY>"){types.push("RANGE");}
else if(key==="OPTIONAL"){isOptional=true;}
else if(key==="REPEATING"){isRepeating=true;}
else if(key==="LAZY"){isLazy=true;}
else if(key.startsWith("DEFAULT=")){const value=param.trim().slice(8);defaultVal=value[0]==='"'?value.slice(1,-1):parseFloat(value);}}
let description=parts[3].trim();const result={name,description,type:types,};if(isOptional){result.optional=true;}
if(isRepeating){result.repeating=true;}
if(isLazy){result.lazy=true;}
if(defaultVal!==undefined){result.default=defaultVal;}
return result;}
function validateArguments(args){let previousArgRepeating=false;let previousArgOptional=false;for(let current of args){if(previousArgRepeating){throw new Error(_lt("Function ${name} has at least 2 arguments that are repeating. The maximum repeating arguments is 1."));}
if(previousArgOptional&&!current.optional){throw new Error(_lt("Function ${name} has at mandatory arguments declared after optional ones. All optional arguments must be after all mandatory arguments."));}
previousArgRepeating=current.repeating;previousArgOptional=current.optional;}}
const ISERROR={description:_lt("Whether a value is an error."),args:args(`value (any, lazy) ${_lt("The value to be verified as an error type.")}`),returns:["BOOLEAN"],compute:function(value){try{value();return false;}
catch(e){return true;}},};const ISLOGICAL={description:_lt("Whether a value is `true` or `false`."),args:args(`value (any) ${_lt("The value to be verified as a logical TRUE or FALSE.")}`),returns:["BOOLEAN"],compute:function(value){return typeof value==="boolean";},};const ISNONTEXT={description:_lt("Whether a value is non-textual."),args:args(`value (any) ${_lt("The value to be checked.")}`),returns:["BOOLEAN"],compute:function(value){return typeof value!=="string";},};const ISNUMBER={description:_lt("Whether a value is a number."),args:args(`value (any) ${_lt("The value to be verified as a number.")}`),returns:["BOOLEAN"],compute:function(value){return typeof value==="number";},};const ISTEXT={description:_lt("Whether a value is text."),args:args(`value (any) ${_lt("The value to be verified as text.")}`),returns:["BOOLEAN"],compute:function(value){return typeof value==="string";},};var info=Object.freeze({__proto__:null,ISERROR:ISERROR,ISLOGICAL:ISLOGICAL,ISNONTEXT:ISNONTEXT,ISNUMBER:ISNUMBER,ISTEXT:ISTEXT});const WAIT={description:_lt("Wait"),args:args(`ms (number) ${_lt("wait time in milliseconds")}`),returns:["ANY"],async:true,compute:function(delay){return new Promise(function(resolve,reject){setTimeout(function(){resolve(delay);},delay);});},};const AND={description:_lt("Logical `and` operator."),args:args(`
      logical_expression1 (boolean, range<boolean>) ${_lt("An expression or reference to a cell containing an expression that represents some logical value, i.e. TRUE or FALSE, or an expression that can be coerced to a logical value.")}
      logical_expression1 (boolean, range<boolean>, optional, repeating) ${_lt("More expressions that represent logical values.")}
    `),returns:["BOOLEAN"],compute:function(){let result=true;let foundBoolean=false;visitBooleans(arguments,(b)=>{result=result&&b;foundBoolean=true;return result;});if(!foundBoolean){throw new Error(_lt(`AND has no valid input data.`));}
return result;},};const IF={description:_lt("Returns value depending on logical expression."),args:args(`
      logical_expression (boolean) ${_lt("An expression or reference to a cell containing an expression that represents some logical value, i.e. TRUE or FALSE.")}
      value_if_true (any, lazy) ${_lt("The value the function returns if logical_expression is TRUE.")}
      value_if_false (any, lazy, optional, default=FALSE) ${_lt("The value the function returns if logical_expression is FALSE.")}
    `),returns:["ANY"],compute:function(logical_expression,value_if_true,value_if_false=()=>false){const result=toBoolean(logical_expression)?value_if_true():value_if_false();return result===null?"":result;},};const IFERROR={description:_lt("Value if it is not an error, otherwise 2nd argument."),args:args(`
    value (any, lazy) ${_lt("The value to return if value itself is not an error.")}
    value_if_error (any, lazy, optional, default="") ${_lt("The value the function returns if value is an error.")}
  `),returns:["ANY"],compute:function(value,value_if_error=()=>""){let result;try{result=value();}
catch(e){result=value_if_error();}
return result===null?"":result;},};const IFS={description:_lt("Returns a value depending on multiple logical expressions."),args:args(`
      condition1 (boolean, lazy) ${_lt("The first condition to be evaluated. This can be a boolean, a number, an array, or a reference to any of those.")}
      value1 (any, lazy) ${_lt("The returned value if condition1 is TRUE.")}
      additional_values (any, lazy, optional, repeating) ${_lt("Additional conditions and values to be evaluated if the previous ones are FALSE.")}
    `),returns:["ANY"],compute:function(){if(arguments.length%2===1){throw new Error(_lt(`Wrong number of arguments. Expected an even number of arguments.`));}
for(let n=0;n<arguments.length-1;n+=2){if(toBoolean(arguments[n]())){return arguments[n+1]();}}
throw new Error(_lt(`No match.`));},};const NOT={description:_lt("Returns opposite of provided logical value."),args:args(`logical_expression (boolean) ${_lt("An expression or reference to a cell holding an expression that represents some logical value.")}
    `),returns:["BOOLEAN"],compute:function(logical_expression){return!toBoolean(logical_expression);},};const OR={description:_lt("Logical `or` operator."),args:args(`
      logical_expression1 (boolean, range<boolean>) ${_lt("An expression or reference to a cell containing an expression that represents some logical value, i.e. TRUE or FALSE, or an expression that can be coerced to a logical value.")}
      logical_expression2 (boolean, range<boolean>, optional, repeating) ${_lt("More expressions that evaluate to logical values.")}
    `),returns:["BOOLEAN"],compute:function(){let result=false;let foundBoolean=false;visitBooleans(arguments,(b)=>{result=result||b;foundBoolean=true;return!result;});if(!foundBoolean){throw new Error(_lt(`OR has no valid input data.`));}
return result;},};const XOR={description:_lt("Logical `xor` operator."),args:args(`
      logical_expression1 (boolean, range<boolean>) ${_lt("An expression or reference to a cell containing an expression that represents some logical value, i.e. TRUE or FALSE, or an expression that can be coerced to a logical value.")}
      logical_expression2 (boolean, range<boolean>, optional, repeating) ${_lt("More expressions that evaluate to logical values.")}
    `),returns:["BOOLEAN"],compute:function(){let result=false;let foundBoolean=false;visitBooleans(arguments,(b)=>{result=result?!b:b;foundBoolean=true;return true;});if(!foundBoolean){throw new Error(_lt(`XOR has no valid input data.`));}
return result;},};var logical=Object.freeze({__proto__:null,WAIT:WAIT,AND:AND,IF:IF,IFERROR:IFERROR,IFS:IFS,NOT:NOT,OR:OR,XOR:XOR});function covariance(dataY,dataX,isSample){let flatDataY=[];let flatDataX=[];let lenY=0;let lenX=0;visitAny(dataY,(y)=>{flatDataY.push(y);lenY+=1;});visitAny(dataX,(x)=>{flatDataX.push(x);lenX+=1;});if(lenY!==lenX){throw new Error(_lt(`[[FUNCTION_NAME]] has mismatched argument count ${lenY} vs ${lenX}.`));}
let count=0;let sumY=0;let sumX=0;for(let i=0;i<lenY;i++){const valueY=flatDataY[i];const valueX=flatDataX[i];if(typeof valueY==="number"&&typeof valueX==="number"){count+=1;sumY+=valueY;sumX+=valueX;}}
if(count===0||(isSample&&count===1)){throw new Error(_lt(`Evaluation of function [[FUNCTION_NAME]] caused a divide by zero error.`));}
const averageY=sumY/count;const averageX=sumX/count;let acc=0;for(let i=0;i<lenY;i++){const valueY=flatDataY[i];const valueX=flatDataX[i];if(typeof valueY==="number"&&typeof valueX==="number"){acc+=(valueY-averageY)*(valueX-averageX);}}
return acc/(count-(isSample?1:0));}
function variance(args,isSample,textAs0){let count=0;let sum=0;const reduceFuction=textAs0?reduceNumbersTextAs0:reduceNumbers;sum=reduceFuction(args,(acc,a)=>{count+=1;return acc+a;},0);if(count===0||(isSample&&count===1)){throw new Error(_lt(`Evaluation of function [[FUNCTION_NAME]] caused a divide by zero error.`));}
const average=sum/count;return(reduceFuction(args,(acc,a)=>acc+Math.pow(a-average,2),0)/(count-(isSample?1:0)));}
const AVEDEV={description:_lt("Average magnitude of deviations from mean."),args:args(`
    value1 (number, range<number>) ${_lt("The first value or range of the sample.")}
    value2 (number, range<number>, optional, repeating) ${_lt("Additional values or ranges to include in the sample.")}
  `),returns:["NUMBER"],compute:function(){let count=0;const sum=reduceNumbers(arguments,(acc,a)=>{count+=1;return acc+a;},0);if(count===0){throw new Error(_lt(`Evaluation of function AVEDEV caused a divide by zero error.`));}
const average=sum/count;return reduceNumbers(arguments,(acc,a)=>acc+Math.abs(average-a),0)/count;},};const AVERAGE={description:_lt(`Numerical average value in a dataset, ignoring text.`),args:args(`
      value1 (number, range<number>) ${_lt("The first value or range to consider when calculating the average value.")}
      value2 (number, range<number>, optional, repeating) ${_lt("Additional values or ranges to consider when calculating the average value.")}
    `),returns:["NUMBER"],compute:function(){let count=0;const sum=reduceNumbers(arguments,(acc,a)=>{count+=1;return acc+a;},0);if(count===0){throw new Error(_lt(`Evaluation of function AVERAGE caused a divide by zero error.`));}
return sum/count;},};const rangeError=_lt(`AVERAGE.WEIGHTED has mismatched range sizes.`);const negativeWeightError=_lt(`AVERAGE.WEIGHTED expects the weight to be positive or equal to 0.`);const AVERAGE_WEIGHTED={description:_lt(`Weighted average.`),args:args(`
      values (number, range<number>) ${_lt("Values to average.")}
      weights (number, range<number>) ${_lt("Weights for each corresponding value.")}
      additional_values (number, range<number>, optional, repeating) ${_lt("Additional values to average with weights.")}
    `),returns:["NUMBER"],compute:function(){let sum=0;let count=0;let value;let weight;if(arguments.length%2===1){throw new Error(_lt(`Wrong number of arguments. Expected an even number of arguments.`));}
for(let n=0;n<arguments.length-1;n+=2){value=arguments[n];weight=arguments[n+1];if(Array.isArray(value)){if(!Array.isArray(weight)){throw new Error(rangeError);}
let dimColValue=value.length;let dimLinValue=value[0].length;if(dimColValue!==weight.length||dimLinValue!=weight[0].length){throw new Error(rangeError);}
for(let i=0;i<dimColValue;i++){for(let j=0;j<dimLinValue;j++){let subValue=value[i][j];let subWeight=weight[i][j];let subValueIsNumber=typeof subValue==="number";let subWeightIsNumber=typeof subWeight==="number";if(subValueIsNumber!==subWeightIsNumber){throw new Error(_lt(`AVERAGE.WEIGHTED expects number values.`));}
if(subWeightIsNumber){if(subWeight<0){throw new Error(negativeWeightError);}
sum+=subValue*subWeight;count+=subWeight;}}}}
else{weight=toNumber(weight);value=toNumber(value);if(weight<0){throw new Error(negativeWeightError);}
sum+=value*weight;count+=weight;}}
if(count===0){throw new Error(_lt(`Evaluation of function AVERAGE.WEIGHTED caused a divide by zero error.`));}
return sum/count;},};const AVERAGEA={description:_lt(`Numerical average value in a dataset.`),args:args(`
      value1 (number, range<number>) ${_lt("The first value or range to consider when calculating the average value.")}
      value2 (number, range<number>, optional, repeating) ${_lt("Additional values or ranges to consider when calculating the average value.")}
    `),returns:["NUMBER"],compute:function(){let count=0;const sum=reduceNumbersTextAs0(arguments,(acc,a)=>{count+=1;return acc+a;},0);if(count===0){throw new Error(_lt(`Evaluation of function AVERAGEA caused a divide by zero error.`));}
return sum/count;},};const AVERAGEIF={description:_lt(`Average of values depending on criteria.`),args:args(`
      criteria_range (any, range) ${_lt("The range to check against criterion.")}
      criterion (string) ${_lt("The pattern or test to apply to criteria_range.")}
      average_range (any, range, optional, default=criteria_range) ${_lt("The range to average. If not included, criteria_range is used for the average instead.")}
    `),returns:["NUMBER"],compute:function(criteria_range,criterion,average_range=undefined){if(average_range===undefined){average_range=criteria_range;}
let count=0;let sum=0;visitMatchingRanges([criteria_range,criterion],(i,j)=>{const value=average_range[i][j];if(typeof value==="number"){count+=1;sum+=value;}});if(count===0){throw new Error(_lt(`Evaluation of function AVERAGEIF caused a divide by zero error.`));}
return sum/count;},};const AVERAGEIFS={description:_lt(`Average of values depending on multiple criteria.`),args:args(`
      average_range (any, range) ${_lt("The range to average.")}
      criteria_range1 (any, range) ${_lt("The range to check against criterion1.")}
      criterion1 (string) ${_lt("The pattern or test to apply to criteria_range1.")}
      additional_values (any, optional, repeating) ${_lt("Additional criteria_range and criterion to check.")}
    `),returns:["NUMBER"],compute:function(average_range,...args){let count=0;let sum=0;visitMatchingRanges(args,(i,j)=>{const value=average_range[i][j];if(typeof value==="number"){count+=1;sum+=value;}});if(count===0){throw new Error(_lt(`Evaluation of function AVERAGEIFS caused a divide by zero error.`));}
return sum/count;},};const COUNT={description:_lt(`The number of numeric values in dataset.`),args:args(`
    value1 (number, range<number>) ${_lt("The first value or range to consider when counting.")}
    value2 (number, range<number>, optional, repeating) ${_lt("Additional values or ranges to consider when counting.")}
  `),returns:["NUMBER"],compute:function(){let count=0;for(let n of arguments){if(Array.isArray(n)){for(let i of n){for(let j of i){if(typeof j==="number"){count+=1;}}}}
else if(typeof n!=="string"||isNumber(n)){count+=1;}}
return count;},};const COUNTA={description:_lt(`The number of values in a dataset.`),args:args(`
    value1 (any, range) ${_lt("The first value or range to consider when counting.")}
    value2 (any, range, optional, repeating) ${_lt("Additional values or ranges to consider when counting.")}
  `),returns:["NUMBER"],compute:function(){return reduceArgs(arguments,(acc,a)=>(a!==undefined&&a!==null?acc+1:acc),0);},};const COVAR={description:_lt(`The covariance of a dataset.`),args:args(`
    data_y (any, range) ${_lt("The range representing the array or matrix of dependent data.")}
    data_x (any, range) ${_lt("The range representing the array or matrix of independent data.")}
  `),returns:["NUMBER"],compute:function(data_y,data_x){return covariance(data_y,data_x,false);},};const COVARIANCE_P={description:_lt(`The covariance of a dataset.`),args:args(`
    data_y (any, range) ${_lt("The range representing the array or matrix of dependent data.")}
    data_x (any, range) ${_lt("The range representing the array or matrix of independent data.")}
  `),returns:["NUMBER"],compute:function(data_y,data_x){return covariance(data_y,data_x,false);},};const COVARIANCE_S={description:_lt(`The sample covariance of a dataset.`),args:args(`
    data_y (any, range) ${_lt("The range representing the array or matrix of dependent data.")}
    data_x (any, range) ${_lt("The range representing the array or matrix of independent data.")}
  `),returns:["NUMBER"],compute:function(data_y,data_x){return covariance(data_y,data_x,true);},};const LARGE={description:_lt("Nth largest element from a data set."),args:args(`
      data (any, range) ${_lt("Array or range containing the dataset to consider.")}
      n (number) ${_lt("The rank from largest to smallest of the element to return.")}
    `),returns:["NUMBER"],compute:function(data,n){n=Math.trunc(toNumber(n));let largests=[];let index;let count=0;visitAny(data,(d)=>{if(typeof d==="number"){index=dichotomicPredecessorSearch(largests,d);largests.splice(index+1,0,d);count++;if(count>n){largests.shift();count--;}}});const result=largests.shift();if(result===undefined){throw new Error(_lt(`LARGE has no valid input data.`));}
if(count<n){throw new Error(_lt(`Function LARGE parameter 2 value ${n} is out of range.`));}
return result;},};const MAX={description:_lt("Maximum value in a numeric dataset."),args:args(`
      value1 (number, range<number>) ${_lt("The first value or range to consider when calculating the maximum value.")}
      value2 (number, range<number>, optional, repeating) ${_lt("Additional values or ranges to consider when calculating the maximum value.")}
    `),returns:["NUMBER"],compute:function(){const result=reduceNumbers(arguments,(acc,a)=>(acc<a?a:acc),-Infinity);return result===-Infinity?0:result;},};const MAXA={description:_lt("Maximum numeric value in a dataset."),args:args(`
      value1 (any, range) ${_lt("The first value or range to consider when calculating the maximum value.")}
      value2 (ant, range, optional, repeating) ${_lt("Additional values or ranges to consider when calculating the maximum value.")}
    `),returns:["NUMBER"],compute:function(){let maxa=-Infinity;for(let n of arguments){if(Array.isArray(n)){for(let i of n){for(let j of i){if(j!=undefined){j=typeof j==="number"?j:0;if(maxa<j){maxa=j;}}}}}
else{n=toNumber(n);if(maxa<n){maxa=n;}}}
return maxa===-Infinity?0:maxa;},};const MAXIFS={description:_lt("Returns the maximum value in a range of cells, filtered by a set of criteria."),args:args(`
      range (any, range) ${_lt("The range of cells from which the maximum will be determined.")}
      criteria_range1 (any, range) ${_lt("The range of cells over which to evaluate criterion1.")}
      criterion1 (string) ${_lt("The pattern or test to apply to criteria_range1, such that each cell that evaluates to TRUE will be included in the filtered set.")}
      additional_values (any, optional, repeating) ${_lt("Additional criteria_range and criterion to check.")}
    `),returns:["NUMBER"],compute:function(range,...args){let result=-Infinity;visitMatchingRanges(args,(i,j)=>{const value=range[i][j];if(typeof value==="number"){result=result<value?value:result;}});return result===-Infinity?0:result;},};const MIN={description:_lt("Minimum value in a numeric dataset."),args:args(`
      value1 (number, range<number>) ${_lt("The first value or range to consider when calculating the minimum value.")}
      value2 (number, range<number>, optional, repeating) ${_lt("Additional values or ranges to consider when calculating the minimum value.")}
    `),returns:["NUMBER"],compute:function(){const result=reduceNumbers(arguments,(acc,a)=>(a<acc?a:acc),Infinity);return result===Infinity?0:result;},};const MINA={description:_lt("Minimum numeric value in a dataset."),args:args(`
      value1 (number, range<number>) ${_lt("The first value or range to consider when calculating the minimum value.")}
      value2 (number, range<number>, optional, repeating) ${_lt("Additional values or ranges to consider when calculating the minimum value.")}
    `),returns:["NUMBER"],compute:function(){let mina=Infinity;for(let n of arguments){if(Array.isArray(n)){for(let i of n){for(let j of i){if(j!=undefined){j=typeof j==="number"?j:0;if(j<mina){mina=j;}}}}}
else{n=toNumber(n);if(n<mina){mina=n;}}}
return mina===Infinity?0:mina;},};const MINIFS={description:_lt("Returns the minimum value in a range of cells, filtered by a set of criteria."),args:args(`
      range (any, range) ${_lt("The range of cells from which the minimum will be determined.")}
      criteria_range1 (any, range) ${_lt("The range of cells over which to evaluate criterion1.")}
      criterion1 (string) ${_lt("The pattern or test to apply to criteria_range1, such that each cell that evaluates to TRUE will be included in the filtered set.")}
      additional_values (any, optional, repeating) ${_lt("Additional criteria_range and criterion to check.")}
    `),returns:["NUMBER"],compute:function(range,...args){let result=Infinity;visitMatchingRanges(args,(i,j)=>{const value=range[i][j];if(typeof value==="number"){result=result>value?value:result;}});return result===Infinity?0:result;},};const SMALL={description:_lt("Nth smallest element in a data set."),args:args(`
      data (any, range) ${_lt("The array or range containing the dataset to consider.")}
      n (number) ${_lt("The rank from smallest to largest of the element to return.")}
    `),returns:["NUMBER"],compute:function(data,n){n=Math.trunc(toNumber(n));let largests=[];let index;let count=0;visitAny(data,(d)=>{if(typeof d==="number"){index=dichotomicPredecessorSearch(largests,d);largests.splice(index+1,0,d);count++;if(count>n){largests.pop();count--;}}});const result=largests.pop();if(result===undefined){throw new Error(_lt(`SMALL has no valid input data.`));}
if(count<n){throw new Error(_lt(`Function SMALL parameter 2 value ${n} is out of range.`));}
return result;},};const STDEV={description:_lt("Standard deviation."),args:args(`
      value1 (number, range<number>) ${_lt("The first value or range of the sample.")}
      value2 (number, range<number>, optional, repeating) ${_lt("Additional values or ranges to include in the sample.")}
    `),returns:["NUMBER"],compute:function(){return Math.sqrt(VAR.compute(...arguments));},};const STDEV_P={description:_lt("Standard deviation of entire population."),args:args(`
      value1 (number, range<number>) ${_lt("The first value or range of the population.")}
      value2 (number, range<number>, optional, repeating) ${_lt("Additional values or ranges to include in the population.")}
    `),returns:["NUMBER"],compute:function(){return Math.sqrt(VAR_P.compute(...arguments));},};const STDEV_S={description:_lt("Standard deviation."),args:args(`
      value1 (number, range<number>) ${_lt("The first value or range of the sample.")}
      value2 (number, range<number>, optional, repeating) ${_lt("Additional values or ranges to include in the sample.")}
    `),returns:["NUMBER"],compute:function(){return Math.sqrt(VAR_S.compute(...arguments));},};const STDEVA={description:_lt("Standard deviation of sample (text as 0)."),args:args(`
    value1 (number, range<number>) ${_lt("The first value or range of the sample.")}
    value2 (number, range<number>, optional, repeating) ${_lt("Additional values or ranges to include in the sample.")}
  `),returns:["NUMBER"],compute:function(){return Math.sqrt(VARA.compute(...arguments));},};const STDEVP={description:_lt("Standard deviation of entire population."),args:args(`
    value1 (number, range<number>) ${_lt("The first value or range of the population.")}
    value2 (number, range<number>, optional, repeating) ${_lt("Additional values or ranges to include in the population.")}
  `),returns:["NUMBER"],compute:function(){return Math.sqrt(VARP.compute(...arguments));},};const STDEVPA={description:_lt("Standard deviation of entire population (text as 0)."),args:args(`
    value1 (number, range<number>) ${_lt("The first value or range of the population.")}
    value2 (number, range<number>, optional, repeating) ${_lt("Additional values or ranges to include in the population.")}
  `),returns:["NUMBER"],compute:function(){return Math.sqrt(VARPA.compute(...arguments));},};const VAR={description:_lt("Variance."),args:args(`
      value1 (number, range<number>) ${_lt("The first value or range of the sample.")}
      value2 (number, range<number>, optional, repeating) ${_lt("Additional values or ranges to include in the sample.")}
    `),returns:["NUMBER"],compute:function(){return variance(arguments,true,false);},};const VAR_P={description:_lt("Variance of entire population."),args:args(`
      value1 (number, range<number>) ${_lt("The first value or range of the population.")}
      value2 (number, range<number>, optional, repeating) ${_lt("Additional values or ranges to include in the population.")}
    `),returns:["NUMBER"],compute:function(){return variance(arguments,false,false);},};const VAR_S={description:_lt("Variance."),args:args(`
      value1 (number, range<number>) ${_lt("The first value or range of the sample.")}
      value2 (number, range<number>, optional, repeating) ${_lt("Additional values or ranges to include in the sample.")}
    `),returns:["NUMBER"],compute:function(){return variance(arguments,true,false);},};const VARA={description:_lt("Variance of sample (text as 0)."),args:args(`
    value1 (number, range<number>) ${_lt("The first value or range of the sample.")}
    value2 (number, range<number>, optional, repeating) ${_lt("Additional values or ranges to include in the sample.")}
  `),returns:["NUMBER"],compute:function(){return variance(arguments,true,true);},};const VARP={description:_lt("Variance of entire population."),args:args(`
    value1 (number, range<number>) ${_lt("The first value or range of the population.")}
    value2 (number, range<number>, optional, repeating) ${_lt("Additional values or ranges to include in the population.")}
  `),returns:["NUMBER"],compute:function(){return variance(arguments,false,false);},};const VARPA={description:_lt("Variance of entire population (text as 0)."),args:args(`
    value1 (number, range<number>) ${_lt("The first value or range of the population.")}
    value2 (number, range<number>, optional, repeating) ${_lt("Additional values or ranges to include in the population.")}
  `),returns:["NUMBER"],compute:function(){return variance(arguments,false,true);},};var statistical=Object.freeze({__proto__:null,AVEDEV:AVEDEV,AVERAGE:AVERAGE,AVERAGE_WEIGHTED:AVERAGE_WEIGHTED,AVERAGEA:AVERAGEA,AVERAGEIF:AVERAGEIF,AVERAGEIFS:AVERAGEIFS,COUNT:COUNT,COUNTA:COUNTA,COVAR:COVAR,COVARIANCE_P:COVARIANCE_P,COVARIANCE_S:COVARIANCE_S,LARGE:LARGE,MAX:MAX,MAXA:MAXA,MAXIFS:MAXIFS,MIN:MIN,MINA:MINA,MINIFS:MINIFS,SMALL:SMALL,STDEV:STDEV,STDEV_P:STDEV_P,STDEV_S:STDEV_S,STDEVA:STDEVA,STDEVP:STDEVP,STDEVPA:STDEVPA,VAR:VAR,VAR_P:VAR_P,VAR_S:VAR_S,VARA:VARA,VARP:VARP,VARPA:VARPA});const ACOS={description:_lt("Inverse cosine of a value, in radians."),args:args(`
    value (number) ${_lt("The value for which to calculate the inverse cosine. Must be between -1 and 1, inclusive.")}
  `),returns:["NUMBER"],compute:function(value){const _value=toNumber(value);if(Math.abs(_value)>1){throw new Error(_lt(`Function [[FUNCTION_NAME]] parameter 1 value is ${_value}. Valid values are between -1 and 1 inclusive.`));}
return Math.acos(_value);},};const ACOSH={description:_lt("Inverse hyperbolic cosine of a number."),args:args(`
    value (number) ${_lt("The value for which to calculate the inverse hyperbolic cosine. Must be greater than or equal to 1.")}
  `),returns:["NUMBER"],compute:function(value){const _value=toNumber(value);if(_value<1){throw new Error(_lt(`Function [[FUNCTION_NAME]] parameter 1 value is ${_value}. It should be greater than or equal to 1.`));}
return Math.acosh(_value);},};const ACOT={description:_lt("Inverse cotangent of a value."),args:args(`
    value (number) ${_lt("The value for which to calculate the inverse cotangent.")}
  `),returns:["NUMBER"],compute:function(value){const _value=toNumber(value);const sign=Math.sign(_value)||1;return(sign*Math.PI)/2-Math.atan(_value);},};const ACOTH={description:_lt("Inverse hyperbolic cotangent of a value."),args:args(`
    value (number) ${_lt("The value for which to calculate the inverse hyperbolic cotangent. Must not be between -1 and 1, inclusive.")}
  `),returns:["NUMBER"],compute:function(value){const _value=toNumber(value);if(Math.abs(_value)<=1){throw new Error(_lt(`Function [[FUNCTION_NAME]] parameter 1 value is ${_value}. Valid values cannot be between -1 and 1 inclusive.`));}
return Math.log((_value+1)/(_value-1))/2;},};const ASIN={description:_lt("Inverse sine of a value, in radians."),args:args(`
    value (number) ${_lt("The value for which to calculate the inverse sine. Must be between -1 and 1, inclusive.")}
  `),returns:["NUMBER"],compute:function(value){const _value=toNumber(value);if(Math.abs(_value)>1){throw new Error(_lt(`Function [[FUNCTION_NAME]] parameter 1 value is ${_value}. Valid values are between -1 and 1 inclusive.`));}
return Math.asin(_value);},};const ASINH={description:_lt("Inverse hyperbolic sine of a number."),args:args(`
    value (number) ${_lt("The value for which to calculate the inverse hyperbolic sine.")}
  `),returns:["NUMBER"],compute:function(value){return Math.asinh(toNumber(value));},};const ATAN={description:_lt("Inverse tangent of a value, in radians."),args:args(`
    value (number) ${_lt("The value for which to calculate the inverse tangent.")}
  `),returns:["NUMBER"],compute:function(value){return Math.atan(toNumber(value));},};const ATAN2={description:_lt("Angle from the X axis to a point (x,y), in radians."),args:args(`
    x (number) ${_lt("The x coordinate of the endpoint of the line segment for which to calculate the angle from the x-axis.")}
    y (number) ${_lt("The y coordinate of the endpoint of the line segment for which to calculate the angle from the x-axis.")}
  `),returns:["NUMBER"],compute:function(x,y){const _x=toNumber(x);const _y=toNumber(y);if(_x===0&&_y===0){throw new Error(_lt(`Function [[FUNCTION_NAME]] caused a divide by zero error.`));}
return Math.atan2(_y,_x);},};const ATANH={description:_lt("Inverse hyperbolic tangent of a number."),args:args(`
    value (number) ${_lt("The value for which to calculate the inverse hyperbolic tangent. Must be between -1 and 1, exclusive.")}
  `),returns:["NUMBER"],compute:function(value){const _value=toNumber(value);if(Math.abs(_value)>=1){throw new Error(_lt(`Function [[FUNCTION_NAME]] parameter 1 value is ${_value}. Valid values are between -1 and 1 exclusive.`));}
return Math.atanh(_value);},};const CEILING={description:_lt(`Rounds number up to nearest multiple of factor.`),args:args(`
    value (number) ${_lt("The value to round up to the nearest integer multiple of factor.")}
    factor (number, optional, default=1) ${_lt("The number to whose multiples value will be rounded.")}
  `),returns:["NUMBER"],compute:function(value,factor=1){const _value=toNumber(value);const _factor=toNumber(factor);if(_value>0&&_factor<0){throw new Error(_lt(`Function CEILING expects the parameter '${CEILING.args[1].name}' to be positive when parameter '${CEILING.args[0].name}' is positive. Change '${CEILING.args[1].name}' from [${_factor}] to a positive value.`));}
return _factor?Math.ceil(_value/_factor)*_factor:0;},};const CEILING_MATH={description:_lt(`Rounds number up to nearest multiple of factor.`),args:args(`
    number (number) ${_lt("The value to round up to the nearest integer multiple of significance.")}
    significance (number, optional, default=1) ${_lt("The number to whose multiples number will be rounded. The sign of significance will be ignored.")}
    mode (number, optional, default=0) ${_lt("If number is negative, specifies the rounding direction. If 0 or blank, it is rounded towards zero. Otherwise, it is rounded away from zero.")}
  `),returns:["NUMBER"],compute:function(number,significance=1,mode=0){let _significance=toNumber(significance);if(_significance===0){return 0;}
const _number=toNumber(number);_significance=Math.abs(_significance);if(_number>=0){return Math.ceil(_number/_significance)*_significance;}
const _mode=toNumber(mode);if(_mode===0){return-Math.floor(Math.abs(_number)/_significance)*_significance;}
return-Math.ceil(Math.abs(_number)/_significance)*_significance;},};const CEILING_PRECISE={description:_lt(`Rounds number up to nearest multiple of factor.`),args:args(`
    number (number) ${_lt("The value to round up to the nearest integer multiple of significance.")}
    significance (number, optional, default=1) ${_lt("The number to whose multiples number will be rounded.")}
  `),returns:["NUMBER"],compute:function(number,significance){return CEILING_MATH.compute(number,significance,0);},};const COS={description:_lt("Cosine of an angle provided in radians."),args:args(`
    angle (number) ${_lt("The angle to find the cosine of, in radians.")}
  `),returns:["NUMBER"],compute:function(angle){return Math.cos(toNumber(angle));},};const COSH={description:_lt("Hyperbolic cosine of any real number."),args:args(`
    value (number) ${_lt("Any real value to calculate the hyperbolic cosine of.")}
  `),returns:["NUMBER"],compute:function(value){return Math.cosh(toNumber(value));},};const COT={description:_lt("Cotangent of an angle provided in radians."),args:args(`
    angle (number) ${_lt("The angle to find the cotangent of, in radians.")}
  `),returns:["NUMBER"],compute:function(angle){const _angle=toNumber(angle);if(_angle===0){throw new Error(_lt(`Evaluation of function [[FUNCTION_NAME]] caused a divide by zero error.`));}
return 1/Math.tan(_angle);},};const COTH={description:_lt("Hyperbolic cotangent of any real number."),args:args(`
    value (number) ${_lt("Any real value to calculate the hyperbolic cotangent of.")}
  `),returns:["NUMBER"],compute:function(value){const _value=toNumber(value);if(_value===0){throw new Error(_lt(`Evaluation of function [[FUNCTION_NAME]] caused a divide by zero error.`));}
return 1/Math.tanh(_value);},};const COUNTBLANK={description:_lt("Number of empty values."),args:args(`
    value1 (any, range) ${_lt("The first value or range in which to count the number of blanks.")}
    value2 (any, range, optional, repeating) ${_lt("Additional values or ranges in which to count the number of blanks.")}
  `),returns:["NUMBER"],compute:function(){return reduceArgs(arguments,(acc,a)=>(a===null||a===undefined||a===""?acc+1:acc),0);},};const COUNTIF={description:_lt("A conditional count across a range."),args:args(`
    range (any, range) ${_lt("The range that is tested against criterion.")}
    criterion (string) ${_lt("The pattern or test to apply to range.")}
  `),returns:["NUMBER"],compute:function(){let count=0;visitMatchingRanges(arguments,(i,j)=>{count+=1;});return count;},};const COUNTIFS={description:_lt("Count values depending on multiple criteria."),args:args(`
    criteria_range (any, range) ${_lt("The range to check against criterion1.")}
    criterion (string) ${_lt("The pattern or test to apply to criteria_range1.")}
    additional_values (any, optional, repeating) ${_lt("Additional criteria_range and criterion to check.")}
  `),returns:["NUMBER"],compute:function(){let count=0;visitMatchingRanges(arguments,(i,j)=>{count+=1;});return count;},};function isDefined(value){switch(value){case undefined:return false;case"":return false;case null:return false;default:return true;}}
const COUNTUNIQUE={description:_lt("Counts number of unique values in a range."),args:args(`
    value1 (any, range) ${_lt("The first value or range to consider for uniqueness.")}
    value2 (any, range, optional, repeating) ${_lt("Additional values or ranges to consider for uniqueness.")}
  `),returns:["NUMBER"],compute:function(){return reduceArgs(arguments,(acc,a)=>(isDefined(a)?acc.add(a):acc),new Set()).size;},};const COUNTUNIQUEIFS={description:_lt("Counts number of unique values in a range, filtered by a set of criteria."),args:args(`
    range (any, range) ${_lt("The range of cells from which the number of unique values will be counted.")}
    criteria_range1 (any, range) ${_lt("The range of cells over which to evaluate criterion1.")}
    criterion1 (string) ${_lt("The pattern or test to apply to criteria_range1, such that each cell that evaluates to TRUE will be included in the filtered set.")}
    additional_values (any, optional, repeating) ${_lt("Additional criteria_range and criterion to check.")}
  `),returns:["NUMBER"],compute:function(range,...args){let uniqueValues=new Set();visitMatchingRanges(args,(i,j)=>{const value=range[i][j];if(isDefined(value)){uniqueValues.add(value);}});return uniqueValues.size;},};const CSC={description:_lt("Cosecant of an angle provided in radians."),args:args(`
    angle (number) ${_lt("The angle to find the cosecant of, in radians.")}
  `),returns:["NUMBER"],compute:function(angle){const _angle=toNumber(angle);if(_angle===0){throw new Error(_lt(`Function [[FUNCTION_NAME]] caused a divide by zero error.`));}
return 1/Math.sin(_angle);},};const CSCH={description:_lt("Hyperbolic cosecant of any real number."),args:args(`
    value (number) ${_lt("Any real value to calculate the hyperbolic cosecant of.")}
  `),returns:["NUMBER"],compute:function(value){const _value=toNumber(value);if(_value===0){throw new Error(_lt(`Function [[FUNCTION_NAME]] caused a divide by zero error.`));}
return 1/Math.sinh(_value);},};const decimalErrorParameter2=(parameterName,base,value)=>_lt(`Function DECIMAL expects the parameter '${parameterName}' to be a valid base ${base} representation. Change '${parameterName}' from [${value}] to a valid base ${base} representation.`);const DECIMAL={description:_lt("Converts from another base to decimal."),args:args(`
    value (string) ${_lt("The number to convert.")},
    base (number) ${_lt("The base to convert the value from.")},
  `),returns:["NUMBER"],compute:function(value,base){let _base=toNumber(base);_base=Math.floor(_base);if(_base<2||_base>36){throw new Error(_lt(`Function DECIMAL expects the parameter '${DECIMAL.args[1].name}' to be between 2 and 36 inclusive. Change '${DECIMAL.args[1].name}' from [${_base}] to a value between 2 and 36.`));}
const _value=toString(value);if(_value===""){return 0;}
if(!_value.match(/^-?[a-z0-9]+$/i)){throw new Error(decimalErrorParameter2(DECIMAL.args[0].name,_base,_value));}
const deci=parseInt(_value,_base);if(isNaN(deci)){throw new Error(decimalErrorParameter2(DECIMAL.args[0].name,_base,_value));}
return deci;},};const DEGREES={description:_lt(`Converts an angle value in radians to degrees.`),args:args(`
    angle (number)  ${_lt("The angle to convert from radians to degrees.")}
  `),returns:["NUMBER"],compute:function(angle){return(toNumber(angle)*180)/Math.PI;},};const EXP={description:_lt(`Euler's number, e (~2.718) raised to a power.`),args:args(`
    value (number) ${_lt("The exponent to raise e.")}
  `),returns:["NUMBER"],compute:function(value){return Math.exp(toNumber(value));},};const FLOOR={description:_lt(`Rounds number down to nearest multiple of factor.`),args:args(`
    value (number) ${_lt("The value to round down to the nearest integer multiple of factor.")}
    factor (number, optional, default=1) ${_lt("The number to whose multiples value will be rounded.")}
  `),returns:["NUMBER"],compute:function(value,factor=1){const _value=toNumber(value);const _factor=toNumber(factor);if(_value>0&&_factor<0){throw new Error(_lt(`Function FLOOR expects the parameter '${FLOOR.args[1].name}' to be positive when parameter '${FLOOR.args[0].name}' is positive. Change '${FLOOR.args[1].name}' from [${_factor}] to a positive value.`));}
return _factor?Math.floor(_value/_factor)*_factor:0;},};const FLOOR_MATH={description:_lt(`Rounds number down to nearest multiple of factor.`),args:args(`
    number (number) ${_lt("The value to round down to the nearest integer multiple of significance.")}
    significance (number, optional, default=1) ${_lt("The number to whose multiples number will be rounded. The sign of significance will be ignored.")}
    mode (number, optional, default=0) ${_lt("If number is negative, specifies the rounding direction. If 0 or blank, it is rounded away from zero. Otherwise, it is rounded towards zero.")}
  `),returns:["NUMBER"],compute:function(number,significance=1,mode=0){let _significance=toNumber(significance);if(_significance===0){return 0;}
const _number=toNumber(number);_significance=Math.abs(_significance);if(_number>=0){return Math.floor(_number/_significance)*_significance;}
const _mode=toNumber(mode);if(_mode===0){return-Math.ceil(Math.abs(_number)/_significance)*_significance;}
return-Math.floor(Math.abs(_number)/_significance)*_significance;},};const FLOOR_PRECISE={description:_lt(`Rounds number down to nearest multiple of factor.`),args:args(`
    number (number) ${_lt("The value to round down to the nearest integer multiple of significance.")}
    significance (number, optional, default=1) ${_lt("The number to whose multiples number will be rounded.")}
  `),returns:["NUMBER"],compute:function(number,significance=1){return FLOOR_MATH.compute(number,significance,0);},};const ISEVEN={description:_lt(`Whether the provided value is even.`),args:args(`
    value (number) ${_lt("The value to be verified as even.")}
  `),returns:["BOOLEAN"],compute:function(value){const _value=strictToNumber(value);return Math.floor(Math.abs(_value))&1?false:true;},};const ISO_CEILING={description:_lt(`Rounds number up to nearest multiple of factor.`),args:args(`
      number (number) ${_lt("The value to round up to the nearest integer multiple of significance.")}
      significance (number, optional, default=1) ${_lt("The number to whose multiples number will be rounded.")}
    `),returns:["NUMBER"],compute:function(number,significance){return CEILING_MATH.compute(number,significance,0);},};const ISODD={description:_lt(`Whether the provided value is even.`),args:args(`
    value (number) ${_lt("The value to be verified as even.")}
  `),returns:["BOOLEAN"],compute:function(value){const _value=strictToNumber(value);return Math.floor(Math.abs(_value))&1?true:false;},};const LN={description:_lt(`The logarithm of a number, base e (euler's number).`),args:args(`
    value (number) ${_lt("The value for which to calculate the logarithm, base e.")}
  `),returns:["NUMBER"],compute:function(value){const _value=toNumber(value);if(_value<=0){throw new Error(_lt(`Function [[FUNCTION_NAME]] parameter 1 value is ${_value}. It should be greater than 0.`));}
return Math.log(_value);},};const MOD={description:_lt(`Modulo (remainder) operator.`),args:args(`
      dividend (number) ${_lt("The number to be divided to find the remainder.")}
      divisor (number) ${_lt("The number to divide by.")}
    `),returns:["NUMBER"],compute:function(dividend,divisor){const _divisor=toNumber(divisor);if(_divisor===0){throw new Error(_lt(`Function MOD expects the parameter '${MOD.args[1].name}' to be different from 0. Change '${MOD.args[1].name}' to a value other than 0.`));}
const _dividend=toNumber(dividend);const modulus=_dividend%_divisor;if((modulus>0&&_divisor<0)||(modulus<0&&_divisor>0)){return modulus+_divisor;}
return modulus;},};const ODD={description:_lt(`Rounds a number up to the nearest odd integer.`),args:args(`
      value (number) ${_lt("The value to round to the next greatest odd number.")}
    `),returns:["NUMBER"],compute:function(value){const _value=toNumber(value);let temp=Math.ceil(Math.abs(_value));temp=temp&1?temp:temp+1;return _value<0?-temp:temp;},};const PI={description:_lt(`The number pi.`),args:[],returns:["NUMBER"],compute:function(){return Math.PI;},};const POWER={description:_lt(`A number raised to a power.`),args:args(`
      base (number) ${_lt("The number to raise to the exponent power.")}
      exponent (number) ${_lt("The exponent to raise base to.")}
    `),returns:["NUMBER"],compute:function(base,exponent){const _base=toNumber(base);const _exponent=toNumber(exponent);if(_base>=0){return Math.pow(_base,_exponent);}
if(!Number.isInteger(_exponent)){throw new Error(_lt(`Function POWER expects the parameter '${POWER.args[1].name}' to be an integer when parameter '${POWER.args[0].name}' is negative. Change '${POWER.args[1].name}' from [${_exponent}] to an integer value.`));}
return Math.pow(_base,_exponent);},};const PRODUCT={description:_lt("Result of multiplying a series of numbers together."),args:args(`
      factor1 (number, range<number>) ${_lt("The first number or range to calculate for the product.")}
      factor2 (number, range<number>, optional, repeating) ${_lt("More numbers or ranges to calculate for the product.")}
    `),returns:["NUMBER"],compute:function(){let count=0;let acc=1;for(let n of arguments){if(Array.isArray(n)){for(let i of n){for(let j of i){if(typeof j==="number"){acc*=j;count+=1;}}}}
else if(n!==null){acc*=strictToNumber(n);count+=1;}}
if(count===0){return 0;}
return acc;},};const RAND={description:_lt("A random number between 0 inclusive and 1 exclusive."),args:[],returns:["NUMBER"],compute:function(){return Math.random();},};const RANDBETWEEN={description:_lt("Random integer between two values, inclusive."),args:args(`
      low (number) ${_lt("The low end of the random range.")}
      high (number) ${_lt("The high end of the random range.")}
    `),returns:["NUMBER"],compute:function(low,high){let _low=toNumber(low);if(!Number.isInteger(_low)){_low=Math.ceil(_low);}
let _high=toNumber(high);if(!Number.isInteger(_high)){_high=Math.floor(_high);}
if(_high<_low){throw new Error(_lt(`Function RANDBETWEEN parameter '${RANDBETWEEN.args[1].name}' value is ${_high}. It should be greater than or equal to [${_low}].`));}
return _low+Math.ceil((_high-_low+1)*Math.random())-1;},};const ROUND={description:_lt("Rounds a number according to standard rules."),args:args(`
      value (number) ${_lt("The value to round to places number of places.")}
      places (number, optional, default=0) ${_lt("The number of decimal places to which to round.")}
    `),returns:["NUMBER"],compute:function(value,places=0){const _value=toNumber(value);let _places=toNumber(places);const absValue=Math.abs(_value);let tempResult;if(_places===0){tempResult=Math.round(absValue);}
else{if(!Number.isInteger(_places)){_places=Math.trunc(_places);}
tempResult=Math.round(absValue*Math.pow(10,_places))/Math.pow(10,_places);}
return _value>=0?tempResult:-tempResult;},};const ROUNDDOWN={description:_lt(`Rounds down a number.`),args:args(`
      value (number) ${_lt("The value to round to places number of places, always rounding down.")}
      places (number, optional, default=0) ${_lt("The number of decimal places to which to round.")}
    `),returns:["NUMBER"],compute:function(value,places=0){const _value=toNumber(value);let _places=toNumber(places);const absValue=Math.abs(_value);let tempResult;if(_places===0){tempResult=Math.floor(absValue);}
else{if(!Number.isInteger(_places)){_places=Math.trunc(_places);}
tempResult=Math.floor(absValue*Math.pow(10,_places))/Math.pow(10,_places);}
return _value>=0?tempResult:-tempResult;},};const ROUNDUP={description:_lt(`Rounds up a number.`),args:args(`
      value (number) ${_lt("The value to round to places number of places, always rounding up.")}
      places (number, optional, default=0) ${_lt("The number of decimal places to which to round.")}
    `),returns:["NUMBER"],compute:function(value,places){const _value=toNumber(value);let _places=toNumber(places);const absValue=Math.abs(_value);let tempResult;if(_places===0){tempResult=Math.ceil(absValue);}
else{if(!Number.isInteger(_places)){_places=Math.trunc(_places);}
tempResult=Math.ceil(absValue*Math.pow(10,_places))/Math.pow(10,_places);}
return _value>=0?tempResult:-tempResult;},};const SEC={description:_lt("Secant of an angle provided in radians."),args:args(`
    angle (number) ${_lt("The angle to find the secant of, in radians.")}
  `),returns:["NUMBER"],compute:function(angle){return 1/Math.cos(toNumber(angle));},};const SECH={description:_lt("Hyperbolic secant of any real number."),args:args(`
    value (number) ${_lt("Any real value to calculate the hyperbolic secant of.")}
  `),returns:["NUMBER"],compute:function(value){return 1/Math.cosh(toNumber(value));},};const SIN={description:_lt("Sine of an angle provided in radians."),args:args(`
      angle (number) ${_lt("The angle to find the sine of, in radians.")}
    `),returns:["NUMBER"],compute:function(angle){return Math.sin(toNumber(angle));},};const SINH={description:_lt("Hyperbolic sine of any real number."),args:args(`
    value (number) ${_lt("Any real value to calculate the hyperbolic sine of.")}
  `),returns:["NUMBER"],compute:function(value){return Math.sinh(toNumber(value));},};const SQRT={description:_lt("Positive square root of a positive number."),args:args(`
      value (number) ${_lt("The number for which to calculate the positive square root.")}
    `),returns:["NUMBER"],compute:function(value){const _value=toNumber(value);if(_value<0){throw new Error(_lt(`Function SQRT parameter '${SQRT.args[0].name}' value is negative. It should be positive or zero. Change '${SQRT.args[0].name}' from [${_value}] to a positive value.`));}
return Math.sqrt(_value);},};const SUM={description:_lt("Sum of a series of numbers and/or cells."),args:args(`
      value1 (number, range<number>) ${_lt("The first number or range to add together.")}
      value2 (number, range<number>, optional, repeating) ${_lt("Additional numbers or ranges to add to value1.")}
    `),returns:["NUMBER"],compute:function(){return reduceNumbers(arguments,(acc,a)=>acc+a,0);},};const SUMIF={description:_lt("A conditional sum across a range."),args:args(`
      criteria_range (any, range) ${_lt("The range which is tested against criterion.")}
      criterion (string) ${_lt("The pattern or test to apply to range.")}
      sum_range (any, range, optional, default=criteria_range) ${_lt("The range to be summed, if different from range.")}
    `),returns:["NUMBER"],compute:function(criteria_range,criterion,sum_range=undefined){if(sum_range===undefined){sum_range=criteria_range;}
let sum=0;visitMatchingRanges([criteria_range,criterion],(i,j)=>{const value=sum_range[i][j];if(typeof value==="number"){sum+=value;}});return sum;},};const SUMIFS={description:_lt("Sums a range depending on multiple criteria."),args:args(`
      sum_range (any, range) ${_lt("The range to sum.")}
      criteria_range1 (any, range) ${_lt("The range to check against criterion1.")}
      criterion1 (string) ${_lt("The pattern or test to apply to criteria_range1.")}
      additional_values (any, optional, repeating) ${_lt("Additional criteria_range and criterion to check.")}
    `),returns:["NUMBER"],compute:function(sum_range,...args){let sum=0;visitMatchingRanges(args,(i,j)=>{const value=sum_range[i][j];if(typeof value==="number"){sum+=value;}});return sum;},};const TAN={description:_lt("Tangent of an angle provided in radians."),args:args(`
    angle (number) ${_lt("The angle to find the tangent of, in radians.")}
  `),returns:["NUMBER"],compute:function(angle){return Math.tan(toNumber(angle));},};const TANH={description:_lt("Hyperbolic tangent of any real number."),args:args(`
    value (number) ${_lt("Any real value to calculate the hyperbolic tangent of.")}
  `),returns:["NUMBER"],compute:function(value){return Math.tanh(toNumber(value));},};const TRUNC={description:_lt("Truncates a number."),args:args(`
      value (number) ${_lt("The value to be truncated.")}
      places (number, optional, default=0) ${_lt("The number of significant digits to the right of the decimal point to retain.")}
    `),returns:["NUMBER"],compute:function(value,places=0){const _value=toNumber(value);let _places=toNumber(places);if(_places===0){return Math.trunc(_value);}
if(!Number.isInteger(_places)){_places=Math.trunc(_places);}
return Math.trunc(_value*Math.pow(10,_places))/Math.pow(10,_places);},};var math=Object.freeze({__proto__:null,ACOS:ACOS,ACOSH:ACOSH,ACOT:ACOT,ACOTH:ACOTH,ASIN:ASIN,ASINH:ASINH,ATAN:ATAN,ATAN2:ATAN2,ATANH:ATANH,CEILING:CEILING,CEILING_MATH:CEILING_MATH,CEILING_PRECISE:CEILING_PRECISE,COS:COS,COSH:COSH,COT:COT,COTH:COTH,COUNTBLANK:COUNTBLANK,COUNTIF:COUNTIF,COUNTIFS:COUNTIFS,COUNTUNIQUE:COUNTUNIQUE,COUNTUNIQUEIFS:COUNTUNIQUEIFS,CSC:CSC,CSCH:CSCH,DECIMAL:DECIMAL,DEGREES:DEGREES,EXP:EXP,FLOOR:FLOOR,FLOOR_MATH:FLOOR_MATH,FLOOR_PRECISE:FLOOR_PRECISE,ISEVEN:ISEVEN,ISO_CEILING:ISO_CEILING,ISODD:ISODD,LN:LN,MOD:MOD,ODD:ODD,PI:PI,POWER:POWER,PRODUCT:PRODUCT,RAND:RAND,RANDBETWEEN:RANDBETWEEN,ROUND:ROUND,ROUNDDOWN:ROUNDDOWN,ROUNDUP:ROUNDUP,SEC:SEC,SECH:SECH,SIN:SIN,SINH:SINH,SQRT:SQRT,SUM:SUM,SUMIF:SUMIF,SUMIFS:SUMIFS,TAN:TAN,TANH:TANH,TRUNC:TRUNC});function getMatchingCells(database,field,criteria){const indexColNameDB=new Map();const dimRowDB=database.length;for(let indexCol=dimRowDB-1;indexCol>=0;indexCol--){indexColNameDB.set(toString(database[indexCol][0]).toUpperCase(),indexCol);}
const typeofField=typeof field;let index;if(typeofField==="number"){index=Math.trunc(field)-1;if(index<0||index>dimRowDB-1){throw new Error(_lt(`Function [[FUNCTION_NAME]] parameter 2 value is ${field}. Valid values are between 1 and ${dimRowDB} inclusive.`));}}
else{const colName=typeofField==="string"?field.toUpperCase():field;index=indexColNameDB.get(colName);if(index===undefined){throw new Error(_lt(`Function [[FUNCTION_NAME]] parameter 2 value is ${field}. It should be one of: ${[
                ...indexColNameDB.keys(),
            ]
                .map((v) => "'" + v + "'")
                .join(", ")}.`));}}
const dimColCriteria=criteria[0].length;if(dimColCriteria<2){throw new Error(_lt(`[[FUNCTION_NAME]] criteria range must be at least 2 rows.`));}
let matchingRows=new Set();const dimColDB=database[0].length;for(let indexRow=1;indexRow<dimColCriteria;indexRow++){let args=[];let existColNameDB=true;for(let indexCol=0;indexCol<criteria.length;indexCol++){const curentName=toString(criteria[indexCol][0]).toUpperCase();const indexColDB=indexColNameDB.get(curentName);const criter=criteria[indexCol][indexRow];if(criter!==undefined){if(indexColDB!==undefined){args.push([database[indexColDB].slice(1,dimColDB)]);args.push(criter);}
else{existColNameDB=false;break;}}}
if(existColNameDB){if(args.length>0){visitMatchingRanges(args,(i,j)=>{matchingRows.add(j);},true);}
else{matchingRows=new Set(Array(dimColDB-1).keys());break;}}}
const fieldCol=database[index];const matchingCells=[...matchingRows].map((x)=>fieldCol[x+1]);return matchingCells;}
const databaseArgs=args(`
  database (array) ${_lt("The array or range containing the data to consider, structured in such a way that the first row contains the labels for each column's values.")}
  field (any) ${_lt("Indicates which column in database contains the values to be extracted and operated on.")}
  criteria (array) ${_lt("An array or range containing zero or more criteria to filter the database values by before operating.")}
`);const DAVERAGE={description:_lt("Average of a set of values from a table-like range."),args:databaseArgs,returns:["NUMBER"],compute:function(database,field,criteria){const cells=getMatchingCells(database,field,criteria);return AVERAGE.compute([cells]);},};const DCOUNT={description:_lt("Counts values from a table-like range."),args:databaseArgs,returns:["NUMBER"],compute:function(database,field,criteria){const cells=getMatchingCells(database,field,criteria);return COUNT.compute([cells]);},};const DCOUNTA={description:_lt("Counts values and text from a table-like range."),args:databaseArgs,returns:["NUMBER"],compute:function(database,field,criteria){const cells=getMatchingCells(database,field,criteria);return COUNTA.compute([cells]);},};const DGET={description:_lt("Single value from a table-like range."),args:databaseArgs,returns:["NUMBER"],compute:function(database,field,criteria){const cells=getMatchingCells(database,field,criteria);if(cells.length>1){throw new Error(_lt(`More than one match found in DGET evaluation.`));}
return cells[0];},};const DMAX={description:_lt("Maximum of values from a table-like range."),args:databaseArgs,returns:["NUMBER"],compute:function(database,field,criteria){const cells=getMatchingCells(database,field,criteria);return MAX.compute([cells]);},};const DMIN={description:_lt("Minimum of values from a table-like range."),args:databaseArgs,returns:["NUMBER"],compute:function(database,field,criteria){const cells=getMatchingCells(database,field,criteria);return MIN.compute([cells]);},};const DPRODUCT={description:_lt("Product of values from a table-like range."),args:databaseArgs,returns:["NUMBER"],compute:function(database,field,criteria){const cells=getMatchingCells(database,field,criteria);return PRODUCT.compute([cells]);},};const DSTDEV={description:_lt("Standard deviation of population sample from table."),args:databaseArgs,returns:["NUMBER"],compute:function(database,field,criteria){const cells=getMatchingCells(database,field,criteria);return STDEV.compute([cells]);},};const DSTDEVP={description:_lt("Standard deviation of entire population from table."),args:databaseArgs,returns:["NUMBER"],compute:function(database,field,criteria){const cells=getMatchingCells(database,field,criteria);return STDEVP.compute([cells]);},};const DSUM={description:_lt("Sum of values from a table-like range."),args:databaseArgs,returns:["NUMBER"],compute:function(database,field,criteria){const cells=getMatchingCells(database,field,criteria);return SUM.compute([cells]);},};const DVAR={description:_lt("Variance of population sample from table-like range."),args:databaseArgs,returns:["NUMBER"],compute:function(database,field,criteria){const cells=getMatchingCells(database,field,criteria);return VAR.compute([cells]);},};const DVARP={description:_lt("Variance of a population from a table-like range."),args:databaseArgs,returns:["NUMBER"],compute:function(database,field,criteria){const cells=getMatchingCells(database,field,criteria);return VARP.compute([cells]);},};var database=Object.freeze({__proto__:null,DAVERAGE:DAVERAGE,DCOUNT:DCOUNT,DCOUNTA:DCOUNTA,DGET:DGET,DMAX:DMAX,DMIN:DMIN,DPRODUCT:DPRODUCT,DSTDEV:DSTDEV,DSTDEVP:DSTDEVP,DSUM:DSUM,DVAR:DVAR,DVARP:DVARP});const CURRENT_MILLENIAL=2000;const CURRENT_YEAR=new Date().getFullYear();const INITIAL_1900_DAY=new Date(1899,11,30);const INITIAL_JS_DAY=new Date(0);const DATE_JS_1900_OFFSET=INITIAL_JS_DAY-INITIAL_1900_DAY;const mdyDateRegexp=/^\d{1,2}(\/|-|\s)\d{1,2}((\/|-|\s)\d{1,4})?$/;const ymdDateRegexp=/^\d{3,4}(\/|-|\s)\d{1,2}(\/|-|\s)\d{1,2}$/;const timeRegexp=/((\d+(:\d+)?(:\d+)?\s*(AM|PM))|(\d+:\d+(:\d+)?))$/;function parseDateTime(str){str=str.trim();let time;const timeMatch=str.match(timeRegexp);if(timeMatch){time=parseTime(timeMatch[0]);if(time===null){return null;}
str=str.replace(timeMatch[0],"").trim();}
let date;const mdyDateMatch=str.match(mdyDateRegexp);const ymdDateMatch=str.match(ymdDateRegexp);if(mdyDateMatch||ymdDateMatch){let dateMatch;if(mdyDateMatch){dateMatch=mdyDateMatch[0];date=parseDate(dateMatch,"mdy");}
else{dateMatch=ymdDateMatch[0];date=parseDate(dateMatch,"ymd");}
if(date===null){return null;}
str=str.replace(dateMatch,"").trim();}
if(str!==""||!(date||time)){return null;}
if(date&&time){return{value:date.value+time.value,format:date.format+" "+(time.format==="hhhh:mm:ss"?"hh:mm:ss":time.format),jsDate:new Date(date.jsDate.getFullYear()+time.jsDate.getFullYear()-1899,date.jsDate.getMonth()+time.jsDate.getMonth()-11,date.jsDate.getDate()+time.jsDate.getDate()-30,date.jsDate.getHours()+time.jsDate.getHours(),date.jsDate.getMinutes()+time.jsDate.getMinutes(),date.jsDate.getSeconds()+time.jsDate.getSeconds()),};}
return date||time;}
function parseDate(str,dateFormat){const isMDY=dateFormat==="mdy";const isYMD=dateFormat==="ymd";if(isMDY||isYMD){const parts=str.split(/\/|-|\s/);const monthIndex=isMDY?0:1;const dayIndex=isMDY?1:2;const yearIndex=isMDY?2:0;const month=Number(parts[monthIndex]);const day=Number(parts[dayIndex]);const leadingZero=(parts[monthIndex].length===2&&month<10)||(parts[dayIndex].length===2&&day<10);const year=parts[yearIndex]?inferYear(parts[yearIndex]):CURRENT_YEAR;const jsDate=new Date(year,month-1,day);const sep=str.match(/\/|-|\s/)[0];if(jsDate.getMonth()!==month-1||jsDate.getDate()!==day){return null;}
const delta=jsDate-INITIAL_1900_DAY;let format=leadingZero?`mm${sep}dd`:`m${sep}d`;if(parts[yearIndex]){format=isMDY?format+sep+"yyyy":"yyyy"+sep+format;}
return{value:Math.round(delta/86400000),format:format,jsDate,};}
return null;}
function inferYear(str){const nbr=Number(str);switch(str.length){case 1:return CURRENT_MILLENIAL+nbr;case 2:const offset=CURRENT_MILLENIAL+nbr>CURRENT_YEAR+10?-100:0;const base=CURRENT_MILLENIAL+offset;return base+nbr;case 3:case 4:return nbr;}
return 0;}
function parseTime(str){str=str.trim();if(timeRegexp.test(str)){const isAM=/AM/i.test(str);const isPM=/PM/i.test(str);const strTime=isAM||isPM?str.substring(0,str.length-2).trim():str;const parts=strTime.split(/:/);const isMinutes=parts.length>=2;const isSeconds=parts.length===3;let hours=Number(parts[0]);let minutes=isMinutes?Number(parts[1]):0;let seconds=isSeconds?Number(parts[2]):0;let format=isSeconds?"hh:mm:ss":"hh:mm";if(isAM||isPM){format+=" a";}
else if(!isMinutes){return null;}
if(hours>=12&&isAM){hours-=12;}
else if(hours<12&&isPM){hours+=12;}
minutes+=Math.floor(seconds/60);seconds%=60;hours+=Math.floor(minutes/60);minutes%=60;if(hours>=24){format="hhhh:mm:ss";}
const jsDate=new Date(1899,11,30,hours,minutes,seconds);return{value:hours/24+minutes/1440+seconds/86400,format:format,jsDate:jsDate,};}
return null;}
function numberToDate(value){const truncValue=Math.trunc(value);let date=new Date(truncValue*86400*1000-DATE_JS_1900_OFFSET);let time=value-truncValue;time=time<0?1+time:time;const hours=Math.round(time*24);const minutes=Math.round((time-hours/24)*24*60);const seconds=Math.round((time-hours/24-minutes/24/60)*24*60*60);date.setHours(hours);date.setMinutes(minutes);date.setSeconds(seconds);return date;}
function toNativeDate(date){if(typeof date==="object"&&date!==null){if(!date.jsDate){date.jsDate=new Date(date.value*86400*1000-DATE_JS_1900_OFFSET);}
return date.jsDate;}
if(typeof date==="string"){let result=parseDateTime(date);if(result!==null&&result.jsDate){return result.jsDate;}}
return numberToDate(toNumber(date));}
function formatDateTime(date,format){const dateTimeFormat=format||date.format;const jsDate=toNativeDate(date);const indexH=dateTimeFormat.indexOf("h");let strDate="";let strTime="";if(indexH>0){strDate=formatJSDate(jsDate,dateTimeFormat.substring(0,indexH-1));strTime=formatJSTime(jsDate,dateTimeFormat.substring(indexH));}
else if(indexH===0){strTime=formatJSTime(jsDate,dateTimeFormat);}
else if(indexH<0){strDate=formatJSDate(jsDate,dateTimeFormat);}
return strDate+(strDate&&strTime?" ":"")+strTime;}
function formatJSDate(date,format){const sep=format.match(/\/|-|\s/)[0];const parts=format.split(sep);return parts.map((p)=>{switch(p){case"d":return date.getDate();case"dd":return date.getDate().toString().padStart(2,"0");case"m":return date.getMonth()+1;case"mm":return String(date.getMonth()+1).padStart(2,"0");case"yyyy":return date.getFullYear();default:throw new Error(_lt("invalid format"));}}).join(sep);}
function formatJSTime(date,format){let parts=format.split(/:|\s/);const dateHours=date.getHours();const isMeridian=parts[parts.length-1]==="a";let hours=dateHours;let meridian="";if(isMeridian){hours=hours===0?12:hours>12?hours-12:hours;meridian=dateHours>=12?" PM":" AM";parts.pop();}
return(parts.map((p)=>{switch(p){case"hhhh":const helapsedHours=Math.floor((date.getTime()-INITIAL_1900_DAY)/(60*60*1000));return helapsedHours.toString();case"hh":return hours.toString().padStart(2,"0");case"mm":return date.getMinutes().toString().padStart(2,"0");case"ss":return date.getSeconds().toString().padStart(2,"0");default:throw new Error("invalid format");}}).join(":")+meridian);}
const INITIAL_1900_DAY$1=new Date(1899,11,30);const DATE={description:_lt("Converts year/month/day into a date."),args:args(`
    year (number) ${_lt("The year component of the date.")}")}
    month (number) ${_lt("The month component of the date.")}")}
    day (number) ${_lt("The day component of the date.")}")}
    `),returns:["DATE"],compute:function(year,month,day){let _year=Math.trunc(toNumber(year));const _month=Math.trunc(toNumber(month));const _day=Math.trunc(toNumber(day));if(_year<0||10000<=_year){throw new Error(_lt(`function DATE parameter year should be greater or equal to 0 and lesser than 10000.`));}
if(_year<1900){_year+=1900;}
const jsDate=new Date(_year,_month-1,_day);const delta=jsDate.getTime()-INITIAL_1900_DAY$1.getTime();if(delta<0){throw new Error(_lt(`function DATE result should not be lesser than 01/01/1900`));}
return{value:Math.round(delta/86400000),format:"m/d/yyyy",jsDate:jsDate,};},};const DATEVALUE={description:_lt("Converts a date string to a date value."),args:args(`
      date_string (string) ${_lt("The string representing the date.")}
    `),returns:["NUMBER"],compute:function(date_string){const _dateString=toString(date_string);const datetime=parseDateTime(_dateString);if(datetime===null){throw new Error(_lt(`DATEVALUE parameter '${_dateString}' cannot be parsed to date/time.`));}
return Math.trunc(datetime.value);},};const DAY={description:_lt("Day of the month that a specific date falls on."),args:args(`
      date (string) ${_lt("The date from which to extract the day.")}
    `),returns:["NUMBER"],compute:function(date){return toNativeDate(date).getDate();},};const DAYS={description:_lt("Number of days between two dates."),args:args(`
      end_date (date) ${_lt("The end of the date range.")}
      start_date (date) ${_lt("The start of the date range.")}
    `),returns:["NUMBER"],compute:function(end_date,start_date){const _endDate=toNativeDate(end_date);const _startDate=toNativeDate(start_date);const dateDif=_endDate.getTime()-_startDate.getTime();return Math.round(dateDif/86400000);},};const EDATE={description:_lt("Date a number of months before/after another date."),args:args(`
    start_date (date) ${_lt("The date from which to calculate the result.")}
    months (number) ${_lt("The number of months before (negative) or after (positive) 'start_date' to calculate.")}
    `),returns:["DATE"],compute:function(start_date,months){const _startDate=toNativeDate(start_date);const _months=Math.trunc(toNumber(months));const yStart=_startDate.getFullYear();const mStart=_startDate.getMonth();const dStart=_startDate.getDate();const jsDate=new Date(yStart,mStart+_months,dStart);const delta=jsDate.getTime()-INITIAL_1900_DAY$1.getTime();return{value:Math.round(delta/86400000),format:"m/d/yyyy",jsDate:jsDate,};},};const EOMONTH={description:_lt("Last day of a month before or after a date."),args:args(`
    start_date (date) ${_lt("The date from which to calculate the result.")}
    months (number) ${_lt("The number of months before (negative) or after (positive) 'start_date' to consider.")}
    `),returns:["DATE"],compute:function(start_date,months){const _startDate=toNativeDate(start_date);const _months=Math.trunc(toNumber(months));const yStart=_startDate.getFullYear();const mStart=_startDate.getMonth();const jsDate=new Date(yStart,mStart+_months+1,0);const delta=jsDate.getTime()-INITIAL_1900_DAY$1.getTime();return{value:Math.round(delta/86400000),format:"m/d/yyyy",jsDate:jsDate,};},};const HOUR={description:_lt("Hour component of a specific time."),args:args(`
    time (date) ${_lt("The time from which to calculate the hour component.")}
    `),returns:["NUMBER"],compute:function(date){return toNativeDate(date).getHours();},};const ISOWEEKNUM={description:_lt("ISO week number of the year."),args:args(`
    date (date) ${_lt("The date for which to determine the ISO week number. Must be a reference to a cell containing a date, a function returning a date type, or a number.")}
    `),returns:["NUMBER"],compute:function(date){const _date=toNativeDate(date);const y=_date.getFullYear();let firstThursday=1;while(new Date(y,0,firstThursday).getDay()!==4){firstThursday+=1;}
const firstDayOfFirstWeek=new Date(y,0,firstThursday-3);let lastThursday=31;while(new Date(y,11,lastThursday).getDay()!==4){lastThursday-=1;}
const lastDayOfLastWeek=new Date(y,11,lastThursday+3);let offsetYear;if(firstDayOfFirstWeek.getTime()<=_date.getTime()){if(_date.getTime()<=lastDayOfLastWeek.getTime()){offsetYear=0;}
else{offsetYear=1;}}
else{offsetYear=-1;}
let firstDay;switch(offsetYear){case 0:firstDay=firstDayOfFirstWeek;break;case 1:firstDay=new Date(y,11,lastThursday+3+1);break;case-1:let firstThursdayPreviousYear=1;while(new Date(y-1,0,firstThursdayPreviousYear).getDay()!==4){firstThursdayPreviousYear+=1;}
firstDay=new Date(y-1,0,firstThursdayPreviousYear-3);break;}
const dif=(_date.getTime()-firstDay.getTime())/86400000;return Math.floor(dif/7)+1;},};const MINUTE={description:_lt("Minute component of a specific time."),args:args(`
      time (date) ${_lt("The time from which to calculate the minute component.")}
    `),returns:["NUMBER"],compute:function(date){return toNativeDate(date).getMinutes();},};const MONTH={description:_lt("Month of the year a specific date falls in"),args:args(`
      date (date) ${_lt("The date from which to extract the month.")}
    `),returns:["NUMBER"],compute:function(date){return toNativeDate(date).getMonth()+1;},};const NETWORKDAYS={description:_lt("Net working days between two provided days."),args:args(`
      start_date (date) ${_lt("The start date of the period from which to calculate the number of net working days.")}
      end_date (date) ${_lt("The end date of the period from which to calculate the number of net working days.")}
      holidays (date, range<date>, optional) ${_lt("A range or array constant containing the date serial numbers to consider holidays.")}
    `),returns:["NUMBER"],compute:function(start_date,end_date,holidays){return NETWORKDAYS_INTL.compute(start_date,end_date,1,holidays);},};function weekendToDayNumber(weekend){if(typeof weekend==="string"){let result=[];if(weekend.length===7){for(let i=0;i<7;i++){switch(weekend.charAt(i)){case"0":break;case"1":result.push(i+1===7?0:i+1);break;default:throw new Error(_lt(`Function [[FUNCTION_NAME]] parameter 3 requires a string composed of 0 or 1. Actual string is '${weekend}'.`));}}
return result;}
throw new Error(_lt(`Function [[FUNCTION_NAME]] parameter 3 requires a string with 7 characters. Actual string is '${weekend}'.`));}
if(typeof weekend==="number"){if(1<=weekend&&weekend<=7){return[weekend-2===-1?6:weekend-2,weekend-1];}
if(11<=weekend&&weekend<=17){return[weekend-11];}
throw new Error(_lt(`Function [[FUNCTION_NAME]] parameter 3 requires a string or a number in the range 1-7 or 11-17. Actual number is ${weekend}.`));}
throw new Error(_lt(`Function [[FUNCTION_NAME]] parameter 3 requires a number or a string.`));}
const NETWORKDAYS_INTL={description:_lt("Net working days between two dates (specifying weekends)."),args:args(`
      start_date (date) ${_lt("The start date of the period from which to calculate the number of net working days.")}
      end_date (date) ${_lt("The end date of the period from which to calculate the number of net working days.")}
      weekend (any, optional, default=1) ${_lt("A number or string representing which days of the week are considered weekends.")}
      holidays (date, range<date>, optional) ${_lt("A range or array constant containing the dates to consider as holidays.")}
    `),returns:["NUMBER"],compute:function(start_date,end_date,weekend=1,holidays=undefined){const _startDate=toNativeDate(start_date);const _endDate=toNativeDate(end_date);const daysWeekend=weekendToDayNumber(weekend);let timesHoliday=new Set();if(holidays!==undefined){visitAny(holidays,(h)=>{const holiday=toNativeDate(h);timesHoliday.add(holiday.getTime());});}
const invertDate=_startDate.getTime()>_endDate.getTime();const stopDate=new Date((invertDate?_startDate:_endDate).getTime());let stepDate=new Date((invertDate?_endDate:_startDate).getTime());const timeStopDate=stopDate.getTime();let timeStepDate=stepDate.getTime();let netWorkingDay=0;while(timeStepDate<=timeStopDate){if(!daysWeekend.includes(stepDate.getDay())&&!timesHoliday.has(timeStepDate)){netWorkingDay+=1;}
stepDate.setDate(stepDate.getDate()+1);timeStepDate=stepDate.getTime();}
return invertDate?-netWorkingDay:netWorkingDay;},};const NOW={description:_lt("Current date and time as a date value."),args:[],returns:["DATE"],compute:function(){let today=new Date();today.setMilliseconds(0);const delta=today.getTime()-INITIAL_1900_DAY$1.getTime();const time=today.getHours()/24+today.getMinutes()/1440+today.getSeconds()/86400;return{value:Math.floor(delta/86400000)+time,format:"m/d/yyyy hh:mm:ss",jsDate:today,};},};const SECOND={description:_lt("Minute component of a specific time."),args:args(`
      time (date) ${_lt("The time from which to calculate the second component.")}
    `),returns:["NUMBER"],compute:function(date){return toNativeDate(date).getSeconds();},};const TIME={description:_lt("Converts hour/minute/second into a time."),args:args(`
    hour (number) ${_lt("The hour component of the time.")}
    minute (number) ${_lt("The minute component of the time.")}
    second (number) ${_lt("The second component of the time.")}
    `),returns:["DATE"],compute:function(hour,minute,second){let _hour=Math.trunc(toNumber(hour));let _minute=Math.trunc(toNumber(minute));let _second=Math.trunc(toNumber(second));_minute+=Math.floor(_second/60);_second=(_second%60)+(_second<0?60:0);_hour+=Math.floor(_minute/60);_minute=(_minute%60)+(_minute<0?60:0);_hour%=24;if(_hour<0){throw new Error(_lt(`function Time result should not be negative`));}
const jsDate=new Date(1899,11,30,_hour,_minute,_second);return{value:_hour/24+_minute/(24*60)+_second/(24*60*60),format:"hh:mm:ss a",jsDate:jsDate,};},};const TIMEVALUE={description:_lt("Converts a time string into its serial number representation."),args:args(`
      time_string (string) ${_lt("The string that holds the time representation.")}
    `),returns:["NUMBER"],compute:function(time_string){const _timeString=toString(time_string);const datetime=parseDateTime(_timeString);if(datetime===null){throw new Error(_lt(`TIMEVALUE parameter '${_timeString}' cannot be parsed to date/time.`));}
const result=datetime.value-Math.trunc(datetime.value);return result<0?1+result:result;},};const TODAY={description:_lt("Current date as a date value."),args:[],returns:["DATE"],compute:function(){const today=new Date();const jsDate=new Date(today.getFullYear(),today.getMonth(),today.getDate());const delta=jsDate.getTime()-INITIAL_1900_DAY$1.getTime();return{value:Math.round(delta/86400000),format:"m/d/yyyy",jsDate:jsDate,};},};const WEEKDAY={description:_lt("Day of the week of the date provided (as number)."),args:args(`
    date (date) ${_lt("The date for which to determine the day of the week. Must be a reference to a cell containing a date, a function returning a date type, or a number.")}
    type (number, optional, default=1) ${_lt("A number indicating which numbering system to use to represent weekdays. By default, counts starting with Sunday = 1.")}
  `),returns:["NUMBER"],compute:function(date,type=1){const _date=toNativeDate(date);const _type=Math.round(toNumber(type));const m=_date.getDay();switch(_type){case 1:return m+1;case 2:return m===0?7:m;case 3:return m===0?6:m-1;}
throw new Error(_lt(`Function WEEKDAY parameter 2 value ${_type} is out of range.`));},};const WEEKNUM={description:_lt("Week number of the year."),args:args(`
    date (date) ${_lt("The date for which to determine the week number. Must be a reference to a cell containing a date, a function returning a date type, or a number.")}
    type (number, optional, default=1) ${_lt("A number representing the day that a week starts on. Sunday = 1.")}
    `),returns:["NUMBER"],compute:function(date,type=1){const _date=toNativeDate(date);const _type=Math.round(toNumber(type));let startDayOfWeek;if(_type===1||_type===2){startDayOfWeek=_type-1;}
else if(11<=_type&&_type<=17){startDayOfWeek=_type-10===7?0:_type-10;}
else if(_type===21){return ISOWEEKNUM.compute(date);}
else{throw new Error(_lt(`Function WEEKNUM parameter 2 value ${_type} is out of range.`));}
const y=_date.getFullYear();let dayStart=1;let startDayOfFirstWeek=new Date(y,0,dayStart);while(startDayOfFirstWeek.getDay()!==startDayOfWeek){dayStart+=1;startDayOfFirstWeek=new Date(y,0,dayStart);}
const dif=(_date.getTime()-startDayOfFirstWeek.getTime())/86400000;if(dif<0){return 1;}
return Math.floor(dif/7)+(dayStart===1?1:2);},};const WORKDAY={description:_lt("Number of working days from start date."),args:args(`
      start_date (date) ${_lt("The date from which to begin counting.")}
      num_days (number) ${_lt("The number of working days to advance from start_date. If negative, counts backwards.")}
      holidays (date, range<date>, optional) ${_lt("A range or array constant containing the dates to consider holidays.")}
      `),returns:["NUMBER"],compute:function(start_date,num_days,holidays=undefined){return WORKDAY_INTL.compute(start_date,num_days,1,holidays);},};const WORKDAY_INTL={description:_lt("Net working days between two dates (specifying weekends)."),args:args(`
      start_date (date) ${_lt("The date from which to begin counting.")}
      num_days (number) ${_lt("The number of working days to advance from start_date. If negative, counts backwards.")}
      weekend (any, optional, default=1) ${_lt("A number or string representing which days of the week are considered weekends.")}
      holidays (date, range<date>, optional) ${_lt("A range or array constant containing the dates to consider holidays.")}
    `),returns:["DATE"],compute:function(start_date,num_days,weekend=1,holidays=undefined){let _startDate=toNativeDate(start_date);let _numDays=Math.trunc(toNumber(num_days));if(weekend==="1111111"){throw new Error(_lt(`Function WORKDAY.INTL parameter 3 cannot be equal to '1111111'.`));}
const daysWeekend=weekendToDayNumber(weekend);let timesHoliday=new Set();if(holidays!==undefined){visitAny(holidays,(h)=>{const holiday=toNativeDate(h);timesHoliday.add(holiday.getTime());});}
let stepDate=new Date(_startDate.getTime());let timeStepDate=stepDate.getTime();const unitDay=Math.sign(_numDays);let stepDay=Math.abs(_numDays);while(stepDay>0){stepDate.setDate(stepDate.getDate()+unitDay);timeStepDate=stepDate.getTime();if(!daysWeekend.includes(stepDate.getDay())&&!timesHoliday.has(timeStepDate)){stepDay-=1;}}
const delta=timeStepDate-INITIAL_1900_DAY$1.getTime();return{value:Math.round(delta/86400000),format:"m/d/yyyy",jsDate:stepDate,};},};const YEAR={description:_lt("Year specified by a given date."),args:args(`
    date (date) ${_lt("The date from which to extract the year.")}
    `),returns:["NUMBER"],compute:function(date){return toNativeDate(date).getFullYear();},};var date=Object.freeze({__proto__:null,DATE:DATE,DATEVALUE:DATEVALUE,DAY:DAY,DAYS:DAYS,EDATE:EDATE,EOMONTH:EOMONTH,HOUR:HOUR,ISOWEEKNUM:ISOWEEKNUM,MINUTE:MINUTE,MONTH:MONTH,NETWORKDAYS:NETWORKDAYS,NETWORKDAYS_INTL:NETWORKDAYS_INTL,NOW:NOW,SECOND:SECOND,TIME:TIME,TIMEVALUE:TIMEVALUE,TODAY:TODAY,WEEKDAY:WEEKDAY,WEEKNUM:WEEKNUM,WORKDAY:WORKDAY,WORKDAY_INTL:WORKDAY_INTL,YEAR:YEAR});function linearSearch(range,target){for(let i=0;i<range.length;i++){if(range[i]===target){return i;}}
return-1;}
const LOOKUP={description:_lt(`Look up a value.`),args:args(`
      search_key (any) ${_lt("The value to search for. For example, 42, 'Cats', or I24.")}
      search_array (any, range) ${_lt("One method of using this function is to provide a single sorted row or column search_array to look through for the search_key with a second argument result_range. The other way is to combine these two arguments into one search_array where the first row or column is searched and a value is returned from the last row or column in the array. If search_key is not found, a non-exact match may be returned.")}
      result_range (any, range, optional) ${_lt("The range from which to return a result. The value returned corresponds to the location where search_key is found in search_range. This range must be only a single row or column and should not be used if using the search_result_array method.")}
  `),returns:["ANY"],compute:function(search_key,search_array,result_range=undefined){const verticalSearch=search_array[0].length>=search_array.length;const searchRange=verticalSearch?search_array[0]:search_array.map((c)=>c[0]);const index=dichotomicPredecessorSearch(searchRange,search_key);if(index===-1){throw new Error(_lt(`Did not find value '${search_key}' in LOOKUP evaluation.`));}
if(result_range===undefined){return verticalSearch?search_array.pop()[index]:search_array[index].pop();}
const nbCol=result_range.length;const nbRow=result_range[0].length;if(nbCol>1&&nbRow>1){throw new Error(_lt(`LOOKUP range must be a single row or a single column.`));}
if(nbCol>1){if(nbCol-1<index){throw new Error(_lt(`LOOKUP evaluates to an out of range row value ${index + 1}.`));}
return result_range[index][0];}
if(nbRow-1<index){throw new Error(_lt(`LOOKUP evaluates to an out of range column value ${index + 1}.`));}
return result_range[0][index];},};const MATCH={description:_lt(`Position of item in range that matches value.`),args:args(`
      search_key (any) ${_lt("The value to search for. For example, 42, 'Cats', or I24.")}
      range (any, range) ${_lt("The one-dimensional array to be searched.")}
      search_type (number, optional, default=1) ${_lt("The search method. 1 (default) finds the largest value less than or equal to search_key when range is sorted in ascending order. 0 finds the exact value when range is unsorted. -1 finds the smallest value greater than or equal to search_key when range is sorted in descending order.")}
  `),returns:["NUMBER"],compute:function(search_key,range,search_type=1){let _searchType=toNumber(search_type);const nbCol=range.length;const nbRow=range[0].length;if(nbCol>1&&nbRow>1){throw new Error(_lt(`MATCH range must be a single row or a single column.`));}
let index=-1;range=range.flat();_searchType=Math.sign(_searchType);switch(_searchType){case 1:index=dichotomicPredecessorSearch(range,search_key);break;case 0:index=linearSearch(range,search_key);break;case-1:index=dichotomicSuccessorSearch(range,search_key);break;}
if(index>-1){return index+1;}
else{throw new Error(_lt(`Did not find value '${search_key}' in MATCH evaluation.`));}},};const VLOOKUP={description:_lt(`Vertical lookup.`),args:args(`
      search_key (any) ${_lt("The value to search for. For example, 42, 'Cats', or I24.")}
      range (any, range) ${_lt("The range to consider for the search. The first column in the range is searched for the key specified in search_key.")}
      index (number) ${_lt("The column index of the value to be returned, where the first column in range is numbered 1.")}
      is_sorted (boolean, optional, default = TRUE) ${_lt("Indicates whether the column to be searched [the first column of the specified range] is sorted, in which case the closest match for search_key will be returned.")}
  `),returns:["ANY"],compute:function(search_key,range,index,is_sorted=true){const _index=Math.trunc(toNumber(index));if(_index<1||range.length<_index){throw new Error(_lt(`VLOOKUP evaluates to an out of bounds range.`));}
const _isSorted=toBoolean(is_sorted);const firstCol=range[0];let lineIndex;if(_isSorted){lineIndex=dichotomicPredecessorSearch(firstCol,search_key);}
else{lineIndex=linearSearch(firstCol,search_key);}
if(lineIndex>-1){return range[_index-1][lineIndex];}
else{throw new Error(_lt(`Did not find value '${search_key}' in VLOOKUP evaluation.`));}},};var lookup=Object.freeze({__proto__:null,LOOKUP:LOOKUP,MATCH:MATCH,VLOOKUP:VLOOKUP});const ADD={description:_lt(`Sum of two numbers.`),args:args(`
      value1 (number) ${_lt("The first addend.")}
      value2 (number) ${_lt("The second addend.")}
    `),returns:["NUMBER"],compute:function(value1,value2){if(value1&&value1.value){if(value2&&value2.value){return value1.value+value2.value;}
return{value:value1.value+toNumber(value2),format:value1.format,};}
return toNumber(value1)+toNumber(value2);},};const CONCAT={description:_lt(`Concatenation of two values.`),args:args(`
      value1 (string) ${_lt("The value to which value2 will be appended.")}
      value2 (string) ${_lt("The value to append to value1.")}
    `),returns:["STRING"],compute:function(value1,value2){return toString(value1)+toString(value2);},};const DIVIDE={description:_lt(`One number divided by another.`),args:args(`
      dividend (number) ${_lt("The number to be divided.")}
      divisor (number) ${_lt("The number to divide by.")}
    `),returns:["NUMBER"],compute:function(dividend,divisor){const _divisor=toNumber(divisor);if(_divisor===0){throw new Error(_lt("Function DIVIDE parameter 2 cannot be zero."));}
return toNumber(dividend)/_divisor;},};function isEmpty(value){return value===null||value===undefined;}
const getNeutral={number:0,string:"",boolean:false};const EQ={description:_lt(`Equal.`),args:args(`
      value1 (any) ${_lt("The first value.")}
      value2 (any) ${_lt("The value to test against value1 for equality.")}
    `),returns:["BOOLEAN"],compute:function(value1,value2){value1=isEmpty(value1)?getNeutral[typeof value2]:value1;value2=isEmpty(value2)?getNeutral[typeof value1]:value2;if(typeof value1==="string"){value1=value1.toUpperCase();}
if(typeof value2==="string"){value2=value2.toUpperCase();}
return value1===value2;},};function applyRelationalOperator(value1,value2,cb){value1=isEmpty(value1)?getNeutral[typeof value2]:value1;value2=isEmpty(value2)?getNeutral[typeof value1]:value2;if(typeof value1!=="number"){value1=toString(value1).toUpperCase();}
if(typeof value2!=="number"){value2=toString(value2).toUpperCase();}
const tV1=typeof value1;const tV2=typeof value2;if(tV1==="string"&&tV2==="number"){return true;}
if(tV2==="string"&&tV1==="number"){return false;}
return cb(value1,value2);}
const GT={description:_lt(`Strictly greater than.`),args:args(`
      value1 (any) ${_lt("The value to test as being greater than value2.")}
      value2 (any) ${_lt("The second value.")}
    `),returns:["BOOLEAN"],compute:function(value1,value2){return applyRelationalOperator(value1,value2,(v1,v2)=>{return v1>v2;});},};const GTE={description:_lt(`Greater than or equal to.`),args:args(`
      value1 (any) ${_lt("The value to test as being greater than or equal to value2.")}
      value2 (any) ${_lt("The second value.")}
    `),returns:["BOOLEAN"],compute:function(value1,value2){return applyRelationalOperator(value1,value2,(v1,v2)=>{return v1>=v2;});},};const LT={description:_lt(`Less than.`),args:args(`
      value1 (any) ${_lt("The value to test as being less than value2.")}
      value2 (any) ${_lt("The second value.")}
    `),returns:["BOOLEAN"],compute:function(value1,value2){return!GTE.compute(value1,value2);},};const LTE={description:_lt(`Less than or equal to.`),args:args(`
      value1 (any) ${_lt("The value to test as being less than or equal to value2.")}
      value2 (any) ${_lt("The second value.")}
    `),returns:["BOOLEAN"],compute:function(value1,value2){return!GT.compute(value1,value2);},};const MINUS={description:_lt(`Difference of two numbers.`),args:args(`
      value1 (number) ${_lt("The minuend, or number to be subtracted from.")}
      value2 (number) ${_lt("The subtrahend, or number to subtract from value1.")}
    `),returns:["NUMBER"],compute:function(value1,value2){return toNumber(value1)-toNumber(value2);},};const MULTIPLY={description:_lt(`Product of two numbers`),args:args(`
      factor1 (number) ${_lt("The first multiplicand.")}
      factor2 (number) ${_lt("The second multiplicand.")}
    `),returns:["NUMBER"],compute:function(factor1,factor2){return toNumber(factor1)*toNumber(factor2);},};const NE={description:_lt(`Not equal.`),args:args(`
      value1 (any) ${_lt("The first value.")}
      value2 (any) ${_lt("The value to test against value1 for inequality.")}
    `),returns:["BOOLEAN"],compute:function(value1,value2){return!EQ.compute(value1,value2);},};const POW={description:_lt(`A number raised to a power.`),args:args(`
      base (number) ${_lt("The number to raise to the exponent power.")}
      exponent (number) ${_lt("The exponent to raise base to.")}
    `),returns:["BOOLEAN"],compute:function(base,exponent){return POWER.compute(base,exponent);},};const UMINUS={description:_lt(`A number with the sign reversed.`),args:args(`
      value (number) ${_lt("The number to have its sign reversed. Equivalently, the number to multiply by -1.")}
    `),returns:["NUMBER"],compute:function(value){return-toNumber(value);},};const UNARY_PERCENT={description:_lt(`Value interpreted as a percentage.`),args:args(`
      percentage (number) ${_lt("The value to interpret as a percentage.")}
    `),returns:["NUMBER"],compute:function(percentage){return toNumber(percentage)/100;},};const UPLUS={description:_lt(`A specified number, unchanged.`),args:args(`
      value (any) ${_lt("The number to return.")}
    `),returns:["ANY"],compute:function(value){return value;},};var operators=Object.freeze({__proto__:null,ADD:ADD,CONCAT:CONCAT,DIVIDE:DIVIDE,EQ:EQ,GT:GT,GTE:GTE,LT:LT,LTE:LTE,MINUS:MINUS,MULTIPLY:MULTIPLY,NE:NE,POW:POW,UMINUS:UMINUS,UNARY_PERCENT:UNARY_PERCENT,UPLUS:UPLUS});const CHAR={description:_lt("Gets character associated with number."),args:args(`
      table_number (number) ${_lt("The number of the character to look up from the current Unicode table in decimal format.")}
  `),returns:["STRING"],compute:function(table_number){const _tableNumber=Math.trunc(toNumber(table_number));if(_tableNumber<1){throw new Error(_lt(`Function CHAR parameter 1 value ${_tableNumber} is out of range.`));}
return String.fromCharCode(_tableNumber);},};const CONCATENATE={description:_lt("Appends strings to one another."),args:args(`
      string1 (string, range<string>) ${_lt("The initial string.")}
      string2 (string, range<string>, optional, repeating) ${_lt("More strings to append in sequence.")}
  `),returns:["STRING"],compute:function(){return reduceArgs(arguments,(acc,a)=>acc+toString(a),"");},};const EXACT={description:_lt("Tests whether two strings are identical."),args:args(`
      string1 (string) ${_lt("The first string to compare.")}
      string2 (string) ${_lt("The second string to compare.")}
  `),returns:["BOOLEAN"],compute:function(string1,string2){return toString(string1)===toString(string2);},};const FIND={description:_lt("First position of string found in text, case-sensitive."),args:args(`
      search_for (string) ${_lt("The string to look for within text_to_search.")}
      text_to_search (string) ${_lt("The text to search for the first occurrence of search_for.")}
      starting_at (number, optional, default=1 ) ${_lt("The character within text_to_search at which to start the search.")}
  `),returns:["NUMBER"],compute:function(search_for,text_to_search,starting_at=1){const _textToSearch=toString(text_to_search);if(_textToSearch===""){throw new Error(_lt(`Function FIND parameter 2 value should be non-empty.`));}
const _startingAt=toNumber(starting_at);if(_startingAt===0){throw new Error(_lt(`Function FIND parameter 3 value is 0. It should be greater than or equal to 1.`));}
const _searchFor=toString(search_for);const result=_textToSearch.indexOf(_searchFor,_startingAt-1);if(result<0){throw new Error(_lt(`In FIND evaluation, cannot find '${_searchFor}' within '${_textToSearch}'.`));}
return result+1;},};const JOIN={description:_lt("Concatenates elements of arrays with delimiter."),args:args(`
      delimiter (string) ${_lt("The character or string to place between each concatenated value.")}
      value_or_array1 (string, range<string>) ${_lt("The value or values to be appended using delimiter.")}
      value_or_array2 (string, range<string>, optional, repeating) ${_lt("More values to be appended using delimiter.")}
  `),returns:["STRING"],compute:function(delimiter,...values_or_arrays){const _delimiter=toString(delimiter);return reduceArgs(values_or_arrays,(acc,a)=>(acc?acc+_delimiter:"")+toString(a),"");},};const LEFT={description:_lt("Substring from beginning of specified string."),args:args(`
      text (string) ${_lt("The string from which the left portion will be returned.")}
      number_of_characters (number, optional, default=1) ${_lt("The number of characters to return from the left side of string.")}
  `),returns:["STRING"],compute:function(text,number_of_characters=1){const _numberOfCharacters=toNumber(number_of_characters);if(_numberOfCharacters<0){throw new Error(_lt(`Function LEFT parameter 2 value is negative. It should be positive or zero.`));}
return toString(text).substring(0,_numberOfCharacters);},};const LEN={description:_lt("Length of a string."),args:args(`
      text (string) ${_lt("The string whose length will be returned.")}
  `),returns:["NUMBER"],compute:function(text){return toString(text).length;},};const LOWER={description:_lt("Converts a specified string to lowercase."),args:args(`
      text (string) ${_lt("The string to convert to lowercase.")}
  `),returns:["STRING"],compute:function(text){return toString(text).toLowerCase();},};const REPLACE={description:_lt("Replaces part of a text string with different text."),args:args(`
      text (string) ${_lt("The text, a part of which will be replaced.")}
      position (number) ${_lt("The position where the replacement will begin (starting from 1).")}
      length (number) ${_lt("The number of characters in the text to be replaced.")}
      new_text (string) ${_lt("The text which will be inserted into the original text.")}
  `),returns:["STRING"],compute:function(text,position,length,new_text){const _position=toNumber(position);if(_position<1){throw new Error(_lt(`Function REPLACE parameter 2 value is ${_position}. It should be greater than or equal to 1.`));}
const _text=toString(text);const _length=toNumber(length);const _newText=toString(new_text);return _text.substring(0,_position-1)+_newText+_text.substring(_position-1+_length);},};const RIGHT={description:_lt("A substring from the end of a specified string."),args:args(`
      text (string) ${_lt("The string from which the right portion will be returned.")}
      number_of_characters (number, optional, default=1) ${_lt("The number of characters to return from the right side of string.")}
  `),returns:["STRING"],compute:function(text,number_of_characters=1){const _numberOfCharacters=toNumber(number_of_characters);if(_numberOfCharacters<0){throw new Error(_lt(`Function RIGHT parameter 2 value is negative. It should be positive or zero.`));}
const _text=toString(text);const stringLength=_text.length;return _text.substring(stringLength-_numberOfCharacters,stringLength);},};const SEARCH={description:_lt("First position of string found in text, ignoring case."),args:args(`
      search_for (string) ${_lt("The string to look for within text_to_search.")}
      text_to_search (string) ${_lt("The text to search for the first occurrence of search_for.")}
      starting_at (number, optional, default=1 ) ${_lt("The character within text_to_search at which to start the search.")}
  `),returns:["NUMBER"],compute:function(search_for,text_to_search,starting_at=1){const _textToSearch=toString(text_to_search).toLowerCase();if(_textToSearch===""){throw new Error(_lt(`Function SEARCH parameter 2 value should be non-empty.`));}
const _startingAt=toNumber(starting_at);if(_startingAt===0){throw new Error(_lt(`Function SEARCH parameter 3 value is 0. It should be greater than or equal to 1.`));}
const _searchFor=toString(search_for).toLowerCase();const result=_textToSearch.indexOf(_searchFor,_startingAt-1);if(result<0){throw new Error(_lt(`In SEARCH evaluation, cannot find '${_searchFor}' within '${_textToSearch}'.`));}
return result+1;},};const SUBSTITUTE={description:_lt("Replaces existing text with new text in a string."),args:args(`
      text_to_search (string) ${_lt("The text within which to search and replace.")}
      search_for (string) ${_lt("The string to search for within text_to_search.")}
      replace_with (string) ${_lt("The string that will replace search_for.")}
      occurrence_number (number, optional) ${_lt("The instance of search_for within text_to_search to replace with replace_with. By default, all occurrences of search_for are replaced; however, if occurrence_number is specified, only the indicated instance of search_for is replaced.")}
  `),returns:["NUMBER"],compute:function(text_to_search,search_for,replace_with,occurrence_number=undefined){const _occurrenceNumber=toNumber(occurrence_number);if(_occurrenceNumber<0){throw new Error(_lt(`Function SUBSTITUTE parameter 4 value is negative. It should be positive or zero.`));}
const _textToSearch=toString(text_to_search);const _searchFor=toString(search_for);if(_searchFor===""){return _textToSearch;}
const _replaceWith=toString(replace_with);const reg=new RegExp(_searchFor,"g");if(_occurrenceNumber===0){return _textToSearch.replace(reg,_replaceWith);}
let n=0;return _textToSearch.replace(reg,(text)=>(++n===_occurrenceNumber?_replaceWith:text));},};const TEXTJOIN={description:_lt("Combines text from multiple strings and/or arrays."),args:args(`
      delimiter (string) ${_lt(" A string, possible empty, or a reference to a valid string. If empty, the text will be simply concatenated.")}
      ignore_empty (bollean) ${_lt("A boolean; if TRUE, empty cells selected in the text arguments won't be included in the result.")}
      text1 (string, range<string>) ${_lt("Any text item. This could be a string, or an array of strings in a range.")}
      text2 (string, range<string>, optional, repeating) ${_lt("Additional text item(s).")}
  `),returns:["STRING"],compute:function(delimiter,ignore_empty,...texts_or_arrays){const _delimiter=toString(delimiter);const _ignoreEmpty=toBoolean(ignore_empty);let n=0;return reduceArgs(texts_or_arrays,(acc,a)=>!(_ignoreEmpty&&toString(a)==="")?(n++?acc+_delimiter:"")+toString(a):acc,"");},};const TRIM={description:_lt("Removes space characters."),args:args(`
      text (string) ${_lt("The text or reference to a cell containing text to be trimmed.")}
  `),returns:["STRING"],compute:function(text){return toString(text).trim();},};const UPPER={description:_lt("Converts a specified string to uppercase."),args:args(`
      text (string) ${_lt("The string to convert to uppercase.")}
  `),returns:["STRING"],compute:function(text){return toString(text).toUpperCase();},};var text=Object.freeze({__proto__:null,CHAR:CHAR,CONCATENATE:CONCATENATE,EXACT:EXACT,FIND:FIND,JOIN:JOIN,LEFT:LEFT,LEN:LEN,LOWER:LOWER,REPLACE:REPLACE,RIGHT:RIGHT,SEARCH:SEARCH,SUBSTITUTE:SUBSTITUTE,TEXTJOIN:TEXTJOIN,TRIM:TRIM,UPPER:UPPER});const functions={database,date,info,lookup,logical,math,operators,statistical,text,};class FunctionRegistry extends Registry{constructor(){super(...arguments);this.mapping={};}
add(name,descr){name=name.toUpperCase().replace("_",".");validateArguments(descr.args);this.mapping[name]=descr.compute;super.add(name,descr);return this;}}
const functionRegistry=new FunctionRegistry();for(let category in functions){const fns=functions[category];for(let name in fns){const descr=fns[name];descr.category=category;functionRegistry.add(name,descr);}}
class BasePlugin{constructor(workbook,getters,history,dispatch,config){this.workbook=workbook;this.getters=getters;this.history=Object.assign(Object.create(history),{updateLocalState:history.updateStateFromRoot.bind(history,this),});this.dispatch=dispatch;this.currentMode=config.mode;this.ui=config;}
allowDispatch(command){return{status:"SUCCESS"};}
beforeHandle(command){}
handle(command){}
finalize(command){}
drawGrid(ctx,layer){}
import(data){}
export(data){}}
BasePlugin.layers=[];BasePlugin.getters=[];BasePlugin.modes=["headless","normal","readonly"];class ClipboardPlugin extends BasePlugin{constructor(){super(...arguments);this.status="empty";this.zones=[];this.originSheet=this.workbook.activeSheet.id;this._isPaintingFormat=false;this.pasteOnlyValue=false;this.pasteOnlyFormat=false;}
allowDispatch(cmd){if(cmd.type==="PASTE"){return this.isPasteAllowed(cmd.target);}
return{status:"SUCCESS",};}
handle(cmd){switch(cmd.type){case"COPY":this.cutOrCopy(cmd.target,false);break;case"CUT":this.cutOrCopy(cmd.target,true);break;case"PASTE":this.pasteOnlyValue="onlyValue"in cmd&&!!cmd.onlyValue;const onlyFormat="onlyFormat"in cmd?!!cmd.onlyFormat:this._isPaintingFormat;this._isPaintingFormat=false;this.pasteOnlyFormat=!this.pasteOnlyValue&&onlyFormat;if(cmd.interactive){this.interactivePaste(cmd.target);}
else{this.pasteFromModel(cmd.target);}
break;case"PASTE_CELL":this.pasteCell(cmd.origin,cmd.col,cmd.row,cmd.onlyValue,cmd.onlyFormat);break;case"PASTE_FROM_OS_CLIPBOARD":this.pasteFromClipboard(cmd.target,cmd.text);break;case"ACTIVATE_PAINT_FORMAT":this._isPaintingFormat=true;this.cutOrCopy(cmd.target,false);break;}}
getClipboardContent(){if(!this.cells){return"\t";}
return(this.cells.map((cells)=>{return cells.map((c)=>(c.cell?this.getters.getCellText(c.cell):"")).join("\t");}).join("\n")||"\t");}
getPasteZones(target){if(!this.cells){return target;}
const height=this.cells.length;const width=this.cells[0].length;const selection=target[target.length-1];const pasteZones=[];let col=selection.left;let row=selection.top;const repX=Math.max(1,Math.floor((selection.right+1-selection.left)/width));const repY=Math.max(1,Math.floor((selection.bottom+1-selection.top)/height));for(let x=1;x<=repX;x++){for(let y=1;y<=repY;y++){pasteZones.push({left:col,top:row,right:col-1+x*width,bottom:row-1+y*height,});}}
return pasteZones;}
isPaintingFormat(){return this._isPaintingFormat;}
cutOrCopy(zones,cut){const tops=new Set(zones.map((z)=>z.top));const bottoms=new Set(zones.map((z)=>z.bottom));const areZonesCompatible=tops.size===1&&bottoms.size===1;let clippedZones=areZonesCompatible?zones:[zones[zones.length-1]];clippedZones=clippedZones.map((z)=>Object.assign({},z));const cells=[];let{top,bottom}=clippedZones[0];for(let r=top;r<=bottom;r++){const row=[];cells.push(row);for(let zone of clippedZones){let{left,right}=zone;for(let c=left;c<=right;c++){const cell=this.getters.getCell(c,r);row.push({cell:cell?Object.assign({},cell):null,col:c,row:r,});}}}
this.status="visible";this.shouldCut=cut;this.zones=clippedZones;this.cells=cells;this.originSheet=this.workbook.activeSheet.id;}
pasteFromClipboard(target,content){this.status="invisible";const values=content.replace(/\r/g,"").split("\n").map((vals)=>vals.split("\t"));const{left:activeCol,top:activeRow}=target[0];const width=Math.max.apply(Math,values.map((a)=>a.length));const height=values.length;this.addMissingDimensions(width,height,activeCol,activeRow);for(let i=0;i<values.length;i++){for(let j=0;j<values[i].length;j++){const xc=toXC(activeCol+j,activeRow+i);this.dispatch("SET_VALUE",{xc,text:values[i][j]});}}
this.dispatch("SET_SELECTION",{anchor:[activeCol,activeRow],zones:[{left:activeCol,top:activeRow,right:activeCol+width-1,bottom:activeRow+height-1,},],});}
isPasteAllowed(target){const{zones,cells,status}=this;if(!zones||!cells||status==="empty"){return{status:"CANCELLED",reason:12};}
else if(target.length>1&&(cells.length>1||cells[0].length>1)){return{status:"CANCELLED",reason:11};}
return{status:"SUCCESS"};}
pasteFromModel(target){const{cells,shouldCut}=this;if(!cells){return;}
this.status=shouldCut?"empty":"invisible";if(shouldCut){this.clearCutZone();}
const height=cells.length;const width=cells[0].length;if(target.length>1){for(let zone of target){for(let i=zone.left;i<=zone.right;i++){for(let j=zone.top;j<=zone.bottom;j++){this.pasteZone(width,height,i,j);}}}
return;}
const selection=target[target.length-1];let col=selection.left;let row=selection.top;const repX=Math.max(1,Math.floor((selection.right+1-selection.left)/width));const repY=Math.max(1,Math.floor((selection.bottom+1-selection.top)/height));for(let x=0;x<repX;x++){for(let y=0;y<repY;y++){this.pasteZone(width,height,col+x*width,row+y*height);}}
if(height>1||width>1){const newSelection={left:col,top:row,right:col+repX*width-1,bottom:row+repY*height-1,};const[anchorCol,anchorRow]=this.getters.getSelection().anchor;const newCol=clip(anchorCol,col,col+repX*width-1);const newRow=clip(anchorRow,row,row+repY*height-1);this.dispatch("SET_SELECTION",{anchor:[newCol,newRow],zones:[newSelection],});}}
clearCutZone(){for(let row of this.cells){for(let cell of row){if(cell){this.dispatch("CLEAR_CELL",{sheet:this.originSheet,col:cell.col,row:cell.row,});}}}}
pasteZone(width,height,col,row){this.addMissingDimensions(width,height,col,row);for(let r=0;r<height;r++){const rowCells=this.cells[r];for(let c=0;c<width;c++){const originCell=rowCells[c];this.dispatch("PASTE_CELL",{origin:originCell.cell,originCol:originCell.col,originRow:originCell.row,col:col+c,row:row+r,sheet:this.originSheet,cut:this.shouldCut,onlyValue:this.pasteOnlyValue,onlyFormat:this.pasteOnlyFormat,});}}}
addMissingDimensions(width,height,col,row){const{cols,rows}=this.workbook.activeSheet;const missingRows=height+row-rows.length;if(missingRows>0){this.dispatch("ADD_ROWS",{row:rows.length-1,sheet:this.workbook.activeSheet.id,quantity:missingRows,position:"after",});}
const missingCols=width+col-cols.length;if(missingCols>0){this.dispatch("ADD_COLUMNS",{column:cols.length-1,sheet:this.workbook.activeSheet.id,quantity:missingCols,position:"after",});}}
pasteCell(origin,col,row,onlyValue,onlyFormat){const targetCell=this.getters.getCell(col,row);if(origin){let style=origin.style;let border=origin.border;let format=origin.format;let content=origin.content||"";if(onlyValue){style=targetCell?targetCell.style:undefined;border=targetCell?targetCell.border:undefined;format=targetCell?targetCell.format:undefined;if(targetCell){if(targetCell.type==="date"){format=targetCell.value.format;}}
if(origin.type==="formula"||origin.type==="date"){content=this.valueToContent(origin.value);}}
else if(onlyFormat){content=targetCell?targetCell.content:"";}
else if(origin.type==="formula"){const offsetX=col-origin.col;const offsetY=row-origin.row;content=this.getters.applyOffset(content,offsetX,offsetY);}
let newCell={style:style,border:border,format:format,sheet:this.workbook.activeSheet.id,col:col,row:row,content:content,};this.dispatch("UPDATE_CELL",newCell);}
if(!origin&&targetCell){if(onlyValue){if(targetCell.content){this.history.updateCell(targetCell,"content","");this.history.updateCell(targetCell,"value","");}}
else if(onlyFormat){if(targetCell.style){this.history.updateCell(targetCell,"style",undefined);}
if(targetCell.border){this.history.updateCell(targetCell,"border",undefined);}
if(targetCell.format){this.history.updateCell(targetCell,"format",undefined);}}
else{this.dispatch("CLEAR_CELL",{sheet:this.workbook.activeSheet.id,col:col,row:row,});}}}
valueToContent(cellValue){switch(typeof cellValue){case"number":return cellValue.toString();case"string":return cellValue;case"boolean":return cellValue?"TRUE":"FALSE";case"object":return cellValue.value.toString();default:return"";}}
interactivePaste(target){const result=this.dispatch("PASTE",{target,onlyFormat:false});if(result.status==="CANCELLED"){if(result.reason===11){this.ui.notifyUser(_lt("This operation is not allowed with multiple selections."));}
if(result.reason===1){this.ui.askConfirmation(_lt("Pasting here will remove existing merge(s). Paste anyway?"),()=>this.dispatch("PASTE",{target,onlyFormat:false,force:true}));}}}
drawGrid(renderingContext){const{viewport,ctx,thinLineWidth}=renderingContext;const zones=this.zones;if(this.status!=="visible"||!zones.length||this.originSheet!==this.getters.getActiveSheet()){return;}
ctx.save();ctx.setLineDash([8,5]);ctx.strokeStyle="#3266ca";ctx.lineWidth=3.3*thinLineWidth;for(const zone of zones){const[x,y,width,height]=this.getters.getRect(zone,viewport);if(width>0&&height>0){ctx.strokeRect(x,y,width,height);}}
ctx.restore();}}
ClipboardPlugin.layers=[2];ClipboardPlugin.getters=["getClipboardContent","isPaintingFormat","getPasteZones"];ClipboardPlugin.modes=["normal","readonly"];class ConditionalFormatPlugin extends BasePlugin{constructor(){super(...arguments);this.isStale=true;this.cfRules={};this.computedStyles={};this.rulePredicate={CellIsRule:(cell,rule)=>{switch(rule.operator){case"BeginsWith":if(!cell&&rule.values[0]===""){return false;}
return cell&&cell.value.startsWith(rule.values[0]);case"EndsWith":if(!cell&&rule.values[0]===""){return false;}
return cell&&cell.value.endsWith(rule.values[0]);case"Between":return cell&&cell.value>=rule.values[0]&&cell.value<=rule.values[1];case"NotBetween":return!(cell&&cell.value>=rule.values[0]&&cell.value<=rule.values[1]);case"ContainsText":return cell&&cell.value&&cell.value.toString().indexOf(rule.values[0])>-1;case"NotContains":return cell&&cell.value&&cell.value.toString().indexOf(rule.values[0])==-1;case"GreaterThan":return cell&&cell.value>rule.values[0];case"GreaterThanOrEqual":return cell&&cell.value>=rule.values[0];case"LessThan":return cell&&cell.value<rule.values[0];case"LessThanOrEqual":return cell&&cell.value<=rule.values[0];case"NotEqual":if(!cell&&rule.values[0]===""){return false;}
return cell&&cell.value!=rule.values[0];case"Equal":if(!cell&&rule.values[0]===""){return true;}
return cell&&cell.value==rule.values[0];default:console.warn(_lt(`Not implemented operator ${rule.operator} for kind of conditional formatting:  ${rule.type}`));}
return false;},};}
handle(cmd){switch(cmd.type){case"ACTIVATE_SHEET":const activeSheet=cmd.to;this.computedStyles[activeSheet]=this.computedStyles[activeSheet]||{};this.isStale=true;break;case"CREATE_SHEET":this.cfRules[cmd.id]=[];this.isStale=true;break;case"DUPLICATE_SHEET":this.history.updateLocalState(["cfRules",cmd.id],this.cfRules[cmd.sheet].slice());this.isStale=true;break;case"DELETE_SHEET":const cfRules=Object.assign({},this.cfRules);delete cfRules[cmd.sheet];this.history.updateLocalState(["cfRules"],cfRules);this.isStale=true;break;case"ADD_CONDITIONAL_FORMAT":this.addConditionalFormatting(cmd.cf,cmd.sheet);this.isStale=true;break;case"REMOVE_CONDITIONAL_FORMAT":this.removeConditionalFormatting(cmd.id,cmd.sheet);this.isStale=true;break;case"REMOVE_COLUMNS":this.adaptcfRules(cmd.sheet,(range)=>updateRemoveColumns(range,cmd.columns));this.isStale=true;break;case"REMOVE_ROWS":this.adaptcfRules(cmd.sheet,(range)=>updateRemoveRows(range,cmd.rows));this.isStale=true;break;case"ADD_COLUMNS":const column=cmd.position==="before"?cmd.column:cmd.column+1;this.adaptcfRules(cmd.sheet,(range)=>updateAddColumns(range,column,cmd.quantity));this.isStale=true;break;case"AUTOFILL_CELL":const sheet=this.getters.getActiveSheet();const cfOrigin=this.getRulesByCell(toXC(cmd.originCol,cmd.originRow));for(const cf of cfOrigin){this.adaptRules(sheet,cf,[toXC(cmd.col,cmd.row)],[]);}
break;case"ADD_ROWS":const row=cmd.position==="before"?cmd.row:cmd.row+1;this.adaptcfRules(cmd.sheet,(range)=>updateAddRows(range,row,cmd.quantity));this.isStale=true;break;case"PASTE_CELL":if(!cmd.onlyValue){this.pasteCf(cmd.originCol,cmd.originRow,cmd.col,cmd.row,cmd.sheet,cmd.cut);}
break;case"EVALUATE_CELLS":case"UPDATE_CELL":case"UNDO":case"REDO":this.isStale=true;break;}}
finalize(){if(this.isStale&&this.currentMode!=="headless"){this.computeStyles();this.isStale=false;}}
import(data){for(let sheet of data.sheets){this.cfRules[sheet.id]=sheet.conditionalFormats;}}
export(data){if(data.sheets){for(let sheet of data.sheets){if(this.cfRules[sheet.id]){sheet.conditionalFormats=this.cfRules[sheet.id];}}}}
getConditionalFormats(){return this.cfRules[this.workbook.activeSheet.id];}
getConditionalStyle(xc){return(this.computedStyles[this.workbook.activeSheet.id]&&this.computedStyles[this.workbook.activeSheet.id][xc]);}
getRulesSelection(selection){const ruleIds=new Set();selection.forEach((zone)=>{const zoneRuleId=this.getRulesByZone(zone);zoneRuleId.forEach((ruleId)=>{ruleIds.add(ruleId);});});return Array.from(ruleIds);}
getRulesByZone(zone){const ruleIds=new Set();for(let row=zone.top;row<=zone.bottom;row++){for(let col=zone.left;col<=zone.right;col++){const cellRules=this.getRulesByCell(toXC(col,row));cellRules.forEach((rule)=>{ruleIds.add(rule.id);});}}
return ruleIds;}
getRulesByCell(cellXc){const currentSheet=this.workbook.activeSheet.id;const rulesId=new Set();for(let cf of this.cfRules[currentSheet]){for(let ref of cf.ranges){const zone=toZone(ref);for(let row=zone.top;row<=zone.bottom;row++){for(let col=zone.left;col<=zone.right;col++){let xc=toXC(col,row);if(cellXc==xc){rulesId.add(cf);}}}}}
return rulesId;}
addConditionalFormatting(cf,sheet){const currentCF=this.cfRules[sheet].slice();const replaceIndex=currentCF.findIndex((c)=>c.id===cf.id);if(replaceIndex>-1){currentCF.splice(replaceIndex,1,cf);}
else{currentCF.push(cf);}
this.history.updateLocalState(["cfRules",sheet],currentCF);}
applyColorScale(range,rule){const minValue=Number(this.getters.evaluateFormula(`=min(${range})`));const maxValue=Number(this.getters.evaluateFormula(`=max(${range})`));if(Number.isNaN(minValue)||Number.isNaN(maxValue)){return;}
const deltaValue=maxValue-minValue;if(!deltaValue){return;}
const deltaColorR=((rule.minimum.color>>16)%256)-((rule.maximum.color>>16)%256);const deltaColorG=((rule.minimum.color>>8)%256)-((rule.maximum.color>>8)%256);const deltaColorB=(rule.minimum.color%256)-(rule.maximum.color%256);const colorDiffUnitR=deltaColorR/deltaValue;const colorDiffUnitG=deltaColorG/deltaValue;const colorDiffUnitB=deltaColorB/deltaValue;const zone=toZone(range);for(let row=zone.top;row<=zone.bottom;row++){for(let col=zone.left;col<=zone.right;col++){const cell=this.workbook.activeSheet.rows[row].cells[col];if(cell&&cell.value&&!Number.isNaN(Number.parseFloat(cell.value))){const r=Math.round(((rule.minimum.color>>16)%256)-colorDiffUnitR*(cell.value-minValue));const g=Math.round(((rule.minimum.color>>8)%256)-colorDiffUnitG*(cell.value-minValue));const b=Math.round((rule.minimum.color%256)-colorDiffUnitB*(cell.value-minValue));const color=(r<<16)|(g<<8)|b;this.computedStyles[this.workbook.activeSheet.id][cell.xc]=this.computedStyles[this.workbook.activeSheet.id][cell.xc]||{};this.computedStyles[this.workbook.activeSheet.id][cell.xc].fillColor="#"+colorNumberString(color);}}}}
computeStyles(){const currentSheet=this.workbook.activeSheet.id;this.computedStyles[currentSheet]={};for(let cf of this.cfRules[currentSheet]){try{switch(cf.rule.type){case"ColorScaleRule":for(let range of cf.ranges){this.applyColorScale(range,cf.rule);}
break;default:for(let ref of cf.ranges){const zone=toZone(ref);for(let row=zone.top;row<=zone.bottom;row++){for(let col=zone.left;col<=zone.right;col++){const pr=this.rulePredicate[cf.rule.type];let cell=this.workbook.activeSheet.rows[row].cells[col];let xc=toXC(col,row);if(pr&&pr(cell,cf.rule)){this.computedStyles[currentSheet][xc]=Object.assign(this.computedStyles[currentSheet][xc]||{},cf.rule.style);}}}}
break;}}
catch(_){}}}
adaptcfRules(sheet,updateCb){const currentCfs=this.cfRules[sheet];const newCfs=[];for(let cf of currentCfs){const updatedRanges=[];for(let range of cf.ranges){const updatedRange=updateCb(range);if(updatedRange){updatedRanges.push(updatedRange);}}
if(updatedRanges.length===0){continue;}
cf.ranges=updatedRanges;newCfs.push(cf);}
this.history.updateLocalState(["cfRules",sheet],newCfs);}
removeConditionalFormatting(id,sheet){const cfIndex=this.cfRules[sheet].findIndex((s)=>s.id===id);if(cfIndex!==-1){const currentCF=this.cfRules[sheet].slice();currentCF.splice(cfIndex,1);this.history.updateLocalState(["cfRules",sheet],currentCF);}}
pasteCf(originCol,originRow,col,row,originSheet,cut){const xc=toXC(col,row);for(let rule of this.cfRules[originSheet]){for(let range of rule.ranges){if(isInside(originCol,originRow,toZone(range))){const cf=rule;const toRemoveRange=[];if(cut){toRemoveRange.push(toXC(originCol,originRow));}
if(originSheet===this.workbook.activeSheet.id){this.adaptRules(originSheet,cf,[xc],toRemoveRange);}
else{this.adaptRules(this.workbook.activeSheet.id,cf,[xc],[]);this.adaptRules(originSheet,cf,[],toRemoveRange);}}}}}
adaptRules(sheet,cf,toAdd,toRemove){if(toAdd.length===0&&toRemove.length===0){return;}
const replaceIndex=this.cfRules[sheet].findIndex((c)=>c.id===cf.id);let currentRanges=[];if(replaceIndex>-1){currentRanges=this.cfRules[sheet][replaceIndex].ranges;}
currentRanges=currentRanges.concat(toAdd);const newRange=recomputeZones(currentRanges,toRemove);this.addConditionalFormatting({id:cf.id,rule:cf.rule,stopIfTrue:cf.stopIfTrue,ranges:newRange,},sheet);}}
ConditionalFormatPlugin.getters=["getConditionalFormats","getConditionalStyle","getRulesSelection"];const BACKGROUND_GRAY_COLOR="#f5f5f5";const BACKGROUND_HEADER_COLOR="#F8F9FA";const BACKGROUND_HEADER_SELECTED_COLOR="#E8EAED";const BACKGROUND_HEADER_ACTIVE_COLOR="#595959";const TEXT_HEADER_COLOR="#666666";const SELECTION_BORDER_COLOR="#3266ca";const HEADER_BORDER_COLOR="#C0C0C0";const CELL_BORDER_COLOR="#E2E3E3";const MIN_ROW_HEIGHT=10;const MIN_COL_WIDTH=5;const HEADER_HEIGHT=26;const HEADER_WIDTH=48;const TOPBAR_HEIGHT=63;const BOTTOMBAR_HEIGHT=36;const DEFAULT_CELL_WIDTH=96;const DEFAULT_CELL_HEIGHT=23;const SCROLLBAR_WIDTH=15;const DEFAULT_FONT_WEIGHT="400";const DEFAULT_FONT_SIZE=10;const HEADER_FONT_SIZE=11;const DEFAULT_FONT="'Roboto', arial";const functions$1=functionRegistry.content;const OPERATORS="+,-,*,/,:,=,<>,>=,>,<=,<,%,^,&".split(",");function tokenize(str){const chars=str.split("");const result=[];let tokenCount=0;while(chars.length){tokenCount++;if(tokenCount>100){throw new Error(_lt("This formula has over 100 parts. It can't be processed properly, consider splitting it into multiple cells"));}
let token=tokenizeSpace(chars)||tokenizeMisc(chars)||tokenizeOperator(chars)||tokenizeNumber(chars)||tokenizeString(chars)||tokenizeDebugger(chars)||tokenizeSymbol(chars);if(!token){token={type:"UNKNOWN",value:chars.shift()};}
result.push(token);}
return result;}
function tokenizeDebugger(chars){if(chars[0]==="?"){chars.shift();return{type:"DEBUGGER",value:"?"};}
return null;}
const misc={",":"COMMA","(":"LEFT_PAREN",")":"RIGHT_PAREN",};function tokenizeMisc(chars){if(chars[0]in misc){const value=chars.shift();const type=misc[value];return{type,value};}
return null;}
function startsWith(chars,op){for(let i=0;i<op.length;i++){if(op[i]!==chars[i]){return false;}}
return true;}
function tokenizeOperator(chars){for(let op of OPERATORS){if(startsWith(chars,op)){chars.splice(0,op.length);return{type:"OPERATOR",value:op};}}
return null;}
function tokenizeNumber(chars){const match=chars.join("").match(formulaNumberRegexp);if(match){chars.splice(0,match[0].length);return{type:"NUMBER",value:match[0]};}
return null;}
function tokenizeString(chars){if(chars[0]==='"'){const startChar=chars.shift();const letters=[startChar];while(chars[0]&&(chars[0]!==startChar||letters[letters.length-1]==="\\")){letters.push(chars.shift());}
if(chars[0]==='"'){letters.push(chars.shift());}
return{type:"STRING",value:letters.join(""),};}
return null;}
const separatorRegexp=/\w|\.|!|\$/;function tokenizeSymbol(chars){const result=[];if(chars[0]==="'"){let lastChar=chars.shift();result.push(lastChar);while(chars[0]){lastChar=chars.shift();result.push(lastChar);if(lastChar==="'"){if(chars[0]&&chars[0]==="'"){lastChar=chars.shift();result.push(lastChar);}
else{break;}}}
if(lastChar!=="'"){return{type:"UNKNOWN",value:result.join(""),};}}
while(chars[0]&&chars[0].match(separatorRegexp)){result.push(chars.shift());}
if(result.length){const value=result.join("");const isFunction=value.toUpperCase()in functions$1;const type=isFunction?"FUNCTION":"SYMBOL";return{type,value};}
return null;}
const whiteSpaceRegexp=/\s/;function tokenizeSpace(chars){let length=0;while(chars[0]&&chars[0].match(whiteSpaceRegexp)){length++;chars.shift();}
if(length){return{type:"SPACE",value:" ".repeat(length)};}
return null;}
function enrichTokens(tokens){let current=0;return tokens.map((x)=>{const len=x.value.toString().length;const token=Object.assign({},x,{start:current,end:current+len,length:len,});current=token.end;return token;});}
function toSimpleTokens(composerTokens){return composerTokens.map((x)=>{return{type:x.type,value:x.value,};});}
function mergeSymbolsIntoRanges(result,removeSpace=false){let operator=undefined;let refStart=undefined;let refEnd=undefined;let startIncludingSpaces=undefined;const reset=()=>{startIncludingSpaces=undefined;refStart=undefined;operator=undefined;refEnd=undefined;};for(let i=0;i<result.length;i++){const token=result[i];if(startIncludingSpaces){if(refStart){if(token.type==="SPACE"){continue;}
else if(token.type==="OPERATOR"&&token.value===":"){operator=i;}
else if(operator&&token.type==="SYMBOL"){refEnd=i;}
else{if(startIncludingSpaces&&refStart&&operator&&refEnd){const newToken={type:"SYMBOL",start:result[startIncludingSpaces].start,end:result[i-1].end,length:result[i-1].end-result[startIncludingSpaces].start,value:result.slice(startIncludingSpaces,i).filter((x)=>!removeSpace||x.type!=="SPACE").map((x)=>x.value).join(""),};result.splice(startIncludingSpaces,i-startIncludingSpaces,newToken);i=startIncludingSpaces+1;reset();}
else{if(token.type==="SYMBOL"){startIncludingSpaces=i;refStart=i;operator=undefined;}
else{reset();}}}}
else{if(token.type==="SYMBOL"){refStart=i;operator=refEnd=undefined;}
else{reset();}}}
else{if(["SPACE","SYMBOL"].includes(token.type)){startIncludingSpaces=i;refStart=token.type==="SYMBOL"?i:undefined;operator=refEnd=undefined;}
else{reset();}}}
const i=result.length-1;if(startIncludingSpaces&&refStart&&operator&&refEnd){const newToken={type:"SYMBOL",start:result[startIncludingSpaces].start,end:result[i].end,length:result[i].end-result[startIncludingSpaces].start,value:result.slice(startIncludingSpaces,i+1).filter((x)=>!removeSpace||x.type!=="SPACE").map((x)=>x.value).join(""),};result.splice(startIncludingSpaces,i-startIncludingSpaces+1,newToken);}
return result;}
function rangeTokenize(formula){const tokens=tokenize(formula);return toSimpleTokens(mergeSymbolsIntoRanges(enrichTokens(tokens),true));}
function mapParenthesis(tokens){let maxParen=1;const stack=[];return tokens.map((token)=>{if(token.type==="LEFT_PAREN"){stack.push(maxParen);token.parenIndex=maxParen;maxParen++;}
else if(token.type==="RIGHT_PAREN"){token.parenIndex=stack.pop();}
return token;});}
function composerTokenize(formula){const tokens=tokenize(formula);return mergeSymbolsIntoRanges(mapParenthesis(enrichTokens(tokens)));}
const functions$2=functionRegistry.content;const UNARY_OPERATORS=["-","+"];const OP_PRIORITY={"^":30,"*":20,"/":20,">":10,"<>":10,">=":10,"<":10,"<=":10,"=":10,"-":7,};const FUNCTION_BP=6;function bindingPower(token){switch(token.type){case"NUMBER":case"SYMBOL":return 0;case"COMMA":return 3;case"LEFT_PAREN":return 5;case"RIGHT_PAREN":return 5;case"OPERATOR":return OP_PRIORITY[token.value]||15;}
throw new Error(_lt("?"));}
const cellReference=new RegExp(/\$?[A-Z]+\$?[0-9]+/,"i");const rangeReference=new RegExp(/^\s*\$?[A-Z]+\$?[0-9]+\s*(\s*:\s*\$?[A-Z]+\$?[0-9]+\s*)?$/,"i");function parsePrefix(current,tokens){switch(current.type){case"DEBUGGER":const next=parseExpression(tokens,1000);next.debug=true;return next;case"NUMBER":return{type:current.type,value:parseNumber(current.value)};case"STRING":return{type:current.type,value:current.value};case"FUNCTION":if(tokens.shift().type!=="LEFT_PAREN"){throw new Error(_lt("wrong function call"));}
else{const args=[];if(tokens[0].type!=="RIGHT_PAREN"){if(tokens[0].type==="COMMA"){args.push({type:"UNKNOWN",value:""});}
else{args.push(parseExpression(tokens,FUNCTION_BP));}
while(tokens[0].type==="COMMA"){tokens.shift();if(tokens[0].type==="RIGHT_PAREN"){args.push({type:"UNKNOWN",value:""});break;}
if(tokens[0].type==="COMMA"){args.push({type:"UNKNOWN",value:""});}
else{args.push(parseExpression(tokens,FUNCTION_BP));}}}
if(tokens.shift().type!=="RIGHT_PAREN"){throw new Error(_lt("wrong function call"));}
const isAsync=functions$2[current.value.toUpperCase()].async;const type=isAsync?"ASYNC_FUNCALL":"FUNCALL";return{type,value:current.value,args};}
case"SYMBOL":if(cellReference.test(current.value)){if(current.value.includes("!")){let[sheet,val]=current.value.split("!");sheet=getUnquotedSheetName(sheet);return{type:"REFERENCE",value:val.replace(/\$/g,"").toUpperCase(),sheet:sheet,};}
else{return{type:"REFERENCE",value:current.value.replace(/\$/g,"").toUpperCase(),};}}
else{if(["TRUE","FALSE"].includes(current.value.toUpperCase())){return{type:"BOOLEAN",value:current.value.toUpperCase()==="TRUE"};}
else{if(current.value){throw new Error(_lt("Invalid formula"));}
return{type:"UNKNOWN",value:current.value};}}
case"LEFT_PAREN":const result=parseExpression(tokens,5);if(!tokens.length||tokens[0].type!=="RIGHT_PAREN"){throw new Error(_lt("unmatched left parenthesis"));}
tokens.shift();return result;default:if(current.type==="OPERATOR"&&UNARY_OPERATORS.includes(current.value)){return{type:"UNARY_OPERATION",value:current.value,right:parseExpression(tokens,15),};}
throw new Error(_lt("nope"));}}
function parseInfix(left,current,tokens){if(current.type==="OPERATOR"){const bp=bindingPower(current);const right=parseExpression(tokens,bp);if(current.value===":"){if(left.type==="REFERENCE"&&right.type==="REFERENCE"){const[x1,y1]=toCartesian(left.value);const[x2,y2]=toCartesian(right.value);left.value=toXC(Math.min(x1,x2),Math.min(y1,y2));right.value=toXC(Math.max(x1,x2),Math.max(y1,y2));}}
return{type:"BIN_OPERATION",value:current.value,left,right,};}
throw new Error(_lt("nope"));}
function parseExpression(tokens,bp){const token=tokens.shift();let expr=parsePrefix(token,tokens);while(tokens[0]&&bindingPower(tokens[0])>bp){expr=parseInfix(expr,tokens.shift(),tokens);}
return expr;}
function parse(str){const tokens=tokenize(str).filter((x)=>x.type!=="SPACE");if(tokens[0].type==="OPERATOR"&&tokens[0].value==="="){tokens.splice(0,1);}
const result=parseExpression(tokens,0);if(tokens.length){throw new Error(_lt("invalid expression"));}
return result;}
function astToFormula(ast){switch(ast.type){case"FUNCALL":case"ASYNC_FUNCALL":const args=ast.args.map((arg)=>astToFormula(arg));return`${ast.value}(${args.join(",")})`;case"NUMBER":return ast.value.toString();case"STRING":return ast.value;case"BOOLEAN":return ast.value?"TRUE":"FALSE";case"UNARY_OPERATION":return ast.value+astToFormula(ast.right);case"BIN_OPERATION":return astToFormula(ast.left)+ast.value+astToFormula(ast.right);case"REFERENCE":return ast.sheet?`${ast.sheet}!${ast.value}`:ast.value;default:return ast.value;}}
const functions$3=functionRegistry.content;const OPERATOR_MAP={"=":"EQ","+":"ADD","-":"MINUS","*":"MULTIPLY","/":"DIVIDE",">=":"GTE","<>":"NE",">":"GT","<=":"LTE","<":"LT","^":"POWER","&":"CONCATENATE",};const UNARY_OPERATOR_MAP={"-":"UMINUS","+":"UPLUS",};const functionCache={};const AsyncFunction=Object.getPrototypeOf(async function(){}).constructor;function compile(str,sheet,sheets){const ast=parse(str);let nextId=1;const code=[`// ${str}`];let isAsync=false;let cacheKey="";let cellRefs=[];let rangeRefs=[];if(ast.type==="BIN_OPERATION"&&ast.value===":"){throw new Error(_lt("Invalid formula"));}
if(ast.type==="UNKNOWN"){throw new Error(_lt("Invalid formula"));}
function compileFunctionArgs(ast){const fn=functions$3[ast.value.toUpperCase()];const result=[];const args=ast.args;let argDescr;for(let i=0;i<args.length;i++){const arg=args[i];argDescr=fn.args[i]||argDescr;const isLazy=argDescr&&argDescr.lazy;let argValue=compileAST(arg,isLazy);if(arg.type==="REFERENCE"){const types=argDescr.type;const hasRange=types.find((t)=>t==="RANGE"||t==="RANGE<BOOLEAN>"||t==="RANGE<NUMBER>"||t==="RANGE<STRING>");if(hasRange){argValue=`[[${argValue}]]`;}}
result.push(argValue);}
const isRepeating=fn.args.length?fn.args[fn.args.length-1].repeating:false;let minArg=0;let maxArg=isRepeating?Infinity:fn.args.length;for(let arg of fn.args){if(!arg.optional){minArg++;}}
if(result.length<minArg||result.length>maxArg){throw new Error(_lt(`
          Invalid number of arguments for the ${ast.value.toUpperCase()} function.
          Expected ${fn.args.length}, but got ${result.length} instead.`));}
return result;}
function compileAST(ast,isLazy=false){let id,left,right,args,fnName,statement;if(ast.type!=="REFERENCE"&&!(ast.type==="BIN_OPERATION"&&ast.value===":")){cacheKey+="_"+ast.value;}
if(ast.debug){cacheKey+="?";code.push("debugger;");}
switch(ast.type){case"BOOLEAN":case"NUMBER":case"STRING":if(!isLazy){return ast.value;}
id=nextId++;statement=`${ast.value}`;break;case"REFERENCE":id=nextId++;cacheKey+="__REF";const sheetId=ast.sheet?sheets[ast.sheet]:sheet;const refIdx=cellRefs.push([ast.value,sheetId])-1;statement=`cell(${refIdx})`;break;case"FUNCALL":id=nextId++;args=compileFunctionArgs(ast);fnName=ast.value.toUpperCase();code.push(`ctx.__lastFnCalled = '${fnName}'`);statement=`ctx['${fnName}'](${args})`;break;case"ASYNC_FUNCALL":id=nextId++;isAsync=true;args=compileFunctionArgs(ast);fnName=ast.value.toUpperCase();code.push(`ctx.__lastFnCalled = '${fnName}'`);statement=`await ctx['${fnName}'](${args})`;break;case"UNARY_OPERATION":id=nextId++;right=compileAST(ast.right);fnName=UNARY_OPERATOR_MAP[ast.value];code.push(`ctx.__lastFnCalled = '${fnName}'`);statement=`ctx['${fnName}']( ${right})`;break;case"BIN_OPERATION":id=nextId++;if(ast.value===":"){cacheKey+="__RANGE";const sheetName=ast.left.type==="REFERENCE"&&ast.left.sheet;const sheetId=sheetName?sheets[sheetName]:sheet;const rangeIdx=rangeRefs.push([ast.left.value,ast.right.value,sheetId])-1;statement=`range(${rangeIdx});`;}
else{left=compileAST(ast.left);right=compileAST(ast.right);fnName=OPERATOR_MAP[ast.value];code.push(`ctx.__lastFnCalled = '${fnName}'`);statement=`ctx['${fnName}'](${left}, ${right})`;}
break;case"UNKNOWN":if(!isLazy){return"null";}
id=nextId++;statement=`null`;break;}
code.push(`let _${id} = `+(isLazy?`()=> `:``)+statement);return`_${id}`;}
code.push(`return ${compileAST(ast)};`);let baseFunction=functionCache[cacheKey];if(!baseFunction){const Constructor=isAsync?AsyncFunction:Function;baseFunction=new Constructor("cell","range","ctx",code.join("\n"));functionCache[cacheKey]=baseFunction;}
const resultFn=(cell,range,ctx)=>{const cellFn=(idx)=>{const[xc,sheetId]=cellRefs[idx];return cell(xc,sheetId);};const rangeFn=(idx)=>{const[xc1,xc2,sheetId]=rangeRefs[idx];return range(xc1,xc2,sheetId);};return baseFunction(cellFn,rangeFn,ctx);};resultFn.async=isAsync;return resultFn;}
const nbspRegexp=new RegExp(String.fromCharCode(160),"g");const MIN_PADDING=3;class CorePlugin extends BasePlugin{constructor(){super(...arguments);this.sheetIds={};this.showFormulas=false;this.updateColumnsRef=(ref,sheet,base,step)=>{let x=toCartesian(ref)[0];if(x===base&&step===-1){return"#REF";}
return this.updateReference(ref,x>base?step:0,0,this.getSheetIdByName(sheet),false);};this.updateColumnsRangePart=(ref,sheet,base,step,direction)=>{let[x,y]=toCartesian(ref);if(x===base&&step===-1){x+=direction;}
const[xcRef]=this.updateColumnsRef(toXC(x,y),sheet,base,step).split("!").reverse();return xcRef;};this.updateColumnsRange=(ref,sheet,base,step)=>{let[left,right]=ref.split(":");left=this.updateColumnsRangePart(left,sheet,base,step,1);right=this.updateColumnsRangePart(right,sheet,base,step,-1);if(left==="#REF"||right==="#REF"){return"#REF";}
const columnLeft=toCartesian(left)[0];const columnRight=toCartesian(right)[0];if(columnLeft>columnRight){return"#REF";}
if(left===right){return left;}
const range=`${left}:${right}`;return sheet?`${sheet}!${range}`:range;};this.updateRowsRef=(ref,sheet,base,step)=>{let y=toCartesian(ref)[1];if(base+step<y&&y<=base){return"#REF";}
return this.updateReference(ref,0,y>base?step:0,this.getSheetIdByName(sheet),false);};this.updateRowsRangePart=(value,sheet,base,step,direction)=>{let[x,y]=toCartesian(value);if(base+step<y&&y<=base){if(direction===-1){y=Math.max(base,y)+step;}
step=0;}
const[xcRef]=this.updateRowsRef(toXC(x,y),sheet,base,step).split("!").reverse();return xcRef;};this.updateRowsRange=(value,sheet,base,step)=>{let[left,right]=value.split(":");left=this.updateRowsRangePart(left,sheet,base,step,1);right=this.updateRowsRangePart(right,sheet,base,step,-1);if(left==="#REF"||right==="#REF"){return"#REF";}
const rowLeft=toCartesian(left)[1];const rowRight=toCartesian(right)[1];if(rowLeft>rowRight){return"#REF";}
if(left===right){return left;}
const range=`${left}:${right}`;return sheet?`${sheet}!${range}`:range;};}
allowDispatch(cmd){switch(cmd.type){case"REMOVE_COLUMNS":return this.workbook.sheets[cmd.sheet].cols.length>cmd.columns.length?{status:"SUCCESS"}:{status:"CANCELLED",reason:5};case"REMOVE_ROWS":return this.workbook.sheets[cmd.sheet].rows.length>cmd.rows.length?{status:"SUCCESS"}:{status:"CANCELLED",reason:6};case"CREATE_SHEET":case"DUPLICATE_SHEET":const{visibleSheets,sheets}=this.workbook;return!cmd.name||!visibleSheets.find((id)=>sheets[id].name===cmd.name)?{status:"SUCCESS"}:{status:"CANCELLED",reason:8};case"MOVE_SHEET":const currentIndex=this.workbook.visibleSheets.findIndex((id)=>id===cmd.sheet);if(currentIndex===-1){return{status:"CANCELLED",reason:8};}
return(cmd.direction==="left"&&currentIndex===0)||(cmd.direction==="right"&&currentIndex===this.workbook.visibleSheets.length-1)?{status:"CANCELLED",reason:9}:{status:"SUCCESS"};case"RENAME_SHEET":return this.isRenameAllowed(cmd);case"DELETE_SHEET_CONFIRMATION":case"DELETE_SHEET":return this.workbook.visibleSheets.length>1?{status:"SUCCESS"}:{status:"CANCELLED",reason:7};default:return{status:"SUCCESS"};}}
handle(cmd){switch(cmd.type){case"ACTIVATE_SHEET":this.history.updateState(["activeSheet"],this.workbook.sheets[cmd.to]);break;case"CREATE_SHEET":const sheet=this.createSheet(cmd.id,cmd.name||this.generateSheetName(),cmd.cols||26,cmd.rows||100);this.sheetIds[this.workbook.sheets[sheet].name]=sheet;if(cmd.activate){this.dispatch("ACTIVATE_SHEET",{from:this.workbook.activeSheet.id,to:sheet});}
break;case"MOVE_SHEET":this.moveSheet(cmd.sheet,cmd.direction);break;case"RENAME_SHEET":if(cmd.interactive){this.interactiveRenameSheet(cmd.sheet,_lt("Rename Sheet"));}
else{this.renameSheet(cmd.sheet,cmd.name);}
break;case"DUPLICATE_SHEET":this.duplicateSheet(cmd.sheet,cmd.id,cmd.name);break;case"DELETE_SHEET_CONFIRMATION":this.interactiveDeleteSheet(cmd.sheet);break;case"DELETE_SHEET":this.deleteSheet(cmd.sheet);break;case"DELETE_CONTENT":this.clearZones(cmd.sheet,cmd.target);break;case"SET_VALUE":const[col,row]=toCartesian(cmd.xc);this.dispatch("UPDATE_CELL",{sheet:cmd.sheetId?cmd.sheetId:this.workbook.activeSheet.id,col,row,content:cmd.text,});break;case"UPDATE_CELL":this.updateCell(cmd.sheet,cmd.col,cmd.row,cmd);break;case"CLEAR_CELL":this.dispatch("UPDATE_CELL",{sheet:cmd.sheet,col:cmd.col,row:cmd.row,content:"",border:0,style:0,format:"",});break;case"AUTORESIZE_COLUMNS":for(let col of cmd.cols){const size=this.getColMaxWidth(col);if(size!==0){this.setColSize(cmd.sheet,col,size+2*MIN_PADDING);}}
break;case"AUTORESIZE_ROWS":for(let col of cmd.rows){const size=this.getRowMaxHeight(col);if(size!==0){this.setRowSize(cmd.sheet,col,size+2*MIN_PADDING);}}
break;case"RESIZE_COLUMNS":for(let col of cmd.cols){this.setColSize(cmd.sheet,col,cmd.size);}
break;case"RESIZE_ROWS":for(let row of cmd.rows){this.setRowSize(cmd.sheet,row,cmd.size);}
break;case"REMOVE_COLUMNS":this.removeColumns(cmd.sheet,cmd.columns);this.history.updateState(["sheets",cmd.sheet,"colNumber"],this.workbook.sheets[cmd.sheet].colNumber-cmd.columns.length);break;case"REMOVE_ROWS":this.removeRows(cmd.sheet,cmd.rows);this.history.updateState(["sheets",cmd.sheet,"rowNumber"],this.workbook.sheets[cmd.sheet].rowNumber-cmd.rows.length);break;case"ADD_COLUMNS":this.addColumns(cmd.sheet,cmd.column,cmd.position,cmd.quantity);this.history.updateState(["activeSheet","colNumber"],this.workbook.activeSheet.colNumber+cmd.quantity);break;case"ADD_ROWS":this.addRows(cmd.sheet,cmd.row,cmd.position,cmd.quantity);this.history.updateState(["activeSheet","rowNumber"],this.workbook.activeSheet.rowNumber+cmd.quantity);break;case"SET_FORMULA_VISIBILITY":this.showFormulas=cmd.show;break;}}
applyOffset(formula,offsetX,offsetY){return rangeTokenize(formula).map((t)=>{if(t.type==="SYMBOL"&&cellReference.test(t.value)){const[xcs,sheetName]=t.value.split("!").reverse();const sheetId=this.getSheetIdByName(sheetName);if(xcs.includes(":")){return this.updateRange(xcs,offsetX,offsetY,sheetId);}
return this.updateReference(xcs,offsetX,offsetY,sheetId);}
return t.value;}).join("");}
getCell(col,row,sheetName){let r;if(!sheetName){r=this.workbook.activeSheet.rows[row];}
else{const sheet=Object.values(this.workbook.sheets).find((x)=>x.name===sheetName);if(sheet){r=sheet.rows[row];}
else{return null;}}
return r?r.cells[col]||null:null;}
getCellText(cell){const value=this.showFormulas?cell.content:cell.value;const shouldFormat=(value||value===0)&&cell.format&&!cell.error&&!cell.pending;const dateTimeFormat=shouldFormat&&cell.format.match(/y|m|d|:/);const numberFormat=shouldFormat&&!dateTimeFormat;switch(typeof value){case"string":return value;case"boolean":return value?"TRUE":"FALSE";case"number":if(dateTimeFormat){return formatDateTime({value},cell.format);}
if(numberFormat){return formatNumber(value,cell.format);}
return formatStandardNumber(value);case"object":if(dateTimeFormat){return formatDateTime(value,cell.format);}
if(numberFormat){return formatNumber(value.value,cell.format);}
if(value&&value.format.match(/y|m|d|:/)){return formatDateTime(value);}
return"0";}
return value.toString();}
zoneToXC(zone){zone=this.getters.expandZone(zone);const topLeft=toXC(zone.left,zone.top);const botRight=toXC(zone.right,zone.bottom);if(topLeft!=botRight&&this.getters.getMainCell(topLeft)!==this.getters.getMainCell(botRight)){return topLeft+":"+botRight;}
return topLeft;}
getActiveSheet(){return this.workbook.activeSheet.id;}
getSheetName(sheetId){return this.workbook.sheets[sheetId]&&this.workbook.sheets[sheetId].name;}
getSheetIdByName(name){return name&&this.sheetIds[name];}
getSheets(){const{visibleSheets,sheets}=this.workbook;return visibleSheets.map((id)=>sheets[id]);}
getCol(sheetId,index){return this.workbook.sheets[sheetId].cols[index];}
getRow(sheetId,index){return this.workbook.sheets[sheetId].rows[index];}
getColCells(col){return this.workbook.activeSheet.rows.reduce((acc,cur)=>(cur.cells[col]?acc.concat(cur.cells[col]):acc),[]);}
getNumberCols(sheetId){return this.workbook.sheets[sheetId].cols.length;}
getNumberRows(sheetId){return this.workbook.sheets[sheetId].rows.length;}
getColsZone(start,end){return{top:0,bottom:this.workbook.activeSheet.rows.length-1,left:start,right:end,};}
getRowsZone(start,end){return{top:start,bottom:end,left:0,right:this.workbook.activeSheet.cols.length-1,};}
getGridSize(){const activeSheet=this.workbook.activeSheet;const height=activeSheet.rows[activeSheet.rows.length-1].end+DEFAULT_CELL_HEIGHT+5;const width=activeSheet.cols[activeSheet.cols.length-1].end+DEFAULT_CELL_WIDTH;return[width,height];}
shouldShowFormulas(){return this.showFormulas;}
getRangeValues(reference,defaultSheetId){const[range,sheetName]=reference.split("!").reverse();const sheetId=sheetName?this.sheetIds[sheetName]:defaultSheetId;return mapCellsInZone(toZone(range),this.workbook.sheets[sheetId],(cell)=>cell.value);}
getRangeFormattedValues(reference,defaultSheetId){const[range,sheetName]=reference.split("!").reverse();const sheetId=sheetName?this.sheetIds[sheetName]:defaultSheetId;return mapCellsInZone(toZone(range),this.workbook.sheets[sheetId],this.getters.getCellText,"");}
getColMaxWidth(index){const cells=this.workbook.activeSheet.rows.reduce((acc,cur)=>(cur.cells[index]?acc.concat(cur.cells[index]):acc),[]);const sizes=cells.map(this.getters.getCellWidth);return Math.max(0,...sizes);}
getRowMaxHeight(index){const cells=Object.values(this.workbook.activeSheet.rows[index].cells);const sizes=cells.map(this.getters.getCellHeight);return Math.max(0,...sizes);}
setColSize(sheetId,index,size){const cols=this.workbook.sheets[sheetId].cols;const col=cols[index];const delta=size-col.size;this.history.updateState(["sheets",sheetId,"cols",index,"size"],size);this.history.updateState(["sheets",sheetId,"cols",index,"end"],col.end+delta);for(let i=index+1;i<cols.length;i++){const col=cols[i];this.history.updateState(["sheets",sheetId,"cols",i,"start"],col.start+delta);this.history.updateState(["sheets",sheetId,"cols",i,"end"],col.end+delta);}}
setRowSize(sheetId,index,size){const rows=this.workbook.sheets[sheetId].rows;const row=rows[index];const delta=size-row.size;this.history.updateState(["sheets",sheetId,"rows",index,"size"],size);this.history.updateState(["sheets",sheetId,"rows",index,"end"],row.end+delta);for(let i=index+1;i<rows.length;i++){const row=rows[i];this.history.updateState(["sheets",sheetId,"rows",i,"start"],row.start+delta);this.history.updateState(["sheets",sheetId,"rows",i,"end"],row.end+delta);}}
removeColumns(sheetID,columns){columns.sort((a,b)=>b-a);for(let column of columns){this.updateColumnsFormulas(column,-1,sheetID);this.moveCellsHorizontally(column,-1,sheetID);this.manageColumnsHeaders(column,-1,sheetID);}}
removeRows(sheetID,rows){rows.sort((a,b)=>b-a);const consecutiveRows=rows.reduce((groups,currentRow,index,rows)=>{if(currentRow-rows[index-1]===-1){const lastGroup=groups[groups.length-1];lastGroup.push(currentRow);}
else{groups.push([currentRow]);}
return groups;},[]);for(let group of consecutiveRows){this.updateRowsFormulas(group[0],-group.length,sheetID);this.moveCellVerticallyBatched(group[group.length-1],group[0],sheetID);group.map((row)=>this.processRowsHeaderDelete(row,sheetID));}}
addColumns(sheetID,column,position,quantity){this.updateColumnsFormulas(position==="before"?column-1:column,quantity,sheetID);this.moveCellsHorizontally(position==="before"?column:column+1,quantity,sheetID);this.manageColumnsHeaders(column,quantity,sheetID);}
addRows(sheetID,row,position,quantity){for(let i=0;i<quantity;i++){this.addEmptyRow();}
this.updateRowsFormulas(position==="before"?row-1:row,quantity,sheetID);this.moveCellsVertically(position==="before"?row:row+1,quantity,sheetID);this.processRowsHeaderAdd(row,quantity);}
moveCellsHorizontally(base,step,sheetID){return this.processCellsToMove((cell)=>cell.col>=base,(cell)=>cell.col!==base||step!==-1,(cell)=>{return{type:"UPDATE_CELL",sheet:sheetID,col:cell.col+step,row:cell.row,content:cell.content,border:cell.border,style:cell.style,format:cell.format,};},sheetID);}
moveCellVerticallyBatched(deleteFromRow,deleteToRow,sheetID){return this.processCellsToMove(({row})=>row>=deleteFromRow,({row})=>row>deleteToRow,(cell)=>{return{type:"UPDATE_CELL",sheet:this.workbook.sheets[sheetID].id,col:cell.col,row:cell.row-(deleteToRow-deleteFromRow+1),content:cell.content,border:cell.border,style:cell.style,format:cell.format,};},sheetID);}
moveCellsVertically(base,step,sheetID){return this.processCellsToMove((cell)=>cell.row>=base,(cell)=>cell.row!==base||step!==-1,(cell)=>{return{type:"UPDATE_CELL",sheet:sheetID,col:cell.col,row:cell.row+step,content:cell.content,border:cell.border,style:cell.style,format:cell.format,};},sheetID);}
manageColumnsHeaders(base,step,sheetID){const cols=[];let start=0;let colIndex=0;const sheet=this.workbook.sheets[sheetID];for(let i in sheet.cols){if(parseInt(i,10)===base){if(step!==-1){const{size}=sheet.cols[colIndex];for(let a=0;a<step;a++){cols.push({name:numberToLetters(colIndex),size,start,end:start+size,});start+=size;colIndex++;}}
else{continue;}}
const{size}=sheet.cols[i];cols.push({name:numberToLetters(colIndex),size,start,end:start+size,});start+=size;colIndex++;}
this.history.updateState(["sheets",sheetID,"cols"],cols);}
processRowsHeaderDelete(index,sheetID){const rows=[];let start=0;let rowIndex=0;const sheet=this.workbook.sheets[sheetID];const cellsQueue=sheet.rows.map((row)=>row.cells);for(let i in sheet.rows){const row=sheet.rows[i];const{size}=row;if(parseInt(i,10)===index){continue;}
rowIndex++;rows.push({start,end:start+size,size,cells:cellsQueue.shift(),name:String(rowIndex),});start+=size;}
this.history.updateState(["sheets",sheetID,"rows"],rows);}
processRowsHeaderAdd(index,quantity){const rows=[];let start=0;let rowIndex=0;let sizeIndex=0;const cellsQueue=this.workbook.activeSheet.rows.map((row)=>row.cells);for(let i in this.workbook.activeSheet.rows){const{size}=this.workbook.activeSheet.rows[sizeIndex];if(parseInt(i,10)<index||parseInt(i,10)>=index+quantity){sizeIndex++;}
rowIndex++;rows.push({start,end:start+size,size,cells:cellsQueue.shift(),name:String(rowIndex),});start+=size;}
this.history.updateState(["activeSheet","rows"],rows);}
addEmptyRow(){const lastEnd=this.workbook.activeSheet.rows[this.workbook.activeSheet.rows.length-1].end;const name=(this.workbook.activeSheet.rows.length+1).toString();const newRows=this.workbook.activeSheet.rows.slice();const size=0;newRows.push({start:lastEnd,end:lastEnd+size,size,name,cells:{},});const path=["activeSheet","rows"];this.history.updateState(path,newRows);}
updateColumnsFormulas(base,step,sheetID){return this.visitFormulas(this.workbook.sheets[sheetID].name,(value,sheet)=>{if(value.includes(":")){return this.updateColumnsRange(value,sheet,base,step);}
return this.updateColumnsRef(value,sheet,base,step);});}
updateRowsFormulas(base,step,sheetID){return this.visitFormulas(this.workbook.sheets[sheetID].name,(value,sheet)=>{if(value.includes(":")){return this.updateRowsRange(value,sheet,base,step);}
return this.updateRowsRef(value,sheet,base,step);});}
processCellsToMove(shouldDelete,shouldAdd,buildCellToAdd,sheetId){const deleteCommands=[];const addCommands=[];const sheet=this.workbook.sheets[sheetId];for(let xc in sheet.cells){let cell=sheet.cells[xc];if(shouldDelete(cell)){const[col,row]=toCartesian(xc);deleteCommands.push({type:"CLEAR_CELL",sheet:sheet.id,col,row,});if(shouldAdd(cell)){addCommands.push(buildCellToAdd(cell));}}}
for(let cmd of deleteCommands){this.dispatch(cmd.type,cmd);}
for(let cmd of addCommands){this.dispatch(cmd.type,cmd);}}
updateCell(sheet,col,row,data){const _sheet=this.workbook.sheets[sheet];const current=_sheet.rows[row].cells[col];const xc=(current&&current.xc)||toXC(col,row);const hasContent="content"in data;const dataContent=data.content?data.content.replace(nbspRegexp,""):"";let content=hasContent?dataContent:(current&&current.content)||"";const style="style"in data?data.style:(current&&current.style)||0;const border="border"in data?data.border:(current&&current.border)||0;let format="format"in data?data.format:(current&&current.format)||"";if(!content&&!style&&!border&&!format){if(current){this.history.updateSheet(_sheet,["cells",xc],undefined);this.history.updateSheet(_sheet,["rows",row,"cells",col],undefined);}
return;}
const didContentChange=(!current&&dataContent)||(hasContent&&current&&current.content!==dataContent);let cell;if(current&&!didContentChange){cell={col,row,xc,content,value:current.value,type:current.type};if(cell.type==="formula"){cell.error=current.error;cell.pending=current.pending;cell.formula=current.formula;if(current.async){cell.async=true;}}}
else{let type=content[0]==="="?"formula":"text";let value=content;if(isNumber(content)){value=parseNumber(content);type="number";if(content.includes("%")){format=content.includes(".")?"0.00%":"0%";}}
let date=parseDateTime(content);if(date){type="date";value=date;content=formatDateTime(date);}
const contentUpperCase=content.toUpperCase();if(contentUpperCase==="TRUE"){value=true;}
if(contentUpperCase==="FALSE"){value=false;}
cell={col,row,xc,content,value,type};if(cell.type==="formula"){cell.error=undefined;try{cell.formula=compile(content,sheet,this.sheetIds);cell.async=cell.formula.async;}
catch(e){cell.value="#BAD_EXPR";cell.error=_lt("Invalid Expression");}}}
if(style){cell.style=style;}
if(border){cell.border=border;}
if(format){cell.format=format;}
this.history.updateSheet(_sheet,["cells",xc],cell);this.history.updateSheet(_sheet,["rows",row,"cells",col],cell);}
generateSheetName(){let i=1;const names=this.getSheets().map((s)=>s.name);const baseName=_lt("Sheet");let name=`${baseName}${i}`;while(names.includes(name)){name=`${baseName}${i}`;i++;}
return name;}
createSheet(id,name,cols,rows){const sheet={id,name,cells:{},colNumber:cols,rowNumber:rows,cols:createDefaultCols(cols),rows:createDefaultRows(rows),merges:{},mergeCellMap:{},};const visibleSheets=this.workbook.visibleSheets.slice();const index=visibleSheets.findIndex((id)=>this.workbook.activeSheet.id===id);visibleSheets.splice(index+1,0,sheet.id);const sheets=this.workbook.sheets;this.history.updateState(["visibleSheets"],visibleSheets);this.history.updateState(["sheets"],Object.assign({},sheets,{[sheet.id]:sheet}));return sheet.id;}
moveSheet(sheetId,direction){const visibleSheets=this.workbook.visibleSheets.slice();const currentIndex=visibleSheets.findIndex((id)=>id===sheetId);const sheet=visibleSheets.splice(currentIndex,1);visibleSheets.splice(currentIndex+(direction==="left"?-1:1),0,sheet[0]);this.history.updateState(["visibleSheets"],visibleSheets);}
isRenameAllowed(cmd){if(cmd.interactive){return{status:"SUCCESS"};}
const name=cmd.name&&cmd.name.trim().toLowerCase();if(!name){return{status:"CANCELLED",reason:8};}
return this.workbook.visibleSheets.findIndex((id)=>this.workbook.sheets[id].name.toLowerCase()===name)===-1?{status:"SUCCESS"}:{status:"CANCELLED",reason:8};}
interactiveRenameSheet(sheet,title){const placeholder=this.getSheetName(sheet);this.ui.editText(title,placeholder,(name)=>{if(!name){return;}
const result=this.dispatch("RENAME_SHEET",{sheet,name});const sheetName=this.getSheetName(sheet);if(result.status==="CANCELLED"&&sheetName!==name){this.interactiveRenameSheet(sheet,_lt("Please enter a valid sheet name"));}});}
renameSheet(sheetId,name){const sheet=this.workbook.sheets[sheetId];const oldName=sheet.name;this.history.updateSheet(sheet,["name"],name.trim());const sheetIds=Object.assign({},this.sheetIds);sheetIds[name]=sheet.id;delete sheetIds[oldName];this.history.updateLocalState(["sheetIds"],sheetIds);this.visitAllFormulasSymbols((value)=>{let[val,sheetRef]=value.split("!").reverse();if(sheetRef){sheetRef=getUnquotedSheetName(sheetRef);if(sheetRef===oldName){if(val.includes(":")){return this.updateRange(val,0,0,sheet.id);}
return this.updateReference(val,0,0,sheet.id);}}
return value;});}
duplicateSheet(fromId,toId,toName){const sheet=this.workbook.sheets[fromId];const newSheet=JSON.parse(JSON.stringify(sheet));newSheet.id=toId;newSheet.name=toName;const visibleSheets=this.workbook.visibleSheets.slice();const currentIndex=visibleSheets.findIndex((id)=>id===fromId);visibleSheets.splice(currentIndex+1,0,newSheet.id);this.history.updateState(["visibleSheets"],visibleSheets);this.history.updateState(["sheets"],Object.assign({},this.workbook.sheets,{[newSheet.id]:newSheet}));const sheetIds=Object.assign({},this.sheetIds);sheetIds[newSheet.name]=newSheet.id;this.history.updateLocalState(["sheetIds"],sheetIds);this.dispatch("ACTIVATE_SHEET",{from:this.workbook.activeSheet.id,to:toId});}
interactiveDeleteSheet(sheetId){this.ui.askConfirmation(_lt("Are you sure you want to delete this sheet ?"),()=>{this.dispatch("DELETE_SHEET",{sheet:sheetId});});}
deleteSheet(sheetId){const name=this.workbook.sheets[sheetId].name;const sheets=Object.assign({},this.workbook.sheets);delete sheets[sheetId];this.history.updateState(["sheets"],sheets);const visibleSheets=this.workbook.visibleSheets.slice();const currentIndex=visibleSheets.findIndex((id)=>id===sheetId);visibleSheets.splice(currentIndex,1);this.history.updateState(["visibleSheets"],visibleSheets);const sheetIds=Object.assign({},this.sheetIds);delete sheetIds[name];this.history.updateLocalState(["sheetIds"],sheetIds);this.visitAllFormulasSymbols((value)=>{let[,sheetRef]=value.split("!").reverse();if(sheetRef){sheetRef=getUnquotedSheetName(sheetRef);if(sheetRef===name){return"#REF";}}
return value;});if(this.getActiveSheet()===sheetId){this.dispatch("ACTIVATE_SHEET",{from:sheetId,to:visibleSheets[Math.max(0,currentIndex-1)],});}}
clearZones(sheet,zones){const cells=this.workbook.activeSheet.cells;for(let zone of zones){for(let col=zone.left;col<=zone.right;col++){for(let row=zone.top;row<=zone.bottom;row++){const xc=toXC(col,row);if(xc in cells){this.dispatch("UPDATE_CELL",{sheet,content:"",col,row,});}}}}}
updateRange(symbol,offsetX,offsetY,sheetId){let[left,right]=symbol.split(":");left=this.updateReference(left,offsetX,offsetY,sheetId);right=this.updateReference(right,offsetX,offsetY,sheetId);if(left==="#REF"||right==="#REF"){return"#REF";}
right=right.split("!").pop();return`${left}:${right}`;}
updateReference(symbol,offsetX,offsetY,sheetId,updateFreeze=true){const xc=symbol.replace(/\$/g,"");let[x,y]=toCartesian(xc);const freezeCol=symbol.startsWith("$");const freezeRow=symbol.includes("$",1);x+=freezeCol&&updateFreeze?0:offsetX;y+=freezeRow&&updateFreeze?0:offsetY;if(x<0||x>=this.getters.getNumberCols(sheetId||this.getters.getActiveSheet())||y<0||y>=this.getters.getNumberRows(sheetId||this.getters.getActiveSheet())){return"#REF";}
const sheetName=sheetId&&getComposerSheetName(this.getters.getSheetName(sheetId));return((sheetName?`${sheetName}!`:"")+
(freezeCol?"$":"")+
numberToLetters(x)+
(freezeRow?"$":"")+
String(y+1));}
visitAllFormulasSymbols(cb){for(let sheetId in this.workbook.sheets){const sheet=this.workbook.sheets[sheetId];for(let[xc,cell]of Object.entries(sheet.cells)){if(cell.type==="formula"){const content=rangeTokenize(cell.content).map((t)=>{if(t.type==="SYMBOL"&&cellReference.test(t.value)){return cb(t.value,sheet.id);}
return t.value;}).join("");if(content!==cell.content){const[col,row]=toCartesian(xc);this.dispatch("UPDATE_CELL",{sheet:sheet.id,col,row,content,});}}}}}
visitFormulas(sheetNameToFind,cb){this.visitAllFormulasSymbols((content,sheetId)=>{let[value,sheetRef]=content.split("!").reverse();if(sheetRef){sheetRef=getUnquotedSheetName(sheetRef);if(sheetRef===sheetNameToFind){return cb(value,sheetRef);}}
else if(this.sheetIds[sheetNameToFind]===sheetId){return cb(value,undefined);}
return content;});}
import(data){for(let sheet of data.sheets){this.sheetIds[sheet.name]=sheet.id;}
for(let sheet of data.sheets){this.importSheet(sheet);}
this.workbook.activeSheet=this.workbook.sheets[data.activeSheet];}
importSheet(data){let{sheets,visibleSheets}=this.workbook;const name=data.name||`Sheet${Object.keys(sheets).length + 1}`;const sheet={id:data.id,name:name,cells:{},colNumber:data.colNumber,rowNumber:data.rowNumber,cols:createCols(data.cols||{},data.colNumber),rows:createRows(data.rows||{},data.rowNumber),merges:{},mergeCellMap:{},};visibleSheets=visibleSheets.slice();visibleSheets.push(sheet.id);this.history.updateState(["visibleSheets"],visibleSheets);this.history.updateState(["sheets"],Object.assign({},sheets,{[sheet.id]:sheet}));for(let xc in data.cells){const cell=data.cells[xc];const[col,row]=toCartesian(xc);this.updateCell(data.id,col,row,cell);}}
export(data){data.sheets=this.workbook.visibleSheets.map((id)=>{const sheet=this.workbook.sheets[id];const cells={};for(let[key,cell]of Object.entries(sheet.cells)){cells[key]={content:cell.content,border:cell.border,style:cell.style,format:cell.format,};}
return{id:sheet.id,name:sheet.name,colNumber:sheet.colNumber,rowNumber:sheet.rowNumber,rows:exportRows(sheet.rows),cols:exportCols(sheet.cols),merges:[],cells:cells,conditionalFormats:[],figures:[],};});data.activeSheet=this.workbook.activeSheet.id;}}
CorePlugin.getters=["applyOffset","getColsZone","getRowsZone","getCell","getCellText","zoneToXC","getActiveSheet","getSheetName","getSheetIdByName","getSheets","getCol","getRow","getColCells","getNumberCols","getNumberRows","getGridSize","shouldShowFormulas","getRangeValues","getRangeFormattedValues",];function createDefaultCols(colNumber){const cols=[];let current=0;for(let i=0;i<colNumber;i++){const size=DEFAULT_CELL_WIDTH;const col={start:current,end:current+size,size:size,name:numberToLetters(i),};cols.push(col);current=col.end;}
return cols;}
function createDefaultRows(rowNumber){const rows=[];let current=0;for(let i=0;i<rowNumber;i++){const size=DEFAULT_CELL_HEIGHT;const row={start:current,end:current+size,size:size,name:String(i+1),cells:{},};rows.push(row);current=row.end;}
return rows;}
function createCols(savedCols,colNumber){const cols=[];let current=0;for(let i=0;i<colNumber;i++){const size=savedCols[i]?savedCols[i].size||DEFAULT_CELL_WIDTH:DEFAULT_CELL_WIDTH;const col={start:current,end:current+size,size:size,name:numberToLetters(i),};cols.push(col);current=col.end;}
return cols;}
function createRows(savedRows,rowNumber){const rows=[];let current=0;for(let i=0;i<rowNumber;i++){const size=savedRows[i]?savedRows[i].size||DEFAULT_CELL_HEIGHT:DEFAULT_CELL_HEIGHT;const row={start:current,end:current+size,size:size,name:String(i+1),cells:{},};rows.push(row);current=row.end;}
return rows;}
function exportCols(cols){const exportedCols={};for(let i in cols){const col=cols[i];if(col.size!==DEFAULT_CELL_WIDTH){exportedCols[i]={size:col.size};}}
return exportedCols;}
function exportRows(rows){const exportedRows={};for(let i in rows){const row=rows[i];if(row.size!==DEFAULT_CELL_HEIGHT){exportedRows[i]={size:row.size};}}
return exportedRows;}
class EditionPlugin extends BasePlugin{constructor(){super(...arguments);this.col=0;this.row=0;this.mode="inactive";this.sheet="";this.currentContent="";}
beforeHandle(cmd){switch(cmd.type){case"ACTIVATE_SHEET":if(this.mode!=="selecting"){this.stopEdition();}
break;}}
handle(cmd){switch(cmd.type){case"START_COMPOSER_SELECTION":this.mode="selecting";this.dispatch("SET_SELECTION",{zones:this.getters.getSelectedZones(),anchor:this.getters.getPosition(),});break;case"STOP_COMPOSER_SELECTION":if(this.mode==="selecting"){this.mode="editing";}
break;case"START_EDITION":this.startEdition(cmd.text);break;case"STOP_EDITION":if(cmd.cancel){this.cancelEdition();}
else{this.stopEdition();}
break;case"SET_CURRENT_CONTENT":this.currentContent=cmd.content;break;case"SELECT_CELL":case"MOVE_POSITION":if(this.mode==="editing"){this.stopEdition();}
break;}}
getEditionMode(){return this.mode;}
getCurrentContent(){return this.currentContent;}
getEditionSheet(){return this.sheet;}
startEdition(str){if(!str){const cell=this.getters.getActiveCell();str=cell?cell.content||"":"";}
this.mode="editing";this.currentContent=str||"";this.dispatch("REMOVE_ALL_HIGHLIGHTS");const[col,row]=this.getters.getPosition();this.col=col;this.row=row;this.sheet=this.getters.getActiveSheet();}
stopEdition(){if(this.mode!=="inactive"){this.cancelEdition();let xc=toXC(this.col,this.row);const{mergeCellMap,merges,cells}=this.workbook.activeSheet;if(xc in mergeCellMap){const mergeId=mergeCellMap[xc];xc=merges[mergeId].topLeft;}
let content=this.currentContent;this.currentContent="";const cell=cells[xc];const didChange=cell?cell.content!==content:content!=="";if(!didChange){return;}
const[col,row]=toCartesian(xc);if(content){if(content.startsWith("=")){const tokens=tokenize(content);const left=tokens.filter((t)=>t.type==="LEFT_PAREN").length;const right=tokens.filter((t)=>t.type==="RIGHT_PAREN").length;const missing=left-right;if(missing>0){content+=new Array(missing).fill(")").join("");}}
this.dispatch("UPDATE_CELL",{sheet:this.sheet,col,row,content,});}
else{this.dispatch("UPDATE_CELL",{sheet:this.sheet,content:"",col,row,});}
if(this.getters.getActiveSheet()!==this.sheet){this.dispatch("ACTIVATE_SHEET",{from:this.getters.getActiveSheet(),to:this.sheet});}}}
cancelEdition(){this.mode="inactive";this.dispatch("REMOVE_ALL_HIGHLIGHTS");}}
EditionPlugin.layers=[1];EditionPlugin.getters=["getEditionMode","getCurrentContent","getEditionSheet"];EditionPlugin.modes=["normal","readonly"];function*makeObjectIterator(obj){for(let i in obj){yield obj[i];}}
function*makeSetIterator(set){for(let elem of set){yield elem;}}
const functionMap=functionRegistry.mapping;const LOADING="Loading...";class EvaluationPlugin extends BasePlugin{constructor(workbook,getters,history,dispatch,config){super(workbook,getters,history,dispatch,config);this.isUptodate=new Set();this.loadingCells=0;this.isStarted=false;this.cache={};this.PENDING=new Set();this.WAITING=new Set();this.COMPUTED=new Set();this.evalContext=config.evalContext;}
handle(cmd){switch(cmd.type){case"START":this.evaluate();break;case"UPDATE_CELL":if("content"in cmd){this.isUptodate.clear();}
break;case"EVALUATE_CELLS":if(cmd.onlyWaiting){const cells=new Set(this.WAITING);this.WAITING.clear();this.evaluateCells(makeSetIterator(cells),this.workbook.activeSheet.id);}
else{this.WAITING.clear();this.evaluate();}
this.isUptodate.add(this.workbook.activeSheet.id);break;case"UNDO":case"REDO":this.isUptodate.clear();break;}}
finalize(){if(!this.isUptodate.has(this.workbook.activeSheet.id)){this.evaluate();this.isUptodate.add(this.workbook.activeSheet.id);}
if(this.loadingCells>0){this.startScheduler();}}
evaluateFormula(formula,sheet=this.workbook.activeSheet.id){const cacheKey=`${sheet}#${formula}`;let compiledFormula;if(cacheKey in this.cache){compiledFormula=this.cache[cacheKey];}
else{let sheetIds={};const{sheets}=this.workbook;for(let sheetId in sheets){sheetIds[sheets[sheetId].name]=sheetId;}
compiledFormula=compile(formula,sheet,sheetIds);this.cache[cacheKey]=compiledFormula;}
const params=this.getFormulaParameters(()=>{});return compiledFormula(...params);}
isIdle(){return this.loadingCells===0;}
startScheduler(){if(!this.isStarted){this.isStarted=true;let current=this.loadingCells;const recomputeCells=()=>{if(this.loadingCells!==current){this.dispatch("EVALUATE_CELLS",{onlyWaiting:true});current=this.loadingCells;if(current===0){this.isStarted=false;}}
if(current>0){window.setTimeout(recomputeCells,15);}};window.setTimeout(recomputeCells,5);}}
evaluate(){this.COMPUTED.clear();this.evaluateCells(makeObjectIterator(this.workbook.activeSheet.cells),this.workbook.activeSheet.id);}
evaluateCells(cells,sheetId){const self=this;const{COMPUTED,PENDING,WAITING}=this;const params=this.getFormulaParameters(computeValue);const visited={};for(let cell of cells){computeValue(cell,sheetId);}
function handleError(e,cell){if(!(e instanceof Error)){e=new Error(e);}
if(PENDING.has(cell)){PENDING.delete(cell);self.loadingCells--;}
if(e.message==="not ready"){WAITING.add(cell);cell.pending=true;cell.value=LOADING;}
else if(!cell.error){cell.value="#ERROR";const __lastFnCalled=params[2].__lastFnCalled||"";cell.error=e.message.replace("[[FUNCTION_NAME]]",__lastFnCalled);}}
function computeValue(cell,sheetId){if(cell.type!=="formula"||!cell.formula){return;}
const xc=cell.xc;visited[sheetId]=visited[sheetId]||{};if(xc in visited[sheetId]){if(visited[sheetId][xc]===null){cell.value="#CYCLE";cell.error=_lt("Circular reference");}
return;}
if(COMPUTED.has(cell)||PENDING.has(cell)){return;}
visited[sheetId][xc]=null;cell.error=undefined;try{if(cell.async){cell.value=LOADING;cell.pending=true;PENDING.add(cell);cell.formula(...params).then((val)=>{cell.value=val;self.loadingCells--;if(PENDING.has(cell)){PENDING.delete(cell);cell.pending=false;COMPUTED.add(cell);}}).catch((e)=>handleError(e,cell));self.loadingCells++;}
else{cell.value=cell.formula(...params);cell.pending=false;}
cell.error=undefined;}
catch(e){handleError(e,cell);}
visited[sheetId][xc]=true;}}
getFormulaParameters(computeValue){const evalContext=Object.assign(Object.create(functionMap),this.evalContext,{getters:this.getters,});const sheets=this.workbook.sheets;const PENDING=this.PENDING;function readCell(xc,sheet){let cell;const s=sheets[sheet];if(s){cell=s.cells[xc];}
else{throw new Error(_lt("Invalid sheet name"));}
if(!cell||cell.content===""){return null;}
return getCellValue(cell,sheet);}
function getCellValue(cell,sheetId){if(cell.async&&cell.error&&!PENDING.has(cell)){throw new Error(_lt("This formula depends on invalid values"));}
computeValue(cell,sheetId);if(cell.error){throw new Error(_lt("This formula depends on invalid values"));}
if(cell.value===LOADING){throw new Error("not ready");}
return cell.value;}
function range(v1,v2,sheetId){const sheet=sheets[sheetId];let[left,top]=toCartesian(v1);let[right,bottom]=toCartesian(v2);right=Math.min(right,sheet.colNumber-1);bottom=Math.min(bottom,sheet.rowNumber-1);const zone={left,top,right,bottom};return mapCellsInZone(zone,sheet,(cell)=>getCellValue(cell,sheetId));}
return[readCell,range,evalContext];}}
EvaluationPlugin.getters=["evaluateFormula","isIdle"];EvaluationPlugin.modes=["normal","readonly"];const fontSizes=[{pt:7.5,px:10},{pt:8,px:11},{pt:9,px:12},{pt:10,px:13},{pt:10.5,px:14},{pt:11,px:15},{pt:12,px:16},{pt:14,px:18.7},{pt:15,px:20},{pt:16,px:21.3},{pt:18,px:24},{pt:22,px:29.3},{pt:24,px:32},{pt:26,px:34.7},{pt:36,px:48},];const fontSizeMap={};for(let font of fontSizes){fontSizeMap[font.pt]=font.px;}
const commandToSides={top:["top"],left:["left"],right:["right"],bottom:["bottom"],all:["top","left","bottom","right"],};const DEFAULT_STYLE={fillColor:"white",textColor:"black",fontSize:11,};function getTargetZone(zone,side){const{left,right,top,bottom}=zone;switch(side){case"left":return{left,top,right:left,bottom};case"top":return{left,top,right,bottom:top};case"right":return{left:right,top,right,bottom};case"bottom":return{left,top:bottom,right,bottom};}
return zone;}
class FormattingPlugin extends BasePlugin{constructor(){super(...arguments);this.ctx=document.createElement("canvas").getContext("2d");this.styles={};this.borders={};this.nextId=1;}
handle(cmd){switch(cmd.type){case"SET_FORMATTING":if(cmd.style){this.setStyle(cmd.sheet,cmd.target,cmd.style);}
if(cmd.border){this.setBorder(cmd.sheet,cmd.target,cmd.border);}
break;case"CLEAR_FORMATTING":this.clearFormatting(cmd.target);break;case"SET_FORMATTER":this.setFormatter(cmd.sheet,cmd.target,cmd.formatter);break;case"SET_DECIMAL":this.setDecimal(cmd.sheet,cmd.target,cmd.step);break;case"ADD_COLUMNS":const start_col=cmd.position==="before"?cmd.column-1:cmd.column;const end_col=start_col+cmd.quantity+1;this.onAddElements(start_col,end_col,true,cmd.position==="before");break;case"ADD_ROWS":const start_row=cmd.position==="before"?cmd.row-1:cmd.row;const end_row=start_row+cmd.quantity+1;this.onAddElements(start_row,end_row,false,cmd.position==="before");break;}}
getCellWidth(cell){const styleId=cell.style||0;const text=this.getters.getCellText(cell);return this.getTextWidth(text,styleId);}
getTextWidth(text,styleId=0){const style=this.styles[styleId];const italic=style.italic?"italic ":"";const weight=style.bold?"bold":DEFAULT_FONT_WEIGHT;const sizeInPt=style.fontSize||DEFAULT_FONT_SIZE;const size=fontSizeMap[sizeInPt];this.ctx.font=`${italic}${weight} ${size}px ${DEFAULT_FONT}`;return this.ctx.measureText(text).width;}
getCellHeight(cell){const style=this.styles[cell?cell.style||0:0];const sizeInPt=style.fontSize||DEFAULT_FONT_SIZE;return fontSizeMap[sizeInPt];}
getCellStyle(cell){return cell.style?this.styles[cell.style]:{};}
getCellBorder(cell){return cell.border?this.borders[cell.border]:null;}
getCurrentStyle(){const cell=this.getters.getActiveCell();return cell&&cell.style?this.styles[cell.style]:{};}
setStyle(sheet,target,style){for(let zone of target){for(let col=zone.left;col<=zone.right;col++){for(let row=zone.top;row<=zone.bottom;row++){this.setStyleToCell(col,row,style);}}}}
setStyleToCell(col,row,style){const cell=this.getters.getCell(col,row);const currentStyle=cell&&cell.style?this.styles[cell.style]:{};const nextStyle=Object.assign({},currentStyle,style);const id=this.registerStyle(nextStyle);this.dispatch("UPDATE_CELL",{sheet:this.workbook.activeSheet.id,col,row,style:id,});}
registerStyle(style){const strStyle=stringify(style);for(let k in this.styles){if(stringify(this.styles[k])===strStyle){return parseInt(k,10);}}
const id=this.nextId++;this.styles[id]=style;return id;}
setBorder(sheet,zones,command){const borderMap={};for(let zone of zones){this.aggregateBorderCommands(sheet,zone,command,borderMap);}
for(let[xc,borderId]of Object.entries(borderMap)){const[col,row]=toCartesian(xc);const cell=this.getters.getCell(col,row);const current=(cell&&cell.border)||0;if(current!==borderId){this.dispatch("UPDATE_CELL",{sheet:sheet,col,row,border:borderId,});}}}
aggregateBorderCommands(sheet,zone,command,borderMap){if(command==="clear"){for(let row=zone.top;row<=zone.bottom;row++){for(let col=zone.left;col<=zone.right;col++){this.clearBorder(sheet,col,row,borderMap);}}
return;}
if(command==="external"){this.aggregateBorderCommands(sheet,zone,"left",borderMap);this.aggregateBorderCommands(sheet,zone,"right",borderMap);this.aggregateBorderCommands(sheet,zone,"top",borderMap);this.aggregateBorderCommands(sheet,zone,"bottom",borderMap);return;}
if(command==="hv"){this.aggregateBorderCommands(sheet,zone,"h",borderMap);this.aggregateBorderCommands(sheet,zone,"v",borderMap);return;}
const{left,top,right,bottom}=zone;if(command==="h"){for(let r=top+1;r<=bottom;r++){this.aggregateBorderCommands(sheet,{left,top:r,right,bottom:r},"top",borderMap);}
return;}
if(command==="v"){for(let c=left+1;c<=right;c++){this.aggregateBorderCommands(sheet,{left:c,top,right:c,bottom},"left",borderMap);}
return;}
const border={};for(let side of commandToSides[command]){border[side]=["thin","#000"];}
const target=getTargetZone(zone,command);for(let row=target.top;row<=target.bottom;row++){for(let col=target.left;col<=target.right;col++){this.setBorderToMap(sheet,col,row,border,borderMap);}}}
clearBorder(sheet,col,row,borderMap){const cell=this.getters.getCell(col,row);const xc=cell?cell.xc:toXC(col,row);borderMap[xc]=0;if(col>0){this.clearSide(sheet,col-1,row,"right",borderMap);}
if(row>0){this.clearSide(sheet,col,row-1,"bottom",borderMap);}
if(col<this.workbook.activeSheet.cols.length-1){this.clearSide(sheet,col+1,row,"left",borderMap);}
if(row<this.workbook.activeSheet.rows.length-1){this.clearSide(sheet,col,row+1,"top",borderMap);}}
clearSide(sheet,col,row,side,borderMap){const cell=this.getters.getCell(col,row);const xc=cell?cell.xc:toXC(col,row);const currentBorderId=xc in borderMap?borderMap[xc]:cell&&cell.border?cell.border:0;const currentBorder=this.borders[currentBorderId]||{};if(side in currentBorder){const newBorder=Object.assign({},currentBorder);delete newBorder[side];borderMap[xc]=this.registerBorder(newBorder);}}
setBorderToMap(sheet,col,row,border,borderMap){const cell=this.getters.getCell(col,row);const xc=cell?cell.xc:toXC(col,row);const currentBorderId=xc in borderMap?borderMap[xc]:cell&&cell.border?cell.border:0;const currentBorder=this.borders[currentBorderId]||{};const nextBorder=Object.assign({},currentBorder,border);const id=this.registerBorder(nextBorder);borderMap[xc]=id;}
registerBorder(border){if(!Object.keys(border).length){return 0;}
const strBorder=stringify(border);for(let k in this.borders){if(stringify(this.borders[k])===strBorder){return parseInt(k,10);}}
const id=this.nextId++;this.borders[id]=border;return id;}
clearFormatting(zones){for(let zone of zones){for(let col=zone.left;col<=zone.right;col++){for(let row=zone.top;row<=zone.bottom;row++){this.dispatch("UPDATE_CELL",{sheet:this.workbook.activeSheet.id,col,row,style:0,border:0,});}}}}
setFormatter(sheet,zones,format){for(let zone of zones){for(let row=zone.top;row<=zone.bottom;row++){for(let col=zone.left;col<=zone.right;col++){this.dispatch("UPDATE_CELL",{sheet,col,row,format,});}}}}
setDecimal(sheet,zones,step){const numberFormat=this.searchNumberFormat(zones);if(numberFormat!==undefined){const newFormat=this.changeDecimalFormat(numberFormat,step);this.setFormatter(sheet,zones,newFormat);}}
searchNumberFormat(zones){for(let zone of zones){for(let row=zone.top;row<=zone.bottom;row++){for(let col=zone.left;col<=zone.right;col++){const cell=this.getters.getCell(col,row);if(cell&&(cell.type==="number"||(cell.type==="formula"&&typeof cell.value==="number"))){return cell.format||this.setDefaultNumberFormat(cell.value);}}}}
return undefined;}
setDefaultNumberFormat(cellValue){const strValue=cellValue.toString();const parts=strValue.split(".");if(parts.length===1){return"0";}
return"0."+Array(parts[1].length+1).join("0");}
changeDecimalFormat(format,step){const sign=Math.sign(step);const subFormats=format.split(";");let newSubFormats=[];for(let subFormat of subFormats){const decimalPointPosition=subFormat.indexOf(".");const exponentPosition=subFormat.toUpperCase().indexOf("E");let newSubFormat;const subPart=exponentPosition>-1?subFormat.slice(0,exponentPosition):subFormat;const zerosAfterDecimal=decimalPointPosition>-1?subPart.slice(decimalPointPosition).match(/0/g).length:0;const lastZeroPosition=subPart.lastIndexOf("0");if(lastZeroPosition>-1){if(sign>0){if(zerosAfterDecimal<maximumDecimalPlaces){newSubFormat=subFormat.slice(0,lastZeroPosition+1)+
(zerosAfterDecimal===0?".0":"0")+
subFormat.slice(lastZeroPosition+1);}
else{newSubFormat=subFormat;}}
else{if(zerosAfterDecimal>0){newSubFormat=subFormat.slice(0,lastZeroPosition)+subFormat.slice(lastZeroPosition+1);if(zerosAfterDecimal===1){newSubFormat=newSubFormat.slice(0,decimalPointPosition)+
newSubFormat.slice(decimalPointPosition+1);}}
else{newSubFormat=subFormat;}}}
else{newSubFormat=subFormat;}
newSubFormats.push(newSubFormat);}
return newSubFormats.join(";");}
onAddElements(start,end,isColumn,upper){const length=isColumn?this.workbook.activeSheet.rows.length:this.workbook.activeSheet.cols.length;const index=start+1;for(let x=0;x<length;x++){const xc=isColumn?toXC(index,x):toXC(x,index);if(this.getters.isInMerge(xc)){continue;}
const format={};let lowerFormat=isColumn?this.getFormat(toXC(start,x)):this.getFormat(toXC(x,start));let upperFormat=isColumn?this.getFormat(toXC(end,x)):this.getFormat(toXC(x,end));if(upper){if(upperFormat.style){format["style"]=upperFormat.style;}
if(upperFormat.format){format["format"]=upperFormat.format;}}
else{if(lowerFormat.style){format["style"]=lowerFormat.style;}
if(lowerFormat.format){format["format"]=lowerFormat.format;}}
if(upperFormat.border&&upperFormat.border===lowerFormat.border){format["border"]=upperFormat.border;}
if(Object.keys(format).length!==0){for(let i=index;i<end;i++){this.dispatch("UPDATE_CELL",{sheet:this.workbook.activeSheet.id,col:isColumn?i:x,row:isColumn?x:i,style:format.style,border:format.border,format:format.format,});}}}}
getFormat(xc){const format={};xc=this.getters.getMainCell(xc);if(xc in this.workbook.activeSheet.cells){if(this.workbook.activeSheet.cells[xc].border){format["border"]=this.workbook.activeSheet.cells[xc].border;}
if(this.workbook.activeSheet.cells[xc].style){format["style"]=this.workbook.activeSheet.cells[xc].style;}
if(this.workbook.activeSheet.cells[xc].format){format["format"]=this.workbook.activeSheet.cells[xc].format;}}
return format;}
import(data){if(data.styles){this.styles=data.styles;}
this.styles[0]=Object.assign({},DEFAULT_STYLE,this.styles[0]);if(data.borders){this.borders=data.borders;}
let nextId=1;for(let k in this.styles){nextId=Math.max(k,nextId);}
for(let k in this.borders){nextId=Math.max(k,nextId);}
this.nextId=nextId+1;}
export(data){data.styles=this.styles;data.borders=this.borders;}}
FormattingPlugin.getters=["getCurrentStyle","getCellWidth","getTextWidth","getCellHeight","getCellStyle","getCellBorder",];class MergePlugin extends BasePlugin{constructor(){super(...arguments);this.nextId=1;this.pending=null;}
allowDispatch(cmd){const force="force"in cmd?!!cmd.force:false;switch(cmd.type){case"PASTE":return this.isPasteAllowed(cmd.target,force);case"ADD_MERGE":return this.isMergeAllowed(cmd.zone,force);default:return{status:"SUCCESS"};}}
beforeHandle(cmd){switch(cmd.type){case"REMOVE_COLUMNS":this.exportAndRemoveMerges(cmd.sheet,(range)=>updateRemoveColumns(range,cmd.columns),true);break;case"REMOVE_ROWS":this.exportAndRemoveMerges(cmd.sheet,(range)=>updateRemoveRows(range,cmd.rows),false);break;case"ADD_COLUMNS":const col=cmd.position==="before"?cmd.column:cmd.column+1;this.exportAndRemoveMerges(cmd.sheet,(range)=>updateAddColumns(range,col,cmd.quantity),true);break;case"ADD_ROWS":const row=cmd.position==="before"?cmd.row:cmd.row+1;this.exportAndRemoveMerges(cmd.sheet,(range)=>updateAddRows(range,row,cmd.quantity),false);break;}}
handle(cmd){switch(cmd.type){case"ADD_MERGE":if(cmd.interactive){this.interactiveMerge(cmd.sheet,cmd.zone);}
else{this.addMerge(cmd.sheet,cmd.zone);}
break;case"REMOVE_MERGE":this.removeMerge(cmd.sheet,cmd.zone);break;case"AUTOFILL_CELL":this.autoFillMerge(cmd.originCol,cmd.originRow,cmd.col,cmd.row);break;case"PASTE_CELL":const xc=toXC(cmd.originCol,cmd.originRow);if(this.isMainCell(xc,cmd.sheet)){this.duplicateMerge(xc,cmd.col,cmd.row,cmd.sheet,cmd.cut);}
break;}
if(this.pending){this.importMerges(this.pending.sheet,this.pending.merges);this.history.updateLocalState(["pending"],null);}}
isMergeDestructive(zone){const{left,right,top,bottom}=zone;for(let row=top;row<=bottom;row++){const actualRow=this.workbook.activeSheet.rows[row];for(let col=left;col<=right;col++){if(col!==left||row!==top){const cell=actualRow.cells[col];if(cell&&cell.content){return true;}}}}
return false;}
doesIntersectMerge(zone){const{left,right,top,bottom}=zone;for(let row=top;row<=bottom;row++){for(let col=left;col<=right;col++){const cellXc=toXC(col,row);if(this.workbook.activeSheet.mergeCellMap[cellXc]){return true;}}}
return false;}
expandZone(zone){let{left,right,top,bottom}=zone;const sheet=this.workbook.activeSheet;let result={left,right,top,bottom};for(let id in sheet.merges){const merge=sheet.merges[id];if(overlap(merge,result)){result=union(merge,result);}}
return isEqual(result,zone)?result:this.expandZone(result);}
isInMerge(xc){return xc in this.workbook.activeSheet.mergeCellMap;}
isMainCell(xc,sheetId){const merges=this.workbook.sheets[sheetId].merges;for(let key in merges){if(merges[key].topLeft===xc){return true;}}
return false;}
getMainCell(xc){if(!this.isInMerge(xc)){return xc;}
const sheet=this.workbook.activeSheet;const merge=sheet.mergeCellMap[xc];return sheet.merges[merge].topLeft;}
isMergeAllowed(zone,force){if(!force){if(this.isMergeDestructive(zone)){return{status:"CANCELLED",reason:2,};}}
return{status:"SUCCESS",};}
addMerge(sheetId,zone){const sheet=this.workbook.sheets[sheetId];const{left,right,top,bottom}=zone;let tl=toXC(left,top);let br=toXC(right,bottom);if(tl===br){return;}
let id=this.nextId++;this.history.updateState(["sheets",sheetId,"merges",id],{id,left,top,right,bottom,topLeft:tl,});let previousMerges=new Set();for(let row=top;row<=bottom;row++){for(let col=left;col<=right;col++){const xc=toXC(col,row);if(col!==left||row!==top){this.dispatch("CLEAR_CELL",{sheet:sheetId,col,row,});}
if(sheet.mergeCellMap[xc]){previousMerges.add(sheet.mergeCellMap[xc]);}
this.history.updateState(["sheets",sheetId,"mergeCellMap",xc],id);}}
for(let m of previousMerges){const{top,bottom,left,right}=sheet.merges[m];for(let r=top;r<=bottom;r++){for(let c=left;c<=right;c++){const xc=toXC(c,r);if(sheet.mergeCellMap[xc]!==id){this.history.updateState(["sheets",sheetId,"mergeCellMap",xc],undefined);this.dispatch("CLEAR_CELL",{sheet:sheetId,col:c,row:r,});}}}
this.history.updateState(["sheets",sheetId,"merges",m],undefined);}}
removeMerge(sheetId,zone){const{left,top,bottom,right}=zone;let tl=toXC(left,top);const mergeId=this.workbook.sheets[sheetId].mergeCellMap[tl];const mergeZone=this.workbook.sheets[sheetId].merges[mergeId];if(!isEqual(zone,mergeZone)){throw new Error(_lt("Invalid merge zone"));}
this.history.updateState(["sheets",sheetId,"merges",mergeId],undefined);for(let r=top;r<=bottom;r++){for(let c=left;c<=right;c++){const xc=toXC(c,r);this.history.updateState(["sheets",sheetId,"mergeCellMap",xc],undefined);}}}
interactiveMerge(sheet,zone){const result=this.dispatch("ADD_MERGE",{sheet,zone});if(result.status==="CANCELLED"){if(result.reason===2){this.ui.askConfirmation(_lt("Merging these cells will only preserve the top-leftmost value. Merge anyway?"),()=>{this.dispatch("ADD_MERGE",{sheet,zone,force:true});});}}}
duplicateMerge(xc,col,row,sheetId,cut){const mergeId=this.workbook.sheets[sheetId].mergeCellMap[xc];const merge=this.workbook.sheets[sheetId].merges[mergeId];const colNumber=this.getters.getNumberCols(sheetId)-1;const rowNumber=this.getters.getNumberRows(sheetId)-1;const newMerge={left:col,top:row,right:clip(col+merge.right-merge.left,0,colNumber),bottom:clip(row+merge.bottom-merge.top,0,rowNumber),};if(cut){this.dispatch("REMOVE_MERGE",{sheet:sheetId,zone:merge,});}
this.dispatch("ADD_MERGE",{sheet:this.workbook.activeSheet.id,zone:newMerge,});}
removeAllMerges(sheetId){const sheet=this.workbook.sheets[sheetId];for(let id in sheet.merges){this.history.updateState(["sheets",sheetId,"merges",id],undefined);}
for(let id in sheet.mergeCellMap){this.history.updateState(["sheets",sheetId,"mergeCellMap",id],undefined);}}
exportAndRemoveMerges(sheetId,updater,isCol){const sheet=this.workbook.sheets[sheetId];const merges=exportMerges(sheet.merges);const updatedMerges=[];for(let m of merges){const update=updater(m);if(update){const[tl,br]=update.split(":");if(tl!==br){updatedMerges.push(update);}}}
this.updateMergesStyles(sheetId,isCol);this.removeAllMerges(sheetId);this.history.updateLocalState(["pending"],{sheet:sheetId,merges:updatedMerges});}
updateMergesStyles(sheetId,isColumn){const sheet=this.workbook.sheets[sheetId];for(let merge of Object.values(sheet.merges)){const xc=merge.topLeft;const topLeft=sheet.cells[xc];if(!topLeft){continue;}
let[x,y]=toCartesian(xc);if(isColumn&&merge.left!==merge.right){x+=1;}
if(!isColumn&&merge.top!==merge.bottom){y+=1;}
this.dispatch("UPDATE_CELL",{sheet:sheet.id,col:x,row:y,style:topLeft.style,border:topLeft.border,format:topLeft.format,});}}
isPasteAllowed(target,force){if(!force){const pasteZones=this.getters.getPasteZones(target);for(let zone of pasteZones){if(this.doesIntersectMerge(zone)){return{status:"CANCELLED",reason:1,};}}}
return{status:"SUCCESS",};}
autoFillMerge(originCol,originRow,col,row){const xcOrigin=toXC(originCol,originRow);const xcTarget=toXC(col,row);const sheet=this.getters.getActiveSheet();if(this.isInMerge(xcTarget)&&!this.isInMerge(xcOrigin)){const mergeId=this.workbook.sheets[sheet].mergeCellMap[xcTarget];const zone=this.workbook.sheets[sheet].merges[mergeId];this.dispatch("REMOVE_MERGE",{sheet,zone,});}
if(this.isMainCell(xcOrigin,sheet)){this.duplicateMerge(xcOrigin,col,row,sheet);}}
import(data){const sheets=data.sheets||[];for(let sheetData of sheets){const sheet=this.workbook.sheets[sheetData.id];if(sheet&&sheetData.merges){this.importMerges(sheet.id,sheetData.merges);}}}
importMerges(sheetId,merges){for(let m of merges){let id=this.nextId++;const[tl,br]=m.split(":");const[left,top]=toCartesian(tl);const[right,bottom]=toCartesian(br);this.history.updateState(["sheets",sheetId,"merges",id],{id,left,top,right,bottom,topLeft:tl,});for(let row=top;row<=bottom;row++){for(let col=left;col<=right;col++){const xc=toXC(col,row);this.history.updateState(["sheets",sheetId,"mergeCellMap",xc],id);}}}}
export(data){for(let sheetData of data.sheets){const sheet=this.workbook.sheets[sheetData.id];sheetData.merges.push(...exportMerges(sheet.merges));}}}
MergePlugin.getters=["isMergeDestructive","isInMerge","getMainCell","expandZone","doesIntersectMerge",];function exportMerges(merges){return Object.values(merges).map((merge)=>toXC(merge.left,merge.top)+":"+toXC(merge.right,merge.bottom));}
function computeAlign(cell,isShowingFormulas){if(cell.type==="formula"&&isShowingFormulas){return"left";}
else if(cell.error||cell.pending){return"center";}
switch(typeof cell.value){case"object":case"number":return"right";case"boolean":return"center";default:return"left";}}
function searchIndex(headers,offset){let left=0;let right=headers.length-1;while(left<=right){const index=Math.floor((left+right)/2);const header=headers[index];if(offset<header.start){right=index-1;}
else if(offset>header.end){left=index+1;}
else{return index;}}
return-1;}
class RendererPlugin extends BasePlugin{constructor(){super(...arguments);this.boxes=[];}
getColIndex(x,left){if(x<HEADER_WIDTH){return-1;}
const cols=this.workbook.activeSheet.cols;const adjustedX=x-HEADER_WIDTH+cols[left].start+1;return searchIndex(cols,adjustedX);}
getRowIndex(y,top){if(y<HEADER_HEIGHT){return-1;}
const rows=this.workbook.activeSheet.rows;const adjustedY=y-HEADER_HEIGHT+rows[top].start+1;return searchIndex(rows,adjustedY);}
getRect(zone,viewport){const{left,top,right,bottom}=zone;let{offsetY,offsetX}=viewport;offsetX-=HEADER_WIDTH;offsetY-=HEADER_HEIGHT;const{cols,rows}=this.workbook.activeSheet;const x=Math.max(cols[left].start-offsetX,HEADER_WIDTH);const width=cols[right].end-offsetX-x;const y=Math.max(rows[top].start-offsetY,HEADER_HEIGHT);const height=rows[bottom].end-offsetY-y;return[x,y,width,height];}
snapViewportToCell(viewport){const{cols,rows}=this.workbook.activeSheet;const adjustedViewport=Object.assign({},viewport);adjustedViewport.offsetX=cols[viewport.left].start;adjustedViewport.offsetY=rows[viewport.top].start;return adjustedViewport;}
adjustViewportPosition(viewport){const adjustedViewport=Object.assign({},viewport);const{cols,rows}=this.workbook.activeSheet;const[col,row]=this.getters.getPosition();while(col>=adjustedViewport.right&&col!==cols.length-1){adjustedViewport.offsetX=cols[adjustedViewport.left].end;this.adjustViewportZoneX(adjustedViewport);}
while(col<adjustedViewport.left){adjustedViewport.offsetX=cols[adjustedViewport.left-1].start;this.adjustViewportZoneX(adjustedViewport);}
while(row>=adjustedViewport.bottom&&row!==rows.length-1){adjustedViewport.offsetY=rows[adjustedViewport.top].end;this.adjustViewportZoneY(adjustedViewport);}
while(row<adjustedViewport.top){adjustedViewport.offsetY=rows[adjustedViewport.top-1].start;this.adjustViewportZoneY(adjustedViewport);}
return adjustedViewport;}
adjustViewportZone(viewport){const adjustedViewport=Object.assign({},viewport);this.adjustViewportZoneX(adjustedViewport);this.adjustViewportZoneY(adjustedViewport);return adjustedViewport;}
adjustViewportZoneX(viewport){const{cols}=this.workbook.activeSheet;const{width,offsetX}=viewport;viewport.left=this.getColIndex(offsetX+HEADER_WIDTH,0);const x=width+offsetX-HEADER_WIDTH;viewport.right=cols.length-1;for(let i=viewport.left;i<cols.length;i++){if(x<cols[i].end){viewport.right=i;break;}}}
adjustViewportZoneY(viewport){const{rows}=this.workbook.activeSheet;const{height,offsetY}=viewport;viewport.top=this.getRowIndex(offsetY+HEADER_HEIGHT,0);let y=height+offsetY-HEADER_HEIGHT;viewport.bottom=rows.length-1;for(let i=viewport.top;i<rows.length;i++){if(y<rows[i].end){viewport.bottom=i;break;}}}
drawGrid(renderingContext,layer){switch(layer){case 0:this.boxes=this.getGridBoxes(renderingContext);this.drawBackground(renderingContext);this.drawCellBackground(renderingContext);this.drawBorders(renderingContext);this.drawTexts(renderingContext);break;case 6:this.drawHeaders(renderingContext);break;}}
drawBackground(renderingContext){const{ctx,viewport,thinLineWidth}=renderingContext;let{width,height,offsetX,offsetY,top,left,bottom,right}=viewport;const{rows,cols}=this.workbook.activeSheet;ctx.fillStyle="white";ctx.fillRect(0,0,viewport.width,viewport.height);offsetX-=HEADER_WIDTH;offsetY-=HEADER_HEIGHT;ctx.lineWidth=2*thinLineWidth;ctx.strokeStyle=CELL_BORDER_COLOR;ctx.beginPath();const lineHeight=Math.min(height,rows[bottom].end-offsetY);for(let i=left;i<=right;i++){const x=cols[i].end-offsetX;ctx.moveTo(x,0);ctx.lineTo(x,lineHeight);}
const lineWidth=Math.min(width,cols[right].end-offsetX);for(let i=top;i<=bottom;i++){const y=rows[i].end-offsetY;ctx.moveTo(0,y);ctx.lineTo(lineWidth,y);}
ctx.stroke();}
drawCellBackground(renderingContext){const{ctx,thinLineWidth}=renderingContext;ctx.lineWidth=0.3*thinLineWidth;const inset=0.1*thinLineWidth;ctx.strokeStyle="#111";for(let box of this.boxes){let style=box.style;if(style&&style.fillColor&&style.fillColor!=="#ffffff"){ctx.fillStyle=style.fillColor;ctx.fillRect(box.x,box.y,box.width,box.height);ctx.strokeRect(box.x+inset,box.y+inset,box.width-2*inset,box.height-2*inset);}
if(box.error){ctx.fillStyle="red";ctx.beginPath();ctx.moveTo(box.x+box.width-5,box.y);ctx.lineTo(box.x+box.width,box.y);ctx.lineTo(box.x+box.width,box.y+5);ctx.fill();}}}
drawBorders(renderingContext){const{ctx,thinLineWidth}=renderingContext;for(let box of this.boxes){let border=box.border;if(border){const{x,y,width,height}=box;if(border.left){drawBorder(border.left,x,y,x,y+height);}
if(border.top){drawBorder(border.top,x,y,x+width,y);}
if(border.right){drawBorder(border.right,x+width,y,x+width,y+height);}
if(border.bottom){drawBorder(border.bottom,x,y+height,x+width,y+height);}}}
function drawBorder([style,color],x1,y1,x2,y2){ctx.strokeStyle=color;ctx.lineWidth=(style==="thin"?2:3)*thinLineWidth;ctx.beginPath();ctx.moveTo(x1,y1);ctx.lineTo(x2,y2);ctx.stroke();}}
drawTexts(renderingContext){const{ctx,thinLineWidth}=renderingContext;ctx.textBaseline="middle";let currentFont;for(let box of this.boxes){if(box.text){const style=box.style||{};const align=box.align;const italic=style.italic?"italic ":"";const weight=style.bold?"bold":DEFAULT_FONT_WEIGHT;const sizeInPt=style.fontSize||DEFAULT_FONT_SIZE;const size=fontSizeMap[sizeInPt];const font=`${italic}${weight} ${size}px ${DEFAULT_FONT}`;if(font!==currentFont){currentFont=font;ctx.font=font;}
ctx.fillStyle=style.textColor||"#000";let x;let y=box.y+box.height/2+1;if(align==="left"){x=box.x+3;}
else if(align==="right"){x=box.x+box.width-3;}
else{x=box.x+box.width/2;}
ctx.textAlign=align;if(box.clipRect){ctx.save();ctx.beginPath();ctx.rect(...box.clipRect);ctx.clip();}
ctx.fillText(box.text,Math.round(x),Math.round(y));if(style.strikethrough){if(align==="right"){x=x-box.textWidth;}
else if(align==="center"){x=x-box.textWidth/2;}
ctx.fillRect(x,y,box.textWidth,2.6*thinLineWidth);}
if(box.clipRect){ctx.restore();}}}}
drawHeaders(renderingContext){const{ctx,viewport,thinLineWidth}=renderingContext;let{width,height,offsetX,offsetY,left,top,right,bottom}=viewport;offsetX-=HEADER_WIDTH;offsetY-=HEADER_HEIGHT;const selection=this.getters.getSelectedZones();const{cols,rows}=this.workbook.activeSheet;const activeCols=this.getters.getActiveCols();const activeRows=this.getters.getActiveRows();ctx.fillStyle=BACKGROUND_HEADER_COLOR;ctx.font=`400 ${HEADER_FONT_SIZE}px ${DEFAULT_FONT}`;ctx.textAlign="center";ctx.textBaseline="middle";ctx.lineWidth=thinLineWidth;ctx.strokeStyle="#333";ctx.fillRect(0,0,width,HEADER_HEIGHT);ctx.fillRect(0,0,HEADER_WIDTH,height);ctx.fillStyle=BACKGROUND_HEADER_SELECTED_COLOR;for(let zone of selection){const x1=Math.max(HEADER_WIDTH,cols[zone.left].start-offsetX);const x2=Math.max(HEADER_WIDTH,cols[zone.right].end-offsetX);const y1=Math.max(HEADER_HEIGHT,rows[zone.top].start-offsetY);const y2=Math.max(HEADER_HEIGHT,rows[zone.bottom].end-offsetY);ctx.fillStyle=activeCols.has(zone.left)?BACKGROUND_HEADER_ACTIVE_COLOR:BACKGROUND_HEADER_SELECTED_COLOR;ctx.fillRect(x1,0,x2-x1,HEADER_HEIGHT);ctx.fillStyle=activeRows.has(zone.top)?BACKGROUND_HEADER_ACTIVE_COLOR:BACKGROUND_HEADER_SELECTED_COLOR;ctx.fillRect(0,y1,HEADER_WIDTH,y2-y1);}
ctx.beginPath();ctx.moveTo(HEADER_WIDTH,0);ctx.lineTo(HEADER_WIDTH,height);ctx.moveTo(0,HEADER_HEIGHT);ctx.lineTo(width,HEADER_HEIGHT);ctx.strokeStyle=HEADER_BORDER_COLOR;ctx.stroke();ctx.beginPath();for(let i=left;i<=right;i++){const col=cols[i];ctx.fillStyle=activeCols.has(i)?"#fff":TEXT_HEADER_COLOR;ctx.fillText(col.name,(col.start+col.end)/2-offsetX,HEADER_HEIGHT/2);ctx.moveTo(col.end-offsetX,0);ctx.lineTo(col.end-offsetX,HEADER_HEIGHT);}
for(let i=top;i<=bottom;i++){const row=rows[i];ctx.fillStyle=activeRows.has(i)?"#fff":TEXT_HEADER_COLOR;ctx.fillText(row.name,HEADER_WIDTH/2,(row.start+row.end)/2-offsetY);ctx.moveTo(0,row.end-offsetY);ctx.lineTo(HEADER_WIDTH,row.end-offsetY);}
ctx.stroke();}
hasContent(col,row){const{cells,mergeCellMap}=this.workbook.activeSheet;const xc=toXC(col,row);const cell=cells[xc];return(cell&&cell.content)||(xc in mergeCellMap);}
getGridBoxes(renderingContext){const{viewport}=renderingContext;let{right,left,top,bottom,offsetX,offsetY}=viewport;offsetX-=HEADER_WIDTH;offsetY-=HEADER_HEIGHT;const result=[];const{cols,rows,mergeCellMap,cells,merges}=this.workbook.activeSheet;for(let rowNumber=top;rowNumber<=bottom;rowNumber++){let row=rows[rowNumber];for(let colNumber=left;colNumber<=right;colNumber++){let cell=row.cells[colNumber];if(cell&&!(cell.xc in mergeCellMap)){let col=cols[colNumber];const text=this.getters.getCellText(cell);const textWidth=this.getters.getCellWidth(cell);let style=this.getters.getCellStyle(cell);const conditionalStyle=this.getters.getConditionalStyle(cell.xc);if(conditionalStyle){style=Object.assign({},style,conditionalStyle);}
const align=text?(style&&style.align)||computeAlign(cell,this.getters.shouldShowFormulas()):undefined;let clipRect=null;if(text&&textWidth>cols[cell.col].size){if(align==="left"){let c=cell.col;while(c<right&&!this.hasContent(c+1,cell.row)){c++;}
const width=cols[c].end-col.start;if(width<textWidth){clipRect=[col.start-offsetX,row.start-offsetY,width,row.size];}}
else{let c=cell.col;while(c>left&&!this.hasContent(c-1,cell.row)){c--;}
const width=col.end-cols[c].start;if(width<textWidth){clipRect=[cols[c].start-offsetX,row.start-offsetY,width,row.size];}}}
result.push({x:col.start-offsetX,y:row.start-offsetY,width:col.size,height:row.size,text,textWidth,border:this.getters.getCellBorder(cell),style,align,clipRect,error:cell.error,});}}}
for(let id in merges){let merge=merges[id];if(overlap(merge,viewport)){const refCell=cells[merge.topLeft];const width=cols[merge.right].end-cols[merge.left].start;let text,textWidth,style,align,border;if(refCell){text=refCell?this.getters.getCellText(refCell):"";textWidth=this.getters.getCellWidth(refCell);style=this.getters.getCellStyle(refCell);align=text?(style&&style.align)||computeAlign(refCell,this.getters.shouldShowFormulas()):null;border=this.getters.getCellBorder(refCell);}
style=style||{};if(!style.fillColor||style.fillColor==="#ffffff"){style=Object.create(style);style.fillColor="#fff";}
const x=cols[merge.left].start-offsetX;const y=rows[merge.top].start-offsetY;const height=rows[merge.bottom].end-rows[merge.top].start;result.push({x:x,y:y,width,height,text,textWidth,border,style,align,clipRect:[x,y,width,height],error:refCell?refCell.error:undefined,});}}
return result;}}
RendererPlugin.layers=[0,6];RendererPlugin.getters=["getColIndex","getRowIndex","getRect","snapViewportToCell","adjustViewportPosition","adjustViewportZone",];RendererPlugin.modes=["normal","readonly"];var SelectionMode;(function(SelectionMode){SelectionMode[SelectionMode["idle"]=0]="idle";SelectionMode[SelectionMode["selecting"]=1]="selecting";SelectionMode[SelectionMode["readyToExpand"]=2]="readyToExpand";SelectionMode[SelectionMode["expanding"]=3]="expanding";})(SelectionMode||(SelectionMode={}));class SelectionPlugin extends BasePlugin{constructor(){super(...arguments);this.selection={zones:[{top:0,left:0,bottom:0,right:0}],anchor:[0,0],};this.activeCol=0;this.activeRow=0;this.activeXc="A1";this.mode=SelectionMode.idle;this.sheetsData={};}
allowDispatch(cmd){switch(cmd.type){case"MOVE_POSITION":{const[refCol,refRow]=this.getReferenceCoords();const{cols,rows}=this.workbook.activeSheet;const outOfBound=(cmd.deltaY<0&&refRow===0)||(cmd.deltaY>0&&refRow===rows.length-1)||(cmd.deltaX<0&&refCol===0)||(cmd.deltaX>0&&refCol===cols.length-1);if(outOfBound){return{status:"CANCELLED",reason:10,};}
break;}
case"SELECT_COLUMN":{const{index}=cmd;if(index<0||index>=this.workbook.activeSheet.cols.length){return{status:"CANCELLED",reason:10,};}
break;}
case"SELECT_ROW":{const{index}=cmd;if(index<0||index>=this.workbook.activeSheet.rows.length){return{status:"CANCELLED",reason:10,};}
break;}}
return{status:"SUCCESS",};}
handle(cmd){switch(cmd.type){case"START":this.selectCell(0,0);break;case"ACTIVATE_SHEET":this.sheetsData[cmd.from]={selection:JSON.parse(JSON.stringify(this.selection)),activeCol:this.activeCol,activeRow:this.activeRow,activeXc:this.activeXc,};if(cmd.to in this.sheetsData){Object.assign(this,this.sheetsData[cmd.to]);}
else{this.selectCell(0,0);}
break;case"SET_SELECTION":this.setSelection(cmd.anchor,cmd.zones,cmd.strict);break;case"START_SELECTION":this.mode=SelectionMode.selecting;break;case"PREPARE_SELECTION_EXPANSION":this.mode=SelectionMode.readyToExpand;break;case"START_SELECTION_EXPANSION":this.mode=SelectionMode.expanding;break;case"STOP_SELECTION":this.mode=SelectionMode.idle;break;case"MOVE_POSITION":this.movePosition(cmd.deltaX,cmd.deltaY);break;case"SELECT_CELL":this.selectCell(cmd.col,cmd.row);break;case"SELECT_COLUMN":this.selectColumn(cmd.index,cmd.createRange||false,cmd.updateRange||false);break;case"SELECT_ROW":this.selectRow(cmd.index,cmd.createRange||false,cmd.updateRange||false);break;case"SELECT_ALL":this.selectAll();break;case"ALTER_SELECTION":if(cmd.delta){this.moveSelection(cmd.delta[0],cmd.delta[1]);}
if(cmd.cell){this.addCellToSelection(...cmd.cell);}
break;case"UNDO":case"REDO":case"REMOVE_COLUMNS":case"REMOVE_ROWS":this.updateSelection();break;case"ADD_COLUMNS":if(cmd.position==="before"){this.onAddColumns(cmd.quantity);}
break;case"ADD_ROWS":if(cmd.position==="before"){this.onAddRows(cmd.quantity);}
break;}}
getActiveCell(){const sheet=this.workbook.activeSheet;let mergeId=sheet.mergeCellMap[this.activeXc];if(mergeId){return sheet.cells[sheet.merges[mergeId].topLeft];}
else{return this.getters.getCell(this.activeCol,this.activeRow);}}
getActiveCols(){const activeCols=new Set();for(let zone of this.selection.zones){if(zone.top===0&&zone.bottom===this.workbook.activeSheet.rows.length-1){for(let i=zone.left;i<=zone.right;i++){activeCols.add(i);}}}
return activeCols;}
getActiveRows(){const activeRows=new Set();for(let zone of this.selection.zones){if(zone.left===0&&zone.right===this.workbook.activeSheet.cols.length-1){for(let i=zone.top;i<=zone.bottom;i++){activeRows.add(i);}}}
return activeRows;}
getSelectedZones(){return this.selection.zones;}
getSelectedZone(){return this.selection.zones[this.selection.zones.length-1];}
getSelection(){return this.selection;}
getPosition(){return[this.activeCol,this.activeRow];}
getAggregate(){let aggregate=0;let n=0;for(let zone of this.selection.zones){for(let row=zone.top;row<=zone.bottom;row++){const r=this.workbook.activeSheet.rows[row];for(let col=zone.left;col<=zone.right;col++){const cell=r.cells[col];if(cell&&cell.type!=="text"&&!cell.error&&typeof cell.value==="number"){n++;aggregate+=cell.value;}}}}
return n<2?null:formatStandardNumber(aggregate);}
getSelectionMode(){return this.mode;}
isSelected(zone){return!!this.getters.getSelectedZones().find((z)=>isEqual(z,zone));}
getReferenceCoords(){const isSelectingRange=this.getters.getEditionMode()==="selecting";return isSelectingRange?this.selection.anchor:[this.activeCol,this.activeRow];}
selectColumn(index,createRange,updateRange){const bottom=this.workbook.activeSheet.rows.length-1;const zone={left:index,right:index,top:0,bottom};const current=this.selection.zones;let zones,anchor;if(updateRange){const[col,row]=this.selection.anchor;const updatedZone=union(zone,{left:col,right:col,top:0,bottom});zones=current.slice(0,-1).concat(updatedZone);anchor=[col,row];}
else{zones=createRange?current.concat(zone):[zone];anchor=[index,0];}
this.dispatch("SET_SELECTION",{zones,anchor,strict:true});}
selectRow(index,createRange,updateRange){const right=this.workbook.activeSheet.cols.length-1;const zone={top:index,bottom:index,left:0,right};const current=this.selection.zones;let zones,anchor;if(updateRange){const[col,row]=this.selection.anchor;const updatedZone=union(zone,{left:0,right,top:row,bottom:row});zones=current.slice(0,-1).concat(updatedZone);anchor=[col,row];}
else{zones=createRange?current.concat(zone):[zone];anchor=[0,index];}
this.dispatch("SET_SELECTION",{zones,anchor,strict:true});}
selectAll(){const bottom=this.workbook.activeSheet.rows.length-1;const right=this.workbook.activeSheet.cols.length-1;const zone={left:0,top:0,bottom,right};this.dispatch("SET_SELECTION",{zones:[zone],anchor:[0,0]});}
selectCell(col,row){const xc=toXC(col,row);let zone=this.getters.expandZone({left:col,right:col,top:row,bottom:row});if(this.mode===SelectionMode.expanding){this.selection.zones.push(zone);}
else{this.selection.zones=[zone];}
this.selection.anchor=[col,row];if(this.getters.getEditionMode()!=="selecting"){this.activeCol=col;this.activeRow=row;this.activeXc=xc;}}
movePosition(deltaX,deltaY){const[refCol,refRow]=this.getReferenceCoords();const activeReference=toXC(refCol,refRow);const sheet=this.workbook.activeSheet;let mergeId=sheet.mergeCellMap[activeReference];if(mergeId){let targetCol=refCol;let targetRow=refRow;while(sheet.mergeCellMap[toXC(targetCol,targetRow)]===mergeId){targetCol+=deltaX;targetRow+=deltaY;}
if(targetCol>=0&&targetRow>=0){this.selectCell(targetCol,targetRow);}}
else{this.selectCell(refCol+deltaX,refRow+deltaY);}}
setSelection(anchor,zones,strict=false){this.selectCell(...anchor);if(strict){this.selection.zones=zones;}
else{this.selection.zones=zones.map(this.getters.expandZone);}
this.selection.anchor=anchor;}
moveSelection(deltaX,deltaY){const selection=this.selection;const zones=selection.zones.slice();const lastZone=zones[selection.zones.length-1];const[anchorCol,anchorRow]=selection.anchor;const{left,right,top,bottom}=lastZone;let result=lastZone;const expand=(z)=>{const{left,right,top,bottom}=this.getters.expandZone(z);return{left:Math.max(0,left),right:Math.min(this.workbook.activeSheet.cols.length-1,right),top:Math.max(0,top),bottom:Math.min(this.workbook.activeSheet.rows.length-1,bottom),};};let n=0;while(result!==null){n++;if(deltaX<0){result=anchorCol<=right-n?expand({top,left,bottom,right:right-n}):null;}
if(deltaX>0){result=left+n<=anchorCol?expand({top,left:left+n,bottom,right}):null;}
if(deltaY<0){result=anchorRow<=bottom-n?expand({top,left,bottom:bottom-n,right}):null;}
if(deltaY>0){result=top+n<=anchorRow?expand({top:top+n,left,bottom,right}):null;}
if(result&&!isEqual(result,lastZone)){zones[zones.length-1]=result;this.dispatch("SET_SELECTION",{zones,anchor:[anchorCol,anchorRow]});return;}}
const currentZone={top:anchorRow,bottom:anchorRow,left:anchorCol,right:anchorCol};const zoneWithDelta={top:top+deltaY,left:left+deltaX,bottom:bottom+deltaY,right:right+deltaX,};result=expand(union(currentZone,zoneWithDelta));if(!isEqual(result,lastZone)){zones[zones.length-1]=result;this.dispatch("SET_SELECTION",{zones,anchor:[anchorCol,anchorRow]});}}
addCellToSelection(col,row){const selection=this.selection;const[anchorCol,anchorRow]=selection.anchor;const zone={left:Math.min(anchorCol,col),top:Math.min(anchorRow,row),right:Math.max(anchorCol,col),bottom:Math.max(anchorRow,row),};const zones=selection.zones.slice(0,-1).concat(zone);this.dispatch("SET_SELECTION",{zones,anchor:[anchorCol,anchorRow]});}
updateSelection(){const cols=this.workbook.activeSheet.cols.length-1;const rows=this.workbook.activeSheet.rows.length-1;const zones=this.selection.zones.map((z)=>({left:clip(z.left,0,cols),right:clip(z.right,0,cols),top:clip(z.top,0,rows),bottom:clip(z.bottom,0,rows),}));const anchorCol=zones[zones.length-1].left;const anchorRow=zones[zones.length-1].top;this.dispatch("SET_SELECTION",{zones,anchor:[anchorCol,anchorRow]});}
onAddColumns(quantity){const selection=this.getSelectedZone();const zone={left:selection.left+quantity,right:selection.right+quantity,top:selection.top,bottom:selection.bottom,};this.dispatch("SET_SELECTION",{zones:[zone],anchor:[zone.left,zone.top],strict:true});}
onAddRows(quantity){const selection=this.getSelectedZone();const zone={left:selection.left,right:selection.right,top:selection.top+quantity,bottom:selection.bottom+quantity,};this.dispatch("SET_SELECTION",{zones:[zone],anchor:[zone.left,zone.top],strict:true});}
drawGrid(renderingContext){const{viewport,ctx,thinLineWidth}=renderingContext;const zones=this.getSelectedZones();ctx.fillStyle="#f3f7fe";const onlyOneCell=zones.length===1&&zones[0].left===zones[0].right&&zones[0].top===zones[0].bottom;ctx.fillStyle=onlyOneCell?"#f3f7fe":"#e9f0ff";ctx.strokeStyle=SELECTION_BORDER_COLOR;ctx.lineWidth=1.5*thinLineWidth;ctx.globalCompositeOperation="multiply";for(const zone of zones){const[x,y,width,height]=this.getters.getRect(zone,viewport);if(width>0&&height>0){ctx.fillRect(x,y,width,height);ctx.strokeRect(x,y,width,height);}}
ctx.globalCompositeOperation="source-over";const{mergeCellMap,merges}=this.workbook.activeSheet;const[col,row]=this.getPosition();const activeXc=toXC(col,row);ctx.strokeStyle="#3266ca";ctx.lineWidth=3*thinLineWidth;let zone;if(activeXc in mergeCellMap){zone=merges[mergeCellMap[activeXc]];}
else{zone={top:row,bottom:row,left:col,right:col,};}
const[x,y,width,height]=this.getters.getRect(zone,viewport);if(width>0&&height>0){ctx.strokeRect(x,y,width,height);}}}
SelectionPlugin.layers=[4];SelectionPlugin.modes=["normal","readonly"];SelectionPlugin.getters=["getActiveCell","getActiveCols","getActiveRows","getSelectedZones","getSelectedZone","getAggregate","getSelection","getPosition","getSelectionMode","isSelected",];const terms={CF_TITLE:_lt("Format rules"),IS_RULE:_lt("Format cells if..."),FORMATTING_STYLE:_lt("Formatting style"),BOLD:_lt("Bold"),ITALIC:_lt("Italic"),STRIKETHROUGH:_lt("Strikethrough"),TEXTCOLOR:_lt("Text Color"),FILLCOLOR:_lt("Fill Color"),CANCEL:_lt("Cancel"),SAVE:_lt("Save"),PREVIEWTEXT:_lt("Preview text"),};const cellIsOperators={BeginsWith:_lt("Begins with"),Between:_lt("Between"),ContainsText:_lt("Contains text"),EndsWith:_lt("Ends with"),Equal:_lt("Is equal to"),GreaterThan:_lt("Greater than"),GreaterThanOrEqual:_lt("Greater than or equal"),LessThan:_lt("Less than"),LessThanOrEqual:_lt("Less than or equal"),NotBetween:_lt("Not between"),NotContains:_lt("Not contains"),NotEqual:_lt("Not equal"),};const chartTerms={ChartType:_lt("Chart type"),Line:_lt("Line"),Bar:_lt("Bar"),Pie:_lt("Pie"),Title:_lt("Title"),Series:_lt("Series"),DataSeries:_lt("Data Series"),MyDataHasTitle:_lt("My data has title"),DataCategories:_lt("Data categories (labels)"),UpdateChart:_lt("Update chart"),CreateChart:_lt("Create chart"),TitlePlaceholder:_lt("New Chart"),};const GraphColors=["rgb(31,119,180)","rgb(255,127,14)","rgb(174,199,232)","rgb(255,187,120)","rgb(44,160,44)","rgb(152,223,138)","rgb(214,39,40)","rgb(255,152,150)","rgb(148,103,189)","rgb(197,176,213)","rgb(140,86,75)","rgb(196,156,148)","rgb(227,119,194)","rgb(247,182,210)","rgb(127,127,127)","rgb(199,199,199)","rgb(188,189,34)","rgb(219,219,141)","rgb(23,190,207)","rgb(158,218,229)",];class ChartPlugin extends BasePlugin{constructor(){super(...arguments);this.chartFigures=new Set();this.chartRuntime={};this.outOfDate=new Set();}
allowDispatch(cmd){const success={status:"SUCCESS"};switch(cmd.type){case"UPDATE_CHART":case"CREATE_CHART":const invalidRanges=cmd.definition.dataSets.find((range)=>!rangeReference.test(range.split("!").pop()))!==undefined;const invalidLabels=!rangeReference.test(cmd.definition.labelRange.split("!").pop());return invalidRanges||invalidLabels?{status:"CANCELLED",reason:16}:success;default:return success;}}
handle(cmd){switch(cmd.type){case"CREATE_CHART":const chartDefinition=this.createChartDefinition(cmd.definition,cmd.sheetId);this.dispatch("CREATE_FIGURE",{sheet:cmd.sheetId,figure:{id:cmd.id,data:chartDefinition,x:0,y:0,height:500,width:800,tag:"chart",},});this.history.updateLocalState(["chartFigures"],new Set(this.chartFigures).add(cmd.id));this.history.updateLocalState(["chartRuntime",cmd.id],this.mapDefinitionToRuntime(chartDefinition));break;case"UPDATE_CHART":{const chartDefinition=this.createChartDefinition(cmd.definition,this.getChartDefinition(cmd.id).sheetId);this.dispatch("UPDATE_FIGURE",{id:cmd.id,data:chartDefinition,});this.history.updateLocalState(["chartRuntime",cmd.id],this.mapDefinitionToRuntime(chartDefinition));break;}
case"DELETE_FIGURE":if(this.chartFigures.has(cmd.id)){const figures=new Set(this.chartFigures);figures.delete(cmd.id);this.history.updateLocalState(["chartFigures"],figures);this.history.updateLocalState(["chartRuntime",cmd.id],undefined);}
break;case"UPDATE_CELL":for(let chartId of this.chartFigures){const chart=this.getChartDefinition(chartId);if(this.isCellUsedInChart(chart,cmd.col,cmd.row)){this.outOfDate.add(chartId);}}
break;}}
finalize(cmd){switch(cmd.type){case"EVALUATE_CELLS":case"START":for(let id in this.chartRuntime){this.outOfDate.add(id);}
break;}}
import(data){for(let sheet of data.sheets){for(let f of sheet.figures){if(f.tag==="chart"){this.outOfDate.add(f.id);}}}}
getChartRuntime(figureId){if(this.outOfDate.has(figureId)){this.chartRuntime[figureId]=this.mapDefinitionToRuntime(this.getChartDefinition(figureId));this.outOfDate.delete(figureId);}
return this.chartRuntime[figureId];}
getChartDefinition(figureId){return this.getters.getFigure(figureId).data;}
createChartDefinition(createCommand,sheetId){let dataSets=[];for(let range of createCommand.dataSets){let zone=toZone(range);if(zone.left!==zone.right&&zone.top!==zone.bottom){for(let column=zone.left;column<=zone.right;column++){const columnZone={left:column,right:column,top:zone.top,bottom:zone.bottom,};dataSets.push(this.createDataset(columnZone,createCommand.seriesHasTitle));}}
else if(zone.left===zone.right&&zone.top===zone.bottom){if(!createCommand.seriesHasTitle){dataSets.push({dataRange:zoneToXc(zone)});}}
else{dataSets.push(this.createDataset(zone,createCommand.seriesHasTitle));}}
return{title:createCommand.title,type:createCommand.type,dataSets:dataSets,labelRange:createCommand.labelRange,sheetId:sheetId,};}
createDataset(zone,withTitle){if(zone.left!==zone.right&&zone.top!==zone.bottom){throw new Error(`Zone should be a single column or row: ${zoneToXc(zone)}`);}
const labelCell=withTitle?toXC(zone.left,zone.top):undefined;const offset=withTitle?1:0;const isColumn=zone.top!==zone.bottom&&zone.left===zone.right;const dataRange=zoneToXc({top:isColumn?zone.top+offset:zone.top,bottom:zone.bottom,left:isColumn?zone.left:zone.left+offset,right:zone.right,});return{labelCell,dataRange};}
getDefaultConfiguration(type,title,labels){const config={type,options:{responsive:true,maintainAspectRatio:false,layout:{padding:{left:20,right:20,top:10,bottom:10}},elements:{line:{fill:false,},point:{hitRadius:15,},},animation:{duration:0,},hover:{animationDuration:10,},responsiveAnimationDuration:0,title:{display:true,fontSize:22,fontStyle:"normal",text:title,},},data:{labels,datasets:[],},};if(type!=="pie"){config.options.scales={xAxes:[{ticks:{maxRotation:60,minRotation:15,padding:5,labelOffset:2,},},],yAxes:[{ticks:{beginAtZero:true,},},],};}
return config;}
mapDefinitionToRuntime(definition){const labels=definition.labelRange!==""?this.getters.getRangeFormattedValues(definition.labelRange,definition.sheetId).flat(1):[];const runtime=this.getDefaultConfiguration(definition.type,definition.title,labels);let graphColorIndex=0;for(const ds of definition.dataSets){let label;if(ds.labelCell){try{label=this.getters.evaluateFormula(ds.labelCell,definition.sheetId);}
catch(e){label=chartTerms.Series;}}
else{label=chartTerms.Series;}
const dataset={label,data:ds.dataRange?this.getters.getRangeValues(ds.dataRange,definition.sheetId).flat(1):[],lineTension:0,borderColor:definition.type!=="pie"?GraphColors[graphColorIndex]:"#FFFFFF",backgroundColor:GraphColors[graphColorIndex],};if(definition.type==="pie"){const colors=[];for(let i=0;i<=dataset.data.length-1;i++){colors.push(GraphColors[graphColorIndex]);graphColorIndex=++graphColorIndex%GraphColors.length;}
dataset.backgroundColor=colors;}
graphColorIndex=++graphColorIndex%GraphColors.length;runtime.data.datasets.push(dataset);}
return runtime;}
isCellUsedInChart(chart,col,row){if(isInside(col,row,toZone(chart.labelRange))){return true;}
for(let db of chart.dataSets){if(db.dataRange&&db.dataRange.length>0&&isInside(col,row,toZone(db.dataRange))){return true;}
if(db.labelCell&&db.labelCell.length>0&&isInside(col,row,toZone(db.labelCell))){return true;}}
return false;}}
ChartPlugin.getters=["getChartRuntime"];ChartPlugin.layers=[3];const autofillModifiersRegistry=new Registry();autofillModifiersRegistry.add("INCREMENT_MODIFIER",{apply:(rule,data)=>{rule.current+=rule.increment;const content=(parseFloat(data.content)+rule.current).toString();return{cellData:Object.assign({},data,{content}),tooltip:content?{props:{content}}:undefined,};},}).add("COPY_MODIFIER",{apply:(rule,data)=>{return{cellData:data,tooltip:data.content?{props:{content:data.content}}:undefined,};},}).add("FORMULA_MODIFIER",{apply:(rule,data,getters,direction)=>{rule.current+=rule.increment;let x=0;let y=0;switch(direction){case 0:x=0;y=-rule.current;break;case 1:x=0;y=rule.current;break;case 2:x=-rule.current;y=0;break;case 3:x=rule.current;y=0;break;}
const content=getters.applyOffset(data.content,x,y);return{cellData:Object.assign({},data,{content}),tooltip:content?{props:{content}}:undefined,};},});const autofillRulesRegistry=new Registry();function getGroup(cell,cells){let group=[];let found=false;for(let x of cells){if(x===cell){found=true;}
if(!x||x.type!=="number"){if(found){return group;}
group=[];}
if(x&&x.type==="number"&&x.content){group.push(x.content);}}
return group;}
function getAverageIncrement(group){const averages=[];let last=parseFloat(group[0]);for(let i=1;i<group.length;i++){const current=parseFloat(group[i]);averages.push(current-last);last=current;}
return averages.reduce((a,b)=>a+b,0)/averages.length;}
autofillRulesRegistry.add("simple_value_copy",{condition:(cell,cells)=>{return cells.length===1&&["text","date","number"].includes(cell.type);},generateRule:()=>{return{type:"COPY_MODIFIER"};},sequence:10,}).add("copy_text",{condition:(cell)=>cell.type==="text",generateRule:()=>{return{type:"COPY_MODIFIER"};},sequence:20,}).add("update_formula",{condition:(cell)=>cell.type==="formula",generateRule:(_,cells)=>{return{type:"FORMULA_MODIFIER",increment:cells.length,current:0};},sequence:30,}).add("increment_number",{condition:(cell)=>cell.type==="number",generateRule:(cell,cells)=>{const group=getGroup(cell,cells);let increment=1;if(group.length==2){increment=(parseFloat(group[1])-parseFloat(group[0]))*2;}
else if(group.length>2){increment=getAverageIncrement(group)*group.length;}
return{type:"INCREMENT_MODIFIER",increment,current:0,};},sequence:40,});const DEFAULT_MENU_ITEM=(key)=>({isVisible:()=>true,isEnabled:()=>true,action:false,children:[],separator:false,id:key,});function createFullMenuItem(key,value){return Object.assign({},DEFAULT_MENU_ITEM(key),value);}
class MenuItemRegistry extends Registry{add(key,value){this.content[key]=createFullMenuItem(key,value);return this;}
addChild(key,path,value){const root=path.splice(0,1)[0];let node=this.content[root];if(!node){throw new Error(`Path ${root + ":" + path.join(":")} not found`);}
for(let p of path){if(typeof node.children==="function"){node=undefined;}
else{node=node.children.find((elt)=>elt.id===p);}
if(!node){throw new Error(`Path ${root + ":" + path.join(":")} not found`);}}
node.children.push(createFullMenuItem(key,value));return this;}
getChildren(node,env){if(typeof node.children==="function"){return node.children(env).sort((a,b)=>a.sequence-b.sequence);}
return node.children.sort((a,b)=>a.sequence-b.sequence);}
getName(node,env){if(typeof node.name==="function"){return node.name(env);}
return node.name;}
getAll(){return super.getAll().sort((a,b)=>a.sequence-b.sequence);}}
function getColumnsNumber(env){const activeCols=env.getters.getActiveCols();if(activeCols.size){return activeCols.size;}
else{const zone=env.getters.getSelectedZones()[0];return zone.right-zone.left+1;}}
function getRowsNumber(env){const activeRows=env.getters.getActiveRows();if(activeRows.size){return activeRows.size;}
else{const zone=env.getters.getSelectedZones()[0];return zone.bottom-zone.top+1;}}
function setFormatter(env,formatter){env.dispatch("SET_FORMATTER",{sheet:env.getters.getActiveSheet(),target:env.getters.getSelectedZones(),formatter,});}
function setStyle(env,style){env.dispatch("SET_FORMATTING",{sheet:env.getters.getActiveSheet(),target:env.getters.getSelectedZones(),style,});}
const UNDO_ACTION=(env)=>env.dispatch("UNDO");const REDO_ACTION=(env)=>env.dispatch("REDO");const COPY_ACTION=async(env)=>{env.dispatch("COPY",{target:env.getters.getSelectedZones()});await env.clipboard.writeText(env.getters.getClipboardContent());};const CUT_ACTION=async(env)=>{env.dispatch("CUT",{target:env.getters.getSelectedZones()});await env.clipboard.writeText(env.getters.getClipboardContent());};const PASTE_ACTION=async(env)=>{const spreadsheetClipboard=env.getters.getClipboardContent();let osClipboard;try{osClipboard=await env.clipboard.readText();}
catch(e){console.warn("The OS clipboard could not be read.");console.error(e);}
const target=env.getters.getSelectedZones();if(osClipboard&&osClipboard!==spreadsheetClipboard){env.dispatch("PASTE_FROM_OS_CLIPBOARD",{target,text:osClipboard,});}
else{env.dispatch("PASTE",{target,interactive:true});}};const PASTE_VALUE_ACTION=(env)=>env.dispatch("PASTE",{target:env.getters.getSelectedZones(),onlyValue:true});const PASTE_FORMAT_ACTION=(env)=>env.dispatch("PASTE",{target:env.getters.getSelectedZones(),onlyFormat:true});const DELETE_CONTENT_ACTION=(env)=>env.dispatch("DELETE_CONTENT",{sheet:env.getters.getActiveSheet(),target:env.getters.getSelectedZones(),});const SET_FORMULA_VISIBILITY_ACTION=(env)=>env.dispatch("SET_FORMULA_VISIBILITY",{show:!env.getters.shouldShowFormulas()});const DELETE_CONTENT_ROWS_NAME=(env)=>{let first;let last;const activesRows=env.getters.getActiveRows();if(activesRows.size!==0){first=Math.min(...activesRows);last=Math.max(...activesRows);}
else{const zone=env.getters.getSelectedZones()[0];first=zone.top;last=zone.bottom;}
if(first===last){return _lt(`Clear row ${first + 1}`);}
return _lt(`Clear rows ${first + 1} - ${last + 1}`);};const DELETE_CONTENT_ROWS_ACTION=(env)=>{const target=[...env.getters.getActiveRows()].map((index)=>env.getters.getRowsZone(index,index));env.dispatch("DELETE_CONTENT",{target,sheet:env.getters.getActiveSheet(),});};const DELETE_CONTENT_COLUMNS_NAME=(env)=>{let first;let last;const activeCols=env.getters.getActiveCols();if(activeCols.size!==0){first=Math.min(...activeCols);last=Math.max(...activeCols);}
else{const zone=env.getters.getSelectedZones()[0];first=zone.left;last=zone.right;}
if(first===last){return _lt(`Clear column ${numberToLetters(first)}`);}
return _lt(`Clear columns ${numberToLetters(first)} - ${numberToLetters(last)}`);};const DELETE_CONTENT_COLUMNS_ACTION=(env)=>{const target=[...env.getters.getActiveCols()].map((index)=>env.getters.getColsZone(index,index));env.dispatch("DELETE_CONTENT",{target,sheet:env.getters.getActiveSheet(),});};const REMOVE_ROWS_NAME=(env)=>{let first;let last;const activesRows=env.getters.getActiveRows();if(activesRows.size!==0){first=Math.min(...activesRows);last=Math.max(...activesRows);}
else{const zone=env.getters.getSelectedZones()[0];first=zone.top;last=zone.bottom;}
if(first===last){return _lt(`Delete row ${first + 1}`);}
return _lt(`Delete rows ${first + 1} - ${last + 1}`);};const REMOVE_ROWS_ACTION=(env)=>{let rows=[...env.getters.getActiveRows()];if(!rows.length){const zone=env.getters.getSelectedZones()[0];for(let i=zone.top;i<=zone.bottom;i++){rows.push(i);}}
env.dispatch("REMOVE_ROWS",{sheet:env.getters.getActiveSheet(),rows,});};const REMOVE_COLUMNS_NAME=(env)=>{let first;let last;const activeCols=env.getters.getActiveCols();if(activeCols.size!==0){first=Math.min(...activeCols);last=Math.max(...activeCols);}
else{const zone=env.getters.getSelectedZones()[0];first=zone.left;last=zone.right;}
if(first===last){return _lt(`Delete column ${numberToLetters(first)}`);}
return _lt(`Delete columns ${numberToLetters(first)} - ${numberToLetters(last)}`);};const REMOVE_COLUMNS_ACTION=(env)=>{let columns=[...env.getters.getActiveCols()];if(!columns.length){const zone=env.getters.getSelectedZones()[0];for(let i=zone.left;i<=zone.right;i++){columns.push(i);}}
env.dispatch("REMOVE_COLUMNS",{sheet:env.getters.getActiveSheet(),columns,});};const MENU_INSERT_ROWS_BEFORE_NAME=(env)=>{const number=getRowsNumber(env);if(number===1){return _lt("Row above");}
return _lt(`${number} Rows above`);};const ROW_INSERT_ROWS_BEFORE_NAME=(env)=>{const number=getRowsNumber(env);return number===1?_lt("Insert row above"):_lt(`Insert ${number} rows above`);};const CELL_INSERT_ROWS_BEFORE_NAME=(env)=>{const number=getRowsNumber(env);if(number===1){return _lt("Insert row");}
return _lt(`Insert ${number} rows`);};const INSERT_ROWS_BEFORE_ACTION=(env)=>{const activeRows=env.getters.getActiveRows();let row;let quantity;if(activeRows.size){row=Math.min(...activeRows);quantity=activeRows.size;}
else{const zone=env.getters.getSelectedZones()[0];row=zone.top;quantity=zone.bottom-zone.top+1;}
env.dispatch("ADD_ROWS",{sheet:env.getters.getActiveSheet(),position:"before",row,quantity,});};const MENU_INSERT_ROWS_AFTER_NAME=(env)=>{const number=getRowsNumber(env);if(number===1){return _lt("Row below");}
return _lt(`${number} Rows below`);};const ROW_INSERT_ROWS_AFTER_NAME=(env)=>{const number=getRowsNumber(env);return number===1?_lt("Insert row below"):_lt(`Insert ${number} rows below`);};const INSERT_ROWS_AFTER_ACTION=(env)=>{const activeRows=env.getters.getActiveRows();let row;let quantity;if(activeRows.size){row=Math.max(...activeRows);quantity=activeRows.size;}
else{const zone=env.getters.getSelectedZones()[0];row=zone.bottom;quantity=zone.bottom-zone.top+1;}
env.dispatch("ADD_ROWS",{sheet:env.getters.getActiveSheet(),position:"after",row,quantity,});};const MENU_INSERT_COLUMNS_BEFORE_NAME=(env)=>{const number=getColumnsNumber(env);if(number===1){return _lt("Column left");}
return _lt(`${number} Columns left`);};const COLUMN_INSERT_COLUMNS_BEFORE_NAME=(env)=>{const number=getColumnsNumber(env);return number===1?_lt("Insert column left"):_lt(`Insert ${number} columns left`);};const CELL_INSERT_COLUMNS_BEFORE_NAME=(env)=>{const number=getColumnsNumber(env);if(number===1){return _lt("Insert column");}
return _lt(`Insert ${number} columns`);};const INSERT_COLUMNS_BEFORE_ACTION=(env)=>{const activeCols=env.getters.getActiveCols();let column;let quantity;if(activeCols.size){column=Math.min(...activeCols);quantity=activeCols.size;}
else{const zone=env.getters.getSelectedZones()[0];column=zone.left;quantity=zone.right-zone.left+1;}
env.dispatch("ADD_COLUMNS",{sheet:env.getters.getActiveSheet(),position:"before",column,quantity,});};const MENU_INSERT_COLUMNS_AFTER_NAME=(env)=>{const number=getColumnsNumber(env);if(number===1){return _lt("Column right");}
return _lt(`${number} Columns right`);};const COLUMN_INSERT_COLUMNS_AFTER_NAME=(env)=>{const number=getColumnsNumber(env);return number===1?_lt("Insert column right"):_lt(`Insert ${number} columns right`);};const INSERT_COLUMNS_AFTER_ACTION=(env)=>{const activeCols=env.getters.getActiveCols();let column;let quantity;if(activeCols.size){column=Math.max(...activeCols);quantity=activeCols.size;}
else{const zone=env.getters.getSelectedZones()[0];column=zone.right;quantity=zone.right-zone.left+1;}
env.dispatch("ADD_COLUMNS",{sheet:env.getters.getActiveSheet(),position:"after",column,quantity,});};const CREATE_SHEET_ACTION=(env)=>{env.dispatch("CREATE_SHEET",{activate:true,id:uuidv4()});};const CREATE_CHART=(env)=>{env.openSidePanel("ChartPanel");};const FORMAT_AUTO_ACTION=(env)=>setFormatter(env,"");const FORMAT_NUMBER_ACTION=(env)=>setFormatter(env,"#,##0.00");const FORMAT_PERCENT_ACTION=(env)=>setFormatter(env,"0.00%");const FORMAT_DATE_ACTION=(env)=>setFormatter(env,"m/d/yyyy");const FORMAT_TIME_ACTION=(env)=>setFormatter(env,"hh:mm:ss a");const FORMAT_DATE_TIME_ACTION=(env)=>setFormatter(env,"m/d/yyyy hh:mm:ss");const FORMAT_DURATION_ACTION=(env)=>setFormatter(env,"hhhh:mm:ss");const FORMAT_BOLD_ACTION=(env)=>setStyle(env,{bold:!env.getters.getCurrentStyle().bold});const FORMAT_ITALIC_ACTION=(env)=>setStyle(env,{italic:!env.getters.getCurrentStyle().italic});const FORMAT_STRIKETHROUGH_ACTION=(env)=>setStyle(env,{strikethrough:!env.getters.getCurrentStyle().strikethrough});const OPEN_CF_SIDEPANEL_ACTION=(env)=>{env.openSidePanel("ConditionalFormatting",{selection:env.getters.getSelectedZones()});};const cellMenuRegistry=new MenuItemRegistry();cellMenuRegistry.add("cut",{name:_lt("Cut"),sequence:10,action:CUT_ACTION,}).add("copy",{name:_lt("Copy"),sequence:20,action:COPY_ACTION,}).add("paste",{name:_lt("Paste"),sequence:30,action:PASTE_ACTION,}).add("paste_special",{name:_lt("Paste special"),sequence:40,separator:true,}).addChild("paste_value_only",["paste_special"],{name:_lt("Paste values only"),sequence:10,action:PASTE_VALUE_ACTION,}).addChild("paste_format_only",["paste_special"],{name:_lt("Paste format only"),sequence:20,action:PASTE_FORMAT_ACTION,}).add("add_row_before",{name:CELL_INSERT_ROWS_BEFORE_NAME,sequence:50,action:INSERT_ROWS_BEFORE_ACTION,}).add("add_column_before",{name:CELL_INSERT_COLUMNS_BEFORE_NAME,sequence:70,action:INSERT_COLUMNS_BEFORE_ACTION,separator:true,}).add("delete_row",{name:REMOVE_ROWS_NAME,sequence:90,action:REMOVE_ROWS_ACTION,}).add("delete_column",{name:REMOVE_COLUMNS_NAME,sequence:100,action:REMOVE_COLUMNS_ACTION,separator:true,}).add("clear_cell",{name:_lt("Clear cell"),sequence:110,action:DELETE_CONTENT_ACTION,isEnabled:(env)=>{const cell=env.getters.getActiveCell();return Boolean(cell&&cell.content);},}).add("conditional_formatting",{name:_lt("Conditional formatting"),sequence:120,action:OPEN_CF_SIDEPANEL_ACTION,separator:true,});const colMenuRegistry=new MenuItemRegistry();colMenuRegistry.add("cut",{name:_lt("Cut"),sequence:10,action:CUT_ACTION,}).add("copy",{name:_lt("Copy"),sequence:20,action:COPY_ACTION,}).add("paste",{name:_lt("Paste"),sequence:30,action:PASTE_ACTION,}).add("paste_special",{name:_lt("Paste special"),sequence:40,separator:true,}).addChild("paste_value_only",["paste_special"],{name:_lt("Paste value only"),sequence:10,action:PASTE_VALUE_ACTION,}).addChild("paste_format_only",["paste_special"],{name:_lt("Paste format only"),sequence:20,action:PASTE_FORMAT_ACTION,}).add("add_column_before",{name:COLUMN_INSERT_COLUMNS_BEFORE_NAME,sequence:50,action:INSERT_COLUMNS_BEFORE_ACTION,}).add("add_column_after",{name:COLUMN_INSERT_COLUMNS_AFTER_NAME,sequence:60,action:INSERT_COLUMNS_AFTER_ACTION,}).add("delete_column",{name:REMOVE_COLUMNS_NAME,sequence:70,action:REMOVE_COLUMNS_ACTION,}).add("clear_column",{name:DELETE_CONTENT_COLUMNS_NAME,sequence:80,action:DELETE_CONTENT_COLUMNS_ACTION,separator:true,}).add("conditional_formatting",{name:_lt("Conditional formatting"),sequence:90,action:OPEN_CF_SIDEPANEL_ACTION,});const rowMenuRegistry=new MenuItemRegistry();rowMenuRegistry.add("cut",{name:_lt("Cut"),sequence:10,action:CUT_ACTION,}).add("copy",{name:_lt("Copy"),sequence:20,action:COPY_ACTION,}).add("paste",{name:_lt("Paste"),sequence:30,action:PASTE_ACTION,}).add("paste_special",{name:_lt("Paste special"),sequence:40,separator:true,}).addChild("paste_value_only",["paste_special"],{name:_lt("Paste value only"),sequence:10,action:PASTE_VALUE_ACTION,}).addChild("paste_format_only",["paste_special"],{name:_lt("Paste format only"),sequence:20,action:PASTE_FORMAT_ACTION,}).add("add_row_before",{name:ROW_INSERT_ROWS_BEFORE_NAME,sequence:50,action:INSERT_ROWS_BEFORE_ACTION,}).add("add_row_after",{name:ROW_INSERT_ROWS_AFTER_NAME,sequence:60,action:INSERT_ROWS_AFTER_ACTION,}).add("delete_row",{name:REMOVE_ROWS_NAME,sequence:70,action:REMOVE_ROWS_ACTION,}).add("clear_row",{name:DELETE_CONTENT_ROWS_NAME,sequence:80,action:DELETE_CONTENT_ROWS_ACTION,separator:true,}).add("conditional_formatting",{name:_lt("Conditional formatting"),sequence:90,action:OPEN_CF_SIDEPANEL_ACTION,});const sheetMenuRegistry=new MenuItemRegistry();function getDuplicateSheetName(env,sheet){let i=1;const names=env.getters.getSheets().map((s)=>s.name);const baseName=env._t(`Copy of ${sheet}`);let name=baseName;while(names.includes(name)){name=`${baseName} (${i})`;i++;}
return name;}
sheetMenuRegistry.add("delete",{name:_lt("Delete"),sequence:10,isVisible:(env)=>{return env.getters.getSheets().length>1;},action:(env)=>env.dispatch("DELETE_SHEET_CONFIRMATION",{sheet:env.getters.getActiveSheet()}),}).add("duplicate",{name:_lt("Duplicate"),sequence:20,action:(env)=>{const sheet=env.getters.getActiveSheet();const name=getDuplicateSheetName(env,env.getters.getSheets().find((s)=>s.id===sheet).name);env.dispatch("DUPLICATE_SHEET",{sheet,id:uuidv4(),name,});},}).add("rename",{name:_lt("Rename"),sequence:30,action:(env)=>env.dispatch("RENAME_SHEET",{interactive:true,sheet:env.getters.getActiveSheet(),}),}).add("move_right",{name:_lt("Move right"),sequence:40,isVisible:(env)=>{const sheet=env.getters.getActiveSheet();const sheets=env.getters.getSheets();return sheets.findIndex((s)=>s.id===sheet)!==sheets.length-1;},action:(env)=>env.dispatch("MOVE_SHEET",{sheet:env.getters.getActiveSheet(),direction:"right"}),}).add("move_left",{name:_lt("Move left"),sequence:50,isVisible:(env)=>{const sheet=env.getters.getActiveSheet();return env.getters.getSheets().findIndex((s)=>s.id===sheet)!==0;},action:(env)=>env.dispatch("MOVE_SHEET",{sheet:env.getters.getActiveSheet(),direction:"left"}),});const topbarMenuRegistry=new MenuItemRegistry();topbarMenuRegistry.add("file",{name:_lt("File"),sequence:10}).add("edit",{name:_lt("Edit"),sequence:20}).add("view",{name:_lt("View"),sequence:30}).add("insert",{name:_lt("Insert"),sequence:40}).add("format",{name:_lt("Format"),sequence:50}).add("data",{name:_lt("Data"),sequence:60}).addChild("save",["file"],{name:_lt("Save"),sequence:10,action:()=>console.log("Not implemented"),}).addChild("undo",["edit"],{name:_lt("Undo"),sequence:10,action:UNDO_ACTION,}).addChild("redo",["edit"],{name:_lt("Redo"),sequence:20,action:REDO_ACTION,separator:true,}).addChild("copy",["edit"],{name:_lt("Copy"),sequence:30,action:COPY_ACTION,}).addChild("cut",["edit"],{name:_lt("Cut"),sequence:40,action:CUT_ACTION,}).addChild("paste",["edit"],{name:_lt("Paste"),sequence:50,action:PASTE_ACTION,}).addChild("paste_special",["edit"],{name:_lt("Paste special"),sequence:60,separator:true,}).addChild("paste_special_value",["edit","paste_special"],{name:_lt("Paste value only"),sequence:10,action:PASTE_VALUE_ACTION,}).addChild("paste_special_format",["edit","paste_special"],{name:_lt("Paste format only"),sequence:20,action:PASTE_FORMAT_ACTION,}).addChild("edit_delete_cell_values",["edit"],{name:_lt("Delete values"),sequence:70,action:DELETE_CONTENT_ACTION,}).addChild("edit_delete_row",["edit"],{name:REMOVE_ROWS_NAME,sequence:80,action:REMOVE_ROWS_ACTION,}).addChild("edit_delete_column",["edit"],{name:REMOVE_COLUMNS_NAME,sequence:90,action:REMOVE_COLUMNS_ACTION,}).addChild("insert_row_before",["insert"],{name:MENU_INSERT_ROWS_BEFORE_NAME,sequence:10,action:INSERT_ROWS_BEFORE_ACTION,isVisible:(env)=>env.getters.getActiveCols().size===0,}).addChild("insert_row_after",["insert"],{name:MENU_INSERT_ROWS_AFTER_NAME,sequence:20,action:INSERT_ROWS_AFTER_ACTION,isVisible:(env)=>env.getters.getActiveCols().size===0,separator:true,}).addChild("insert_column_before",["insert"],{name:MENU_INSERT_COLUMNS_BEFORE_NAME,sequence:30,action:INSERT_COLUMNS_BEFORE_ACTION,isVisible:(env)=>env.getters.getActiveRows().size===0,}).addChild("insert_column_after",["insert"],{name:MENU_INSERT_COLUMNS_AFTER_NAME,sequence:40,action:INSERT_COLUMNS_AFTER_ACTION,isVisible:(env)=>env.getters.getActiveRows().size===0,separator:true,}).addChild("insert_chart",["insert"],{name:_lt("Chart"),sequence:50,action:CREATE_CHART,separator:true,}).addChild("insert_sheet",["insert"],{name:_lt("New sheet"),sequence:60,action:CREATE_SHEET_ACTION,}).addChild("view_formulas",["view"],{name:(env)=>env.getters.shouldShowFormulas()?_lt("Hide formulas"):_lt("Show formulas"),action:SET_FORMULA_VISIBILITY_ACTION,sequence:10,}).addChild("format_number",["format"],{name:_lt("Numbers"),sequence:10,separator:true,}).addChild("format_number_auto",["format","format_number"],{name:_lt("Automatic"),sequence:10,separator:true,action:FORMAT_AUTO_ACTION,}).addChild("format_number_number",["format","format_number"],{name:_lt("Number (1,000.12)"),sequence:20,action:FORMAT_NUMBER_ACTION,}).addChild("format_number_percent",["format","format_number"],{name:_lt("Percent (10.12%)"),sequence:30,separator:true,action:FORMAT_PERCENT_ACTION,}).addChild("format_number_date",["format","format_number"],{name:_lt("Date (9/26/2008)"),sequence:40,action:FORMAT_DATE_ACTION,}).addChild("format_number_time",["format","format_number"],{name:_lt("Time (10:43:00 PM)"),sequence:50,action:FORMAT_TIME_ACTION,}).addChild("format_number_date_time",["format","format_number"],{name:_lt("Date time (9/26/2008 22:43:00)"),sequence:60,action:FORMAT_DATE_TIME_ACTION,}).addChild("format_number_duration",["format","format_number"],{name:_lt("Duration (27:51:38)"),sequence:70,separator:true,action:FORMAT_DURATION_ACTION,}).addChild("format_bold",["format"],{name:_lt("Bold"),sequence:20,action:FORMAT_BOLD_ACTION,}).addChild("format_italic",["format"],{name:_lt("Italic"),sequence:30,action:FORMAT_ITALIC_ACTION,}).addChild("format_strikethrough",["format"],{name:_lt("Strikethrough"),sequence:50,action:FORMAT_STRIKETHROUGH_ACTION,separator:true,}).addChild("format_font_size",["format"],{name:_lt("Font size"),sequence:60,separator:true,}).addChild("format_cf",["format"],{name:_lt("Conditional formatting"),sequence:70,action:OPEN_CF_SIDEPANEL_ACTION,separator:true,});for(let fs of fontSizes){topbarMenuRegistry.addChild(`format_font_size_${fs.pt}`,["format","format_font_size"],{name:fs.pt.toString(),sequence:fs.pt,action:(env)=>setStyle(env,{fontSize:fs.pt}),});}
const UNDO_ICON=`<svg class="o-icon"><path fill="#000000" d="M11.5656391,4.43436088 L9,7 L16,7 L16,0 L13.0418424,2.95815758 C11.5936787,1.73635959 9.72260775,1 7.67955083,1 C4.22126258,1 1.25575599,3.10984908 0,6 L2,7 C2.93658775,4.60974406 5.12943697,3.08011229 7.67955083,3 C9.14881247,3.0528747 10.4994783,3.57862053 11.5656391,4.43436088 Z" transform="matrix(-1 0 0 1 17 5)"/></svg>`;const REDO_ICON=`<svg class="o-icon"><path fill="#000000" d="M11.5656391,4.43436088 L9,7 L16,7 L16,0 L13.0418424,2.95815758 C11.5936787,1.73635959 9.72260775,1 7.67955083,1 C4.22126258,1 1.25575599,3.10984908 0,6 L2,7 C2.93658775,4.60974406 5.12943697,3.08011229 7.67955083,3 C9.14881247,3.0528747 10.4994783,3.57862053 11.5656391,4.43436088 Z" transform="translate(1 5)"/></svg>`;const PAINT_FORMAT_ICON=`<svg class="o-icon"><path fill="#000000" d="M9,0 L1,0 C0.45,0 0,0.45 0,1 L0,4 C0,4.55 0.45,5 1,5 L9,5 C9.55,5 10,4.55 10,4 L10,3 L11,3 L11,6 L4,6 L4,14 L6,14 L6,8 L13,8 L13,2 L10,2 L10,1 C10,0.45 9.55,0 9,0 Z" transform="translate(3 2)"/></svg>`;const CLEAR_FORMAT_ICON=`<svg class="o-icon"><path fill="#000000" d="M0.27,1.55 L5.43,6.7 L3,12 L5.5,12 L7.14,8.42 L11.73,13 L13,11.73 L1.55,0.27 L0.27,1.55 L0.27,1.55 Z M3.82,0 L5.82,2 L7.58,2 L7.03,3.21 L8.74,4.92 L10.08,2 L14,2 L14,0 L3.82,0 L3.82,0 Z" transform="translate(2 3)"/></svg>`;const TRIANGLE_DOWN_ICON=`<svg class="o-icon"><polygon fill="#000000" points="0 0 4 4 8 0" transform="translate(5 7)"/></svg>`;const TRIANGLE_RIGHT_ICON=`<svg class="o-icon"><polygon fill="#000000" points="0 0 4 4 0 8" transform="translate(5 3)"/></svg>`;const BOLD_ICON=`<svg class="o-icon"><path fill="#000000" fill-rule="evenodd" d="M9,3.5 C9,1.57 7.43,0 5.5,0 L1.77635684e-15,0 L1.77635684e-15,12 L6.25,12 C8.04,12 9.5,10.54 9.5,8.75 C9.5,7.45 8.73,6.34 7.63,5.82 C8.46,5.24 9,4.38 9,3.5 Z M5,2 C5.82999992,2 6.5,2.67 6.5,3.5 C6.5,4.33 5.82999992,5 5,5 L3,5 L3,2 L5,2 Z M3,10 L3,7 L5.5,7 C6.32999992,7 7,7.67 7,8.5 C7,9.33 6.32999992,10 5.5,10 L3,10 Z" transform="translate(4 3)"/></svg>`;const ITALIC_ICON=`<svg class="o-icon"><polygon fill="#000000" fill-rule="evenodd" points="4 0 4 2 6.58 2 2.92 10 0 10 0 12 8 12 8 10 5.42 10 9.08 2 12 2 12 0" transform="translate(3 3)"/></svg>`;const STRIKE_ICON=`<svg class="o-icon"><path fill="#010101" fill-rule="evenodd" d="M2.8875,3.06 C2.8875,2.6025 2.985,2.18625 3.18375,1.8075 C3.3825,1.42875 3.66,1.10625 4.02,0.84 C4.38,0.57375 4.80375,0.3675 5.29875,0.22125 C5.79375,0.075 6.33375,0 6.92625,0 C7.53375,0 8.085,0.0825 8.58,0.25125 C9.075,0.42 9.49875,0.6525 9.85125,0.95625 C10.20375,1.25625 10.47375,1.6125 10.665,2.02875 C10.85625,2.44125 10.95,2.895 10.95,3.38625 L8.6925,3.38625 C8.6925,3.1575 8.655,2.94375 8.58375,2.74875 C8.5125,2.55 8.4,2.38125 8.25,2.2425 C8.1,2.10375 7.9125,1.99125 7.6875,1.91625 C7.4625,1.8375 7.19625,1.8 6.88875,1.8 C6.5925,1.8 6.3375,1.83375 6.11625,1.8975 C5.89875,1.96125 5.71875,2.05125 5.57625,2.1675 C5.43375,2.28375 5.325,2.41875 5.25375,2.5725 C5.1825,2.72625 5.145,2.895 5.145,3.0675 C5.145,3.4275 5.32875,3.73125 5.69625,3.975 C5.71780203,3.98908066 5.73942012,4.00311728 5.76118357,4.01733315 C6.02342923,4.18863185 6.5,4.5 7,5 L4,5 C4,5 3.21375,4.37625 3.17625,4.30875 C2.985,3.9525 2.8875,3.53625 2.8875,3.06 Z M14,6 L0,6 L0,8 L7.21875,8 C7.35375,8.0525 7.51875,8.105 7.63125,8.15375 C7.90875,8.2775 8.12625,8.40875 8.28375,8.53625 C8.44125,8.6675 8.54625,8.81 8.6025,8.96 C8.65875,9.11375 8.685,9.28625 8.685,9.47375 C8.685,9.65 8.65125,9.815 8.58375,9.965 C8.51625,10.11875 8.41125,10.25 8.2725,10.35875 C8.13375,10.4675 7.95375,10.55375 7.74,10.6175 C7.5225,10.68125 7.27125,10.71125 6.97875,10.71125 C6.6525,10.71125 6.35625,10.6775 6.09,10.61375 C5.82375,10.55 5.59875,10.445 5.41125,10.3025 C5.22375,10.16 5.0775,9.9725 4.9725,9.74375 C4.8675,9.515 4.78125,9.17 4.78125,9 L2.55,9 C2.55,9.2525 2.61,9.6875 2.72625,10.025 C2.8425,10.3625 3.0075,10.66625 3.21375,10.9325 C3.42,11.19875 3.6675,11.4275 3.94875,11.6225 C4.23,11.8175 4.53375,11.9825 4.86375,12.11 C5.19375,12.24125 5.535,12.33875 5.89875,12.39875 C6.25875,12.4625 6.6225,12.4925 6.9825,12.4925 C7.5825,12.4925 8.13,12.425 8.6175,12.28625 C9.105,12.1475 9.525,11.94875 9.87,11.69375 C10.215,11.435 10.48125,11.12 10.6725,10.74125 C10.86375,10.3625 10.95375,9.935 10.95375,9.455 C10.95375,9.005 10.875,8.6 10.72125,8.24375 C10.68375,8.1575 10.6425,8.075 10.59375,7.9925 L14,8 L14,6 Z" transform="translate(2 3)"/></svg>`;const TEXT_COLOR_ICON=`<svg class="o-icon"><path fill="#000000" d="M7,0 L5,0 L0.5,12 L2.5,12 L3.62,9 L8.37,9 L9.49,12 L11.49,12 L7,0 L7,0 Z M4.38,7 L6,2.67 L7.62,7 L4.38,7 L4.38,7 Z" transform="translate(3 1)"/></svg>`;const FILL_COLOR_ICON=`<svg class="o-icon"><path fill="#000000" d="M14.5,8.87 C14.5,8.87 13,10.49 13,11.49 C13,12.32 13.67,12.99 14.5,12.99 C15.33,12.99 16,12.32 16,11.49 C16,10.5 14.5,8.87 14.5,8.87 L14.5,8.87 Z M12.71,6.79 L5.91,0 L4.85,1.06 L6.44,2.65 L2.29,6.79 C1.9,7.18 1.9,7.81 2.29,8.2 L6.79,12.7 C6.99,12.9 7.24,13 7.5,13 C7.76,13 8.01,12.9 8.21,12.71 L12.71,8.21 C13.1,7.82 13.1,7.18 12.71,6.79 L12.71,6.79 Z M4.21,7 L7.5,3.71 L10.79,7 L4.21,7 L4.21,7 Z"/></svg>`;const MERGE_CELL_ICON=`<svg class="o-icon"><path fill="#000000" d="M3,6 L1,6 L1,2 L8,2 L8,4 L3,4 L3,6 Z M10,4 L10,2 L17,2 L17,6 L15,6 L15,4 L10,4 Z M10,14 L15,14 L15,12 L17,12 L17,16 L10,16 L10,14 Z M1,12 L3,12 L3,14 L8,14 L8,16 L1,16 L1,12 Z M1,8 L5,8 L5,6 L8,9 L5,12 L5,10 L1,10 L1,8 Z M10,9 L13,6 L13,8 L17,8 L17,10 L13,10 L13,12 L10,9 Z"/></svg>`;const ALIGN_LEFT_ICON=`<svg class="o-icon"><path fill="#000000" d="M0,14 L10,14 L10,12 L0,12 L0,14 Z M10,4 L0,4 L0,6 L10,6 L10,4 Z M0,0 L0,2 L14,2 L14,0 L0,0 Z M0,10 L14,10 L14,8 L0,8 L0,10 Z" transform="translate(2 2)"/></svg>`;const ALIGN_CENTER_ICON=`<svg class="o-icon"><path fill="#000000" d="M2,12 L2,14 L12,14 L12,12 L2,12 Z M2,4 L2,6 L12,6 L12,4 L2,4 Z M0,10 L14,10 L14,8 L0,8 L0,10 Z M0,0 L0,2 L14,2 L14,0 L0,0 Z" transform="translate(2 2)"/></svg>`;const ALIGN_RIGHT_ICON=`<svg class="o-icon"><path fill="#000000" d="M4,14 L14,14 L14,12 L4,12 L4,14 Z M0,10 L14,10 L14,8 L0,8 L0,10 Z M0,0 L0,2 L14,2 L14,0 L0,0 Z M4,6 L14,6 L14,4 L4,4 L4,6 Z" transform="translate(2 2)"/></svg>`;const ALIGN_MIDDLE_ICON=`<svg class="o-icon"><path fill="#000000" d="M9.5,3 L7,3 L7,0 L5,0 L5,3 L2.5,3 L6,6.5 L9.5,3 L9.5,3 Z M0,8 L0,10 L12,10 L12,8 L0,8 L0,8 Z M2.5,15 L5,15 L5,18 L7,18 L7,15 L9.5,15 L6,11.5 L2.5,15 L2.5,15 Z" transform="translate(3)"/></svg>`;const TEXT_WRAPPING_ICON=`<svg class="o-icon"><path fill="#000000" d="M14,0 L0,0 L0,2 L14,2 L14,0 Z M0,12 L4,12 L4,10 L0,10 L0,12 Z M11.5,5 L0,5 L0,7 L11.75,7 C12.58,7 13.25,7.67 13.25,8.5 C13.25,9.33 12.58,10 11.75,10 L9,10 L9,8 L6,11 L9,14 L9,12 L11.5,12 C13.43,12 15,10.43 15,8.5 C15,6.57 13.43,5 11.5,5 Z" transform="translate(2 3)"/></svg>`;const BORDERS_ICON=`<svg class="o-icon"><path fill="#000000" d="M0,0 L0,14 L14,14 L14,0 L0,0 L0,0 Z M6,12 L2,12 L2,8 L6,8 L6,12 L6,12 Z M6,6 L2,6 L2,2 L6,2 L6,6 L6,6 Z M12,12 L8,12 L8,8 L12,8 L12,12 L12,12 Z M12,6 L8,6 L8,2 L12,2 L12,6 L12,6 Z" transform="translate(2 2)"/></svg>`;const BORDER_HV=`<svg class="o-icon"><g fill="#000000"><path d="M0,14 L2,14 L2,12 L0,12 L0,14 L0,14 Z M2,3 L0,3 L0,5 L2,5 L2,3 L2,3 Z M3,14 L5,14 L5,12 L3,12 L3,14 L3,14 Z M11,0 L9,0 L9,2 L11,2 L11,0 L11,0 Z M2,0 L0,0 L0,2 L2,2 L2,0 L2,0 Z M5,0 L3,0 L3,2 L5,2 L5,0 L5,0 Z M0,11 L2,11 L2,9 L0,9 L0,11 L0,11 Z M9,14 L11,14 L11,12 L9,12 L9,14 L9,14 Z M12,0 L12,2 L14,2 L14,0 L12,0 L12,0 Z M12,5 L14,5 L14,3 L12,3 L12,5 L12,5 Z M12,14 L14,14 L14,12 L12,12 L12,14 L12,14 Z M12,11 L14,11 L14,9 L12,9 L12,11 L12,11 Z" opacity=".54"/><polygon points="8 0 6 0 6 6 0 6 0 8 6 8 6 14 8 14 8 8 14 8 14 6 8 6"/></g></svg>`;const BORDER_H=`<svg class="o-icon"><g fill="#000000"><path d="M6,14 L8,14 L8,12 L6,12 L6,14 L6,14 Z M3,2 L5,2 L5,0 L3,0 L3,2 L3,2 Z M6,11 L8,11 L8,9 L6,9 L6,11 L6,11 Z M3,14 L5,14 L5,12 L3,12 L3,14 L3,14 Z M0,5 L2,5 L2,3 L0,3 L0,5 L0,5 Z M0,14 L2,14 L2,12 L0,12 L0,14 L0,14 Z M0,2 L2,2 L2,0 L0,0 L0,2 L0,2 Z M0,11 L2,11 L2,9 L0,9 L0,11 L0,11 Z M12,11 L14,11 L14,9 L12,9 L12,11 L12,11 Z M12,14 L14,14 L14,12 L12,12 L12,14 L12,14 Z M12,5 L14,5 L14,3 L12,3 L12,5 L12,5 Z M12,0 L12,2 L14,2 L14,0 L12,0 L12,0 Z M6,2 L8,2 L8,0 L6,0 L6,2 L6,2 Z M9,2 L11,2 L11,0 L9,0 L9,2 L9,2 Z M6,5 L8,5 L8,3 L6,3 L6,5 L6,5 Z M9,14 L11,14 L11,12 L9,12 L9,14 L9,14 Z" opacity=".54"/><polygon points="0 8 14 8 14 6 0 6"/></g></svg>`;const BORDER_V=`<svg class="o-icon"><g fill="#000000"><path d="M3,14 L5,14 L5,12 L3,12 L3,14 L3,14 Z M0,5 L2,5 L2,3 L0,3 L0,5 L0,5 Z M0,2 L2,2 L2,0 L0,0 L0,2 L0,2 Z M3,8 L5,8 L5,6 L3,6 L3,8 L3,8 Z M3,2 L5,2 L5,0 L3,0 L3,2 L3,2 Z M0,14 L2,14 L2,12 L0,12 L0,14 L0,14 Z M0,8 L2,8 L2,6 L0,6 L0,8 L0,8 Z M0,11 L2,11 L2,9 L0,9 L0,11 L0,11 Z M12,0 L12,2 L14,2 L14,0 L12,0 L12,0 Z M12,8 L14,8 L14,6 L12,6 L12,8 L12,8 Z M12,14 L14,14 L14,12 L12,12 L12,14 L12,14 Z M12,5 L14,5 L14,3 L12,3 L12,5 L12,5 Z M12,11 L14,11 L14,9 L12,9 L12,11 L12,11 Z M9,14 L11,14 L11,12 L9,12 L9,14 L9,14 Z M9,8 L11,8 L11,6 L9,6 L9,8 L9,8 Z M9,2 L11,2 L11,0 L9,0 L9,2 L9,2 Z" opacity=".54"/><polygon points="6 14 8 14 8 0 6 0"/></g></svg>`;const BORDER_EXTERNAL=`<svg class="o-icon"><g fill="#000000"><path d="M8,3 L6,3 L6,5 L8,5 L8,3 L8,3 Z M11,6 L9,6 L9,8 L11,8 L11,6 L11,6 Z M8,6 L6,6 L6,8 L8,8 L8,6 L8,6 Z M8,9 L6,9 L6,11 L8,11 L8,9 L8,9 Z M5,6 L3,6 L3,8 L5,8 L5,6 L5,6 Z" opacity=".54"/><path d="M0,0 L14,0 L14,14 L0,14 L0,0 Z M12,12 L12,2 L2,2 L2,12 L12,12 Z"/></g></svg>`;const BORDER_LEFT=`<svg class="o-icon"><g fill="#000000"><path d="M6,8 L8,8 L8,6 L6,6 L6,8 L6,8 Z M6,5 L8,5 L8,3 L6,3 L6,5 L6,5 Z M6,11 L8,11 L8,9 L6,9 L6,11 L6,11 Z M6,14 L8,14 L8,12 L6,12 L6,14 L6,14 Z M3,14 L5,14 L5,12 L3,12 L3,14 L3,14 Z M3,2 L5,2 L5,0 L3,0 L3,2 L3,2 Z M3,8 L5,8 L5,6 L3,6 L3,8 L3,8 Z M12,14 L14,14 L14,12 L12,12 L12,14 L12,14 Z M12,8 L14,8 L14,6 L12,6 L12,8 L12,8 Z M12,11 L14,11 L14,9 L12,9 L12,11 L12,11 Z M12,5 L14,5 L14,3 L12,3 L12,5 L12,5 Z M6,2 L8,2 L8,0 L6,0 L6,2 L6,2 Z M12,0 L12,2 L14,2 L14,0 L12,0 L12,0 Z M9,14 L11,14 L11,12 L9,12 L9,14 L9,14 Z M9,8 L11,8 L11,6 L9,6 L9,8 L9,8 Z M9,2 L11,2 L11,0 L9,0 L9,2 L9,2 Z" opacity=".54"/><polygon points="0 14 2 14 2 0 0 0"/></g></svg>`;const BORDER_TOP=`<svg class="o-icon"><g fill="#000000"><path d="M3,8 L5,8 L5,6 L3,6 L3,8 L3,8 Z M0,14 L2,14 L2,12 L0,12 L0,14 L0,14 Z M6,14 L8,14 L8,12 L6,12 L6,14 L6,14 Z M6,11 L8,11 L8,9 L6,9 L6,11 L6,11 Z M3,14 L5,14 L5,12 L3,12 L3,14 L3,14 Z M0,11 L2,11 L2,9 L0,9 L0,11 L0,11 Z M6,8 L8,8 L8,6 L6,6 L6,8 L6,8 Z M0,5 L2,5 L2,3 L0,3 L0,5 L0,5 Z M0,8 L2,8 L2,6 L0,6 L0,8 L0,8 Z M12,8 L14,8 L14,6 L12,6 L12,8 L12,8 Z M12,11 L14,11 L14,9 L12,9 L12,11 L12,11 Z M12,5 L14,5 L14,3 L12,3 L12,5 L12,5 Z M6,5 L8,5 L8,3 L6,3 L6,5 L6,5 Z M9,14 L11,14 L11,12 L9,12 L9,14 L9,14 Z M9,8 L11,8 L11,6 L9,6 L9,8 L9,8 Z M12,14 L14,14 L14,12 L12,12 L12,14 L12,14 Z" opacity=".54"/><polygon points="0 0 0 2 14 2 14 0"/></g></svg>`;const BORDER_RIGHT=`<svg class="o-icon"><g fill="#000000"><path d="M0,2 L2,2 L2,0 L0,0 L0,2 L0,2 Z M3,2 L5,2 L5,0 L3,0 L3,2 L3,2 Z M3,8 L5,8 L5,6 L3,6 L3,8 L3,8 Z M3,14 L5,14 L5,12 L3,12 L3,14 L3,14 Z M0,5 L2,5 L2,3 L0,3 L0,5 L0,5 Z M0,8 L2,8 L2,6 L0,6 L0,8 L0,8 Z M0,14 L2,14 L2,12 L0,12 L0,14 L0,14 Z M0,11 L2,11 L2,9 L0,9 L0,11 L0,11 Z M9,8 L11,8 L11,6 L9,6 L9,8 L9,8 Z M6,14 L8,14 L8,12 L6,12 L6,14 L6,14 Z M9,14 L11,14 L11,12 L9,12 L9,14 L9,14 Z M6,2 L8,2 L8,0 L6,0 L6,2 L6,2 Z M9,2 L11,2 L11,0 L9,0 L9,2 L9,2 Z M6,11 L8,11 L8,9 L6,9 L6,11 L6,11 Z M6,5 L8,5 L8,3 L6,3 L6,5 L6,5 Z M6,8 L8,8 L8,6 L6,6 L6,8 L6,8 Z" opacity=".54"/><polygon points="12 0 12 14 14 14 14 0"/></g></svg>`;const BORDER_BOTTOM=`<svg class="o-icon"><g fill="#000000"><path d="M5,0 L3,0 L3,2 L5,2 L5,0 L5,0 Z M8,6 L6,6 L6,8 L8,8 L8,6 L8,6 Z M8,9 L6,9 L6,11 L8,11 L8,9 L8,9 Z M11,6 L9,6 L9,8 L11,8 L11,6 L11,6 Z M5,6 L3,6 L3,8 L5,8 L5,6 L5,6 Z M11,0 L9,0 L9,2 L11,2 L11,0 L11,0 Z M8,3 L6,3 L6,5 L8,5 L8,3 L8,3 Z M8,0 L6,0 L6,2 L8,2 L8,0 L8,0 Z M2,9 L0,9 L0,11 L2,11 L2,9 L2,9 Z M12,11 L14,11 L14,9 L12,9 L12,11 L12,11 Z M12,5 L14,5 L14,3 L12,3 L12,5 L12,5 Z M12,8 L14,8 L14,6 L12,6 L12,8 L12,8 Z M12,0 L12,2 L14,2 L14,0 L12,0 L12,0 Z M2,0 L0,0 L0,2 L2,2 L2,0 L2,0 Z M2,3 L0,3 L0,5 L2,5 L2,3 L2,3 Z M2,6 L0,6 L0,8 L2,8 L2,6 L2,6 Z" opacity=".54"/><polygon points="0 14 14 14 14 12 0 12"/></g></svg>`;const BORDER_CLEAR=`<svg class="o-icon"><path fill="#000000" fill-rule="evenodd" d="M6,14 L8,14 L8,12 L6,12 L6,14 L6,14 Z M3,8 L5,8 L5,6 L3,6 L3,8 L3,8 Z M3,2 L5,2 L5,0 L3,0 L3,2 L3,2 Z M6,11 L8,11 L8,9 L6,9 L6,11 L6,11 Z M3,14 L5,14 L5,12 L3,12 L3,14 L3,14 Z M0,5 L2,5 L2,3 L0,3 L0,5 L0,5 Z M0,14 L2,14 L2,12 L0,12 L0,14 L0,14 Z M0,2 L2,2 L2,0 L0,0 L0,2 L0,2 Z M0,8 L2,8 L2,6 L0,6 L0,8 L0,8 Z M6,8 L8,8 L8,6 L6,6 L6,8 L6,8 Z M0,11 L2,11 L2,9 L0,9 L0,11 L0,11 Z M12,11 L14,11 L14,9 L12,9 L12,11 L12,11 Z M12,14 L14,14 L14,12 L12,12 L12,14 L12,14 Z M12,8 L14,8 L14,6 L12,6 L12,8 L12,8 Z M12,5 L14,5 L14,3 L12,3 L12,5 L12,5 Z M12,0 L12,2 L14,2 L14,0 L12,0 L12,0 Z M6,2 L8,2 L8,0 L6,0 L6,2 L6,2 Z M9,2 L11,2 L11,0 L9,0 L9,2 L9,2 Z M6,5 L8,5 L8,3 L6,3 L6,5 L6,5 Z M9,14 L11,14 L11,12 L9,12 L9,14 L9,14 Z M9,8 L11,8 L11,6 L9,6 L9,8 L9,8 Z" transform="translate(2 2)" opacity=".54"/></svg>`;const PLUS=`<svg class="o-icon"><path fill="#000000" d="M8,0 L10,0 L10,8 L18,8 L18,10 L10,10 L10,18 L8,18 L8,10 L0,10 L0,8 L8,8"/></svg>`;const LIST=`<svg class="o-icon" viewBox="0 0 384 384"><rect x="0" y="277.333" width="384" height="42.667"/><rect x="0" y="170.667" width="384" height="42.667"/><rect x="0" y="64" width="384" height="42.667"/></svg>`;const{Component}=owl__namespace;const{css,xml}=owl.tags;const COLORS=[["#000000","#434343","#666666","#999999","#b7b7b7","#cccccc","#d9d9d9","#efefef","#f3f3f3","#ffffff",],["#980000","#ff0000","#ff9900","#ffff00","#00ff00","#00ffff","#4a86e8","#0000ff","#9900ff","#ff00ff",],["#e6b8af","#f4cccc","#fce5cd","#fff2cc","#d9ead3","#d0e0e3","#c9daf8","#cfe2f3","#d9d2e9","#ead1dc",],["#dd7e6b","#ea9999","#f9cb9c","#ffe599","#b6d7a8","#a2c4c9","#a4c2f4","#9fc5e8","#b4a7d6","#d5a6bd",],["#cc4125","#e06666","#f6b26b","#ffd966","#93c47d","#76a5af","#6d9eeb","#6fa8dc","#8e7cc3","#c27ba0",],["#a61c00","#cc0000","#e69138","#f1c232","#6aa84f","#45818e","#3c78d8","#3d85c6","#674ea7","#a64d79",],["#85200c","#990000","#b45f06","#bf9000","#38761d","#134f5c","#1155cc","#0b5394","#351c75","#741b47",],["#5b0f00","#660000","#783f04","#7f6000","#274e13","#0c343d","#1c4587","#073763","#20124d","#4c1130",],];class ColorPicker extends Component{constructor(){super(...arguments);this.COLORS=COLORS;}
onColorClick(ev){const color=ev.target.dataset.color;if(color){this.trigger("color-picked",{color});}}}
ColorPicker.template=xml`
  <div class="o-color-picker" t-on-click="onColorClick">
    <div class="o-color-picker-line" t-foreach="COLORS" t-as="colors" t-key="colors">
      <t t-foreach="colors" t-as="color" t-key="color">
        <div class="o-color-picker-line-item" t-att-data-color="color" t-attf-style="background-color:{{color}};"></div>
      </t>
    </div>
  </div>`;ColorPicker.style=css`
    .o-color-picker {
      position: absolute;
      top: calc(100% + 5px);
      left: 0;
      z-index: 10;
      box-shadow: 1px 2px 5px 2px rgba(51, 51, 51, 0.15);
      background-color: white;
      padding: 6px 0px;

      .o-color-picker-line {
        display: flex;
        padding: 3px 6px;
        .o-color-picker-line-item {
          width: 18px;
          height: 18px;
          margin: 0px 2px;
          border-radius: 50px;
          border: 1px solid #c0c0c0;
          &:hover {
            background-color: rgba(0, 0, 0, 0.08);
            outline: 1px solid gray;
          }
        }
      }
    }
  `;const{Component:Component$1,useState,hooks}=owl__namespace;const{useExternalListener}=hooks;const{xml:xml$1,css:css$1}=owl.tags;const PREVIEW_TEMPLATE=xml$1`
    <div class="o-cf-preview-line"
         t-attf-style="font-weight:{{currentStyle.bold ?'bold':'normal'}};
                       text-decoration:{{currentStyle.strikethrough ? 'line-through':'none'}};
                       font-style:{{currentStyle.italic?'italic':'normal'}};
                       color:{{currentStyle.textColor}};
                       background-color:{{currentStyle.fillColor}};"
         t-esc="previewText || env._t('${terms.PREVIEWTEXT}')" />
`;const TEMPLATE=xml$1`
<div>
    <div class="o-section-title" t-esc="env._t('${terms.CF_TITLE}')"></div>
    <div class="o-cf-title-text" t-esc="env._t('${terms.IS_RULE}')"></div>
    <select t-model="state.condition.operator" class="o-input o-cell-is-operator">
        <t t-foreach="Object.keys(cellIsOperators)" t-as="op" t-key="op_index">
            <option t-att-value="op" t-esc="cellIsOperators[op]"/>
        </t>
    </select>
    <input type="text" placeholder="Value" t-model="state.condition.value1" class="o-input o-cell-is-value"/>
    <t t-if="state.condition.operator === 'Between' || state.condition.operator === 'NotBetween'">
        <input type="text" placeholder="and value" t-model="state.condition.value2" class="o-input"/>
    </t>
    <div class="o-cf-title-text" t-esc="env._t('${terms.FORMATTING_STYLE}')"></div>

    <t t-call="${PREVIEW_TEMPLATE}">
        <t t-set="currentStyle" t-value="state.style"/>
    </t>
    <div class="o-tools">
        <div class="o-tool" t-att-title="env._t('${terms.BOLD}')" t-att-class="{active:state.style.bold}" t-on-click="toggleTool('bold')">
            ${BOLD_ICON}
        </div>
        <div class="o-tool" t-att-title="env._t('${terms.ITALIC}')" t-att-class="{active:state.style.italic}" t-on-click="toggleTool('italic')">
            ${ITALIC_ICON}
        </div>
        <div class="o-tool" t-att-title="env._t('${terms.STRIKETHROUGH}')" t-att-class="{active:state.style.strikethrough}"
             t-on-click="toggleTool('strikethrough')">${STRIKE_ICON}
        </div>
        <div class="o-tool o-dropdown o-with-color">
              <span t-att-title="env._t('${terms.TEXTCOLOR}')" t-attf-style="border-color:{{state.style.textColor}}"
                    t-on-click.stop="toggleMenu('textColorTool')">${TEXT_COLOR_ICON}</span>
                    <ColorPicker t-if="state.textColorTool" t-on-color-picked="setColor('textColor')" t-key="textColor"/>
        </div>
        <div class="o-divider"/>
        <div class="o-tool  o-dropdown o-with-color">
              <span t-att-title="env._t('${terms.FILLCOLOR}')" t-attf-style="border-color:{{state.style.fillColor}}"
                    t-on-click.stop="toggleMenu('fillColorTool')">${FILL_COLOR_ICON}</span>
                    <ColorPicker t-if="state.fillColorTool" t-on-color-picked="setColor('fillColor')" t-key="fillColor"/>
        </div>
    </div>
    <div class="o-sidePanelButtons">
      <button t-on-click="onCancel" class="o-sidePanelButton o-cf-cancel" t-esc="env._t('${terms.CANCEL}')"></button>
      <button t-on-click="onSave" class="o-sidePanelButton o-cf-save" t-esc="env._t('${terms.SAVE}')"></button>
    </div>
</div>
`;const CSS=css$1`
  .o-cf-title-text {
    font-size: 12px;
    line-height: 14px;
    margin-bottom: 6px;
    margin-top: 18px;
  }
  .o-cf-preview-line {
    border: 1px solid darkgrey;
    padding: 10px;
  }
`;class CellIsRuleEditor extends Component$1{constructor(){super(...arguments);this.cellIsOperators=cellIsOperators;this.cf=this.props.conditionalFormat;this.rule=this.cf.rule;this.state=useState({condition:{operator:this.rule&&this.rule.operator?this.rule.operator:"Equal",value1:this.rule&&this.rule.values.length>0?this.rule.values[0]:"",value2:this.cf&&this.rule.values.length>1?this.rule.values[1]:"",},textColorTool:false,fillColorTool:false,style:{fillColor:this.cf&&this.rule.style.fillColor,textColor:this.cf&&this.rule.style.textColor,bold:this.cf&&this.rule.style.bold,italic:this.cf&&this.rule.style.italic,strikethrough:this.cf&&this.rule.style.strikethrough,},});useExternalListener(window,"click",this.closeMenus);}
toggleMenu(tool){const current=this.state[tool];this.closeMenus();this.state[tool]=!current;}
toggleTool(tool){this.state.style[tool]=!this.state.style[tool];this.closeMenus();}
setColor(target,ev){const color=ev.detail.color;this.state.style[target]=color;this.closeMenus();}
closeMenus(){this.state.textColorTool=false;this.state.fillColorTool=false;}
onSave(){const newStyle={};const style=this.state.style;if(style.bold!==undefined){newStyle.bold=style.bold;}
if(style.italic!==undefined){newStyle.italic=style.italic;}
if(style.strikethrough!==undefined){newStyle.strikethrough=style.strikethrough;}
if(style.fillColor){newStyle.fillColor=style.fillColor;}
if(style.textColor){newStyle.textColor=style.textColor;}
this.trigger("modify-rule",{rule:{type:"CellIsRule",operator:this.state.condition.operator,values:[this.state.condition.value1,this.state.condition.value2],stopIfTrue:false,style:newStyle,},});}
onCancel(){this.trigger("cancel-edit");}}
CellIsRuleEditor.template=TEMPLATE;CellIsRuleEditor.style=CSS;CellIsRuleEditor.components={ColorPicker};const{Component:Component$2,useState:useState$1,hooks:hooks$1}=owl__namespace;const{useExternalListener:useExternalListener$1}=hooks$1;const{xml:xml$2,css:css$2}=owl.tags;const PREVIEW_TEMPLATE$1=xml$2`
    <div class="o-cf-preview-gradient" t-attf-style="background-image: linear-gradient(to right, #{{colorNumberString(state.minimum.color)}}, #{{colorNumberString(state.maximum.color)}})">
      <div t-esc="previewText">Preview text</div>
    </div>
`;const THRESHOLD_TEMPLATE=xml$2`
  <div t-attf-class="o-threshold o-threshold-{{thresholdType}}">
      <div class="o-tools">
        <div class="o-tool  o-dropdown o-with-color">
        <span title="Fill Color"  t-attf-style="border-color:#{{colorNumberString(threshold.color)}}"
              t-on-click.stop="toggleMenu(thresholdType+'ColorTool')">${FILL_COLOR_ICON}</span>
              <ColorPicker t-if="state[thresholdType+'ColorTool']" t-on-color-picked="setColor(thresholdType)"/>
          </div>
      </div>
      <select name="valueType" t-model="threshold.type" t-on-click="closeMenus">
          <option value="value">Cell values</option>
<!--          <option value="number">Fixed number</option>--> <!-- not yet implemented -->
<!--          <option value="percentage">Percentage</option>-->
<!--          <option value="percentile">Percentile</option>-->
<!--          <option value="formula">Formula</option>-->
      </select>

      <input type="text" t-model="threshold.value" class="o-threshold-value"
            t-att-disabled="threshold.type !== 'number'"/>
  </div>`;const TEMPLATE$1=xml$2`
  <div>
      <div class="o-section-title">Format rules</div>
      <div class="o-cf-title-text">Preview</div>
      <t t-call="${PREVIEW_TEMPLATE$1}"/>
      <div class="o-cf-title-text">Minpoint</div>
      <t t-call="${THRESHOLD_TEMPLATE}">
          <t t-set="threshold" t-value="state.minimum" ></t>
          <t t-set="thresholdType" t-value="'minimum'" ></t>
      </t>
      <div class="o-cf-title-text">MaxPoint</div>
      <t t-call="${THRESHOLD_TEMPLATE}">
          <t t-set="threshold" t-value="state.maximum" ></t>
          <t t-set="thresholdType" t-value="'maximum'" ></t>
      </t>
      <div class="o-sidePanelButtons">
        <button t-on-click="onCancel" class="o-sidePanelButton o-cf-cancel">Cancel</button>
        <button t-on-click="onSave" class="o-sidePanelButton o-cf-save">Save</button>
      </div>
  </div>`;const CSS$1=css$2`
  .o-cf-title-text {
    font-size: 12px;
    line-height: 14px;
    margin-bottom: 6px;
    margin-top: 18px;
  }
  .o-threshold {
    display: flex;
    flex-direction: horizontal;

    .o-threshold-value {
      width: 5em;
      margin-left: 15px;
      margin-right: 15px;
    }
  }
  .o-cf-preview-gradient {
    border: 1px solid darkgrey;
    padding: 10px;
  }
`;class ColorScaleRuleEditor extends Component$2{constructor(){super(...arguments);this.cf=this.props.conditionalFormat;this.colorNumberString=colorNumberString;this.rule=this.cf?this.cf.rule:null;this.state=useState$1({minimum:this.rule?Object.assign({},this.rule.minimum):{color:0xffffff,type:"value",value:null},maximum:this.rule?Object.assign({},this.rule.maximum):{color:0x000000,type:"value",value:null},midpoint:this.rule&&Object.assign({},this.rule.midpoint)?this.rule.midpoint:{color:0xffffff,type:"value",value:null},maximumColorTool:false,minimumColorTool:false,});useExternalListener$1(window,"click",this.closeMenus);}
toggleMenu(tool){const current=this.state[tool];this.closeMenus();this.state[tool]=!current;}
toggleTool(tool){this.closeMenus();}
setColor(target,ev){const color=ev.detail.color;this.state[target].color=Number.parseInt(color.substr(1),16);this.closeMenus();}
closeMenus(){this.state.minimumColorTool=false;this.state.maximumColorTool=false;}
onSave(){this.trigger("modify-rule",{rule:{type:"ColorScaleRule",minimum:this.state.minimum,maximum:this.state.maximum,midpoint:this.state.midpoint,},});}
onCancel(){this.trigger("cancel-edit");}}
ColorScaleRuleEditor.template=TEMPLATE$1;ColorScaleRuleEditor.style=CSS$1;ColorScaleRuleEditor.components={ColorPicker};const{Component:Component$3}=owl__namespace;const{xml:xml$3,css:css$3}=owl.tags;const TEMPLATE$2=xml$3`
  <div class="o-selection">
    <t t-foreach="ranges" t-as="range" t-key="range.id">
      <input
        type="text"
        spellcheck="false"
        t-on-change="onInputChanged(range.id)"
        t-on-focus="focus(range.id)"
        t-att-value="range.xc"
        t-attf-style="color: {{range.color || '#000'}}"
        t-att-class="range.isFocused ? 'o-focused' : ''"
      />
      <button
        class="o-remove-selection"
        t-if="ranges.length > 1"
        t-on-click="removeInput(range.id)"></button>
    </t>

    <div class="o-selection-controls">
      <button
        t-if="canAddRange"
        t-on-click="addEmptyInput"
        class="o-btn o-add-selection">Add another range</button>
      <button
        class="o-btn o-selection-ok"
        t-if="hasFocus"
        t-on-click="disable">OK</button>
    </div>
  </div>`;const CSS$2=css$3`
  .o-selection {
    input {
      padding: 4px 6px;
      border-radius: 4px;
      box-sizing: border-box;
      border: 1px solid #dadce0;
      width: 100%;
    }
    input:focus {
      outline: none;
    }
    input.o-focused {
      border-color: #3266ca;
      border-width: 2px;
      padding: 3px 5px;
    }
    button.o-remove-selection {
      background: transparent;
      border: none;
      color: #333;
      font-size: 17px;
      cursor: pointer;
    }
    button.o-btn {
      margin: 8px 1px;
      border-radius: 4px;
      background: transparent;
      border: 1px solid #dadce0;
      color: #188038;
      font-weight: bold;
      font-size: 14px;
      height: 25px;
    }
  }
`;class SelectionInput extends Component$3{constructor(){super(...arguments);this.id=uuidv4();this.previousRanges=this.props.ranges||[];this.getters=this.env.getters;this.dispatch=this.env.dispatch;}
get ranges(){return this.getters.getSelectionInput(this.id);}
get hasFocus(){return this.ranges.filter((i)=>i.isFocused).length>0;}
get canAddRange(){return!this.props.maximumRanges||this.ranges.length<this.props.maximumRanges;}
mounted(){this.dispatch("ENABLE_NEW_SELECTION_INPUT",{id:this.id,initialRanges:this.props.ranges,maximumRanges:this.props.maximumRanges,});}
async willUnmount(){this.dispatch("DISABLE_SELECTION_INPUT",{id:this.id});}
async patched(){const value=this.getters.getSelectionInputValue(this.id);if(this.previousRanges.join()!==value.join()){this.triggerChange();}}
triggerChange(){const ranges=this.getters.getSelectionInputValue(this.id);this.trigger("selection-changed",{ranges});this.previousRanges=ranges;}
focus(rangeId){this.dispatch("FOCUS_RANGE",{id:this.id,rangeId,});}
addEmptyInput(){this.dispatch("ADD_EMPTY_RANGE",{id:this.id});}
removeInput(rangeId){this.dispatch("REMOVE_RANGE",{id:this.id,rangeId});this.triggerChange();}
onInputChanged(rangeId,ev){const target=ev.target;this.dispatch("CHANGE_RANGE",{id:this.id,rangeId,value:target.value,});target.blur();this.triggerChange();}
disable(){this.dispatch("FOCUS_RANGE",{id:this.id,rangeId:null,});}}
SelectionInput.template=TEMPLATE$2;SelectionInput.style=CSS$2;const{Component:Component$4,useState:useState$2}=owl__namespace;const{xml:xml$4,css:css$4}=owl.tags;const PREVIEW_TEMPLATE$2=xml$4`
<div class="o-cf-preview">
  <div t-att-style="getStyle(cf.rule)" class="o-cf-preview-image">
    123
  </div>
  <div class="o-cf-preview-description">
    <div class="o-cf-preview-ruletype">
      <div class="o-cf-preview-description-rule">
        <t t-esc="getDescription(cf)" />
      </div>
      <div class="o-cf-preview-description-values">
      <t t-if="cf.rule.values">
        <t t-esc="cf.rule.values[0]" />
        <t t-if="cf.rule.values[1]">
          and <t t-esc="cf.rule.values[1]"/>
        </t>
      </t>
      </div>
    </div>
    <div class="o-cf-preview-range" t-esc="cf.ranges"/>
  </div>
  <div class="o-cf-delete">
    <div class="o-cf-delete-button" t-on-click.stop="onDeleteClick(cf)" aria-label="Remove rule">
      x
    </div>
  </div>
</div>`;const TEMPLATE$3=xml$4`
  <div class="o-cf">
    <t t-if="state.mode === 'list'">
      <div class="o-cf-preview-list" >
          <div t-on-click="onRuleClick(cf)" t-foreach="getters.getConditionalFormats()" t-as="cf" t-key="cf.id">
              <t t-call="${PREVIEW_TEMPLATE$2}"/>
          </div>
      </div>
    </t>
    <t t-if="state.mode === 'edit' || state.mode === 'add'" t-key="state.currentCF.id">
        <div class="o-cf-type-selector">
          <div class="o-cf-type-tab" t-att-class="{'o-cf-tab-selected': state.toRuleType === 'CellIsRule'}" t-on-click="setRuleType('CellIsRule')">Single Color</div>
          <div class="o-cf-type-tab" t-att-class="{'o-cf-tab-selected': state.toRuleType === 'ColorScaleRule'}" t-on-click="setRuleType('ColorScaleRule')">Color Scale</div>
        </div>
        <div class="o-cf-ruleEditor">
            <div class="o-section o-cf-range">
              <div class="o-section-title">Apply to range</div>
              <SelectionInput ranges="state.currentRanges" class="o-range" t-on-selection-changed="onRangesChanged"/>
            </div>
            <div class="o-cf-editor o-section">
              <t t-component="editors[state.currentCF.rule.type]"
                  t-key="state.currentCF.id"
                  conditionalFormat="state.currentCF"
                  t-on-cancel-edit="onCancel"
                  t-on-modify-rule="onSave" />
            </div>
        </div>
    </t>
    <div class="o-cf-add" t-if="state.mode === 'list'" t-on-click.prevent.stop="onAdd">
    + Add another rule
    </div>
  </div>`;const CSS$3=css$4`
  .o-cf {
    min-width: 350px;
    .o-cf-type-selector{
      margin-top: 20px;
      display: flex;
      .o-cf-type-tab{
        cursor:pointer;
        flex-grow: 1;
        text-align: center;
      }
      .o-cf-tab-selected{
        text-decoration: underline;
      }
    }
    .o-cf-preview {
      background-color: #fff;
      border-bottom: 1px solid #ccc;
      cursor: pointer;
      display: flex;
      height: 60px;
      padding: 10px;
      position: relative;
      &:hover {
        background-color: rgba(0, 0, 0, 0.08);
      }
      &:not(:hover) .o-cf-delete-button {
        display: none;
      }
      .o-cf-preview-image {
        border: 1px solid lightgrey;
        height: 50px;
        line-height: 50px;
        margin-right: 15px;
        position: absolute;
        text-align: center;
        width: 50px;
      }
      .o-cf-preview-description {
        left: 65px;
        margin-bottom: auto;
        margin-right: 8px;
        margin-top: auto;
        position: relative;
        width: 142px;
        .o-cf-preview-description-rule {
          margin-bottom: 4px;
          overflow: hidden;
        }
        .o-cf-preview-description-values{
          overflow: hidden;
        }
        .o-cf-preview-range{
          text-overflow: ellipsis;
          font-size: 12px;
          overflow: hidden;
        }
      }
      .o-cf-delete{
        height: 56px;
        left: 90%;
        line-height: 56px;
        position: absolute;
      }
    }
    .o-cf-ruleEditor {
      .o-dropdown {
        position: relative;
        .o-dropdown-content {
          position: absolute;
          top: calc(100% + 5px);
          left: 0;
          z-index: 10;
          box-shadow: 1px 2px 5px 2px rgba(51, 51, 51, 0.15);
          background-color: #f6f6f6;

          .o-dropdown-item {
            padding: 7px 10px;
          }
          .o-dropdown-item:hover {
            background-color: rgba(0, 0, 0, 0.08);
          }
          .o-dropdown-line {
            display: flex;
            padding: 3px 6px;
            .o-line-item {
              width: 16px;
              height: 16px;
              margin: 1px 3px;
              &:hover {
                background-color: rgba(0, 0, 0, 0.08);
              }
            }
          }
        }
      }

      .o-tools {
        color: #333;
        font-size: 13px;
        cursor: default;
        display: flex;

        .o-tool {
          display: flex;
          align-items: center;
          margin: 2px;
          padding: 0 3px;
          border-radius: 2px;
        }

        .o-tool.active,
        .o-tool:not(.o-disabled):hover {
          background-color: rgba(0, 0, 0, 0.08);
        }

        .o-with-color > span {
          border-bottom: 4px solid;
          height: 16px;
          margin-top: 2px;
        }
        .o-with-color {
          .o-line-item:hover {
            outline: 1px solid gray;
          }
        }
        .o-border {
          .o-line-item {
            padding: 4px;
            margin: 1px;
          }
        }
      }
      .o-cell-content {
        font-size: 12px;
        font-weight: 500;
        padding: 0 12px;
        margin: 0;
        line-height: 35px;
      }
    }
    .o-cf-add {
      font-size: 14px;
      height: 36px;
      padding: 20px 24px 11px 24px;
      height: 44px;
      cursor: pointer;
    }
  }
  }`;class ConditionalFormattingPanel extends Component$4{constructor(parent,props){super(parent,props);this.colorNumberString=colorNumberString;this.getters=this.env.getters;this.cellIsOperators=cellIsOperators;this.state=useState$2({currentCF:undefined,currentRanges:[],mode:"list",toRuleType:"CellIsRule",});this.editors={CellIsRule:CellIsRuleEditor,ColorScaleRule:ColorScaleRuleEditor,};if(props.selection&&this.getters.getRulesSelection(props.selection).length===1){this.openCf(this.getters.getRulesSelection(props.selection)[0]);}}
async willUpdateProps(nextProps){if(nextProps.selection&&nextProps.selection!==this.props.selection)
if(nextProps.selection&&this.getters.getRulesSelection(nextProps.selection).length===1){this.openCf(this.getters.getRulesSelection(nextProps.selection)[0]);}
else{this.resetState();}}
resetState(){this.state.currentCF=undefined;this.state.currentRanges=[];this.state.mode="list";this.state.toRuleType="CellIsRule";}
getStyle(rule){if(rule.type==="CellIsRule"){const cellRule=rule;const fontWeight=cellRule.style.bold?"bold":"normal";const fontDecoration=cellRule.style.strikethrough?"line-through":"none";const fontStyle=cellRule.style.italic?"italic":"normal";const color=cellRule.style.textColor||"none";const backgroundColor=cellRule.style.fillColor||"none";return`font-weight:${fontWeight}
               text-decoration:${fontDecoration};
               font-style:${fontStyle};
               color:${color};
               background-color:${backgroundColor};`;}
else{const colorScale=rule;return`background-image: linear-gradient(to right, #${colorNumberString(colorScale.minimum.color)}, #${colorNumberString(colorScale.maximum.color)})`;}}
getDescription(cf){return cf.rule.type==="CellIsRule"?cellIsOperators[cf.rule.operator]:"Color scale";}
onSave(ev){if(this.state.currentCF){this.env.dispatch("ADD_CONDITIONAL_FORMAT",{cf:{rule:ev.detail.rule,ranges:this.state.currentRanges,id:this.state.mode==="edit"?this.state.currentCF.id:uuidv4(),},sheet:this.getters.getActiveSheet(),});}
this.state.mode="list";}
onCancel(){this.state.mode="list";this.state.currentCF=undefined;}
onDeleteClick(cf){this.env.dispatch("REMOVE_CONDITIONAL_FORMAT",{id:cf.id,sheet:this.getters.getActiveSheet(),});}
onRuleClick(cf){this.state.mode="edit";this.state.currentCF=cf;this.state.toRuleType=cf.rule.type==="CellIsRule"?"CellIsRule":"ColorScaleRule";this.state.currentRanges=this.state.currentCF.ranges;}
openCf(cfId){const rules=this.getters.getConditionalFormats();const cfIndex=rules.findIndex((c)=>c.id===cfId);const cf=rules[cfIndex];if(cf){this.state.mode="edit";this.state.currentCF=cf;this.state.toRuleType=cf.rule.type==="CellIsRule"?"CellIsRule":"ColorScaleRule";this.state.currentRanges=this.state.currentCF.ranges;}}
defaultCellIsRule(){return{rule:{type:"CellIsRule",operator:"Equal",values:[],style:{fillColor:"#FF0000"},},ranges:this.getters.getSelectedZones().map(this.getters.zoneToXC),id:uuidv4(),};}
defaultColorScaleRule(){return{rule:{minimum:{type:"value",color:0},maximum:{type:"value",color:0xeeffee},type:"ColorScaleRule",},ranges:this.getters.getSelectedZones().map(this.getters.zoneToXC),id:uuidv4(),};}
onAdd(){this.state.mode="add";this.state.currentCF=this.defaultCellIsRule();this.state.currentRanges=this.state.currentCF.ranges;}
setRuleType(ruleType){if(ruleType==="ColorScaleRule"){this.state.currentCF=this.defaultColorScaleRule();}
if(ruleType==="CellIsRule"){this.state.currentCF=this.defaultCellIsRule();}
this.state.toRuleType=ruleType;}
onRangesChanged({detail}){this.state.currentRanges=detail.ranges;}}
ConditionalFormattingPanel.template=TEMPLATE$3;ConditionalFormattingPanel.style=CSS$3;ConditionalFormattingPanel.components={CellIsRuleEditor,ColorScaleRuleEditor,SelectionInput};const{Component:Component$5,useState:useState$3}=owl__namespace;const{xml:xml$5}=owl.tags;const TEMPLATE$4=xml$5`
  <div class="o-chart">
    <div class="o-section">
      <div class="o-section-title"><t t-esc="env._t('${chartTerms.ChartType}')"/></div>
      <select t-model="state.type" class="o-input o-type-selector">
        <option value="bar" t-esc="env._t('${chartTerms.Bar}')"/>
        <option value="line" t-esc="env._t('${chartTerms.Line}')"/>
        <option value="pie" t-esc="env._t('${chartTerms.Pie}')"/>
      </select>
    </div>
    <div class="o-section o-chart-title">
      <div class="o-section-title" t-esc="env._t('${chartTerms.Title}')"/>
      <input type="text" t-model="state.title" class="o-input" t-att-placeholder="env._t('${chartTerms.TitlePlaceholder}')"/>
    </div>
    <div class="o-section o-data-series">
      <div class="o-section-title" t-esc="env._t('${chartTerms.DataSeries}')"/>
      <SelectionInput ranges="state.ranges" t-on-selection-changed="onSeriesChanged"/>
      <input type="checkbox" t-model="state.seriesHasTitle"/><t t-esc="env._t('${chartTerms.MyDataHasTitle}')"/>
    </div>
    <div class="o-section o-data-labels">
        <div class="o-section-title" t-esc="env._t('${chartTerms.DataCategories}')"/>
        <SelectionInput ranges="[state.labelRange]" t-on-selection-changed="onLabelRangeChanged" maximumRanges="1"/>
    </div>
    <div class="o-sidePanelButtons">
      <button t-if="props.figure" t-on-click="updateChart(props.figure)" class="o-sidePanelButton" t-esc="env._t('${chartTerms.UpdateChart}')"/>
      <button t-else="" t-on-click="createChart" class="o-sidePanelButton" t-esc="env._t('${chartTerms.CreateChart}')"/>
    </div>
  </div>
`;class ChartPanel extends Component$5{constructor(){super(...arguments);this.getters=this.env.getters;this.state=useState$3(this.initialState());}
onSeriesChanged(ev){this.state.ranges=ev.detail.ranges;}
onLabelRangeChanged(ev){this.state.labelRange=ev.detail.ranges[0];}
createChart(){this.env.dispatch("CREATE_CHART",{sheetId:this.getters.getActiveSheet(),id:uuidv4(),definition:this.getChartDefinition(),});this.trigger("close-side-panel");}
updateChart(chart){this.env.dispatch("UPDATE_CHART",{id:chart.id,definition:this.getChartDefinition(),});this.trigger("close-side-panel");}
getChartDefinition(){return{type:this.state.type,title:this.state.title,labelRange:this.state.labelRange.trim()||"",dataSets:this.state.ranges.slice(),seriesHasTitle:this.state.seriesHasTitle,};}
initialState(){const data=this.props.figure?this.props.figure.data:undefined;return{title:data&&data.title?data.title:"",ranges:data?data.dataSets.map((ds)=>ds.dataRange):[],labelRange:data?data.labelRange:"",type:data?data.type:"bar",seriesHasTitle:data?data.title!==undefined:false,};}}
ChartPanel.template=TEMPLATE$4;ChartPanel.components={SelectionInput};const sidePanelRegistry=new Registry();sidePanelRegistry.add("ConditionalFormatting",{title:_lt("Conditional formatting"),Body:ConditionalFormattingPanel,});sidePanelRegistry.add("ChartPanel",{title:_lt("Chart"),Body:ChartPanel,});const{xml:xml$6,css:css$5}=owl.tags;const TEMPLATE$5=xml$6`
  <div class="o-fig-text">
    <p t-esc="props.figure.data"/>
  </div>
`;const CSS$4=css$5`
  .o-fig-text {
    width: 100%;
    height: 100%;
    margin: 0px;
    background-color: #eee;
    position: absolute;

    > p {
      margin: 5px;
    }
  }
`;class TextFigure extends owl.Component{}
TextFigure.template=TEMPLATE$5;TextFigure.style=CSS$4;const{xml:xml$7,css:css$6}=owl.tags;const{useRef}=owl.hooks;const TEMPLATE$6=xml$7`
<div class="o-chart-container">
    <canvas t-ref="graphContainer" />
</div>`;const CSS$5=css$6`
  .o-chart-container {
    width: 100%;
    height: 100%;
    position: relative;

    > canvas {
      background-color: white;
    }
  }
`;class ChartFigure extends owl.Component{constructor(){super(...arguments);this.canvas=useRef("graphContainer");}
mounted(){this.createChart();}
patched(){const figure=this.props.figure;const chartData=this.env.getters.getChartRuntime(figure.id);if(chartData){if(chartData.data&&chartData.data.datasets){Object.assign(this.chart.data.datasets,chartData.data.datasets);Object.assign(this.chart.data.labels,chartData.data.labels);}
else{this.chart.data.datasets=undefined;}
this.chart.update({duration:0});}
else{this.chart&&this.chart.destroy();}}
createChart(){const figure=this.props.figure;const charData=this.env.getters.getChartRuntime(figure.id);if(charData){const canvas=this.canvas.el;const ctx=canvas.getContext("2d");this.chart=new window.Chart(ctx,charData);}}}
ChartFigure.template=TEMPLATE$6;ChartFigure.style=CSS$5;ChartFigure.components={};const figureRegistry=new Registry();figureRegistry.add("text",{Component:TextFigure});figureRegistry.add("chart",{Component:ChartFigure,SidePanelComponent:"ChartPanel"});const topbarComponentRegistry=new Registry();class AutofillGenerator{constructor(cells,getters,direction){this.index=0;this.cells=cells;this.getters=getters;this.direction=direction;}
next(){const genCell=this.cells[this.index++%this.cells.length];if(!genCell.rule){return{cellData:genCell.data,tooltip:genCell.data.content?{props:genCell.data.content}:undefined,};}
const rule=genCell.rule;const{cellData,tooltip}=autofillModifiersRegistry.get(rule.type).apply(rule,genCell.data,this.getters,this.direction);return{cellData:Object.assign({},genCell.data,cellData),tooltip,};}}
class AutofillPlugin extends BasePlugin{constructor(){super(...arguments);this.lastCellSelected={};}
allowDispatch(cmd){switch(cmd.type){case"AUTOFILL_SELECT":const sheetId=this.getters.getActiveSheet();this.lastCellSelected.col=cmd.col===-1?this.lastCellSelected.col:clip(cmd.col,0,this.getters.getNumberCols(sheetId));this.lastCellSelected.row=cmd.row===-1?this.lastCellSelected.row:clip(cmd.row,0,this.getters.getNumberRows(sheetId));if(this.lastCellSelected.col!==undefined&&this.lastCellSelected.row!==undefined){return{status:"SUCCESS"};}
return{status:"CANCELLED",reason:17};case"AUTOFILL_AUTO":const zone=this.getters.getSelectedZone();return zone.top===zone.bottom?{status:"SUCCESS"}:{status:"CANCELLED",reason:0};}
return{status:"SUCCESS"};}
handle(cmd){switch(cmd.type){case"AUTOFILL":this.autofill(true);break;case"AUTOFILL_SELECT":this.select(cmd.col,cmd.row);break;case"AUTOFILL_AUTO":this.autofillAuto();break;case"AUTOFILL_CELL":const sheet=this.getters.getActiveSheet();this.dispatch("UPDATE_CELL",{sheet,col:cmd.col,row:cmd.row,style:cmd.style,border:cmd.border,content:cmd.content,format:cmd.format,});}}
getAutofillTooltip(){return this.tooltip;}
autofill(apply){if(!this.autofillZone||this.direction===undefined){return;}
const source=this.getters.getSelectedZone();const target=this.autofillZone;switch(this.direction){case 1:for(let col=source.left;col<=source.right;col++){const xcs=[];for(let row=source.top;row<=source.bottom;row++){xcs.push(toXC(col,row));}
const generator=this.createGenerator(xcs);for(let row=target.top;row<=target.bottom;row++){this.computeNewCell(generator,col,row,apply);}}
break;case 0:for(let col=source.left;col<=source.right;col++){const xcs=[];for(let row=source.bottom;row>=source.top;row--){xcs.push(toXC(col,row));}
const generator=this.createGenerator(xcs);for(let row=target.bottom;row>=target.top;row--){this.computeNewCell(generator,col,row,apply);}}
break;case 2:for(let row=source.top;row<=source.bottom;row++){const xcs=[];for(let col=source.right;col>=source.left;col--){xcs.push(toXC(col,row));}
const generator=this.createGenerator(xcs);for(let col=target.right;col>=target.left;col--){this.computeNewCell(generator,col,row,apply);}}
break;case 3:for(let row=source.top;row<=source.bottom;row++){const xcs=[];for(let col=source.left;col<=source.right;col++){xcs.push(toXC(col,row));}
const generator=this.createGenerator(xcs);for(let col=target.left;col<=target.right;col++){this.computeNewCell(generator,col,row,apply);}}
break;}
if(apply){const zone=union(this.getters.getSelectedZone(),this.autofillZone);this.autofillZone=undefined;this.lastCellSelected={};this.direction=undefined;this.tooltip=undefined;this.dispatch("SET_SELECTION",{zones:[zone],anchor:[zone.left,zone.top],});}}
select(col,row){const source=this.getters.getSelectedZone();if(isInside(col,row,source)){this.autofillZone=undefined;return;}
this.direction=this.getDirection(col,row);switch(this.direction){case 0:this.saveZone(row,source.top-1,source.left,source.right);break;case 1:this.saveZone(source.bottom+1,row,source.left,source.right);break;case 2:this.saveZone(source.top,source.bottom,col,source.left-1);break;case 3:this.saveZone(source.top,source.bottom,source.right+1,col);break;}
this.autofill(false);}
autofillAuto(){const zone=this.getters.getSelectedZone();let col=zone.left;let row=zone.bottom;if(col>0){let left=this.getters.getCell(col-1,row);while(left&&left.content){row+=1;left=this.getters.getCell(col-1,row);}}
if(row===zone.bottom){col=zone.right;if(col<=this.getters.getNumberCols(this.getters.getActiveSheet())){let right=this.getters.getCell(col+1,row);while(right&&right.content){row+=1;right=this.getters.getCell(col+1,row);}}}
if(row!==zone.bottom){this.select(zone.left,row-1);this.autofill(true);}}
computeNewCell(generator,col,row,apply){const{cellData,tooltip}=generator.next();const{col:originCol,row:originRow,content,style,border,format}=cellData;this.tooltip=tooltip;if(apply){this.dispatch("AUTOFILL_CELL",{originCol,originRow,col,row,content,style,border,format,});}}
getRule(cell,cells){const rules=autofillRulesRegistry.getAll().sort((a,b)=>a.sequence-b.sequence);const rule=rules.find((rule)=>rule.condition(cell,cells));return rule&&rule.generateRule(cell,cells);}
createGenerator(source){const nextCells=[];const cellsData=[];for(let xc of source){const[col,row]=toCartesian(xc);const cell=this.getters.getCell(col,row);let cellData={col,row,cell,};cellsData.push(cellData);}
const cells=cellsData.map((cellData)=>cellData.cell);for(let cellData of cellsData){let rule;if(cellData&&cellData.cell&&cellData.cell.content){rule=this.getRule(cellData.cell,cells);}
else{rule={type:"COPY_MODIFIER"};}
const data={row:cellData.row,col:cellData.col,content:cellData.cell?cellData.cell.content:undefined,style:cellData.cell?cellData.cell.style:undefined,border:cellData.cell?cellData.cell.border:undefined,format:cellData.cell?cellData.cell.format:undefined,};nextCells.push({data,rule});}
return new AutofillGenerator(nextCells,this.getters,this.direction);}
saveZone(top,bottom,left,right){this.autofillZone={top,bottom,left,right};}
getDirection(col,row){const source=this.getters.getSelectedZone();const position={up:{number:source.top-row,value:0},down:{number:row-source.bottom,value:1},left:{number:source.left-col,value:2},right:{number:col-source.right,value:3},};if(Object.values(position).map((x)=>(x.number>0?1:0)).reduce((acc,value)=>acc+value)===1){return Object.values(position).find((x)=>(x.number>0?1:0)).value;}
const first=position.up.number>0?"up":"down";const second=position.left.number>0?"left":"right";return Math.abs(position[first].number)>=Math.abs(position[second].number)?position[first].value:position[second].value;}
drawGrid(renderingContext){if(!this.autofillZone){return;}
const{viewport,ctx,thinLineWidth}=renderingContext;const[x,y,width,height]=this.getters.getRect(this.autofillZone,viewport);if(width>0&&height>0){ctx.strokeStyle="black";ctx.lineWidth=thinLineWidth;ctx.setLineDash([3]);ctx.strokeRect(x,y,width,height);ctx.setLineDash([]);}}}
AutofillPlugin.layers=[5];AutofillPlugin.getters=["getAutofillTooltip"];AutofillPlugin.modes=["normal","readonly"];class HighlightPlugin extends BasePlugin{constructor(){super(...arguments);this.highlights=[];this.color="#000";this.highlightSelectionEnabled=false;this.pendingHighlights=[];}
handle(cmd){switch(cmd.type){case"ADD_HIGHLIGHTS":this.addHighlights(cmd.ranges);break;case"REMOVE_ALL_HIGHLIGHTS":this.highlights=[];break;case"REMOVE_HIGHLIGHTS":this.removeHighlights(cmd.ranges);break;case"SELECT_CELL":case"SET_SELECTION":if(this.highlightSelectionEnabled){this.highlightSelection();}
break;case"START_SELECTION_EXPANSION":this.color=getNextColor();break;case"HIGHLIGHT_SELECTION":this.highlightSelectionEnabled=cmd.enabled;if(!cmd.enabled){this.dispatch("RESET_PENDING_HIGHLIGHT");}
break;case"RESET_PENDING_HIGHLIGHT":this.pendingHighlights=[];break;case"ADD_PENDING_HIGHLIGHTS":this.addPendingHighlight(cmd.ranges);break;case"SET_HIGHLIGHT_COLOR":this.color=cmd.color;}}
getHighlights(){return this.highlights;}
addHighlights(ranges){let highlights=this.prepareHighlights(ranges);this.highlights=this.highlights.concat(highlights);}
addPendingHighlight(ranges){let highlights=this.prepareHighlights(ranges);this.pendingHighlights=this.pendingHighlights.concat(highlights);}
prepareHighlights(ranges){if(Object.keys(ranges).length===0){return[];}
return Object.keys(ranges).map((r1c1)=>{const[xc,sheet]=r1c1.split("!").reverse();const sheetId=sheet?this.getters.getSheetIdByName(sheet):this.getters.getActiveSheet();const zone=this.getters.expandZone(toZone(xc));return{zone,color:ranges[r1c1],sheet:sheetId};}).filter((x)=>x.zone.top>=0&&x.zone.left>=0&&x.zone.bottom<this.workbook.activeSheet.rows.length&&x.zone.right<this.workbook.activeSheet.cols.length);}
removeHighlights(ranges){this.highlights=this.highlights.filter((h)=>ranges[this.getters.zoneToXC(h.zone)]!==h.color);}
highlightSelection(){this.removePendingHighlights();const zones=this.getters.getSelectedZones().filter((z)=>!this.isHighlighted(z));const ranges={};let color=this.color;for(const zone of zones){ranges[this.getters.zoneToXC(zone)]=color;color=getNextColor();}
this.dispatch("ADD_HIGHLIGHTS",{ranges});this.dispatch("ADD_PENDING_HIGHLIGHTS",{ranges});}
isHighlighted(zone){return!!this.highlights.find((h)=>isEqual(h.zone,zone));}
removePendingHighlights(){const ranges={};const[selected,notSelected]=this.pendingHighlights.reduce(([y,n],highlight)=>this.getters.isSelected(highlight.zone)?[[...y,highlight],n]:[y,[...n,highlight]],[[],[]]);for(const{zone,color}of notSelected){ranges[this.getters.zoneToXC(zone)]=color;}
this.dispatch("REMOVE_HIGHLIGHTS",{ranges});this.pendingHighlights=selected;}
drawGrid(renderingContext){const{ctx,viewport,thinLineWidth}=renderingContext;ctx.lineWidth=3*thinLineWidth;for(let h of this.highlights.filter((highlight)=>highlight.sheet===this.getters.getActiveSheet())){const[x,y,width,height]=this.getters.getRect(h.zone,viewport);if(width>0&&height>0){ctx.strokeStyle=h.color;ctx.strokeRect(x,y,width,height);}}}}
HighlightPlugin.modes=["normal","readonly"];HighlightPlugin.layers=[1];HighlightPlugin.getters=["getHighlights"];class SelectionInputPlugin extends BasePlugin{constructor(){super(...arguments);this.inputs={};this.inputMaximums={};this.focusedInput=null;this.focusedRange=null;this.willAddNewRange=false;}
allowDispatch(cmd){switch(cmd.type){case"FOCUS_RANGE":const index=this.getIndex(cmd.id,cmd.rangeId);if(this.focusedInput===cmd.id&&this.focusedRange===index){return{status:"CANCELLED",reason:14};}
break;case"ADD_EMPTY_RANGE":if(this.inputs[cmd.id].length===this.inputMaximums[cmd.id]){return{status:"CANCELLED",reason:15};}
break;}
return{status:"SUCCESS"};}
handle(cmd){switch(cmd.type){case"ENABLE_NEW_SELECTION_INPUT":this.initInput(cmd.id,cmd.initialRanges||[],cmd.maximumRanges);break;case"DISABLE_SELECTION_INPUT":if(this.focusedInput===cmd.id){this.dispatch("HIGHLIGHT_SELECTION",{enabled:false});this.dispatch("REMOVE_ALL_HIGHLIGHTS");this.focusedRange=null;this.focusedInput=null;}
delete this.inputs[cmd.id];delete this.inputMaximums[cmd.id];break;case"FOCUS_RANGE":this.focus(cmd.id,this.getIndex(cmd.id,cmd.rangeId));break;case"CHANGE_RANGE":{const index=this.getIndex(cmd.id,cmd.rangeId);if(index!==null){this.changeRange(cmd.id,index,cmd.value);}
break;}
case"ADD_EMPTY_RANGE":this.inputs[cmd.id]=[...this.inputs[cmd.id],Object.freeze({xc:"",id:uuidv4()})];this.focusLast(cmd.id);break;case"REMOVE_RANGE":const index=this.getIndex(cmd.id,cmd.rangeId);if(index!==null){this.removeRange(cmd.id,index);}
break;case"ADD_HIGHLIGHTS":const highlights=this.getters.getHighlights();this.add(highlights.slice(highlights.length-Object.keys(cmd.ranges).length));break;case"START_SELECTION_EXPANSION":if(this.willAddNewRange){this.dispatch("RESET_PENDING_HIGHLIGHT");}
break;case"PREPARE_SELECTION_EXPANSION":{const[id,index]=[this.focusedInput,this.focusedRange];if(id!==null&&index!==null){this.willAddNewRange=this.inputs[id][index].xc.trim()!=="";}
break;}}}
getSelectionInput(id){if(!this.inputs[id]){return[];}
return this.inputs[id].map((input,index)=>Object.assign({},input,{color:this.focusedInput===id&&this.focusedRange!==null?input.color:null,isFocused:this.focusedInput===id&&this.focusedRange===index,}));}
getSelectionInputValue(id){return this.cleanInputs(this.inputs[id].map((range)=>range.xc));}
initInput(id,initialRanges,maximumRanges){this.inputs[id]=initialRanges.map((r)=>Object.freeze({xc:r,id:uuidv4(),}));if(maximumRanges!==undefined){this.inputMaximums[id]=maximumRanges;}
if(this.inputs[id].length===0){this.dispatch("ADD_EMPTY_RANGE",{id});}}
focus(id,index){const currentFocusedInput=this.focusedInput;const currentFocusedRange=this.focusedInput&&this.focusedRange;this.focusedInput=id;if(currentFocusedRange!==null&&index==null){this.dispatch("HIGHLIGHT_SELECTION",{enabled:false});this.removeAllHighlights();}
if(currentFocusedInput!==null&&id!==null&&currentFocusedInput!==id){this.removeAllHighlights();}
if((currentFocusedRange===null&&index!==null)||currentFocusedInput!==id){this.dispatch("HIGHLIGHT_SELECTION",{enabled:true});this.highlightAllRanges(id);}
this.setPendingRange(id,index);if(index!==null){const color=this.inputs[id][index].color||getNextColor();this.dispatch("SET_HIGHLIGHT_COLOR",{color});}
this.focusedRange=index;}
focusLast(id){this.focus(id,this.inputs[id].length-1);}
removeAllHighlights(){this.dispatch("REMOVE_ALL_HIGHLIGHTS");}
highlightAllRanges(id){const inputs=this.inputs[id];for(const[index,input]of inputs.entries()){this.focusedRange=index;const ranges=this.inputToHighlights(input);if(Object.keys(ranges).length>0){this.dispatch("ADD_HIGHLIGHTS",{ranges});}}}
add(newHighlights){if(this.focusedInput===null||this.focusedRange===null||this.getters.getEditionMode()==="selecting"||newHighlights.length===0){return;}
const mode=this.getters.getSelectionMode();if(mode===SelectionMode.expanding&&this.willAddNewRange){this.addNewRange(this.focusedInput,newHighlights);this.willAddNewRange=false;}
else{this.setRange(this.focusedInput,this.focusedRange,newHighlights);}}
addNewRange(id,highlights){if(this.inputMaximums[id]<this.inputs[id].length+highlights.length){return;}
this.inputs[id]=this.inputs[id].concat(this.highlightsToInput(highlights));this.focusLast(id);}
setRange(id,index,highlights){let[existingRange,...newRanges]=this.highlightsToInput(highlights);const additionalRanges=this.inputs[id].length+newRanges.length-this.inputMaximums[id];if(additionalRanges){newRanges=newRanges.slice(0,newRanges.length-additionalRanges);}
this.inputs[id].splice(index,1,existingRange,...newRanges);if(newRanges.length){this.focus(id,index+newRanges.length);}}
changeRange(id,index,value){if(this.focusedInput!==id||this.focusedRange!==index){this.dispatch("FOCUS_RANGE",{id,rangeId:this.inputs[id][index].id});}
const input=this.inputs[id][index];this.dispatch("REMOVE_HIGHLIGHTS",{ranges:this.inputToHighlights(input)});this.dispatch("ADD_HIGHLIGHTS",{ranges:this.inputToHighlights({color:input.color,xc:value,}),});}
removeRange(id,index){const[removedRange]=this.inputs[id].splice(index,1);if(this.focusedInput===id&&this.focusedRange!==null){this.dispatch("REMOVE_HIGHLIGHTS",{ranges:this.inputToHighlights(removedRange),});this.focusLast(id);}}
setPendingRange(id,index){this.dispatch("RESET_PENDING_HIGHLIGHT");if(index!==null&&this.inputs[id][index].xc){this.dispatch("ADD_PENDING_HIGHLIGHTS",{ranges:this.inputToHighlights(this.inputs[id][index]),});}}
highlightsToInput(highlights){return highlights.map((h)=>Object.freeze({xc:this.getters.zoneToXC(h.zone),id:uuidv4(),color:h.color,}));}
inputToHighlights({xc,color,}){const ranges=this.cleanInputs([xc]);if(ranges.length===0)
return{};const[fromInput,...otherRanges]=ranges;const highlights={[fromInput]:color||getNextColor(),};for(const range of otherRanges){highlights[range]=getNextColor();}
return highlights;}
isRangeValid(xc){return xc.match(rangeReference)!==null;}
cleanInputs(ranges){return ranges.map((xc)=>xc.split(",")).flat().map((xc)=>xc.trim()).filter((xc)=>xc!=="").filter(this.isRangeValid);}
getIndex(id,rangeId){const index=this.inputs[id].findIndex((range)=>range.id===rangeId);return index>=0?index:null;}}
SelectionInputPlugin.modes=["normal","readonly"];SelectionInputPlugin.layers=[1];SelectionInputPlugin.getters=["getSelectionInput","getSelectionInputValue"];class FigurePlugin extends BasePlugin{constructor(){super(...arguments);this.selectedFigureId=null;this.figures={};this.sheetFigures={};}
handle(cmd){switch(cmd.type){case"DUPLICATE_SHEET":for(let fig of this.sheetFigures[cmd.sheet]||[]){const figure=Object.assign({},fig,{id:uuidv4()});this.dispatch("CREATE_FIGURE",{sheet:cmd.id,figure,});}
break;case"DELETE_SHEET":this.deleteSheet(cmd.sheet);break;case"CREATE_FIGURE":this.history.updateLocalState(["figures",cmd.figure.id],cmd.figure);const sheetFigures=(this.sheetFigures[cmd.sheet]||[]).slice();sheetFigures.push(cmd.figure);this.history.updateLocalState(["sheetFigures",cmd.sheet],sheetFigures);break;case"UPDATE_FIGURE":if(cmd.x!==undefined){this.history.updateLocalState(["figures",cmd.id,"x"],Math.max(cmd.x,0));}
if(cmd.y!==undefined){this.history.updateLocalState(["figures",cmd.id,"y"],Math.max(cmd.y,0));}
if(cmd.width!==undefined){this.history.updateLocalState(["figures",cmd.id,"width"],cmd.width);}
if(cmd.height!==undefined){this.history.updateLocalState(["figures",cmd.id,"height"],cmd.height);}
if(cmd.data!==undefined){this.history.updateLocalState(["figures",cmd.id,"data"],cmd.data);}
break;case"SELECT_FIGURE":this.selectedFigureId=cmd.id;break;case"DELETE_FIGURE":this.history.updateLocalState(["figures",cmd.id],undefined);for(let s in this.sheetFigures){let deletedFigureIndex=this.sheetFigures[s].findIndex((f)=>f.id===cmd.id);if(deletedFigureIndex>-1){const copy=this.sheetFigures[s].slice();copy.splice(deletedFigureIndex,1);this.history.updateLocalState(["sheetFigures",s],copy);this.selectedFigureId=null;}}
break;case"EVALUATE_CELLS":break;default:this.selectedFigureId=null;}}
deleteSheet(sheet){for(let figure of this.sheetFigures[sheet]||[]){this.history.updateLocalState(["figures",figure.id],undefined);}
const sheetFigures=Object.assign({},this.sheetFigures);delete sheetFigures[sheet];this.history.updateLocalState(["sheetFigures"],sheetFigures);}
getFigures(viewport){const result=[];const figures=this.sheetFigures[this.workbook.activeSheet.id]||[];const{offsetX,offsetY,width,height}=viewport;for(let figure of figures){if(figure.x>=offsetX+width||figure.x+figure.width<=offsetX){continue;}
if(figure.y>=offsetY+height||figure.y+figure.height<=offsetY){continue;}
result.push(figure);}
return result;}
getSelectedFigureId(){return this.selectedFigureId;}
getFigure(figureId){return this.figures[figureId];}
import(data){for(let sheet of data.sheets){const figList=[];for(let f of sheet.figures){this.figures[f.id]=f;figList.push(f);}
this.sheetFigures[sheet.id]=figList;}}
export(data){for(let sheetData of data.sheets){sheetData.figures=this.sheetFigures[sheetData.id]||[];}}}
FigurePlugin.getters=["getFigures","getSelectedFigureId","getFigure"];const pluginRegistry=new Registry().add("core",CorePlugin).add("evaluation",EvaluationPlugin).add("clipboard",ClipboardPlugin).add("merge",MergePlugin).add("formatting",FormattingPlugin).add("edition",EditionPlugin).add("selection",SelectionPlugin).add("highlight",HighlightPlugin).add("selectionInput",SelectionInputPlugin).add("conditional formatting",ConditionalFormatPlugin).add("figures",FigurePlugin).add("chart",ChartPlugin).add("grid renderer",RendererPlugin).add("autofill",AutofillPlugin);const CURRENT_VERSION=5;function load(data){if(!data){return createEmptyWorkbookData();}
data=Object.assign({},data);if("version"in data){if(data.version<CURRENT_VERSION){data=migrate(data);}}
data=Object.assign(createEmptyWorkbookData(),data,{version:CURRENT_VERSION});data.sheets=data.sheets.map((s,i)=>Object.assign(createEmptySheet(`Sheet${i + 1}`),s));if(!data.sheets.map((s)=>s.id).includes(data.activeSheet)){data.activeSheet=data.sheets[0].id;}
if(data.sheets.length===0){data.sheets.push(createEmptySheet());}
return data;}
function migrate(data){const index=MIGRATIONS.findIndex((m)=>m.from===data.version);for(let i=index;i<MIGRATIONS.length;i++){data=MIGRATIONS[i].applyMigration(data);}
return data;}
const MIGRATIONS=[{from:1,to:2,applyMigration(data){if(data.sheets&&data.sheets[0]){data.activeSheet=data.sheets[0].name;}
return data;},},{from:2,to:3,applyMigration(data){if(data.sheets&&data.sheets.length){for(let sheet of data.sheets){sheet.id=sheet.id||sheet.name;}}
return data;},},{from:3,to:4,applyMigration(data){const activeSheet=data.sheets.find((s)=>s.name===data.activeSheet);data.activeSheet=activeSheet.id;return data;},},{from:4,to:5,applyMigration(data){for(let sheet of data.sheets){sheet.figures=sheet.figures||[];}
return data;},},];function createEmptySheet(name="Sheet1"){return{id:uuidv4(),name,colNumber:26,rowNumber:100,cells:{},cols:{},rows:{},merges:[],conditionalFormats:[],figures:[],};}
function createEmptyWorkbookData(){const data={version:CURRENT_VERSION,sheets:[createEmptySheet("Sheet1")],activeSheet:"",entities:{},styles:{},borders:{},};data.activeSheet=data.sheets[0].id;return data;}
function createEmptyWorkbook(){return{visibleSheets:[],sheets:{},activeSheet:null,};}
const MAX_HISTORY_STEPS=99;class WHistory{constructor(workbook){this.current=null;this.undoStack=[];this.redoStack=[];this.workbook=workbook;}
canUndo(){return this.undoStack.length>0;}
canRedo(){return this.redoStack.length>0;}
allowDispatch(cmd){switch(cmd.type){case"UNDO":return this.canUndo()?{status:"SUCCESS"}:{status:"CANCELLED",reason:3};case"REDO":return this.canRedo()?{status:"SUCCESS"}:{status:"CANCELLED",reason:4};}
return{status:"SUCCESS"};}
beforeHandle(cmd){if(!this.current&&cmd.type!=="REDO"&&cmd.type!=="UNDO"){this.current=[];}}
handle(cmd){switch(cmd.type){case"UNDO":this.undo();break;case"REDO":this.redo();break;}}
finalize(){if(this.current&&this.current.length){if(!this.isActiveSheet()){this.undoStack.push(this.current);}
this.redoStack=[];this.current=null;if(this.undoStack.length>MAX_HISTORY_STEPS){this.undoStack.shift();}}}
isActiveSheet(){return(this.current&&this.current.length===1&&this.current[0].path.length===1&&this.current[0].path[0]==="activeSheet");}
undo(){const step=this.undoStack.pop();if(!step){return;}
this.redoStack.push(step);for(let i=step.length-1;i>=0;i--){let change=step[i];this.applyChange(change,"before");}}
redo(){const step=this.redoStack.pop();if(!step){return;}
this.undoStack.push(step);for(let change of step){this.applyChange(change,"after");}}
applyChange(change,target){let val=change.root;let key=change.path[change.path.length-1];for(let p of change.path.slice(0,-1)){val=val[p];}
if(change[target]===undefined){delete val[key];}
else{val[key]=change[target];}}
updateStateFromRoot(root,path,val){let value=root;let key=path[path.length-1];for(let p of path.slice(0,-1)){value=value[p];}
if(value[key]===val){return;}
if(this.current){this.current.push({root,path,before:value[key],after:val,});}
if(val===undefined){delete value[key];}
else{value[key]=val;}}
updateState(path,val){this.updateStateFromRoot(this.workbook,path,val);}
updateCell(cell,key,value){this.updateStateFromRoot(cell,[key],value);}
updateSheet(sheet,path,value){this.updateStateFromRoot(sheet,path,value);}}
var Status;(function(Status){Status[Status["Ready"]=0]="Ready";Status[Status["Running"]=1]="Running";Status[Status["Finalizing"]=2]="Finalizing";Status[Status["Interactive"]=3]="Interactive";})(Status||(Status={}));class Model extends owl.core.EventBus{constructor(data={},config={}){super();this.renderers=[];this.status=0;this.dispatch=(type,payload)=>{const command=Object.assign({type},payload);let status=command.interactive?3:this.status;switch(status){case 0:for(let handler of this.handlers){const allowDispatch=handler.allowDispatch(command);if(allowDispatch.status==="CANCELLED"){return allowDispatch;}}
this.status=1;for(const h of this.handlers){h.beforeHandle(command);}
for(const h of this.handlers){h.handle(command);}
this.status=2;for(const h of this.handlers){h.finalize(command);}
this.status=0;if(this.config.mode!=="headless"){this.trigger("update");}
break;case 1:case 3:for(const h of this.handlers){h.beforeHandle(command);}
for(const h of this.handlers){h.handle(command);}
break;case 2:throw new Error(_lt("Nope. Don't do that"));}
return{status:"SUCCESS"};};DEBUG.model=this;const workbookData=load(data);this.workbook=createEmptyWorkbook();const history=new WHistory(this.workbook);this.getters={canUndo:history.canUndo.bind(history),canRedo:history.canRedo.bind(history),};this.handlers=[history];this.config={mode:config.mode||"normal",openSidePanel:config.openSidePanel||(()=>{}),notifyUser:config.notifyUser||(()=>{}),askConfirmation:config.askConfirmation||(()=>{}),editText:config.editText||(()=>{}),evalContext:config.evalContext||{},};for(let Plugin of pluginRegistry.getAll()){this.setupPlugin(Plugin,workbookData);}
this.dispatch("START");}
destroy(){delete DEBUG.model;}
setupPlugin(Plugin,data){const dispatch=this.dispatch.bind(this);const history=this.handlers.find((p)=>p instanceof WHistory);if(Plugin.modes.includes(this.config.mode)){const plugin=new Plugin(this.workbook,this.getters,history,dispatch,this.config);plugin.import(data);for(let name of Plugin.getters){if(!(name in plugin)){throw new Error(_lt(`Invalid getter name: ${name} for plugin ${plugin.constructor}`));}
this.getters[name]=plugin[name].bind(plugin);}
this.handlers.push(plugin);const layers=Plugin.layers.map((l)=>[plugin,l]);this.renderers.push(...layers);this.renderers.sort((p1,p2)=>p1[1]-p2[1]);}}
drawGrid(context){context.viewport=this.getters.snapViewportToCell(context.viewport);for(let[renderer,layer]of this.renderers){renderer.drawGrid(context,layer);}}
exportData(){const data=createEmptyWorkbookData();for(let handler of this.handlers){if(handler instanceof BasePlugin){handler.export(data);}}
return data;}}
function isChildEvent(parent,ev){return!!ev.target&&parent.contains(ev.target);}
const{xml:xml$8,css:css$7}=owl.tags;const{useExternalListener:useExternalListener$2,useRef:useRef$1}=owl.hooks;const MENU_WIDTH=200;const MENU_ITEM_HEIGHT=32;const SEPARATOR_HEIGHT=1;const TEMPLATE$7=xml$8`
    <div>
      <div class="o-menu" t-att-style="style" t-on-scroll="onScroll">
        <t t-foreach="props.menuItems" t-as="menuItem" t-key="menuItem.id">
          <t t-set="isMenuRoot" t-value="isRoot(menuItem)"/>
          <t t-set="isMenuEnabled" t-value="isEnabled(menuItem)"/>
          <div
            t-att-title="getName(menuItem)"
            t-att-data-name="menuItem.id"
            t-on-click="onClickMenu(menuItem, menuItem_index)"
            t-on-mouseover="onMouseOver(menuItem, menuItem_index)"
            class="o-menu-item"
            t-att-class="{
              'o-menu-root': isMenuRoot,
              'o-separator': menuItem.separator and !menuItem_last,
              'disabled': !isMenuEnabled,
            }">
            <t t-esc="getName(menuItem)"/>
            <t t-if="isMenuRoot">
              ${TRIANGLE_RIGHT_ICON}
            </t>
          </div>
        </t>
      </div>
      <Menu t-if="subMenu.isOpen"
        position="subMenuPosition"
        menuItems="subMenu.menuItems"
        depth="props.depth + 1"
        t-ref="subMenuRef"
        t-on-close="subMenu.isOpen=false"/>
    </div>`;const CSS$6=css$7`
  .o-menu {
    position: absolute;
    width: ${MENU_WIDTH}px;
    background-color: white;
    box-shadow: 1px 2px 5px 2px rgba(51, 51, 51, 0.15);
    font-size: 13px;
    overflow-y: auto;
    z-index: 10;
    padding: 5px 0px;
    .o-menu-item {
      box-sizing: border-box;
      height: ${MENU_ITEM_HEIGHT}px;
      padding: 7px 20px;
      padding-right: 2px;
      overflow: hidden;
      white-space: nowrap;
      text-overflow: ellipsis;
      cursor: pointer;

      &:hover {
        background-color: #ebebeb;
      }

      &.disabled {
        color: grey;
        cursor: not-allowed;
      }

      &.o-separator {
        border-bottom: ${SEPARATOR_HEIGHT}px solid #e0e2e4;
      }

      &.o-menu-root {
        display: flex;
        justify-content: space-between;
      }
    }
  }
`;class Menu extends owl.Component{constructor(){super(...arguments);this.subMenuRef=useRef$1("subMenuRef");useExternalListener$2(window,"click",this.onClick);useExternalListener$2(window,"contextmenu",this.onContextMenu);this.subMenu=owl.useState({isOpen:false,position:null,scrollOffset:0,menuItems:[],});}
get subMenuPosition(){const position=Object.assign({},this.subMenu.position);position.y-=this.subMenu.scrollOffset||0;return position;}
get renderRight(){const{x,width}=this.props.position;return x<width-MENU_WIDTH;}
get renderBottom(){const{y,height}=this.props.position;return y<height-this.menuHeight;}
get menuHeight(){const separators=this.props.menuItems.filter((m)=>m.separator);const others=this.props.menuItems;return MENU_ITEM_HEIGHT*others.length+separators.length*SEPARATOR_HEIGHT;}
get style(){const{x,height}=this.props.position;const hStyle=`left:${this.renderRight ? x : x - MENU_WIDTH}`;const vStyle=`top:${this.menuVerticalPosition()}`;const heightStyle=`max-height:${height}`;return`${vStyle}px;${hStyle}px;${heightStyle}px`;}
activateMenu(menu){menu.action(this.env);this.close();}
close(){this.subMenu.isOpen=false;this.trigger("close");}
menuVerticalPosition(){const{y,height}=this.props.position;if(this.renderBottom){return y;}
return Math.max(MENU_ITEM_HEIGHT,y-Math.min(this.menuHeight,height));}
subMenuHorizontalPosition(){const{x,width}=this.props.position;const spaceRight=x+2*MENU_WIDTH<width;if(this.renderRight&&spaceRight){return x+MENU_WIDTH;}
else if(this.renderRight&&!spaceRight){return x-MENU_WIDTH;}
return x-(this.props.depth+1)*MENU_WIDTH;}
subMenuVerticalPosition(menuCount,position){const{height}=this.props.position;const y=this.menuVerticalPosition()+this.menuItemVerticalOffset(position);const subMenuHeight=menuCount*MENU_ITEM_HEIGHT;const spaceBelow=y<height-subMenuHeight;if(spaceBelow){return y;}
return Math.max(MENU_ITEM_HEIGHT,y-subMenuHeight+MENU_ITEM_HEIGHT);}
menuItemVerticalOffset(index){return this.props.menuItems.slice(0,index).length*MENU_ITEM_HEIGHT;}
onClick(ev){if(this.el&&isChildEvent(this.el,ev)){return;}
this.close();}
onContextMenu(ev){if(this.el&&isChildEvent(this.el,ev)){return;}
this.subMenu.isOpen=false;}
getName(menu){return cellMenuRegistry.getName(menu,this.env);}
isRoot(menu){return!menu.action;}
isEnabled(menu){return menu.isEnabled(this.env);}
closeSubMenus(){if(this.subMenuRef.comp){this.subMenuRef.comp.closeSubMenus();}
this.subMenu.isOpen=false;}
onScroll(ev){this.subMenu.scrollOffset=ev.target.scrollTop;}
openSubMenu(menu,position){this.closeSubMenus();this.subMenu.isOpen=true;this.subMenu.menuItems=cellMenuRegistry.getChildren(menu,this.env);const{width,height}=this.props.position;this.subMenu.position={x:this.subMenuHorizontalPosition(),y:this.subMenuVerticalPosition(this.subMenu.menuItems.length,position),height,width,};}
onClickMenu(menu,position){if(menu.isEnabled(this.env)){if(this.isRoot(menu)){this.openSubMenu(menu,position);}
else{this.activateMenu(menu);}}}
onMouseOver(menu,position){if(menu.isEnabled(this.env)){if(this.isRoot(menu)){this.openSubMenu(menu,position);}
else{this.subMenu.isOpen=false;}}}}
Menu.template=TEMPLATE$7;Menu.components={Menu};Menu.style=CSS$6;Menu.defaultProps={depth:1,};const{Component:Component$6}=owl__namespace;const{xml:xml$9,css:css$8}=owl.tags;const{useState:useState$4}=owl.hooks;const TEMPLATE$8=xml$9`
  <div class="o-spreadsheet-bottom-bar">
    <div class="o-sheet-item o-add-sheet" t-on-click="addSheet">${PLUS}</div>
    <div class="o-sheet-item o-list-sheets" t-on-click="listSheets">${LIST}</div>
    <div class="o-all-sheets">
      <t t-foreach="getters.getSheets()" t-as="sheet" t-key="sheet.id">
        <div class="o-sheet-item o-sheet" t-on-click="activateSheet(sheet.id)"
             t-on-contextmenu.prevent="onContextMenu(sheet.id)"
             t-att-title="sheet.name"
             t-att-data-id="sheet.id"
             t-att-class="{active: sheet.id === getters.getActiveSheet()}">
          <span class="o-sheet-name" t-esc="sheet.name" t-on-dblclick="onDblClick(sheet.id)"/>
          <span class="o-sheet-icon" t-on-click.stop="onIconClick(sheet.id)">${TRIANGLE_DOWN_ICON}</span>
        </div>
      </t>
    </div>
    <t t-set="aggregate" t-value="getters.getAggregate()"/>
    <div t-if="aggregate !== null" class="o-aggregate">Sum: <t t-esc="aggregate"/></div>
    <Menu t-if="menuState.isOpen"
          position="menuState.position"
          menuItems="menuState.menuItems"
          t-on-close="menuState.isOpen=false"/>
  </div>`;const CSS$7=css$8`
  .o-spreadsheet-bottom-bar {
    background-color: ${BACKGROUND_GRAY_COLOR};
    padding-left: ${HEADER_WIDTH}px;
    display: flex;
    align-items: center;
    font-size: 15px;
    border-top: 1px solid lightgrey;
    overflow: hidden;

    .o-add-sheet,
    .o-list-sheets {
      margin-right: 5px;
    }

    .o-sheet-item {
      display: flex;
      align-items: center;
      padding: 5px;
      cursor: pointer;
      &:hover {
        background-color: rgba(0, 0, 0, 0.08);
      }
    }

    .o-all-sheets {
      display: flex;
      align-items: center;
      max-width: 80%;
      overflow: hidden;
    }

    .o-sheet {
      color: #666;
      padding: 0 15px;
      padding-right: 10px;
      height: ${BOTTOMBAR_HEIGHT}px;
      line-height: ${BOTTOMBAR_HEIGHT}px;
      user-select: none;
      white-space: nowrap;

      &.active {
        color: #484;
        background-color: white;
        box-shadow: 0 1px 3px 1px rgba(60, 64, 67, 0.15);
      }

      .o-sheet-icon {
        margin-left: 5px;

        &:hover {
          background-color: rgba(0, 0, 0, 0.08);
        }
      }
    }

    .o-aggregate {
      background-color: white;
      margin-left: auto;
      font-size: 14px;
      margin-right: 20px;
      padding: 4px 8px;
      color: #333;
      border-radius: 3px;
      box-shadow: 0 1px 3px 1px rgba(60, 64, 67, 0.15);
    }
    .fade-enter-active {
      transition: opacity 0.5s;
    }

    .fade-enter {
      opacity: 0;
    }
  }
`;class BottomBar extends Component$6{constructor(){super(...arguments);this.getters=this.env.getters;this.menuState=useState$4({isOpen:false,position:null,menuItems:[]});}
mounted(){this.focusSheet();}
patched(){this.focusSheet();}
focusSheet(){const div=this.el.querySelector(`[data-id="${this.getters.getActiveSheet()}"]`);if(div&&div.scrollIntoView){div.scrollIntoView();}}
addSheet(){this.env.dispatch("CREATE_SHEET",{activate:true,id:uuidv4()});}
listSheets(ev){const registry=new MenuItemRegistry();const from=this.getters.getActiveSheet();let i=0;for(let sheet of this.getters.getSheets()){registry.add(sheet.id,{name:sheet.name,sequence:i,action:(env)=>env.dispatch("ACTIVATE_SHEET",{from,to:sheet.id}),});i++;}
this.openContextMenu(ev.currentTarget,registry);}
activateSheet(name){this.env.dispatch("ACTIVATE_SHEET",{from:this.getters.getActiveSheet(),to:name});}
onDblClick(sheet){this.env.dispatch("RENAME_SHEET",{interactive:true,sheet});}
openContextMenu(target,registry){const x=target.offsetLeft;const y=target.offsetTop;this.menuState.isOpen=true;this.menuState.menuItems=registry.getAll().filter((x)=>x.isVisible(this.env));this.menuState.position={x,y,height:400,width:this.el.clientWidth,};}
onIconClick(sheet,ev){if(this.getters.getActiveSheet()!==sheet){this.activateSheet(sheet);}
if(this.menuState.isOpen){this.menuState.isOpen=false;}
else{this.openContextMenu(ev.currentTarget.parentElement,sheetMenuRegistry);}}
onContextMenu(sheet,ev){if(this.getters.getActiveSheet()!==sheet){this.activateSheet(sheet);}
this.openContextMenu(ev.currentTarget,sheetMenuRegistry);}}
BottomBar.template=TEMPLATE$8;BottomBar.style=CSS$7;BottomBar.components={Menu};const{Component:Component$7,useState:useState$5}=owl__namespace;const{xml:xml$a,css:css$9}=owl.tags;const functions$4=functionRegistry.content;const providerRegistry=new Registry();providerRegistry.add("functions",async function(){return Object.keys(functions$4).map((key)=>{return{text:key,description:functions$4[key].description,};});});const TEMPLATE$9=xml$a`
  <div t-att-class="{'o-autocomplete-dropdown':state.values.length}" >
    <t t-foreach="state.values" t-as="v" t-key="v.text">
        <div t-att-class="{'o-autocomplete-value-focus': state.selectedIndex === v_index}" t-on-click.stop.prevent="fillValue(v_index)">
             <div class="o-autocomplete-value" t-esc="v.text"/>
             <div class="o-autocomplete-description" t-esc="v.description" t-if="state.selectedIndex === v_index"/>
        </div>
    </t>
  </div>`;const CSS$8=css$9`
  .o-autocomplete-dropdown {
    width: 260px;
    margin: 4px;
    background-color: #fff;
    box-shadow: 0 1px 4px 3px rgba(60, 64, 67, 0.15);

    & > div:hover {
      background-color: #f2f2f2;
    }
    .o-autocomplete-value-focus {
      background-color: rgba(0, 0, 0, 0.08);
    }

    & > div {
      display: flex;
      flex-direction: column;
      padding: 1px 0 5px 5px;
      .o-autocomplete-description {
        padding: 0 0 0 5px;
        font-size: 11px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }
    }
  }
`;class TextValueProvider extends Component$7{constructor(){super(...arguments);this.state=useState$5({values:[],selectedIndex:0,});}
mounted(){this.filter(this.props.search);}
willUpdateProps(nextProps){if(nextProps.search!==this.props.search){this.filter(nextProps.search);}
return super.willUpdateProps(nextProps);}
async filter(searchTerm){const provider=providerRegistry.get(this.props.provider);let values=await provider();if(this.props.filter){values=this.props.filter(searchTerm,values);}
else{values=values.filter((t)=>t.text.toUpperCase().startsWith(searchTerm.toUpperCase())).sort((l,r)=>(l.text<r.text?-1:l.text>r.text?1:0));}
this.state.values=values.slice(0,10);this.state.selectedIndex=0;}
fillValue(index){this.state.selectedIndex=index;this.trigger("completed",{text:this.getValueToFill()});}
moveDown(){this.state.selectedIndex=(this.state.selectedIndex+1)%this.state.values.length;}
moveUp(){this.state.selectedIndex--;if(this.state.selectedIndex<0){this.state.selectedIndex=this.state.values.length-1;}}
getValueToFill(){if(this.state.values.length){return this.state.values[this.state.selectedIndex].text;}}}
TextValueProvider.template=TEMPLATE$9;TextValueProvider.style=CSS$8;class ContentEditableHelper{constructor(el){this.el=el;}
updateEl(el){this.el=el;this.el.focus();}
selectRange(start,end){let selection=window.getSelection();this.removeSelection();let range=document.createRange();if(start==end&&start===0){range.setStart(this.el,0);range.setEnd(this.el,0);}
else{if(start<0||end>this.el.textContent.length){console.warn(`wrong selection asked start ${start}, end ${end}, text content length ${this.el.textContent.length}`);if(start<0)
start=0;if(end>this.el.textContent.length)
end=this.el.textContent.length;}
let startNode=this.findChildAtCharacterIndex(start);let endNode=this.findChildAtCharacterIndex(end);range.setStart(startNode.node,startNode.offset);range.setEnd(endNode.node,endNode.offset);}
selection.addRange(range);}
findChildAtCharacterIndex(offset){let it=this.iterateChildren(this.el);let current,previous;let usedCharacters=offset;do{current=it.next();if(!current.done&&!current.value.hasChildNodes()){if(current.value.textContent&&current.value.textContent.length<usedCharacters){usedCharacters-=current.value.textContent.length;}
else{it.return(current.value);}
previous=current.value;}}while(!current.done);if(current.value){return{node:current.value,offset:usedCharacters};}
return{node:previous,offset:usedCharacters};}*iterateChildren(el){yield el;if(el.hasChildNodes()){for(let child of el.childNodes){yield*this.iterateChildren(child);}}}
insertText(value,color="#000"){document.execCommand("foreColor",false,color);document.execCommand("insertText",false,value);}
removeSelection(){let selection=window.getSelection();selection.removeAllRanges();}
removeAll(){if(this.el){while(this.el.firstChild){this.el.removeChild(this.el.firstChild);}}}
getCurrentSelection(){let{startElement,endElement,startSelectionOffset,endSelectionOffset,}=this.getStartAndEndSelection();let startSizeBefore=this.findSizeBeforeElement(startElement);let endSizeBefore=this.findSizeBeforeElement(endElement);return{start:startSizeBefore+startSelectionOffset,end:endSizeBefore+endSelectionOffset,};}
findSizeBeforeElement(nodeToFind){let it=this.iterateChildren(this.el);let usedCharacters=0;let current=it.next();while(!current.done&&current.value!==nodeToFind){if(!current.value.hasChildNodes()){if(current.value.textContent){usedCharacters+=current.value.textContent.length;}}
current=it.next();}
return usedCharacters;}
getStartAndEndSelection(){const selection=document.getSelection();const range=selection.getRangeAt(0);return{startElement:range.startContainer,startSelectionOffset:range.startOffset,endElement:range.endContainer,endSelectionOffset:range.endOffset,};}}
const{Component:Component$8}=owl__namespace;const{useRef:useRef$2,useState:useState$6}=owl.hooks;const{xml:xml$b,css:css$a}=owl.tags;const FunctionColor="#4a4e4d";const OperatorColor="#3da4ab";const StringColor="#f6cd61";const NumberColor="#02c39a";const MatchingParenColor="pink";const tokenColor={OPERATOR:OperatorColor,NUMBER:NumberColor,STRING:StringColor,BOOLEAN:NumberColor,FUNCTION:FunctionColor,DEBUGGER:OperatorColor,LEFT_PAREN:OperatorColor,RIGHT_PAREN:OperatorColor,};const TEMPLATE$a=xml$b`
<div class="o-composer-container" t-att-style="containerStyle">
    <div class="o-composer"
      t-att-style="composerStyle"
      t-ref="o_composer"
      tabindex="1"
      contenteditable="true"
      spellcheck="false"

      t-on-keydown="onKeydown"
      t-on-input="onInput"
      t-on-keyup="onKeyup"

      t-on-blur="saveSelection"
      t-on-click="onClick"
    />
    <TextValueProvider
        t-if="autoCompleteState.showProvider"
        t-ref="o_autocomplete_provider"
        search="autoCompleteState.search"
        provider="autoCompleteState.provider"
        t-on-completed="onCompleted"
    />
</div>
  `;const CSS$9=css$a`
  .o-composer-container {
    box-sizing: border-box;
    position: absolute;
    padding: 0;
    margin: 0;
    border: 0;
    z-index: 5;
    .o-composer {
      caret-color: black;
      box-sizing: border-box;
      background-color: white;
      padding-left: 2px;
      padding-right: 2px;
      border: 1.6px solid #3266ca;
      white-space: nowrap;
      &:focus {
        outline: none;
      }
    }
  }
`;class Composer extends Component$8{constructor(){super(...arguments);this.composerRef=useRef$2("o_composer");this.autoCompleteRef=useRef$2("o_autocomplete_provider");this.getters=this.env.getters;this.dispatch=this.env.dispatch;this.selectionEnd=0;this.selectionStart=0;this.autoCompleteState=useState$6({showProvider:false,provider:"functions",search:"",});this.tokenAtCursor=undefined;this.shouldProcessInputEvents=false;this.isDone=false;this.refSelectionStart=0;this.tokens=[];this.keyMapping={Enter:this.processEnterKey,Escape:this.processEscapeKey,Tab:(ev)=>this.processTabKey(ev),F2:()=>console.warn("Not implemented"),F4:()=>console.warn("Not implemented"),ArrowUp:this.processArrowKeys,ArrowDown:this.processArrowKeys,ArrowLeft:this.processArrowKeys,ArrowRight:this.processArrowKeys,};this.contentHelper=new ContentEditableHelper(this.composerRef.el);const[col,row]=this.getters.getPosition();this.zone=this.getters.expandZone({left:col,right:col,top:row,bottom:row});this.rect=this.getters.getRect(this.zone,this.props.viewport);}
mounted(){DEBUG.composer=this;const el=this.composerRef.el;this.contentHelper.updateEl(el);const currentContent=this.getters.getCurrentContent();if(currentContent){this.contentHelper.insertText(currentContent);this.contentHelper.selectRange(currentContent.length,currentContent.length);}
this.processContent();el.style.width=(Math.max(el.scrollWidth+10,this.rect[2]+0.5)+"px");el.style.height=(this.rect[3]+0.5+"px");}
willUnmount(){delete DEBUG.composer;this.trigger("composer-unmounted");}
get containerStyle(){const style=this.getters.getCurrentStyle();const[x,y,,height]=this.rect;const weight=`font-weight:${style.bold ? "bold" : 500};`;const italic=style.italic?`font-style: italic;`:``;const strikethrough=style.strikethrough?`text-decoration:line-through;`:``;return`left: ${x - 1}px;
        top:${y}px;
        height:${height}px;
        font-size:${fontSizeMap[style.fontSize || 10]}px;
        ${weight}${italic}${strikethrough}`;}
get composerStyle(){const style=this.getters.getCurrentStyle();const cell=this.getters.getActiveCell()||{type:"text"};const height=this.rect[3];const align="align"in style?style.align:cell.type==="number"?"right":"left";return`text-align:${align};
        line-height:${height - 1.5}px;`;}
processArrowKeys(ev){if(this.getters.getEditionMode()==="selecting"){ev.preventDefault();return;}
ev.stopPropagation();const autoCompleteComp=this.autoCompleteRef.comp;if(["ArrowUp","ArrowDown"].includes(ev.key)&&this.autoCompleteState.showProvider&&autoCompleteComp){ev.preventDefault();if(ev.key==="ArrowUp"){autoCompleteComp.moveUp();}
else{autoCompleteComp.moveDown();}}}
processTabKey(ev){ev.preventDefault();ev.stopPropagation();const autoCompleteComp=this.autoCompleteRef.comp;if(this.autoCompleteState.showProvider&&autoCompleteComp){const autoCompleteValue=autoCompleteComp.getValueToFill();if(autoCompleteValue){this.autoComplete(autoCompleteValue);return;}}
else{this.dispatch("STOP_COMPOSER_SELECTION");}
const deltaX=ev.shiftKey?-1:1;this.isDone=true;this.dispatch("MOVE_POSITION",{deltaX,deltaY:0});}
processEnterKey(ev){ev.preventDefault();ev.stopPropagation();const autoCompleteComp=this.autoCompleteRef.comp;if(this.autoCompleteState.showProvider&&autoCompleteComp){const autoCompleteValue=autoCompleteComp.getValueToFill();if(autoCompleteValue){this.autoComplete(autoCompleteValue);return;}}
this.dispatch("STOP_EDITION");this.dispatch("MOVE_POSITION",{deltaX:0,deltaY:ev.shiftKey?-1:1,});this.isDone=true;}
processEscapeKey(){this.dispatch("STOP_EDITION",{cancel:true});this.isDone=true;}
onKeydown(ev){let handler=this.keyMapping[ev.key];if(handler){return handler.call(this,ev);}
ev.stopPropagation();}
onInput(ev){if(this.isDone||!this.shouldProcessInputEvents){return;}
const el=this.composerRef.el;if(el.clientWidth!==el.scrollWidth){el.style.width=(el.scrollWidth+20);}
const content=el.childNodes.length?el.textContent:"";this.dispatch("SET_CURRENT_CONTENT",{content});}
onKeyup(ev){if(this.isDone||["Control","Shift","ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Tab","Enter",].includes(ev.key)){return;}
ev.preventDefault();ev.stopPropagation();this.autoCompleteState.showProvider=false;this.autoCompleteState.search="";this.dispatch("STOP_COMPOSER_SELECTION");if(ev.ctrlKey&&ev.key===" "){this.autoCompleteState.showProvider=true;}
else{this.processContent();this.processTokenAtCursor();}}
onClick(ev){ev.stopPropagation();this.processContent();this.processTokenAtCursor();}
onCompleted(ev){this.autoComplete(ev.detail.text);}
processContent(){this.shouldProcessInputEvents=false;let value=this.getters.getCurrentContent();this.tokenAtCursor=undefined;if(value.startsWith("=")){this.saveSelection();this.contentHelper.removeAll();this.contentHelper.selectRange(0,0);this.dispatch("REMOVE_ALL_HIGHLIGHTS");const refUsed={};let lastUsedColorIndex=0;this.tokens=composerTokenize(value);if(this.selectionStart===this.selectionEnd&&this.selectionEnd===0){this.tokenAtCursor=undefined;}
else{this.tokenAtCursor=this.tokens.find((t)=>t.start<=this.selectionStart&&t.end>=this.selectionEnd);}
for(let token of this.tokens){switch(token.type){case"OPERATOR":case"NUMBER":case"FUNCTION":case"COMMA":case"BOOLEAN":this.contentHelper.insertText(token.value,tokenColor[token.type]);break;case"SYMBOL":let value=token.value;const[xc,sheet]=value.split("!").reverse();if(rangeReference.test(xc)){const refSanitized=getComposerSheetName(sheet?`${sheet}`:`${this.getters.getSheetName(this.getters.getEditionSheet())}`)+"!"+
xc.replace(/\$/g,"");if(!refUsed[refSanitized]){refUsed[refSanitized]=colors[lastUsedColorIndex];lastUsedColorIndex=++lastUsedColorIndex%colors.length;}
this.contentHelper.insertText(value,refUsed[refSanitized]);}
else{this.contentHelper.insertText(value);}
break;case"LEFT_PAREN":case"RIGHT_PAREN":if(this.tokenAtCursor&&["LEFT_PAREN","RIGHT_PAREN"].includes(this.tokenAtCursor.type)&&this.tokenAtCursor.parenIndex&&this.tokenAtCursor.parenIndex===token.parenIndex){this.contentHelper.insertText(token.value,MatchingParenColor);}
else{this.contentHelper.insertText(token.value);}
break;default:this.contentHelper.insertText(token.value);break;}}
this.contentHelper.selectRange(this.selectionStart,this.selectionEnd);if(Object.keys(refUsed).length){this.dispatch("ADD_HIGHLIGHTS",{ranges:refUsed});}}
this.shouldProcessInputEvents=true;}
processTokenAtCursor(){if(!this.tokenAtCursor){return;}
if(["BOOLEAN","FUNCTION","SYMBOL"].includes(this.tokenAtCursor.type)){if(this.tokenAtCursor.value.length>0){this.autoCompleteState.search=this.tokenAtCursor.value;this.autoCompleteState.showProvider=true;}}
else if(["COMMA","LEFT_PAREN","OPERATOR","SPACE"].includes(this.tokenAtCursor.type)){this.dispatch("START_COMPOSER_SELECTION");this.refSelectionStart=this.selectionStart;}}
addText(text){this.contentHelper.selectRange(this.selectionStart,this.selectionEnd);this.contentHelper.insertText(text);this.selectionStart=this.selectionEnd=this.selectionStart+text.length;this.contentHelper.selectRange(this.selectionStart,this.selectionEnd);}
addTextFromSelection(){const zone=this.getters.getSelectedZones()[0];let selection=this.getters.zoneToXC(zone);if(this.refSelectionStart){this.selectionStart=this.refSelectionStart;}
if(this.getters.getEditionSheet()!==this.getters.getActiveSheet()){const sheetName=getComposerSheetName(this.getters.getSheetName(this.getters.getActiveSheet()));selection=`${sheetName}!${selection}`;}
this.addText(selection);this.processContent();}
autoComplete(value){this.saveSelection();if(value){if(this.tokenAtCursor&&["SYMBOL","FUNCTION"].includes(this.tokenAtCursor.type)){this.selectionStart=this.tokenAtCursor.start;this.selectionEnd=this.tokenAtCursor.end;}
if(this.autoCompleteState.provider==="functions"){if(this.tokens.length&&this.tokenAtCursor){const currentTokenIndex=this.tokens.indexOf(this.tokenAtCursor);if(currentTokenIndex+1<this.tokens.length){const nextToken=this.tokens[currentTokenIndex+1];if(nextToken.type!=="LEFT_PAREN"){value+="(";}}
else{value+="(";}}}
this.addText(value);}
this.autoCompleteState.search="";this.autoCompleteState.showProvider=false;this.processContent();this.processTokenAtCursor();}
saveSelection(){const selection=this.contentHelper.getCurrentSelection();this.selectionStart=selection.start;this.selectionEnd=selection.end;}}
Composer.template=TEMPLATE$a;Composer.style=CSS$9;Composer.components={TextValueProvider};function startDnd(onMouseMove,onMouseUp){const _onMouseUp=(ev)=>{onMouseUp(ev);window.removeEventListener("mouseup",_onMouseUp);window.removeEventListener("dragstart",_onDragStart);window.removeEventListener("mousemove",onMouseMove);};function _onDragStart(ev){ev.preventDefault();}
window.addEventListener("mouseup",_onMouseUp);window.addEventListener("dragstart",_onDragStart);window.addEventListener("mousemove",onMouseMove);}
const{Component:Component$9}=owl__namespace;const{xml:xml$c,css:css$b}=owl.tags;const{useState:useState$7}=owl.hooks;class AbstractResizer extends Component$9{constructor(){super(...arguments);this.PADDING=0;this.MAX_SIZE_MARGIN=0;this.MIN_ELEMENT_SIZE=0;this.lastSelectedElement=null;this.lastElement=null;this.getters=this.env.getters;this.dispatch=this.env.dispatch;this.state=useState$7({isActive:false,isResizing:false,activeElement:0,styleValue:0,delta:0,});}
_computeHandleDisplay(ev){const index=this._getEvOffset(ev);const elementIndex=this._getElementIndex(index);if(elementIndex<0){return;}
const element=this._getElement(elementIndex);const offset=this._getStateOffset();if(index-(element.start-offset)<this.PADDING&&elementIndex!==this._getViewportOffset()){this.state.isActive=true;this.state.styleValue=element.start-offset-this._getHeaderSize();this.state.activeElement=elementIndex-1;}
else if(element.end-offset-index<this.PADDING){this.state.isActive=true;this.state.styleValue=element.end-offset-this._getHeaderSize();this.state.activeElement=elementIndex;}
else{this.state.isActive=false;}}
onMouseMove(ev){if(this.state.isResizing){return;}
this._computeHandleDisplay(ev);}
onMouseLeave(){this.state.isActive=this.state.isResizing;}
onDblClick(){this._fitElementSize(this.state.activeElement);this.state.isResizing=false;}
onMouseDown(ev){this.state.isResizing=true;this.state.delta=0;const initialIndex=this._getClientPosition(ev);const styleValue=this.state.styleValue;const size=this._getElement(this.state.activeElement).size;const minSize=styleValue-size+this.MIN_ELEMENT_SIZE;const maxSize=this._getMaxSize();const onMouseUp=(ev)=>{this.state.isResizing=false;if(this.state.delta!==0){this._updateSize();}};const onMouseMove=(ev)=>{this.state.delta=this._getClientPosition(ev)-initialIndex;this.state.styleValue=styleValue+this.state.delta;if(this.state.styleValue<minSize){this.state.styleValue=minSize;this.state.delta=this.MIN_ELEMENT_SIZE-size;}
if(this.state.styleValue>maxSize){this.state.styleValue=maxSize;this.state.delta=maxSize-styleValue;}};startDnd(onMouseMove,onMouseUp);}
select(ev){if(ev.button>0){return;}
const index=this._getElementIndex(this._getEvOffset(ev));if(index<0){return;}
this.lastElement=index;this.dispatch(ev.ctrlKey?"START_SELECTION_EXPANSION":"START_SELECTION");if(ev.shiftKey){this._increaseSelection(index);}
else{this.lastSelectedElement=index;this._selectElement(index,ev.ctrlKey);}
const initialIndex=this._getClientPosition(ev);const initialOffset=this._getEvOffset(ev);const onMouseMoveSelect=(ev)=>{const offset=this._getClientPosition(ev)-initialIndex+initialOffset;const index=this._getElementIndex(offset);if(index!==this.lastElement&&index!==-1){this._increaseSelection(index);this.lastElement=index;}};const onMouseUpSelect=()=>{this.lastElement=null;this.dispatch(ev.ctrlKey?"PREPARE_SELECTION_EXPANSION":"STOP_SELECTION");};startDnd(onMouseMoveSelect,onMouseUpSelect);}
onMouseUp(ev){this.lastElement=null;}
onContextMenu(ev){ev.preventDefault();const index=this._getElementIndex(this._getEvOffset(ev));if(index<0)
return;if(!this._getActiveElements().has(index)){this.lastSelectedElement=index;this._selectElement(index,false);}
const type=this._getType();const{x,y}=this._getXY(ev);this.trigger("open-contextmenu",{type,x,y});}}
class ColResizer extends AbstractResizer{constructor(){super(...arguments);this.PADDING=15;this.MAX_SIZE_MARGIN=90;this.MIN_ELEMENT_SIZE=MIN_COL_WIDTH;}
_getEvOffset(ev){return ev.offsetX+HEADER_WIDTH;}
_getStateOffset(){return this.props.viewport.offsetX-HEADER_WIDTH;}
_getViewportOffset(){return this.props.viewport.left;}
_getClientPosition(ev){return ev.clientX;}
_getElementIndex(index){return this.getters.getColIndex(index,this.props.viewport.left);}
_getElement(index){return this.getters.getCol(this.getters.getActiveSheet(),index);}
_getBottomRightValue(element){return element.end;}
_getHeaderSize(){return HEADER_WIDTH;}
_getMaxSize(){return this.el.clientWidth;}
_updateSize(){const index=this.state.activeElement;const size=this.state.delta+this._getElement(index).size;const cols=this.getters.getActiveCols();this.dispatch("RESIZE_COLUMNS",{sheet:this.getters.getActiveSheet(),cols:cols.has(index)?[...cols]:[index],size,});}
_selectElement(index,ctrlKey){this.dispatch("SELECT_COLUMN",{index,createRange:ctrlKey});}
_increaseSelection(index){this.dispatch("SELECT_COLUMN",{index,updateRange:true});}
_fitElementSize(index){const cols=this.getters.getActiveCols();this.dispatch("AUTORESIZE_COLUMNS",{sheet:this.getters.getActiveSheet(),cols:cols.has(index)?[...cols]:[index],});}
_getType(){return"COL";}
_getActiveElements(){return this.getters.getActiveCols();}
_getXY(ev){return{x:ev.offsetX+HEADER_WIDTH,y:ev.offsetY,};}}
ColResizer.template=xml$c`
    <div class="o-col-resizer" t-on-mousemove.self="onMouseMove" t-on-mouseleave="onMouseLeave" t-on-mousedown.self.prevent="select"
      t-on-mouseup.self="onMouseUp" t-on-contextmenu.self="onContextMenu">
      <t t-if="state.isActive">
        <div class="o-handle" t-on-mousedown="onMouseDown" t-on-dblclick="onDblClick" t-on-contextmenu.prevent=""
          t-attf-style="left:{{state.styleValue - 2}}px;">
          <div class="dragging" t-if="state.isResizing"/>
        </div>
      </t>
    </div>`;ColResizer.style=css$b`
    .o-col-resizer {
      position: absolute;
      top: 0;
      left: ${HEADER_WIDTH}px;
      right: 0;
      height: ${HEADER_HEIGHT}px;
      .o-handle {
        position: absolute;
        height: ${HEADER_HEIGHT}px;
        width: 4px;
        cursor: e-resize;
        background-color: #3266ca;
      }
      .dragging {
        top: ${HEADER_HEIGHT}px;
        position: absolute;
        margin-left: 2px;
        width: 1px;
        height: 10000px;
        background-color: #3266ca;
      }
    }
  `;class RowResizer extends AbstractResizer{constructor(){super(...arguments);this.PADDING=5;this.MAX_SIZE_MARGIN=60;this.MIN_ELEMENT_SIZE=MIN_ROW_HEIGHT;}
_getEvOffset(ev){return ev.offsetY+HEADER_HEIGHT;}
_getStateOffset(){return this.props.viewport.offsetY-HEADER_HEIGHT;}
_getViewportOffset(){return this.props.viewport.top;}
_getClientPosition(ev){return ev.clientY;}
_getElementIndex(index){return this.getters.getRowIndex(index,this.props.viewport.top);}
_getElement(index){return this.getters.getRow(this.getters.getActiveSheet(),index);}
_getHeaderSize(){return HEADER_HEIGHT;}
_getMaxSize(){return this.el.clientHeight;}
_updateSize(){const index=this.state.activeElement;const size=this.state.delta+this._getElement(index).size;const rows=this.getters.getActiveRows();this.dispatch("RESIZE_ROWS",{sheet:this.getters.getActiveSheet(),rows:rows.has(index)?[...rows]:[index],size,});}
_selectElement(index,ctrlKey){this.dispatch("SELECT_ROW",{index,createRange:ctrlKey});}
_increaseSelection(index){this.dispatch("SELECT_ROW",{index,updateRange:true});}
_fitElementSize(index){const rows=this.getters.getActiveRows();this.dispatch("AUTORESIZE_ROWS",{sheet:this.getters.getActiveSheet(),rows:rows.has(index)?[...rows]:[index],});}
_getType(){return"ROW";}
_getActiveElements(){return this.getters.getActiveRows();}
_getXY(ev){return{x:ev.offsetX,y:ev.offsetY+HEADER_HEIGHT,};}}
RowResizer.template=xml$c`
    <div class="o-row-resizer" t-on-mousemove.self="onMouseMove"  t-on-mouseleave="onMouseLeave" t-on-mousedown.self.prevent="select"
    t-on-mouseup.self="onMouseUp" t-on-contextmenu.self="onContextMenu">
      <t t-if="state.isActive">
        <div class="o-handle" t-on-mousedown="onMouseDown" t-on-dblclick="onDblClick" t-on-contextmenu.prevent=""
          t-attf-style="top:{{state.styleValue - 2}}px;">
          <div class="dragging" t-if="state.isResizing"/>
        </div>
      </t>
    </div>`;RowResizer.style=css$b`
    .o-row-resizer {
      position: absolute;
      top: ${HEADER_HEIGHT}px;
      left: 0;
      right: 0;
      width: ${HEADER_WIDTH}px;
      height: 100%;
      .o-handle {
        position: absolute;
        height: 4px;
        width: ${HEADER_WIDTH}px;
        cursor: n-resize;
        background-color: #3266ca;
      }
      .dragging {
        left: ${HEADER_WIDTH}px;
        position: absolute;
        margin-top: 2px;
        width: 10000px;
        height: 1px;
        background-color: #3266ca;
      }
    }
  `;class Overlay extends Component$9{selectAll(){this.env.dispatch("SELECT_ALL");}}
Overlay.template=xml$c`
    <div class="o-overlay">
      <ColResizer viewport="props.viewport"/>
      <RowResizer viewport="props.viewport"/>
      <div class="all" t-on-mousedown.self="selectAll"/>
    </div>`;Overlay.style=css$b`
    .o-overlay {
      .all {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        width: ${HEADER_WIDTH}px;
        height: ${HEADER_HEIGHT}px;
      }
    }
  `;Overlay.components={ColResizer,RowResizer};const{Component:Component$a}=owl__namespace;const{xml:xml$d,css:css$c}=owl.tags;const{useState:useState$8}=owl.hooks;const TEMPLATE$b=xml$d`
  <div class="o-autofill" t-on-mousedown="onMouseDown" t-att-style="style" t-on-dblclick="onDblClick">
    <div class="o-autofill-handler" t-att-style="styleHandler"/>
    <t t-set="tooltip" t-value="getTooltip()"/>
    <div t-if="tooltip" class="o-autofill-nextvalue" t-att-style="styleNextvalue">
      <t t-component="tooltip.component" t-props="tooltip.props"/>
    </div>
  </div>
`;const CSS$a=css$c`
  .o-autofill {
    height: 6px;
    width: 6px;
    border: 1px solid white;
    position: absolute;
    background-color: #1a73e8;

    .o-autofill-handler {
      position: absolute;
      height: 8px;
      width: 8px;

      &:hover {
        cursor: crosshair;
      }
    }

    .o-autofill-nextvalue {
      position: absolute;
      background-color: white;
      border: 1px solid black;
      padding: 5px;
      font-size: 12px;
      pointer-events: none;
      white-space: nowrap;
    }
  }
`;class Autofill extends Component$a{constructor(){super(...arguments);this.state=useState$8({position:{left:0,top:0},handler:false,});}
get style(){const{left,top}=this.props.position;return`top:${top}px;left:${left}px`;}
get styleHandler(){let position=this.state.handler?this.state.position:{left:0,top:0};return`top:${position.top}px;left:${position.left}px;`;}
get styleNextvalue(){let position=this.state.handler?this.state.position:{left:0,top:0};return`top:${position.top + 5}px;left:${position.left + 15}px;`;}
getTooltip(){const tooltip=this.env.getters.getAutofillTooltip();if(tooltip&&!tooltip.component){tooltip.component=TooltipComponent;}
return tooltip;}
onMouseDown(ev){this.state.handler=true;this.state.position={left:0,top:0};const start={left:ev.clientX,top:ev.clientY};let lastCol;let lastRow;const onMouseUp=()=>{this.state.handler=false;this.env.dispatch("AUTOFILL");};const onMouseMove=(ev)=>{this.state.position={left:ev.clientX-start.left,top:ev.clientY-start.top,};const parent=this.el.parentElement;const position=parent.getBoundingClientRect();const col=this.env.getters.getColIndex(ev.clientX-position.left,this.props.viewport.left);const row=this.env.getters.getRowIndex(ev.clientY-position.top,this.props.viewport.top);if(lastCol!==col||lastRow!==row){const sheetId=this.env.getters.getActiveSheet();lastCol=col===-1?lastCol:clip(col,0,this.env.getters.getNumberCols(sheetId));lastRow=row===-1?lastRow:clip(row,0,this.env.getters.getNumberRows(sheetId));if(lastCol!==undefined&&lastRow!==undefined){this.env.dispatch("AUTOFILL_SELECT",{col:lastCol,row:lastRow});}}};startDnd(onMouseMove,onMouseUp);}
onDblClick(){this.env.dispatch("AUTOFILL_AUTO");}}
Autofill.template=TEMPLATE$b;Autofill.style=CSS$a;class TooltipComponent extends Component$a{}
TooltipComponent.template=xml$d`
    <div t-esc="props.content"/>
  `;class ScrollBar{constructor(el,direction){this.el=el;this.direction=direction;}
get scroll(){return this.direction==="horizontal"?this.el.scrollLeft:this.el.scrollTop;}
set scroll(value){if(this.direction==="horizontal"){this.el.scrollLeft=value;}
else{this.el.scrollTop=value;}}}
const{xml:xml$e,css:css$d}=owl.tags;const{useState:useState$9}=owl__namespace;const TEMPLATE$c=xml$e`<div>
    <t t-foreach="getFigures()" t-as="info" t-key="info.id">
        <div class="o-figure-wrapper"
             t-att-style="getStyle(info)"
             t-on-mousedown="onMouseDown(info.figure)"
             >
            <div class="o-figure"
                 t-att-class="{active: info.isSelected, 'o-dragging': info.id === dnd.figureId}"
                 t-att-style="getDims(info)"
                 tabindex="0"
                 t-on-keydown.stop="onKeyDown(info.figure)">
                <t t-component="figureRegistry.get(info.figure.tag).Component"
                   t-key="info.id"
                   figure="info.figure"/>
                <t t-if="info.isSelected">
                    <div class="o-anchor o-top" t-on-mousedown.stop="resize(info.figure, 0,-1)"/>
                    <div class="o-anchor o-topRight" t-on-mousedown.stop="resize(info.figure, 1,-1)"/>
                    <div class="o-anchor o-right" t-on-mousedown.stop="resize(info.figure, 1,0)"/>
                    <div class="o-anchor o-bottomRight" t-on-mousedown.stop="resize(info.figure, 1,1)"/>
                    <div class="o-anchor o-bottom" t-on-mousedown.stop="resize(info.figure, 0,1)"/>
                    <div class="o-anchor o-bottomLeft" t-on-mousedown.stop="resize(info.figure, -1,1)"/>
                    <div class="o-anchor o-left" t-on-mousedown.stop="resize(info.figure, -1,0)"/>
                    <div class="o-anchor o-topLeft" t-on-mousedown.stop="resize(info.figure, -1,-1)"/>
                </t>
            </div>
        </div>
    </t>
</div>
`;const ANCHOR_SIZE=8;const BORDER_WIDTH=1;const ACTIVE_BORDER_WIDTH=2;const MIN_FIG_SIZE=80;const CSS$b=css$d`
  .o-figure-wrapper {
    overflow: hidden;
  }

  .o-figure {
    border: 1px solid black;
    box-sizing: border-box;
    position: absolute;
    bottom: 3px;
    right: 3px;
    &:focus {
      outline: none;
    }
    &.active {
      border: ${ACTIVE_BORDER_WIDTH}px solid ${SELECTION_BORDER_COLOR};
      z-index: 1;
    }

    &.o-dragging {
      opacity: 0.9;
      cursor: grabbing;
    }

    .o-anchor {
      z-index: 1000;
      position: absolute;
      outline: ${BORDER_WIDTH}px solid white;
      width: ${ANCHOR_SIZE}px;
      height: ${ANCHOR_SIZE}px;
      background-color: #1a73e8;
      &.o-top {
        top: -${ANCHOR_SIZE / 2}px;
        right: 50%;
        cursor: n-resize;
      }
      &.o-topRight {
        top: -${ANCHOR_SIZE / 2}px;
        right: -${ANCHOR_SIZE / 2}px;
        cursor: ne-resize;
      }
      &.o-right {
        right: -${ANCHOR_SIZE / 2}px;
        top: 50%;
        cursor: e-resize;
      }
      &.o-bottomRight {
        bottom: -${ANCHOR_SIZE / 2}px;
        right: -${ANCHOR_SIZE / 2}px;
        cursor: se-resize;
      }
      &.o-bottom {
        bottom: -${ANCHOR_SIZE / 2}px;
        right: 50%;
        cursor: s-resize;
      }
      &.o-bottomLeft {
        bottom: -${ANCHOR_SIZE / 2}px;
        left: -${ANCHOR_SIZE / 2}px;
        cursor: sw-resize;
      }
      &.o-left {
        bottom: 50%;
        left: -${ANCHOR_SIZE / 2}px;
        cursor: w-resize;
      }
      &.o-topLeft {
        top: -${ANCHOR_SIZE / 2}px;
        left: -${ANCHOR_SIZE / 2}px;
        cursor: nw-resize;
      }
    }
  }
`;class FiguresContainer extends owl.Component{constructor(){super(...arguments);this.figureRegistry=figureRegistry;this.dnd=useState$9({figureId:"",x:0,y:0,width:0,height:0,});this.getters=this.env.getters;this.dispatch=this.env.dispatch;}
getFigures(){const selectedId=this.getters.getSelectedFigureId();return this.getters.getFigures(this.props.viewport).map((f)=>({id:f.id,isSelected:f.id===selectedId,figure:f,}));}
getDims(info){const{figure,isSelected}=info;const borders=2*(isSelected?ACTIVE_BORDER_WIDTH:BORDER_WIDTH);const{width,height}=isSelected&&this.dnd.figureId?this.dnd:figure;return`width:${width + borders}px;height:${height + borders}px`;}
getStyle(info){const{figure,isSelected}=info;const{offsetX,offsetY}=this.props.viewport;const target=figure.id===(isSelected&&this.dnd.figureId)?this.dnd:figure;const{width,height}=target;let x=target.x-offsetX+HEADER_WIDTH-1;let y=target.y-offsetY+HEADER_HEIGHT-1;const correctionX=Math.max(0,HEADER_WIDTH-x);x+=correctionX;const correctionY=Math.max(0,HEADER_HEIGHT-y);y+=correctionY;if(width<0||height<0){return`position:absolute;display:none;`;}
const offset=ANCHOR_SIZE+ACTIVE_BORDER_WIDTH+(isSelected?ACTIVE_BORDER_WIDTH:BORDER_WIDTH);return`position:absolute; top:${y + 1}px; left:${x + 1}px; width:${width - correctionX + offset}px; height:${height - correctionY + offset}px`;}
mounted(){this.render();}
resize(figure,dirX,dirY,ev){ev.stopPropagation();const initialX=ev.clientX;const initialY=ev.clientY;this.dnd.figureId=figure.id;this.dnd.x=figure.x;this.dnd.y=figure.y;this.dnd.width=figure.width;this.dnd.height=figure.height;const onMouseMove=(ev)=>{const deltaX=dirX*(ev.clientX-initialX);const deltaY=dirY*(ev.clientY-initialY);this.dnd.width=Math.max(figure.width+deltaX,MIN_FIG_SIZE);this.dnd.height=Math.max(figure.height+deltaY,MIN_FIG_SIZE);if(dirX<0){this.dnd.x=figure.x-deltaX;}
if(dirY<0){this.dnd.y=figure.y-deltaY;}};const onMouseUp=(ev)=>{this.dnd.figureId="";const update={id:figure.id,x:this.dnd.x,y:this.dnd.y};if(dirX){update.width=this.dnd.width;}
if(dirY){update.height=this.dnd.height;}
this.dispatch("UPDATE_FIGURE",update);};startDnd(onMouseMove,onMouseUp);}
onMouseDown(figure,ev){if(ev.button>0){return;}
this.dispatch("SELECT_FIGURE",{id:figure.id});const initialX=ev.clientX;const initialY=ev.clientY;this.dnd.figureId=figure.id;this.dnd.x=figure.x;this.dnd.y=figure.y;this.dnd.width=figure.width;this.dnd.height=figure.height;const onMouseMove=(ev)=>{this.dnd.x=Math.max(figure.x-initialX+ev.clientX,0);this.dnd.y=Math.max(figure.y-initialY+ev.clientY,0);};const onMouseUp=(ev)=>{this.dnd.figureId="";this.dispatch("UPDATE_FIGURE",{id:figure.id,x:this.dnd.x,y:this.dnd.y});};startDnd(onMouseMove,onMouseUp);}
onKeyDown(figure,ev){switch(ev.key){case"Delete":ev.preventDefault();this.dispatch("DELETE_FIGURE",{id:figure.id});this.trigger("figure-deleted");break;}}}
FiguresContainer.template=TEMPLATE$c;FiguresContainer.style=CSS$b;FiguresContainer.components={};const{Component:Component$b,useState:useState$a}=owl__namespace;const{xml:xml$f,css:css$e}=owl.tags;const{useRef:useRef$3,onMounted,onWillUnmount}=owl.hooks;const registries={ROW:rowMenuRegistry,COL:colMenuRegistry,CELL:cellMenuRegistry,};const keyDownMappingIgnore=["CTRL+C","CTRL+V"];function useErrorTooltip(env,getViewPort){const{browser,getters}=env;const{Date,setInterval,clearInterval}=browser;let x=0;let y=0;let lastMoved=0;let tooltipCol,tooltipRow;const canvasRef=useRef$3("canvas");const tooltip=useState$a({isOpen:false,text:"",style:""});let interval;function updateMousePosition(e){x=e.offsetX;y=e.offsetY;lastMoved=Date.now();}
function getPosition(){const viewport=getViewPort();const col=getters.getColIndex(x,viewport.left);const row=getters.getRowIndex(y,viewport.top);return[col,row];}
function checkTiming(){if(tooltip.isOpen){const[col,row]=getPosition();if(col!==tooltipCol||row!==tooltipRow){tooltip.isOpen=false;}}
else{const delta=Date.now()-lastMoved;if(400<delta&&delta<600){const[col,row]=getPosition();if(col<0||row<0){return;}
const mainXc=getters.getMainCell(toXC(col,row));const cell=getters.getCell(...toCartesian(mainXc));if(cell&&cell.error){tooltip.isOpen=true;tooltip.text=cell.error;tooltipCol=col;tooltipRow=row;const viewport=getViewPort();const[x,y,width,height]=env.getters.getRect({left:col,top:row,right:col,bottom:row},viewport);const hAlign=x+width+200<viewport.width?"left":"right";const hOffset=hAlign==="left"?x+width:viewport.width-x+(SCROLLBAR_WIDTH+2);const vAlign=y+120<viewport.height?"top":"bottom";const vOffset=vAlign==="top"?y:viewport.height-y-height+(SCROLLBAR_WIDTH+2);tooltip.style=`${hAlign}:${hOffset}px;${vAlign}:${vOffset}px`;}}}}
onMounted(()=>{canvasRef.el.addEventListener("mousemove",updateMousePosition);interval=setInterval(checkTiming,200);});onWillUnmount(()=>{canvasRef.el.removeEventListener("mousemove",updateMousePosition);clearInterval(interval);});return tooltip;}
function useTouchMove(handler,canMoveUp){const canvasRef=useRef$3("canvas");let x=null;let y=null;function onTouchStart(ev){if(ev.touches.length!==1)
return;x=ev.touches[0].clientX;y=ev.touches[0].clientY;}
function onTouchEnd(){x=null;y=null;}
function onTouchMove(ev){if(ev.touches.length!==1)
return;if(canMoveUp()){ev.preventDefault();ev.stopPropagation();}
const currentX=ev.touches[0].clientX;const currentY=ev.touches[0].clientY;handler(x-currentX,y-currentY);x=currentX;y=currentY;}
onMounted(()=>{canvasRef.el.addEventListener("touchstart",onTouchStart);canvasRef.el.addEventListener("touchend",onTouchEnd);canvasRef.el.addEventListener("touchmove",onTouchMove);});onWillUnmount(()=>{canvasRef.el.removeEventListener("touchstart",onTouchStart);canvasRef.el.removeEventListener("touchend",onTouchEnd);canvasRef.el.removeEventListener("touchmove",onTouchMove);});}
const TEMPLATE$d=xml$f`
  <div class="o-grid" t-on-click="focus" t-on-keydown="onKeydown" t-on-wheel="onMouseWheel">
    <t t-if="getters.getEditionMode() !== 'inactive'">
      <Composer t-ref="composer" t-on-composer-unmounted="focus" viewport="snappedViewport"/>
    </t>
    <canvas t-ref="canvas"
      t-on-mousedown="onMouseDown"
      t-on-dblclick="onDoubleClick"
      tabindex="-1"
      t-on-contextmenu="onCanvasContextMenu"
       />
    <t t-if="errorTooltip.isOpen">
      <div class="o-error-tooltip" t-esc="errorTooltip.text" t-att-style="errorTooltip.style"/>
    </t>
    <t t-if="getters.getEditionMode() === 'inactive'">
      <Autofill position="getAutofillPosition()" viewport="snappedViewport"/>
    </t>
    <Overlay t-on-open-contextmenu="onOverlayContextMenu" viewport="snappedViewport"/>
    <Menu t-if="menuState.isOpen"
      menuItems="menuState.menuItems"
      position="menuState.position"
      t-on-close.stop="menuState.isOpen=false"/>
    <t t-set="gridSize" t-value="getters.getGridSize()"/>
    <FiguresContainer viewport="snappedViewport" model="props.model" t-on-figure-deleted="focus" />
    <div class="o-scrollbar vertical" t-on-scroll="onScroll" t-ref="vscrollbar">
      <div t-attf-style="width:1px;height:{{gridSize[1]}}px"/>
    </div>
    <div class="o-scrollbar horizontal" t-on-scroll="onScroll" t-ref="hscrollbar">
      <div t-attf-style="height:1px;width:{{gridSize[0]}}px"/>
    </div>
  </div>`;const CSS$c=css$e`
  .o-grid {
    position: relative;
    overflow: hidden;
    background-color: ${BACKGROUND_GRAY_COLOR};

    > canvas {
      border-top: 1px solid #e2e3e3;
      border-bottom: 1px solid #e2e3e3;

      &:focus {
        outline: none;
      }
    }
    .o-error-tooltip {
      position: absolute;
      font-size: 13px;
      width: 180px;
      height: 80px;
      background-color: white;
      box-shadow: 0 1px 4px 3px rgba(60, 64, 67, 0.15);
      border-left: 3px solid red;
      padding: 10px;
    }
    .o-scrollbar {
      position: absolute;
      overflow: auto;
      z-index: 2;
      &.vertical {
        right: 0;
        top: ${SCROLLBAR_WIDTH + 1}px;
        bottom: 15px;
        width: 15px;
      }
      &.horizontal {
        bottom: 0;
        height: 15px;
        right: ${SCROLLBAR_WIDTH + 1}px;
        left: ${HEADER_WIDTH}px;
      }
    }
  }
`;class Grid extends Component$b{constructor(){super(...arguments);this.menuState=useState$a({isOpen:false,position:null,menuItems:[],});this.composer=useRef$3("composer");this.vScrollbarRef=useRef$3("vscrollbar");this.hScrollbarRef=useRef$3("hscrollbar");this.canvas=useRef$3("canvas");this.getters=this.env.getters;this.dispatch=this.env.dispatch;this.currentPosition=this.getters.getPosition();this.currentSheet=this.getters.getActiveSheet();this.clickedCol=0;this.clickedRow=0;this.viewport={width:0,height:0,offsetX:0,offsetY:0,left:0,top:0,right:0,bottom:0,};this.snappedViewport=this.viewport;this.errorTooltip=useErrorTooltip(this.env,()=>this.snappedViewport);this.keyDownMapping={ENTER:()=>this.dispatch("START_EDITION"),TAB:()=>this.dispatch("MOVE_POSITION",{deltaX:1,deltaY:0}),"SHIFT+TAB":()=>this.dispatch("MOVE_POSITION",{deltaX:-1,deltaY:0}),F2:()=>this.dispatch("START_EDITION"),DELETE:()=>{this.dispatch("DELETE_CONTENT",{sheet:this.getters.getActiveSheet(),target:this.getters.getSelectedZones(),});},"CTRL+A":()=>this.dispatch("SELECT_ALL"),"CTRL+S":()=>{this.trigger("save-requested");},"CTRL+Z":()=>this.dispatch("UNDO"),"CTRL+Y":()=>this.dispatch("REDO"),};this.vScrollbar=new ScrollBar(this.vScrollbarRef.el,"vertical");this.hScrollbar=new ScrollBar(this.hScrollbarRef.el,"horizontal");useTouchMove(this.moveCanvas.bind(this),()=>this.vScrollbar.scroll>0);}
mounted(){this.vScrollbar.el=this.vScrollbarRef.el;this.hScrollbar.el=this.hScrollbarRef.el;this.focus();this.drawGrid();}
async willUpdateProps(){const sheet=this.getters.getActiveSheet();if(this.currentSheet!==sheet){this.viewport.offsetX=0;this.viewport.offsetY=0;this.hScrollbar.scroll=0;this.vScrollbar.scroll=0;this.viewport=this.getters.adjustViewportZone(this.viewport);this.viewport=this.getters.adjustViewportPosition(this.viewport);this.snappedViewport=this.getters.snapViewportToCell(this.viewport);}}
patched(){this.drawGrid();}
focus(){if(this.getters.getEditionMode()!=="selecting"&&!this.getters.getSelectedFigureId()){this.canvas.el.focus();}}
onScroll(){this.viewport.offsetX=this.hScrollbar.scroll;this.viewport.offsetY=this.vScrollbar.scroll;const viewport=this.getters.adjustViewportZone(this.viewport);if(!isEqual(viewport,this.viewport)){this.viewport=viewport;this.render();}
this.snappedViewport=this.getters.snapViewportToCell(this.viewport);}
checkChanges(){const[col,row]=this.getters.getPosition();const[curCol,curRow]=this.currentPosition;const currentSheet=this.getters.getActiveSheet();const changed=currentSheet!==this.currentSheet||col!==curCol||row!==curRow;if(changed){this.currentPosition=[col,row];}
if(currentSheet!==this.currentSheet){this.focus();this.currentSheet=currentSheet;}
return changed;}
getAutofillPosition(){const zone=this.getters.getSelectedZone();const sheet=this.getters.getActiveSheet();return{left:this.getters.getCol(sheet,zone.right).end-
4+
HEADER_WIDTH-
this.snappedViewport.offsetX,top:this.getters.getRow(sheet,zone.bottom).end-
4+
HEADER_HEIGHT-
this.snappedViewport.offsetY,};}
drawGrid(){this.viewport.width=this.el.clientWidth-SCROLLBAR_WIDTH;this.viewport.height=this.el.clientHeight-SCROLLBAR_WIDTH;this.viewport.offsetX=this.hScrollbar.scroll;this.viewport.offsetY=this.vScrollbar.scroll;this.viewport=this.getters.adjustViewportZone(this.viewport);if(this.checkChanges()){this.viewport=this.getters.adjustViewportPosition(this.viewport);this.hScrollbar.scroll=this.viewport.offsetX;this.vScrollbar.scroll=this.viewport.offsetY;}
this.snappedViewport=this.getters.snapViewportToCell(this.viewport);const canvas=this.canvas.el;const dpr=window.devicePixelRatio||1;const ctx=canvas.getContext("2d",{alpha:false});const thinLineWidth=0.4*dpr;const renderingContext={ctx,viewport:this.viewport,dpr,thinLineWidth};const{width,height}=this.viewport;canvas.style.width=`${width}px`;canvas.style.height=`${height}px`;canvas.width=width*dpr;canvas.height=height*dpr;canvas.setAttribute("style",`width:${width}px;height:${height}px;`);ctx.translate(-0.5,-0.5);ctx.scale(dpr,dpr);this.props.model.drawGrid(renderingContext);}
moveCanvas(deltaX,deltaY){this.vScrollbar.scroll=this.vScrollbar.scroll+deltaY;this.hScrollbar.scroll=this.hScrollbar.scroll+deltaX;}
onMouseWheel(ev){function normalize(val){return val*(ev.deltaMode===0?1:DEFAULT_CELL_HEIGHT);}
this.moveCanvas(normalize(ev.deltaX),normalize(ev.deltaY));}
getCartesianCoordinates(ev){const rect=this.el.getBoundingClientRect();const x=ev.pageX-rect.left;const y=ev.pageY-rect.top;const colIndex=this.getters.getColIndex(x,this.snappedViewport.left);const rowIndex=this.getters.getRowIndex(y,this.snappedViewport.top);return[colIndex,rowIndex];}
onMouseDown(ev){if(ev.button>0){return;}
const[col,row]=this.getCartesianCoordinates(ev);if(col<0||row<0){return;}
this.clickedCol=col;this.clickedRow=row;this.dispatch(ev.ctrlKey?"START_SELECTION_EXPANSION":"START_SELECTION");if(ev.shiftKey){this.dispatch("ALTER_SELECTION",{cell:[col,row]});}
else{this.dispatch("SELECT_CELL",{col,row});this.checkChanges();}
let prevCol=col;let prevRow=row;const onMouseMove=(ev)=>{const[col,row]=this.getCartesianCoordinates(ev);if(col<0||row<0){return;}
if(col!==prevCol||row!==prevRow){prevCol=col;prevRow=row;this.dispatch("ALTER_SELECTION",{cell:[col,row]});}};const onMouseUp=(ev)=>{this.dispatch(ev.ctrlKey?"PREPARE_SELECTION_EXPANSION":"STOP_SELECTION");if(this.getters.getEditionMode()==="selecting"){if(this.composer.comp){this.composer.comp.addTextFromSelection();}}
this.canvas.el.removeEventListener("mousemove",onMouseMove);if(this.getters.isPaintingFormat()){this.dispatch("PASTE",{target:this.getters.getSelectedZones(),});}};startDnd(onMouseMove,onMouseUp);}
onDoubleClick(ev){const[col,row]=this.getCartesianCoordinates(ev);if(this.clickedCol===col&&this.clickedRow===row){this.dispatch("START_EDITION");}}
processTabKey(ev){ev.preventDefault();const deltaX=ev.shiftKey?-1:1;this.dispatch("MOVE_POSITION",{deltaX,deltaY:0});}
processArrows(ev){ev.preventDefault();ev.stopPropagation();const deltaMap={ArrowDown:[0,1],ArrowLeft:[-1,0],ArrowRight:[1,0],ArrowUp:[0,-1],};const delta=deltaMap[ev.key];if(ev.shiftKey){this.dispatch("ALTER_SELECTION",{delta});}
else{this.dispatch("MOVE_POSITION",{deltaX:delta[0],deltaY:delta[1]});}
if(this.getters.getEditionMode()==="selecting"&&this.composer.comp){this.composer.comp.addTextFromSelection();}
else if(this.getters.isPaintingFormat()){this.dispatch("PASTE",{target:this.getters.getSelectedZones(),});}}
onKeydown(ev){if(ev.key.startsWith("Arrow")){this.processArrows(ev);return;}
let keyDownString="";if(ev.ctrlKey)
keyDownString+="CTRL+";if(ev.metaKey)
keyDownString+="CTRL+";if(ev.altKey)
keyDownString+="ALT+";if(ev.shiftKey)
keyDownString+="SHIFT+";keyDownString+=ev.key.toUpperCase();let handler=this.keyDownMapping[keyDownString];if(handler){ev.preventDefault();ev.stopPropagation();handler();return;}
if(!keyDownMappingIgnore.includes(keyDownString)){if(ev.key.length===1&&!ev.ctrlKey&&!ev.metaKey&&!ev.altKey){ev.preventDefault();ev.stopPropagation();this.dispatch("START_EDITION",{text:ev.key});}}}
onCanvasContextMenu(ev){ev.preventDefault();const[col,row]=this.getCartesianCoordinates(ev);if(col<0||row<0){return;}
const zones=this.getters.getSelectedZones();const lastZone=zones[zones.length-1];let type="CELL";if(!isInside(col,row,lastZone)){this.dispatch("SELECT_CELL",{col,row});}
else{if(this.getters.getActiveCols().has(col)){type="COL";}
else if(this.getters.getActiveRows().has(row)){type="ROW";}}
this.toggleContextMenu(type,ev.offsetX,ev.offsetY);}
onOverlayContextMenu(ev){const type=ev.detail.type;const x=ev.detail.x;const y=ev.detail.y;this.toggleContextMenu(type,x,y);}
toggleContextMenu(type,x,y){this.menuState.isOpen=true;this.menuState.position={x,y,width:this.el.clientWidth,height:this.el.clientHeight,};this.menuState.menuItems=registries[type].getAll().filter((item)=>!item.isVisible||item.isVisible(this.env));}}
Grid.template=TEMPLATE$d;Grid.style=CSS$c;Grid.components={Composer,Overlay,Menu,Autofill,FiguresContainer};const{Component:Component$c}=owl__namespace;const{xml:xml$g,css:css$f}=owl.tags;const{useState:useState$b}=owl.hooks;const TEMPLATE$e=xml$g`
  <div class="o-sidePanel" >
    <div class="o-sidePanelHeader">
        <div class="o-sidePanelTitle" t-esc="getTitle()"/>
        <div class="o-sidePanelClose" t-on-click="trigger('close-side-panel')"></div>
    </div>
    <div class="o-sidePanelBody">
      <t t-component="state.panel.Body" t-props="props.panelProps" t-key="'Body_' + props.component"/>
    </div>
    <div class="o-sidePanelFooter" t-if="state.panel.Footer">
      <t t-component="state.panel.Footer" t-props="props.panelProps" t-key="'Footer_' + props.component"/>
    </div>
  </div>`;const CSS$d=css$f`
  .o-sidePanel {
    display: flex;
    flex-direction: column;
    overflow-x: hidden;
    background-color: white;
    border: 1px solid darkgray;
    .o-sidePanelHeader {
      padding: 6px;
      height: 30px;
      background-color: #f8f9fa;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid darkgray;
      font-weight: bold;
      .o-sidePanelTitle {
        font-weight: bold;
        padding: 5px 10px;
        font-size: 1.2rem;
      }
      .o-sidePanelClose {
        font-size: 1.5rem;
        padding: 5px 10px;
        cursor: pointer;
        &:hover {
          background-color: WhiteSmoke;
        }
      }
    }
    .o-sidePanelBody {
      overflow: auto;
      width: 100%;
      height: 100%;
    }

    .o-sidePanelButtons {
      padding: 5px 16px;
      text-align: right;
      .o-sidePanelButton {
        border: 1px solid lightgrey;
        padding: 0px 20px 0px 20px;
        border-radius: 4px;
        font-weight: 500;
        font-size: 14px;
        height: 30px;
        line-height: 16px;
        background: white;
        cursor: pointer;
        margin-right: 8px;
        &:hover {
          background-color: rgba(0, 0, 0, 0.08);
        }
      }
      .o-sidePanelButton:last-child {
        margin-right: 0px;
      }
    }
    .o-input {
      border-radius: 4px;
      border: 1px solid lightgrey;
      padding: 4px 6px;
      width: 96%;
      .o-type-selector {
        background-position: right 5px top 11px;
      }
    }
    select.o-input {
      background-color: white;
      text-align: left;
    }

    .o-section {
      padding: 16px;
      .o-section-title {
        font-weight: bold;
        margin-bottom: 5px;
      }
    }
  }
`;class SidePanel extends Component$c{constructor(){super(...arguments);this.state=useState$b({panel:sidePanelRegistry.get(this.props.component),});}
async willUpdateProps(nextProps){this.state.panel=sidePanelRegistry.get(nextProps.component);}
getTitle(){return typeof this.state.panel.title==="function"?this.state.panel.title(this.env):this.state.panel.title;}}
SidePanel.template=TEMPLATE$e;SidePanel.style=CSS$d;const{Component:Component$d,useState:useState$c,hooks:hooks$2}=owl__namespace;const{xml:xml$h,css:css$g}=owl.tags;const{useExternalListener:useExternalListener$3,useRef:useRef$4}=hooks$2;const FORMATS=[{name:"auto",text:"Automatic"},{name:"number",text:"Number (1,000.12)",value:"#,##0.00"},{name:"percent",text:"Percent (10.12%)",value:"0.00%"},{name:"date",text:"Date (9/26/2008)",value:"m/d/yyyy"},{name:"time",text:"Time (10:43:00 PM)",value:"hh:mm:ss a"},{name:"datetime",text:"Date time (9/26/2008 22:43:00)",value:"m/d/yyyy hh:mm:ss"},{name:"duration",text:"Duration (27:51:38)",value:"hhhh:mm:ss"},];class TopBar extends Component$d{constructor(){super(...arguments);this.formats=FORMATS;this.currentFormat="auto";this.fontSizes=fontSizes;this.dispatch=this.env.dispatch;this.getters=this.env.getters;this.style={};this.state=useState$c({menuState:{isOpen:false,position:null,menuItems:[]},activeTool:"",});this.isSelectingMenu=false;this.openedEl=null;this.inMerge=false;this.cannotMerge=false;this.undoTool=false;this.redoTool=false;this.paintFormatTool=false;this.fillColor="white";this.textColor="black";this.menus=[];this.menuRef=useRef$4("menuRef");useExternalListener$3(window,"click",this.onClick);}
get topbarComponents(){return topbarComponentRegistry.getAll().filter((item)=>!item.isVisible||item.isVisible(this.env));}
async willStart(){this.updateCellState();}
async willUpdateProps(){this.updateCellState();}
onClick(ev){if(this.openedEl&&isChildEvent(this.openedEl,ev)){return;}
this.closeMenus();}
toogleStyle(style){setStyle(this.env,{[style]:!this.style[style]});}
toogleFormat(format){const formatter=FORMATS.find((f)=>f.name===format);const value=(formatter&&formatter.value)||"";setFormatter(this.env,value);}
toggleAlign(align){setStyle(this.env,{["align"]:align});}
onMenuMouseOver(menu,ev){if(this.isSelectingMenu){this.toggleContextMenu(menu,ev);}}
toggleDropdownTool(tool,ev){const isOpen=this.state.activeTool===tool;this.closeMenus();this.state.activeTool=isOpen?"":tool;this.openedEl=isOpen?null:ev.target;}
toggleContextMenu(menu,ev){this.closeMenus();const x=ev.target.offsetLeft;const y=ev.target.clientHeight+ev.target.offsetTop;this.state.menuState.isOpen=true;const width=this.el.clientWidth;const height=this.el.parentElement.clientHeight;this.state.menuState.position={x,y,width,height};this.state.menuState.menuItems=topbarMenuRegistry.getChildren(menu,this.env).filter((item)=>!item.isVisible||item.isVisible(this.env));this.isSelectingMenu=true;this.openedEl=ev.target;}
closeMenus(){this.state.activeTool="";this.state.menuState.isOpen=false;this.isSelectingMenu=false;this.openedEl=null;if(this.menuRef.comp){this.menuRef.comp.closeSubMenus();}}
updateCellState(){this.style=this.getters.getCurrentStyle();this.fillColor=this.style.fillColor||"white";this.textColor=this.style.textColor||"black";const zones=this.getters.getSelectedZones();const{top,left,right,bottom}=zones[0];this.cannotMerge=zones.length>1||(top===bottom&&left===right);this.inMerge=false;if(!this.cannotMerge){const[col,row]=this.getters.getPosition();const zone=this.getters.expandZone({left:col,right:col,top:row,bottom:row});this.inMerge=isEqual(zones[0],zone);}
this.undoTool=this.getters.canUndo();this.redoTool=this.getters.canRedo();this.paintFormatTool=this.getters.isPaintingFormat();const cell=this.getters.getActiveCell();if(cell&&cell.format){const format=this.formats.find((f)=>f.value===cell.format);this.currentFormat=format?format.name:"";}
else{this.currentFormat="auto";}
this.menus=topbarMenuRegistry.getAll().filter((item)=>!item.isVisible||item.isVisible(this.env));}
getMenuName(menu){return topbarMenuRegistry.getName(menu,this.env);}
toggleMerge(){const zones=this.getters.getSelectedZones();const zone=zones[zones.length-1];const sheet=this.getters.getActiveSheet();if(this.inMerge){this.dispatch("REMOVE_MERGE",{sheet,zone});}
else{this.dispatch("ADD_MERGE",{sheet,zone,interactive:true});}}
setColor(target,ev){setStyle(this.env,{[target]:ev.detail.color});}
setBorder(command){this.dispatch("SET_FORMATTING",{sheet:this.getters.getActiveSheet(),target:this.getters.getSelectedZones(),border:command,});}
setFormat(ev){const format=ev.target.dataset.format;if(format){this.toogleFormat(format);}}
setDecimal(step){this.dispatch("SET_DECIMAL",{sheet:this.getters.getActiveSheet(),target:this.getters.getSelectedZones(),step:step,});}
paintFormat(){this.dispatch("ACTIVATE_PAINT_FORMAT",{target:this.getters.getSelectedZones(),});}
clearFormatting(){this.dispatch("CLEAR_FORMATTING",{sheet:this.getters.getActiveSheet(),target:this.getters.getSelectedZones(),});}
setSize(ev){const fontSize=parseFloat(ev.target.dataset.size);setStyle(this.env,{fontSize});}
doAction(action){action(this.env);this.closeMenus();}
undo(){this.dispatch("UNDO");}
redo(){this.dispatch("REDO");}}
TopBar.template=xml$h`
    <div class="o-spreadsheet-topbar">
      <div class="o-topbar-top">
        <!-- Menus -->
        <div class="o-topbar-topleft">
          <t t-foreach="menus" t-as="menu" t-key="menu_index">
            <div t-if="menu.children.length !== 0"
              class="o-topbar-menu"
              t-on-click="toggleContextMenu(menu)"
              t-on-mouseover="onMenuMouseOver(menu)"
              t-att-data-id="menu.id">
            <t t-esc="getMenuName(menu)"/>
          </div>
          </t>
          <Menu t-if="state.menuState.isOpen"
                position="state.menuState.position"
                menuItems="state.menuState.menuItems"
                t-ref="menuRef"
                t-on-close="state.menuState.isOpen=false"/>
        </div>
        <div class="o-topbar-topright">
          <div t-foreach="topbarComponents" t-as="comp" t-key="comp_index">
            <t t-component="comp.component"/>
          </div>
        </div>
      </div>
      <!-- Toolbar and Cell Content -->
      <div class="o-topbar-toolbar">
        <!-- Toolbar -->
        <div class="o-toolbar-tools">
          <div class="o-tool" title="Undo" t-att-class="{'o-disabled': !undoTool}" t-on-click="undo" >${UNDO_ICON}</div>
          <div class="o-tool" t-att-class="{'o-disabled': !redoTool}" title="Redo"  t-on-click="redo">${REDO_ICON}</div>
          <div class="o-tool" title="Paint Format" t-att-class="{active:paintFormatTool}" t-on-click="paintFormat">${PAINT_FORMAT_ICON}</div>
          <div class="o-tool" title="Clear Format" t-on-click="clearFormatting()">${CLEAR_FORMAT_ICON}</div>
          <div class="o-divider"/>
          <div class="o-tool" title="Format as percent" t-on-click="toogleFormat('percent')">%</div>
          <div class="o-tool" title="Decrease decimal places" t-on-click="setDecimal(-1)">.0</div>
          <div class="o-tool" title="Increase decimal places" t-on-click="setDecimal(+1)">.00</div>
          <div class="o-tool o-dropdown" title="More formats" t-on-click="toggleDropdownTool('formatTool')">
            <div class="o-text-icon">123${TRIANGLE_DOWN_ICON}</div>
            <div class="o-dropdown-content o-text-options  o-format-tool "  t-if="state.activeTool === 'formatTool'" t-on-click="setFormat">
              <t t-foreach="formats" t-as="format" t-key="format.name">
                <div t-att-data-format="format.name" t-att-class="{active: currentFormat === format.name}"><t t-esc="format.text"/></div>
              </t>
            </div>
          </div>
          <div class="o-divider"/>
          <!-- <div class="o-tool" title="Font"><span>Roboto</span> ${TRIANGLE_DOWN_ICON}</div> -->
          <div class="o-tool o-dropdown" title="Font Size" t-on-click="toggleDropdownTool('fontSizeTool')">
            <div class="o-text-icon"><t t-esc="style.fontSize || ${DEFAULT_FONT_SIZE}"/> ${TRIANGLE_DOWN_ICON}</div>
            <div class="o-dropdown-content o-text-options "  t-if="state.activeTool === 'fontSizeTool'" t-on-click="setSize">
              <t t-foreach="fontSizes" t-as="font" t-key="font_index">
                <div t-esc="font.pt" t-att-data-size="font.pt"/>
              </t>
            </div>
          </div>
          <div class="o-divider"/>
          <div class="o-tool" title="Bold" t-att-class="{active:style.bold}" t-on-click="toogleStyle('bold')">${BOLD_ICON}</div>
          <div class="o-tool" title="Italic" t-att-class="{active:style.italic}" t-on-click="toogleStyle('italic')">${ITALIC_ICON}</div>
          <div class="o-tool" title="Strikethrough"  t-att-class="{active:style.strikethrough}" t-on-click="toogleStyle('strikethrough')">${STRIKE_ICON}</div>
          <div class="o-tool o-dropdown o-with-color">
            <span t-attf-style="border-color:{{textColor}}" title="Text Color" t-on-click="toggleDropdownTool('textColorTool')">${TEXT_COLOR_ICON}</span>
            <ColorPicker t-if="state.activeTool === 'textColorTool'" t-on-color-picked="setColor('textColor')" t-key="textColor"/>
          </div>
          <div class="o-divider"/>
          <div class="o-tool  o-dropdown o-with-color">
            <span t-attf-style="border-color:{{fillColor}}" title="Fill Color" t-on-click="toggleDropdownTool('fillColorTool')">${FILL_COLOR_ICON}</span>
            <ColorPicker t-if="state.activeTool === 'fillColorTool'" t-on-color-picked="setColor('fillColor')" t-key="fillColor"/>
          </div>
          <div class="o-tool o-dropdown">
            <span title="Borders" t-on-click="toggleDropdownTool('borderTool')">${BORDERS_ICON}</span>
            <div class="o-dropdown-content o-border" t-if="state.activeTool === 'borderTool'">
              <div class="o-dropdown-line">
                <span class="o-line-item" t-on-click="setBorder('all')">${BORDERS_ICON}</span>
                <span class="o-line-item" t-on-click="setBorder('hv')">${BORDER_HV}</span>
                <span class="o-line-item" t-on-click="setBorder('h')">${BORDER_H}</span>
                <span class="o-line-item" t-on-click="setBorder('v')">${BORDER_V}</span>
                <span class="o-line-item" t-on-click="setBorder('external')">${BORDER_EXTERNAL}</span>
              </div>
              <div class="o-dropdown-line">
                <span class="o-line-item" t-on-click="setBorder('left')">${BORDER_LEFT}</span>
                <span class="o-line-item" t-on-click="setBorder('top')">${BORDER_TOP}</span>
                <span class="o-line-item" t-on-click="setBorder('right')">${BORDER_RIGHT}</span>
                <span class="o-line-item" t-on-click="setBorder('bottom')">${BORDER_BOTTOM}</span>
                <span class="o-line-item" t-on-click="setBorder('clear')">${BORDER_CLEAR}</span>
              </div>
            </div>
          </div>
          <div class="o-tool" title="Merge Cells"  t-att-class="{active:inMerge, 'o-disabled': cannotMerge}" t-on-click="toggleMerge">${MERGE_CELL_ICON}</div>
          <div class="o-divider"/>
          <div class="o-tool o-dropdown" title="Horizontal align" t-on-click="toggleDropdownTool('alignTool')">
            <span>
              <t t-if="style.align === 'right'">${ALIGN_RIGHT_ICON}</t>
              <t t-elif="style.align === 'center'">${ALIGN_CENTER_ICON}</t>
              <t t-else="">${ALIGN_LEFT_ICON}</t>
              ${TRIANGLE_DOWN_ICON}
            </span>
            <div t-if="state.activeTool === 'alignTool'" class="o-dropdown-content">
              <div class="o-dropdown-item" t-on-click="toggleAlign('left')">${ALIGN_LEFT_ICON}</div>
              <div class="o-dropdown-item" t-on-click="toggleAlign('center')">${ALIGN_CENTER_ICON}</div>
              <div class="o-dropdown-item" t-on-click="toggleAlign('right')">${ALIGN_RIGHT_ICON}</div>
            </div>
          </div>
          <!-- <div class="o-tool" title="Vertical align"><span>${ALIGN_MIDDLE_ICON}</span> ${TRIANGLE_DOWN_ICON}</div> -->
          <!-- <div class="o-tool" title="Text Wrapping">${TEXT_WRAPPING_ICON}</div> -->
        </div>

        <!-- Cell content -->
        <div class="o-toolbar-cell-content">
          <t t-set="cell" t-value="getters.getActiveCell()"/>
          <t t-esc="cell and cell.content"/>
        </div>

      </div>
    </div>`;TopBar.style=css$g`
    .o-spreadsheet-topbar {
      background-color: white;
      display: flex;
      flex-direction: column;
      font-size: 13px;

      .o-topbar-top {
        border-bottom: 1px solid #e0e2e4;
        display: flex;
        padding: 2px 10px;
        justify-content: space-between;

        /* Menus */
        .o-topbar-topleft {
          display: flex;
          .o-topbar-menu {
            padding: 4px 6px;
            margin: 0 2px;
            cursor: pointer;
          }

          .o-topbar-menu:hover {
            background-color: #f1f3f4;
            border-radius: 2px;
          }
        }

        .o-topbar-topright {
          display: flex;
          justify-content: flex-end;
        }
      }
      /* Toolbar + Cell Content */
      .o-topbar-toolbar {
        border-bottom: 1px solid #e0e2e4;
        display: flex;

        /* Toolbar */
        .o-toolbar-tools {
          display: flex;

          margin-left: 20px;
          color: #333;
          cursor: default;
          display: flex;

          .o-tool {
            display: flex;
            align-items: center;
            margin: 2px;
            padding: 0 3px;
            border-radius: 2px;
            cursor: pointer;
          }

          .o-tool.active,
          .o-tool:not(.o-disabled):hover {
            background-color: #f1f3f4;
          }

          .o-with-color > span {
            border-bottom: 4px solid;
            height: 16px;
            margin-top: 2px;
          }

          .o-with-color {
            .o-line-item:hover {
              outline: 1px solid gray;
            }
          }

          .o-border {
            .o-line-item {
              padding: 4px;
              margin: 1px;
            }
          }

          .o-divider {
            display: inline-block;
            border-right: 1px solid #e0e2e4;
            width: 0;
            margin: 0 6px;
          }

          .o-disabled {
            opacity: 0.6;
          }

          .o-dropdown {
            position: relative;

            .o-text-icon {
              height: 100%;
              line-height: 30px;
              > svg {
                margin-bottom: -5px;
              }
            }

            .o-text-options > div {
              line-height: 26px;
              padding: 3px 12px;
              &:hover {
                background-color: rgba(0, 0, 0, 0.08);
              }
            }

            .o-dropdown-content {
              position: absolute;
              top: calc(100% + 5px);
              left: 0;
              z-index: 10;
              box-shadow: 1px 2px 5px 2px rgba(51, 51, 51, 0.15);
              background-color: white;

              .o-dropdown-item {
                padding: 7px 10px;
              }

              .o-dropdown-item:hover {
                background-color: rgba(0, 0, 0, 0.08);
              }

              .o-dropdown-line {
                display: flex;
                padding: 3px 6px;

                .o-line-item {
                  width: 16px;
                  height: 16px;
                  margin: 1px 3px;

                  &:hover {
                    background-color: rgba(0, 0, 0, 0.08);
                  }
                }
              }

              &.o-format-tool {
                width: 180px;
                padding: 7px 0;
                > div {
                  padding-left: 25px;

                  &.active:before {
                    content: "";
                    font-weight: bold;
                    position: absolute;
                    left: 10px;
                  }
                }
              }
            }
          }
        }

        /* Cell Content */
        .o-toolbar-cell-content {
          font-size: 12px;
          font-weight: 500;
          padding: 0 12px;
          margin: 0;
          line-height: 34px;
        }
      }
    }
  `;TopBar.components={ColorPicker,Menu};const{Component:Component$e,useState:useState$d}=owl__namespace;const{useRef:useRef$5,useExternalListener:useExternalListener$4}=owl.hooks;const{xml:xml$i,css:css$h}=owl.tags;const{useSubEnv}=owl.hooks;const TEMPLATE$f=xml$i`
  <div class="o-spreadsheet" t-on-save-requested="save" t-on-keydown="onKeydown">
    <TopBar t-on-click="focusGrid" class="o-two-columns"/>
    <Grid model="model" t-ref="grid" t-att-class="{'o-two-columns': !sidePanel.isOpen}"/>
    <SidePanel t-if="sidePanel.isOpen"
           t-on-close-side-panel="sidePanel.isOpen = false"
           component="sidePanel.component"
           panelProps="sidePanel.panelProps"/>
    <BottomBar t-on-click="focusGrid" class="o-two-columns"/>
  </div>`;const CSS$e=css$h`
  .o-spreadsheet {
    display: grid;
    grid-template-rows: ${TOPBAR_HEIGHT}px auto ${BOTTOMBAR_HEIGHT + 1}px;
    grid-template-columns: auto 350px;
    * {
      font-family: "Roboto", "RobotoDraft", Helvetica, Arial, sans-serif;
    }
    &,
    *,
    *:before,
    *:after {
      box-sizing: content-box;
    }
  }

  .o-two-columns {
    grid-column: 1 / 3;
  }

  .o-icon {
    width: 18px;
    height: 18px;
    opacity: 0.6;
  }
`;const t=(s)=>s;class Spreadsheet extends Component$e{constructor(){super(...arguments);this.model=new Model(this.props.data,{notifyUser:(content)=>this.trigger("notify-user",{content}),askConfirmation:(content,confirm,cancel)=>this.trigger("ask-confirmation",{content,confirm,cancel}),editText:(title,placeholder,callback)=>this.trigger("edit-text",{title,placeholder,callback}),openSidePanel:(panel,panelProps={})=>this.openSidePanel(panel,panelProps),evalContext:{env:this.env},});this.grid=useRef$5("grid");this.sidePanel=useState$d({isOpen:false,panelProps:{}});this.clipBoardString="";useSubEnv({openSidePanel:(panel,panelProps={})=>this.openSidePanel(panel,panelProps),toggleSidePanel:(panel,panelProps={})=>this.toggleSidePanel(panel,panelProps),dispatch:this.model.dispatch,getters:this.model.getters,_t:Spreadsheet._t,clipboard:navigator.clipboard,export:this.model.exportData.bind(this.model),});useExternalListener$4(window,"resize",this.render);useExternalListener$4(document.body,"cut",this.copy.bind(this,true));useExternalListener$4(document.body,"copy",this.copy.bind(this,false));useExternalListener$4(document.body,"paste",this.paste);useExternalListener$4(document.body,"keyup",this.onKeyup.bind(this));}
mounted(){this.model.on("update",this,this.render);}
willUnmount(){this.model.off("update",this);}
destroy(){this.model.destroy();super.destroy();}
openSidePanel(panel,panelProps){this.sidePanel.component=panel;this.sidePanel.panelProps=panelProps;this.sidePanel.isOpen=true;}
toggleSidePanel(panel,panelProps){if(this.sidePanel.isOpen&&panel===this.sidePanel.component){this.sidePanel.isOpen=false;}
else{this.openSidePanel(panel,panelProps);}}
focusGrid(){this.grid.comp.focus();}
copy(cut,ev){if(!this.grid.el.contains(document.activeElement)){return;}
const type=cut?"CUT":"COPY";const target=this.model.getters.getSelectedZones();this.model.dispatch(type,{target});const content=this.model.getters.getClipboardContent();this.clipBoardString=content;ev.clipboardData.setData("text/plain",content);ev.preventDefault();}
paste(ev){if(!this.grid.el.contains(document.activeElement)){return;}
const clipboardData=ev.clipboardData;if(clipboardData.types.indexOf("text/plain")>-1){const content=clipboardData.getData("text/plain");const target=this.model.getters.getSelectedZones();if(this.clipBoardString===content){this.model.dispatch("PASTE",{target,interactive:true});}
else{this.model.dispatch("PASTE_FROM_OS_CLIPBOARD",{target,text:content,});}}}
save(){this.trigger("save-content",{data:this.model.exportData(),});}
onKeyup(ev){if(ev.key==="Control"&&this.model.getters.getSelectionMode()!==SelectionMode.expanding){this.model.dispatch("STOP_SELECTION");}}
onKeydown(ev){if(ev.key==="Control"&&!ev.repeat){this.model.dispatch(this.model.getters.getSelectionMode()===SelectionMode.idle?"PREPARE_SELECTION_EXPANSION":"START_SELECTION_EXPANSION");}}}
Spreadsheet.template=TEMPLATE$f;Spreadsheet.style=CSS$e;Spreadsheet.components={TopBar,Grid,BottomBar,SidePanel};Spreadsheet._t=t;const __info__={};const SPREADSHEET_DIMENSIONS={MIN_ROW_HEIGHT,MIN_COL_WIDTH,HEADER_HEIGHT,HEADER_WIDTH,TOPBAR_HEIGHT,BOTTOMBAR_HEIGHT,DEFAULT_CELL_WIDTH,DEFAULT_CELL_HEIGHT,SCROLLBAR_WIDTH,};const registries$1={autofillModifiersRegistry,autofillRulesRegistry,cellMenuRegistry,colMenuRegistry,functionRegistry,pluginRegistry,rowMenuRegistry,sidePanelRegistry,sheetMenuRegistry,topbarMenuRegistry,topbarComponentRegistry,};const helpers={args,toBoolean,toNumber,toString,toXC,toZone,toCartesian,numberToLetters,createFullMenuItem,uuidv4,formatDecimal,};exports.BasePlugin=BasePlugin;exports.Model=Model;exports.SPREADSHEET_DIMENSIONS=SPREADSHEET_DIMENSIONS;exports.Spreadsheet=Spreadsheet;exports.__DEBUG__=DEBUG;exports.__info__=__info__;exports.astToFormula=astToFormula;exports.helpers=helpers;exports.parse=parse;exports.registries=registries$1;exports.setTranslationMethod=setTranslationMethod;exports.__info__.version='1.0.0';exports.__info__.date='2020-09-25T08:00:20.903Z';exports.__info__.hash='05dff20';}(this.o_spreadsheet=this.o_spreadsheet||{},owl));;

/* /documents_spreadsheet/static/src/js/o-spreadsheet/o_spreadsheet_loader.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.spreadsheet",function(require){const _t=require("web.core")._t;window.o_spreadsheet.setTranslationMethod(_t);return window.o_spreadsheet;});;

/* /documents_spreadsheet/static/src/js/o-spreadsheet/o_spreadsheet_extended.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.spreadsheet_extended",function(require){const spreadsheet=require("documents_spreadsheet.spreadsheet");const PivotPlugin=require("documents_spreadsheet.PivotPlugin");const FiltersPlugin=require("documents_spreadsheet.FiltersPlugin");const pluginRegistry=spreadsheet.registries.pluginRegistry;pluginRegistry.add("odooPivotPlugin",PivotPlugin);pluginRegistry.add("odooFiltersPlugin",FiltersPlugin);return spreadsheet;});;

/* /documents_spreadsheet/static/src/js/spreadsheet_abstract_action.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.SpreadsheetAbstractAction",function(require){"use strict";const AbstractAction=require("web.AbstractAction");const SpreadsheetComponent=require("documents_spreadsheet.SpreadsheetComponent");const SpreadsheetControlPanel=require("documents_spreadsheet.ControlPanel");const core=require("web.core");const _t=core._t;const{ComponentWrapper}=require("web.OwlCompatibility");const SpreadsheetAbstractAction=AbstractAction.extend({config:Object.assign({},AbstractAction.prototype.config,{ControlPanel:SpreadsheetControlPanel,}),jsLibs:['/web/static/lib/Chart/Chart.js',],contentTemplate:"documents_spreadsheet.SpreadsheetAction",events:{},custom_events:{spreadsheet_name_changed:"_onSpreadSheetNameChanged",make_copy:"_onMakeCopy",new_spreadsheet:"_onNewSpreadsheet",spreadsheet_saved:"_onSpreadsheetSaved",},hasControlPanel:true,thumbnailSize:750,init(parent,action){this._super.apply(this,arguments);this.tag=action.tag;this.res_id=action.params.active_id;this.showFormulas=action.params.showFormulas||false;this.spreadsheetComponent=false;this.spreadsheetData=false;this.spreadsheetName=false;},willStart(){const promises=[];promises.push(this._super.apply(this,arguments));promises.push(this._loadData());return Promise.all(promises);},async start(){this._setTitle(this.spreadsheetName);if(!this.spreadsheetData){return this.do_action({type:"ir.actions.client",tag:"home",});}
await this._super.apply(this,arguments);const container=this.el.getElementsByClassName("o_spreadsheet_action")[0];this.spreadsheetComponent=new ComponentWrapper(this,SpreadsheetComponent,{data:this.spreadsheetData,res_id:this.res_id,name:this.spreadsheetName,showFormulas:this.showFormulas,thumbnailSize:this.thumbnailSize,});await this.spreadsheetComponent.mount(container);this.spreadsheetComponent._addListener("make_copy");this.spreadsheetComponent._addListener("new_spreadsheet");},destroy(){if(this.spreadsheetComponent){this.spreadsheetComponent.destroy();}
this._super.apply(this,arguments);},getTitle(){return this.spreadsheetName===false?_t("Spreadsheet"):this.spreadsheetName;},canBeRemoved(){const{spreadsheet_data,thumbnail}=this.spreadsheetComponent.componentRef.comp.getSaveData();return this._saveSpreadsheet(spreadsheet_data,thumbnail);},async _loadData(){if(this.res_id===undefined){return;}
const record=await this._fetchSpreadsheetData(this.res_id);if(record){this._updateData(record);}},_updateData({name}){if(name!==undefined){this.spreadsheetName=name;}},async _onMakeCopy(ev){const id=await this._makeCopy(ev.data);this._openSpreadsheet(id);},async _onNewSpreadsheet(){const id=await this._createNewSpreadsheet();this._openSpreadsheet(id);},_onSpreadSheetNameChanged(ev){const{name}=ev.data;this.spreadsheetName=name;this.spreadsheetComponent.update({name});return this._saveName(name);},_onSpreadsheetSaved(ev){const{data,thumbnail}=ev.data;this._saveSpreadsheet(data,thumbnail);},_openSpreadsheet(active_id){this.displayNotification({type:"info",message:this.notificationMessage,sticky:false,});this.do_action({type:"ir.actions.client",tag:this.tag,params:{active_id},},{clear_breadcrumbs:true});},async _createNewSpreadsheet(){},async _makeCopy(data){},async _saveName(name){},async _fetchSpreadsheetData(id){},async _saveSpreadsheet(data,thumbnail){},});return SpreadsheetAbstractAction;});;

/* /documents_spreadsheet/static/src/js/spreadsheet_action.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.SpreadsheetAction",function(require){"use strict";const AbstractAction=require("documents_spreadsheet.SpreadsheetAbstractAction");const core=require("web.core");const{_lt,_t}=core;const SpreadsheetAction=AbstractAction.extend({custom_events:Object.assign({},AbstractAction.prototype.custom_events,{favorite_toggled:"_onSpreadSheetFavoriteToggled",}),notificationMessage:_lt("New spreadsheet created in Documents"),init(){this._super(...arguments);this.isFavorited=false;},start(){this.controlPanelProps.isFavorited=this.isFavorited;return this._super.apply(this,arguments);},async _fetchSpreadsheetData(id){const[record]=await this._rpc({model:"documents.document",method:"search_read",fields:["name","raw","is_favorited"],domain:[["id","=",id]],limit:1,});return record;},_updateData(record){this._super(record);this.isFavorited=record.is_favorited;this.spreadsheetData=JSON.parse(record.raw);},_makeCopy({spreadsheet_data,thumbnail}){return this._rpc({model:"documents.document",method:"copy",args:[this.res_id,{mimetype:"application/o-spreadsheet",raw:spreadsheet_data,thumbnail,},],});},_createNewSpreadsheet(){return this._rpc({model:"documents.document",method:"create",args:[{name:_t("Untitled spreadsheet"),mimetype:"application/o-spreadsheet",raw:"{}",handler:"spreadsheet",},],});},_saveName(name){return this._rpc({model:"documents.document",method:"write",args:[[this.res_id],{name,}],});},_onSpreadSheetFavoriteToggled(ev){return this._rpc({model:"documents.document",method:"toggle_favorited",args:[[this.res_id]],});},_saveSpreadsheet(data,thumbnail){return this._rpc({model:"documents.document",method:"write",args:[[this.res_id],{raw:data,thumbnail}],});}});core.action_registry.add("action_open_spreadsheet",SpreadsheetAction);return SpreadsheetAction;});;

/* /documents_spreadsheet/static/src/js/spreadsheet_template_action.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.SpreadsheetTemplateAction",function(require){"use strict";const AbstractAction=require("documents_spreadsheet.SpreadsheetAbstractAction");const core=require("web.core");const{_lt,_t}=core;const SpreadsheetAction=AbstractAction.extend({notificationMessage:_lt("New spreadsheet template created"),thumbnailSize:750,async _fetchSpreadsheetData(id){const[record]=await this._rpc({model:"spreadsheet.template",method:"search_read",fields:["name","data"],domain:[["id","=",id]],limit:1,});return record;},_updateData(record){this._super(record);this.spreadsheetData=JSON.parse(atob(record.data));},async _makeCopy({id,spreadsheet_data,thumbnail}){return this._rpc({model:"spreadsheet.template",method:"copy",args:[id,{data:btoa(spreadsheet_data),thumbnail,},],});},_createNewSpreadsheet(){return this._rpc({model:"spreadsheet.template",method:"create",args:[{name:_t("Untitled spreadsheet template"),data:btoa("{}"),},],});},_saveName(name){return this._rpc({model:"spreadsheet.template",method:"write",args:[[this.res_id],{name,},],});},_saveSpreadsheet(data,thumbnail){return this._rpc({model:"spreadsheet.template",method:"write",args:[[this.res_id],{data:btoa(data),thumbnail}],});},});core.action_registry.add("action_open_template",SpreadsheetAction);return SpreadsheetAction;});;

/* /documents_spreadsheet/static/src/js/components/spreadsheet_component.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.SpreadsheetComponent",function(require){"use strict";const core=require("web.core");const Dialog=require("web.OwlDialog");const PivotDialog=require("documents_spreadsheet.PivotDialog")
const spreadsheet=require("documents_spreadsheet.spreadsheet_extended");const{convertPivotFormulas,absoluteToRelative,getCells,}=require("documents_spreadsheet.pivot_utils");const Spreadsheet=spreadsheet.Spreadsheet;const{useState,useRef,useSubEnv}=owl.hooks;const _t=core._t;class SpreadsheetComponent extends owl.Component{constructor(parent,props){super(...arguments);useSubEnv({newSpreadsheet:this.newSpreadsheet.bind(this),saveAsTemplate:this._saveAsTemplate.bind(this),makeCopy:this.makeCopy.bind(this),saveData:this.saveData.bind(this),openPivotDialog:this.openPivotDialog.bind(this),});this.state=useState({dialog:{isDisplayed:false,title:undefined,isEditText:false,inputContent:undefined,},pivotDialog:{isDisplayed:false,},});this.spreadsheet=useRef("spreadsheet");this.dialogContent=undefined;this.pivot=undefined;this.insertPivotValueCallback=undefined;this.confirmDialog=()=>true;this.data=props.data;this.res_id=props.res_id;}
mounted(){if(this.props.showFormulas){this.spreadsheet.comp.model.dispatch("SET_FORMULA_VISIBILITY",{show:true});}
window.onbeforeunload=()=>{this.saveData();};}
willUnmount(){window.onbeforeunload=null;}
askConfirmation(ev){this.dialogContent=ev.detail.content;this.confirmDialog=()=>{ev.detail.confirm();this.closeDialog();};this.state.dialog.isDisplayed=true;}
editText(ev){this.dialogContent=undefined;this.state.dialog.title=ev.detail.title;this.state.dialog.isEditText=true;this.state.inputContent=ev.detail.placeholder;this.confirmDialog=()=>{this.closeDialog();ev.detail.callback(this.state.inputContent);};this.state.dialog.isDisplayed=true;}
closeDialog(){this.dialogContent=undefined;this.confirmDialog=()=>true;this.state.dialog.title=undefined;this.state.dialog.isDisplayed=false;this.state.dialog.isEditText=false;}
closePivotDialog(){this.state.pivotDialog.isDisplayed=false;this.spreadsheet.comp.focusGrid();}
_onCellClicked(ev){this.insertPivotValueCallback(ev.detail.formula);this.closePivotDialog();}
getSaveData(){const spreadsheet_data=JSON.stringify(this.spreadsheet.comp.model.exportData());return{spreadsheet_data,thumbnail:this.getThumbnail()};}
getMissingValueDialogTitle(){const title=_t("Insert pivot cell");const pivotTitle=this.getPivotTitle();if(pivotTitle){return`${title} - ${pivotTitle}`}
return title;}
getPivotTitle(){if(this.pivot){const name=this.pivot.cache&&this.pivot.cache.getModelLabel()||this.pivot.model;const id=this.pivot.id;return`${name} (#${id})`;}
return"";}
getThumbnail(){const dimensions=spreadsheet.SPREADSHEET_DIMENSIONS;const canvas=this.spreadsheet.comp.grid.comp.canvas.el;const canvasResizer=document.createElement("canvas");const size=this.props.thumbnailSize
canvasResizer.width=size;canvasResizer.height=size;const canvasCtx=canvasResizer.getContext("2d");const sourceSize=Math.min(25*dimensions.DEFAULT_CELL_HEIGHT,canvas.width,canvas.height);canvasCtx.drawImage(canvas,dimensions.HEADER_WIDTH-1,dimensions.HEADER_HEIGHT-1,sourceSize,sourceSize,0,0,size,size);return canvasResizer.toDataURL().replace("data:image/png;base64,","");}
makeCopy(){const{spreadsheet_data,thumbnail}=this.getSaveData();this.saveData();this.trigger("make_copy",{spreadsheet_data,thumbnail,id:this.res_id});}
newSpreadsheet(){this.saveData();this.trigger("new_spreadsheet");}
async _saveAsTemplate(){const data=this.spreadsheet.comp.model.exportData();const{pivots}=data;await convertPivotFormulas(this.env.services.rpc,getCells(data,/^\s*=.*PIVOT/),absoluteToRelative,pivots);const name=this.props.name;this.trigger("do-action",{action:"documents_spreadsheet.save_spreadsheet_template_action",options:{additional_context:{default_template_name:`${name} - Template`,default_data:btoa(JSON.stringify(data)),default_thumbnail:this.getThumbnail(),},},});}
notifyUser(ev){this.dialogContent=ev.detail.content;this.confirmDialog=this.closeDialog;this.state.dialog.isDisplayed=true;}
openPivotDialog(ev){this.pivot=this.spreadsheet.comp.model.getters.getPivot(ev.pivotId);this.insertPivotValueCallback=ev.insertPivotValueCallback;this.state.pivotDialog.isDisplayed=true;}
saveData(){const{spreadsheet_data,thumbnail}=this.getSaveData();this.trigger("spreadsheet_saved",{data:spreadsheet_data,thumbnail,});}}
SpreadsheetComponent.template="documents_spreadsheet.SpreadsheetComponent";SpreadsheetComponent.components={Spreadsheet,Dialog,PivotDialog};return SpreadsheetComponent;});;

/* /documents_spreadsheet/static/src/js/components/spreadsheet_control_panel.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.ControlPanel",function(require){"use strict";const{useState}=owl.hooks;const ControlPanel=require("web.ControlPanel");const SpreadsheetName=require("documents_spreadsheet.SpreadsheetName");class SpreadsheetControlPanel extends ControlPanel{constructor(){super(...arguments);this.state=useState({isFavorited:false,});}
willStart(){this.state.isFavorited=this.props.isFavorited;}
_toggleFavorited(){this.state.isFavorited=!this.state.isFavorited;this.trigger("favorite-toggled");}}
SpreadsheetControlPanel.template="documents_spreadsheet.ControlPanel";SpreadsheetControlPanel.components=Object.assign({},ControlPanel.components,{SpreadsheetName,});SpreadsheetControlPanel.props=Object.assign({},ControlPanel.props,{isFavorited:{type:Boolean,optional:true}});return SpreadsheetControlPanel;});;

/* /documents_spreadsheet/static/src/js/components/spreadsheet_name.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.SpreadsheetName",function(require){"use strict";const{useState,useRef}=owl.hooks;const WIDTH_MARGIN=3
const PADDING_RIGHT=5;const PADDING_LEFT=PADDING_RIGHT-WIDTH_MARGIN;class SpreadsheetName extends owl.Component{constructor(){super(...arguments);this.placeholder=this.env._t("Untitled spreadsheet");this.state=useState({inputSize:1,isUntitled:this._isUntitled(this.props.name),});this.input=useRef("speadsheetNameInput");}
async mounted(){this._setInputSize(this.props.name);}
_setInputSize(text){const{font}=window.getComputedStyle(this.input.el);this.state.inputSize=this._computeTextWidth(text||this.placeholder,font)+PADDING_RIGHT+PADDING_LEFT;}
_computeTextWidth(text,font){const canvas=document.createElement("canvas");const context=canvas.getContext("2d");context.font=font;const width=context.measureText(text).width;return Math.ceil(width)+WIDTH_MARGIN;}
_isUntitled(name){name=name.trim();return!name||name===this.placeholder;}
_onFocus(ev){if(this._isUntitled(ev.target.value)){ev.target.value=this.placeholder;ev.target.select();}}
_onInput(ev){const value=ev.target.value;this.state.isUntitled=this._isUntitled(value);this._setInputSize(value);}
_onNameChanged(ev){const value=ev.target.value.trim();ev.target.value=value;this._setInputSize(value);this.trigger("spreadsheet-name-changed",{name:value,});ev.target.blur();}}
SpreadsheetName.template="documents_spreadsheet.SpreadsheetName";SpreadsheetName.props={name:String,};return SpreadsheetName;});;

/* /documents_spreadsheet/static/src/js/components/spreadsheet_template_dialog.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.TemplateDialog",function(require){"use strict";const Dialog=require("web.OwlDialog");const SearchBar=require("web.SearchBar");const Pager=require("web.Pager");const ActionModel=require("web/static/src/js/views/action_model.js");const{getDataFromTemplate}=require("documents_spreadsheet.pivot_utils");const{DropPrevious}=require("web.concurrency");const{useState,useSubEnv}=owl.hooks;class TemplateDialog extends owl.Component{constructor(){super(...arguments);this.limit=9;this.state=useState({isOpen:true,templates:[],templatesCount:0,selectedTemplateId:null,currentMinimum:1,offset:0,isCreating:false,});const searchModelConfig={context:this.props.context,domain:[],env:owl.Component.env,};const archs={search:this.props.searchView.arch};const{ControlPanel:controlPanelInfo}=ActionModel.extractArchInfo(archs);const extensions={ControlPanel:{archNodes:controlPanelInfo.children,fields:this.props.searchView.fields,},};this.model=new ActionModel(extensions,searchModelConfig);this.model.on("search",this,this._fetchTemplates);useSubEnv({searchModel:this.model,});this.dp=new DropPrevious();}
async willStart(){await this._fetchTemplates({domain:[],context:this.props.context,});}
async _fetchTemplates(searchQuery,offset=0){const{domain,context,orderedBy}=searchQuery;const{length,records}=await this.dp.add(this.env.services.rpc({route:"/web/dataset/search_read",model:"spreadsheet.template",fields:["name"],domain,context,offset,limit:this.limit,orderBy:orderedBy,}));this.state.templates=records;this.state.templatesCount=length;}
async _createSpreadsheet(){if(!this._hasSelection())return;this.state.isCreating=true;const templateId=this.state.selectedTemplateId;const data=templateId!==null?await getDataFromTemplate(this.env.services.rpc,templateId):{};const name=templateId!==null?this.state.templates.find((template)=>template.id===templateId).name:this.env._t("Untitled spreadsheet");const spreadsheetId=await this.env.services.rpc({model:"documents.document",method:"create",args:[{name,mimetype:"application/o-spreadsheet",folder_id:this.props.folderId,handler:"spreadsheet",raw:JSON.stringify(data),},],});this.env.services.notification.notify({type:"info",message:this.env._t("New sheet saved in Documents"),sticky:false,});this.trigger("spreadsheet-created",{spreadsheetId});}
_selectTemplate(templateId){this.state.selectedTemplateId=templateId;}
_isSelected(templateId){return this.state.selectedTemplateId===templateId;}
_hasSelection(){return(this.state.templates.find((template)=>template.id===this.state.selectedTemplateId)||this.state.selectedTemplateId===null);}
_onPagerChanged(ev){ev.stopPropagation();const{currentMinimum}=ev.detail;this.state.currentMinimum=currentMinimum;return this._fetchTemplates(this.model.get("query"),this.state.currentMinimum-1);}
_buttonDisabled(){return this.state.isCreating||!this._hasSelection();}}
TemplateDialog.components={Dialog,SearchBar,Pager};TemplateDialog.template="documents_spreadsheet.TemplateDialog";return TemplateDialog;});;

/* /documents_spreadsheet/static/src/js/components/spreadsheet_pivot_dialog.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.PivotDialog",function(require){"use strict";const core=require("web.core");const spreadsheet=require("documents_spreadsheet.spreadsheet_extended");const PivotDialogTable=require("documents_spreadsheet.PivotDialogTable");const pivotUtils=require("documents_spreadsheet.pivot_utils");const functionRegistry=spreadsheet.registries.functionRegistry;const _t=core._t;const{useState}=owl.hooks;const formatDecimal=spreadsheet.helpers.formatDecimal;const{fetchCache}=require("documents_spreadsheet.pivot_utils");class PivotDialog extends owl.Component{constructor(){super(...arguments);this.state=useState({showMissingValuesOnly:false,});}
async willStart(){this.data={columns:this._buildColHeaders(),rows:this._buildRowHeaders(),values:this._buildValues(),};}
get pivot(){return this.props.pivot;}
getTableData(){if(!this.state.showMissingValuesOnly){return this.data;}
const colIndexes=this._getColumnsIndexes();const rowIndexes=this._getRowsIndexes();const columns=this._buildColumnsMissing(colIndexes);const rows=this._buildRowsMissing(rowIndexes);const values=this._buildValuesMissing(colIndexes,rowIndexes);return{columns,rows,values};}
_addRecursiveRow(index){const row=this.pivot.cache.getRowValues(index).slice();if(row.length<=1){return[index];}
row.pop();const parentRowIndex=this.pivot.cache.getRowIndex(row);return[index].concat(this._addRecursiveRow(parentRowIndex));}
_buildColumnsMissing(indexes){const columnsMap=[];for(let column of this.data.columns){const columnMap=[];for(let index in column){for(let i=0;i<column[index].span;i++){columnMap.push(index);}}
columnsMap.push(columnMap);}
for(let i=columnsMap[columnsMap.length-1].length;i>=0;i--){if(!indexes.includes(i)){for(let columnMap of columnsMap){columnMap.splice(i,1);}}}
const columns=[];for(let mapIndex in columnsMap){const column=[];let index=undefined;let span=1;for(let i=0;i<columnsMap[mapIndex].length;i++){if(index!==columnsMap[mapIndex][i]){if(index){column.push(Object.assign({},this.data.columns[mapIndex][index],{span}));}
index=columnsMap[mapIndex][i];span=1;}else{span++;}}
if(index){column.push(Object.assign({},this.data.columns[mapIndex][index],{span}));}
columns.push(column);}
return columns;}
_buildRowsMissing(indexes){return indexes.map((index)=>this.data.rows[index]);}
_buildValuesMissing(colIndexes,rowIndexes){const values=colIndexes.map(()=>[]);for(let row of rowIndexes){for(let col in colIndexes){values[col].push(this.data.values[colIndexes[col]][row]);}}
return values;}
_getColumnsIndexes(){const indexes=new Set();for(let i=0;i<this.data.columns.length;i++){const exploded=[];for(let y=0;y<this.data.columns[i].length;y++){for(let x=0;x<this.data.columns[i][y].span;x++){exploded.push(this.data.columns[i][y]);}}
for(let y=0;y<exploded.length;y++){if(exploded[y].isMissing){indexes.add(y);}}}
for(let i=0;i<this.data.columns[this.data.columns.length-1].length;i++){const values=this.data.values[i];if(values.find((x)=>x.isMissing)){indexes.add(i);}}
return Array.from(indexes).sort((a,b)=>a-b);}
_getRowsIndexes(){const rowIndexes=new Set();for(let i=0;i<this.data.rows.length;i++){if(this.data.rows[i].isMissing){rowIndexes.add(i);}
for(let col of this.data.values){if(col[i].isMissing){this._addRecursiveRow(i).forEach((x)=>rowIndexes.add(x));}}}
return Array.from(rowIndexes).sort((a,b)=>a-b);}
_buildCell(args){const formula=`=PIVOT("${args.join('","')}")`;const measure=args[1];const operator=this.pivot.measures.filter((m)=>m.field===measure)[0].operator;args.splice(0,2);const domain=args.map((x)=>x.toString());const value=this.pivot.cache.getMeasureValue(functionRegistry.mapping,measure,operator,domain);return{value:this._formatValue(value),formula};}
_buildColHeaders(){const pivot=this.pivot;const levels=pivot.cache.getColGroupByLevels();const headers=[];let length=pivot.cache.getTopHeaderCount()-pivot.measures.length;if(length===0){length=pivot.cache.getTopHeaderCount();}
for(let i=0;i<length;i++){for(let level=0;level<=levels;level++){const pivotArgs=[];const values=pivot.cache.getColGroupHierarchy(i,level);for(const index in values){pivotArgs.push(pivot.cache.getColLevelIdentifier(index));pivotArgs.push(values[index]);}
const isMissing=!pivot.cache.isUsedHeader(pivotArgs);pivotArgs.unshift(pivot.id);if(headers[level]){headers[level].push({args:pivotArgs,isMissing});}else{headers[level]=[{args:pivotArgs,isMissing}];}}}
for(let i=length;i<pivot.cache.getTopHeaderCount();i++){let isMissing=!pivot.cache.isUsedHeader([]);headers[headers.length-2].push({args:[pivot.id],isMissing});const args=["measure",pivot.cache.getColGroupHierarchy(i,1)[0]];isMissing=!pivot.cache.isUsedHeader(args);headers[headers.length-1].push({args:[pivot.id,...args],isMissing});}
return headers.map((row)=>{const reducedRow=row.reduce((acc,curr)=>{const val=curr.args.join('","');if(acc[val]===undefined){acc[val]={count:0,position:Object.keys(acc).length,isMissing:curr.isMissing,};}
acc[val].count++;return acc;},{});return Object.entries(reducedRow).map(([val,info])=>{const style=row===headers[headers.length-1]&&!info.isMissing&&"color: #756f6f;"
return{formula:`=PIVOT.HEADER("${val}")`,value:this._getLabel(val),span:info.count,position:info.position,isMissing:info.isMissing,style,};}).sort((a,b)=>(a.position>b.position?1:-1));});}
_buildRowHeaders(){const pivot=this.pivot;const rowCount=pivot.cache.getRowCount();const headers=[];for(let index=0;index<rowCount;index++){const pivotArgs=[];const current=pivot.cache.getRowValues(index);for(let i in current){pivotArgs.push(pivot.rowGroupBys[i]);pivotArgs.push(current[i]);}
const isMissing=!pivot.cache.isUsedHeader(pivotArgs);pivotArgs.unshift(pivot.id);headers.push({args:pivotArgs,isMissing});}
return headers.map(({args,isMissing})=>{const argsString=args.join('","');const style=this._getStyle(args);return{args,formula:`=PIVOT.HEADER("${argsString}")`,value:this._getLabel(argsString),style,isMissing,};});}
_buildValues(){const pivot=this.pivot;const length=pivot.cache.getTopHeaderCount()-pivot.measures.length;const values=[];for(let i=0;i<length;i++){const colElement=[...pivot.cache.getColumnValues(i),pivot.cache.getMeasureName(i),];const colValues=[];for(let rowElement of pivot.cache.getRows()){const pivotArgs=[];for(let index in rowElement){pivotArgs.push(pivot.rowGroupBys[index]);pivotArgs.push(rowElement[index]);}
for(let index in colElement){const field=pivot.cache.getColLevelIdentifier(index);if(field==="measure"){pivotArgs.unshift(colElement[index]);}else{pivotArgs.push(pivot.cache.getColLevelIdentifier(index));pivotArgs.push(colElement[index]);}}
const isMissing=!pivot.cache.isUsedValue(pivotArgs);pivotArgs.unshift(pivot.id);colValues.push({args:this._buildCell(pivotArgs),isMissing});}
values.push(colValues);}
for(let i=length;i<pivot.cache.getTopHeaderCount();i++){const colElement=[...pivot.cache.getColumnValues(i),pivot.cache.getMeasureName(i),];const colValues=[];for(let rowElement of pivot.cache.getRows()){const pivotArgs=[];for(let index in rowElement){pivotArgs.push(pivot.rowGroupBys[index]);pivotArgs.push(rowElement[index]);}
pivotArgs.unshift(colElement[0]);const isMissing=!pivot.cache.isUsedValue(pivotArgs);pivotArgs.unshift(pivot.id);colValues.push({args:this._buildCell(pivotArgs),isMissing});}
values.push(colValues);}
return values;}
_formatValue(value){if(!value){return"";}
return formatDecimal(value,2);}
_getLabel(args){const pivot=this.pivot;let domain=args.split('","');domain.shift();const len=domain.length;if(len===0){return _t("Total");}
const field=domain[len-2];const value=domain[len-1];if(field==="measure"){if(value==="__count"){return _t("Count");}
return pivot.cache.getField(value).string;}else{if(["date","datetime"].includes(pivot.cache.getField(field.split(":")[0]).type)){return pivotUtils.formatDate(field,value);}
return(pivot.cache.getGroupLabel(field,value)||_t("(Undefined)"));}}
_getStyle(args){const length=args.length-3;if(!length){return"";}
return`padding-left: ${(length) * 10}px`;}}
PivotDialog.template="documents_spreadsheet.PivotDialog";PivotDialog.components={PivotDialogTable};return PivotDialog;});;

/* /documents_spreadsheet/static/src/js/components/spreadsheet_pivot_dialog_table.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.PivotDialogTable",function(require){"use strict";class PivotDialogTable extends owl.Component{_onCellClicked(formula){this.trigger('cell-selected',{formula});}}
PivotDialogTable.template="documents_spreadsheet.PivotDialogTable";return PivotDialogTable;});;

/* /documents_spreadsheet/static/src/js/documents_inspector.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("spreadsheet.DocumentsInspector",function(require){"use strict";const DocumentsInspector=require("documents.DocumentsInspector");DocumentsInspector.include({events:_.extend({"click .o_document_spreadsheet":"_onOpenSpreadSheet",},DocumentsInspector.prototype.events),init:function(parent,params){this._super(...arguments);for(const record of this.records){this.recordsData[record.id].isSheet=record.data.handler==="spreadsheet";}},_computeClasses:function(record){let classes=this._super(...arguments);if(this.recordsData[record.id].isSheet){classes=classes.replace("o_documents_preview_mimetype","o_documents_preview_image");}
return classes;},_onOpenSpreadSheet:function(ev){ev.preventDefault();ev.stopPropagation();const activeId=$(ev.currentTarget).data("id");if(activeId){this.do_action({type:"ir.actions.client",tag:"action_open_spreadsheet",params:{active_id:activeId,},});}},});});;

/* /documents_spreadsheet/static/src/js/documents_kanban_record.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("spreadsheet.DocumentsKanbanRecord",function(require){"use strict";const DocumentsKanbanRecord=require("documents.DocumentsKanbanRecord");DocumentsKanbanRecord.include({events:_.extend({"click .o_document_spreadsheet":"_onOpenSheet",},DocumentsKanbanRecord.prototype.events),_onOpenSheet(ev){ev.preventDefault();ev.stopPropagation();if(this.state.data.handler==="spreadsheet"){const activeId=this.state.data.id;if(activeId){this.do_action({type:"ir.actions.client",tag:"action_open_spreadsheet",params:{active_id:activeId,},});}}},});});;

/* /documents_spreadsheet/static/src/js/spreadsheet_kanban_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.KanbanView",function(require){"use strict";const SpreadsheetKanbanController=require("documents_spreadsheet.KanbanController");const KanbanView=require("documents.DocumentsKanbanView");const viewRegistry=require("web.view_registry");const SpreadsheetKanbanView=KanbanView.extend({config:Object.assign({},KanbanView.prototype.config,{Controller:SpreadsheetKanbanController,}),});viewRegistry.add("documents_kanban",SpreadsheetKanbanView);return SpreadsheetKanbanView;});;

/* /documents_spreadsheet/static/src/js/documents_kanban_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.KanbanController",function(require){"use strict";const DocumentsKanbanController=require("documents.DocumentsKanbanController");const DocumentsControllerMixin=require("documents.controllerMixin");const DocumentsSpreadsheetControllerMixin=require("documents_spreadsheet.DocumentsControllerMixin");const SpreadsheetKanbanController=DocumentsKanbanController.extend(DocumentsSpreadsheetControllerMixin,{events:Object.assign({},DocumentsKanbanController.prototype.events,DocumentsSpreadsheetControllerMixin.events,DocumentsControllerMixin.events),custom_events:Object.assign({},DocumentsKanbanController.prototype.custom_events,DocumentsSpreadsheetControllerMixin.custom_events,DocumentsControllerMixin.custom_events),updateButtons(){this._super(...arguments);DocumentsControllerMixin.updateButtons.apply(this,arguments);DocumentsSpreadsheetControllerMixin.updateButtons.apply(this,arguments);},});return SpreadsheetKanbanController;});;

/* /documents_spreadsheet/static/src/js/documents_spreadsheet_controller_mixin.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.DocumentsControllerMixin",function(require){"use strict";const TemplateDialog=require("documents_spreadsheet.TemplateDialog");const{ComponentWrapper}=require("web.OwlCompatibility");const DocumentsSpreadsheetControllerMixin={events:{"click .o_documents_kanban_spreadsheet":"_onNewSpreadSheet",},custom_events:{spreadsheet_created:"_onSpreadsheetCreated",dialog_closed:"_destroyDialog",},updateButtons(){const selectedFolderId=this.searchModel.get("selectedFolderId");this.$buttons[0].querySelector(".o_documents_kanban_spreadsheet").disabled=!selectedFolderId;},_destroyDialog(){if(this.templateDialog){this.templateDialog.destroy();}
this.templateDialog=undefined;},_onNewSpreadSheet:async function(ev){ev.preventDefault();ev.stopPropagation();const context=this.model.get(this.handle).getContext();const searchView=await this.loadFieldView("spreadsheet.template",context,false,"search");this.templateDialog=new ComponentWrapper(this,TemplateDialog,{searchView,folderId:this.searchModel.get("selectedFolderId"),context,});await this.templateDialog.mount(this.el);},_onSpreadsheetCreated(ev){this.do_action({type:"ir.actions.client",tag:"action_open_spreadsheet",params:{active_id:ev.data.spreadsheetId,},});},};return DocumentsSpreadsheetControllerMixin;});;

/* /documents_spreadsheet/static/src/js/documents_list_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("spreadsheet.DocumentsListController",function(require){"use strict";const DocumentsListController=require("documents.DocumentsListController");const DocumentsControllerMixin=require("documents.controllerMixin");const DocumentsSpreadsheetControllerMixin=require("documents_spreadsheet.DocumentsControllerMixin");const SpreadsheetListController=DocumentsListController.extend(DocumentsSpreadsheetControllerMixin,{events:Object.assign({},DocumentsListController.prototype.events,DocumentsSpreadsheetControllerMixin.events,DocumentsControllerMixin.events),custom_events:Object.assign({},DocumentsListController.prototype.custom_events,DocumentsSpreadsheetControllerMixin.custom_events,DocumentsControllerMixin.custom_events),updateButtons(){this._super(...arguments);DocumentsControllerMixin.updateButtons.apply(this,arguments);DocumentsSpreadsheetControllerMixin.updateButtons.apply(this,arguments);},});return SpreadsheetListController;});;

/* /documents_spreadsheet/static/src/js/spreadsheet_list_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.ListView",function(require){"use strict";const SpreadsheetListController=require("spreadsheet.DocumentsListController");const ListView=require("documents.DocumentsListView");const viewRegistry=require("web.view_registry");const DocumentsListView=ListView.extend({config:Object.assign({},ListView.prototype.config,{Controller:SpreadsheetListController,}),});viewRegistry.add("documents_list",DocumentsListView);return DocumentsListView;});;

/* /documents_spreadsheet/static/src/js/spreadsheet_template_list_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.TemplateListView",function(require){"use strict";const ListController=require("web.ListController");const ListView=require("web.ListView");const viewRegistry=require("web.view_registry");const{getDataFromTemplate}=require("documents_spreadsheet.pivot_utils");const TemplateController=ListController.extend({_onButtonClicked(ev){this._super(...arguments);const{attrs,record}=ev.data;if(attrs.name==="create_spreadsheet"){this._createSpreadsheet(record);}else if(attrs.name==="edit_template"){this._editTemplate(record);}},async _createSpreadsheet(record){const data=await getDataFromTemplate(this._rpc.bind(this),record.data.id);const spreadsheetId=await this._rpc({model:"documents.document",method:"create",args:[{name:record.data.name,mimetype:"application/o-spreadsheet",handler:"spreadsheet",raw:JSON.stringify(data),},],});this.do_action({type:"ir.actions.client",tag:"action_open_spreadsheet",params:{active_id:spreadsheetId,},});},async _editTemplate(record){this.do_action({type:"ir.actions.client",tag:"action_open_template",params:{active_id:record.data.id,showFormulas:true,},});},});const TemplateListView=ListView.extend({config:Object.assign({},ListView.prototype.config,{Controller:TemplateController,}),});viewRegistry.add("spreadsheet_template_list",TemplateListView);return TemplateListView;});;

/* /documents_spreadsheet/static/src/js/pivot_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.PivotController",function(require){"use strict";const core=require("web.core");const config=require('web.config');const PivotController=require("web.PivotController");const session=require("web.session");const SpreadsheetSelectorDialog=require("documents_spreadsheet.SpreadsheetSelectorDialog");const pivotUtils=require("documents_spreadsheet.pivot_utils");const spreadsheet=require("documents_spreadsheet.spreadsheet_extended");const _t=core._t;const GridModel=spreadsheet.Model;const uuidv4=spreadsheet.helpers.uuidv4;PivotController.include({init(){this._super(...arguments);session.user_has_group("documents.group_documents_user").then((has_group)=>{this.canInsertPivot=has_group;});},updateButtons:function(){this._super(...arguments);if(!this.$buttons){return;}
const state=this.model.get({raw:true});const noDataDisplayed=!state.hasData||!state.measures.length;this.$buttons.filter('.o_pivot_add_spreadsheet').prop('disabled',noDataDisplayed);},_addIncludedButtons:async function(ev){await this._super(...arguments);if($(ev.target).hasClass("o_pivot_add_spreadsheet")){const spreadsheets=await this._rpc({model:"documents.document",method:"get_spreadsheets_to_display",args:[],});const dialog=new SpreadsheetSelectorDialog(self,spreadsheets).open();dialog.on("confirm",this,this._save_sheet);}},_getRenderButtonContext:function(){const context=this._super(...arguments);context.canInsertPivot=this.canInsertPivot;context.isMobile=config.device.isMobile;return context;},_initializeModel(workbookData){const isNewModel=!workbookData;if(isNewModel){workbookData={};}
const model=new GridModel(workbookData,{mode:"headless",evalContext:{env:this.renderer.env},});if(!isNewModel){model.dispatch("CREATE_SHEET",{activate:true,id:uuidv4()});}
return model;},async _getSpreadsheetModel(workbookData){const payload=this.model.get();const pivot=pivotUtils.sanitizePivot(payload);const model=this._initializeModel(workbookData);await pivotUtils.createPivotCache(pivot,this._rpc.bind(this));pivot.lastUpdate=Date.now();const anchor=[0,0];model.dispatch("ADD_PIVOT",{pivot,anchor});return model;},async _getSpreadsheetData(workbookData){const model=await this._getSpreadsheetModel(workbookData);return JSON.stringify(model.exportData());},async _save_sheet(spreadsheet){let documentId;let notificationMessage;if(!spreadsheet){documentId=await this._rpc({model:"documents.document",method:"create",args:[{name:_t("Untitled spreadsheet"),mimetype:"application/o-spreadsheet",handler:"spreadsheet",raw:await this._getSpreadsheetData(),},],});notificationMessage=_t("New spreadsheet created in Documents");}else{documentId=spreadsheet.id;const spreadsheetData=await this._rpc({model:"documents.document",method:"search_read",fields:["raw"],domain:[["id","=",documentId]],});const raw=await this._getSpreadsheetData(JSON.parse(spreadsheetData[0].raw));await this._rpc({model:"documents.document",method:"write",args:[[documentId],{raw}],});notificationMessage=_.str.sprintf(_t("New sheet inserted in '%s'"),spreadsheet.name);}
this.displayNotification({type:"info",message:notificationMessage,sticky:false,});this.do_action({type:"ir.actions.client",tag:"action_open_spreadsheet",params:{active_id:documentId,},});},});});;

/* /documents_spreadsheet/static/src/js/o-spreadsheet/widgets/field_selector_widget.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.field_selector_widget",function(require){const config=require("web.config");const FieldSelectorWidget=require("web.ModelFieldSelector");const{ComponentAdapter}=require("web.OwlCompatibility");const filters={text:["many2one","text","char"],date:["datetime","date"],relation:["many2one","many2many","one2many"],};class FieldSelectorAdapter extends ComponentAdapter{filter(fields,typeFilter,relatedModel){const _fields={};for(let[key,value]of Object.entries(fields)){if(filters[typeFilter].includes(value.type)){if(!relatedModel||value.relation===relatedModel){_fields[key]=value;}}}
return _fields;}
get widgetArgs(){const fields=this.filter(this.props.fields,this.props.type,this.props.relatedModel);const chain=this.props.selected?[this.props.selected.field]:[];return[this.props.model,chain,{fields,readonly:false,followRelations:false,debugMode:config.isDebug(),},];}}
return{FieldSelectorWidget,FieldSelectorAdapter};});;

/* /documents_spreadsheet/static/src/js/o-spreadsheet/widgets/model_selector_widget.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.model_selector_widget",function(require){const core=require("web.core");const{ComponentAdapter}=require("web.OwlCompatibility");const{FieldMany2One}=require("web.relational_fields");const StandaloneFieldManagerMixin=require("web.StandaloneFieldManagerMixin");const Widget=require("web.Widget");const QWeb=core.qweb;const ModelSelectorWidget=Widget.extend(StandaloneFieldManagerMixin,{init:function(parent,modelID,models){this._super.apply(this,arguments);StandaloneFieldManagerMixin.init.call(this);this.widget=undefined;this.value=modelID;this.models=models;},willStart:async function(){await this._super.apply(this,arguments);await this._createM2OWidget();},start:function(){const $content=$(QWeb.render("documents_spreadsheet.ModelSelector",{}));this.$el.append($content);this.widget.appendTo($content);return this._super.apply(this,arguments);},_confirmChange:async function(){const result=await StandaloneFieldManagerMixin._confirmChange.apply(this,arguments);this.trigger_up("model_selected",{value:this.widget.value.res_id});return result;},_createM2OWidget:async function(){const recordID=await this.model.makeRecord("ir.model",[{name:"ir.model",relation:"ir.model",type:"many2one",value:this.value,domain:[["model","in",this.models]],},]);this.widget=new FieldMany2One(this,"ir.model",this.model.get(recordID),{mode:"edit",attrs:{can_create:false,can_write:false,options:{no_open:true},},});this._registerWidget(recordID,"ir.model",this.widget);},});class ModelSelectorWidgetAdapter extends ComponentAdapter{get widgetArgs(){return[this.props.modelID,this.props.models];}}
return{ModelSelectorWidget,ModelSelectorWidgetAdapter};});;

/* /documents_spreadsheet/static/src/js/o-spreadsheet/widgets/tag_selector_widget.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.tag_selector_widget",function(require){"use strict";const core=require("web.core");const{ComponentAdapter}=require("web.OwlCompatibility");const{FieldMany2ManyTags}=require("web.relational_fields");const StandaloneFieldManagerMixin=require("web.StandaloneFieldManagerMixin");const Widget=require("web.Widget");const QWeb=core.qweb;const TagSelectorWidget=Widget.extend(StandaloneFieldManagerMixin,{init:function(parent,relatedModel,selectedValues){this._super.apply(this,arguments);StandaloneFieldManagerMixin.init.call(this);this.relatedModel=relatedModel;this.selectedValues=selectedValues;this.widget=undefined;},willStart:async function(){await this._super.apply(this,arguments);await this._makeM2MWidget();},start:function(){const $content=$(QWeb.render("documents_spreadsheet.RelationTags",{}));this.$el.append($content);this.widget.appendTo($content);return this._super.apply(this,arguments);},_confirmChange:async function(){const result=await StandaloneFieldManagerMixin._confirmChange.apply(this,arguments);this.trigger_up("value_changed",{value:this.widget.value.data.map((record)=>record.data)});return result;},_makeM2MWidget:async function(){const options={};options[this.relatedModel]={options:{no_create_edit:true,no_create:true,},};const recordID=await this.model.makeRecord(this.relatedModel,[{fields:[{name:"id",type:"integer",},{name:"display_name",type:"char",},],name:this.relatedModel,relation:this.relatedModel,type:"many2many",value:this.selectedValues,},],options);this.widget=new FieldMany2ManyTags(this,this.relatedModel,this.model.get(recordID),{mode:"edit"});this._registerWidget(recordID,this.relatedModel,this.widget);},});class TagSelectorWidgetAdapter extends ComponentAdapter{get widgetArgs(){return[this.props.relatedModel,this.props.selectedValues];}}
return{TagSelectorWidget,TagSelectorWidgetAdapter};});;

/* /documents_spreadsheet/static/src/js/o-spreadsheet/context_menu/pivot_context_menu.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.pivot_context_menu",function(require){"use strict";const core=require("web.core");const spreadsheet=require("documents_spreadsheet.spreadsheet_extended");const{fetchCache,formatGroupBy,formatHeader,waitForIdle}=require("documents_spreadsheet.pivot_utils");const _t=core._t;const cellMenuRegistry=spreadsheet.registries.cellMenuRegistry;const{toXC,toCartesian}=spreadsheet.helpers;const createFullMenuItem=spreadsheet.helpers.createFullMenuItem;cellMenuRegistry.add("reinsert_pivot",{name:_t("Re-insert pivot"),sequence:122,children:(env)=>Object.values(env.getters.getPivots()).map((pivot,index)=>(createFullMenuItem(`reinsert_pivot_${pivot.id}`,{name:`${pivot.cache && pivot.cache.getModelLabel() || pivot.model} (#${pivot.id})`,sequence:index,action:async(env)=>{const cache=pivot.cache;pivot.lastUpdate=undefined;await fetchCache(pivot,env.services.rpc,{dataOnly:true,initialDomain:true});const zone=env.getters.getSelectedZone();env.dispatch("REBUILD_PIVOT",{id:pivot.id,anchor:[zone.left,zone.top],});pivot.cache=cache;env.dispatch("EVALUATE_CELLS");}})),),isVisible:(env)=>env.getters.getPivots().length,}).add("insert_pivot_cell",{name:_t("Insert pivot cell"),sequence:123,children:(env)=>Object.values(env.getters.getPivots()).map((pivot,index)=>(createFullMenuItem(`insert_pivot_cell_${pivot.id}`,{name:`${pivot.cache && pivot.cache.getModelLabel() || pivot.model} (#${pivot.id})`,sequence:index,action:async(env)=>{const xc=env.getters.getMainCell(toXC(...env.getters.getPosition()));const[col,row]=toCartesian(xc);const insertPivotValueCallback=(formula)=>{env.dispatch("UPDATE_CELL",{sheet:env.getters.getActiveSheet(),col,row,content:formula});}
pivot.lastUpdate=undefined;await fetchCache(pivot,env.services.rpc,{dataOnly:true});env.dispatch("EVALUATE_CELLS");await waitForIdle(env.getters);env.openPivotDialog({pivotId:pivot.id,insertPivotValueCallback});},})),),isVisible:(env)=>env.getters.getPivots().length,separator:true,}).add("pivot_properties",{name:_t("Pivot properties"),sequence:121,action(env){env.dispatch("SELECT_PIVOT",{cell:env.getters.getActiveCell()});const pivot=env.getters.getSelectedPivot();if(pivot){env.openSidePanel("PIVOT_PROPERTIES_PANEL",{pivot});}},isVisible:(env)=>{const cell=env.getters.getActiveCell();return cell&&cell.type==="formula"&&cell.content.match(/=\s*PIVOT/);}});});;

/* /documents_spreadsheet/static/src/js/o-spreadsheet/context_menu/menu_item_registry.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.menu_item_registry",function(require){"use strict";const spreadsheet=require("documents_spreadsheet.spreadsheet_extended");const core=require("web.core");const _t=core._t;const topbarMenuRegistry=spreadsheet.registries.topbarMenuRegistry;topbarMenuRegistry.add("file",{name:_t("File"),sequence:10});topbarMenuRegistry.addChild("new_sheet",["file"],{name:_t("New"),sequence:10,action:(env)=>env.newSpreadsheet(),});topbarMenuRegistry.addChild("make_copy",["file"],{name:_t("Make a copy"),sequence:20,action:(env)=>env.makeCopy(),});topbarMenuRegistry.addChild("save",["file"],{name:_t("Save"),sequence:30,action:(env)=>env.saveData(),});topbarMenuRegistry.addChild("save_as_template",["file"],{name:_t("Save as Template"),sequence:40,action:(env)=>env.saveAsTemplate(),});});;

/* /documents_spreadsheet/static/src/js/o-spreadsheet/context_menu/pivot_side_panel.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.pivot_side_panel",function(require){"use strict";const core=require("web.core");const{ComponentAdapter}=require("web.OwlCompatibility");const DomainSelector=require("web.DomainSelector");const spreadsheet=require("documents_spreadsheet.spreadsheet_extended");const pivotUtils=require("documents_spreadsheet.pivot_utils");const{sprintf}=require("web.utils");const{time_to_str}=require('web.time');const _t=core._t;const sidePanelRegistry=spreadsheet.registries.sidePanelRegistry;const{useState}=owl.hooks;class DomainComponentAdapter extends ComponentAdapter{get widgetArgs(){return[this.props.model,this.props.domain,{readonly:true,filters:{}}];}}
class PivotSidePanel extends owl.Component{constructor(parent,props){super(...arguments);this.state=useState({pivotId:undefined,});this.pivot=props.pivot;this.DomainSelector=DomainSelector;this.periods={day:_t("Day"),week:_t("Week"),month:_t("Month"),quarter:_t("Quarter"),year:_t("Year"),};}
async willUpdateProps(nextProps){this.pivot=nextProps.pivot;}
formatGroupBy(gp){return pivotUtils.formatGroupBy(this.pivot,gp);}
formatMeasure(measure){if(this.pivot&&this.pivot.cache){return measure.field==="__count"?_t("Count"):this.pivot.cache.getField(measure.field).string;}}
getLastUpdate(){return time_to_str(new Date(this.pivot.lastUpdate));}
refreshMeasures(id){this.env.dispatch("REFRESH_PIVOT",{id});}
getPivotName(){if(this.pivot&&this.pivot.cache){const modelName=this.pivot.cache.getModelLabel();return sprintf(_t("%s (#%s)"),modelName,this.pivot&&this.pivot.id);}}}
PivotSidePanel.template="documents_spreadsheet.PivotSidePanel";PivotSidePanel.components={DomainComponentAdapter};sidePanelRegistry.add("PIVOT_PROPERTIES_PANEL",{title:(env)=>{return _t("Pivot properties");},Body:PivotSidePanel,});});;

/* /documents_spreadsheet/static/src/js/components/filter_editor_side_panel.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.filter_editor_side_panel",function(require){"use strict";const core=require("web.core");const spreadsheet=require("documents_spreadsheet.spreadsheet_extended");const DateFilterValue=require("documents_spreadsheet.DateFilterValue");const CancelledReason=require("documents_spreadsheet.CancelledReason");const{FieldSelectorWidget,FieldSelectorAdapter,}=require("documents_spreadsheet.field_selector_widget");const{ModelSelectorWidget,ModelSelectorWidgetAdapter,}=require("documents_spreadsheet.model_selector_widget");const{TagSelectorWidget,TagSelectorWidgetAdapter,}=require("documents_spreadsheet.tag_selector_widget");const _t=core._t;const{useState}=owl.hooks;const sidePanelRegistry=spreadsheet.registries.sidePanelRegistry;const{uuidv4}=spreadsheet.helpers;class FilterEditorSidePanel extends owl.Component{constructor(parent,props){super(...arguments);this.id=undefined;this.state=useState({saved:false,label:undefined,type:undefined,pivotFields:{},text:{defaultValue:undefined,},date:{defaultValue:{},type:undefined,options:[],},relation:{defaultValue:[],displayNames:[],relatedModelID:undefined,relatedModelName:undefined,},});this.pivots=this.env.getters.getPivots();this.loadValues(props);this.FieldSelectorWidget=FieldSelectorWidget;this.ModelSelectorWidget=ModelSelectorWidget;this.TagSelectorWidget=TagSelectorWidget;}
get placeholder(){return _t(`New ${this.state.type} filter`);}
get missingLabel(){return this.state.saved&&!Boolean(this.state.label);}
get missingField(){return this.state.saved&&Object.keys(this.state.pivotFields).length===0;}
get missingModel(){return(this.state.saved&&this.state.type==="relation"&&!this.state.relation.relatedModelID);}
get relatedModels(){return[...new Set(this.env.getters.getPivots().filter((pivot)=>pivot.isLoaded).map((pivot)=>Object.values(pivot.cache.getFields())).flat().filter((field)=>field.type==="many2one").map((field)=>field.relation)),];}
loadValues(props){this.id=props.id;const globalFilter=this.id&&this.env.getters.getGlobalFilter(this.id);this.state.label=globalFilter&&globalFilter.label;this.state.type=globalFilter?globalFilter.type:props.type;this.state.pivotFields=globalFilter?globalFilter.fields:{};this.state.date.type=this.state.type==="date"&&globalFilter?globalFilter.rangeType:"year";if(globalFilter){this.state[this.state.type].defaultValue=globalFilter.defaultValue;if(this.state.type==="relation"){this.state.relation.relatedModelID=globalFilter.modelID;}}}
async willStart(){await this.fetchModel();}
async onModelSelected(ev){if(this.state.relation.relatedModelID!==ev.detail.value){this.state.relation.defaultValue=[];}
this.state.relation.relatedModelID=ev.detail.value;await this.fetchModel();for(const pivot of this.pivots.filter((pivot)=>pivot.isLoaded)){const[field,fieldDesc]=Object.entries(pivot.cache.getFields()).find(([fieldName,fieldDesc])=>fieldDesc.type==="many2one"&&fieldDesc.relation===this.state.relation.relatedModelName)||[];this.state.pivotFields[pivot.id]=field?{field,type:fieldDesc.type}:undefined;}}
async fetchModel(){if(!this.state.relation.relatedModelID){this.state.relation.relatedModelName=undefined;return;}
const result=await this.rpc({model:"ir.model",method:"search_read",fields:["model","name"],domain:[["id","=",this.state.relation.relatedModelID]],});this.state.relation.relatedModelName=result[0]&&result[0].model;if(!this.state.label){this.state.label=result[0]&&result[0].name;}}
onSelectedField(id,ev){const fieldName=ev.detail.chain[0];const field=this.pivots.find((pivot)=>pivot.id===id).cache.getField(fieldName);if(field){this.state.pivotFields[id]={field:fieldName,type:field.type,};}}
onSave(){this.state.saved=true;if(this.missingLabel||this.missingField||this.missingModel){this.env.services.notification.notify({type:"danger",title:this.env._t("Invalid fields"),sticky:false,});return;}
const cmd=this.id?"EDIT_PIVOT_FILTER":"ADD_PIVOT_FILTER";const id=this.id||uuidv4();const filter={id,type:this.state.type,label:this.state.label,modelID:this.state.relation.relatedModelID,modelName:this.state.relation.relatedModelName,defaultValue:this.state[this.state.type].defaultValue,defaultValueDisplayNames:this.state[this.state.type].displayNames,rangeType:this.state.date.type,fields:this.state.pivotFields,};const result=this.env.dispatch(cmd,{id,filter});if(result.status==="CANCELLED"&&result.reason===CancelledReason.DuplicatedFilterLabel){this.env.services.notification.notify({type:"danger",title:this.env._t("Duplicated Label"),sticky:false,});return;}
this.env.openSidePanel("GLOBAL_FILTERS_SIDE_PANEL",{});}
onCancel(){this.env.openSidePanel("GLOBAL_FILTERS_SIDE_PANEL",{});}
onValuesSelected(ev){this.state.relation.defaultValue=ev.detail.value.map((record)=>record.id);this.state.relation.displayNames=ev.detail.value.map((record)=>record.display_name);}
onTimeRangeChanged(ev){const{year,period}=ev.detail;this.state.date.defaultValue=ev.detail;}
onDelete(){if(this.id){this.env.dispatch("REMOVE_PIVOT_FILTER",{id:this.id});}
this.env.openSidePanel("GLOBAL_FILTERS_SIDE_PANEL",{});}
onDateOptionChange(ev){this.state.date.type=ev.target.value;}}
FilterEditorSidePanel.template="documents_spreadsheet.FilterEditorSidePanel";FilterEditorSidePanel.components={FieldSelectorAdapter,ModelSelectorWidgetAdapter,TagSelectorWidgetAdapter,DateFilterValue,};sidePanelRegistry.add("FILTERS_SIDE_PANEL",{title:_t("Filter properties"),Body:FilterEditorSidePanel,});return FilterEditorSidePanel;});;

/* /documents_spreadsheet/static/src/js/components/global_filters_side_panel.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.global_filters_side_panel",function(require){"use strict";const core=require("web.core");const spreadsheet=require("documents_spreadsheet.spreadsheet_extended");const DateFilterValue=require("documents_spreadsheet.DateFilterValue");const{TagSelectorWidget,TagSelectorWidgetAdapter,}=require("documents_spreadsheet.tag_selector_widget");const{getPeriodOptions}=require("web.searchUtils");const _t=core._t;const sidePanelRegistry=spreadsheet.registries.sidePanelRegistry;class GlobalFiltersSidePanel extends owl.Component{constructor(){super(...arguments);this.TagSelectorWidget=TagSelectorWidget;this.periodOptions=getPeriodOptions(moment());}
get filters(){return this.env.getters.getGlobalFilters();}
newText(){this.env.openSidePanel("FILTERS_SIDE_PANEL",{type:"text"});}
newDate(){this.env.openSidePanel("FILTERS_SIDE_PANEL",{type:"date"});}
newRelation(){this.env.openSidePanel("FILTERS_SIDE_PANEL",{type:"relation"});}
onEdit(id){this.env.openSidePanel("FILTERS_SIDE_PANEL",{id});}
onDateInput(id,event){const value=event.detail;this.env.dispatch("SET_PIVOT_FILTER_VALUE",{id,value});}
onTextInput(id,event){const value=event.target.value;this.env.dispatch("SET_PIVOT_FILTER_VALUE",{id,value});}
onTagSelected(id,event){const values=event.detail.value;this.env.dispatch("SET_PIVOT_FILTER_VALUE",{id,value:values.map((record)=>record.id),displayNames:values.map((record)=>record.display_name),});}
onDelete(){if(this.id){this.env.dispatch("REMOVE_PIVOT_FILTER",{id:this.id});}
this.trigger("close-side-panel");}}
GlobalFiltersSidePanel.template="documents_spreadsheet.GlobalFiltersSidePanel";GlobalFiltersSidePanel.components={TagSelectorWidgetAdapter,DateFilterValue};sidePanelRegistry.add("GLOBAL_FILTERS_SIDE_PANEL",{title:_t("Filters"),Body:GlobalFiltersSidePanel,});return GlobalFiltersSidePanel;});;

/* /documents_spreadsheet/static/src/js/components/filter_date_value.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.DateFilterValue",function(require){"use strict";const{getPeriodOptions}=require("web.searchUtils");const dateTypeOptions={month:["this_month","last_month","antepenultimate_month"],quarter:["first_quarter","second_quarter","third_quarter","fourth_quarter"],year:["this_year","last_year","antepenultimate_year"],};function dateOptions(type){return getPeriodOptions(moment()).filter(({id})=>dateTypeOptions[type].includes(id));}
class DateFilterValue extends owl.Component{dateOptions(type){return type?dateOptions(type):[];}
isYear(){return this.props.type==="year";}
isSelected(periodId){return[this.props.year,this.props.period].includes(periodId);}
onPeriodChanged(ev){const value=ev.target.value;this.trigger("time-range-changed",{year:this.props.year,period:value!=="empty"?value:undefined,});}
onYearChanged(ev){const value=ev.target.value;this.trigger("time-range-changed",{year:value!=="empty"?value:undefined,period:this.props.period,});}}
DateFilterValue.template="documents_spreadsheet.DateFilterValue";return DateFilterValue;});;

/* /documents_spreadsheet/static/src/js/o-spreadsheet/filter_component.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.filter_component",function(require){const{Component}=owl;const spreadsheet=require("documents_spreadsheet.spreadsheet_extended");const Menu=spreadsheet.Menu;const{topbarComponentRegistry}=spreadsheet.registries;class FilterComponent extends Component{constructor(){super(...arguments);}
get activeFilter(){return this.env.getters.getActiveFilterCount();}
toggleDropdown(){this.env.toggleSidePanel("GLOBAL_FILTERS_SIDE_PANEL");}}
FilterComponent.template="documents_spreadsheet.FilterComponent";FilterComponent.components={Menu,};topbarComponentRegistry.add("filter_component",{component:FilterComponent,isVisible:(env)=>env.getters.getPivots().length,});return{FilterComponent};});;

/* /documents_spreadsheet/static/src/js/o-spreadsheet/autofill.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.autofill",function(require){"use strict";const spreadsheet=require("documents_spreadsheet.spreadsheet_extended");const UP=0;const DOWN=1;const LEFT=2;const RIGHT=3;const autofillRulesRegistry=spreadsheet.registries.autofillRulesRegistry;const autofillModifiersRegistry=spreadsheet.registries.autofillModifiersRegistry;class AutofillTooltip extends owl.Component{}
AutofillTooltip.template="documents_spreadsheet.AutofillTooltip";autofillRulesRegistry.add("autofill_pivot",{condition:(cell)=>cell&&cell.type==="formula"&&cell.content.match(/=\s*PIVOT/),generateRule:(cell,cells)=>{const increment=cells.filter((cell)=>cell&&cell.type==="formula"&&cell.content.match(/=\s*PIVOT/)).length;return{type:"PIVOT_UPDATER",increment,current:0};},sequence:10,}).add("autofill_pivot_position",{condition:(cell)=>cell&&cell.type==="formula"&&cell.content.match(/=.*PIVOT.*PIVOT\.POSITION/),generateRule:()=>({type:"PIVOT_POSITION_UPDATER",current:0}),sequence:1,});autofillModifiersRegistry.add("PIVOT_UPDATER",{apply:(rule,data,getters,direction)=>{rule.current+=rule.increment;let isColumn;let steps;switch(direction){case UP:isColumn=false;steps=-rule.current;break;case DOWN:isColumn=false;steps=rule.current;break;case LEFT:isColumn=true;steps=-rule.current;break;case RIGHT:isColumn=true;steps=rule.current;}
const content=getters.getNextValue(data.content,isColumn,steps);const tooltip=content?{props:{content:getters.getTooltipFormula(content,isColumn),},component:AutofillTooltip,}:undefined;return{cellData:{style:undefined,format:undefined,border:undefined,content,},tooltip,};},}).add("PIVOT_POSITION_UPDATER",{apply:(rule,data,getters,direction)=>{const pivotId=data.content.match(/PIVOT\.POSITION\(\s*"(\w+)"\s*,/)[1];const pivot=getters.getPivot(pivotId);if(!pivot)return data;const fields=[UP,DOWN].includes(direction)?pivot.rowGroupBys.slice():pivot.colGroupBys.slice();const step=[RIGHT,DOWN].includes(direction)?1:-1;const field=fields.reverse().find((field)=>new RegExp(`PIVOT\\.POSITION.*${field}.*\\)`).test(data.content));const content=data.content.replace(new RegExp(`(.*PIVOT\\.POSITION\\(\\s*"\\w"\\s*,\\s*"${field}"\\s*,\\s*"?)(\\d+)(.*)`),(match,before,position,after)=>{rule.current+=step;return before+Math.max(parseInt(position)+rule.current,1)+after;});return{cellData:Object.assign({},data,{content}),tooltip:content?{props:{content},}:undefined,}},});});;

/* /documents_spreadsheet/static/src/js/o-spreadsheet/pivot_utils.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.pivot_utils",function(require){"use strict";const core=require("web.core");const _t=core._t;const PivotCache=require("documents_spreadsheet.pivot_cache");const{parse,astToFormula,helpers}=require("documents_spreadsheet.spreadsheet");const{Model}=require("documents_spreadsheet.spreadsheet");const formats={"day":{in:"DD MMM YYYY",out:"DD/MM/YYYY",display:"DD MMM YYYY",interval:"d"},"week":{in:"[W]W YYYY",out:"WW/YYYY",display:"[W]W YYYY",interval:"w"},"month":{in:"MMMM YYYY",out:"MM/YYYY",display:"MMMM YYYY",interval:"M"},"quarter":{in:"Q YYYY",out:"Q/YYYY",display:"[Q]Q YYYY",interval:"Q"},"year":{in:"YYYY",out:"YYYY",display:"YYYY",interval:"y"},}
const periods={"day":_t("Day"),"week":_t("Week"),"month":_t("Month"),"quarter":_t("Quarter"),"year":_t("Year"),}
async function createPivotCache(pivot,rpc,{dataOnly=false,initialDomain=false}={}){const domain=(!initialDomain&&pivot.computedDomain)||pivot.domain;const readGroupRPC=rpc({model:pivot.model,method:"read_group",context:pivot.context,domain,fields:pivot.measures.map((elt)=>elt.field==="__count"?elt.field:elt.field+":"+elt.operator),groupBy:pivot.rowGroupBys.concat(pivot.colGroupBys),lazy:false,});const fieldsPromise=_fetchFields(rpc,pivot,{forceRefetch:!dataOnly})
const modelNamePromise=_fetchModelName(rpc,pivot,{forceRefetch:!dataOnly});const resultGB=await readGroupRPC;const resultFG=await fieldsPromise;const resultSR=await modelNamePromise;pivot.cache=await _createCache(resultGB,resultFG,resultSR,pivot,rpc);}
async function _fetchFields(rpc,pivot,{forceRefetch}){if(!forceRefetch&&pivot.cache&&Object.keys(pivot.cache).length!==0){return pivot.cache.getFields();}
else{return rpc({model:pivot.model,method:"fields_get",});}}
async function _fetchModelName(rpc,pivot,{forceRefetch}){if(!forceRefetch&&pivot.cache){return pivot.cache.getModelLabel();}
else{const result=await rpc({model:"ir.model",method:"search_read",fields:["name"],domain:[["model","=",pivot.model]],});return result[0]&&result[0].name;}}
async function fetchCache(pivot,rpc,{dataOnly=false,initialDomain=false}={}){if(!pivot.lastUpdate){pivot.lastUpdate=Date.now();pivot.promise=createPivotCache(pivot,rpc,{dataOnly,initialDomain});}
await pivot.promise;}
async function fetchLabel(pivot,rpc,field,value){const model=pivot.cache.getField(field).relation;const label=rpc({model,method:'name_get',args:[parseInt(value,10)],}).then((result)=>result&&result[0]&&result[0][1]||undefined);pivot.cache=pivot.cache.withLabel(field,value,label);return pivot.cache.getGroupLabel(field,value);}
function formatDate(field,value){const interval=field.split(":")[1];const output=formats[interval].display;const input=formats[interval].out;const date=moment(value,input);return date.isValid()?date.format(output):_t("(Undefined)");}
function formatGroupBy(pivot,gp){if(!pivot.isLoaded){return gp;}
let[name,period]=gp.split(":");period=periods[period];return pivot.cache.getField(name).string+(period?` (${period})`:"");}
function formatHeader(pivot,groupBy,value){if(groupBy==="measure"){if(value==="__count"){return _t("Count");}
return pivot.cache.getField(value).string}
if(["date","datetime"].includes(pivot.cache.getField(groupBy.split(":")[0]).type)){return formatDate(groupBy,value);}
return pivot.cache.getGroupLabel(groupBy,value);}
function sanitizePivot(payload){let measures=_sanitizeFields(payload.measures,payload.fields);measures=payload.measures.map((measure)=>{const fieldName=measure.split(":")[0];const fieldDesc=payload.fields[fieldName];const operator=(fieldDesc.group_operator&&fieldDesc.group_operator.toLowerCase())||"sum";return{field:measure,operator,};});const rowGroupBys=_sanitizeFields(payload.rowGroupBys,payload.fields);const colGroupBys=_sanitizeFields(payload.colGroupBys,payload.fields);return{model:payload.modelName,rowGroupBys,colGroupBys,measures,domain:payload.domain,context:payload.context,};}
function convertFormulas(cells,convertFunction,...args){cells.forEach((cell)=>{const ast=convertFunction(parse(cell.content),...args);cell.content=ast?`=${astToFormula(ast)}`:"";});}
async function convertPivotFormulas(rpc,cells,convertFunction,pivots,...args){if(!pivots||pivots.length===0)return;await Promise.all(Object.values(pivots).map((pivot)=>fetchCache(pivot,rpc)));convertFormulas(cells,convertFunction,pivots,...args);Object.values(pivots).forEach((pivot)=>{pivot.cache=undefined;pivot.lastUpdate=undefined;pivot.isLoaded=false;})}
function absoluteToRelative(ast,pivots){switch(ast.type){case"ASYNC_FUNCALL":case"FUNCALL":switch(ast.value){case"PIVOT":return _pivotAbsoluteToRelative(ast,pivots);case"PIVOT.HEADER":return _pivotHeaderAbsoluteToRelative(ast,pivots);default:return Object.assign({},ast,{args:ast.args.map((child)=>absoluteToRelative(child,pivots)),});}
case"UNARY_OPERATION":return Object.assign({},ast,{right:absoluteToRelative(ast.right,pivots),});case"BIN_OPERATION":return Object.assign({},ast,{right:absoluteToRelative(ast.right,pivots),left:absoluteToRelative(ast.left,pivots),});}
return ast;}
function relativeToAbsolute(ast,pivots){switch(ast.type){case"ASYNC_FUNCALL":case"FUNCALL":switch(ast.value){case"PIVOT.POSITION":return _pivotPositionToAbsolute(ast,pivots);default:return Object.assign({},ast,{args:ast.args.map((child)=>relativeToAbsolute(child,pivots)),});}
case"UNARY_OPERATION":return Object.assign({},ast,{right:relativeToAbsolute(ast.right,pivots),});case"BIN_OPERATION":return Object.assign({},ast,{right:relativeToAbsolute(ast.right,pivots),left:relativeToAbsolute(ast.left,pivots),});}
return ast;}
async function getDataFromTemplate(rpc,templateId){let[{data}]=await rpc({method:"read",model:"spreadsheet.template",args:[templateId,["data"]],});data=JSON.parse(atob(data));const{pivots}=data;await convertPivotFormulas(rpc,getCells(data,/^\s*=.*PIVOT/),relativeToAbsolute,pivots);return _removeInvalidPivotRows(rpc,data);}
function getCells(data,regex){return Object.values(data.sheets||[]).map((sheet)=>Object.values(sheet.cells)).flat().filter((cell)=>regex.test(cell.content));}
function _removeInvalidPivotRows(rpc,data){const model=new Model(data,{mode:"headless",evalContext:{env:{services:{rpc},},},});for(let sheet of model.getters.getSheets()){const invalidRows=[];for(let rowIndex=0;rowIndex<model.getters.getNumberRows(sheet.id);rowIndex++){const{cells}=model.getters.getRow(sheet.id,rowIndex);const[valid,invalid]=Object.values(cells).filter((cell)=>/^\s*=.*PIVOT/.test(cell.content)).reduce(([valid,invalid],cell)=>{const isInvalid=/^\s*=.*PIVOT(\.HEADER)?.*#IDNOTFOUND/.test(cell.content);return[isInvalid?valid:valid+1,isInvalid?invalid+1:invalid];},[0,0]);if(invalid>0&&valid===0){invalidRows.push(rowIndex);}}
model.dispatch("REMOVE_ROWS",{rows:invalidRows,sheet:sheet.id});}
data=model.exportData();convertFormulas(getCells(data,/^\s*=.*PIVOT.*#IDNOTFOUND/),()=>null,);return data;}
function _pivotAbsoluteToRelative(ast,pivots){ast=Object.assign({},ast);const[pivotIdAst,measureAst,...domainAsts]=ast.args;if(pivotIdAst.type!=="STRING")return ast;ast.args=[pivotIdAst,measureAst,..._domainToRelative(pivots,pivotIdAst,domainAsts),];return ast;}
function _pivotHeaderAbsoluteToRelative(ast,pivots){ast=Object.assign({},ast);const[pivotIdAst,...domainAsts]=ast.args;if(pivotIdAst.type!=="STRING")return ast;ast.args=[pivotIdAst,..._domainToRelative(pivots,pivotIdAst,domainAsts),];return ast;}
function _pivotPositionToAbsolute(ast,pivots){const[pivotIdAst,fieldAst,positionAst]=ast.args;const pivotId=JSON.parse(pivotIdAst.value);const fieldName=JSON.parse(fieldAst.value);const position=JSON.parse(positionAst.value);const id=pivots[pivotId].cache.getFieldValues(fieldName)[position-1];return{value:id?`"${id}"`:`"#IDNOTFOUND"`,type:id?"STRING":"UNKNOWN",};}
function _domainToRelative(pivots,pivotIdAst,domainAsts){let relativeDomain=[];for(let i=0;i<=domainAsts.length-1;i+=2){const fieldAst=domainAsts[i];const valueAst=domainAsts[i+1];const pivotId=JSON.parse(pivotIdAst.value);const pivot=pivots[pivotId];const fieldName=JSON.parse(fieldAst.value);if(_isAbsolute(fieldName,pivot)&&fieldAst.type==="STRING"&&["STRING","NUMBER"].includes(valueAst.type)){const id=JSON.parse(valueAst.value);const index=pivot.cache.getFieldValues(fieldName).indexOf(id.toString());relativeDomain=relativeDomain.concat([fieldAst,{type:"FUNCALL",value:"PIVOT.POSITION",args:[pivotIdAst,fieldAst,{type:"NUMBER",value:index+1}],},]);}else{relativeDomain=relativeDomain.concat([fieldAst,valueAst]);}}
return relativeDomain;}
function _isAbsolute(fieldName,pivot){const field=pivot.cache.getField(fieldName.split(":")[0])
return field&&field.type==="many2one";}
async function _createCache(readGroupResult,fieldsGetResult,modelLabel,pivot,rpc){const groupBys={};const labels={};const values=[];const fieldNames=pivot.rowGroupBys.concat(pivot.colGroupBys);for(let fieldName of fieldNames){labels[fieldName]={};}
for(let readGroup of readGroupResult){const value={};for(let measure of pivot.measures){const field=measure.field;value[field]=readGroup[field];}
value["count"]=readGroup["__count"];const index=values.push(value)-1;for(let fieldName of fieldNames){const{label,id}=_formatValue(fieldName,readGroup[fieldName],fieldsGetResult);labels[fieldName][id]=label;let groupBy=groupBys[fieldName]||{};let vals=groupBy[id]||[];vals.push(index);groupBy[id]=vals;groupBys[fieldName]=groupBy;}}
const orderedValues=await _getOrderedValues(pivot,groupBys,fieldsGetResult,rpc);const orderedMeasureIds={};for(const fieldName of fieldNames){orderedMeasureIds[fieldName]=orderedValues[fieldName]?orderedValues[fieldName].map((value)=>[value,groupBys[fieldName][value]||[]]):[];}
const measures=pivot.measures.map((m)=>m.field);const rows=_createRows(pivot.rowGroupBys,orderedMeasureIds);const cols=_createCols(pivot.colGroupBys,orderedMeasureIds,measures);const colStructure=pivot.colGroupBys.slice();colStructure.push("measure");return new PivotCache({cols,colStructure,fields:fieldsGetResult,orderedMeasureIds,labels,modelLabel,rows,values,});}
async function _getOrderedValues({model,context},groupBys,fields,rpc){return Object.fromEntries(await Promise.all(Object.entries(groupBys).map(async([groupBy,measures])=>{const[fieldName,aggregationFunction]=groupBy.split(":");const field=fields[fieldName];let values=Object.keys(measures);const hasUndefined=values.includes("false");values=["date","datetime"].includes(field.type)?_orderDateValues(values.filter((value)=>value!=="false"),aggregationFunction):await _orderValues(values,fieldName,field,model,context,rpc);if(hasUndefined&&field.type!=="boolean"){values.push("false");}
return[groupBy,values];})));}
function _orderDateValues(values,aggregationFunction){return aggregationFunction==="quarter"?values.sort():values.map((value)=>moment(value,formats[aggregationFunction].out)).sort((a,b)=>a-b).map((value)=>value.format(formats[aggregationFunction].out));}
async function _orderValues(values,fieldName,field,model,context,rpc){const requestField=field.relation?"id":fieldName;values=["boolean","many2one","integer","float"].includes(field.type)?values.map((value)=>JSON.parse(value)):values;const records=await rpc({model:field.relation?field.relation:model,domain:[[requestField,"in",values]],context,method:"search_read",fields:[requestField],orderBy:field.relation?false:[{name:fieldName,asc:true}]});return[...new Set(records.map((record)=>record[requestField].toString()))];}
function _createCols(groupBys,values,measures){const cols=[];if(groupBys.length!==0){_fillColumns(cols,[],[],groupBys,measures,values,false);}
for(let field of measures){cols.push([[],[field]]);}
return cols;}
function _createRows(groupBys,values){const rows=[];_fillRows(rows,[],groupBys,values,false);rows.push([]);return rows;}
function _formatValue(fieldDesc,value,fieldsGetResult){const[fieldName,group]=fieldDesc.split(":");const field=fieldsGetResult[fieldName];let id;let label;if(value instanceof Array){id=value[0];label=value[1];}else{id=value;label=value;}
if(field&&field.type==="selection"){const selection=field.selection.find(x=>x[0]===id);label=selection&&selection[1];}
if(field&&["date","datetime"].includes(field.type)&&group&&value){const fIn=formats[group]["in"];const fOut=formats[group]["out"];const date=moment(value,fIn)
id=date.isValid()?date.format(fOut):false;label=id;}
return{label,id};}
function _intersect(a,b){return a.filter((x)=>b.includes(x));}
function _fillColumns(cols,currentRow,currentCol,groupBys,measures,values,currentIds){const field=groupBys[0];if(!field){for(let measure of measures){const row=currentRow.slice();const col=currentCol.slice();row.push(measure);col.push(row);cols.push(col);}
return;}
for(let[id,vals]of values[field]||[]){let ids=currentIds?_intersect(currentIds,vals):vals;const row=currentRow.slice();const col=currentCol.slice();row.push(id);col.push(row);_fillColumns(cols,row,col,groupBys.slice(1),measures,values,ids);}}
function _fillRows(rows,currentRow,groupBys,values,currentIds){if(groupBys.length===0){return;}
const fieldName=groupBys[0];for(let[id,vals]of values[fieldName]||[]){let ids=currentIds?_intersect(currentIds,vals):vals;const row=currentRow.slice();row.push(id);rows.push(row);_fillRows(rows,row,groupBys.slice(1),values,ids);}}
function _sanitizeFields(fields,allFields){return fields.map((field)=>{let[fieldName,group]=field.split(":");const fieldDesc=allFields[fieldName];if(["date","datetime"].includes(fieldDesc.type)){if(!group){group="month";}
return`${fieldName}:${group}`;}
return fieldName;})}
async function waitForIdle(getters){return new Promise(resolve=>{const interval=setInterval(()=>{if(getters.isIdle()){clearInterval(interval);resolve();}},20)})}
return{absoluteToRelative,createPivotCache,convertFormulas,convertPivotFormulas,getCells,fetchCache,formatDate,fetchLabel,formatGroupBy,formatHeader,formats,getDataFromTemplate,relativeToAbsolute,sanitizePivot,waitForIdle};});;

/* /documents_spreadsheet/static/src/js/o-spreadsheet/pivot_cache.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.pivot_cache",function(require){"use strict";const spreadsheet=require("documents_spreadsheet.spreadsheet");const toString=spreadsheet.helpers.toString;class PivotCache{constructor(data){this._modelLabel=data.modelLabel;this._cols=data.cols;this._colStructure=data.colStructure;this._fields=data.fields;this._orderedMeasureIds=data.orderedMeasureIds;this._fieldValues={};for(let fieldName of Object.keys(this._orderedMeasureIds)){this._fieldValues[fieldName]=this._orderedMeasureIds[fieldName].map(([fieldValue])=>fieldValue);}
this._labels=data.labels;this._rows=data.rows;this._values=data.values;this._cacheKeys=[...data.values.keys()];this._usedValueDomains=new Set();this._usedHeaderDomains=new Set();}
getRows(){return this._rows;}
getRowCount(){return this._rows.length;}
getColLevelIdentifier(level){return this._colStructure[level];}
getFields(){return this._fields;}
getField(fieldName){return this._fields[fieldName];}
getFieldValues(fieldName){if(!(fieldName in this._fieldValues)){throw new Error(`Cannot find any pivot values for field "${fieldName}"`);}
return this._fieldValues[fieldName];}
getGroupLabel(groupBy,groupValue){return this._labels[groupBy][groupValue];}
isGroupLabelLoaded(groupBy,groupValue){return groupValue in this._labels[groupBy];}
isGroupedByDate(groupBys){if(groupBys.length!==1){return{isDate:false};}
const[fieldName,group]=groupBys[0].split(":");const field=this._fields[fieldName];return{isDate:["date","datetime"].includes(field.type),group,};}
getMeasureName(columnIndex){const columnValues=this._cols[columnIndex];return columnValues[columnValues.length-1].slice().pop();}
getColumnValues(columnIndex){const columnValues=this._cols[columnIndex];const values=columnValues[columnValues.length-1].slice();values.pop();return values;}
getColGroupHierarchy(topGroupIndex,subgroupIndex){return this._cols[topGroupIndex][subgroupIndex];}
getRowValues(rowIndex){return this._rows[rowIndex];}
getColGroupByLevels(){return this._cols[0].length-1;}
getTopHeaderCount(){return this._cols.length;}
getTopGroupIndex(groupValues){return this._cols.findIndex((topGroup)=>{const index=topGroup.findIndex((values)=>JSON.stringify(values)===JSON.stringify(groupValues));return index!==-1;});}
getRowIndex(groupValues){const stringifiedValues=JSON.stringify(groupValues);return this._rows.findIndex((values)=>JSON.stringify(values)===stringifiedValues);}
getSubgroupLevel(groupValues){return groupValues.length-1;}
isUsedValue(pivotArgs){return this._usedValueDomains.has(pivotArgs.join());}
isUsedHeader(pivotArgs){return this._usedHeaderDomains.has(pivotArgs.join());}
markAsValueUsed(domain,measure){const toTag=domain.slice();toTag.unshift(measure);this._usedValueDomains.add(toTag.join());}
markAsHeaderUsed(domain){this._usedHeaderDomains.add(domain.join());}
getMeasureValue(evalContext,measureName,operator,domain){const measureIds=this._computeMeasureIds(domain);return this._aggregateMeasure(evalContext,measureIds,measureName,operator);}
getModelLabel(){return this._modelLabel;}
withLabel(field,fieldValue,label){const labels=Object.assign({},this._labels);labels[field]=Object.assign({},labels[field],{[fieldValue]:label});return new PivotCache({cols:this._cols,colStructure:this._colStructure,fields:this._fields,orderedMeasureIds:this._orderedMeasureIds,labels:labels,modelLabel:this._modelLabel,rows:this._rows,values:this._values,});}
_computeMeasureIds(domain){let returnValue=this._cacheKeys;let i=0;while(i<domain.length&&returnValue.length){const field=toString(domain[i]);if(!(field in this._orderedMeasureIds)){return[];}
const value=toString(domain[i+1]);if(!this._fieldValues[field].includes(value)){return[];}
const[,measureIds]=field in this._orderedMeasureIds&&this._orderedMeasureIds[field].find(([fieldValue,])=>fieldValue===value);returnValue=measureIds.filter((x)=>returnValue.includes(x));i+=2;}
return returnValue;}
_aggregateMeasure(evalContext,measureIds,measureName,operator){if(measureIds.length===0){return"";}
if(measureIds.length===1){return this._values[measureIds[0]][measureName]||"";}
switch(operator){case"array_agg":throw Error(_.str.sprintf(_t("Not implemented: %s"),operator));case"count":return evalContext.COUNT(...measureIds.map((id)=>this._values[id][measureName]||0));case"count_distinct":return evalContext.COUNTUNIQUE(...measureIds.map((id)=>measureIds[id][measureName]||0));case"bool_and":return evalContext.AND(...measureIds.map((id)=>this._values[id][measureName]||0));case"bool_or":return evalContext.OR(...measureIds.map((id)=>this._values[id][measureName]||0));case"max":return evalContext.MAX(...measureIds.map((id)=>this._values[id][measureName]||0));case"min":return evalContext.MIN(...measureIds.map((id)=>this._values[id][measureName]||0));case"avg":return evalContext["AVERAGE.WEIGHTED"](...measureIds.map((id)=>[this._values[id][measureName]||0,this._values[id]["count"],]).flat());case"sum":return evalContext.SUM(...measureIds.map((id)=>this._values[id][measureName]||0));default:console.warn(_.str.sprintf(_t("Unknown operator: %s"),operator));return"";}}}
return PivotCache;});;

/* /documents_spreadsheet/static/src/js/o-spreadsheet/plugins/filters_plugin.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.FiltersPlugin",function(require){"use strict";const Domain=require("web.Domain");const spreadsheet=require("documents_spreadsheet.spreadsheet");const{constructDateDomain,yearSelected,getPeriodOptions}=require("web.searchUtils");const CancelledReason=require("documents_spreadsheet.CancelledReason");const pyUtils=require("web.py_utils");class FiltersPlugin extends spreadsheet.BasePlugin{constructor(workbook,getters,history,dispatch,config){super(...arguments);this.rpc=config.evalContext.env?config.evalContext.env.services.rpc:undefined;this.globalFilters=[];this.recordsDisplayName={};}
allowDispatch(cmd){switch(cmd.type){case"START":this._setUpFilters();break;case"EDIT_PIVOT_FILTER":if(!this.globalFilters.find((x)=>x.id===cmd.id)){return{status:"CANCELLED",reason:CancelledReason.FilterNotFound};}else if(this._isDuplicatedLabel(cmd.id,cmd.filter.label)){return{status:"CANCELLED",reason:CancelledReason.DuplicatedFilterLabel,};}
break;case"REMOVE_PIVOT_FILTER":if(!this.globalFilters.find((x)=>x.id===cmd.id)){return{status:"CANCELLED",reason:CancelledReason.FilterNotFound};}
break;case"ADD_PIVOT_FILTER":if(this._isDuplicatedLabel(cmd.id,cmd.filter.label)){return{status:"CANCELLED",reason:CancelledReason.DuplicatedFilterLabel,};}
break;}
return{status:"SUCCESS"};}
handle(cmd){switch(cmd.type){case"ADD_PIVOT_FILTER":this.recordsDisplayName[cmd.filter.id]=cmd.filter.defaultValueDisplayNames;this._addGlobalFilter(cmd.filter);break;case"EDIT_PIVOT_FILTER":this.recordsDisplayName[cmd.filter.id]=cmd.filter.defaultValueDisplayNames;this._editGlobalFilter(cmd.id,cmd.filter);break;case"SET_PIVOT_FILTER_VALUE":this.recordsDisplayName[cmd.id]=cmd.displayNames;this._setGlobalFilterValue(cmd.id,cmd.value);break;case"REMOVE_PIVOT_FILTER":this._removeGlobalFilter(cmd.id);break;}}
getGlobalFilter(id){return this.globalFilters.find((x)=>x.id===id);}
getGlobalFilters(){return this.globalFilters;}
getActiveFilterCount(){return this.globalFilters.filter((filter)=>{switch(filter.type){case"text":return filter.value;case"date":return filter.value&&(filter.value.year||filter.value.period);case"relation":return filter.value&&filter.value.length;}}).length;}
async getFilterDisplayValue(filterName){const filter=this.globalFilters.find((filter)=>filter.label===filterName);if(!filter){throw new Error(_.str.sprintf(_t(`Filter "%s" not found`),filterName));};switch(filter.type){case"text":return filter.value||"";case"date":return getPeriodOptions(moment()).filter(({id})=>filter.value&&[filter.value.year,filter.value.period].includes(id)).map((period)=>period.description).join(" ");case"relation":if(!filter.value||!this.rpc)return"";if(!this.recordsDisplayName[filter.id]){this.recordsDisplayName[filter.id]=this.rpc({model:filter.modelName,method:"name_get",args:[filter.value],}).then((result)=>result.map(([id,name])=>name));}
const names=await this.recordsDisplayName[filter.id];return names.join(", ");}}
_addGlobalFilter(filter){this.globalFilters.push({id:filter.id,label:filter.label,type:filter.type,rangeType:filter.rangeType,fields:filter.fields,value:filter.defaultValue,defaultValue:filter.defaultValue,modelID:filter.modelID,modelName:filter.modelName,});this._updatePivotsDomain();this.dispatch("EVALUATE_CELLS");}
_setGlobalFilterValue(id,value){const globalFilter=this.globalFilters.find((filter)=>filter.id===id);globalFilter.value=value;this._updatePivotsDomain();this.dispatch("EVALUATE_CELLS");}
_removeGlobalFilter(id){this.globalFilters=this.globalFilters.filter((filter)=>filter.id!==id);this._updatePivotsDomain();this.dispatch("EVALUATE_CELLS");}
_editGlobalFilter(id,newFilter){const currentLabel=this.getGlobalFilter(id).label;this.globalFilters=this.globalFilters.map((filter)=>filter.id!==id?filter:{id:filter.id,value:newFilter.defaultValue,label:newFilter.label,type:newFilter.type,rangeType:newFilter.rangeType,fields:newFilter.fields,defaultValue:newFilter.defaultValue,value:newFilter.defaultValue,modelID:newFilter.modelID,modelName:newFilter.modelName,});const newLabel=this.getGlobalFilter(id).label;if(currentLabel!==newLabel){this._updateFilterLabelInFormulas(currentLabel,newLabel);}
this._updatePivotsDomain();this.dispatch("EVALUATE_CELLS");}
import(data){if(data.globalFilters){this.globalFilters=data.globalFilters;for(let globalFilter of this.globalFilters){globalFilter.value=globalFilter.defaultValue;}}}
export(data){data.globalFilters=this.globalFilters.map((filter)=>Object.assign({},filter));for(let globalFilter of data.globalFilters){globalFilter.value=undefined;}}
_setUpFilters(){if(this.getters.getPivots().length){this._updatePivotsDomain({refresh:true});}}
_updateFilterLabelInFormulas(currentLabel,newLabel){const sheets=this.getters.getSheets();for(let sheet of sheets){for(let cell of Object.values(sheet.cells)){if(cell.type==="formula"){const newContent=cell.content.replace(new RegExp(`FILTER\\.VALUE\\(\\s*"${currentLabel}"\\s*\\)`,"g"),`FILTER.VALUE("${newLabel}")`);if(newContent!==cell.content){this.dispatch("UPDATE_CELL",{sheet:sheet.id,content:newContent,col:cell.col,row:cell.row,});}}}}}
_isDuplicatedLabel(filterId,label){return(this.globalFilters.findIndex((filter)=>(!filterId||filter.id!==filterId)&&filter.label===label)>-1);}
_updatePivotsDomain({refresh=true}={}){for(let pivot of this.getters.getPivots()){let domain="[]";for(let filter of this.globalFilters){if(!(pivot.id in filter.fields)){continue;}
if(filter.type==="date"){const values=filter.value&&Object.values(filter.value).filter(Boolean);if(!values||values.length===0){continue;}
if(!yearSelected(values)){values.push("this_year");}
const field=filter.fields[pivot.id].field;const type=filter.fields[pivot.id].type;const dateFilterRange=constructDateDomain(moment(),field,type,values);const dateDomain=Domain.prototype.arrayToString(pyUtils.eval("domain",dateFilterRange.domain,{}));domain=pyUtils.assembleDomains([domain,dateDomain],"AND");}
if(filter.type==="text"){const value=filter.value;if(!value){continue;}
const field=filter.fields[pivot.id].field;const textDomain=Domain.prototype.arrayToString([[field,"ilike",value],]);domain=pyUtils.assembleDomains([domain,textDomain],"AND");}
if(filter.type==="relation"){const values=filter.value;if(!values||values.length===0){continue;}
const field=filter.fields[pivot.id].field;const textDomain=Domain.prototype.arrayToString([[field,"in",values]]);domain=pyUtils.assembleDomains([domain,textDomain],"AND");}}
this.dispatch("ADD_PIVOT_DOMAIN",{id:pivot.id,domain,refresh});}}}
FiltersPlugin.modes=["normal","headless","readonly"];FiltersPlugin.getters=["getGlobalFilter","getGlobalFilters","getFilterDisplayValue","getActiveFilterCount",];return FiltersPlugin;});;

/* /documents_spreadsheet/static/src/js/o-spreadsheet/plugins/pivot_plugin.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.PivotPlugin",function(require){"use strict";const core=require("web.core");const pivotUtils=require("documents_spreadsheet.pivot_utils");const spreadsheet=require("documents_spreadsheet.spreadsheet");const Domain=require('web.Domain');const pyUtils=require('web.py_utils');const _t=core._t;const parse=spreadsheet.parse;const HEADER_STYLE={fillColor:"#f2f2f2"};const TOP_LEVEL_STYLE={bold:true,fillColor:"#f2f2f2"};const MEASURE_STYLE={fillColor:"#f2f2f2",textColor:"#756f6f"};class PivotPlugin extends spreadsheet.BasePlugin{constructor(workbook,getters,history,dispatch,config){super(workbook,getters,history,dispatch,config);this.pivots={};this.rpc=config.evalContext.env?config.evalContext.env.services.rpc:undefined;this.selectedPivot=undefined;}
handle(cmd){switch(cmd.type){case"ADD_PIVOT":this._addPivot(cmd.pivot,cmd.anchor);break;case"REBUILD_PIVOT":this._rebuildPivot(cmd.id,cmd.anchor);break;case"SELECT_PIVOT":this._selectPivot(cmd.cell);break;case"INSERT_HEADER":this._insertHeader(cmd.id,cmd.col,cmd.row,cmd.field,cmd.value);break;case"ADD_PIVOT_DOMAIN":this._addDomain(cmd.id,cmd.domain,cmd.refresh);break;case"REFRESH_PIVOT":this._refreshPivot(cmd.id);break;}}
getNextValue(formula,isColumn,increment){const{functionName,args}=this._parseFormula(formula);const pivot=this.getPivot(args[0]);if(!pivot){return"";}
let builder;if(functionName==="PIVOT"){builder=this._autofillPivotValue.bind(this);}else if(functionName==="PIVOT.HEADER"){if(pivot.rowGroupBys.includes(args[1])){builder=this._autofillPivotRowHeader.bind(this);}else{builder=this._autofillPivotColHeader.bind(this);}}
if(builder){return builder(pivot,args,isColumn,increment);}
return formula;}
getPivot(pivotId){return this.pivots[pivotId];}
getPivots(){return Object.values(this.pivots);}
getSelectedPivot(){return this.selectedPivot;}
getTooltipFormula(formula,isColumn){if(!formula){return[];}
const{functionName,args}=this._parseFormula(formula);const pivot=this.getPivot(args[0]);if(!pivot){return[];}
if(functionName==="PIVOT"){return this._tooltipFormatPivot(pivot,args,isColumn);}else if(functionName==="PIVOT.HEADER"){return this._tooltipFormatPivotHeader(pivot,args);}
return[];}
_addPivot(pivot,anchor){const pivots=this.getPivots();const id=pivots.length?Math.max(...pivots.map((p)=>p.id))+1:1;this.pivots[id]=Object.assign(pivot,{id});this._buildPivot(pivot,anchor);this._autoresize(pivot,anchor);}
_rebuildPivot(id,anchor){const pivot=this.pivots[id];this._buildPivot(pivot,anchor);}
_selectPivot(cell){if(cell&&cell.type==="formula"&&cell.content.startsWith("=PIVOT")){const{args}=this._parseFormula(cell.content);const id=args[0];this.selectedPivot=this.pivots[id];}}
_insertHeader(id,col,row,field,value){const sheet=this.getters.getActiveSheet();const content=this._buildHeaderFormula([id,field,value]);this.dispatch("UPDATE_CELL",{sheet,col,row,content});}
_refreshPivot(id){this._refreshPivotCache(id,{dataOnly:true});this.dispatch("EVALUATE_CELLS");}
_refreshPivotCache(id,{dataOnly=false}={}){const pivot=this.pivots[id];pivot.lastUpdate=undefined;pivot.isLoaded=false;if(!this.rpc){console.warn("Pivot plugin: RPC not defined");}
pivotUtils.fetchCache(pivot,this.rpc,{dataOnly}).then(()=>{pivot.isLoaded=true;});}
_addDomain(id,domain,refresh=true){const pivot=this.getters.getPivot(id);domain=pyUtils.assembleDomains([Domain.prototype.arrayToString(pivot.domain),Domain.prototype.arrayToString(domain),],"AND");pivot.computedDomain=pyUtils.eval("domain",domain,{});if(refresh){this._refreshPivotCache(id,{dataOnly:true});}}
import(data){if(data.pivots){this.pivots=data.pivots;for(let pivot of Object.values(this.pivots)){this._refreshPivotCache(pivot.id);}}}
export(data){data.pivots=JSON.parse(JSON.stringify(this.pivots));for(const id in data.pivots){data.pivots[id].computedDomain=undefined;data.pivots[id].cache=undefined;data.pivots[id].lastUpdate=undefined;data.pivots[id].isLoaded=false;}}
_autofillPivotValue(pivot,args,isColumn,increment){const currentElement=this._getCurrentValueElement(pivot,args);const date=pivot.cache.isGroupedByDate(isColumn?pivot.colGroupBys:pivot.rowGroupBys);let cols=[];let rows=[];let measure;if(isColumn){rows=currentElement.rows;if(date.isDate){cols=currentElement.cols;cols[0]=this._incrementDate(cols[0],date.group,increment);measure=cols.pop();}else{const currentColIndex=pivot.cache.getTopGroupIndex(currentElement.cols);if(currentColIndex===-1){return"";}
const nextColIndex=currentColIndex+increment;if(nextColIndex===-1){return this._autofillRowFromValue(pivot,currentElement);}
if(nextColIndex<-1||nextColIndex>=pivot.cache.getTopHeaderCount()){return"";}
cols=pivot.cache.getColumnValues(nextColIndex);measure=pivot.cache.getMeasureName(nextColIndex);}}else{cols=currentElement.cols;if(date.isDate){rows=currentElement.rows;rows[0]=this._incrementDate(rows[0],date.group,increment);}else{const currentRowIndex=pivot.cache.getRowIndex(currentElement.rows);if(currentRowIndex===-1){return"";}
const nextRowIndex=currentRowIndex+increment;if(nextRowIndex<0){return this._autofillColFromValue(pivot,nextRowIndex,currentElement);}
if(nextRowIndex>=pivot.cache.getRowCount()){return"";}
rows=pivot.cache.getRowValues(nextRowIndex);}
measure=cols.pop();}
return this._buildValueFormula(this._buildArgs(pivot,measure,rows,cols));}
_autofillPivotColHeader(pivot,args,isColumn,increment){const currentElement=this._getCurrentHeaderElement(pivot,args);const currentIndex=pivot.cache.getTopGroupIndex(currentElement.cols);const date=pivot.cache.isGroupedByDate(pivot.colGroupBys);if(isColumn){let groupValues;if(date.isDate){groupValues=currentElement.cols;groupValues[0]=this._incrementDate(groupValues[0],date.group,increment);}else{const colIndex=pivot.cache.getSubgroupLevel(currentElement.cols)
const nextIndex=currentIndex+increment;if(currentIndex===-1||nextIndex<0||nextIndex>=pivot.cache.getTopHeaderCount()){return"";}
groupValues=pivot.cache.getColGroupHierarchy(nextIndex,colIndex);}
return this._buildHeaderFormula(this._buildArgs(pivot,undefined,[],groupValues));}else{const colIndex=pivot.cache.getSubgroupLevel(currentElement.cols)
const nextIndex=colIndex+increment;const groupLevels=pivot.cache.getColGroupByLevels();if(nextIndex<0||nextIndex>=groupLevels+1+pivot.cache.getRowCount()){return"";}
if(nextIndex>=groupLevels+1){const rowIndex=nextIndex-groupLevels-1;const measure=pivot.cache.getMeasureName(currentIndex);const cols=pivot.cache.getColumnValues(currentIndex);const rows=pivot.cache.getRowValues(rowIndex);return this._buildValueFormula(this._buildArgs(pivot,measure,rows,cols));}else{const cols=pivot.cache.getColGroupHierarchy(currentIndex,nextIndex);return this._buildHeaderFormula(this._buildArgs(pivot,undefined,[],cols));}}}
_autofillPivotRowHeader(pivot,args,isColumn,increment){const currentElement=this._getCurrentHeaderElement(pivot,args);const currentIndex=pivot.cache.getRowIndex(currentElement.rows);const date=pivot.cache.isGroupedByDate(pivot.rowGroupBys);if(isColumn){if(increment<0||increment>pivot.cache.getTopHeaderCount()){return"";}
const values=pivot.cache.getColumnValues(increment-1);const measure=pivot.cache.getMeasureName(increment-1);return this._buildValueFormula(this._buildArgs(pivot,measure,currentElement.rows,values));}else{let rows;if(date.isDate){rows=currentElement.rows;rows[0]=this._incrementDate(rows[0],date.group,increment);}else{const nextIndex=currentIndex+increment;if(currentIndex===-1||nextIndex<0||nextIndex>=pivot.cache.getRowCount()){return"";}
rows=pivot.cache.getRowValues(nextIndex);}
return this._buildHeaderFormula(this._buildArgs(pivot,undefined,rows,[]));}}
_autofillColFromValue(pivot,nextIndex,currentElement){const groupIndex=pivot.cache.getTopGroupIndex(currentElement.cols);if(groupIndex<0){return"";}
const levels=pivot.cache.getColGroupByLevels();const index=levels+1+nextIndex;if(index<0||index>=levels+1){return"";}
const cols=pivot.cache.getColGroupHierarchy(groupIndex,index);return this._buildHeaderFormula(this._buildArgs(pivot,undefined,[],cols));}
_autofillRowFromValue(pivot,currentElement){const rows=currentElement.rows;if(!rows){return"";}
return this._buildHeaderFormula(this._buildArgs(pivot,undefined,rows,[]));}
_getCurrentHeaderElement(pivot,args){const values=this._parseArgs(args.slice(1));const cols=this._getFieldValues([...pivot.colGroupBys,"measure"],values);const rows=this._getFieldValues(pivot.rowGroupBys,values);return{cols,rows};}
_getCurrentValueElement(pivot,args){const values=this._parseArgs(args.slice(2));const cols=this._getFieldValues(pivot.colGroupBys,values);cols.push(args[1]);const rows=this._getFieldValues(pivot.rowGroupBys,values);return{cols,rows};}
_getFieldValues(fields,values){return fields.filter((field)=>field in values).map((field)=>values[field]);}
_incrementDate(date,group,increment){const format=pivotUtils.formats[group].out;const interval=pivotUtils.formats[group].interval;const dateMoment=moment(date,format);return dateMoment.isValid()?dateMoment.add(increment,interval).format(format):date;}
_parseArgs(args){const values={};for(let i=0;i<args.length;i+=2){values[args[i]]=args[i+1];}
return values;}
_autoresize(pivot,anchor){const sheet=this.getters.getActiveSheet();const end=anchor[0]+pivot.cache.getTopHeaderCount();for(let col=anchor[0];col<=end;col++){const cells=this.getters.getColCells(col);const sizes=cells.map((cell)=>this.getters.getTextWidth(this._getHeaderText(cell)+6));const size=Math.max(96,...sizes);const cols=[col];if(size!==0){this.dispatch("RESIZE_COLUMNS",{sheet,cols,size});}}}
_buildPivot(pivot,anchor){this._resizeSheet(pivot,anchor);this._buildColHeaders(pivot,anchor);this._buildRowHeaders(pivot,anchor);this._buildValues(pivot,anchor);}
_buildColHeaders(pivot,anchor){const[colAnchor,rowAnchor]=anchor;const bold=[];const levels=pivot.cache.getColGroupByLevels();this._merge({top:rowAnchor,bottom:rowAnchor+levels,left:colAnchor,right:colAnchor,});let col=colAnchor+1;let length=pivot.cache.getTopHeaderCount()-pivot.measures.length;if(length===0){length=pivot.cache.getTopHeaderCount();}
for(let i=0;i<length;i++){let row=rowAnchor;for(let level=0;level<=levels;level++){const args=[pivot.id];const values=pivot.cache.getColGroupHierarchy(i,level);for(const index in values){args.push(pivot.cache.getColLevelIdentifier(index));args.push(values[index]);}
this._applyFormula(col,row,args,true);if(level<=levels-1){bold.push({top:row,bottom:row,left:col,right:col});}
row++;}
col++;}
let row=rowAnchor+levels-1;for(let i=length;i<pivot.cache.getTopHeaderCount();i++){const args=[pivot.id];this._applyFormula(col,row,args,true);bold.push({top:row,bottom:row,left:col,right:col});args.push("measure");args.push(pivot.cache.getColGroupHierarchy(i,1)[0]);this._applyFormula(col,row+1,args,true);col++;}
col=colAnchor+1;let value;let first;for(let index=0;index<pivot.cache.getColGroupByLevels();index++){let row=rowAnchor+index;for(let i=0;i<length;i++){const next=JSON.stringify(pivot.cache.getColGroupHierarchy(i,index));if(!value){value=next;first=col+i;}else if(value!==next){this._merge({top:row,bottom:row,left:first,right:col+i-1});value=next;first=col+i;}}
if(first&&first!==col+length-1){this._merge({top:row,bottom:row,left:first,right:col+length-1});}
first=undefined;value=undefined;}
for(let index=0;index<pivot.cache.getColGroupByLevels();index++){const row=rowAnchor+index;const colStart=pivot.cache.getTopHeaderCount()-pivot.measures.length+1;this._merge({top:row,bottom:row,left:colStart,right:colStart+pivot.measures.length-1});}
this._applyStyle(HEADER_STYLE,[{top:rowAnchor,bottom:rowAnchor+pivot.cache.getColGroupByLevels()-1,left:colAnchor,right:colAnchor+pivot.cache.getTopHeaderCount(),},]);for(let zone of bold){this._applyStyle(TOP_LEVEL_STYLE,[zone]);}
this._applyStyle(MEASURE_STYLE,[{top:rowAnchor+pivot.cache.getColGroupByLevels(),bottom:rowAnchor+pivot.cache.getColGroupByLevels(),left:colAnchor+1,right:colAnchor+pivot.cache.getTopHeaderCount(),},]);}
_buildRowHeaders(pivot,anchor){const col=anchor[0];const anchorRow=anchor[1]+pivot.cache.getColGroupByLevels()+1;const bold=[];const rowCount=pivot.cache.getRowCount();for(let index=0;index<rowCount;index++){const args=[pivot.id];const row=anchorRow+parseInt(index,10);const current=pivot.cache.getRowValues(index);for(let i in current){args.push(pivot.rowGroupBys[i]);args.push(current[i]);}
this._applyFormula(col,row,args,true);if(current.length<=1){bold.push({top:row,bottom:row,left:col,right:col});}}
this._applyStyle(HEADER_STYLE,[{top:anchorRow,bottom:anchorRow+rowCount-1,left:col,right:col,},]);for(let zone of bold){this._applyStyle(TOP_LEVEL_STYLE,[zone]);}}
_buildValues(pivot,anchor){const anchorCol=anchor[0]+1;const anchorRow=anchor[1]+pivot.cache.getColGroupByLevels()+1;let col=anchorCol;let row=anchorRow;const length=pivot.cache.getTopHeaderCount()-pivot.measures.length;for(let i=0;i<length;i++){const colElement=[...pivot.cache.getColumnValues(i),pivot.cache.getMeasureName(i),];row=anchorRow;for(let rowElement of pivot.cache.getRows()){const args=[];for(let index in rowElement){args.push(pivot.rowGroupBys[index]);args.push(rowElement[index]);}
for(let index in colElement){const field=pivot.cache.getColLevelIdentifier(index);if(field==="measure"){args.unshift(colElement[index]);}else{args.push(pivot.cache.getColLevelIdentifier(index));args.push(colElement[index]);}}
args.unshift(pivot.id);this._applyFormula(col,row,args,false);row++;}
col++;}
row=anchorRow;for(let i=length;i<pivot.cache.getTopHeaderCount();i++){const colElement=[...pivot.cache.getColumnValues(i),pivot.cache.getMeasureName(i),];row=anchorRow;for(let rowElement of pivot.cache.getRows()){const args=[];for(let index in rowElement){args.push(pivot.rowGroupBys[index]);args.push(rowElement[index]);}
args.unshift(colElement[0]);args.unshift(pivot.id);this._applyFormula(col,row,args,false);row++;}
col++;}
this._applyFormatter("#,##0.00",[{top:anchorRow,bottom:anchorRow+pivot.cache.getRowCount()-1,left:anchorCol,right:anchorCol+pivot.cache.getTopHeaderCount()-1,},]);}
_getHeaderText(cell){if(!cell.content||!cell.content.startsWith("=PIVOT.HEADER")){return"";}
const{args}=this._parseFormula(cell.content);const pivot=this.getPivot(args[0]);const len=args.length;if(len===1){return _t("Total");}
const field=args[len-2];const value=args[len-1];return pivotUtils.formatHeader(pivot,field,value);}
_resizeSheet(pivot,anchor){const colLimit=pivot.cache.getTopHeaderCount()+pivot.measures.length+1;const numberCols=this.getters.getNumberCols(this.getters.getActiveSheet());const deltaCol=numberCols-anchor[0];if(deltaCol<colLimit){this.dispatch("ADD_COLUMNS",{column:numberCols-1,sheet:this.getters.getActiveSheet(),quantity:colLimit-deltaCol,position:"after",});}
const rowLimit=pivot.cache.getRowCount()+pivot.cache.getColGroupByLevels()+2;const numberRows=this.getters.getNumberRows(this.getters.getActiveSheet());const deltaRow=numberRows-anchor[1];if(deltaRow<rowLimit){this.dispatch("ADD_ROWS",{row:numberRows-1,sheet:this.getters.getActiveSheet(),quantity:rowLimit-deltaRow,position:"after",});}}
_tooltipFormatPivot(pivot,args,isColumn){const tooltips=[];const values=this._parseArgs(args.slice(2));for(let[field,value]of Object.entries(values)){if((pivot.colGroupBys.includes(field)&&isColumn)||(pivot.rowGroupBys.includes(field)&&!isColumn)){tooltips.push({title:pivotUtils.formatGroupBy(pivot,field),value:pivotUtils.formatHeader(pivot,field,value)||_t("Undefined"),});}}
if(pivot.measures.length!==1){const measure=args[1];tooltips.push({title:_t("Measure"),value:pivotUtils.formatHeader(pivot,"measure",measure),});}
return tooltips;}
_tooltipFormatPivotHeader(pivot,args){const tooltips=[];const values=this._parseArgs(args.slice(1));for(let[field,value]of Object.entries(values)){tooltips.push({title:field==="measure"?_t("Measure"):pivotUtils.formatGroupBy(pivot,field),value:pivotUtils.formatHeader(pivot,field,value)||_t("Undefined"),});}
return tooltips;}
_applyFormula(col,row,args,isHeader){const sheet=this.getters.getActiveSheet();const content=isHeader?this._buildHeaderFormula(args):this._buildValueFormula(args);this.dispatch("UPDATE_CELL",{sheet,col,row,content});}
_applyFormatter(formatter,target){const sheet=this.getters.getActiveSheet();this.dispatch("SET_FORMATTER",{sheet,target,formatter});}
_applyStyle(style,target){const sheet=this.getters.getActiveSheet();this.dispatch("SET_FORMATTING",{sheet,target,style});}
_buildArgs(pivot,measure,rows,cols){const args=[pivot.id];if(measure){args.push(measure);}
for(let index in rows){args.push(pivot.rowGroupBys[index]);args.push(rows[index]);}
if(cols.length===1&&pivot.measures.map(x=>x.field).includes(cols[0])){args.push("measure");args.push(cols[0]);}else{for(let index in cols){args.push(pivot.cache.getColLevelIdentifier(index));args.push(cols[index]);}}
return args;}
_buildHeaderFormula(args){return`=PIVOT.HEADER("${args.join('","')}")`;}
_buildValueFormula(args){return`=PIVOT("${args.join('","')}")`;}
_merge(zone){const sheet=this.getters.getActiveSheet();this.dispatch("ADD_MERGE",{sheet,zone});}
_parseFormula(formula){const ast=parse(formula);const functionName=ast.value;const args=ast.args.map((arg)=>{switch(typeof arg.value){case"string":return arg.value.slice(1,-1);case"number":return arg.value.toString();}
return"";});return{functionName,args};}}
PivotPlugin.modes=["normal","headless","readonly"];PivotPlugin.getters=["getPivot","getPivots","getSelectedPivot","getNextValue","getTooltipFormula",];return PivotPlugin;});;

/* /documents_spreadsheet/static/src/js/o-spreadsheet/plugins/cancelled_reason.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.CancelledReason",function(require){"use strict";return{FilterNotFound:1000,DuplicatedFilterLabel:1001,};});;

/* /documents_spreadsheet/static/src/js/o-spreadsheet/functions/pivot_functions.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.pivot_functions",function(require){"use strict";const core=require("web.core");const pivotUtils=require("documents_spreadsheet.pivot_utils");const spreadsheet=require("documents_spreadsheet.spreadsheet_extended");const _t=core._t;const args=spreadsheet.helpers.args;const functionRegistry=spreadsheet.registries.functionRegistry;const toString=spreadsheet.helpers.toString;functionRegistry.add("FILTER_VALUE",{description:_t("Get the value from a filter."),compute:async function(filterName){return this.getters.getFilterDisplayValue(filterName)},async:true,args:args(`
                filter_name (string) ${_t("Name of the filter.")}
            `),returns:["STRING"],}).add("PIVOT",{description:_t("Get the value from a pivot."),compute:async function(pivotId,measureName,...domain){const pivot=_getPivot(this.getters,pivotId);const measure=toString(measureName);_sanitizeArgs(pivot,measure,domain);await pivotUtils.fetchCache(pivot,this.env.services.rpc);const operator=pivot.measures.filter((m)=>m.field===measure)[0].operator;pivot.cache.markAsValueUsed(domain,measure);return pivot.cache.getMeasureValue(this,measure,operator,domain);},async:true,args:args(`
            pivot_id (string) ${_t("ID of the pivot.")}
            measure_name (string) ${_t("Name of the measure.")}
            domains (string,optional,repeating) ${_t("Domains list.")}
        `),returns:["NUMBER","STRING"],}).add("PIVOT_HEADER",{description:_t("Get the header of a pivot."),compute:async function(pivotId,...domain){const pivot=_getPivot(this.getters,pivotId);await pivotUtils.fetchCache(pivot,this.env.services.rpc);pivot.cache.markAsHeaderUsed(domain);const len=domain.length;if(len===0){return _t("Total");}
const field=toString(domain[len-2]);const value=toString(domain[len-1]);if(field==="measure"){if(value==="__count"){return _t("Count");}
return pivot.cache.getField(value).string;}else{return await _getValue(pivot,this.env.services.rpc,field,value);}},async:true,args:args(`
            pivot_id (string) ${_t("ID of the pivot.")}
            domains (string,optional,repeating) ${_t("Domains list.")}
        `),returns:["NUMBER","STRING"],}).add("PIVOT.POSITION",{description:_t("Get the absolute ID of an element in the pivot"),compute:function(){throw new Error(_t(`[[FUNCTION_NAME]] cannot be called from the spreadsheet.`));},args:args(`
                pivot_id (string) ${_t("ID of the pivot.")}
                field_name (string) ${_t("Name of the field.")}
                position (number) ${_t("Position in the pivot")}
            `),returns:["STRING"],});function _getPivot(getters,pivotId){pivotId=toString(pivotId);const pivot=getters.getPivot(pivotId);if(!pivot){throw new Error(_.str.sprintf(_t('There is no pivot with id "%s"'),pivotId));}
return pivot;}
async function _getValue(pivot,rpc,field,value){const undef=_t("(Undefined)");if(!pivot.cache.isGroupLabelLoaded(field,value)&&pivot.cache.getField(field.split(":")[0]).relation&&value!=="false"){await pivotUtils.fetchLabel(pivot,rpc,field,value);}
if(["date","datetime"].includes(pivot.cache.getField(field.split(":")[0]).type)){return pivotUtils.formatDate(field,value);}
return pivot.cache.getGroupLabel(field,value)||undef;}
function _sanitizeArgs(pivot,measure,domain){if(domain.length%2!==0){throw new Error(_t("Function PIVOT takes an even number of arguments."));}
if(!pivot.measures.map((elt)=>elt.field).includes(measure)){const validMeasures=`(${pivot.measure.map((elt) => elt.field)})`;throw new Error(_.str.sprintf(_t("The argument %s is not a valid measure. Here are the measures: %s"),measure,validMeasures));}}});;

/* /documents_spreadsheet/static/src/js/spreadsheet_selector_dialog.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("documents_spreadsheet.SpreadsheetSelectorDialog",function(require){"use strict";const core=require("web.core");const Dialog=require("web.Dialog");const _t=core._t;const SpreadsheetSelectorDialog=Dialog.extend({template:"documents_spreadsheet.SpreadsheetSelectorDialog",init:function(parent,spreadsheets){this.spreadsheets=spreadsheets;const options={title:_t("Select a spreadsheet to insert your pivot"),buttons:[{text:_t("Confirm"),classes:"btn-primary",click:this._onConfirm.bind(this),close:true,},{text:_t("Cancel"),click:this._onCancel.bind(this),close:true,},],};this._super(parent,options);},_onConfirm:function(){const id=this.el.querySelector("select[name='spreadsheet']").value;let selectedSpreadsheet=false;if(id!==""){selectedSpreadsheet=this.spreadsheets.find((s)=>s.id===parseInt(id,10));}
this.trigger("confirm",selectedSpreadsheet);},_onCancel:function(){this.trigger("cancel");},});return SpreadsheetSelectorDialog;});;

/* /hr_expense/static/src/js/expense_views.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('hr_expense.expenses.tree',function(require){"use strict";var DocumentUploadMixin=require('hr_expense.documents.upload.mixin');var KanbanController=require('web.KanbanController');var KanbanView=require('web.KanbanView');var PivotView=require('web.PivotView');var ListController=require('web.ListController');var ListView=require('web.ListView');var viewRegistry=require('web.view_registry');var core=require('web.core');var ListRenderer=require('web.ListRenderer');var KanbanRenderer=require('web.KanbanRenderer');var PivotRenderer=require('web.PivotRenderer');var session=require('web.session');const config=require('web.config');var QWeb=core.qweb;var ExpensesListController=ListController.extend(DocumentUploadMixin,{buttons_template:'ExpensesListView.buttons',events:_.extend({},ListController.prototype.events,{'click .o_button_upload_expense':'_onUpload','change .o_expense_documents_upload .o_form_binary_form':'_onAddAttachment',}),});const ExpenseQRCodeMixin={async _renderView(){const self=this;await this._super(...arguments);const google_url="https://play.google.com/store/apps/details?id=com.odoo.mobile";const apple_url="https://apps.apple.com/be/app/odoo/id1272543640";const action_desktop={name:'Download our App',type:'ir.actions.client',tag:'expense_qr_code_modal',params:{'url':"https://apps.apple.com/be/app/odoo/id1272543640"},target:'new',};this.$el.find('img.o_expense_apple_store').on('click',function(event){event.preventDefault();if(!config.device.isMobile){self.do_action(_.extend(action_desktop,{params:{'url':apple_url}}));}else{self.do_action({type:'ir.actions.act_url',url:apple_url});}});this.$el.find('img.o_expense_google_store').on('click',function(event){event.preventDefault();if(!config.device.isMobile){self.do_action(_.extend(action_desktop,{params:{'url':google_url}}));}else{self.do_action({type:'ir.actions.act_url',url:google_url});}});},};const ExpenseDashboardMixin={_render:async function(){var self=this;await this._super(...arguments);const result=await this._rpc({model:'hr.expense',method:'get_expense_dashboard',context:this.context,});self.$el.parent().find('.o_expense_container').remove();const elem=QWeb.render('hr_expense.dashboard_list_header',{expenses:result,render_monetary_field:self.render_monetary_field,});self.$el.before(elem);},render_monetary_field:function(value,currency_id){value=value.toFixed(2);var currency=session.get_currency(currency_id);if(currency){if(currency.position==="after"){value+=currency.symbol;}else{value=currency.symbol+value;}}
return value;}};var ExpenseListRenderer=ListRenderer.extend(ExpenseQRCodeMixin);var ExpenseListRendererHeader=ExpenseListRenderer.extend(ExpenseDashboardMixin);var ExpensesListViewDashboardUpload=ListView.extend({config:_.extend({},ListView.prototype.config,{Renderer:ExpenseListRenderer,Controller:ExpensesListController,}),});var ExpensesListViewDashboardUploadHeader=ExpensesListViewDashboardUpload.extend({config:_.extend({},ExpensesListViewDashboardUpload.prototype.config,{Renderer:ExpenseListRendererHeader,}),});var ExpensesListViewDashboard=ListView.extend({config:_.extend({},ListView.prototype.config,{Renderer:ExpenseListRenderer,Controller:ExpensesListController,}),});var ExpensesListViewDashboardHeader=ExpensesListViewDashboard.extend({config:_.extend({},ExpensesListViewDashboard.prototype.config,{Renderer:ExpenseListRendererHeader,})});var ExpensesKanbanController=KanbanController.extend(DocumentUploadMixin,{buttons_template:'ExpensesKanbanView.buttons',events:_.extend({},KanbanController.prototype.events,{'click .o_button_upload_expense':'_onUpload','change .o_expense_documents_upload .o_form_binary_form':'_onAddAttachment',}),});var ExpenseKanbanRenderer=KanbanRenderer.extend(ExpenseQRCodeMixin);var ExpenseKanbanRendererHeader=ExpenseKanbanRenderer.extend(ExpenseDashboardMixin);var ExpensesKanbanView=KanbanView.extend({config:_.extend({},KanbanView.prototype.config,{Controller:ExpensesKanbanController,Renderer:ExpenseKanbanRenderer,}),});var ExpensesKanbanViewHeader=ExpensesKanbanView.extend({config:_.extend({},ExpensesKanbanView.prototype.config,{Renderer:ExpenseKanbanRendererHeader,})});viewRegistry.add('hr_expense_tree_dashboard_upload',ExpensesListViewDashboardUpload);viewRegistry.add('hr_expense_tree_dashboard_upload_header',ExpensesListViewDashboardUploadHeader);viewRegistry.add('hr_expense_tree_dashboard',ExpensesListViewDashboard);viewRegistry.add('hr_expense_tree_dashboard_header',ExpensesListViewDashboardHeader);viewRegistry.add('hr_expense_kanban',ExpensesKanbanView);viewRegistry.add('hr_expense_kanban_header',ExpensesKanbanViewHeader);});;

/* /hr_expense/static/src/js/expense_qr_code_action.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('hr_expense.qr_code_action',function(require){"use strict";const AbstractAction=require('web.AbstractAction');const core=require('web.core');const config=require('web.config');const QRModalAction=AbstractAction.extend({template:'hr_expense_qr_code',xmlDependencies:['/hr_expense/static/src/xml/expense_qr_modal_template.xml'],init:function(parent,action){this._super.apply(this,arguments);this.url=_.str.sprintf("/report/barcode/?type=QR&value=%s&width=256&height=256&humanreadable=1",action.params.url);},});core.action_registry.add('expense_qr_code_modal',QRModalAction);});;

/* /hr_expense/static/src/js/upload_mixin.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('hr_expense.documents.upload.mixin',function(require){"use strict";var core=require('web.core');var config=require('web.config');var _t=core._t;var qweb=core.qweb;var DocumentUploadMixin={start:function(){this.fileUploadID=_.uniqueId('hr_expense_document_upload');$(window).on(this.fileUploadID,this._onFileUploaded.bind(this));return this._super.apply(this,arguments);},_onAddAttachment:function(ev){var $input=$(ev.currentTarget).find('input.o_input_file');if($input.val()!==''){var $binaryForm=this.$('.o_expense_documents_upload form.o_form_binary_form');$binaryForm.submit();}},_onFileUploaded:function(){var self=this;var attachments=Array.prototype.slice.call(arguments,1);var attachent_ids=attachments.reduce(function(filtered,record){if(record.id){filtered.push(record.id);}
return filtered;},[]);if(!attachent_ids.length){return self.do_notify(false,_t("An error occurred during the upload"));}
var myContext=this.initialState.context
myContext['isMobile']=config.device.isMobile
return this._rpc({model:'hr.expense',method:'create_expense_from_attachments',args:["",attachent_ids,this.viewType],context:myContext,}).then(function(result){self.do_action(result);});},_onUpload:function(event){var self=this;var $formContainer=this.$('.o_content').find('.o_expense_documents_upload');if(!$formContainer.length){$formContainer=$(qweb.render('hr.expense.DocumentsHiddenUploadForm',{widget:this}));$formContainer.appendTo(this.$('.o_content'));}
this.$('.o_expense_documents_upload .o_input_file').click();},};return DocumentUploadMixin;});;

/* /hr_timesheet/static/src/js/task_with_hours.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('hr_timesheet.task_with_hours',function(require){"use strict";var field_registry=require('web.field_registry');var relational_fields=require('web.relational_fields');var FieldMany2One=relational_fields.FieldMany2One;var TaskWithHours=FieldMany2One.extend({init:function(){this._super.apply(this,arguments);this.additionalContext.hr_timesheet_display_remaining_hours=true;},_getDisplayNameWithoutHours:function(value){return value.split('  ')[0];},_renderEdit:function(){this.m2o_value=this._getDisplayNameWithoutHours(this.m2o_value);this._super.apply(this,arguments);},});field_registry.add('task_with_hours',TaskWithHours);return TaskWithHours;});;

/* /hr_timesheet/static/src/js/timesheet_uom.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('hr_timesheet.timesheet_uom',function(require){'use strict';const basicFields=require('web.basic_fields');const fieldUtils=require('web.field_utils');const fieldRegistry=require('web.field_registry');require('web._field_registry');const session=require('web.session');const FieldTimesheetFactor=basicFields.FieldFloatFactor.extend({formatType:'float_factor',init:function(parent,name,record,options){this._super(parent,name,record,options);if(session.timesheet_uom_factor){this.nodeOptions.factor=session.timesheet_uom_factor;this.parseOptions.factor=session.timesheet_uom_factor;}},});const FieldTimesheetToggle=basicFields.FieldFloatToggle.extend({formatType:'float_factor',init:function(parent,name,record,options){options=options||{};var fieldsInfo=record.fieldsInfo[options.viewType||'default'];var attrs=options.attrs||(fieldsInfo&&fieldsInfo[name])||{};var hasRange=_.contains(_.keys(attrs.options||{}),'range');this._super(parent,name,record,options);if(!hasRange){this.nodeOptions.range=[0.00,1.00,0.50];}
this.nodeOptions.factor=session.timesheet_uom_factor;},});const FieldTimesheetTime=basicFields.FieldFloatTime.extend({init:function(){this._super.apply(this,arguments);if(session.timesheet_uom_factor){this.nodeOptions.factor=session.timesheet_uom_factor;this.parseOptions.factor=session.timesheet_uom_factor;}}});const widgetName='timesheet_uom'in session?session.timesheet_uom.timesheet_widget:'float_factor';let FieldTimesheetUom=null;if(widgetName==='float_toggle'){FieldTimesheetUom=FieldTimesheetToggle;}else if(widgetName==='float_time'){FieldTimesheetUom=FieldTimesheetTime;}else{FieldTimesheetUom=(fieldRegistry.get(widgetName)&&fieldRegistry.get(widgetName).extend({}))||FieldTimesheetFactor;}
fieldRegistry.add('timesheet_uom',FieldTimesheetUom);let FieldTimesheetUomWithoutToggle=null;if(widgetName==='float_toggle'){FieldTimesheetUomWithoutToggle=FieldTimesheetFactor;}else{FieldTimesheetUomWithoutToggle=FieldTimesheetTime;}
fieldRegistry.add('timesheet_uom_no_toggle',FieldTimesheetUomWithoutToggle);const _tweak_options=function(options){if(!_.contains(options,'factor')){options.factor=session.timesheet_uom_factor;}
return options;};fieldUtils.format.timesheet_uom=function(value,field,options){options=_tweak_options(options||{});const formatter=fieldUtils.format[FieldTimesheetUom.prototype.formatType];return formatter(value,field,options);};fieldUtils.parse.timesheet_uom=function(value,field,options){options=_tweak_options(options||{});const parser=fieldUtils.parse[FieldTimesheetUom.prototype.formatType];return parser(value,field,options);};fieldUtils.format.timesheet_uom_no_toggle=function(value,field,options){options=_tweak_options(options||{});const formatter=fieldUtils.format[FieldTimesheetUom.prototype.formatType];return formatter(value,field,options);};fieldUtils.parse.timesheet_uom_no_toggle=function(value,field,options){options=_tweak_options(options||{});const parser=fieldUtils.parse[FieldTimesheetUom.prototype.formatType];return parser(value,field,options);};return{FieldTimesheetUom,FieldTimesheetFactor,FieldTimesheetTime,FieldTimesheetToggle};});;

/* /hr_timesheet/static/src/js/timesheet_factor.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('hr_timesheet.timesheet_factor',function(require){'use strict';const timesheetUomFields=require('hr_timesheet.timesheet_uom');const fieldUtils=require('web.field_utils');const fieldRegistry=require('web.field_registry');fieldRegistry.add('timesheet_factor',timesheetUomFields.FieldTimesheetFactor);fieldUtils.format.timesheet_factor=function(value,field,options){const formatter=fieldUtils.format[timesheetUomFields.FieldTimesheetFactor.prototype.formatType];return formatter(value,field,options);};fieldUtils.parse.timesheet_factor=function(value,field,options){const parser=fieldUtils.parse[timesheetUomFields.FieldTimesheetFactor.prototype.formatType];return parser(value,field,options);};});;

/* /hr_timesheet/static/src/js/timesheet_config_form_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('hr_timesheet.res.config.form',function(require){"use strict";const core=require('web.core');const config=require('web.config');const viewRegistry=require('web.view_registry');const BaseSetting=require('base.settings');const _t=core._t;const TimesheetConfigQRCodeMixin={async _renderView(){const self=this;await this._super(...arguments);const google_url="https://play.google.com/store/apps/details?id=com.odoo.OdooTimesheets";const apple_url="https://apps.apple.com/be/app/awesome-timesheet/id1078657549";const action_desktop={name:_t('Download our App'),type:'ir.actions.client',tag:'timesheet_qr_code_modal',target:'new',};this.$el.find('img.o_config_app_store').on('click',function(event){event.preventDefault();if(!config.device.isMobile){self.do_action(_.extend(action_desktop,{params:{'url':apple_url}}));}else{self.do_action({type:'ir.actions.act_url',url:apple_url});}});this.$el.find('img.o_config_play_store').on('click',function(event){event.preventDefault();if(!config.device.isMobile){self.do_action(_.extend(action_desktop,{params:{'url':google_url}}));}else{self.do_action({type:'ir.actions.act_url',url:google_url});}});},};var TimesheetConfigFormRenderer=BaseSetting.Renderer.extend(TimesheetConfigQRCodeMixin);const BaseSettingView=viewRegistry.get('base_settings');var TimesheetConfigFormView=BaseSettingView.extend({config:_.extend({},BaseSettingView.prototype.config,{Renderer:TimesheetConfigFormRenderer,}),});viewRegistry.add('hr_timesheet_config_form',TimesheetConfigFormView);return{TimesheetConfigQRCodeMixin,TimesheetConfigFormRenderer,TimesheetConfigFormView};});;

/* /hr_timesheet/static/src/js/qr_code_action.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('hr_timesheet.qr_code_action',function(require){"use strict";const AbstractAction=require('web.AbstractAction');const core=require('web.core');const config=require('web.config');const QRModalAction=AbstractAction.extend({template:'hr_timesheet_qr_code',xmlDependencies:['/hr_timesheet/static/src/xml/qr_modal_template.xml'],init:function(parent,action){this._super.apply(this,arguments);this.url=_.str.sprintf("/report/barcode/?type=QR&value=%s&width=256&height=256&humanreadable=1",action.params.url);},});core.action_registry.add('timesheet_qr_code_modal',QRModalAction);});;

/* /marketing_automation/static/src/js/marketing_automation_graph.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('marketing_automation.activity_graph',function(require){'use strict';var AbstractField=require('web.AbstractField');var registry=require('web.field_registry');var ActivityGraph=AbstractField.extend({className:'o_ma_activity_graph',jsLibs:['/web/static/lib/Chart/Chart.js',],init:function(){this._super.apply(this,arguments);this._isInDOM=false;this.chart=null;this.chartId=_.uniqueId('chart');this.data=JSON.parse(this.value);},start:function(){var $canvasContainer=$('<div/>',{class:'o_graph_canvas_container'});this.$canvas=$('<canvas/>').attr('id',this.chartId);$canvasContainer.append(this.$canvas);this.$el.append($canvasContainer);return this._super.apply(this,arguments);},on_attach_callback:function(){this._isInDOM=true;this._render();},_render:function(){if(!this._isInDOM){return;}
if(!this.data||!_.isArray(this.data)){return;}
function hexToRGBA(hex,opacity){var result=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);var rgb=result.slice(1,4).map(function(n){return parseInt(n,16);}).join(',');return'rgba('+rgb+','+opacity+')';}
var labels=this.data[0].points.map(function(point){return point.x;});var datasets=this.data.map(function(group){var borderColor=hexToRGBA(group.color,1);var fillColor=hexToRGBA(group.color,0.6);return{label:group.label,data:group.points,fill:'origin',backgroundColor:fillColor,borderColor:borderColor,borderWidth:2,pointBackgroundColor:'rgba(0, 0, 0, 0)',pointBorderColor:borderColor,};});Chart.defaults.global.elements.line.tension=0;var ctx=document.getElementById(this.chartId);this.chart=new Chart(ctx,{type:'line',data:{labels:labels,datasets:datasets,},options:{layout:{padding:{left:25,right:20,top:5,bottom:20}},legend:{display:false,},maintainAspectRatio:false,scales:{yAxes:[{type:'linear',display:false,ticks:{beginAtZero:true,},}],xAxes:[{ticks:{maxRotation:0,},}],},tooltips:{mode:'index',intersect:false,bodyFontColor:'rgba(0,0,0,1)',titleFontSize:13,titleFontColor:'rgba(0,0,0,1)',backgroundColor:'rgba(255,255,255,0.6)',borderColor:'rgba(0,0,0,0.2)',borderWidth:2,callbacks:{labelColor:function(tooltipItem,chart){var dataset=chart.data.datasets[tooltipItem.datasetIndex];var tooltipBorderColor=chart.tooltip._model.backgroundColor;return{borderColor:tooltipBorderColor,backgroundColor:dataset.backgroundColor,};},}}}});},});registry.add('marketing_activity_graph',ActivityGraph);return ActivityGraph;});;

/* /marketing_automation/static/src/js/marketing_automation_one2many.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('marketing_automation.hierarchy_kanban',function(require){"use strict";var core=require('web.core');var Domain=require('web.Domain');var DomainSelector=require('web.DomainSelector');var Dialog=require('web.Dialog');var FieldOne2Many=require('web.relational_fields').FieldOne2Many;var KanbanRenderer=require('web.KanbanRenderer');var KanbanRecord=require('web.KanbanRecord');var registry=require('web.field_registry');var _t=core._t;var HierarchyKanban=FieldOne2Many.extend({custom_events:_.extend({},FieldOne2Many.prototype.custom_events,{'add_child_act':'_onAddChild',}),on_attach_callback:function(){this.renderer.on_attach_callback();},_render:function(){var self=this;this._setHierarchyData();var _super=this._super.bind(this);var rendererProm;if(!this.renderer){this.renderer=new HierarchyKanbanRenderer(this,this.value,{arch:this.view.arch,viewType:'kanban',record_options:{editable:false,deletable:false,read_only_mode:this.isReadonly,},});rendererProm=this.renderer.appendTo(this.$el);}
return Promise.resolve(rendererProm).then(function(){if(self.control_panel){self.control_panel.$el.appendTo(self.$el);}
return _super();});},_setHierarchyData:function(){var data=this.value.data;this.allData=data;var parentMap={};this.value.data=_.filter(data,function(record){parentMap[record.res_id]=record;record.children=[];return record.data.parent_id===false;});_.each(data,function(record){if(record.data.parent_id&&parentMap[record.data.parent_id.res_id]){parentMap[record.data.parent_id.res_id].children.push(record);}});},_setValue:function(value,options){if(value.operation==='ADD'&&_.some(this.allData,{id:value.id})){value.operation='UPDATE';}else if(value.operation==='DELETE'){var removedRecords=this.allData.filter(function(record){return value.ids.includes(record.id);});value.ids=this._getAllSubChildren(removedRecords).map(function(record){return record.id;});}
return this._super(value,options);},_getAllSubChildren:function(parentRecords){var childrenRecords=[];parentRecords.forEach(function(record){childrenRecords=childrenRecords.concat(record.children||[]);});return childrenRecords.length?parentRecords.concat(this._getAllSubChildren(childrenRecords)):parentRecords;},_onAddChild:function(params){var self=this;var context=_.extend(this.record.getContext(this.recordParams),params.data);this.trigger_up('open_one2many_record',{domain:this.record.getDomain(this.recordParams),context:context,field:this.field,fields_view:this.attrs.views&&this.attrs.views.form,parentID:this.value.id,viewInfo:this.view,on_saved:function(record){self._setValue({operation:'ADD',id:record.id});},});},});var HierarchyKanbanRenderer=KanbanRenderer.extend({_renderUngrouped:function(fragment,records){this.defs.push(this._renderUngroupedAux(fragment,records));},_renderUngroupedAux:function(fragment,records){var self=this;var recordsDefs=[];_.each(records||this.state.data,function(record){var kanbanRecord=new HierarchyKanbanRecord(self,record,self.recordOptions);self.widgets.push(kanbanRecord);var def=kanbanRecord.appendTo(fragment).then(function(){if(record.children.length){var newFragment=kanbanRecord.$('.o_hierarchy_children');return self._renderUngroupedAux(newFragment,record.children);}});recordsDefs.push(def);});return Promise.all(recordsDefs);},});var HierarchyKanbanRecord=KanbanRecord.extend({events:_.extend({},KanbanRecord.prototype.events,{'click .o_ma_switch span':'_onClickSwitch','click .o_add_child_activity':'_onAddChildActivity',}),_renderDomainSelector:function(){if(!this.domainSelector){var domainModel=this.state.data.model_name;var domain=Domain.prototype.stringToArray(this.state.data.domain);this.domainSelector=new DomainSelector(this,domainModel,domain,{readonly:true,filters:{},});return this.domainSelector.prependTo(this.$('.o_ma_card:first > .o_pane_filter'));}
return Promise.resolve();},_onKanbanActionClicked:function(event){event.stopPropagation();event.preventDefault();var type=$(event.currentTarget).data('type')||'button';if(type==='delete'&&this.state.children.length){new Dialog(this,{title:_t('Delete Activity'),buttons:[{text:_t('Delete All'),classes:'btn-primary',close:true,click:this._super.bind(this,event)},{text:_t('Discard'),close:true}],$content:$('<div>',{html:_t("This Activity has a dependant child activity. 'DELETE ALL' will delete all child activities."),}),}).open();}else{this._super.apply(this,arguments);}},_onAddChildActivity:function(event){event.stopPropagation();event.preventDefault();var triggerType=$(event.currentTarget).data('triggerType');if(this.id){this.trigger_up('add_child_act',{'default_parent_id':this.id,'default_trigger_type':triggerType});}else{this.displayNotification({type:'warning',message:_t('Please save the campaign to add a child activity'),});}},_onClickSwitch:function(event){event.stopPropagation();var self=this;$(event.currentTarget).siblings().removeClass('active');$(event.currentTarget).addClass('active');var mode=$(event.currentTarget).data('mode');this._renderDomainSelector().then(function(){self.$('.o_ma_card:first > [class*="o_pane_"]').addClass('d-none');self.$('.o_ma_card:first > .o_pane_'+mode).removeClass('d-none');});}});registry.add('hierarchy_kanban',HierarchyKanban);return{HierarchyKanbanRecord:HierarchyKanbanRecord,HierarchyKanbanRenderer:HierarchyKanbanRenderer,HierarchyKanban:HierarchyKanban,};});;

/* /mrp/static/src/js/mrp.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mrp.mrp_state',function(require){"use strict";var AbstractField=require('web.AbstractField');var core=require('web.core');var fields=require('web.basic_fields');var fieldUtils=require('web.field_utils');var field_registry=require('web.field_registry');var time=require('web.time');var _t=core._t;var SetBulletStatus=AbstractField.extend({init:function(){this._super.apply(this,arguments);this.classes=this.nodeOptions&&this.nodeOptions.classes||{};},_renderReadonly:function(){this._super.apply(this,arguments);var bullet_class=this.classes[this.value]||'default';if(this.value){var title=this.value==='waiting'?_t('Waiting Materials'):'';this.$el.attr({'title':title,'style':'display:inline'});this.$el.removeClass('text-success text-danger text-default');this.$el.html($('<span>'+title+'</span>').addClass('badge badge-'+bullet_class));}}});var TimeCounter=fields.FieldFloatTime.extend({init:function(){this._super.apply(this,arguments);this.duration=this.record.data.duration;},willStart:function(){var self=this;var def=this._rpc({model:'mrp.workcenter.productivity',method:'search_read',domain:[['workorder_id','=',this.record.data.id],['date_end','=',false],],}).then(function(result){var currentDate=new Date();var duration=0;if(result.length>0){duration+=self._getDateDifference(time.auto_str_to_date(result[0].date_start),currentDate);}
var minutes=duration/60>>0;var seconds=duration%60;self.duration+=minutes+seconds/60;if(self.mode==='edit'){self.value=self.duration;}});return Promise.all([this._super.apply(this,arguments),def]);},destroy:function(){this._super.apply(this,arguments);clearTimeout(this.timer);},isSet:function(){return true;},_getDateDifference:function(dateStart,dateEnd){return moment(dateEnd).diff(moment(dateStart),'seconds');},_renderReadonly:function(){if(this.record.data.is_user_working){this._startTimeCounter();}else{this._super.apply(this,arguments);}},_startTimeCounter:function(){var self=this;clearTimeout(this.timer);if(this.record.data.is_user_working){this.timer=setTimeout(function(){self.duration+=1/60;self._startTimeCounter();},1000);}else{clearTimeout(this.timer);}
this.$el.text(fieldUtils.format.float_time(this.duration));},});var FieldEmbedURLViewer=fields.FieldChar.extend({init:function(){this._super.apply(this,arguments);this.page=1;this.srcDirty=false;},reset:function(){this._super.apply(this,arguments);this._updateIframePreview();},_prepareIframe:function(){return $('<iframe>',{class:'o_embed_iframe d-none',allowfullscreen:true,});},_renderEdit:function(){if(!this.$('iframe.o_embed_iframe').length){this.$input=this.$el;this.setElement(this.$el.wrap('<div class="o_embed_url_viewer o_field_widget"/>').parent());this.$el.append(this._prepareIframe());}
this._prepareInput(this.$input);if(!this.record.evalModifiers(this.attrs.modifiers).invisible){this._updateIframePreview();}else{this.srcDirty=true;}},_renderReadonly:function(){if(!this.$('iframe.o_embed_iframe').length){this.$el.addClass('o_embed_url_viewer');this.$el.append(this._prepareIframe());}
this._updateIframePreview();},_getEmbedSrc:function(){var src=false;if(this.value){var googleRegExp=/(^https:\/\/docs.google.com).*(\/d\/e\/|\/d\/)([A-Za-z0-9-_]+)/;var google=this.value.match(googleRegExp);if(google&&google[3]){src='https://docs.google.com/presentation'+google[2]+google[3]+'/preview?slide='+this.page;}}
return src||this.value;},_updateIframePreview:function(){var $iframe=this.$('iframe.o_embed_iframe');var src=this._getEmbedSrc();$iframe.toggleClass('d-none',!src);if(src){$iframe.attr('src',src);}else{$iframe.removeAttr('src');}},updateModifiersValue:function(){this._super.apply(this,arguments);if(!this.attrs.modifiersValue.invisible&&this.srcDirty){this._updateIframePreview();this.srcDirty=false;}},});field_registry.add('bullet_state',SetBulletStatus).add('mrp_time_counter',TimeCounter).add('embed_viewer',FieldEmbedURLViewer);return FieldEmbedURLViewer;});;

/* /mrp/static/src/js/mrp_bom_report.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mrp.mrp_bom_report',function(require){'use strict';var core=require('web.core');var framework=require('web.framework');var stock_report_generic=require('stock.stock_report_generic');var QWeb=core.qweb;var _t=core._t;var MrpBomReport=stock_report_generic.extend({events:{'click .o_mrp_bom_unfoldable':'_onClickUnfold','click .o_mrp_bom_foldable':'_onClickFold','click .o_mrp_bom_action':'_onClickAction','click .o_mrp_show_attachment_action':'_onClickShowAttachment',},get_html:function(){var self=this;var args=[this.given_context.active_id,this.given_context.searchQty||1,this.given_context.searchVariant,];return this._rpc({model:'report.mrp.report_bom_structure',method:'get_html',args:args,context:this.given_context,}).then(function(result){self.data=result;});},set_html:function(){var self=this;return this._super().then(function(){self.$('.o_content').html(self.data.lines);self.renderSearch();self.update_cp();});},render_html:function(event,$el,result){if(result.indexOf('mrp.document')>0){if(this.$('.o_mrp_has_attachments').length===0){var column=$('<th/>',{class:'o_mrp_has_attachments',title:'Files attached to the product Attachments',text:'Attachments',});this.$('table thead th:last-child').after(column);}}
$el.after(result);$(event.currentTarget).toggleClass('o_mrp_bom_foldable o_mrp_bom_unfoldable fa-caret-right fa-caret-down');this._reload_report_type();},get_bom:function(event){var self=this;var $parent=$(event.currentTarget).closest('tr');var activeID=$parent.data('id');var productID=$parent.data('product_id');var lineID=$parent.data('line');var qty=$parent.data('qty');var level=$parent.data('level')||0;return this._rpc({model:'report.mrp.report_bom_structure',method:'get_bom',args:[activeID,productID,parseFloat(qty),lineID,level+1,]}).then(function(result){self.render_html(event,$parent,result);});},get_operations:function(event){var self=this;var $parent=$(event.currentTarget).closest('tr');var activeID=$parent.data('bom-id');var qty=$parent.data('qty');var level=$parent.data('level')||0;return this._rpc({model:'report.mrp.report_bom_structure',method:'get_operations',args:[activeID,parseFloat(qty),level+1]}).then(function(result){self.render_html(event,$parent,result);});},update_cp:function(){var status={cp_content:{$buttons:this.$buttonPrint,$searchview:this.$searchView},};return this.updateControlPanel(status);},renderSearch:function(){this.$buttonPrint=$(QWeb.render('mrp.button'));this.$buttonPrint.find('.o_mrp_bom_print').on('click',this._onClickPrint.bind(this));this.$buttonPrint.find('.o_mrp_bom_print_unfolded').on('click',this._onClickPrint.bind(this));this.$searchView=$(QWeb.render('mrp.report_bom_search',_.omit(this.data,'lines')));this.$searchView.find('.o_mrp_bom_report_qty').on('change',this._onChangeQty.bind(this));this.$searchView.find('.o_mrp_bom_report_variants').on('change',this._onChangeVariants.bind(this));this.$searchView.find('.o_mrp_bom_report_type').on('change',this._onChangeType.bind(this));},_onClickPrint:function(ev){var childBomIDs=_.map(this.$el.find('.o_mrp_bom_foldable').closest('tr'),function(el){return $(el).data('id');});framework.blockUI();var reportname='mrp.report_bom_structure?docids='+this.given_context.active_id+'&report_type='+this.given_context.report_type+'&quantity='+(this.given_context.searchQty||1);if(!$(ev.currentTarget).hasClass('o_mrp_bom_print_unfolded')){reportname+='&childs='+JSON.stringify(childBomIDs);}
if(this.given_context.searchVariant){reportname+='&variant='+this.given_context.searchVariant;}
var action={'type':'ir.actions.report','report_type':'qweb-pdf','report_name':reportname,'report_file':'mrp.report_bom_structure',};return this.do_action(action).then(function(){framework.unblockUI();});},_onChangeQty:function(ev){var qty=$(ev.currentTarget).val().trim();if(qty){this.given_context.searchQty=parseFloat(qty);this._reload();}},_onChangeType:function(ev){var report_type=$("option:selected",$(ev.currentTarget)).data('type');this.given_context.report_type=report_type;this._reload_report_type();},_onChangeVariants:function(ev){this.given_context.searchVariant=$(ev.currentTarget).val();this._reload();},_onClickUnfold:function(ev){var redirect_function=$(ev.currentTarget).data('function');this[redirect_function](ev);},_onClickFold:function(ev){this._removeLines($(ev.currentTarget).closest('tr'));$(ev.currentTarget).toggleClass('o_mrp_bom_foldable o_mrp_bom_unfoldable fa-caret-right fa-caret-down');},_onClickAction:function(ev){ev.preventDefault();return this.do_action({type:'ir.actions.act_window',res_model:$(ev.currentTarget).data('model'),res_id:$(ev.currentTarget).data('res-id'),context:{'active_id':$(ev.currentTarget).data('res-id')},views:[[false,'form']],target:'current'});},_onClickShowAttachment:function(ev){ev.preventDefault();var ids=$(ev.currentTarget).data('res-id');return this.do_action({name:_t('Attachments'),type:'ir.actions.act_window',res_model:$(ev.currentTarget).data('model'),domain:[['id','in',ids]],views:[[false,'kanban'],[false,'list'],[false,'form']],view_mode:'kanban,list,form',target:'current',});},_reload:function(){var self=this;return this.get_html().then(function(){self.$('.o_content').html(self.data.lines);self._reload_report_type();});},_reload_report_type:function(){this.$('.o_mrp_bom_cost.o_hidden, .o_mrp_prod_cost.o_hidden').toggleClass('o_hidden');if(this.given_context.report_type==='bom_structure'){this.$('.o_mrp_bom_cost, .o_mrp_prod_cost').toggleClass('o_hidden');}},_removeLines:function($el){var self=this;var activeID=$el.data('id');_.each(this.$('tr[parent_id='+activeID+']'),function(parent){var $parent=self.$(parent);var $el=self.$('tr[parent_id='+$parent.data('id')+']');if($el.length){self._removeLines($parent);}
$parent.remove();});},});core.action_registry.add('mrp_bom_report',MrpBomReport);return MrpBomReport;});;

/* /mrp/static/src/js/mrp_workorder_popover.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mrp.mrp_workorder_popover',function(require){'use strict';var PopoverWidget=require('stock.popover_widget');var fieldRegistry=require('web.field_registry');var core=require('web.core');var _t=core._t;var MrpWorkorderPopover=PopoverWidget.extend({popoverTemplate:'mrp.workorderPopover',title:_t('Scheduling Information'),_render:function(){this._super.apply(this,arguments);if(!this.$popover){return;}
var self=this;this.$popover.find('.action_replan_button').click(function(e){self._onReplanClick(e);});},_onReplanClick:function(e){var self=this;this._rpc({model:'mrp.workorder',method:'action_replan',args:[[self.res_id]]}).then(function(){self.trigger_up('reload');});},});fieldRegistry.add('mrp_workorder_popover',MrpWorkorderPopover);return MrpWorkorderPopover;});;

/* /mrp/static/src/js/mrp_documents_controller_mixin.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mrp.controllerMixin',function(require){'use strict';const{_t,qweb}=require('web.core');const fileUploadMixin=require('web.fileUploadMixin');const DocumentViewer=require('mrp.MrpDocumentViewer');const MrpDocumentsControllerMixin=Object.assign({},fileUploadMixin,{events:{'click .o_mrp_documents_kanban_upload':'_onClickMrpDocumentsUpload',},custom_events:Object.assign({},fileUploadMixin.custom_events,{kanban_image_clicked:'_onKanbanPreview',upload_file:'_onUploadFile',}),async reload(){await this._renderFileUploads();},renderButtons($node){this.$buttons=$(qweb.render('MrpDocumentsKanbanView.buttons'));this.$buttons.appendTo($node);},_getFileUploadRoute(){return'/mrp/upload_attachment';},_makeFileUploadFormDataKeys(){const context=this.model.get(this.handle,{raw:true}).getContext();return{res_id:context.default_res_id,res_model:context.default_res_model,};},_onClickMrpDocumentsUpload(){const $uploadInput=$('<input>',{type:'file',name:'files[]',multiple:'multiple'});$uploadInput.on('change',async ev=>{await this._uploadFiles(ev.target.files);$uploadInput.remove();});$uploadInput.click();},_onKanbanPreview(ev){ev.stopPropagation();const documents=ev.data.recordList;const documentID=ev.data.recordID;const documentViewer=new DocumentViewer(this,documents,documentID);documentViewer.appendTo(this.$('.o_mrp_documents_kanban_view'));},async _onUploadFile(ev){await this._uploadFiles(ev.data.files);},_onUploadLoad({xhr}){const result=xhr.status===200?JSON.parse(xhr.response):{error:_.str.sprintf(_t("status code: %s </br> message: %s"),xhr.status,xhr.response)};if(result.error){this.do_notify(_t("Error"),result.error,true);}
fileUploadMixin._onUploadLoad.apply(this,arguments);},});return MrpDocumentsControllerMixin;});;

/* /mrp/static/src/js/mrp_documents_document_viewer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mrp.MrpDocumentViewer',function(require){"use strict";const DocumentViewer=require('mail.DocumentViewer');const MrpDocumentsDocumentViewer=DocumentViewer.extend({init(parent,attachments,activeAttachmentID){this._super(...arguments);this.modelName='mrp.document';},});return MrpDocumentsDocumentViewer;});;

/* /mrp/static/src/js/mrp_documents_kanban_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mrp.MrpDocumentsKanbanController',function(require){"use strict";const MrpDocumentsControllerMixin=require('mrp.controllerMixin');const KanbanController=require('web.KanbanController');const MrpDocumentsKanbanController=KanbanController.extend(MrpDocumentsControllerMixin,{events:Object.assign({},KanbanController.prototype.events,MrpDocumentsControllerMixin.events),custom_events:Object.assign({},KanbanController.prototype.custom_events,MrpDocumentsControllerMixin.custom_events),init(){this._super(...arguments);MrpDocumentsControllerMixin.init.apply(this,arguments);},async reload(){await this._super(...arguments);await MrpDocumentsControllerMixin.reload.apply(this,arguments);},});return MrpDocumentsKanbanController;});;

/* /mrp/static/src/js/mrp_documents_kanban_record.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mrp.MrpDocumentsKanbanRecord',function(require){"use strict";const KanbanRecord=require('web.KanbanRecord');const MrpDocumentsKanbanRecord=KanbanRecord.extend({events:Object.assign({},KanbanRecord.prototype.events,{'click .o_mrp_download':'_onDownload','click .o_kanban_previewer':'_onImageClicked',}),_onDownload(ev){ev.preventDefault();window.location=`/web/content/${this.modelName}/${this.id}/datas?download=true`;},_onImageClicked(ev){ev.preventDefault();ev.stopPropagation();this.trigger_up('kanban_image_clicked',{recordList:[this.recordData],recordID:this.recordData.id});},});return MrpDocumentsKanbanRecord;});;

/* /mrp/static/src/js/mrp_documents_kanban_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mrp.MrpDocumentsKanbanRenderer',function(require){"use strict";const KanbanRenderer=require('web.KanbanRenderer');const MrpDocumentsKanbanRecord=require('mrp.MrpDocumentsKanbanRecord');const MrpDocumentsKanbanRenderer=KanbanRenderer.extend({config:Object.assign({},KanbanRenderer.prototype.config,{KanbanRecord:MrpDocumentsKanbanRecord,}),async start(){this.$el.addClass('o_mrp_documents_kanban_view');await this._super(...arguments);},});return MrpDocumentsKanbanRenderer;});;

/* /mrp/static/src/js/mrp_document_kanban_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mrp.MrpDocumentsKanbanView',function(require){"use strict";const KanbanView=require('web.KanbanView');const MrpDocumentsKanbanController=require('mrp.MrpDocumentsKanbanController');const MrpDocumentsKanbanRenderer=require('mrp.MrpDocumentsKanbanRenderer');const viewRegistry=require('web.view_registry');const MrpDocumentsKanbanView=KanbanView.extend({config:Object.assign({},KanbanView.prototype.config,{Controller:MrpDocumentsKanbanController,Renderer:MrpDocumentsKanbanRenderer,}),});viewRegistry.add('mrp_documents_kanban',MrpDocumentsKanbanView);return MrpDocumentsKanbanView;});;

/* /mrp/static/src/js/mrp_should_consume.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('mrp.should_consume',function(require){"use strict";const BasicFields=require('web.basic_fields');const FieldFloat=BasicFields.FieldFloat;const fieldRegistry=require('web.field_registry');const field_utils=require('web.field_utils');const MrpShouldConsume=FieldFloat.extend({init:function(parent,name,params){this._super.apply(this,arguments);this.displayShouldConsume=!['done','draft','cancel'].includes(params.data.state);this.should_consume_qty=field_utils.format.float(params.data.should_consume_qty,params.fields.should_consume_qty,this.nodeOptions);},_addShouldConsume:function(value,edit=false){const $to_consume_container=$('<span class="o_should_consume"/>');if(edit){$to_consume_container.addClass('o_row');}
$to_consume_container.text(value+' / ');this.setElement(this.$el.wrap($to_consume_container).parent());},_renderEdit:function(){if(this.displayShouldConsume){if(!this.$el.text().includes('/')){this.$input=this.$el;this._addShouldConsume(this.should_consume_qty,true);}
this._prepareInput(this.$input);}else{this._super.apply(this);}},_renderReadonly:function(){this.$el.text(this._formatValue(this.value));if(this.displayShouldConsume){this._addShouldConsume(this.should_consume_qty);}},});fieldRegistry.add('mrp_should_consume',MrpShouldConsume);return{MrpShouldConsume:MrpShouldConsume,};});;

/* /product_matrix/static/src/js/section_and_note_widget.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('product_matrix.section_and_note_widget',function(require){var Dialog=require('web.Dialog');var core=require('web.core');var _t=core._t;var qweb=core.qweb;var fieldRegistry=require('web.field_registry');require('account.section_and_note_backend');var SectionAndNoteFieldOne2Many=fieldRegistry.get('section_and_note_one2many');SectionAndNoteFieldOne2Many.include({custom_events:_.extend({},SectionAndNoteFieldOne2Many.prototype.custom_events,{open_matrix:'_openMatrix',}),_applyGrid:function(changes,productTemplateId){this.trigger_up('field_changed',{dataPointID:this.dataPointID,changes:{grid:JSON.stringify({changes:changes,product_template_id:productTemplateId}),grid_update:true},viewType:'form',});},_openMatrix:function(ev){ev.stopPropagation();var self=this;var dataPointId=ev.data.dataPointId;var productTemplateId=ev.data.product_template_id;var editedCellAttributes=ev.data.editedCellAttributes;if(!ev.data.edit){this._setValue({operation:'DELETE',ids:[dataPointId]});}
this.trigger_up('field_changed',{dataPointID:this.dataPointID,changes:{grid_product_tmpl_id:{id:productTemplateId}},viewType:'form',onSuccess:function(result){var gridInfo=result.find(r=>r.recordData.grid&&r.recordData.grid.includes("header")).recordData.grid;self._openMatrixConfigurator(gridInfo,productTemplateId,editedCellAttributes);}});},_openMatrixConfigurator:function(jsonInfo,productTemplateId,editedCellAttributes){var self=this;var infos=JSON.parse(jsonInfo);var MatrixDialog=new Dialog(this,{title:_t('Choose Product Variants'),size:'extra-large',$content:$(qweb.render('product_matrix.matrix',{header:infos.header,rows:infos.matrix,})),buttons:[{text:_t('Confirm'),classes:'btn-primary',close:true,click:function(result){var $inputs=this.$('.o_matrix_input');var matrixChanges=[];_.each($inputs,function(matrixInput){if(matrixInput.value&&matrixInput.value!==matrixInput.attributes.value.nodeValue){matrixChanges.push({qty:parseFloat(matrixInput.value),ptav_ids:matrixInput.attributes.ptav_ids.nodeValue.split(",").map(function(id){return parseInt(id);}),});}});if(matrixChanges.length>0){self._applyGrid(matrixChanges,productTemplateId);}}},{text:_t('Close'),close:true},],}).open();MatrixDialog.opened(function(){if(editedCellAttributes.length>0){var str=editedCellAttributes.toString();MatrixDialog.$content.find('.o_matrix_input').filter((k,v)=>v.attributes.ptav_ids.nodeValue===str)[0].focus();}else{MatrixDialog.$content.find('.o_matrix_input:first()').focus();}});},});return SectionAndNoteFieldOne2Many;});;

/* /project_enterprise/static/src/js/task_gantt_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('project_enterprise.TaskGanttView',function(require){'use strict';var GanttView=require('web_gantt.GanttView');var GanttController=require('web_gantt.GanttController');var GanttRenderer=require('web_gantt.GanttRenderer');var TaskGanttModel=require('project_enterprise.TaskGanttModel');var view_registry=require('web.view_registry');var TaskGanttView=GanttView.extend({config:_.extend({},GanttView.prototype.config,{Controller:GanttController,Renderer:GanttRenderer,Model:TaskGanttModel,}),});view_registry.add('task_gantt',TaskGanttView);return TaskGanttView;});;

/* /project_enterprise/static/src/js/task_gantt_model.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('project_enterprise.TaskGanttModel',function(require){"use strict";var GanttModel=require('web_gantt.GanttModel');var _t=require('web.core')._t;var TaskGanttModel=GanttModel.extend({_generateRows:function(params){if(params.groupedBy.length){var groupedByField=params.groupedBy[0];if(groupedByField==='user_id'){var empty_exists=_.some(params.groups,function(group){return!group[groupedByField];});if(!empty_exists){var values=this._parsePath(params.parentPath);var new_group=_.clone(values);new_group=_.extend(new_group,{id:_.uniqueId('group'),fake:true,__count:0,__domain:this._getDomain(),user_id:false,});params.groups.push(new_group);this.ganttData.groups.push(new_group);}}}
var rows=this._super(params);_.each(rows,function(row){if(row.groupedByField==='user_id'&&!row.resId){row.name=_t('Unassigned Tasks');}});if(params.groupedBy&&params.groupedBy.length){if(rows&&rows.length&&rows[rows.length-1]&&!rows[rows.length-1].resId){rows.unshift(rows.pop());}}
return rows;},_parsePath:function(path){var values={};if(path){var pathParts=path.split('\n');var state=this.get();var groupby=state.groupedBy;_.each(groupby,function(fname,index){var val=pathParts[index];if(val){val=JSON.parse(val);if(state.fields[fname].type=='many2one'){values[fname]=val[0];}else{values[fname]=val;}}});}
return values;},});return TaskGanttModel;});;

/* /project_forecast/static/src/js/forecast_gantt.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('forecast.ForecastGanttView',function(require){'use strict';var PlanningGanttModel=require('planning.PlanningGanttModel');var PlanningGanttView=require('planning.PlanningGanttView');var view_registry=require('web.view_registry');var ForecastGanttModel=PlanningGanttModel.extend({reload:function(handle,params){if('context'in params&&params.context.planning_groupby_project&&!params.groupBy.length){params.groupBy.unshift('project_id');}
return this._super(handle,params);}});var ForecastGanttView=PlanningGanttView.extend({config:_.extend({},PlanningGanttView.prototype.config,{Model:ForecastGanttModel,}),});view_registry.add('forecast_gantt',ForecastGanttView);return ForecastGanttView;});;

/* /purchase/static/src/js/purchase_dashboard.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('purchase.dashboard',function(require){"use strict";var core=require('web.core');var ListController=require('web.ListController');var ListModel=require('web.ListModel');var ListRenderer=require('web.ListRenderer');var ListView=require('web.ListView');var KanbanController=require('web.KanbanController');var KanbanModel=require('web.KanbanModel');var KanbanRenderer=require('web.KanbanRenderer');var KanbanView=require('web.KanbanView');var SampleServer=require('web.SampleServer');var view_registry=require('web.view_registry');var QWeb=core.qweb;let dashboardValues;SampleServer.mockRegistry.add('purchase.order/retrieve_dashboard',()=>{return Object.assign({},dashboardValues);});var PurchaseListDashboardRenderer=ListRenderer.extend({events:_.extend({},ListRenderer.prototype.events,{'click .o_dashboard_action':'_onDashboardActionClicked',}),_renderView:function(){var self=this;return this._super.apply(this,arguments).then(function(){var values=self.state.dashboardValues;var purchase_dashboard=QWeb.render('purchase.PurchaseDashboard',{values:values,});self.$el.prepend(purchase_dashboard);});},_onDashboardActionClicked:function(e){e.preventDefault();var $action=$(e.currentTarget);this.trigger_up('dashboard_open_action',{action_name:$action.attr('name')+"_list",action_context:$action.attr('context'),});},});var PurchaseListDashboardModel=ListModel.extend({init:function(){this.dashboardValues={};this._super.apply(this,arguments);},__get:function(localID){var result=this._super.apply(this,arguments);if(_.isObject(result)){result.dashboardValues=this.dashboardValues[localID];}
return result;},__load:function(){return this._loadDashboard(this._super.apply(this,arguments));},__reload:function(){return this._loadDashboard(this._super.apply(this,arguments));},_loadDashboard:function(super_def){var self=this;var dashboard_def=this._rpc({model:'purchase.order',method:'retrieve_dashboard',});return Promise.all([super_def,dashboard_def]).then(function(results){var id=results[0];dashboardValues=results[1];self.dashboardValues[id]=dashboardValues;return id;});},});var PurchaseListDashboardController=ListController.extend({custom_events:_.extend({},ListController.prototype.custom_events,{dashboard_open_action:'_onDashboardOpenAction',}),_onDashboardOpenAction:function(e){return this.do_action(e.data.action_name,{additional_context:JSON.parse(e.data.action_context)});},});var PurchaseListDashboardView=ListView.extend({config:_.extend({},ListView.prototype.config,{Model:PurchaseListDashboardModel,Renderer:PurchaseListDashboardRenderer,Controller:PurchaseListDashboardController,}),});var PurchaseKanbanDashboardRenderer=KanbanRenderer.extend({events:_.extend({},KanbanRenderer.prototype.events,{'click .o_dashboard_action':'_onDashboardActionClicked',}),_render:function(){var self=this;return this._super.apply(this,arguments).then(function(){var values=self.state.dashboardValues;var purchase_dashboard=QWeb.render('purchase.PurchaseDashboard',{values:values,});self.$el.prepend(purchase_dashboard);});},_onDashboardActionClicked:function(e){e.preventDefault();var $action=$(e.currentTarget);this.trigger_up('dashboard_open_action',{action_name:$action.attr('name')+"_kanban",action_context:$action.attr('context'),});},});var PurchaseKanbanDashboardModel=KanbanModel.extend({init:function(){this.dashboardValues={};this._super.apply(this,arguments);},__get:function(localID){var result=this._super.apply(this,arguments);if(_.isObject(result)){result.dashboardValues=this.dashboardValues[localID];}
return result;},__load:function(){return this._loadDashboard(this._super.apply(this,arguments));},__reload:function(){return this._loadDashboard(this._super.apply(this,arguments));},_loadDashboard:function(super_def){var self=this;var dashboard_def=this._rpc({model:'purchase.order',method:'retrieve_dashboard',});return Promise.all([super_def,dashboard_def]).then(function(results){var id=results[0];dashboardValues=results[1];self.dashboardValues[id]=dashboardValues;return id;});},});var PurchaseKanbanDashboardController=KanbanController.extend({custom_events:_.extend({},KanbanController.prototype.custom_events,{dashboard_open_action:'_onDashboardOpenAction',}),_onDashboardOpenAction:function(e){return this.do_action(e.data.action_name,{additional_context:JSON.parse(e.data.action_context)});},});var PurchaseKanbanDashboardView=KanbanView.extend({config:_.extend({},KanbanView.prototype.config,{Model:PurchaseKanbanDashboardModel,Renderer:PurchaseKanbanDashboardRenderer,Controller:PurchaseKanbanDashboardController,}),});view_registry.add('purchase_list_dashboard',PurchaseListDashboardView);view_registry.add('purchase_kanban_dashboard',PurchaseKanbanDashboardView);return{PurchaseListDashboardModel:PurchaseListDashboardModel,PurchaseListDashboardRenderer:PurchaseListDashboardRenderer,PurchaseListDashboardController:PurchaseListDashboardController,PurchaseKanbanDashboardModel:PurchaseKanbanDashboardModel,PurchaseKanbanDashboardRenderer:PurchaseKanbanDashboardRenderer,PurchaseKanbanDashboardController:PurchaseKanbanDashboardController};});;

/* /purchase/static/src/js/purchase_toaster_button.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('purchase.ToasterButton',function(require){'use strict';const widgetRegistry=require('web.widget_registry');const Widget=require('web.Widget');const ToasterButton=Widget.extend({template:'purchase.ToasterButton',xmlDependencies:['/purchase/static/src/xml/purchase_toaster_button.xml'],events:Object.assign({},Widget.prototype.events,{'click .fa-info-circle':'_onClickButton',}),init:function(parent,data,node){this._super(...arguments);this.button_name=node.attrs.button_name;this.title=node.attrs.title;this.id=data.res_id;this.model=data.model;},_onClickButton:function(ev){this._rpc({method:this.button_name,model:this.model,args:[[this.id]],}).then(res=>{if(res){this.do_notify(false,res.toast_message);}})},});widgetRegistry.add('toaster_button',ToasterButton);return ToasterButton;});;

/* /purchase/static/src/js/tours/purchase.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('purchase.purchase_steps',function(require){"use strict";var core=require('web.core');var PurchaseAdditionalTourSteps=core.Class.extend({_get_purchase_stock_steps:function(){return[{auto:true,trigger:".o_purchase_order",},];},});return PurchaseAdditionalTourSteps;});odoo.define('purchase.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;var PurchaseAdditionalTourSteps=require('purchase.purchase_steps');tour.register('purchase_tour',{url:"/web"},[tour.stepUtils.showAppsMenuItem(),{trigger:'.o_app[data-menu-xmlid="purchase.menu_purchase_root"]',content:_t("Let's try the Purchase app to manage the flow from purchase to reception and invoice control."),position:'right',edition:'community'},{trigger:'.o_app[data-menu-xmlid="purchase.menu_purchase_root"]',content:_t("Let's try the Purchase app to manage the flow from purchase to reception and invoice control."),position:'bottom',edition:'enterprise'},{trigger:".o_list_button_add",extra_trigger:".o_purchase_order",content:_t("Let's create your first request for quotation."),position:"bottom",},{trigger:".o_form_editable .o_field_many2one[name='partner_id']",extra_trigger:".o_purchase_order",content:_t("Search a vendor name, or create one on the fly."),position:"bottom",run:function(actions){actions.text("Agrolait",this.$anchor.find("input"));},},{trigger:".ui-menu-item > a",auto:true,in_modal:false,},{trigger:".o_field_x2many_list_row_add > a",extra_trigger:".o_field_many2one[name='partner_id'] .o_external_button",content:_t("Add some products or services to your quotation."),position:"bottom",},{trigger:".o_field_widget[name=product_id], .o_field_widget[name=product_template_id]",extra_trigger:".o_purchase_order",content:_t("Select a product, or create a new one on the fly."),position:"right",run:function(actions){var $input=this.$anchor.find('input');actions.text("DESK0001",$input.length===0?this.$anchor:$input);var keyDownEvent=jQuery.Event("keydown");keyDownEvent.which=42;this.$anchor.trigger(keyDownEvent);var $descriptionElement=$('.o_form_editable textarea[name="name"]');$descriptionElement.change(function(){$descriptionElement.addClass('product_creation_success');});},},{trigger:'.ui-menu.ui-widget .ui-menu-item a:contains("DESK0001")',auto:true,},{trigger:'.o_form_editable textarea[name="name"].product_creation_success',auto:true,run:function(){}},{trigger:".o_form_editable input[name='product_qty'] ",extra_trigger:".o_purchase_order",content:_t("Indicate the product quantity you want to order."),position:"right",run:'text 12.0'},...tour.stepUtils.statusbarButtonsSteps('Send by Email',_t("Send the request for quotation to your vendor."),".o_statusbar_buttons button[name='action_rfq_send']"),{trigger:".modal-content",auto:true,run:function(actions){var $input=$(".modal-content input[name='email']");if($input.length){actions.text("agrolait@example.com",$input);actions.click($(".modal-footer button"));}}},{trigger:".modal-footer button[name='action_send_mail']",extra_trigger:".modal-footer button[name='action_send_mail']",content:_t("Send the request for quotation to your vendor."),position:"bottom",run:'click',},{trigger:".ui-sortable-handle",extra_trigger:".o_purchase_order",content:_t("Click here to edit or move the quotation line."),position:"bottom",run:'click',},{trigger:".o_form_editable input[name='price_unit']",extra_trigger:".o_form_editable input[name='price_unit']",content:_t("Once you get the price from the vendor, you can complete the purchase order with the right price."),position:"right",run:'text 200.00'},{auto:true,trigger:".o_purchase_order",run:'click',},...tour.stepUtils.statusbarButtonsSteps('Confirm Order',_t("Confirm your purchase.")),...new PurchaseAdditionalTourSteps()._get_purchase_stock_steps(),]);});;

/* /snailmail_account/static/src/js/snailmail_account_notification_manager.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('snailmail_account.NotificationManager',function(require){"use strict";var AbstractService=require('web.AbstractService');var core=require("web.core");var SnailmailAccountNotificationManager=AbstractService.extend({dependencies:['bus_service'],start:function(){this._super.apply(this,arguments);this.call('bus_service','onNotification',this,this._onNotification);},_onNotification:function(notifs){var self=this;_.each(notifs,function(notif){var model=notif[0][1];var type=notif[1].type;if(model==='res.partner'&&type==='snailmail_invalid_address'){self.do_warn(notif[1].title,notif[1].message);}});}});core.serviceRegistry.add('snailmail_account_notification_service',SnailmailAccountNotificationManager);return SnailmailAccountNotificationManager;});;

/* /social_push_notifications/static/src/js/push_preview.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('social_push_notifications.social_push_preview',function(require){'use strict';var widgetRegistry=require('web.widget_registry');var Widget=require('web.Widget');var core=require('web.core');var _t=core._t;var PushPreviewButton=Widget.extend({tagName:'button',className:'btn btn-secondary',events:{'click':'_onClick',},init:function(parent,record,node){this.record=record;this.node=node;this._super.apply(this,arguments);},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.$el.append($('<i/>',{class:'fa fa-fw o_button_icon fa-bell'})).append($('<span/>',{text:_t('Test Notification')}));});},_onClick:function(ev){var self=this;ev.preventDefault();ev.stopPropagation();if(Notification.permission==="denied"){this.do_warn(_t("Notifications blocked"),_t("Your browser notifications are blocked or you're not in an HTTPS environment."));return;}
var recordState=this.getParent().state.data;var message=recordState.message;var title=recordState.push_notification_title||_('New Message');var image=recordState.push_notification_image;var targetUrl=recordState.push_notification_target_url;Notification.requestPermission().then(function(){if(Notification.permission==="granted"){var notification=new Notification(title,{body:message,icon:self._getImageUrl(image)});notification.onclick=function(){if(targetUrl){window.open(targetUrl);}};}});},_getImageUrl(recordImage){if(recordImage){try{window.atob(recordImage);return'data:image/png;base64, '+recordImage;}catch(e){return'/web/image/social.post/'+this.record.data.id+'/push_notification_image';}}
return'/mail/static/src/img/odoobot_transparent.png';}});widgetRegistry.add('social_push_preview',PushPreviewButton);return PushPreviewButton;});;

/* /stock_enterprise/static/src/js/report_grid_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('stock_enterprise.ReportGridController',function(require){"use strict";var GridController=require('web_grid.GridController');var utils=require('web.utils');var core=require('web.core');var _t=core._t;var ReportGridController=GridController.extend({_onOpenCellInformation:function(ev){var self=this;var state=this.model.get();var cellPath=ev.data.path.split('.');var rowPath=cellPath.slice(0,-3).concat(['rows'],cellPath.slice(-2,-1));var row=utils.into(state.data,rowPath);var colPath=cellPath.slice(0,-3).concat(['cols'],cellPath.slice(-1));var col=utils.into(state.data,colPath);if(!row.values.product_id){this.do_warn(false,_t("Only grouping by product is supported"));return;}
return this._rpc({model:'report.stock.quantity',method:'action_open_moves',args:[row.values.product_id[0],row.values.state.data,col.values.date[0].split('/')[0],]}).then(function(action){return self.do_action(action);});},});return ReportGridController;});;

/* /stock_enterprise/static/src/js/report_grid_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('stock_enterprise.ReportGridView',function(require){'use strict';var GridView=require('web_grid.GridView');var ReportGridController=require('stock_enterprise.ReportGridController');var viewRegistry=require('web.view_registry');var ReportGridView=GridView.extend({config:_.extend({},GridView.prototype.config,{Controller:ReportGridController,}),});viewRegistry.add('stock_enterprise_report_grid',ReportGridView);return ReportGridView;});;

/* /website_livechat/static/src/bugfix/bugfix.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('website_livechat/static/src/bugfix/bugfix.js',function(require){'use strict';});;

/* /website_livechat/static/src/components/discuss/discuss.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('website_livechat/static/src/components/discuss/discuss.js',function(require){'use strict';const components={Discuss:require('mail/static/src/components/discuss/discuss.js'),VisitorBanner:require('website_livechat/static/src/components/visitor_banner/visitor_banner.js'),};Object.assign(components.Discuss.components,{VisitorBanner:components.VisitorBanner,});});;

/* /website_livechat/static/src/components/visitor_banner/visitor_banner.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('website_livechat/static/src/components/visitor_banner/visitor_banner.js',function(require){'use strict';const useStore=require('mail/static/src/component_hooks/use_store/use_store.js');const{Component}=owl;class VisitorBanner extends Component{constructor(...args){super(...args);useStore(props=>{const visitor=this.env.models['website_livechat.visitor'].get(props.visitorLocalId);return{visitor:visitor?visitor.__state:undefined,};});}
get visitor(){return this.env.models['website_livechat.visitor'].get(this.props.visitorLocalId);}}
Object.assign(VisitorBanner,{props:{visitorLocalId:String,},template:'website_livechat.VisitorBanner',});return VisitorBanner;});;

/* /website_livechat/static/src/models/messaging_notification_handler/messaging_notification_handler.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('website_livechat/static/src/models/messaging_notification_handler/messaging_notification_handler.js',function(require){'use strict';const{registerInstancePatchModel}=require('mail/static/src/model/model_core.js');registerInstancePatchModel('mail.messaging_notification_handler','website_livechat/static/src/models/messaging_notification_handler/messaging_notification_handler.js',{_handleNotificationPartner(data){const{info}=data;if(info==='send_chat_request'){this._handleNotificationPartnerChannel(data);const channel=this.env.models['mail.thread'].findFromIdentifyingData({id:data.id,model:'mail.channel',});this.env.messaging.chatWindowManager.openThread(channel,{makeActive:true,});return;}
return this._super(data);},});});;

/* /website_livechat/static/src/models/thread/thread.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('website_livechat/static/src/models/thread/thread.js',function(require){'use strict';const{registerClassPatchModel,registerFieldPatchModel,}=require('mail/static/src/model/model_core.js');const{many2one}=require('mail/static/src/model/model_field.js');registerClassPatchModel('mail.thread','website_livechat/static/src/models/thread/thread.js',{convertData(data){const data2=this._super(data);if('visitor'in data){if(data.visitor){data2.visitor=[['insert',this.env.models['website_livechat.visitor'].convertData(data.visitor)]];}else{data2.visitor=[['unlink']];}}
return data2;},});registerFieldPatchModel('mail.thread','website_livechat/static/src/models/thread/thread.js',{visitor:many2one('website_livechat.visitor',{inverse:'threads',}),});});;

/* /website_livechat/static/src/models/visitor/visitor.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('website_livechat/static/src/models/partner/partner.js',function(require){'use strict';const{registerNewModel}=require('mail/static/src/model/model_core.js');const{attr,many2one,one2many}=require('mail/static/src/model/model_field.js');function factory(dependencies){class Visitor extends dependencies['mail.model']{static convertData(data){const data2={};if('country_id'in data){if(data.country_id){data2.country=[['insert',{id:data.country_id,code:data.country_code,}]];}else{data2.country=[['unlink']];}}
if('history'in data){data2.history=data.history;}
if('is_connected'in data){data2.is_connected=data.is_connected;}
if('lang'in data){data2.lang=data.lang;}
if('name'in data){data2.name=data.name;}
if('partner_id'in data){if(data.partner_id){data2.partner=[['insert',{id:data.partner_id}]];}else{data2.partner=[['unlink']];}}
if('website'in data){data2.website=data.website;}
return data2;}
_computeAvatarUrl(){if(!this.partner){return'/mail/static/src/img/smiley/avatar.jpg';}
return this.partner.avatarUrl;}
_computeCountry(){if(this.partner&&this.partner.country){return[['link',this.partner.country]];}
if(this.country){return[['link',this.country]];}
return[['unlink']];}
_computeNameOrDisplayName(){if(this.partner){return this.partner.nameOrDisplayName;}
return this.name;}}
Visitor.fields={avatarUrl:attr({compute:'_computeAvatarUrl',dependencies:['partner','partnerAvatarUrl',],}),country:many2one('mail.country',{compute:'_computeCountry',dependencies:['country','partnerCountry',],}),history:attr(),is_connected:attr(),lang:attr(),name:attr(),nameOrDisplayName:attr({compute:'_computeNameOrDisplayName',dependencies:['name','partnerNameOrDisplayName',],}),partner:many2one('mail.partner'),partnerAvatarUrl:attr({related:'partner.avatarUrl',}),partnerCountry:many2one('mail.country',{related:'partner.country',}),partnerNameOrDisplayName:attr({related:'partner.nameOrDisplayName'}),threads:one2many('mail.thread',{inverse:'visitor',}),website:attr(),};Visitor.modelName='website_livechat.visitor';return Visitor;}
registerNewModel('website_livechat.visitor',factory);});;

/* /account_bank_statement_import/static/src/js/account_bank_statement_import.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account_bank_statement_import.import',function(require){"use strict";var core=require('web.core');var BaseImport=require('base_import.import');var _t=core._t;BaseImport.DataImport.include({renderImportLink:function(){this._super();if(this.res_model=='account.bank.statement'){this.$(".import-link").prop({"text":_t(" Import Template for Bank Statements"),"href":"/account_bank_statement_import/static/csv/account.bank.statement.csv"});this.$(".template-import").removeClass('d-none');}},});});;

/* /account_plaid/static/src/js/plaid.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account_plaid.acc_config_widget',function(require){"use strict";var ajax=require('web.ajax');var core=require('web.core');var AbstractAction=require('web.AbstractAction');var PlaidAccountConfigurationWidget=AbstractAction.extend({on_attach_callback:function(){if(this.exit===true){this.do_action({type:'ir.actions.act_window_close'});}},init:function(parent,context){var self=this;this._super(parent,context);this.context=context.context;this.exit=false;this.loaded=new Promise(function(resolve){self._loadedResolver=resolve;});this.institution_id=context.institution_id;this.plaid_link=context.open_link;this.account_online_provider_id=context.account_online_provider_id;this.public_key=context.public_key;this.public_token=context.public_token;this.environment=context.environment||'production';if(context.result){this.result=context.result;}},willStart:function(){var self=this;if(this.plaid_link===true){ajax.loadJS('https://cdn.plaid.com/link/v2/stable/link-initialize.js').then(function(){var plaid_options={clientName:'Odoo',env:self.environment,key:self.public_key,product:['transactions'],onSuccess:function(public_token,metadata){if(self.public_token===undefined){return self.linkSuccess(public_token,metadata);}
else{self.exit=true;self._loadedResolver();}},onExit:function(err,metadata){if(err){console.log(err);console.log(metadata);}
self.exit=true;self._loadedResolver();},}
if(self.public_token!==undefined){plaid_options['token']=self.public_token;}
self.plaid_link=Plaid.create(plaid_options);if(self.public_token!==undefined){self.plaid_link.open();}
else{self.plaid_link.open(self.institution_id);}});}
else{this._loadedResolver();}
return this.loaded;},linkSuccess:function(public_token,metadata){var self=this;metadata.environment=self.environment;return this._rpc({model:'account.online.provider',method:'link_success',args:[[self.id],public_token,metadata],context:self.context,}).then(function(result){self.do_action(result);});},renderElement:function(){var self=this;if(this.exit===true){return this._super.apply(this,arguments);}},});core.action_registry.add('plaid_online_sync_widget',PlaidAccountConfigurationWidget);});;

/* /account_ponto/static/src/js/ponto.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account_ponto.acc_config_widget',function(require){"use strict";var ajax=require('web.ajax');var core=require('web.core');var _t=core._t;var AbstractAction=require('web.AbstractAction');var QWeb=core.qweb;var PontoAccountConfigurationWidget=AbstractAction.extend({template:'PontoTemplate',init:function(parent,context){this._super(parent,context);this.create=context.context.method==='add';this.context=context.context;this.record_id=context.record_id&&[context.record_id]||[];},renderButtons:function($node){var self=this;this.$buttons=$(QWeb.render("PontoTemplateFooter",{'widget':this}));this.$buttons.find('.js_ponto_continue').click(function(e){var client_id=$('.client_id').val()
var secret_id=$('.secret_id').val()
if(client_id&&secret_id){var credentials_to_encode=client_id+':'+secret_id;self._rpc({model:'account.online.provider',method:'success_callback',args:[self.record_id,credentials_to_encode],context:self.context,}).then(function(result){self.do_action(result);});}});this.$buttons.find('.js_cancel').click(function(e){self.do_action({type:'ir.actions.act_window_close'});});if($node){this.$buttons.appendTo($node);}},});core.action_registry.add('ponto_online_sync_widget',PontoAccountConfigurationWidget);});;

/* /account_reports/static/src/js/mail_activity.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account_reports.activity',function(require){"use strict";var core=require('web.core');var AccountActivity=require('account.activity');var _t=core._t;AccountActivity.include({events:_.extend({'click .o_open_vat_report':'_onOpenReport',},AccountActivity.prototype.events),_onOpenReport:function(e){e.stopPropagation();e.preventDefault();var self=this;var id=$(e.target).data('id')||false;if(id){this._rpc({model:'mail.activity',method:'action_open_tax_report',args:[id],}).then(function(action){self.do_action(action);});}}});});;

/* /account_reports/static/src/js/account_reports.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account_reports.account_report',function(require){'use strict';var core=require('web.core');var Context=require('web.Context');var AbstractAction=require('web.AbstractAction');var Dialog=require('web.Dialog');var datepicker=require('web.datepicker');var session=require('web.session');var field_utils=require('web.field_utils');var RelationalFields=require('web.relational_fields');var StandaloneFieldManagerMixin=require('web.StandaloneFieldManagerMixin');var WarningDialog=require('web.CrashManager').WarningDialog;var Widget=require('web.Widget');var QWeb=core.qweb;var _t=core._t;var M2MFilters=Widget.extend(StandaloneFieldManagerMixin,{init:function(parent,fields){this._super.apply(this,arguments);StandaloneFieldManagerMixin.init.call(this);this.fields=fields;this.widgets={};},willStart:function(){var self=this;var defs=[this._super.apply(this,arguments)];_.each(this.fields,function(field,fieldName){defs.push(self._makeM2MWidget(field,fieldName));});return Promise.all(defs);},start:function(){var self=this;var $content=$(QWeb.render("m2mWidgetTable",{fields:this.fields}));self.$el.append($content);_.each(this.fields,function(field,fieldName){self.widgets[fieldName].appendTo($content.find('#'+fieldName+'_field'));});return this._super.apply(this,arguments);},_confirmChange:function(){var self=this;var result=StandaloneFieldManagerMixin._confirmChange.apply(this,arguments);var data={};_.each(this.fields,function(filter,fieldName){data[fieldName]=self.widgets[fieldName].value.res_ids;});this.trigger_up('value_changed',data);return result;},_makeM2MWidget:function(fieldInfo,fieldName){var self=this;var options={};options[fieldName]={options:{no_create_edit:true,no_create:true,}};return this.model.makeRecord(fieldInfo.modelName,[{fields:[{name:'id',type:'integer',},{name:'display_name',type:'char',}],name:fieldName,relation:fieldInfo.modelName,type:'many2many',value:fieldInfo.value,}],options).then(function(recordID){self.widgets[fieldName]=new RelationalFields.FieldMany2ManyTags(self,fieldName,self.model.get(recordID),{mode:'edit',});self._registerWidget(recordID,fieldName,self.widgets[fieldName]);});},});var accountReportsWidget=AbstractAction.extend({hasControlPanel:true,events:{'input .o_account_reports_filter_input':'filter_accounts','click .o_account_reports_summary':'edit_summary','click .js_account_report_save_summary':'save_summary','click .o_account_reports_footnote_icons':'delete_footnote','click .js_account_reports_add_footnote':'add_edit_footnote','click .js_account_report_foldable':'fold_unfold','click [action]':'trigger_action','click .o_account_reports_load_more span':'load_more','click .o_account_reports_table thead th':'selected_column','click .o_change_expected_date':'_onChangeExpectedDate','click .o_search_options .dropdown-menu':'_onClickDropDownMenu',},custom_events:{'value_changed':function(ev){var self=this;self.report_options.partner_ids=ev.data.partner_ids;self.report_options.partner_categories=ev.data.partner_categories;self.report_options.analytic_accounts=ev.data.analytic_accounts;self.report_options.analytic_tags=ev.data.analytic_tags;return self.reload().then(function(){self.$searchview_buttons.find('.account_partner_filter').click();self.$searchview_buttons.find('.account_analytic_filter').click();});},},init:function(parent,action){this.actionManager=parent;this.report_model=action.context.model;if(this.report_model===undefined){this.report_model='account.report';}
this.financial_id=false;if(action.context.id){this.financial_id=action.context.id;}
this.odoo_context=action.context;this.report_options=action.params&&action.params.options;this.ignore_session=action.params&&action.params.ignore_session;if((this.ignore_session==='read'||this.ignore_session==='both')!==true){var persist_key='report:'+this.report_model+':'+this.financial_id+':'+session.company_id;this.report_options=JSON.parse(sessionStorage.getItem(persist_key))||this.report_options;}
return this._super.apply(this,arguments);},willStart:async function(){const reportsInfoPromise=this._rpc({model:this.report_model,method:'get_report_informations',args:[this.financial_id,this.report_options],context:this.odoo_context,}).then(res=>this.parse_reports_informations(res));const parentPromise=this._super(...arguments);return Promise.all([reportsInfoPromise,parentPromise]);},start:async function(){this.renderButtons();this.controlPanelProps.cp_content={$buttons:this.$buttons,$searchview_buttons:this.$searchview_buttons,$pager:this.$pager,$searchview:this.$searchview,};await this._super(...arguments);this.render();if("default_filter_accounts"in(this.odoo_context||{}))
this.$('.o_account_reports_filter_input').val(this.odoo_context.default_filter_accounts).trigger("input");},parse_reports_informations:function(values){this.report_options=values.options;this.odoo_context=values.context;this.report_manager_id=values.report_manager_id;this.footnotes=values.footnotes;this.buttons=values.buttons;this.main_html=values.main_html;this.$searchview_buttons=$(values.searchview_html);this.persist_options();},persist_options:function(){if((this.ignore_session==='write'||this.ignore_session==='both')!==true){var persist_key='report:'+this.report_model+':'+this.financial_id+':'+session.company_id;sessionStorage.setItem(persist_key,JSON.stringify(this.report_options));}},do_show:function(){this._super.apply(this,arguments);this.update_cp();},update_cp:function(){if(!this.$buttons){this.renderButtons();}
var status={cp_content:{$buttons:this.$buttons,$searchview_buttons:this.$searchview_buttons,$pager:this.$pager,$searchview:this.$searchview,},};return this.updateControlPanel(status);},reload:function(){var self=this;return this._rpc({model:this.report_model,method:'get_report_informations',args:[self.financial_id,self.report_options],context:self.odoo_context,}).then(function(result){self.parse_reports_informations(result);self.render();return self.update_cp();});},render:function(){var self=this;this.render_template();this.render_footnotes();this.render_searchview_buttons();this.$('.js_account_report_foldable').each(function(){if(!$(this).data('unfolded')){self.fold($(this));}});},render_template:function(){this.$('.o_content').html(this.main_html);this.$('.o_content').find('.o_account_reports_summary_edit').hide();this.$('[data-toggle="tooltip"]').tooltip();this._add_line_classes();},_init_line_popups:function(){var self=this;_.each(this.$('.o_account_report_popup'),function(popup){$(popup).popover({html:true,template:"<div class='popover' role='tooltip' style='max-width: 100%; margin-right:80px;'><div class='popover-body'></div></div>",placement:'left',trigger:'focus',container:'body',delay:{show:0,hide:100},content:function(){var data=JSON.parse(popup.getAttribute('data'));var $content=$(QWeb.render(popup.getAttribute('template'),data));$content.find('.js_view_entries').on('click',function(event){self._rpc({model:'account.financial.html.report.line',method:'action_view_journal_entries',args:[$(event.target).data('id'),self.report_options],context:self.odoo_context,}).then(function(result){return self.do_action(result);})});var formula_element=$content.find('.js_popup_formula');_.each($content.find('.js_popup_formula'),function(element){$(element).on("mouseenter",function(event){$(element).addClass('o_financial_report_hover_popup');self.$("[code='"+element.textContent+"']").addClass('o_financial_report_hover_popup');});$(element).on("mouseleave",function(event){$(element).removeClass('o_financial_report_hover_popup');self.$("[code='"+element.textContent+"']").removeClass('o_financial_report_hover_popup');});});_.each($content.find('.js_popup_open_report'),function(element){$(element).on("click",function(event){var $target=$(event.target);self._rpc({model:'account.financial.html.report',method:'action_redirect_to_report',args:[$target.data('id'),self.report_options,$target.data('target')],context:self.odoo_context,}).then(function(result){return self.do_action(result);})});});return $content;}});$(popup).on("hidden.bs.popover",function(element){self.$('.js_popup_formula').removeClass('o_financial_report_hover_popup');});});},_add_line_classes:function(){var el=this.$el[0];var report_lines=el.getElementsByClassName('o_account_report_line');for(var l=0;l<report_lines.length;l++){var line=report_lines[l];var unfolded=line.dataset.unfolded;if(unfolded==='True'){line.parentNode.classList.add('o_js_account_report_parent_row_unfolded');}}
this.$('tr[data-parent-id]').addClass('o_js_account_report_inner_row');this._init_line_popups();},filter_accounts:function(e){var self=this;var query=e.target.value.trim().toLowerCase();this.filterOn=false;this.$('.o_account_searchable_line').each(function(index,el){var $accountReportLineFoldable=$(el);var line_id=$accountReportLineFoldable.find('.o_account_report_line').data('id');var $childs=self.$('tr[data-parent-id="'+line_id+'"]');var lineText=$accountReportLineFoldable.find('.account_report_line_name').contents().get(0).nodeValue.trim();var queryFound=lineText.split(' ').some(function(str){return str.toLowerCase().startsWith(query);});$accountReportLineFoldable.toggleClass('o_account_reports_filtered_lines',!queryFound);$childs.toggleClass('o_account_reports_filtered_lines',!queryFound);if(!queryFound){self.filterOn=true;}});if(this.filterOn){this.$('.o_account_reports_level1.total').hide();}
else{this.$('.o_account_reports_level1.total').show();}
this.report_options['filter_accounts']=query;this.render_footnotes();},selected_column:function(e){var self=this;if(self.report_options.selected_column!==undefined){var col_number=Array.prototype.indexOf.call(e.currentTarget.parentElement.children,e.currentTarget)+1;if(self.report_options.selected_column&&self.report_options.selected_column==col_number){self.report_options.selected_column=-col_number;}else{self.report_options.selected_column=col_number;}
self.reload()}},_onChangeExpectedDate:function(event){var self=this;var targetID=parseInt($(event.target).attr('data-id'));var parentID=parseInt($(event.target).attr('parent-id').split("-")[1]);var $content=$(QWeb.render("paymentDateForm",{target_id:targetID}));var paymentDatePicker=new datepicker.DateWidget(this);paymentDatePicker.appendTo($content.find('div.o_account_reports_payment_date_picker'));var save=function(){return this._rpc({model:'res.partner',method:'change_expected_date',args:[[parentID],{move_line_id:parseInt($content.find("#target_id").val()),expected_pay_date:paymentDatePicker.getValue(),}],}).then(function(){self.reload();});};new Dialog(this,{title:'Odoo',size:'medium',$content:$content,buttons:[{text:_t('Save'),classes:'btn-primary',close:true,click:save},{text:_t('Cancel'),close:true}]}).open();},render_searchview_buttons:function(){var self=this;var $datetimepickers=this.$searchview_buttons.find('.js_account_reports_datetimepicker');var options={locale:moment.locale(),format:'L',icons:{date:"fa fa-calendar",},};$datetimepickers.each(function(){var name=$(this).find('input').attr('name');var defaultValue=$(this).data('default-value');$(this).datetimepicker(options);var dt=new datepicker.DateWidget(options);dt.replace($(this)).then(function(){dt.$el.find('input').attr('name',name);if(defaultValue){dt.setValue(moment(defaultValue));}});});_.each(this.$searchview_buttons.find('.js_format_date'),function(dt){var date_value=$(dt).html();$(dt).html((new moment(date_value)).format('ll'));});this.$searchview_buttons.find('.js_foldable_trigger').click(function(event){$(this).toggleClass('o_closed_menu o_open_menu');self.$searchview_buttons.find('.o_foldable_menu[data-filter="'+$(this).data('filter')+'"]').toggleClass('o_closed_menu');});_.each(self.report_options,function(k){if(k!==null&&k.filter!==undefined){self.$searchview_buttons.find('[data-filter="'+k.filter+'"]').addClass('selected');}});_.each(this.$searchview_buttons.find('.js_account_report_bool_filter'),function(k){$(k).toggleClass('selected',self.report_options[$(k).data('filter')]);});_.each(this.$searchview_buttons.find('.js_account_report_choice_filter'),function(k){$(k).toggleClass('selected',(_.filter(self.report_options[$(k).data('filter')],function(el){return''+el.id==''+$(k).data('id')&&el.selected===true;})).length>0);});$('.js_account_report_group_choice_filter',this.$searchview_buttons).each(function(i,el){var $el=$(el);var ids=$el.data('member-ids');$el.toggleClass('selected',_.every(self.report_options[$el.data('filter')],function(member){if(typeof member.id=='number'){return member.selected===(ids.indexOf(member.id)>-1);}else{return true;}}));});_.each(this.$searchview_buttons.find('.js_account_reports_one_choice_filter'),function(k){$(k).toggleClass('selected',''+self.report_options[$(k).data('filter')]===''+$(k).data('id'));});this.$searchview_buttons.find('.js_account_report_date_filter').click(function(event){self.report_options.date.filter=$(this).data('filter');var error=false;if($(this).data('filter')==='custom'){var date_from=self.$searchview_buttons.find('.o_datepicker_input[name="date_from"]');var date_to=self.$searchview_buttons.find('.o_datepicker_input[name="date_to"]');if(date_from.length>0){error=date_from.val()===""||date_to.val()==="";self.report_options.date.date_from=field_utils.parse.date(date_from.val());self.report_options.date.date_to=field_utils.parse.date(date_to.val());}
else{error=date_to.val()==="";self.report_options.date.date_to=field_utils.parse.date(date_to.val());}}
if(error){new WarningDialog(self,{title:_t("Odoo Warning"),},{message:_t("Date cannot be empty")}).open();}else{self.reload();}});this.$searchview_buttons.find('.js_account_report_bool_filter').click(function(event){var option_value=$(this).data('filter');self.report_options[option_value]=!self.report_options[option_value];if(option_value==='unfold_all'){self.unfold_all(self.report_options[option_value]);}
self.reload();});$('.js_account_report_group_choice_filter',this.$searchview_buttons).click(function(){var option_value=$(this).data('filter');var option_member_ids=$(this).data('member-ids')||[];var is_selected=$(this).hasClass('selected');_.each(self.report_options[option_value],function(el){el.selected=!is_selected&&(option_member_ids.indexOf(Number(el.id))>-1);});self.reload();});this.$searchview_buttons.find('.js_account_report_choice_filter').click(function(event){var option_value=$(this).data('filter');var option_id=$(this).data('id');_.filter(self.report_options[option_value],function(el){if(''+el.id==''+option_id){if(el.selected===undefined||el.selected===null){el.selected=false;}
el.selected=!el.selected;}else if(option_value==='ir_filters'){el.selected=false;}
return el;});self.reload();});var rate_handler=function(event){var option_value=$(this).data('filter');if(option_value=='current_currency'){delete self.report_options.currency_rates;}else if(option_value=='custom_currency'){_.each($('input.js_account_report_custom_currency_input'),function(input){self.report_options.currency_rates[input.name].rate=input.value;});}
self.reload();}
$(document).on('click','.js_account_report_custom_currency',rate_handler);this.$searchview_buttons.find('.js_account_report_custom_currency').click(rate_handler);this.$searchview_buttons.find('.js_account_reports_one_choice_filter').click(function(event){self.report_options[$(this).data('filter')]=$(this).data('id');self.reload();});this.$searchview_buttons.find('.js_account_report_date_cmp_filter').click(function(event){self.report_options.comparison.filter=$(this).data('filter');var error=false;var number_period=$(this).parent().find('input[name="periods_number"]');self.report_options.comparison.number_period=(number_period.length>0)?parseInt(number_period.val()):1;if($(this).data('filter')==='custom'){var date_from=self.$searchview_buttons.find('.o_datepicker_input[name="date_from_cmp"]');var date_to=self.$searchview_buttons.find('.o_datepicker_input[name="date_to_cmp"]');if(date_from.length>0){error=date_from.val()===""||date_to.val()==="";self.report_options.comparison.date_from=field_utils.parse.date(date_from.val());self.report_options.comparison.date_to=field_utils.parse.date(date_to.val());}
else{error=date_to.val()==="";self.report_options.comparison.date_to=field_utils.parse.date(date_to.val());}}
if(error){new WarningDialog(self,{title:_t("Odoo Warning"),},{message:_t("Date cannot be empty")}).open();}else{self.reload();}});if(this.report_options.partner){if(!this.M2MFilters){var fields={};if('partner_ids'in this.report_options){fields['partner_ids']={label:_t('Partners'),modelName:'res.partner',value:this.report_options.partner_ids.map(Number),};}
if('partner_categories'in this.report_options){fields['partner_categories']={label:_t('Tags'),modelName:'res.partner.category',value:this.report_options.partner_categories.map(Number),};}
if(!_.isEmpty(fields)){this.M2MFilters=new M2MFilters(this,fields);this.M2MFilters.appendTo(this.$searchview_buttons.find('.js_account_partner_m2m'));}}else{this.$searchview_buttons.find('.js_account_partner_m2m').append(this.M2MFilters.$el);}}
if(this.report_options.analytic){if(!this.M2MFilters){var fields={};if(this.report_options.analytic_accounts){fields['analytic_accounts']={label:_t('Accounts'),modelName:'account.analytic.account',value:this.report_options.analytic_accounts.map(Number),};}
if(this.report_options.analytic_tags){fields['analytic_tags']={label:_t('Tags'),modelName:'account.analytic.tag',value:this.report_options.analytic_tags.map(Number),};}
if(!_.isEmpty(fields)){this.M2MFilters=new M2MFilters(this,fields);this.M2MFilters.appendTo(this.$searchview_buttons.find('.js_account_analytic_m2m'));}}else{this.$searchview_buttons.find('.js_account_analytic_m2m').append(this.M2MFilters.$el);}}},format_date:function(moment_date){var date_format='YYYY-MM-DD';return moment_date.format(date_format);},renderButtons:function(){var self=this;this.$buttons=$(QWeb.render("accountReports.buttons",{buttons:this.buttons}));_.each(this.$buttons.siblings('button'),function(el){$(el).click(function(){self.$buttons.attr('disabled',true);return self._rpc({model:self.report_model,method:$(el).attr('action'),args:[self.financial_id,self.report_options],context:self.odoo_context,}).then(function(result){var doActionProm=self.do_action(result);self.$buttons.attr('disabled',false);return doActionProm;}).guardedCatch(function(){self.$buttons.attr('disabled',false);});});});return this.$buttons;},edit_summary:function(e){var $textarea=$(e.target).parents('.o_account_reports_body').find('textarea[name="summary"]');var height=Math.max($(e.target).parents('.o_account_reports_body').find('.o_account_report_summary').height(),100);var text=$textarea.val().replace(new RegExp('<br />','g'),'\n');$textarea.height(height);$textarea.val(text);$(e.target).parents('.o_account_reports_body').find('.o_account_reports_summary_edit').show();$(e.target).parents('.o_account_reports_body').find('.o_account_reports_summary').hide();$(e.target).parents('.o_account_reports_body').find('textarea[name="summary"]').focus();},save_summary:function(e){var self=this;var text=$(e.target).siblings().val().replace(/[ \t]+/g,' ');return this._rpc({model:'account.report.manager',method:'write',args:[this.report_manager_id,{summary:text}],context:this.odoo_context,}).then(function(result){self.$el.find('.o_account_reports_summary_edit').hide();self.$el.find('.o_account_reports_summary').show();if(!text){var $content=$("<input type='text' class='o_input' name='summary'/>");$content.attr('placeholder',_t('Add a note'));}else{var $content=$('<span />').text(text).html(function(i,value){return value.replace(/\n/g,'<br>');});}
return $(e.target).parent().siblings('.o_account_reports_summary').find('> .o_account_report_summary').html($content);});},render_footnotes:function(){var self=this;var $dom_footnotes=self.$el.find('.js_account_report_line_footnote:not(.folded)');$dom_footnotes.html('');var number=1;var footnote_to_render=[];_.each($dom_footnotes,function(el){if($(el).parents('.o_account_reports_filtered_lines').length>0){return;}
var line_id=$(el).data('id');var footnote=_.filter(self.footnotes,function(footnote){return''+footnote.line===''+line_id;});if(footnote.length!==0){$(el).html('<sup><b class="o_account_reports_footnote_sup"><a href="#footnote'+number+'">'+number+'</a></b></sup>');footnote[0].number=number;number+=1;footnote_to_render.push(footnote[0]);}});return this._rpc({model:this.report_model,method:'get_html_footnotes',args:[self.financial_id,footnote_to_render],context:self.odoo_context,}).then(function(result){return self.$el.find('.js_account_report_footnotes').html(result);});},add_edit_footnote:function(e){var self=this;var line_id=$(e.target).data('id');var existing_footnote=_.filter(self.footnotes,function(footnote){return''+footnote.line===''+line_id;});var text='';if(existing_footnote.length!==0){text=existing_footnote[0].text;}
var $content=$(QWeb.render('accountReports.footnote_dialog',{text:text,line:line_id}));var save=function(){var footnote_text=$('.js_account_reports_footnote_note').val().replace(/[ \t]+/g,' ');if(!footnote_text&&existing_footnote.length===0){return;}
if(existing_footnote.length!==0){if(!footnote_text){return self.$el.find('.footnote[data-id="'+existing_footnote[0].id+'"] .o_account_reports_footnote_icons').click();}
return this._rpc({model:'account.report.footnote',method:'write',args:[existing_footnote[0].id,{text:footnote_text}],context:this.odoo_context,}).then(function(result){_.each(self.footnotes,function(footnote){if(footnote.id===existing_footnote[0].id){footnote.text=footnote_text;}});return self.render_footnotes();});}
else{return this._rpc({model:'account.report.footnote',method:'create',args:[{line:line_id,text:footnote_text,manager_id:self.report_manager_id}],context:this.odoo_context,}).then(function(result){self.footnotes.push({id:result,line:line_id,text:footnote_text});return self.render_footnotes();});}};new Dialog(this,{title:'Annotate',size:'medium',$content:$content,buttons:[{text:'Save',classes:'btn-primary',close:true,click:save},{text:'Cancel',close:true}]}).open();},delete_footnote:function(e){var self=this;var footnote_id=$(e.target).parents('.footnote').data('id');return this._rpc({model:'account.report.footnote',method:'unlink',args:[footnote_id],context:this.odoo_context,}).then(function(result){self.footnotes=_.filter(self.footnotes,function(element){return element.id!==footnote_id;});return self.render_footnotes();});},fold_unfold:function(e){var self=this;if($(e.target).hasClass('caret')||$(e.target).parents('.o_account_reports_footnote_sup').length>0){return;}
e.stopPropagation();e.preventDefault();var line=$(e.target).parents('td');if(line.length===0){line=$(e.target);}
var method=line[0].dataset.unfolded==='True'?this.fold(line):this.unfold(line);Promise.resolve(method).then(function(){self.render_footnotes();self.persist_options();});},fold:function(line){var self=this;var line_id=line.data('id');line.find('.fa-caret-down').toggleClass('fa-caret-right fa-caret-down');line.toggleClass('folded');$(line).parent('tr').removeClass('o_js_account_report_parent_row_unfolded');var $lines_to_hide=this.$el.find('tr[data-parent-id="'+line_id+'"]');var index=self.report_options.unfolded_lines.indexOf(line_id);if(index>-1){self.report_options.unfolded_lines.splice(index,1);}
if($lines_to_hide.length>0){line[0].dataset.unfolded='False';$lines_to_hide.find('.js_account_report_line_footnote').addClass('folded');$lines_to_hide.hide();_.each($lines_to_hide,function(el){var child=$(el).find('[data-id]:first');if(child){self.fold(child);}})}
return false;},unfold:function(line){var self=this;var line_id=line.data('id');line.toggleClass('folded');self.report_options.unfolded_lines.push(line_id);var $lines_in_dom=this.$el.find('tr[data-parent-id="'+line_id+'"]');if($lines_in_dom.length>0){$lines_in_dom.find('.js_account_report_line_footnote').removeClass('folded');$lines_in_dom.show();line.find('.fa-caret-right').toggleClass('fa-caret-right fa-caret-down');line[0].dataset.unfolded='True';this._add_line_classes();return true;}
else{return this._rpc({model:this.report_model,method:'get_html',args:[self.financial_id,self.report_options,line.data('id')],context:self.odoo_context,}).then(function(result){$(line).parent('tr').replaceWith(result);self._add_line_classes();});}},load_more:function(ev){var $line=$(ev.target).parents('td');var id=$line.data('id');var offset=$line.data('offset')||0;var progress=$line.data('progress')||0;var remaining=$line.data('remaining')||0;var options=_.extend({},this.report_options,{lines_offset:offset,lines_progress:progress,lines_remaining:remaining});var self=this;this._rpc({model:this.report_model,method:'get_html',args:[this.financial_id,options,id],context:this.odoo_context,}).then(function(result){var $tr=$line.parents('.o_account_reports_load_more');$tr.after(result);$tr.remove();self._add_line_classes();});},unfold_all:function(bool){var self=this;var lines=this.$el.find('.js_account_report_foldable');self.report_options.unfolded_lines=[];if(bool){_.each(lines,function(el){self.report_options.unfolded_lines.push($(el).data('id'));});}},trigger_action:function(e){e.stopPropagation();var self=this;var action=$(e.target).attr('action');var id=$(e.target).parents('td').data('id');var params=$(e.target).data();var context=new Context(this.odoo_context,params.actionContext||{},{active_id:id});params=_.omit(params,'actionContext');if(action){return this._rpc({model:this.report_model,method:action,args:[this.financial_id,this.report_options,params],context:context.eval(),}).then(function(result){return self.do_action(result);});}},_onClickDropDownMenu:function(ev){ev.stopPropagation();},});core.action_registry.add('account_report',accountReportsWidget);return accountReportsWidget;});;

/* /account_reports/static/src/js/action_manager_account_report_dl.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account_reports.ActionManager',function(require){"use strict";var ActionManager=require('web.ActionManager');var framework=require('web.framework');var session=require('web.session');ActionManager.include({_executeAccountReportDownloadAction:function(action){var self=this;framework.blockUI();return new Promise(function(resolve,reject){session.get_file({url:'/account_reports',data:action.data,success:resolve,error:(error)=>{self.call('crash_manager','rpc_error',error);reject();},complete:framework.unblockUI,});});},_handleAction:function(action,options){if(action.type==='ir_actions_account_report_download'){return this._executeAccountReportDownloadAction(action,options);}
return this._super.apply(this,arguments);},});});;

/* /account_yodlee/static/src/js/yodlee.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account_yodlee.acc_config_widget',function(require){"use strict";var AbstractAction=require('web.AbstractAction');var core=require('web.core');var QWeb=core.qweb;var YodleeAccountConfigurationWidget=AbstractAction.extend({template:'YodleeTemplate',init:function(parent,context){this._super(parent,context);this.userToken=context.userToken;this.fastlinkUrl=context.fastlinkUrl;this.accessTokens=context.accessTokens;this.beta=context.beta;this.state=context.state;this.callbackUrl=context.paramsUrl+
document.location.protocol+'//'+document.location.host+context.callbackUrl;},renderButtons:function($node){var self=this;if(this.userToken!==undefined){this.$buttons=$(QWeb.render("YodleeTemplateFooter",{'widget':this}));this.$buttons.find('.js_yodlee_continue').click(function(e){self.$('#yodleeForm').submit();});if($node){this.$buttons.appendTo($node);}}},});var YodleeCallbackWidget=AbstractAction.extend({init:function(parent,context){this._super(parent,context);},willStart:function(){var self=this;var paramsUrl=$.bbq.getState();self.method=paramsUrl.state;var def=this._rpc({model:'account.online.provider',method:'callback_institution',args:[[],paramsUrl.provider_identifier,paramsUrl.state,paramsUrl.journal_id]}).then(function(result){self.do_action(result);});return Promise.all([this._super.apply(this,arguments),def]);},});core.action_registry.add('yodlee_online_sync_widget',YodleeAccountConfigurationWidget);core.action_registry.add('yodlee_callback_widget',YodleeCallbackWidget);});;

/* /crm_iap_lead/static/src/js/leads_tree_generate_leads.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('crm.leads.tree',function(require){"use strict";var ListController=require('web.ListController');var ListView=require('web.ListView');var KanbanController=require('web.KanbanController');var KanbanView=require('crm.crm_kanban').CrmKanbanView;var viewRegistry=require('web.view_registry');function renderGenerateLeadsButton(){if(this.$buttons){var self=this;var lead_type=self.initialState.getContext()['default_type'];this.$buttons.on('click','.o_button_generate_leads',function(){self.do_action({name:'Generate Leads',type:'ir.actions.act_window',res_model:'crm.iap.lead.mining.request',target:'new',views:[[false,'form']],context:{'is_modal':true,'default_lead_type':lead_type},});});}}
var LeadMiningRequestListController=ListController.extend({willStart:function(){var self=this;var ready=this.getSession().user_has_group('sales_team.group_sale_manager').then(function(is_sale_manager){if(is_sale_manager){self.buttons_template='LeadMiningRequestListView.buttons';}});return Promise.all([this._super.apply(this,arguments),ready]);},renderButtons:function(){this._super.apply(this,arguments);renderGenerateLeadsButton.apply(this,arguments);}});var LeadMiningRequestListView=ListView.extend({config:_.extend({},ListView.prototype.config,{Controller:LeadMiningRequestListController,}),});var LeadMiningRequestKanbanController=KanbanController.extend({willStart:function(){var self=this;var ready=this.getSession().user_has_group('sales_team.group_sale_manager').then(function(is_sale_manager){if(is_sale_manager){self.buttons_template='LeadMiningRequestKanbanView.buttons';}});return Promise.all([this._super.apply(this,arguments),ready]);},renderButtons:function(){this._super.apply(this,arguments);renderGenerateLeadsButton.apply(this,arguments);}});var LeadMiningRequestKanbanView=KanbanView.extend({config:_.extend({},KanbanView.prototype.config,{Controller:LeadMiningRequestKanbanController,}),});viewRegistry.add('crm_iap_lead_mining_request_tree',LeadMiningRequestListView);viewRegistry.add('crm_iap_lead_mining_request_kanban',LeadMiningRequestKanbanView);});;

/* /crm_iap_lead/static/src/js/tours/crm_iap_lead.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('crm_iap_lead.generate_leads_steps',function(require){"use strict";var tour=require('web_tour.tour');var core=require('web.core');require('crm.tour');var _t=core._t;var DragOppToWonStepIndex=_.findIndex(tour.tours.crm_tour.steps,function(step){return(step.id==='drag_opportunity_to_won_step');});tour.tours.crm_tour.steps.splice(DragOppToWonStepIndex+1,0,{trigger:".o_button_generate_leads",content:_t("Looking for more opportunities ?<br>Try the <b>Lead Generation</b> tool."),position:"bottom",run:function(actions){actions.auto('.o_button_generate_leads');},},{trigger:'.modal-body .o_industry',content:_t("Which Industry do you want to target?"),position:"right",},{trigger:'.modal-footer button[name=action_submit]',content:_t("Now, just let the magic happen!"),position:"bottom",run:function(actions){actions.auto('.modal-footer button[special=cancel]');}});});;

/* /point_of_sale/static/src/js/tours/point_of_sale.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('point_of_sale.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('point_of_sale_tour',{url:"/web",rainbowMan:false,},[tour.stepUtils.showAppsMenuItem(),{trigger:'.o_app[data-menu-xmlid="point_of_sale.menu_point_root"]',content:_t("Ready to launch your <b>point of sale</b>?"),width:215,position:'right',edition:'community'},{trigger:'.o_app[data-menu-xmlid="point_of_sale.menu_point_root"]',content:_t("Ready to launch your <b>point of sale</b>?"),width:215,position:'bottom',edition:'enterprise'},{trigger:".o_pos_kanban button.oe_kanban_action_button",content:_t("<p>Ready to have a look at the <b>POS Interface</b>? Let's start our first session.</p>"),position:"bottom"}]);});;

/* /point_of_sale/static/src/js/debug_manager.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('point_of_sale.DebugManager.Backend',function(require){'use strict';const{_t}=require('web.core');const DebugManager=require('web.DebugManager.Backend');DebugManager.include({perform_pos_js_tests(){this.do_action({name:_t('JS Tests'),target:'new',type:'ir.actions.act_url',url:'/pos/ui/tests?mod=*',});},});});;

/* /project_timesheet_forecast/static/src/js/forecast_timesheet_gantt.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('forecast_timesheet.ForecastTimesheetGanttView',function(require){'use strict';const viewRegistry=require('web.view_registry');const ForecastGanttView=require('forecast.ForecastGanttView');const PlanningGanttRenderer=require('planning.PlanningGanttRenderer');const PlanningGanttRow=require('planning.PlanningGanttRow');const ForecastTimesheetGanttRow=PlanningGanttRow.extend({template:'PlanningTimesheetGanttView.Row',init(parent,pillsInfo,viewInfo,options){this._super(...arguments);if(this.pills){this.pills.forEach((pill)=>{if(pill.task_id&&pill.allocated_hours){pill.progress=Math.round(pill.effective_hours/pill.allocated_hours*100);}else{pill.progress=0;}});}},});const ForecastTimesheetGanttRenderer=PlanningGanttRenderer.extend({config:Object.assign({},PlanningGanttRenderer.prototype.config,{GanttRow:ForecastTimesheetGanttRow,}),});const ForecastTimesheetGanttView=ForecastGanttView.extend({config:Object.assign({},ForecastGanttView.prototype.config,{Renderer:ForecastTimesheetGanttRenderer,}),});viewRegistry.add('forecast_timesheet',ForecastTimesheetGanttView);return ForecastTimesheetGanttView;});;

/* /project_timesheet_synchro/static/src/js/timesheet_app_backend.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('projcet_timesheet_synchro.app',function(require){'use strict';var AbstractAction=require('web.AbstractAction');var config=require('web.config');var core=require('web.core');var IFrameWidget=require('web.IFrameWidget');var project_timesheet_synchro_demo=AbstractAction.extend({contentTemplate:'project_timesheet_synchro.demo',start:function(){var def;if(config.device.size_class>=config.device.SIZES.MD){var app=new project_timesheet_synchro_app();def=app.appendTo(this.$('.o_project_timesheet_app'));}
return Promise.all([def,this._super.apply(this,arguments)]);},});var project_timesheet_synchro_app=IFrameWidget.extend({init:function(parent){this._super(parent,'/project_timesheet_synchro/timesheet_app');},start:function(){var res=this._super.apply(this,arguments);this.$el.css({height:'582px',width:'330px',border:0});return res;},});core.action_registry.add('project_timesheet_synchro_app_action',project_timesheet_synchro_demo);});;

/* /purchase_stock/static/src/js/tours/purchase_stock.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('purchase_stock.purchase_steps',function(require){"use strict";var core=require('web.core');var _t=core._t;var PurchaseAdditionalTourSteps=require('purchase.purchase_steps');PurchaseAdditionalTourSteps.include({init:function(){this._super.apply(this,arguments);},_get_purchase_stock_steps:function(){this._super.apply(this,arguments);return[{trigger:".oe_button_box button[name='action_view_picking']",extra_trigger:".oe_button_box button[name='action_view_picking']",content:_t("Receive the ordered products."),position:"bottom",run:'click',},{trigger:".o_statusbar_buttons button[name='button_validate']",content:_t("Validate the receipt of all ordered products."),position:"bottom",run:'click',},{trigger:".modal-footer .btn-primary",extra_trigger:".modal-dialog",content:_t("Process all the receipt quantities."),position:"bottom",},{trigger:".o_back_button a, .breadcrumb-item:not('.active'):last",content:_t('Go back to the purchase order to generate the vendor bill.'),position:'bottom',},{trigger:".o_statusbar_buttons button[name='action_create_invoice']",content:_t("Generate the draft vendor bill."),position:"bottom",run:'click',}];}});return PurchaseAdditionalTourSteps;});;

/* /sale/static/src/js/sale.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sale.sales_team_dashboard',function(require){"use strict";var core=require('web.core');var KanbanRecord=require('web.KanbanRecord');var _t=core._t;KanbanRecord.include({events:_.defaults({'click .sales_team_target_definition':'_onSalesTeamTargetClick',},KanbanRecord.prototype.events),_onSalesTeamTargetClick:function(ev){ev.preventDefault();var self=this;this.$target_input=$('<input>');this.$('.o_kanban_primary_bottom:last').html(this.$target_input);this.$('.o_kanban_primary_bottom:last').prepend(_t("Set an invoicing target: "));this.$target_input.focus();this.$target_input.on({blur:this._onSalesTeamTargetSet.bind(this),keydown:function(ev){if(ev.keyCode===$.ui.keyCode.ENTER){self._onSalesTeamTargetSet();}},});},_onSalesTeamTargetSet:function(){var self=this;var value=Number(this.$target_input.val());if(isNaN(value)){this.do_warn(false,_t("Please enter an integer value"));}else{this.trigger_up('kanban_record_update',{invoiced_target:value,onSuccess:function(){self.trigger_up('reload');},});}},});});;

/* /sale/static/src/js/tours/sale.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sale.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register("sale_tour",{url:"/web",rainbowMan:false,},[tour.stepUtils.showAppsMenuItem(),{trigger:".o_app[data-menu-xmlid='sale.sale_menu_root']",content:_t("Open Sales app to send your first quotation in a few clicks."),position:"right",edition:"community"},{trigger:".o_app[data-menu-xmlid='sale.sale_menu_root']",content:_t("Open Sales app to send your first quotation in a few clicks."),position:"bottom",edition:"enterprise"},{trigger:'a.o_onboarding_step_action.btn[data-method=action_open_base_onboarding_company]',extra_trigger:".o_sale_order",content:_t("Start by checking your company's data."),position:"bottom",},{trigger:".modal-content button[name='action_save_onboarding_company_step']",content:_t("Looks good. Let's continue."),position:"bottom",},{trigger:'a.o_onboarding_step_action.btn[data-method=action_open_base_document_layout]',extra_trigger:".o_sale_order",content:_t("Customize your quotes and orders."),position:"bottom",},{trigger:"button[name='document_layout_save']",extra_trigger:".o_sale_order",content:_t("Good job, let's continue."),position:"bottom",},{trigger:'a.o_onboarding_step_action.btn[data-method=action_open_sale_onboarding_payment_acquirer]',extra_trigger:".o_sale_order",content:_t("To speed up order confirmation, we can activate electronic signatures or payments."),position:"bottom",},{trigger:"button[name='add_payment_methods']",extra_trigger:".o_sale_order",content:_t("Lets keep electronic signature for now."),position:"bottom",},{trigger:'a.o_onboarding_step_action.btn[data-method=action_open_sale_onboarding_sample_quotation]',extra_trigger:".o_sale_order",content:_t("Now, we'll create a sample quote."),position:"bottom",}]);tour.register("sale_quote_tour",{url:"/web#action=sale.action_quotations_with_onboarding&view_type=form",rainbowMan:true,rainbowManMessage:"<b>Congratulations</b>, your first quotation is sent!<br>Check your email to validate the quote."},[{trigger:".o_form_editable .o_field_many2one[name='partner_id']",extra_trigger:".o_sale_order",content:_t("Write a company name to create one, or see suggestions."),position:"bottom",run:function(actions){actions.text("Agrolait",this.$anchor.find("input"));},},{trigger:".ui-menu-item > a",auto:true,in_modal:false,},{trigger:".o_field_x2many_list_row_add > a",extra_trigger:".o_field_many2one[name='partner_id'] .o_external_button",content:_t("Click here to add some products or services to your quotation."),position:"bottom",},{trigger:".o_field_widget[name='product_id'], .o_field_widget[name='product_template_id']",extra_trigger:".o_sale_order",content:_t("Select a product, or create a new one on the fly."),position:"right",run:function(actions){var $input=this.$anchor.find("input");actions.text("DESK0001",$input.length===0?this.$anchor:$input);var keyDownEvent=jQuery.Event("keydown");keyDownEvent.which=42;this.$anchor.trigger(keyDownEvent);var $descriptionElement=$(".o_form_editable textarea[name='name']");$descriptionElement.change(function(){$descriptionElement.addClass("product_creation_success");});},id:"product_selection_step"},{trigger:".ui-menu.ui-widget .ui-menu-item a:contains('DESK0001')",auto:true,},{trigger:".o_form_editable textarea[name='name'].product_creation_success",auto:true,run:function(){}},{trigger:".o_field_widget[name='price_unit'] ",extra_trigger:".o_sale_order",content:_t("<b>Set a price</b>."),position:"right",run:"text 10.0"},...tour.stepUtils.statusbarButtonsSteps("Send by Email",_t("<b>Send the quote</b> to yourself and check what the customer will receive."),".o_statusbar_buttons button[name='action_quotation_send']"),{trigger:".modal-content div[name='partner_ids']",content:_t("Write <b>your own email address</b> here in order to test the flow."),run:"text agrolait@example.com"},{trigger:".modal-footer button.btn-primary",auto:true,},{trigger:".modal-footer button[name='action_send_mail']",extra_trigger:".modal-footer button[name='action_send_mail']",content:_t("Let's send the quote."),position:"bottom",}]);});;

/* /sale/static/src/js/product_configurator_widget.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sale.product_configurator',function(require){var relationalFields=require('web.relational_fields');var FieldsRegistry=require('web.field_registry');var core=require('web.core');var _t=core._t;var ProductConfiguratorWidget=relationalFields.FieldMany2One.extend({events:_.extend({},relationalFields.FieldMany2One.prototype.events,{'click .o_edit_product_configuration':'_onEditConfiguration'}),_render:function(){this._super.apply(this,arguments);if(this.mode==='edit'&&this.value&&(this._isConfigurableProduct()||this._isConfigurableLine())){this._addProductLinkButton();this._addConfigurationEditButton();}else if(this.mode==='edit'&&this.value){this._addProductLinkButton();this.$('.o_edit_product_configuration').hide();}else{this.$('.o_external_button').hide();this.$('.o_edit_product_configuration').hide();}},_addProductLinkButton:function(){if(this.$('.o_external_button').length===0){var $productLinkButton=$('<button>',{type:'button',class:'fa fa-external-link btn btn-secondary o_external_button',tabindex:'-1',draggable:false,'aria-label':_t('External Link'),title:_t('External Link')});var $inputDropdown=this.$('.o_input_dropdown');$inputDropdown.after($productLinkButton);}},_addConfigurationEditButton:function(){var $inputDropdown=this.$('.o_input_dropdown');if($inputDropdown.length!==0&&this.$('.o_edit_product_configuration').length===0){var $editConfigurationButton=$('<button>',{type:'button',class:'fa fa-pencil btn btn-secondary o_edit_product_configuration',tabindex:'-1',draggable:false,'aria-label':_t('Edit Configuration'),title:_t('Edit Configuration')});$inputDropdown.after($editConfigurationButton);}},_isConfigurableProduct:function(){return false;},_isConfigurableLine:function(){return false;},reset:async function(record,ev){await this._super(...arguments);if(ev&&ev.target===this){if(ev.data.changes&&!ev.data.preventProductIdCheck&&ev.data.changes.product_template_id){this._onTemplateChange(record.data.product_template_id.data.id,ev.data.dataPointID);}else if(ev.data.changes&&ev.data.changes.product_id){this._onProductChange(record.data.product_id.data.id,ev.data.dataPointID).then(wizardOpened=>{if(!wizardOpened){this._onLineConfigured();}});}}},_onTemplateChange:function(productTemplateId,dataPointId){return Promise.resolve(false);},_onProductChange:function(productId,dataPointId){return Promise.resolve(false);},_onLineConfigured:function(){},_onEditConfiguration:function(){if(this._isConfigurableLine()){this._onEditLineConfiguration();}else if(this._isConfigurableProduct()){this._onEditProductConfiguration();}},_onEditLineConfiguration:function(){},_onEditProductConfiguration:function(){},_convertFromMany2Many:function(recordData){if(recordData){var convertedValues=[];_.each(recordData.res_ids,function(resId){convertedValues.push([4,parseInt(resId)]);});return convertedValues;}
return null;},_convertFromOne2Many:function(recordData){if(recordData){var convertedValues=[];_.each(recordData.res_ids,function(resId){if(isNaN(resId)){_.each(recordData.data,function(record){if(record.ref===resId){convertedValues.push([0,0,{custom_product_template_attribute_value_id:record.data.custom_product_template_attribute_value_id.data.id,custom_value:record.data.custom_value}]);}});}else{convertedValues.push([4,resId]);}});return convertedValues;}
return null;}});FieldsRegistry.add('product_configurator',ProductConfiguratorWidget);return ProductConfiguratorWidget;});;

/* /sale/static/src/js/sale_order_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sale.SaleOrderView',function(require){"use strict";const FormController=require('web.FormController');const FormView=require('web.FormView');const viewRegistry=require('web.view_registry');const Dialog=require('web.Dialog');const core=require('web.core');const _t=core._t;const SaleOrderFormController=FormController.extend({custom_events:_.extend({},FormController.prototype.custom_events,{open_discount_wizard:'_onOpenDiscountWizard',}),_onOpenDiscountWizard(ev){const orderLines=this.renderer.state.data.order_line.data;const recordData=ev.target.recordData;const isEqualDiscount=orderLines.slice(1).every(line=>line.data.discount===recordData.discount);if(orderLines.length>=3&&recordData.sequence===orderLines[0].data.sequence&&isEqualDiscount){Dialog.confirm(this,_t("Do you want to apply this discount to all order lines?"),{confirm_callback:()=>{orderLines.slice(1).forEach((line)=>{this.trigger_up('field_changed',{dataPointID:this.renderer.state.id,changes:{order_line:{operation:"UPDATE",id:line.id,data:{discount:orderLines[0].data.discount}}},});});},});}},});const SaleOrderView=FormView.extend({config:_.extend({},FormView.prototype.config,{Controller:SaleOrderFormController,}),});viewRegistry.add('sale_discount_form',SaleOrderView);return SaleOrderView;});;

/* /sale/static/src/js/product_discount_widget.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sale.product_discount',function(require){"use strict";const BasicFields=require('web.basic_fields');const FieldsRegistry=require('web.field_registry');const ProductDiscountWidget=BasicFields.FieldFloat.extend({async reset(record,ev){if(ev&&ev.data.changes&&ev.data.changes.discount>=0){this.trigger_up('open_discount_wizard');}
this._super(...arguments);},});FieldsRegistry.add('product_discount',ProductDiscountWidget);return ProductDiscountWidget;});;

/* /timesheet_grid/static/src/js/timesheet_uom.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('timesheet_grid.timesheet_uom',function(require){'use strict';const gridComponentRegistry=require('web_grid.component_registry');const gridComponent=require('web_grid.components');const session=require('web.session');class FloatFactorComponentTimesheet extends gridComponent.FloatFactorComponent{get fieldOptions(){const fieldOptions=Object.assign({},this.props.nodeOptions);if(this.env.session.timesheet_uom_factor){fieldOptions.factor=this.env.session.timesheet_uom_factor;}
return fieldOptions;}}
class FloatToggleComponentTimesheet extends gridComponent.FloatToggleComponent{get fieldOptions(){const fieldOptions=Object.assign({},this.props.nodeOptions);if(this.env.session.timesheet_uom_factor){fieldOptions.factor=this.env.session.timesheet_uom_factor;}
const hasRange=Object.keys(this.props.nodeOptions||{}).includes('range');if(!hasRange){fieldOptions.range=[0.00,0.50,1.00];}
return fieldOptions;}}
const ComponentName='timesheet_uom'in session?session.timesheet_uom.timesheet_widget:'float_factor';let FieldTimesheetUom;if(ComponentName==="float_toggle"){FieldTimesheetUom=FloatToggleComponentTimesheet;}else if(ComponentName==="float_factor"){FieldTimesheetUom=FloatFactorComponentTimesheet;}else{FieldTimesheetUom=(gridComponentRegistry.get(ComponentName)||FloatFactorComponentTimesheet);}
gridComponentRegistry.add('timesheet_uom',FieldTimesheetUom);return FieldTimesheetUom;});;

/* /timesheet_grid/static/src/js/timesheet_uom_timer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('thimesheet_grid.timesheet_uom_timer',function(require){"use strict";const fieldRegistry=require('web.field_registry');const fieldUtils=require('web.field_utils');const TimesheetUom=require('hr_timesheet.timesheet_uom');const{_lt}=require('web.core');const session=require('web.session');const Timer=require('timer.Timer');const FieldTimesheetTimeTimer=TimesheetUom.FieldTimesheetTime.extend({init:function(){this._super.apply(this,arguments);this.isTimerRunning=this.record.data.is_timer_running;this.rendererIsSample=arguments[0].state.isSample;},willstart(){const timePromise=this._rpc({model:'timer.timer',method:'get_server_time',args:[]}).then((time)=>{this.serverTime=time;});return Promise.all([this._super(...arguments),timePromise,]);},_render:async function(){await this._super.apply(this,arguments);const my_timesheets=this.record.getContext().my_timesheet_display_timer;const display_timer=this.record.data.display_timer;if(my_timesheets&&display_timer&&this.record.viewType==='list'){const title=this.isTimerRunning?_lt('Stop'):_lt('Play');const name=this.isTimerRunning?'action_timer_stop':'action_timer_start';const label=this.isTimerRunning?_lt('Stop'):_lt('Start');const button=$('<button>',{'class':'o_icon_button o-timer-button mr8','title':title,'name':name,'aria-label':label,'aria-pressed':this.isTimerRunning,'type':'button','role':'button',});button.html('<i/>');button.find('i').addClass('fa').toggleClass('fa-stop-circle o-timer-stop-button',this.isTimerRunning).toggleClass('fa-play-circle o-timer-play-button',!this.isTimerRunning).attr('title',title);button.on('click',this._onToggleButton.bind(this));this.$el.prepend(button);}
if(this.recordData.timer_start&&!this.recordData.timer_pause&&!this.rendererIsSample){this.time=Timer.createTimer(this.recordData.unit_amount,this.recordData.timer_start,this.serverTime);this._startTimeCounter();}},_onToggleButton:async function(event){const context=this.record.getContext();event.stopPropagation();const result=await this._rpc({model:this.model,method:this._getActionButton(),context:context,args:[this.res_id]});this.trigger_up('field_changed',{dataPointID:this.dataPointID,changes:{'is_timer_running':!this.isTimerRunning,},});this.trigger_up('timer_changed',{id:this.res_id,is_timer_running:!this.isTimerRunning});},_getActionButton:function(){return this.isTimerRunning?'action_timer_stop':'action_timer_start';},destroy:function(){clearTimeout(this.timer);this._super.apply(this,arguments);},_startTimeCounter:function(){if(this.time){this.timer=setInterval(()=>{this.time.addSecond();if(this.$el.children().length){this.$el.contents()[1].replaceWith(this.time.toString());}else{this.$el.text(this.time.toString());}
this.$el.addClass('font-weight-bold text-danger');},1000);}else{clearTimeout(this.timer);this.$el.removeClass('font-weight-bold text-danger');}},});const widgetName='timesheet_uom'in session?session.timesheet_uom.timesheet_widget:'float_factor';let FieldTimesheetUom=null;if(widgetName==='float_toggle'){FieldTimesheetUom=TimesheetUom.FieldTimesheetToggle;}else if(widgetName==='float_time'){FieldTimesheetUom=FieldTimesheetTimeTimer;}else{FieldTimesheetUom=(fieldRegistry.get(widgetName)&&fieldRegistry.get(widgetName).extend({}))||TimesheetUom.FieldTimesheetFactor;}
fieldRegistry.add('timesheet_uom_timer',FieldTimesheetUom);const _tweak_options=function(options){if(!_.contains(options,'factor')){options.factor=session.timesheet_uom_factor;}
return options;};fieldUtils.format.timesheet_uom_timer=function(value,field,options){options=_tweak_options(options||{});const formatter=fieldUtils.format[FieldTimesheetUom.prototype.formatType];return formatter(value,field,options);};fieldUtils.parse.timesheet_uom_timer=function(value,field,options){options=_tweak_options(options||{});const parser=fieldUtils.parse[FieldTimesheetUom.prototype.formatType];return parser(value,field,options);};return{FieldTimesheetTimeTimer,};});;

/* /timesheet_grid/static/src/js/timesheet_config_mixin.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('timesheet_grid.TimesheetConfigQRCodeMixin',function(require){"use strict";const TimesheetConfigQRCodeMixin={_bindPlayStoreIcon(){const playStore=this.el.querySelector('.o_config_play_store');const appStore=this.el.querySelector('.o_config_app_store');if(playStore){playStore.onclick=this._onClickAppStoreIcon.bind(this);}
if(appStore){appStore.onclick=this._onClickAppStoreIcon.bind(this);}},_onClickAppStoreIcon(ev){ev.preventDefault();const googleUrl="https://play.google.com/store/apps/details?id=com.odoo.OdooTimesheets";const appleUrl="https://apps.apple.com/be/app/awesome-timesheet/id1078657549";const url=ev.target.classList.contains("o_config_play_store")?googleUrl:appleUrl;if(!this.env.device.isMobile){const actionDesktop={name:this.env._t('Download our App'),type:'ir.actions.client',tag:'timesheet_qr_code_modal',target:'new',};this.trigger('do-action',{action:Object.assign(actionDesktop,{params:{'url':url}})});}else{this.trigger('do-action',{action:{type:'ir.actions.act_url',url:url}});}},};return TimesheetConfigQRCodeMixin;});;

/* /timesheet_grid/static/src/js/timesheet_grid/timesheet_grid_model.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('timesheet_grid.GridModel',function(require){"use strict";const{_t}=require('web.core');const GridModel=require('web_grid.GridModel');const TimesheetGridModel=GridModel.extend({async reload(handle,params){if(params&&'groupBy'in params){var GroupBy=params.groupBy.filter(filter=>{return filter.split(':').length===1;});if(GroupBy.length!==params.groupBy.length){this.do_warn(false,_t('Grouping by date is not supported'));}
params.groupBy=GroupBy;}
return this._super(...arguments);},});return TimesheetGridModel;});;

/* /timesheet_grid/static/src/js/timesheet_grid/timesheet_grid_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('timesheet_grid.GridController',function(require){"use strict";const GridController=require('web_grid.GridController');const TimesheetGridController=GridController.extend({renderButtons($node){this._super(...arguments);this.$buttons.on('click','.o_timesheet_validate',this._onValidateButtonClicked.bind(this));},updateButtons(){this._super(...arguments);this.$buttons.find('.o_timesheet_validate').removeClass('grid_arrow_button');},_onValidateButtonClicked(e){e.stopPropagation();return this.mutex.exec(async()=>{const ids=await this.model.getIds();const res=await this._rpc({model:'account.analytic.line',method:'action_validate_timesheet',args:[ids],});this.displayNotification({type:res.status,title:res.message});await this.model.reload();var state=this.model.get();await this.renderer.update(state);this.updateButtons(state);});},});return TimesheetGridController;});;

/* /timesheet_grid/static/src/js/timesheet_grid/timesheet_grid_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('timesheet_grid.GridRenderer',function(require){"use strict";const{ComponentAdapter}=require('web.OwlCompatibility');const GridRenderer=require('web_grid.GridRenderer');const StandaloneM2OAvatarEmployee=require('hr.StandaloneM2OAvatarEmployee');class StandaloneAvatarEmployeeAdapter extends ComponentAdapter{updateWidget(nextProps){const state=nextProps.value;return this.widget.avatarWidget.reinitialize(state);}}
class TimesheetGridRenderer extends GridRenderer{constructor(parent,props){super(...arguments);this.widgetComponents={StandaloneM2OAvatarEmployee};}
get showEmployeeAvatar(){const empIdGroupIndex=this.props.groupBy.indexOf('employee_id');if(empIdGroupIndex<0){return false;}
if(this.props.isGrouped){const isGroupLabel=this.rowlabel_index===undefined;const isGroupLabelAnEmployee=isGroupLabel&&empIdGroupIndex===0;const isLabelAnEmployee=!isGroupLabel&&empIdGroupIndex===this.label_index+1;return isGroupLabelAnEmployee||isLabelAnEmployee;}
return empIdGroupIndex===this.label_index;}}
TimesheetGridRenderer.components={StandaloneAvatarEmployeeAdapter};return TimesheetGridRenderer;});;

/* /timesheet_grid/static/src/js/timesheet_grid/timesheet_grid_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('timesheet_grid.GridView',function(require){"use strict";const viewRegistry=require('web.view_registry');const WebGridView=require('web_grid.GridView');const TimesheetConfigQRCodeMixin=require('timesheet_grid.TimesheetConfigQRCodeMixin');const TimesheetGridController=require('timesheet_grid.GridController');const TimesheetGridModel=require('timesheet_grid.GridModel');const GridRenderer=require('timesheet_grid.GridRenderer');const{onMounted,onPatched}=owl.hooks;class TimesheetGridRenderer extends GridRenderer{constructor(){super(...arguments);onMounted(()=>this._bindPlayStoreIcon());onPatched(()=>this._bindPlayStoreIcon());}}
Object.assign(TimesheetGridRenderer.prototype,TimesheetConfigQRCodeMixin);const TimesheetGridView=WebGridView.extend({config:Object.assign({},WebGridView.prototype.config,{Model:TimesheetGridModel,Controller:TimesheetGridController,Renderer:TimesheetGridRenderer})});viewRegistry.add('timesheet_grid',TimesheetGridView);return TimesheetGridView;});;

/* /timesheet_grid/static/src/js/timesheet_grid/timesheet_timer_grid_model.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('timesheet_grid.TimerGridModel',function(require){"use strict";const{_t}=require('web.core');const GridModel=require('web_grid.GridModel');const TimerGridModel=GridModel.extend({async actionTimer(state){await this.reload();let i=0;const array=[];while(state.data.hasOwnProperty(i)){array.push(state.data[i]);i+=1;}
i=0;const fields=_.difference(this.rowFields,[this.sectionField]);while(this._gridData.data.hasOwnProperty(i)){array.some((el,index)=>{if(_.isEqual(el.__label,this._gridData.data[i].__label)){state.data[index].cols=this._gridData.data[i].cols;if(this._checkRowsSameOrder(state.data[index].rows,this._gridData.data[i].rows,fields)){state.data[index].grid=this._gridData.data[i].grid;state.data[index].rows=this._gridData.data[i].rows;}else{const{rows,grid}=this._updateGrid({rows:state.data[index].rows,grid:state.data[index].grid},{rows:this._gridData.data[i].rows,grid:this._gridData.data[i].grid},fields);state.data[index].rows=rows;state.data[index].grid=grid;}
return true;}});i+=1;}
if(this._gridData.serverTime){state.serverTime=this._gridData.serverTime;}
this._gridData=state;this._gridData.data.forEach((group,groupIndex)=>{this._gridData.data[groupIndex].totals=this._computeTotals(group.grid);});this._gridData.totals=this._computeTotals(_.flatten(_.pluck(this._gridData.data,'grid'),true));return this._gridData;},async __load(){await this._super(...arguments);await this._getTimerData();},async __reload(handle,params){if(params&&'groupBy'in params){var GroupBy=params.groupBy.filter(filter=>{return filter.split(':').length===1;});if(GroupBy.length!==params.groupBy.length){this.do_warn(false,_t('Grouping by date is not supported'));}
params.groupBy=GroupBy;}
await this._super(...arguments);},_changeTimerDescription(timesheetId,description){this._rpc({model:'account.analytic.line',method:'change_description',args:[[timesheetId],description],});},_addTimeTimer(timesheetId,time){this._rpc({model:'account.analytic.line',method:'action_add_time_to_timer',args:[[timesheetId],time],});},async _stopTimer(timesheetId){await this._rpc({model:'account.analytic.line',method:'action_timer_stop',args:[timesheetId,true],});},_unlinkTimer(timesheetId){this._rpc({model:'account.analytic.line',method:'action_timer_unlink',args:[[timesheetId]],});},async _getTimerData(){const result=await this._rpc({model:'account.analytic.line',method:'get_timer_data',args:[],});this._gridData.stepTimer=result['step_timer'];this._gridData.defaultProject=result['favorite_project'];},_checkRowsSameOrder(a,b,fields){if(a.length!==b.length){return false;}
for(let i=0;i<a.length;i++){for(const field of fields){if(a[i].values[field]===false&&b[i].values[field]!==false){return false;}
if(_.difference(a[i].values[field],b[i].values[field]).length!==0){return false;}}}
return true;},_updateGrid(a,b,fields){const result={rows:[],grid:[]};let i=0;for(i=0;i<a.rows.length;i++){b.rows.some((row,index)=>{for(const field of fields){if(a.rows[i].values[field]===false&&row.values[field]!==false){return false;}
if(_.difference(a.rows[i].values[field],row.values[field]).length!==0){return false;}}
result.rows.push(row);result.grid.push(b.grid[index]);return true;});}
if(i<b.rows.length){for(i;i<b.rows.length;i++){result.rows.push(b.rows[i]);result.grid.push(b.grid[i]);}}
return result;},});return TimerGridModel;});;

/* /timesheet_grid/static/src/js/timesheet_grid/timesheet_timer_grid_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('timesheet_grid.TimerGridController',function(require){"use strict";const GridController=require('web_grid.GridController');const TimerGridController=GridController.extend({custom_events:Object.assign({},GridController.prototype.custom_events,{update_timer:'_onUpdateTimer',update_timer_description:'_onUpdateTimerDescription',add_time_timer:'_onAddTimeTimer',stop_timer:'_onStopTimer',unlink_timer:'_onUnlinkTimer',}),init:function(){this._super.apply(this,arguments);this._onClickTimerButton=_.debounce(this._onClickTimerButton,500);},async _onUpdateTimer(){const state=await this.model.actionTimer(this.model.get());await this.renderer.update(state);this.updateButtons(state);},_onUpdateTimerDescription(event){const timesheetId=event.data.timesheetId;const description=event.data.description;this.model._changeTimerDescription(timesheetId,description);},_onAddTimeTimer(event){const timesheetId=event.data.timesheetId;const time=event.data.time;this.model._addTimeTimer(timesheetId,time);},async _onStopTimer(event){const timesheetId=event.data.timesheetId;await this.model._stopTimer(timesheetId);await this.reload();},_onUnlinkTimer(event){const timesheetId=event.data.timesheetId;this.model._unlinkTimer(timesheetId);}});return TimerGridController;});;

/* /timesheet_grid/static/src/js/timesheet_grid/timesheet_timer_grid_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('timesheet_grid.TimerGridRenderer',function(require){"use strict";const utils=require('web.utils');const GridRenderer=require('web_grid.GridRenderer');const TimerHeaderComponent=require('timesheet_grid.TimerHeaderComponent');const TimerStartComponent=require('timesheet_grid.TimerStartComponent');const{useState,useExternalListener,useRef}=owl.hooks;class TimerGridRenderer extends GridRenderer{constructor(parent,props){super(...arguments);useExternalListener(window,'keydown',this._onKeydown);useExternalListener(window,'keyup',this._onKeyup);this.initialGridAnchor=props.context.grid_anchor;this.initialGroupBy=props.groupBy;this.stateTimer=useState({taskId:undefined,taskName:'',projectId:undefined,projectName:'',addTimeMode:false,description:'',startSeconds:0,timerRunning:false,indexRunning:-1,readOnly:false,projectWarning:false,});this.timerHeader=useRef('timerHeader');this.timesheetId=false;this._onChangeProjectTaskDebounce=_.debounce(this._setProjectTask.bind(this),500);}
mounted(){super.mounted(...arguments);if(this.formatType==='float_time'){this._get_running_timer();}}
async willUpdateProps(nextProps){if(nextProps.data!==this.props.data){this._match_line(nextProps.data);}
return super.willUpdateProps(...arguments);}
get showTimerButton(){return((this.formatType==='float_time')&&(this.props.groupBy.includes('project_id')));}
get showTimer(){return this.formatType==='float_time';}
_match_line(new_grid){const grid=(new_grid)?new_grid[0].rows:this.props.data[0].rows;let current_value;for(let i=0;i<grid.length;i++){current_value=grid[i].values;if(current_value.project_id&&current_value.project_id[0]===this.stateTimer.projectId&&((!current_value.task_id&&!this.stateTimer.taskId)||(current_value.task_id&&current_value.task_id[0]===this.stateTimer.taskId))){this.stateTimer.indexRunning=i;return;}}
this.stateTimer.indexRunning=-1;}
async _get_running_timer(){const result=await this.rpc({model:'account.analytic.line',method:'get_running_timer',args:[]});if(result.id!==undefined){this.stateTimer.timerRunning=true;this.timesheetId=result.id;this.stateTimer.readOnly=result.readonly;this.stateTimer.projectId=result.project_id;this.stateTimer.taskId=result.task_id||undefined;this.stateTimer.projectName=(result.project_name)?result.project_name:'';this.stateTimer.taskName=(result.task_name)?result.task_name:'';this.stateTimer.timerRunning=true;this.stateTimer.description=(result.description==='/')?'':result.description;this.stateTimer.startSeconds=Math.floor(Date.now()/1000)-result.start;}else if(this.stateTimer.timerRunning&&this.stateTimer.projectId){this.timesheetId=false;this.stateTimer.readOnly=false;this.stateTimer.projectId=false;this.stateTimer.taskId=undefined;this.stateTimer.timerRunning=false;this.stateTimer.description='';}
if(this.timerHeader.comp.startButton.el){this.timerHeader.comp.startButton.el.focus();}
this._match_line();}
async _onSetProject(data){this.stateTimer.projectId=data.detail.projectId;this.stateTimer.taskId=undefined;this._onChangeProjectTaskDebounce(data.detail.projectId,undefined);}
async _onSetTask(data){this.stateTimer.taskId=data.detail.taskId||undefined;this._onChangeProjectTaskDebounce(this.stateTimer.projectId,data.detail.taskId);}
async _setProjectTask(projectId,taskId){if(!this.stateTimer.projectId){return;}
if(this.timesheetId){const timesheetId=await this.rpc({model:'account.analytic.line',method:'action_change_project_task',args:[[this.timesheetId],this.stateTimer.projectId,this.stateTimer.taskId],});if(this.timesheetId!==timesheetId){this.timesheetId=timesheetId;await this._get_running_timer();}}else{const seconds=Math.floor(Date.now()/1000)-this.stateTimer.startSeconds;this.timesheetId=await this.rpc({model:'account.analytic.line',method:'create',args:[{'name':this.stateTimer.description,'project_id':this.stateTimer.projectId,'task_id':this.stateTimer.taskId,}],});this.trigger('add_time_timer',{timesheetId:this.timesheetId,time:seconds});}
this._match_line();}
async _onClickLineButton(taskId,projectId){if(this.stateTimer.addTimeMode===true){this.timesheetId=await this.rpc({model:'account.analytic.line',method:'action_add_time_to_timesheet',args:[[this.timesheetId],projectId,taskId,this.props.stepTimer*60],});this.trigger('update_timer');}else if(!this.timesheetId&&this.stateTimer.timerRunning){this.stateTimer.projectId=projectId;this.stateTimer.taskId=(taskId)?taskId:undefined;await this._onChangeProjectTaskDebounce(projectId,taskId);}else{if(this.stateTimer.projectId===projectId&&this.stateTimer.taskId===taskId){await this._stop_timer();return;}
await this._stop_timer();this.stateTimer.projectId=projectId;this.stateTimer.taskId=(taskId)?taskId:undefined;await this._onTimerStarted();await this._onChangeProjectTaskDebounce(projectId,taskId);}
if(this.timerHeader.comp.stopButton.el){this.timerHeader.comp.stopButton.el.focus();}}
async _onTimerStarted(){this.stateTimer.timerRunning=true;this.stateTimer.addTimeMode=false;this.stateTimer.startSeconds=Math.floor(Date.now()/1000);if(this.props.defaultProject&&!this.stateTimer.projectId){this.stateTimer.projectId=this.props.defaultProject;this._onChangeProjectTaskDebounce(this.props.defaultProject,undefined);}}
async _stop_timer(){if(!this.timesheetId){this.stateTimer.projectWarning=true;return;}
let timesheetId=this.timesheetId;this.timesheetId=false;this.trigger('stop_timer',{timesheetId:timesheetId,});this.stateTimer.description='';this.stateTimer.timerRunning=false;this.timesheetId=false;this.stateTimer.projectId=undefined;this.stateTimer.taskId=undefined;this.stateTimer.timerRunning=false;this.stateTimer.projectWarning=false;this._match_line();this.stateTimer.readOnly=false;}
async _onTimerUnlink(){if(this.timesheetId!==false){this.trigger('unlink_timer',{timesheetId:this.timesheetId,});}
this.timesheetId=false;this.stateTimer.projectId=undefined;this.stateTimer.taskId=undefined;this.stateTimer.timerRunning=false;this.stateTimer.description='';this.stateTimer.manualTimeInput=false;this._match_line();this.stateTimer.readOnly=false;this.stateTimer.projectWarning=false;}
_onNewDescription(data){this.stateTimer.description=data.detail;if(this.timesheetId){this.trigger('update_timer_description',{timesheetId:this.timesheetId,description:data.detail});}}
async _onNewTimerValue(data){const seconds=Math.floor(Date.now()/1000)-this.stateTimer.startSeconds;const toAdd=data.detail*3600-seconds;this.stateTimer.startSeconds=this.stateTimer.startSeconds-toAdd;if(this.timesheetId&&typeof toAdd==='number'){this.trigger('add_time_timer',{timesheetId:this.timesheetId,time:toAdd});}
this.timerHeader.comp.stopButton.el.focus();}
async _onClickStartTimerFromLine(ev){if(!ev.detail){return;}
const cell_path=ev.detail.split('.');const grid_path=cell_path.slice(0,-2);const row_path=grid_path.concat(['rows'],cell_path.slice(-1));const row=utils.into(this.props.data,row_path);const data=row.values;const task=(data.task_id)?data.task_id[0]:undefined;this._onClickLineButton(task,data.project_id[0]);}
async _onKeydown(ev){if(ev.key==='Shift'&&!this.stateTimer.timerRunning){this.stateTimer.addTimeMode=true;}else if(this.showTimerButton&&!['input','textarea'].includes(ev.target.tagName.toLowerCase())){if(ev.key==='Escape'&&this.stateTimer.timerRunning){this._onTimerUnlink();}
const index=ev.keyCode-65;if(index>=0&&index<=26&&index<this.props.data[0].rows.length){const data=this.props.data[0].rows[index].values;const projectId=data.project_id[0];const taskId=data.task_id&&data.task_id[0];this._onClickLineButton(taskId,projectId);}}}
_onKeyup(ev){if(ev.key==='Shift'){this.stateTimer.addTimeMode=false;}}}
TimerGridRenderer.props=Object.assign({},GridRenderer.props,{serverTime:{type:String,optional:true},stepTimer:{type:Number,optional:true},defaultProject:{type:[Boolean,Number],optional:true},Component:{type:Object,optional:true},});TimerGridRenderer.components={TimerHeaderComponent,TimerStartComponent,};return TimerGridRenderer;});;

/* /timesheet_grid/static/src/js/timesheet_grid/timesheet_timer_grid_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('timesheet_grid.TimerGridView',function(require){"use strict";const viewRegistry=require('web.view_registry');const WebGridView=require('web_grid.GridView');const TimerGridController=require('timesheet_grid.TimerGridController');const TimerGridModel=require('timesheet_grid.TimerGridModel');const GridRenderer=require('timesheet_grid.TimerGridRenderer');const TimesheetConfigQRCodeMixin=require('timesheet_grid.TimesheetConfigQRCodeMixin');const{onMounted,onPatched}=owl.hooks;class TimerGridRenderer extends GridRenderer{constructor(){super(...arguments);onMounted(()=>this._bindPlayStoreIcon());onPatched(()=>this._bindPlayStoreIcon());}}
Object.assign(TimerGridRenderer.prototype,TimesheetConfigQRCodeMixin);const TimerGridView=WebGridView.extend({config:Object.assign({},WebGridView.prototype.config,{Model:TimerGridModel,Controller:TimerGridController,Renderer:TimerGridRenderer})});viewRegistry.add('timesheet_timer_grid',TimerGridView);return TimerGridView;});;

/* /timesheet_grid/static/src/js/timesheet_grid/timer_m2o.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('timesheet_grid.TimerHeaderM2O',function(require){"use strict";const config=require('web.config');const core=require('web.core');const relational_fields=require('web.relational_fields');const StandaloneFieldManagerMixin=require('web.StandaloneFieldManagerMixin');const Widget=require('web.Widget');const Many2One=relational_fields.FieldMany2One;const _t=core._t;const TimerHeaderM2O=Widget.extend(StandaloneFieldManagerMixin,{template:'timesheet_grid.timer_project_task',init:function(parent,params){this._super(...arguments);StandaloneFieldManagerMixin.init.call(this);this.projectId=arguments[1];this.taskId=arguments[2];},willStart:async function(){await this._super(...arguments);this.project=await this.model.makeRecord('account.analytic.line',[{name:'project_id',relation:'project.project',type:'many2one',value:this.projectId,domain:[['allow_timesheet_timer','=',true]],}]);this.task=await this.model.makeRecord('account.analytic.line',[{name:'task_id',relation:'project.task',type:'many2one',value:this.taskId,domain:[['project_id','=',this.projectId]]}]);},start:async function(){const _super=this._super.bind(this);let placeholderTask,placeholderProject;if(config.device.isMobile){placeholderTask=_t('Task');placeholderProject=_t('Project');}else{placeholderTask=_t('Select a Task');placeholderProject=_t('Select a Project');}
const projectRecord=this.model.get(this.project);const projectMany2one=new Many2One(this,'project_id',projectRecord,{attrs:{placeholder:placeholderProject,},noOpen:true,noCreate:true,mode:'edit',required:true,});projectMany2one.field['required']=true;this._registerWidget(this.project,'project_id',projectMany2one);await projectMany2one.appendTo(this.$('.timer_project_id'));this.projectMany2one=projectMany2one;const taskRecord=this.model.get(this.task);const taskMany2one=new Many2One(this,'task_id',taskRecord,{attrs:{placeholder:placeholderTask,},noOpen:true,noCreate:true,mode:'edit',});this._registerWidget(this.task,'task_id',taskMany2one);await taskMany2one.appendTo(this.$('.timer_task_id'));this.taskMany2one=taskMany2one;this.$('.timer_project_id').addClass('o_required_modifier');_super.apply(...arguments);},_updateRequiredField:function(){if(this.projectId===undefined){this.$('.timer_label_project').addClass('o_field_invalid');this.$('.timer_project_id').addClass('o_field_invalid');}else{this.$('.timer_label_project').removeClass('o_field_invalid');this.$('.timer_project_id').removeClass('o_field_invalid');}},_onFieldChanged:async function(ev){const project=this.projectId;const task=(this.taskId)?this.taskId:false;await StandaloneFieldManagerMixin._onFieldChanged.apply(this,arguments);const fieldName=ev.target.name;let record;if(fieldName==='project_id'){record=this.model.get(this.project);var newId=record.data.project_id.res_id;if(project!==newId){this.projectId=newId;this.taskId=false;this.taskMany2one.value=[];this.taskMany2one.m2o_value=this.taskMany2one._formatValue([]);this.taskMany2one._render();this.taskMany2one.field.domain=[['project_id','=',newId]];this.trigger_up('timer-edit-project',{'projectId':newId});this._updateRequiredField();}}else if(fieldName==='task_id'){record=this.model.get(this.task);const newId=record.data.task_id&&record.data.task_id.res_id;if(task!==newId){this.taskId=false;this.trigger_up('timer-edit-task',{'taskId':newId});}}},});return TimerHeaderM2O;});;

/* /timesheet_grid/static/src/js/timesheet_grid/timer_header_component.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('timesheet_grid.TimerHeaderComponent',function(require){"use strict";const fieldUtils=require('web.field_utils');const TimerHeaderM2O=require('timesheet_grid.TimerHeaderM2O');const{useState,useRef}=owl.hooks;const{ComponentAdapter}=require('web.OwlCompatibility');class TimerHeaderM2OAdapter extends ComponentAdapter{async updateWidget(nextProps){if(this.widget.projectId!==nextProps.widgetArgs[0]||this.widget.taskId!==nextProps.widgetArgs[1]){this.widget.projectId=nextProps.widgetArgs[0];this.widget.taskId=nextProps.widgetArgs[1];this.widget._updateRequiredField();const project=this.widget.projectId||false;await this.widget.projectMany2one.reinitialize(project);this.widget.taskMany2one.field.domain=[['project_id','=',project]];const task=this.widget.taskId||false;await this.widget.taskMany2one.reinitialize(task);}else if(nextProps.widgetArgs[2]){this.widget._updateRequiredField();}}}
class TimerHeaderComponent extends owl.Component{constructor(){super(...arguments);this.state=useState({time:null,manualTimeInput:false,errorManualTimeInput:false,});this.TimerHeaderM2O=TimerHeaderM2O;this.manualTimerAmount="00:00";this.manualTimeInput=useRef("manualTimerInput");this.descriptionInput=useRef("inputDescription");this.startButton=useRef("startButton");this.stopButton=useRef("stopButton");this.timerStarted=false;if(this.props.timerRunning===true){this.timerStarted=true;this.state.time=Math.floor(Date.now()/1000)-this.props.timer;this.timer=setInterval(()=>{this.state.time=Math.floor(Date.now()/1000)-this.props.timer;},1000);}}
async willUpdateProps(nextProps){if(nextProps.description!==this.props.description&&this.descriptionInput.el){this.descriptionInput.el.value=nextProps.description;}
return super.willUpdateProps(...arguments);}
patched(){if(this.state.manualTimeInput&&!this.state.errorManualTimeInput&&this.manualTimeInput.el!==document.activeElement){this.manualTimeInput.el.focus();this.manualTimeInput.el.select();}
if(this.props.timerRunning&&!this.timerStarted){this.timerStarted=true;this.state.time=Math.floor(Date.now()/1000)-this.props.timer;this.timer=setInterval(()=>{this.state.time=Math.floor(Date.now()/1000)-this.props.timer;},1000);this.stopButton.el.focus();}else if(!this.props.timerRunning&&this.timerStarted){this.timerStarted=false;clearInterval(this.timer);this.startButton.el.focus();}}
mounted(){if(this.stopButton.el){this.stopButton.el.focus();}else{this.startButton.el.focus();}}
get timerMode(){return this.props.addTimeMode;}
get timeInput(){return this.manualTimerAmount;}
get _timerIsRunning(){return this.props.timerRunning;}
get _timerReadOnly(){return this.props.timerReadOnly;}
get _manualTimeInput(){return this.state.manualTimeInput;}
get _timerString(){if(this.state.time){const hours=Math.floor(this.state.time/3600);const secondsLeft=this.state.time%3600;const seconds=this._display2digits(secondsLeft%60);const minutes=this._display2digits(Math.floor(secondsLeft/60));return`${this._display2digits(hours)}:${minutes}:${seconds}`;}
return"00:00:00";}
get isMobile(){return this.env.device.isMobile;}
_display2digits(number){return number>9?""+number:"0"+number;}
async _onKeydown(ev){if(ev.key==='Enter'){ev.preventDefault();if(this.state.manualTimeInput){this._onFocusoutTimer(ev);}else{this.trigger('new-description',ev.target.value);this.trigger('timer-stopped');}}}
_onFocusoutTimer(ev){try{const value=fieldUtils.parse['float_time'](ev.target.value);this.state.errorManualTimeInput=(value<0);if(!this.state.errorManualTimeInput){this.trigger('new-timer-value',value);this.state.time=value*3600;this.state.manualTimeInput=false;}}catch(_){this.state.errorManualTimeInput=true;}}
_onInputTimer(ev){try{const value=fieldUtils.parse['float_time'](ev.target.value);this.state.errorManualTimeInput=(value<0);}catch(_){this.state.errorManualTimeInput=true;}}
_onClickStopTimer(ev){ev.stopPropagation();this.trigger('timer-stopped');}
_onClickStartTimer(ev){ev.stopPropagation();this.trigger('timer-started');}
_onInputDescription(ev){this.trigger('new-description',ev.target.value);}
async _onClickManualTime(ev){if(this.props.timerReadOnly){return;}
const rounded_minutes=await this.rpc({model:'account.analytic.line',method:'get_rounded_time',args:[this.state.time/60],});this.manualTimerAmount=fieldUtils.format['float_time'](rounded_minutes);this.state.manualTimeInput=true;}
async _onUnlinkTimer(ev){this.trigger('timer-unlink');}}
TimerHeaderComponent.template='timesheet_grid.timer_header';TimerHeaderComponent.props={taskId:{type:Number,optional:true},projectId:{type:Number,optional:true},taskName:{type:String,optional:true},projectName:{type:String,optional:true},stepTimer:Number,timer:Number,description:{type:String,optional:true},timerRunning:Boolean,addTimeMode:Boolean,timerReadOnly:{type:Boolean,optional:true},projectWarning:Boolean,};TimerHeaderComponent.components={TimerHeaderM2OAdapter};return TimerHeaderComponent;});;

/* /timesheet_grid/static/src/js/timesheet_grid/timer_start_component.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('timesheet_grid.TimerStartComponent',function(require){"use strict";class TimerStartComponent extends owl.Component{get letter(){if(this.props.runningIndex!==this.props.index&&this.props.index<26){const from=this.props.addTimeMode?65:97;return String.fromCharCode(from+this.props.index);}else{return'';}}
get iconClass(){if(this.props.runningIndex===this.props.index){return'fa fa-play primary-green';}else if(this.props.index<26){return'';}else if(this.props.addTimeMode){return'fa fa-plus';}else{return'fa fa-play';}}
_onClickTimer(ev){ev.stopPropagation();this.trigger('timer-started-from-line',this.props.path);}}
TimerStartComponent.template='timesheet_grid.start_timer';TimerStartComponent.props={path:String,index:{type:Number,optional:true},runningIndex:{type:Number,optional:true},addTimeMode:Boolean};return TimerStartComponent;});;

/* /timesheet_grid/static/src/js/timesheet_kanban/timesheet_kanban_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('timesheet_grid.timesheet_kanban_view',function(require){"use strict";const KanbanController=require('web.KanbanController');const KanbanView=require('web.KanbanView');const KanbanRenderer=require('web.KanbanRenderer');const viewRegistry=require('web.view_registry');const QRCodeMixin=require('hr_timesheet.res.config.form');const TimesheetKanbanController=KanbanController.extend({custom_events:_.extend({},KanbanController.prototype.custom_events,{'timer_changed':'_onTimerChanged',}),_onTimerChanged:function(event){this.reload();}});const TimesheetKanbanRenderer=KanbanRenderer.extend(QRCodeMixin.TimesheetConfigQRCodeMixin);const TimesheetKanbanView=KanbanView.extend({config:_.extend({},KanbanView.prototype.config,{Controller:TimesheetKanbanController,Renderer:TimesheetKanbanRenderer,})});viewRegistry.add('timesheet_kanban_view',TimesheetKanbanView);return{TimesheetKanbanController,TimesheetKanbanView,TimesheetKanbanRenderer};});;

/* /timesheet_grid/static/src/js/timesheet_list/timesheet_list_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('timesheet_grid.timesheet_list_view',function(require){"use strict";const ListController=require('web.ListController');const ListView=require('web.ListView');const ListRenderer=require('web.ListRenderer');const QRCodeMixin=require('hr_timesheet.res.config.form');const viewRegistry=require('web.view_registry');const TimesheetListController=ListController.extend({custom_events:_.extend({},ListController.prototype.custom_events,{'timer_changed':'_onTimerChanged',}),_onTimerChanged:function(event){this.reload();}});const TimesheetListRenderer=ListRenderer.extend(QRCodeMixin.TimesheetConfigQRCodeMixin);const TimesheetListView=ListView.extend({config:_.extend({},ListView.prototype.config,{Controller:TimesheetListController,Renderer:TimesheetListRenderer})});viewRegistry.add('timesheet_tree',TimesheetListView);return{TimesheetListController,TimesheetListView,TimesheetListRenderer};});;

/* /timesheet_grid/static/src/js/timesheet_pivot/timesheet_pivot_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('timesheet_grid.timesheet_pivot_view',function(require){"use strict";const PivotView=require('web.PivotView');const PivotRenderer=require('web.PivotRenderer');const TimesheetConfigQRCodeMixin=require('timesheet_grid.TimesheetConfigQRCodeMixin');const viewRegistry=require('web.view_registry');const{onMounted,onPatched}=owl.hooks;class TimesheetGridRenderer extends PivotRenderer{constructor(){super(...arguments);onMounted(()=>this._bindPlayStoreIcon());onPatched(()=>this._bindPlayStoreIcon());}}
Object.assign(PivotRenderer.prototype,TimesheetConfigQRCodeMixin);const TimesheetPivotView=PivotView.extend({config:_.extend({},PivotView.prototype.config,{Renderer:TimesheetGridRenderer})});viewRegistry.add('timesheet_pivot_view',TimesheetPivotView);return{TimesheetPivotView,TimesheetGridRenderer};});;

/* /timesheet_grid/static/src/js/tours/timesheet_grid.js defined in bundle 'point_of_sale.pos_assets_backend' */
"use strict";odoo.define('timesheet.tour',function(require){var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('timesheet_tour',{sequence:20,rainbowManMessage:_t("Congratulations, you are now a master of Timesheets.</b>Psst: try the  [a] - [Enter] - [b] - [Enter] - shift + [A]  sequence on your keyboard and see what happens next!"),url:"/web",},[tour.stepUtils.showAppsMenuItem(),{trigger:'.o_app[data-menu-xmlid="hr_timesheet.timesheet_menu_root"]',content:_t('Track the <b>time spent</b> on your projects. <i>It starts here.</i>'),position:'bottom',},{trigger:'.btn_start_timer',content:_t('Launch the <b>timer</b> to start a new activity.'),position:'bottom',},{trigger:'.input_description_timer',content:_t('Describe your activity <i>(e.g. sent an e-mail, meeting with the customer...)</i>.'),position:'bottom',},{trigger:'.timer_project_id .o_field_many2one',content:_t('Select the <b>project</b> on which you are working.'),position:'bottom',},{trigger:'.btn_stop_timer',content:_t('Stop the <b>timer</b> when you are done. <i>Tip: hit <b>[Enter]</b> from the description to automatically log your entry.</i> <br/>Congratulations, you have logged your first timesheet entry.'),position:'bottom',},{trigger:'.btn_timer_line',content:_t('Launch the <b>timer</b> for this project by hitting the <b>[a] key</b>. You can easily switch from one project to another using those keys. <i>Tip: you can also directly add 15 minutes to this project by hitting the <b>shift + [A] keys</b>.</i>'),position:'right',},{trigger:'.o_grid_input',content:_t('Set the number of hours you spent on this project (e.g. 1:30 or 1.5). <i>Tip: use the tab keys to easily navigate from one cell to another.</i>'),position:'bottom',consumeEvent:'change',}]);});;

/* /account_asset/static/src/js/account_asset.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account_asset.AssetFormView',function(require){"use strict";var FormRenderer=require('web.FormRenderer');var FormView=require('web.FormView');var core=require('web.core');var viewRegistry=require('web.view_registry');var _t=core._t;var AccountAssetFormRenderer=FormRenderer.extend({events:_.extend({},FormRenderer.prototype.events,{'click .add_original_move_line':'_onAddOriginalMoveLine',}),_onAddOriginalMoveLine:function(ev){_.find(this.allFieldWidgets[this.state.id],x=>x['name']=='original_move_line_ids').onAddRecordOpenDialog();},});var AssetFormView=FormView.extend({config:_.extend({},FormView.prototype.config,{Renderer:AccountAssetFormRenderer,}),});viewRegistry.add("asset_form",AssetFormView);return AssetFormView;});;

/* /account_asset/static/src/js/account_asset_reversed_widget.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account_asset.widget',function(require){"use strict";var AbstractField=require('web.AbstractField');var core=require('web.core');var registry=require('web.field_registry');var _t=core._t;var AccountAssetReversedWidget=AbstractField.extend({noLabel:true,isSet:function(){return true;},_render:function(){if(this.recordData.reversal_move_id.res_ids.length){var $icon=$('<i/>',{title:_t('This move has been reversed')}).addClass('fa fa-exclamation-circle')
this.$el.html($icon);}},});registry.add("deprec_lines_reversed",AccountAssetReversedWidget);});;

/* /account_bank_statement_import_csv/static/src/js/import_bank_stmt.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('bank_stmt_import_csv.import',function(require){"use strict";var core=require('web.core');var BaseImport=require('base_import.import')
var QWeb=core.qweb;var _t=core._t;var _lt=core._lt;var DataImportStmt=BaseImport.DataImport.extend({init:function(parent,action){this._super.apply(this,arguments);action.display_name=_t('Import Bank Statement');this.filename=action.params.filename||{};this.first_load=true;},start:function(){var self=this;return this._super().then(function(res){self.id=self.parent_context.wizard_id;self.$('input[name=import_id]').val(self.id);self['loaded_file']();});},create_model:function(){return Promise.resolve();},import_options:function(){var options=this._super();options['bank_stmt_import']=true;return options;},onfile_loaded:function(){var self=this;if(this.first_load){this.$('.oe_import_file_show').val(this.filename);this.$('.oe_import_file_reload').hide();this.first_load=false;self['settings_changed']();}
else{this.$('.oe_import_file_reload').show();this._super();}},call_import:function(kwargs){var self=this;var superProm=self._super.apply(this,arguments);superProm.then(function(message){if(message.ids){self.statement_line_ids=message.ids}});return superProm;},exit:function(){this.do_action({name:_t("Reconciliation on Bank Statements"),context:{'statement_line_ids':this.statement_line_ids},type:'ir.actions.client',tag:'bank_statement_reconciliation_view'});},});core.action_registry.add('import_bank_stmt',DataImportStmt);return{DataImportStmt:DataImportStmt,};});;

/* /account_followup/static/src/js/followup_form_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('accountReports.FollowupFormView',function(require){"use strict";var FollowupFormController=require('account_followup.FollowupFormController');var FollowupFormModel=require('account_followup.FollowupFormModel');var FollowupFormRenderer=require('account_followup.FollowupFormRenderer');var FormView=require('web.FormView');var viewRegistry=require('web.view_registry');var FollowupFormView=FormView.extend({config:_.extend({},FormView.prototype.config,{Controller:FollowupFormController,Model:FollowupFormModel,Renderer:FollowupFormRenderer,}),});viewRegistry.add('followup_form',FollowupFormView);return FollowupFormView;});;

/* /account_followup/static/src/js/followup_form_model.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account_followup.FollowupFormModel',function(require){"use strict";var BasicModel=require('web.BasicModel');var field_utils=require('web.field_utils');var session=require('web.session');var time=require('web.time');var FollowupFormModel=BasicModel.extend({init:function(){this._super.apply(this,arguments);this.numberDone=undefined;this.numberTodo=undefined;this.numberSkipped=undefined;this.currentElementIndex=undefined;},changeBlockedMoveLine:function(moveLineID,blocked){return this._rpc({model:'account.move.line',method:'write_blocked',args:[[moveLineID],blocked]});},changeExpectedDate:function(handle,moveLineID,date){return this._rpc({model:'res.partner',method:'change_expected_date',args:[[this.localData[handle].res_id],{move_line_id:moveLineID,expected_pay_date:date}],});},changeTrust:function(handle,newTrust){return this._rpc({model:'res.partner',method:'write',args:[[this.localData[handle].res_id],{trust:newTrust}],});},getProgressInfos:function(){return{numberDone:this.numberDone,numberTodo:this.numberTodo,currentElementIndex:this.currentElementIndex};},getSkippedPartners:function(){return this.numberSkipped;},increaseNumberDone:function(){this.numberDone++;},increaseNumberSkipped:function(){this.numberSkipped++;},isJobComplete:function(){return this.numberTodo===0;},__load:function(params){var self=this;this.modelName=params.modelName;this._computeProgressBar(params.res_id,params.res_ids);return this._super(params).then(function(id){return self._fetch(id);});},__reload:function(handle,params){if(params.offset!==undefined||params.currentId!==undefined){this.localData[handle].data.report_manager_id=undefined;}
if(params.offset!==undefined){this.currentElementIndex=params.offset;}
if(params.ids!==undefined&&params.currentId!==undefined){this._computeProgressBar(params.currentId,params.ids);}
var self=this;return this._super(handle,params).then(function(id){return self._fetch(id);});},removeCurrentRecord:function(handle){this.numberTodo--;var index=this.localData[handle].res_ids.indexOf(this.localData[handle].res_id);this.localData[handle].res_ids.splice(index,1);if(this.currentElementIndex>=this.localData[handle].res_ids.length){this.currentElementIndex=this.localData[handle].res_ids.length-1;}
return this.currentElementIndex;},saveSummary:function(handle,text){return this._rpc({model:'account.report.manager',method:'write',args:[this.localData[handle].data.report_manager_id,{summary:text}],});},setNextActionDate:function(handle,date){this.localData[handle].data.next_action_date=date;},updateNextAction:function(handle,action){var record=this.localData[handle];var next_action_date=field_utils.parse.date(record.data.next_action_date,{},{});return this._rpc({model:'res.partner',method:'update_next_action',args:[[record.res_id],{next_action_type:record.data.next_action,next_action_date:next_action_date,action:action,}],});},doManualAction:function(handle){var level=this.localData[handle].data.followup_level;if(level&&level.manual_action){level.manual_action_done=true;}},doPrintLetter:function(handle){var level=this.localData[handle].data.followup_level;if(level&&level.print_letter){level.print_letter=false;}},doSendMail:function(handle){var level=this.localData[handle].data.followup_level;if(level&&level.send_email){level.send_email=false;}},doSendSMS:function(handle){var level=this.localData[handle].data.followup_level;if(level&&level.send_sms){level.send_sms=false;}},_computeProgressBar:function(id,records){records=records||[];this.numberTodo=records.length;this.currentElementIndex=records.indexOf(id);this.numberDone=0;this.numberSkipped=0;},_fetch:function(id){var self=this;var params={};if(this.localData[id].data.report_manager_id!==undefined){params.keep_summary=true;}
return this._rpc({model:'account.followup.report',method:'get_followup_informations',args:[this.localData[id].res_id,params],kwargs:{context:session.user_context},}).then(function(data){self.localData[id].data.report_manager_id=data.report_manager_id;self.localData[id].data.followup_html=data.html;if(!params.keep_summary){self.localData[id].data.followup_level=data.followup_level||{};}
if(data.next_action){self.localData[id].data.next_action=data.next_action.type;self.localData[id].data.next_action_date=data.next_action.date;}
return self.localData[id].id;});},});return FollowupFormModel;});;

/* /account_followup/static/src/js/followup_form_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account_followup.FollowupFormRenderer',function(require){"use strict";var core=require('web.core');var datepicker=require('web.datepicker');var Dialog=require('web.Dialog');var dom=require('web.dom');var FormRenderer=require('web.FormRenderer');var SystrayMenu=require('web.SystrayMenu');var QWeb=core.qweb;var _t=core._t;var FollowupFormRenderer=FormRenderer.extend({events:_.extend({},FormRenderer.prototype.events,{'input .o_account_reports_next_action_date_picker input':'_onReminderDate','change *[name="blocked"]':'_onChangeBlocked','click .o_change_expected_date':'_onChangeExpectedDate','click .o_change_trust':'_onChangeTrust','click .o_account_reports_no_print .o_account_reports_summary':'_onEditSummary','click .js_account_report_save_summary':'_onSaveSummary','click [action]':'_onTriggerAction','click .o_account_reports_contact_info_call':'_onClickCall',}),init:function(){this._super.apply(this,arguments);this.nextActionDatePicker=new datepicker.DateWidget(this);this.nextActionDatePicker.on('datetime_changed',this,function(){this.trigger_up('next_action_date_changed',{newDate:this.nextActionDatePicker.getValue()});});},removeMailAlert:function(){if(this.chatter){this.chatter.trigger_up('reload_mail_fields',{activity:true,thread:true,followers:true});}
this.$('div.alert.alert-info.alert-dismissible').remove();},renderEditSummary:function(){dom.autoresize(this.$('textarea[name="summary"]'));this.$('.o_account_reports_summary_edit').show();this.$('.o_account_reports_no_print .o_account_reports_summary').hide();this.$('textarea[name="summary"]').focus();},renderMailAlert:function(){this.$('.o_form_sheet_bg div.o_account_reports_page').prepend(QWeb.render("CustomerStatements.send_mail"));},renderSMSAlert:function(){this.$('div.o_account_reports_page').prepend(QWeb.render("CustomerStatements.send_sms"));},renderSavedSummary:function(text){this.$('.o_account_reports_summary_edit').hide();this.$('.o_account_reports_no_print .o_account_reports_summary').show();if(!text){text="<input type='text' class='o_input o_field_widget' name='summary' />";}else{text=text.replace(/\n/g,'<br>');}
this.$('.o_account_reports_no_print .o_account_report_summary').html('<span>'+text+'</span');},renderTrust:function(newTrust){var colorMap={good:'green',normal:'grey',bad:'red',};var color=colorMap[newTrust];this.$('i.oe-account_followup-trust').attr('style','color: '+color+'; font-size: 0.8em;');},_renderTagFollowup:function(){var self=this;var $element=$('<div>');$element.html(this.state.data.followup_html);$element.find('.o_account_reports_summary_edit').hide();this.nextActionDatePicker.appendTo($element.find('div.o_account_reports_next_action_date_picker')).then(function(){self.nextActionDatePicker.setValue(new moment(self.state.data.next_action_date));});return $element;},_onChangeBlocked:function(event){var checkbox=$(event.target).is(":checked");var targetID=$(event.target).parents('tr').find('td[data-id]').data('id');this.trigger_up('on_change_block',{checkbox:checkbox,targetID:targetID});},_onChangeExpectedDate:function(event){var self=this;var targetID=parseInt($(event.target).attr('data-id'));var $content=$(QWeb.render("paymentDateForm",{target_id:targetID}));var paymentDatePicker=new datepicker.DateWidget(this);paymentDatePicker.appendTo($content.find('div.o_account_reports_payment_date_picker'));var save=function(){self.trigger_up('expected_date_changed',{newDate:paymentDatePicker.getValue(),moveLineID:parseInt($content.find("#target_id").val())});};new Dialog(this,{title:'Odoo',size:'medium',$content:$content,buttons:[{text:'Save',classes:'btn-primary',close:true,click:save},{text:'Cancel',close:true}]}).open();},_onChangeTrust:function(event){var newTrust=$(event.target).data("new-trust");if(!newTrust){newTrust=$(event.target).parents('a.o_change_trust').data("new-trust");}
this.trigger_up('on_change_trust',{newTrust:newTrust});},_onClickCall:function(ev){var hasVoip=_.find(SystrayMenu.Items,function(SystrayMenuItem){return SystrayMenuItem.prototype.name==='voip';});if(!hasVoip){return;}
ev.preventDefault();var $el=$(ev.currentTarget);this.do_notify(false,_t('Calling')+' '+$el.data('number'));this.trigger_up('voip_call',{resModel:$el.data('model'),resId:$el.data('id'),number:$el.data('number').toString(),});},_onEditSummary:function(){this.renderEditSummary();},_onReminderDate:function(){this.trigger_up('on_change_reminder_date');},_onSaveSummary:function(event){var text=$(event.target).siblings().val().replace(/[ \t]+/g,' ');this.trigger_up('on_save_summary',{text:text});},_onTriggerAction:function(event){event.stopPropagation();var actionName=$(event.target).attr('action');var resId=parseInt($(event.target).attr('data-id'));var view=parseInt($(event.target).attr('view-id'));this.trigger_up('on_trigger_action',{actionName:actionName,resId:resId,view:view});},});return FollowupFormRenderer;});;

/* /account_followup/static/src/js/followup_form_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('account_followup.FollowupFormController',function(require){"use strict";var FormController=require('web.FormController');var core=require('web.core');var QWeb=core.qweb;var _t=core._t;var FollowupFormController=FormController.extend({events:_.extend({},FormController.prototype.events,{'click .o_account_followup_manual_action_button':'_onManualAction','click .o_account_followup_print_letter_button':'_onPrintLetter','click .o_account_followup_send_mail_button':'_onSendMail','click .o_account_followup_send_sms_button':'_onSendSMS','click .o_account_followup_do_it_later_button':'_onDoItLater','click .o_account_followup_done_button':'_onDone','click .o_account_followup_reconcile':'_onReconcile',}),custom_events:_.extend({},FormController.prototype.custom_events,{expected_date_changed:'_onExpectedDateChanged',next_action_date_changed:'_onChangeReminderDate',on_change_block:'_onChangeBlocked',on_change_trust:'_onChangeTrust',on_save_summary:'_onSaveSummary',on_trigger_action:'_onTriggerAction'}),init:function(){this._super.apply(this,arguments);delete this.searchView;this.hasActionMenus=false;},renderButtons:function($node){this.$buttons=$(QWeb.render("CustomerStatements.buttons",{widget:this}));if($node){this.$buttons.appendTo($node);}},updateButtons:function(){let setButtonClass=(button,primary)=>{let addedClass=primary?'btn-primary':'btn-secondary'
let removedClass=!primary?'btn-secondary':'btn-primary'
this.$buttons.find(`button.${button}`).removeClass(removedClass).addClass(addedClass);}
if(!this.$buttons){return;}
var followupLevel=this.model.localData[this.handle].data.followup_level;setButtonClass('o_account_followup_print_letter_button',followupLevel.print_letter)
setButtonClass('o_account_followup_send_mail_button',followupLevel.send_email)
setButtonClass('o_account_followup_send_sms_button',followupLevel.send_sms)
if(followupLevel.manual_action){this.$buttons.find('button.o_account_followup_manual_action_button').html(followupLevel.manual_action_note);setButtonClass('o_account_followup_manual_action_button',!followupLevel.manual_action_done)}else{this.$buttons.find('button.o_account_followup_manual_action_button').hide();}},_checkDone:function(){if(this.model.isJobComplete()){var message=_.str.sprintf(_t('You are done with the follow-ups!<br/>You have skipped %s partner(s).'),this.model.getSkippedPartners());this.trigger_up('show_effect',{type:'rainbow_man',fadeout:'no',message:message,});}},_displayDone:function(){this.$buttons.find('button.o_account_followup_done_button').show();this.renderer.removeMailAlert();},_displayNextFollowup:function(){var currentIndex=this.model.removeCurrentRecord(this.handle);var params={limit:1,offset:currentIndex,};this.update(params);this.$buttons.find('button.o_account_followup_done_button').hide();this._checkDone();},_getPartner(){return this.model.get(this.handle,{raw:true}).res_id;},_removeHighlightEmail:function(){this.$buttons.find('button.o_account_followup_send_mail_button').removeClass('btn-primary').addClass('btn-secondary');},_removeHighlightSMS:function(){this.$buttons.find('button.o_account_followup_send_sms_button').removeClass('btn-primary').addClass('btn-secondary');},_removeHighlightPrint:function(){this.$buttons.find('button.o_account_followup_print_letter_button').removeClass('btn-primary').addClass('btn-secondary');},_renderSearchView:function(){var progressInfo=this.model.getProgressInfos();var total=progressInfo.numberDone+progressInfo.numberTodo;this.$searchview=$(QWeb.render("CustomerStatements.followupProgressbar",{current:progressInfo.numberDone,max:progressInfo.numberDone+progressInfo.numberTodo,percent:(progressInfo.numberDone/total*100),}));},_updatePaging:function(){const{currentElementIndex,numberTodo}=this.model.getProgressInfos();const state=this.model.get();return this._super(state,{currentMinimum:currentElementIndex+1,size:numberTodo,});},_updateControlPanelProps:function(){this._super.apply(this,arguments);this._renderSearchView();this.controlPanelProps.cp_content.$searchview=this.$searchview;},_onChangeBlocked:function(event){var self=this;var checkbox=event.data.checkbox;var targetID=event.data.targetID;this.model.changeBlockedMoveLine(parseInt(targetID),checkbox).then(function(){self.reload();});},_onChangeTrust:function(event){var self=this;var newTrust=event.data.newTrust;this.model.changeTrust(this.handle,newTrust).then(function(){self.renderer.renderTrust(newTrust);});},_onChangeReminderDate:function(ev){ev.stopPropagation();this.model.setNextActionDate(this.handle,ev.data.newDate);this.model.updateNextAction(this.handle,'change_date')},_onDoItLater:function(){var self=this;this.model.updateNextAction(this.handle,'later').then(function(){self.model.increaseNumberSkipped();self._displayNextFollowup();});},_onDone:function(){var self=this;this.model.updateNextAction(this.handle,'done').then(function(){self.model.increaseNumberDone();self._displayNextFollowup();});},_onExpectedDateChanged:function(event){event.stopPropagation();var self=this;this.model.changeExpectedDate(this.handle,event.data.moveLineID,event.data.newDate).then(function(){self.reload();});},_onReconcile:function(){var context={'mode':'customers','partner_ids':[this._getPartner()],'all_entries':true,}
this.do_action({type:'ir.actions.client',tag:'manual_reconciliation_view',views:[[false,'form']],target:'current',context:context,});},_onPrintLetter:function(){var self=this;this.model.doPrintLetter(this.handle);var records={ids:[this._getPartner()],};this._rpc({model:'account.followup.report',method:'print_followups',args:[records],}).then(function(result){self.do_action(result);self._removeHighlightPrint();self._displayDone();});},_onManualAction:function(){var self=this;var partnerID=this.model.localData[this.handle].res_id;var followupLevel=this.model.localData[this.handle].data.followup_level.id;var options={partner_id:partnerID};this.model.doManualAction(this.handle);if(followupLevel){options['followup_level']=followupLevel;}
this._rpc({model:'account.followup.report',method:'do_manual_action',args:[options]}).then(function(){self.renderer.chatter.trigger_up('reload_mail_fields',{activity:true,thread:true,followers:true});self._displayDone();});},_onSaveSummary:function(event){var self=this;var text=event.data.text;this.model.saveSummary(this.handle,text).then(function(){self.renderer.renderSavedSummary(text);});},_onSendMail:function(){var self=this;this.model.doSendMail(this.handle);this.options={partner_id:this._getPartner(),};this._rpc({model:'account.followup.report',method:'send_email',args:[this.options],}).then(function(){self._removeHighlightEmail();self._displayDone();self.renderer.renderMailAlert();});},async _onSendSMS(){this.model.doSendSMS(this.handle);this.options={partner_id:this._getPartner()};let action=await this._rpc({model:'account.followup.report',method:'send_sms',args:[this.options],})
this.do_action(action,{on_close:(infos)=>{if(!infos){this._removeHighlightSMS()
this._displayDone();this.renderer.renderSMSAlert();}},})},_onTriggerAction:function(event){event.stopPropagation();var actionName=event.data.actionName;var action={type:'ir.actions.act_window',views:[[false,'form']],target:'current',};switch(actionName){case"open_partner_form":_.extend(action,{res_model:'res.partner',res_id:this.model.localData[this.handle].res_id,});break;case"open_invoice":_.extend(action,{res_model:'account.move',res_id:event.data.resId,});break;default:action=undefined;}
if(action){this.do_action(action);}},});return FollowupFormController;});;

/* /documents_account/static/src/js/reconciliation_model.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('documents_account.StatementModel',function(require){"use strict";var reconciliationModel=require('account.ReconciliationModel');reconciliationModel.StatementModel.include({_executeActionList:function(list){var self=this;if(list.length===0){return Promise.resolve();}
var action=list.pop();return this.do_action(action,{on_close:function(){return self._executeActionList(list);}});},_validatePostProcess:function(data){if(data.documents_actions){return this._executeActionList(data.documents_actions);}
return this._super.apply(this,arguments);},});});;

/* /documents_account/static/src/js/tour.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('documents_account.tour',function(require){"use strict";const{_t}=require('web.core');const tour=require('web_tour.tour');tour.register('documents_account_tour',{url:"/web",rainbowManMessage:_t("Wow... 6 documents processed in a few seconds, You're good.<br/>The tour is complete. Try uploading your own documents now."),},[{trigger:'.o_app[data-menu-xmlid="documents.menu_root"]',content:_t("Want to become a <b>paperless company</b>? Let's discover Odoo Documents."),position:'bottom',},{trigger:'img[src="https://img.youtube.com/vi/Ayab6wZ_U1A/0.jpg"]',content:_t("Click on a thumbnail to <b>preview the document</b>."),position:'bottom',run:function(actions){$('.o_close_btn').click();},},{trigger:'.o_search_panel_filter_value:eq(0)',extra_trigger:'.o_search_panel_label',content:_t("Let's process documents in your Inbox.<br/><i>Tip: Use Tags to filter documents and structure your process.</i>"),position:'bottom',run:function(actions){$('.o_search_panel_filter_value:eq(0) .o_search_panel_label_title').click();},},{trigger:'.o_kanban_record:contains(invoice.png)',extra_trigger:'.o_documents_kanban',content:_t("Click on a card to <b>select the document</b>."),position:'bottom',},{trigger:'.o_inspector_rule[data-id="3"] .o_inspector_trigger_rule',extra_trigger:'.o_documents_image_background',content:_t("Let's tag this bill as legal<br/> <i>Tips: actions can be tailored to your process, according to the workspace.</i>"),position:'bottom',},{trigger:'.o_kanban_record:nth(0):contains(Mails_inbox.pdf)',extra_trigger:'.o_documents_kanban',content:_t("Let's process this document, coming from our scanner."),position:'bottom',},{trigger:'.o_inspector_split',extra_trigger:'[title="Mails_inbox.pdf"]',content:_t("As this PDF contains multiple documents, let's split and process in bulk."),position:'bottom',},{trigger:'.o_page_splitter_wrapper:nth(3)',extra_trigger:'.o_documents_pdf_canvas:nth(5)',content:_t("Click on the <b>page separator</b>: we don't want to split these two pages as they belong to the same document."),position:'right',},{trigger:'.o_documents_pdf_page_selector:nth(5)',extra_trigger:'.o_documents_pdf_manager',content:_t("<b>Deselect this page</b> as we plan to process all bills first."),position:'left',},{trigger:'.o_pdf_rule_buttons:first',extra_trigger:'.o_documents_pdf_manager',content:_t("Let's process these bills: turn them into vendor bills."),position:'bottom',},{trigger:'.o_pdf_rule_buttons:nth-last-child(2)',extra_trigger:'.o_pdf_rule_buttons:not(:disabled)',content:_t("Send this letter to the legal department, by assigning the right tags."),position:'bottom',}]);});;

/* /hr_expense_extract/static/src/js/tours/expense_tour.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('hr_expense_extract.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('hr_expense_extract_tour',{url:"/web",rainbowMan:true,rainbowManMessage:"<b>Congratulations</b>, you are now an expert of Expenses.",},[tour.stepUtils.showAppsMenuItem(),{trigger:'.o_app[data-menu-xmlid="hr_expense.menu_hr_expense_root"]',content:_t("Wasting time recording your receipts? Lets try a better way."),position:'bottom',},{trigger:'.o_nocontent_help a.btn-primary',content:_t("Try the AI with a sample receipt."),position:'bottom',},{trigger:"button[name='action_choose_sample_2']",content:_t("Choose a receipt."),position:'right',},{trigger:"button[name='action_submit_expenses']",content:_t("Report this expense to your manager for validation."),position:'bottom',},{trigger:"button[name='approve_expense_sheets']",content:_t("Your manager will have to approve or refuse the expense report."),position:'bottom',},{trigger:"button[name='action_sheet_move_create']",content:_t("Once approved, the accountant will post the journal entries in their accounting."),position:'bottom',},{trigger:"button.o_expense_sheet_pay",content:_t("Once the accountant approves, he will reimburse you."),position:'bottom',},{trigger:"div.modal-dialog select[name='journal_id']",content:_t("Select a payment method."),position:'bottom',},{trigger:"button[name='expense_post_payment']",extra_trigger:"div.modal-dialog div[name='partner_bank_account_id']",content:_t("Now, register the payment."),position:'bottom',}]);});;

/* /hr_referral/static/src/js/hr_referral_dashboard.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('hr.referral.dashboard',function(require){"use strict";var core=require('web.core');var KanbanController=require('web.KanbanController');var KanbanView=require('web.KanbanView');var view_registry=require('web.view_registry');var _lt=core._lt;var HrReferralDashboardController=KanbanController.extend({start:function(){this.$('.o_content').addClass('o_referral_kanban');this.$('.o_content').append('<div class="o_referral_kanban_background"/>');this.$('.o_referral_kanban_background').append('<div class="hr_referral_bg_city"/>');this.$('.o_referral_kanban_background').append('<div class="hr_referral_bg_grass"/>');return this._super.apply(this,arguments);}});var HrReferralDashboardView=KanbanView.extend({config:_.extend({},KanbanView.prototype.config,{Controller:HrReferralDashboardController,}),display_name:_lt('Dashboard'),icon:'fa-dashboard',});view_registry.add('employee_referral_dashboard',HrReferralDashboardView);return{Controller:HrReferralDashboardController,};});;

/* /hr_referral/static/src/js/hr_referral_welcome.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('hr_referral.welcome',function(require){"use strict";var config=require('web.config');var AbstractAction=require('web.AbstractAction');var core=require('web.core');var _t=core._t;var MyReferral=AbstractAction.extend({contentTemplate:'HrReferralWelcome',events:{'click .o_hr_referral_start':'_completeOnboarding','click .o_hr_referral_level_up':'_upgradeLevel','click .o_referral_action':'_onActionClicked','click .o_choose_friend_available':'_chooseFriend','slide.bs.carousel #carouselOnboarding':'_onNewSlide',},willStart:function(){var self=this;this.onboardingLength=0;var def=this._rpc({model:'hr.applicant',method:'retrieve_referral_welcome_screen',}).then(function(res){self.dashboardData=res;self.onboardingLength=res.onboarding&&res.onboarding.length;self.applicantId=res.new_friend_id;self.debug=config.isDebug();});return Promise.all([def,this._super.apply(this,arguments)]);},_onActionClicked:function(e){e.preventDefault();var target=$(e.currentTarget);return this.do_action(target.attr('name'),{additional_context:py.eval(target.attr('context')||'{}')});},_onNewSlide:function(e){if(e.to===this.onboardingLength-1){$('#btn_skip').hide();$('#btn_next').hide();$('#btn_start').show(400);}else{$('#btn_skip').show();$('#btn_next').show();$('#btn_start').hide();}},_completeOnboarding:function(e){var self=this;e.preventDefault();var completed=($(e.currentTarget).attr('completed')==='true');this._rpc({model:'res.users',method:'action_complete_onboarding',args:[completed],}).then(function(res){self.do_action({type:'ir.actions.client',tag:'hr_referral_welcome',name:_t('Dashboard'),target:'main'});});},_upgradeLevel:function(e){var self=this;e.preventDefault();this._rpc({model:'hr.applicant',method:'upgrade_level',args:[],}).then(function(res){self.do_action({type:'ir.actions.client',tag:'hr_referral_welcome',name:_t('Dashboard'),target:'main'});});},_chooseFriend:function(e){var self=this;e.preventDefault();var friendId=parseInt($(e.currentTarget).attr('name'));this._rpc({model:'hr.applicant',method:'choose_a_friend',args:[[self.applicantId],friendId],}).then(function(res){self.do_action({type:'ir.actions.client',tag:'hr_referral_welcome',name:_t('Dashboard'),target:'main'});});},});core.action_registry.add('hr_referral_welcome',MyReferral);return MyReferral;});;

/* /industry_fsm/static/src/js/tours/industry_fsm_tour.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('industry_fsm.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('industry_fsm_tour',{sequence:10,url:"/web",},[{trigger:'.o_app[data-menu-xmlid="industry_fsm.fsm_menu_root"]',content:_t('Here is the <b>Field Service app</b>. Click on the icon to start managing your onsite interventions.'),position:'bottom',},{trigger:'.o-kanban-button-new',extra_trigger:'.o_fsm_kanban',content:_t('Here is the view of the users who are on the field. Click CREATE to start your first task.'),position:'bottom',},{trigger:'input.o_task_name',extra_trigger:'.o_form_editable',content:_t('Add a task title <i>(e.g. Boiler replacement).</i>'),position:'right',width:200,},{trigger:".o_form_view .o_task_customer_field",extra_trigger:'.o_form_project_tasks.o_form_editable',content:_t('Select or create a customer.'),position:"bottom",run:function(actions){actions.text("Brandon Freeman",this.$anchor.find("input"));},},{trigger:".ui-autocomplete > li > a",auto:true,},{trigger:'button[name="action_timer_start"]',extra_trigger:'.o_form_project_tasks',content:_t('Start recording your time.'),position:"bottom",id:'fsm_start',},{trigger:'button[name="action_timer_stop"]',content:_t('Stop the timer and save your timesheet.'),position:'bottom',},{trigger:'button[name="save_timesheet"]',content:_t('<b>Save</b> the time spent on your intervention. <i>Notice that a rounding of 15min was applied. You can customize this value from the settings of the Timesheets app.</i>'),position:'bottom',id:'fsm_save_timesheet',},{trigger:"button[name='action_fsm_validate']",extra_trigger:'.o_form_project_tasks',content:_t('If everything looks good to you, mark the task as done. When doing so, your stock will automatically be updated and your task will move to the next stage.'),position:'bottom',id:'fsm_invoice_create',}]);});;

/* /sale_account_accountant/static/src/js/account_reconciliation.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sale.account_reconciliation',function(require){"use strict";var ReconciliationRenderers=require('account.ReconciliationRenderer');var ReconciliationAction=require('account.ReconciliationClientAction');var ReconciliationModel=require('account.ReconciliationModel');var LineRenderer=ReconciliationRenderers.LineRenderer;var StatementAction=ReconciliationAction.StatementAction;var core=require('web.core');var _t=core._t;LineRenderer.include({events:_.extend({},LineRenderer.prototype.events,{'click .o_notebook .js_open_so':'_onOpenSaleOrder'}),_onOpenSaleOrder:function(event){event.preventDefault();this.trigger_up('open_sale_orders');},});ReconciliationModel.StatementModel.include({_getDefaultMode:function(handle){var line=this.getLine(handle);var ret=this._super(handle)
if(ret!=='inactive'&&line.sale_order_ids&&line.sale_order_ids.length&&line.sale_order_prioritize){return'saleorder'}else{return ret;}},_getAvailableModes:function(handle){var line=this.getLine(handle);var modes=this._super(handle);if(line.sale_order_ids&&line.sale_order_ids.length&&line.sale_order_prioritize){modes.push('saleorder')}
return modes;},});StatementAction.include({custom_events:_.extend({},StatementAction.prototype.custom_events,{open_sale_orders:'_onOpenSaleOrders',}),_onOpenSaleOrders:function(event){var self=this;var handle=event.target.handle;var line=this.model.getLine(handle);if(line.sale_order_ids&&line.sale_order_ids.length>1){this.do_action({name:_t('Sale Orders'),type:'ir.actions.act_window',res_model:'sale.order',views:[[false,'list'],[false,'form']],view_mode:"list",target:'current',domain:[['id','in',line.sale_order_ids]]},{on_reverse_breadcrumb:function(){self.trigger_up('reload');},});}
else if(line.sale_order_ids&&line.sale_order_ids.length===1){this.do_action({name:_t('Sale Order'),type:'ir.actions.act_window',res_model:'sale.order',views:[[false,'form']],target:'current',res_id:line.sale_order_ids[0],},{on_reverse_breadcrumb:function(){self.trigger_up('reload');},});}},});});

/* /sale/static/src/js/variant_mixin.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sale.VariantMixin',function(require){'use strict';var concurrency=require('web.concurrency');var core=require('web.core');var utils=require('web.utils');var ajax=require('web.ajax');var _t=core._t;var VariantMixin={events:{'change .css_attribute_color input':'_onChangeColorAttribute','change .main_product:not(.in_cart) input.js_quantity':'onChangeAddQuantity','change [data-attribute_exclusions]':'onChangeVariant'},onChangeVariant:function(ev){var $parent=$(ev.target).closest('.js_product');if(!$parent.data('uniqueId')){$parent.data('uniqueId',_.uniqueId());}
this._throttledGetCombinationInfo($parent.data('uniqueId'))(ev);},_getCombinationInfo:function(ev){var self=this;if($(ev.target).hasClass('variant_custom_value')){return Promise.resolve();}
var $parent=$(ev.target).closest('.js_product');var qty=$parent.find('input[name="add_qty"]').val();var combination=this.getSelectedVariantValues($parent);var parentCombination=$parent.find('ul[data-attribute_exclusions]').data('attribute_exclusions').parent_combination;var productTemplateId=parseInt($parent.find('.product_template_id').val());self._checkExclusions($parent,combination);return ajax.jsonRpc(this._getUri('/sale/get_combination_info'),'call',{'product_template_id':productTemplateId,'product_id':this._getProductId($parent),'combination':combination,'add_qty':parseInt(qty),'pricelist_id':this.pricelistId||false,'parent_combination':parentCombination,}).then(function(combinationData){self._onChangeCombination(ev,$parent,combinationData);});},handleCustomValues:function($target){var $variantContainer;var $customInput=false;if($target.is('input[type=radio]')&&$target.is(':checked')){$variantContainer=$target.closest('ul').closest('li');$customInput=$target;}else if($target.is('select')){$variantContainer=$target.closest('li');$customInput=$target.find('option[value="'+$target.val()+'"]');}
if($variantContainer){if($customInput&&$customInput.data('is_custom')==='True'){var attributeValueId=$customInput.data('value_id');var attributeValueName=$customInput.data('value_name');if($variantContainer.find('.variant_custom_value').length===0||$variantContainer.find('.variant_custom_value').data('custom_product_template_attribute_value_id')!==parseInt(attributeValueId)){$variantContainer.find('.variant_custom_value').remove();var $input=$('<input>',{type:'text','data-custom_product_template_attribute_value_id':attributeValueId,'data-attribute_value_name':attributeValueName,class:'variant_custom_value form-control'});var isRadioInput=$target.is('input[type=radio]')&&$target.closest('label.css_attribute_color').length===0;if(isRadioInput&&$customInput.data('is_single_and_custom')!=='True'){$input.addClass('custom_value_radio');$target.closest('div').after($input);}else{$input.attr('placeholder',attributeValueName);$input.addClass('custom_value_own_line');$variantContainer.append($input);}}}else{$variantContainer.find('.variant_custom_value').remove();}}},onClickAddCartJSON:function(ev){ev.preventDefault();var $link=$(ev.currentTarget);var $input=$link.closest('.input-group').find("input");var min=parseFloat($input.data("min")||0);var max=parseFloat($input.data("max")||Infinity);var previousQty=parseFloat($input.val()||0,10);var quantity=($link.has(".fa-minus").length?-1:1)+previousQty;var newQty=quantity>min?(quantity<max?quantity:max):min;if(newQty!==previousQty){$input.val(newQty).trigger('change');}
return false;},onChangeAddQuantity:function(ev){var $parent;if($(ev.currentTarget).closest('.oe_optional_products_modal').length>0){$parent=$(ev.currentTarget).closest('.oe_optional_products_modal');}else if($(ev.currentTarget).closest('form').length>0){$parent=$(ev.currentTarget).closest('form');}else{$parent=$(ev.currentTarget).closest('.o_product_configurator');}
this.triggerVariantChange($parent);},triggerVariantChange:function($container){var self=this;$container.find('ul[data-attribute_exclusions]').trigger('change');$container.find('input.js_variant_change:checked, select.js_variant_change').each(function(){self.handleCustomValues($(this));});},getCustomVariantValues:function($container){var variantCustomValues=[];$container.find('.variant_custom_value').each(function(){var $variantCustomValueInput=$(this);if($variantCustomValueInput.length!==0){variantCustomValues.push({'custom_product_template_attribute_value_id':$variantCustomValueInput.data('custom_product_template_attribute_value_id'),'attribute_value_name':$variantCustomValueInput.data('attribute_value_name'),'custom_value':$variantCustomValueInput.val(),});}});return variantCustomValues;},getNoVariantAttributeValues:function($container){var noVariantAttributeValues=[];var variantsValuesSelectors=['input.no_variant.js_variant_change:checked','select.no_variant.js_variant_change'];$container.find(variantsValuesSelectors.join(',')).each(function(){var $variantValueInput=$(this);if($variantValueInput.is('select')){$variantValueInput=$variantValueInput.find('option[value='+$variantValueInput.val()+']');}
if($variantValueInput.length!==0){noVariantAttributeValues.push({'custom_product_template_attribute_value_id':$variantValueInput.data('value_id'),'attribute_value_name':$variantValueInput.data('value_name'),'value':$variantValueInput.val(),'attribute_name':$variantValueInput.data('attribute_name'),'is_custom':$variantValueInput.data('is_custom')});}});return noVariantAttributeValues;},getSelectedVariantValues:function($container){var values=[];var unchangedValues=$container.find('div.oe_unchanged_value_ids').data('unchanged_value_ids')||[];var variantsValuesSelectors=['input.js_variant_change:checked','select.js_variant_change'];_.each($container.find(variantsValuesSelectors.join(', ')),function(el){values.push(+$(el).val());});return values.concat(unchangedValues);},selectOrCreateProduct:function($container,productId,productTemplateId,useAjax){var self=this;productId=parseInt(productId);productTemplateId=parseInt(productTemplateId);var productReady=Promise.resolve();if(productId){productReady=Promise.resolve(productId);}else{var params={product_template_id:productTemplateId,product_template_attribute_value_ids:JSON.stringify(self.getSelectedVariantValues($container)),};var route='/sale/create_product_variant';if(useAjax){productReady=ajax.jsonRpc(route,'call',params);}else{productReady=this._rpc({route:route,params:params});}}
return productReady;},_checkExclusions:function($parent,combination){var self=this;var combinationData=$parent.find('ul[data-attribute_exclusions]').data('attribute_exclusions');$parent.find('option, input, label').removeClass('css_not_available').prop('disabled',false).attr('title','').data('excluded-by','');if(combinationData.exclusions){_.each(combination,function(current_ptav){if(combinationData.exclusions.hasOwnProperty(current_ptav)){_.each(combinationData.exclusions[current_ptav],function(excluded_ptav){self._disableInput($parent,excluded_ptav,current_ptav,combinationData.mapped_attribute_names);});}});}
_.each(combinationData.parent_exclusions,function(exclusions,excluded_by){_.each(exclusions,function(ptav){self._disableInput($parent,ptav,excluded_by,combinationData.mapped_attribute_names,combinationData.parent_product_name);});});},_getProductId:function($parent){return parseInt($parent.find('.product_id').val());},_disableInput:function($parent,attributeValueId,excludedBy,attributeNames,productName){var $input=$parent.find('option[value='+attributeValueId+'], input[value='+attributeValueId+']');$input.addClass('css_not_available');$input.closest('label').addClass('css_not_available');$input.prop('disabled',true);if(excludedBy&&attributeNames){var $target=$input.is('option')?$input:$input.closest('label').add($input);var excludedByData=[];if($target.data('excluded-by')){excludedByData=JSON.parse($target.data('excluded-by'));}
var excludedByName=attributeNames[excludedBy];if(productName){excludedByName=productName+' ('+excludedByName+')';}
excludedByData.push(excludedByName);$target.attr('title',_.str.sprintf(_t('Not available with %s'),excludedByData.join(', ')));$target.data('excluded-by',JSON.stringify(excludedByData));}},_onChangeCombination:function(ev,$parent,combination){var self=this;var $price=$parent.find(".oe_price:first .oe_currency_value");var $default_price=$parent.find(".oe_default_price:first .oe_currency_value");var $optional_price=$parent.find(".oe_optional:first .oe_currency_value");$price.text(self._priceToStr(combination.price));$default_price.text(self._priceToStr(combination.list_price));var isCombinationPossible=true;if(!_.isUndefined(combination.is_combination_possible)){isCombinationPossible=combination.is_combination_possible;}
this._toggleDisable($parent,isCombinationPossible);if(combination.has_discounted_price){$default_price.closest('.oe_website_sale').addClass("discount");$optional_price.closest('.oe_optional').removeClass('d-none').css('text-decoration','line-through');$default_price.parent().removeClass('d-none');}else{$default_price.closest('.oe_website_sale').removeClass("discount");$optional_price.closest('.oe_optional').addClass('d-none');$default_price.parent().addClass('d-none');}
var rootComponentSelectors=['tr.js_product','.oe_website_sale','.o_product_configurator'];if(!combination.product_id||!this.last_product_id||combination.product_id!==this.last_product_id){this.last_product_id=combination.product_id;self._updateProductImage($parent.closest(rootComponentSelectors.join(', ')),combination.display_image,combination.product_id,combination.product_template_id,combination.carousel,isCombinationPossible);}
$parent.find('.product_id').first().val(combination.product_id||0).trigger('change');$parent.find('.product_display_name').first().text(combination.display_name);$parent.find('.js_raw_price').first().text(combination.price).trigger('change');this.handleCustomValues($(ev.target));},_priceToStr:function(price){var l10n=_t.database.parameters;var precision=2;if($('.decimal_precision').length){precision=parseInt($('.decimal_precision').last().data('precision'));}
var formatted=_.str.sprintf('%.'+precision+'f',price).split('.');formatted[0]=utils.insert_thousand_seps(formatted[0]);return formatted.join(l10n.decimal_point);},_throttledGetCombinationInfo:_.memoize(function(uniqueId){var dropMisordered=new concurrency.DropMisordered();var _getCombinationInfo=_.throttle(this._getCombinationInfo.bind(this),500);return function(ev,params){return dropMisordered.add(_getCombinationInfo(ev,params));};}),_toggleDisable:function($parent,isCombinationPossible){$parent.toggleClass('css_not_available',!isCombinationPossible);},_updateProductImage:function($productContainer,displayImage,productId,productTemplateId){var model=productId?'product.product':'product.template';var modelId=productId||productTemplateId;var imageUrl='/web/image/{0}/{1}/'+(this._productImageField?this._productImageField:'image_1024');var imageSrc=imageUrl.replace("{0}",model).replace("{1}",modelId);var imagesSelectors=['span[data-oe-model^="product."][data-oe-type="image"] img:first','img.product_detail_img','span.variant_image img','img.variant_image',];var $img=$productContainer.find(imagesSelectors.join(', '));if(displayImage){$img.removeClass('invisible').attr('src',imageSrc);}else{$img.addClass('invisible');}},_onChangeColorAttribute:function(ev){var $parent=$(ev.target).closest('.js_product');$parent.find('.css_attribute_color').removeClass("active").filter(':has(input:checked)').addClass("active");},_getUri:function(uri){return uri;}};return VariantMixin;});;

/* /sale_product_configurator/static/src/js/product_configurator_renderer.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sale_product_configurator.ProductConfiguratorFormRenderer',function(require){"use strict";var FormRenderer=require('web.FormRenderer');var VariantMixin=require('sale.VariantMixin');var ProductConfiguratorFormRenderer=FormRenderer.extend(VariantMixin,{events:_.extend({},FormRenderer.prototype.events,VariantMixin.events,{'click button.js_add_cart_json':'onClickAddCartJSON',}),init:function(){this._super.apply(this,arguments);this.pricelistId=this.state.context.default_pricelist_id||0;},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.$el.append($('<div>',{class:'configurator_container'}));self.renderConfigurator(self.configuratorHtml);self._checkMode();});},renderConfigurator:function(configuratorHtml){var $configuratorContainer=this.$('.configurator_container');$configuratorContainer.empty();var $configuratorHtml=$(configuratorHtml);$configuratorHtml.appendTo($configuratorContainer);this.triggerVariantChange($configuratorContainer);this._applyCustomValues();},_checkMode:function(){if(this.state.context.configuratorMode==='edit'){this.$('.o_sale_product_configurator_add').hide();this.$('.o_sale_product_configurator_edit').css('display','inline-block');}else if(this.state.context.configuratorMode==='options'){this.trigger_up('handle_add');}},_toggleDisable:function($parent,isCombinationPossible){VariantMixin._toggleDisable.apply(this,arguments);$parent.parents('.modal').find('.o_sale_product_configurator_add').toggleClass('disabled',!isCombinationPossible);},_applyCustomValues:function(){var self=this;var customValueIds=this.state.data.product_custom_attribute_value_ids;if(customValueIds){_.each(customValueIds.data,function(customValue){if(customValue.data.custom_value){var attributeValueId=customValue.data.custom_product_template_attribute_value_id.data.id;var $input=self._findRelatedAttributeValueInput(attributeValueId);$input.closest('li[data-attribute_id]').find('.variant_custom_value').val(customValue.data.custom_value);}});}},_findRelatedAttributeValueInput:function(attributeValueId){var selectors=['ul.js_add_cart_variants input[data-value_id="'+attributeValueId+'"]','ul.js_add_cart_variants option[data-value_id="'+attributeValueId+'"]'];return this.$(selectors.join(', '));}});return ProductConfiguratorFormRenderer;});;

/* /sale_product_configurator/static/src/js/product_configurator_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sale_product_configurator.ProductConfiguratorFormController',function(require){"use strict";var core=require('web.core');var _t=core._t;var FormController=require('web.FormController');var OptionalProductsModal=require('sale_product_configurator.OptionalProductsModal');var ProductConfiguratorFormController=FormController.extend({custom_events:_.extend({},FormController.prototype.custom_events,{field_changed:'_onFieldChanged',handle_add:'_handleAdd'}),start:function(){var self=this;return this._super.apply(this,arguments).then(function(){self.$el.addClass('o_product_configurator');});},willStart:function(){var def=this._super.apply(this,arguments);if(this.initialState.data.product_template_id){return this._configureProduct(this.initialState.data.product_template_id.data.id).then(function(){return def;});}
return def;},renderButtons:function(){this._super.apply(this,arguments);if(this.renderer.state.context.configuratorMode==='options'){this.$el.closest('.modal').addClass('d-none');}},_onButtonClicked:function(event){if(event.stopPropagation){event.stopPropagation();}
var attrs=event.data.attrs;if(attrs.special==='cancel'){this._super.apply(this,arguments);}else{if(!this.$el.parents('.modal').find('.o_sale_product_configurator_add').hasClass('disabled')){this._handleAdd();}}},_onFieldChanged:function(event){this._super.apply(this,arguments);var self=this;var productId=event.data.changes.product_template_id.id;if(!productId){return;}
this._configureProduct(event.data.changes.product_template_id.id).then(function(){self.renderer.renderConfigurator(self.renderer.configuratorHtml);});},_configureProduct:function(productTemplateId){var self=this;var initialProduct=this.initialState.data.product_template_id;var changed=initialProduct&&initialProduct.data.id!==productTemplateId;var data=this.renderer.state.data;return this._rpc({route:'/sale_product_configurator/configure',params:{product_template_id:productTemplateId,pricelist_id:this.renderer.pricelistId,add_qty:data.quantity,product_template_attribute_value_ids:changed?[]:this._getAttributeValueIds(data.product_template_attribute_value_ids),product_no_variant_attribute_value_ids:changed?[]:this._getAttributeValueIds(data.product_no_variant_attribute_value_ids)}}).then(function(configurator){self.renderer.configuratorHtml=configurator;});},_handleAdd:function(){var self=this;var $modal=this.$el;var productSelector=['input[type="hidden"][name="product_id"]','input[type="radio"][name="product_id"]:checked'];var productId=parseInt($modal.find(productSelector.join(', ')).first().val(),10);var productTemplateId=$modal.find('.product_template_id').val();this.renderer.selectOrCreateProduct($modal,productId,productTemplateId,false).then(function(productId){$modal.find(productSelector.join(', ')).val(productId);var variantValues=self.renderer.getSelectedVariantValues($modal.find('.js_product'));var productCustomVariantValues=self.renderer.getCustomVariantValues($modal.find('.js_product'));var noVariantAttributeValues=self.renderer.getNoVariantAttributeValues($modal.find('.js_product'));self.rootProduct={product_id:productId,product_template_id:parseInt(productTemplateId),quantity:parseFloat($modal.find('input[name="add_qty"]').val()||1),variant_values:variantValues,product_custom_attribute_values:productCustomVariantValues,no_variant_attribute_values:noVariantAttributeValues};if(self.renderer.state.context.configuratorMode==='edit'){self._onAddRootProductOnly();return;}
self.optionalProductsModal=new OptionalProductsModal($('body'),{rootProduct:self.rootProduct,pricelistId:self.renderer.pricelistId,okButtonText:_t('Confirm'),cancelButtonText:_t('Back'),title:_t('Configure'),context:self.initialState.context,previousModalHeight:self.$el.closest('.modal-content').height()}).open();self.optionalProductsModal.on('options_empty',null,self._onAddRootProductOnly.bind(self));self.optionalProductsModal.on('update_quantity',null,self._onOptionsUpdateQuantity.bind(self));self.optionalProductsModal.on('confirm',null,self._onModalConfirm.bind(self));self.optionalProductsModal.on('closed',null,self._onModalClose.bind(self));});},_onAddRootProductOnly:function(){this._addProducts([this.rootProduct]);},_onModalConfirm:function(){this._wasConfirmed=true;this._addProducts(this.optionalProductsModal.getSelectedProducts());},_onModalClose:function(){if(this.renderer.state.context.configuratorMode==='options'&&this._wasConfirmed!==true){this.do_action({type:'ir.actions.act_window_close'});}},_onOptionsUpdateQuantity:function(quantity){this.$el.find('input[name="add_qty"]').val(quantity).trigger('change');},_addProducts:function(products){this.do_action({type:'ir.actions.act_window_close',infos:{mainProduct:products[0],options:products.slice(1)}});},_getAttributeValueIds:function(attributeValueIds){if(!attributeValueIds||attributeValueIds.length===0){return false;}
var result=[];_.each(attributeValueIds.data,function(attributeValue){result.push(attributeValue.data.id);});return result;}});return ProductConfiguratorFormController;});;

/* /sale_product_configurator/static/src/js/product_configurator_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sale_product_configurator.ProductConfiguratorFormView',function(require){"use strict";var ProductConfiguratorFormController=require('sale_product_configurator.ProductConfiguratorFormController');var ProductConfiguratorFormRenderer=require('sale_product_configurator.ProductConfiguratorFormRenderer');var FormView=require('web.FormView');var viewRegistry=require('web.view_registry');var ProductConfiguratorFormView=FormView.extend({config:_.extend({},FormView.prototype.config,{Controller:ProductConfiguratorFormController,Renderer:ProductConfiguratorFormRenderer,}),});viewRegistry.add('product_configurator_form',ProductConfiguratorFormView);return ProductConfiguratorFormView;});;

/* /sale_product_configurator/static/src/js/product_configurator_widget.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sale_product_configurator.product_configurator',function(require){var ProductConfiguratorWidget=require('sale.product_configurator');ProductConfiguratorWidget.include({_isConfigurableProduct:function(){return this.recordData.is_configurable_product||this._super.apply(this,arguments);},reset:function(record,ev){if(ev&&ev.target===this){this.restoreProductTemplateId=this.recordData.product_template_id;this.optionalProducts=(ev.data&&ev.data.optionalProducts)||this.optionalProducts;}
this._super.apply(this,arguments);},_onTemplateChange:function(productTemplateId,dataPointId){var self=this;return this._rpc({model:'product.template',method:'get_single_product_variant',args:[productTemplateId]}).then(function(result){if(result.product_id&&!result.has_optional_products){self.trigger_up('field_changed',{dataPointID:dataPointId,changes:{product_id:{id:result.product_id},product_custom_attribute_value_ids:{operation:'DELETE_ALL'}},});}else{return self._openConfigurator(result,productTemplateId,dataPointId);}});},_onLineConfigured:function(){var self=this;this._super.apply(this,arguments);var parentList=self.getParent();var unselectRow=(parentList.unselectRow||function(){}).bind(parentList);if(self.optionalProducts&&self.optionalProducts.length!==0){self.trigger_up('add_record',{context:self._productsToRecords(self.optionalProducts),forceEditable:'bottom',allowWarning:true,onSuccess:function(){unselectRow();}});}else if(!self._isConfigurableLine()&&self._isConfigurableProduct()){unselectRow();}},_openConfigurator:function(result,productTemplateId,dataPointId){if(!result.mode||result.mode==='configurator'){this._openProductConfigurator({configuratorMode:result&&result.has_optional_products?'options':'add',default_pricelist_id:this._getPricelistId(),default_product_template_id:productTemplateId},dataPointId);return Promise.resolve(true);}
return Promise.resolve(false);},_openProductConfigurator:function(data,dataPointId){this.optionalProducts=undefined;var self=this;this.do_action('sale_product_configurator.sale_product_configurator_action',{additional_context:data,on_close:function(result){if(result&&!result.special){self._addProducts(result,dataPointId);}else{if(self.restoreProductTemplateId){self.trigger_up('field_changed',{dataPointID:dataPointId,preventProductIdCheck:true,changes:{product_template_id:self.restoreProductTemplateId.data}});}else{self.trigger_up('field_changed',{dataPointID:dataPointId,changes:{product_template_id:false,product_id:false,},});}}}});},_onEditProductConfiguration:function(){if(!this.recordData.is_configurable_product){this._super.apply(this,arguments);return;}
this._openProductConfigurator({configuratorMode:'edit',default_product_template_id:this.recordData.product_template_id.data.id,default_pricelist_id:this._getPricelistId(),default_product_template_attribute_value_ids:this._convertFromMany2Many(this.recordData.product_template_attribute_value_ids),default_product_no_variant_attribute_value_ids:this._convertFromMany2Many(this.recordData.product_no_variant_attribute_value_ids),default_product_custom_attribute_value_ids:this._convertFromOne2Many(this.recordData.product_custom_attribute_value_ids),default_quantity:this.recordData.product_uom_qty},this.dataPointID);},_addProducts:function(result,dataPointId){this.trigger_up('field_changed',{dataPointID:dataPointId,preventProductIdCheck:true,optionalProducts:result.options,changes:this._getMainProductChanges(result.mainProduct)});},_getMainProductChanges:function(mainProduct){var result={product_id:{id:mainProduct.product_id},product_template_id:{id:mainProduct.product_template_id},product_uom_qty:mainProduct.quantity};var customAttributeValues=mainProduct.product_custom_attribute_values;var customValuesCommands=[{operation:'DELETE_ALL'}];if(customAttributeValues&&customAttributeValues.length!==0){_.each(customAttributeValues,function(customValue){customValuesCommands.push({operation:'CREATE',context:[{default_custom_product_template_attribute_value_id:customValue.custom_product_template_attribute_value_id,default_custom_value:customValue.custom_value}]});});}
result['product_custom_attribute_value_ids']={operation:'MULTI',commands:customValuesCommands};var noVariantAttributeValues=mainProduct.no_variant_attribute_values;var noVariantCommands=[{operation:'DELETE_ALL'}];if(noVariantAttributeValues&&noVariantAttributeValues.length!==0){var resIds=_.map(noVariantAttributeValues,function(noVariantValue){return{id:parseInt(noVariantValue.value)};});noVariantCommands.push({operation:'ADD_M2M',ids:resIds});}
result['product_no_variant_attribute_value_ids']={operation:'MULTI',commands:noVariantCommands};return result;},_getPricelistId:function(){return this.record.evalContext.parent.pricelist_id;},_productsToRecords:function(products){var records=[];_.each(products,function(product){var record={default_product_id:product.product_id,default_product_template_id:product.product_template_id,default_product_uom_qty:product.quantity};if(product.no_variant_attribute_values){var defaultProductNoVariantAttributeValues=[];_.each(product.no_variant_attribute_values,function(attributeValue){defaultProductNoVariantAttributeValues.push([4,parseInt(attributeValue.value)]);});record['default_product_no_variant_attribute_value_ids']=defaultProductNoVariantAttributeValues;}
if(product.product_custom_attribute_values){var defaultCustomAttributeValues=[];_.each(product.product_custom_attribute_values,function(attributeValue){defaultCustomAttributeValues.push([0,0,{custom_product_template_attribute_value_id:attributeValue.custom_product_template_attribute_value_id,custom_value:attributeValue.custom_value}]);});record['default_product_custom_attribute_value_ids']=defaultCustomAttributeValues;}
records.push(record);});return records;}});return ProductConfiguratorWidget;});;

/* /sale_product_configurator/static/src/js/product_configurator_modal.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sale_product_configurator.OptionalProductsModal',function(require){"use strict";var ajax=require('web.ajax');var Dialog=require('web.Dialog');const OwlDialog=require('web.OwlDialog');var ServicesMixin=require('web.ServicesMixin');var VariantMixin=require('sale.VariantMixin');var OptionalProductsModal=Dialog.extend(ServicesMixin,VariantMixin,{events:_.extend({},Dialog.prototype.events,VariantMixin.events,{'click a.js_add, a.js_remove':'_onAddOrRemoveOption','click button.js_add_cart_json':'onClickAddCartJSON','change .in_cart input.js_quantity':'_onChangeQuantity','change .js_raw_price':'_computePriceTotal'}),init:function(parent,params){var self=this;var options=_.extend({size:'large',buttons:[{text:params.okButtonText,click:this._onConfirmButtonClick,classes:'btn-primary'},{text:params.cancelButtonText,click:this._onCancelButtonClick}],technical:!params.isWebsite,},params||{});this._super(parent,options);this.context=params.context;this.rootProduct=params.rootProduct;this.container=parent;this.pricelistId=params.pricelistId;this.previousModalHeight=params.previousModalHeight;this.dialogClass='oe_optional_products_modal';this._productImageField='image_128';this._opened.then(function(){if(self.previousModalHeight){self.$el.closest('.modal-content').css('min-height',self.previousModalHeight+'px');}});},willStart:function(){var self=this;var uri=this._getUri("/sale_product_configurator/show_optional_products");var getModalContent=ajax.jsonRpc(uri,'call',{product_id:self.rootProduct.product_id,variant_values:self.rootProduct.variant_values,pricelist_id:self.pricelistId||false,add_qty:self.rootProduct.quantity,kwargs:{context:_.extend({'quantity':self.rootProduct.quantity},this.context),}}).then(function(modalContent){if(modalContent){var $modalContent=$(modalContent);$modalContent=self._postProcessContent($modalContent);self.$content=$modalContent;}else{self.trigger('options_empty');self.preventOpening=true;}});var parentInit=self._super.apply(self,arguments);return Promise.all([getModalContent,parentInit]);},open:function(options){$('.tooltip').remove();var self=this;this.appendTo($('<div/>')).then(function(){if(!self.preventOpening){self.$modal.find(".modal-body").replaceWith(self.$el);self.$modal.attr('open',true);self.$modal.removeAttr("aria-hidden");self.$modal.modal().appendTo(self.container);self.$modal.focus();self._openedResolver();OwlDialog.display(self);}});if(options&&options.shouldFocusButtons){self._onFocusControlButton();}
return self;},start:function(){var def=this._super.apply(this,arguments);var self=this;this.$el.find('input[name="add_qty"]').val(this.rootProduct.quantity);var $products=this.$el.find('tr.js_product');_.each($products,function(el){var $el=$(el);var uniqueId=self._getUniqueId(el);var productId=parseInt($el.find('input.product_id').val(),10);if(productId===self.rootProduct.product_id){self.rootProduct.unique_id=uniqueId;}else{el.dataset.parentUniqueId=self.rootProduct.unique_id;}});return def.then(function(){self._opened.then(function(){self.triggerVariantChange(self.$el);});});},getSelectedProducts:function(){var self=this;var products=[this.rootProduct];this.$modal.find('.js_product.in_cart:not(.main_product)').each(function(){var $item=$(this);var quantity=parseInt($item.find('input[name="add_qty"]').val(),10);var parentUniqueId=this.dataset.parentUniqueId;var uniqueId=this.dataset.uniqueId;var productCustomVariantValues=self.getCustomVariantValues($(this));var noVariantAttributeValues=self.getNoVariantAttributeValues($(this));products.push({'product_id':parseInt($item.find('input.product_id').val(),10),'product_template_id':parseInt($item.find('input.product_template_id').val(),10),'quantity':quantity,'parent_unique_id':parentUniqueId,'unique_id':uniqueId,'product_custom_attribute_values':productCustomVariantValues,'no_variant_attribute_values':noVariantAttributeValues});});return products;},_postProcessContent:function($modalContent){var productId=this.rootProduct.product_id;$modalContent.find('img:first').attr("src","/web/image/product.product/"+productId+"/image_128");if(this.rootProduct&&(this.rootProduct.product_custom_attribute_values||this.rootProduct.no_variant_attribute_values)){var $productDescription=$modalContent.find('.main_product').find('td.td-product_name div.text-muted.small > div:first');var $updatedDescription=$('<div/>');$updatedDescription.append($('<p>',{text:$productDescription.text()}));$.each(this.rootProduct.product_custom_attribute_values,function(){$updatedDescription.append($('<div>',{text:this.attribute_value_name+': '+this.custom_value}));});$.each(this.rootProduct.no_variant_attribute_values,function(){if(this.is_custom!=='True'){$updatedDescription.append($('<div>',{text:this.attribute_name+': '+this.attribute_value_name}));}});$productDescription.replaceWith($updatedDescription);}
return $modalContent;},_onConfirmButtonClick:function(){this.trigger('confirm');this.close();},_onCancelButtonClick:function(){this.trigger('back');this.close();},_onAddOrRemoveOption:function(ev){ev.preventDefault();var self=this;var $target=$(ev.currentTarget);var $modal=$target.parents('.oe_optional_products_modal');var $parent=$target.parents('.js_product:first');$parent.find("a.js_add, span.js_remove").toggleClass('d-none');$parent.find(".js_remove");var productTemplateId=$parent.find(".product_template_id").val();if($target.hasClass('js_add')){self._onAddOption($modal,$parent,productTemplateId);}else{self._onRemoveOption($modal,$parent);}
self._computePriceTotal();},_onAddOption:function($modal,$parent,productTemplateId){var self=this;var $selectOptionsText=$modal.find('.o_select_options');var parentUniqueId=$parent[0].dataset.parentUniqueId;var $optionParent=$modal.find('tr.js_product[data-unique-id="'+parentUniqueId+'"]');$parent.find('.td-product_name').removeAttr("colspan");$parent.find('.td-qty').removeClass('d-none');var productCustomVariantValues=self.getCustomVariantValues($parent);var noVariantAttributeValues=self.getNoVariantAttributeValues($parent);if(productCustomVariantValues||noVariantAttributeValues){var $productDescription=$parent.find('td.td-product_name div.float-left');var $customAttributeValuesDescription=$('<div>',{class:'custom_attribute_values_description text-muted small'});if(productCustomVariantValues.length!==0||noVariantAttributeValues.length!==0){$customAttributeValuesDescription.append($('<br/>'));}
$.each(productCustomVariantValues,function(){$customAttributeValuesDescription.append($('<div>',{text:this.attribute_value_name+': '+this.custom_value}));});$.each(noVariantAttributeValues,function(){if(this.is_custom!=='True'){$customAttributeValuesDescription.append($('<div>',{text:this.attribute_name+': '+this.attribute_value_name}));}});$productDescription.append($customAttributeValuesDescription);}
var $tmpOptionParent=$optionParent;while($tmpOptionParent.length){$optionParent=$tmpOptionParent;$tmpOptionParent=$modal.find('tr.js_product.in_cart[data-parent-unique-id="'+$optionParent[0].dataset.uniqueId+'"]').last();}
$optionParent.after($parent);$parent.addClass('in_cart');this.selectOrCreateProduct($parent,$parent.find('.product_id').val(),productTemplateId,true).then(function(productId){$parent.find('.product_id').val(productId);ajax.jsonRpc(self._getUri("/sale_product_configurator/optional_product_items"),'call',{'product_id':productId,'pricelist_id':self.pricelistId||false,}).then(function(addedItem){var $addedItem=$(addedItem);$modal.find('tr:last').after($addedItem);self.$el.find('input[name="add_qty"]').trigger('change');self.triggerVariantChange($addedItem);var parentUniqueId=$parent[0].dataset.uniqueId;var parentQty=$parent.find('input[name="add_qty"]').val();$addedItem.filter('.js_product').each(function(){var $el=$(this);var uniqueId=self._getUniqueId(this);this.dataset.uniqueId=uniqueId;this.dataset.parentUniqueId=parentUniqueId;$el.find('input[name="add_qty"]').val(parentQty);});if($selectOptionsText.nextAll('.js_product').length===0){$selectOptionsText.hide();}});});},_onRemoveOption:function($modal,$parent){var uniqueId=$parent[0].dataset.parentUniqueId;var qty=$modal.find('tr.js_product.in_cart[data-unique-id="'+uniqueId+'"]').find('input[name="add_qty"]').val();$parent.removeClass('in_cart');$parent.find('.td-product_name').attr("colspan",2);$parent.find('.td-qty').addClass('d-none');$parent.find('input[name="add_qty"]').val(qty);$parent.find('.custom_attribute_values_description').remove();$modal.find('.o_select_options').show();var productUniqueId=$parent[0].dataset.uniqueId;this._removeOptionOption($modal,productUniqueId);$modal.find('tr:last').after($parent);},_removeOptionOption:function($modal,optionUniqueId){var self=this;$modal.find('tr.js_product[data-parent-unique-id="'+optionUniqueId+'"]').each(function(){var uniqueId=this.dataset.uniqueId;$(this).remove();self._removeOptionOption($modal,uniqueId);});},_onChangeCombination:function(ev,$parent,combination){$parent.find('.td-product_name .product-name').first().text(combination.display_name);VariantMixin._onChangeCombination.apply(this,arguments);this._computePriceTotal();},_onChangeQuantity:function(ev){var $product=$(ev.target.closest('tr.js_product'));var qty=parseFloat($(ev.currentTarget).val());var uniqueId=$product[0].dataset.uniqueId;this.$el.find('tr.js_product:not(.in_cart)[data-parent-unique-id="'+uniqueId+'"] input[name="add_qty"]').each(function(){$(this).val(qty);});if(this._triggerPriceUpdateOnChangeQuantity()){this.onChangeAddQuantity(ev);}
if($product.hasClass('main_product')){this.rootProduct.quantity=qty;}
this.trigger('update_quantity',this.rootProduct.quantity);this._computePriceTotal();},_computePriceTotal:function(){if(this.$modal.find('.js_price_total').length){var price=0;this.$modal.find('.js_product.in_cart').each(function(){var quantity=parseInt($(this).find('input[name="add_qty"]').first().val(),10);price+=parseFloat($(this).find('.js_raw_price').html())*quantity;});this.$modal.find('.js_price_total .oe_currency_value').text(this._priceToStr(parseFloat(price)));}},_triggerPriceUpdateOnChangeQuantity:function(){return true;},_getUniqueId:function(el){if(!el.dataset.uniqueId){el.dataset.uniqueId=parseInt(_.uniqueId(),10);}
return el.dataset.uniqueId;},});return OptionalProductsModal;});;

/* /sale_renting/static/src/js/rental_configurator_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sale_renting.RentalConfiguratorFormController',function(require){"use strict";var FormController=require('web.FormController');var RentalConfiguratorFormController=FormController.extend({_getRentalInfo:function(state){return{pickup_date:state.pickup_date,return_date:state.return_date,price_unit:state.unit_price,product_uom_qty:state.quantity,is_rental:true,};},saveRecord:function(){var self=this;return this._super.apply(this,arguments).then(function(){var state=self.renderer.state.data;self.do_action({type:'ir.actions.act_window_close',infos:{rentalConfiguration:self._getRentalInfo(state)}});});},});return RentalConfiguratorFormController;});;

/* /sale_renting/static/src/js/rental_configurator_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sale_renting.RentalConfiguratorFormView',function(require){"use strict";var RentalConfiguratorFormController=require('sale_renting.RentalConfiguratorFormController');var FormView=require('web.FormView');var viewRegistry=require('web.view_registry');var RentalConfiguratorFormView=FormView.extend({config:_.extend({},FormView.prototype.config,{Controller:RentalConfiguratorFormController}),});viewRegistry.add('rental_configurator_form',RentalConfiguratorFormView);return RentalConfiguratorFormView;});;

/* /sale_renting/static/src/js/tours/rental.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sale_renting.tour',function(require){"use strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('rental_tour',{url:"/web",},[tour.stepUtils.showAppsMenuItem(),{trigger:'.o_app[data-menu-xmlid="sale_renting.rental_menu_root"]',content:_t("Want to <b>rent products</b>? \n Let's discover Odoo Rental App."),position:'bottom',edition:'enterprise'},{trigger:'.o_menu_entry_lvl_1[data-menu-xmlid="sale_renting.menu_rental_products"]',content:_t("At first, let's create some products to rent."),position:'bottom',},{trigger:'.o-kanban-button-new',extra_trigger:'.breadcrumb-item:contains(Products)',content:_t("Click here to set up your first rental product."),position:'bottom',},{trigger:"input[name='name']",content:_t("Enter the product name."),position:'bottom',},{trigger:".nav-item a.nav-link:contains(Rental)",content:_t("The rental configuration is available here."),position:'top',},{trigger:'.o_form_button_save',content:_t("Save the product."),position:'bottom',},{trigger:'.o_menu_header_lvl_1[data-menu-xmlid="sale_renting.rental_order_menu"]',extra_trigger:'.o_form_button_edit',content:_t("Let's now create an order."),position:'bottom',},{trigger:'.o_menu_entry_lvl_2[data-menu-xmlid="sale_renting.rental_orders_all"]',content:_t("Go to the orders menu."),position:'bottom',},{trigger:'.o-kanban-button-new',content:_t("Click here to create a new quotation."),position:'bottom',},{trigger:".o_field_many2one[name=partner_id] input",content:_t("Create or select a customer here."),position:'bottom',run:'text Agrolait',},{trigger:'.ui-menu-item > a',auto:true,in_modal:false,},{trigger:"a:contains('Add a product')",extra_trigger:".o_field_many2one[name='partner_id'] .o_external_button",content:_t("Click here to start filling the quotation."),position:'bottom',},{trigger:".o_field_widget[name=product_id] input, .o_field_widget[name=product_template_id] input",content:_t("Select your rental product."),position:'bottom',},{trigger:".ui-menu-item a:contains('Test')",auto:true,},{trigger:"button[special=save]",extra_trigger:".o_form_nosheet",content:_t("Enter the requested dates and check the price.\n Then, click here to add the product."),position:'bottom',},{trigger:'.o_form_button_save',extra_trigger:'.o_sale_order',content:_t("Save the quotation."),position:'bottom',},{trigger:'button[name=action_confirm]',extra_trigger:'.o_form_button_edit',content:_t("Confirm the order when the customer agrees with the terms."),position:'bottom',},{trigger:'button[name=open_pickup]',extra_trigger:'.o_sale_order',content:_t("Click here to register the pickup."),position:'bottom',},{trigger:"button[name='apply']",content:_t("Validate the operation after checking the picked-up quantities."),position:'bottom',},{trigger:"button[name='open_return']",extra_trigger:'.o_sale_order',content:_t("Once the rental is done, you can register the return."),position:'bottom',},{trigger:"button[name='apply']",content:_t("Confirm the returned quantities and hit Validate."),position:'bottom',}]);});;

/* /sale_renting/static/src/js/rental_configurator_widget.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sale_renting.rental_configurator',function(require){var core=require('web.core');var ProductConfiguratorWidget=require('sale.product_configurator');var _t=core._t;ProductConfiguratorWidget.include({_addConfigurationEditButton:function(){if(this.recordData.is_rental){var $inputDropdown=this.$('.o_input_dropdown');if($inputDropdown.length!==0&&this.$('.o_edit_product_configuration').length===0){var $editConfigurationButton=$('<button>',{type:'button',class:'fa fa-calendar btn btn-secondary o_edit_product_configuration',tabindex:'-1',draggable:false,'aria-label':_t('Edit dates'),title:_t('Edit dates')});$inputDropdown.after($editConfigurationButton);}}else{this._super.apply(this,arguments);}},_isConfigurableLine:function(){return this.recordData.is_rental||this._super.apply(this,arguments);},_onProductChange:function(productId,dataPointID){var self=this;return this._super.apply(this,arguments).then(function(stopPropagation){if(stopPropagation){return Promise.resolve(true);}else{return self._checkIfRentable(productId,dataPointID);}});},_checkIfRentable:function(productId,dataPointID){var self=this;if(productId&&this.nodeOptions.rent){return this._rpc({model:'product.product',method:'read',args:[productId,['rent_ok']],}).then(function(r){if(r&&r[0].rent_ok){self._openRentalConfigurator({default_product_id:productId},dataPointID);return Promise.resolve(true);}
return Promise.resolve(false);});}
return Promise.resolve(false);},_defaultRentalData:function(data){data=data||{};if(this.recordData.pickup_date){data.default_pickup_date=this.recordData.pickup_date;}
if(this.recordData.return_date){data.default_return_date=this.recordData.return_date;}
if(!data.default_product_id){data.default_product_id=this.recordData.product_id.data.id;}
if(this.recordData.id){data.default_rental_order_line_id=this.recordData.id;}
data.default_quantity=this.recordData.product_uom_qty;if(this.recordData.product_uom){data.default_uom_id=this.recordData.product_uom.data.id;}
data.default_pricelist_id=this.record.evalContext.parent.pricelist_id;data.default_company_id=this.record.evalContext.parent.company_id;if(!data.default_pickup_date&&!data.default_return_date){var parent=this.getParent();var defaultPickupDate,defaultReturnDate;if(parent.state.data.length>1){parent.state.data.forEach(function(item){if(item.data.is_rental){defaultPickupDate=item.data.pickup_date;defaultReturnDate=item.data.return_date;}});if(defaultPickupDate){data.default_pickup_date=defaultPickupDate;}
if(defaultReturnDate){data.default_return_date=defaultReturnDate;}}}
if(this.recordData.reserved_lot_ids){data.default_warehouse_id=this.record.evalContext.parent.warehouse_id;data.default_lot_ids=this._convertFromMany2Many(this.recordData.reserved_lot_ids);}
return data;},_onEditLineConfiguration:function(){if(this.recordData.is_rental){this._openRentalConfigurator({},this.dataPointID);}else{this._super.apply(this,arguments);}},_openRentalConfigurator:function(data,dataPointId){var self=this;this.do_action('sale_renting.rental_configurator_action',{additional_context:self._defaultRentalData(data),on_close:function(result){if(result&&!result.special){self.trigger_up('field_changed',{dataPointID:dataPointId,changes:result.rentalConfiguration,onSuccess:function(){self._onLineConfigured();}});}else{if(!self.recordData.pickup_date||!self.recordData.return_date){self.trigger_up('field_changed',{dataPointID:dataPointId,changes:{product_id:false,name:''},});}}}});},});return ProductConfiguratorWidget;});;

/* /sale_stock/static/src/js/qty_at_date_widget.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sale_stock.QtyAtDateWidget',function(require){"use strict";var core=require('web.core');var QWeb=core.qweb;var Widget=require('web.Widget');var widget_registry=require('web.widget_registry');var utils=require('web.utils');var _t=core._t;var time=require('web.time');var QtyAtDateWidget=Widget.extend({template:'sale_stock.qtyAtDate',events:_.extend({},Widget.prototype.events,{'click .fa-area-chart':'_onClickButton',}),init:function(parent,params){this.data=params.data;this.fields=params.fields;this._updateData();this._super(parent);},start:function(){var self=this;return this._super.apply(this,arguments).then(function(){self._setPopOver();});},_updateData:function(){if(this.data.scheduled_date){this.data.will_be_fulfilled=utils.round_decimals(this.data.free_qty_today,this.fields.virtual_available_at_date.digits[1])>=utils.round_decimals(this.data.qty_to_deliver,this.fields.qty_to_deliver.digits[1]);this.data.will_be_late=this.data.forecast_expected_date&&this.data.forecast_expected_date>this.data.scheduled_date;if(['draft','sent'].includes(this.data.state)){this.data.forecasted_issue=!this.data.will_be_fulfilled&&!this.data.is_mto;}else{this.data.forecasted_issue=!this.data.will_be_fulfilled||this.data.will_be_late;}}},updateState:function(state){this.$el.popover('dispose');var candidate=state.data[this.getParent().currentRow];if(candidate){this.data=candidate.data;this._updateData();this.renderElement();this._setPopOver();}},async _openForecast(ev){ev.stopPropagation();var action=await this._rpc({model:'product.product',method:'action_product_forecast_report',args:[[this.data.product_id.data.id]]});action.context={active_model:'product.product',active_id:this.data.product_id.data.id,warehouse:this.data.warehouse_id&&this.data.warehouse_id.res_id};return this.do_action(action);},_getContent(){if(!this.data.scheduled_date){return;}
this.data.delivery_date=this.data.scheduled_date.clone().add(this.getSession().getTZOffset(this.data.scheduled_date),'minutes').format(time.getLangDateFormat());if(this.data.forecast_expected_date){this.data.forecast_expected_date_str=this.data.forecast_expected_date.clone().add(this.getSession().getTZOffset(this.data.forecast_expected_date),'minutes').format(time.getLangDateFormat());}
const $content=$(QWeb.render('sale_stock.QtyDetailPopOver',{data:this.data,}));$content.on('click','.action_open_forecast',this._openForecast.bind(this));return $content;},_setPopOver(){const $content=this._getContent();if(!$content){return;}
const options={content:$content,html:true,placement:'left',title:_t('Availability'),trigger:'focus',delay:{'show':0,'hide':100},};this.$el.popover(options);},_onClickButton:function(){this.$el.find('.fa-area-chart').prop('special_click',true);},});widget_registry.add('qty_at_date_widget',QtyAtDateWidget);return QtyAtDateWidget;});;

/* /website_sale/static/src/js/website_sale_video_field_preview.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('website_sale.video_field_preview',function(require){"use strict";var AbstractField=require('web.AbstractField');var core=require('web.core');var fieldRegistry=require('web.field_registry');var QWeb=core.qweb;var FieldVideoPreview=AbstractField.extend({className:'d-block o_field_video_preview',_render:function(){this.$el.html(QWeb.render('productVideo',{embedCode:this.value,}));},});fieldRegistry.add('video_preview',FieldVideoPreview);return FieldVideoPreview;});;

/* /website_sale/static/src/js/website_sale_backend.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('website_sale.backend',function(require){"use strict";var WebsiteBackend=require('website.backend.dashboard');var COLORS=['#875a7b','#21b799','#E4A900','#D5653E','#5B899E','#E46F78','#8F8F8F'];WebsiteBackend.include({jsLibs:['/web/static/lib/Chart/Chart.js',],events:_.defaults({'click tr.o_product_template':'on_product_template','click .js_utm_selector':'_onClickUtmButton',},WebsiteBackend.prototype.events),init:function(parent,context){this._super(parent,context);this.graphs.push({'name':'sales','group':'sale_salesman'});},render_graphs:function(){this._super();this.utmGraphData=this.dashboards_data.sales.utm_graph;this.utmGraphData&&this._renderUtmGraph();},_renderUtmGraph:function(){var self=this;this.$(".utm_button_name").html(this.btnName);var utmDataType=this.utmType||'campaign_id';var graphData=this.utmGraphData[utmDataType];if(graphData.length){this.$(".o_utm_no_data_img").hide();this.$(".o_utm_data_graph").empty().show();var $canvas=$('<canvas/>');this.$(".o_utm_data_graph").append($canvas);var context=$canvas[0].getContext('2d');console.log(graphData);var data=[];var labels=[];graphData.forEach(function(pt){data.push(pt.amount_total);labels.push(pt.utm_type);});var config={type:'pie',data:{labels:labels,datasets:[{data:data,backgroundColor:COLORS,}]},options:{tooltips:{callbacks:{label:function(tooltipItem,data){var label=data.labels[tooltipItem.index]||'';if(label){label+=': ';}
var amount=data.datasets[0].data[tooltipItem.index];amount=self.render_monetary_field(amount,self.data.currency);label+=amount;return label;}}},legend:{display:false}}};new Chart(context,config);}else{this.$(".o_utm_no_data_img").show();this.$(".o_utm_data_graph").hide();}},_onClickUtmButton:function(ev){this.utmType=$(ev.currentTarget).attr('name');this.btnName=$(ev.currentTarget).text();this._renderUtmGraph();},on_product_template:function(ev){ev.preventDefault();var product_tmpl_id=$(ev.currentTarget).data('productId');this.do_action({type:'ir.actions.act_window',res_model:'product.template',res_id:product_tmpl_id,views:[[false,'form']],target:'current',},{on_reverse_breadcrumb:this.on_reverse_breadcrumb,});},});return WebsiteBackend;});;

/* /website_sale/static/src/js/tours/website_sale_shop_backend.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("website_sale.tour_shop_backend",function(require){"use strict";var tour=require("web_tour.tour");var steps=require("website_sale.tour_shop");tour.register("shop",{url:"/shop"},steps);});;

/* /website_slides/static/src/js/slide_category_one2many.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('survey.slide_category_one2many',function(require){"use strict";var Context=require('web.Context');var FieldOne2Many=require('web.relational_fields').FieldOne2Many;var FieldRegistry=require('web.field_registry');var ListRenderer=require('web.ListRenderer');var config=require('web.config');var SectionListRenderer=ListRenderer.extend({init:function(parent,state,params){this.sectionFieldName="is_category";this._super.apply(this,arguments);},_checkIfRecordIsSection:function(id){var record=this._findRecordById(id);return record&&record.data[this.sectionFieldName];},_findRecordById:function(id){return _.find(this.state.data,function(record){return record.id===id;});},_renderBodyCell:function(record,node,index,options){var $cell=this._super.apply(this,arguments);var isSection=record.data[this.sectionFieldName];if(isSection){if(node.attrs.widget==="handle"){return $cell;}else if(node.attrs.name==="name"){var nbrColumns=this._getNumberOfCols();if(this.handleField){nbrColumns--;}
if(this.addTrashIcon){nbrColumns--;}
$cell.attr('colspan',nbrColumns);}else{$cell.removeClass('o_invisible_modifier');return $cell.addClass('o_hidden');}}
return $cell;},_renderRow:function(record,index){var $row=this._super.apply(this,arguments);if(record.data[this.sectionFieldName]){$row.addClass("o_is_section");}
return $row;},_renderView:function(){var def=this._super.apply(this,arguments);var self=this;return def.then(function(){self.$('table.o_list_table').addClass('o_section_list_view');});},_onRowClicked:function(ev){var parent=this.getParent();var recordId=$(ev.currentTarget).data('id');var is_section=this._checkIfRecordIsSection(recordId);if(is_section&&parent.mode==="edit"){this.editable="bottom";}else{this.editable=null;}
this._super.apply(this,arguments);},_onCellClick:function(ev){var parent=this.getParent();var recordId=$(ev.currentTarget.parentElement).data('id');var is_section=this._checkIfRecordIsSection(recordId);if(is_section&&parent.mode==="edit"){this.editable="bottom";}else{this.editable=null;this.unselectRow();}
this._super.apply(this,arguments);},_onNavigationMove:function(ev){this.unselectRow();},});var SectionFieldOne2Many=FieldOne2Many.extend({init:function(parent,name,record,options){this._super.apply(this,arguments);this.sectionFieldName="is_category";this.rendered=false;},_getRenderer:function(){if(this.view.arch.tag==='tree'){return SectionListRenderer;}
return this._super.apply(this,arguments);},_onAddRecord:function(ev){this.editable=null;if(!config.device.isMobile){var context_str=ev.data.context&&ev.data.context[0];var context=new Context(context_str).eval();if(context['default_'+this.sectionFieldName]){this.editable="bottom";}}
this._super.apply(this,arguments);},});FieldRegistry.add('slide_category_one2many',SectionFieldOne2Many);});;

/* /website_slides/static/src/js/rating_field_backend.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('website_slides.ratingField',function(require){"use strict";var basicFields=require('web.basic_fields');var fieldRegistry=require('web.field_registry');var core=require('web.core');var QWeb=core.qweb;var FieldFloatRating=basicFields.FieldFloat.extend({xmlDependencies:!basicFields.FieldFloat.prototype.xmlDependencies?['/portal_rating/static/src/xml/portal_tools.xml']:basicFields.FieldFloat.prototype.xmlDependencies.concat(['/portal_rating/static/src/xml/portal_tools.xml']),_render:function(){var self=this;return Promise.resolve(this._super()).then(function(){self.$el.html(QWeb.render('portal_rating.rating_stars_static',{'val':self.value/2,'inline_mode':true}));});},});fieldRegistry.add('field_float_rating',FieldFloatRating);return{FieldFloatRating:FieldFloatRating,};});;

/* /website_slides/static/src/js/activity.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('website_slides.Activity',function(require){"use strict";var field_registry=require('web.field_registry');require('mail.Activity');var KanbanActivity=field_registry.get('kanban_activity');function applyInclude(Activity){Activity.include({events:_.extend({},Activity.prototype.events,{'click .o_activity_action_grant_access':'_onGrantAccess','click .o_activity_action_refuse_access':'_onRefuseAccess',}),_onGrantAccess:function(event){var self=this;var partnerId=$(event.currentTarget).data('partner-id');this._rpc({model:'slide.channel',method:'action_grant_access',args:[this.res_id,partnerId],}).then(function(result){self.trigger_up('reload');});},_onRefuseAccess:function(event){var self=this;var partnerId=$(event.currentTarget).data('partner-id');this._rpc({model:'slide.channel',method:'action_refuse_access',args:[this.res_id,partnerId],}).then(function(){self.trigger_up('reload');});},});}
applyInclude(KanbanActivity);});odoo.define('website_slides/static/src/components/activity/activity.js',function(require){'use strict';const components={Activity:require('mail/static/src/components/activity/activity.js'),};const{patch}=require('web.utils');patch(components.Activity,'website_slides/static/src/components/activity/activity.js',{async _onGrantAccess(ev){await this.env.services.rpc({model:'slide.channel',method:'action_grant_access',args:[[this.activity.thread.id]],kwargs:{partner_id:this.activity.requestingPartner.id},});this.trigger('reload');},async _onRefuseAccess(ev){await this.env.services.rpc({model:'slide.channel',method:'action_refuse_access',args:[[this.activity.thread.id]],kwargs:{partner_id:this.activity.requestingPartner.id},});this.trigger('reload');},});});;

/* /event_sale/static/src/js/event_configurator_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('event.EventConfiguratorFormController',function(require){"use strict";var FormController=require('web.FormController');var EventConfiguratorFormController=FormController.extend({saveRecord:function(){var self=this;return this._super.apply(this,arguments).then(function(){var state=self.renderer.state.data;self.do_action({type:'ir.actions.act_window_close',infos:{eventConfiguration:{event_id:{id:state.event_id.data.id},event_ticket_id:{id:state.event_ticket_id.data.id}}}});});}});return EventConfiguratorFormController;});;

/* /event_sale/static/src/js/event_configurator_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('event.EventConfiguratorFormView',function(require){"use strict";var EventConfiguratorFormController=require('event.EventConfiguratorFormController');var FormView=require('web.FormView');var viewRegistry=require('web.view_registry');var EventConfiguratorFormView=FormView.extend({config:_.extend({},FormView.prototype.config,{Controller:EventConfiguratorFormController}),});viewRegistry.add('event_configurator_form',EventConfiguratorFormView);return EventConfiguratorFormView;});;

/* /event_sale/static/src/js/event_configurator_widget.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('event_sale.product_configurator',function(require){var ProductConfiguratorWidget=require('sale.product_configurator');ProductConfiguratorWidget.include({_isConfigurableLine:function(){return this.recordData.event_ok||this._super.apply(this,arguments);},_onProductChange:function(productId,dataPointId){var self=this;return this._super.apply(this,arguments).then(function(stopPropagation){if(stopPropagation){return Promise.resolve(true);}else{return self._checkForEvent(productId,dataPointId);}});},_checkForEvent:function(productId,dataPointId){var self=this;return this._rpc({model:'product.product',method:'read',args:[productId,['event_ok']],}).then(function(result){if(result&&result[0].event_ok){self._openEventConfigurator({default_product_id:productId},dataPointId);return Promise.resolve(true);}
return Promise.resolve(false);});},_onEditLineConfiguration:function(){if(this.recordData.event_ok){var defaultValues={default_product_id:this.recordData.product_id.data.id};if(this.recordData.event_id){defaultValues.default_event_id=this.recordData.event_id.data.id;}
if(this.recordData.event_ticket_id){defaultValues.default_event_ticket_id=this.recordData.event_ticket_id.data.id;}
this._openEventConfigurator(defaultValues,this.dataPointID);}else{this._super.apply(this,arguments);}},_openEventConfigurator:function(data,dataPointId){var self=this;this.do_action('event_sale.event_configurator_action',{additional_context:data,on_close:function(result){if(result&&!result.special){self.trigger_up('field_changed',{dataPointID:dataPointId,changes:result.eventConfiguration,onSuccess:function(){self._onLineConfigured();}});}else{if(!self.recordData.event_id||!self.recordData.event_ticket_id){self.trigger_up('field_changed',{dataPointID:dataPointId,changes:{product_id:false,name:''},});}}}});}});return ProductConfiguratorWidget;});;

/* /sale_expense/static/src/js/sale_order_many2one.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sale_expense.sale_order_many2one',function(require){"use strict";var FieldMany2One=require('web.relational_fields').FieldMany2One;var FieldRegistry=require('web.field_registry');var OrderField=FieldMany2One.extend({_manageSearchMore:function(values){return values;}});FieldRegistry.add('sale_order_many2one',OrderField);return OrderField;});;

/* /sale_product_matrix/static/src/js/product_matrix_configurator.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sale_product_matrix.product_configurator',function(require){var ProductConfiguratorWidget=require('sale_product_configurator.product_configurator');ProductConfiguratorWidget.include({_openConfigurator:function(result,productTemplateId,dataPointId){var self=this;var mode=result.mode;this._super.apply(this,arguments).then(function(configuratorOpened){if(!configuratorOpened&&mode==='matrix'){self._openGridConfigurator(productTemplateId,dataPointId);return Promise.resolve(true);}
return Promise.resolve(configuratorOpened);});},_openGridConfigurator:function(productTemplateId,dataPointId,edit){var attribs=edit?this._getPTAVS():[];this.trigger_up('open_matrix',{product_template_id:productTemplateId,model:'sale.order',dataPointId:dataPointId,edit:edit,editedCellAttributes:attribs,});},_onEditProductConfiguration:function(){if(!this.recordData.is_configurable_product){this._super.apply(this,arguments);return;}
var self=this;var productTemplateId=this.recordData.product_template_id.data.id;this._rpc({model:'product.template',method:'read',args:[productTemplateId,['product_add_mode']],}).then(function(result){if(result&&result[0].product_add_mode==='matrix'){self._openGridConfigurator(productTemplateId,self.dataPointID,true);}else{self._openProductConfigurator({configuratorMode:'edit',default_product_template_id:self.recordData.product_template_id.data.id,default_pricelist_id:self._getPricelistId(),default_product_template_attribute_value_ids:self._convertFromMany2Many(self.recordData.product_template_attribute_value_ids),default_product_no_variant_attribute_value_ids:self._convertFromMany2Many(self.recordData.product_no_variant_attribute_value_ids),default_product_custom_attribute_value_ids:self._convertFromOne2Many(self.recordData.product_custom_attribute_value_ids),default_quantity:self.recordData.product_uom_qty},self.dataPointID);}});},_getPTAVS:function(){var PTAVSIDS=[];_.each(this.recordData.product_no_variant_attribute_value_ids.res_ids,function(id){PTAVSIDS.push(id);});_.each(this.recordData.product_template_attribute_value_ids.res_ids,function(id){PTAVSIDS.push(id);});return PTAVSIDS.sort(function(a,b){return a-b;});}});});;

/* /sale_stock_renting/static/src/js/rental_configurator_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sale_stock_renting.RentalConfiguratorFormController',function(require){"use strict";var RentalConfiguratorFormController=require('sale_renting.RentalConfiguratorFormController');RentalConfiguratorFormController.include({_getRentalInfo:function(state){var infos=this._super.apply(this,arguments);var ids=this._convertFromMany2Many(state.lot_ids.data);var lotCommands=[{operation:'DELETE_ALL'},{operation:'ADD_M2M',ids:ids}];infos['reserved_lot_ids']={operation:'MULTI',commands:lotCommands};return infos;},_convertFromMany2Many:function(recordData){if(recordData){var ids=[];_.each(recordData,function(data){ids.push({id:parseInt(data.res_id)});});return ids;}
return null;}});return RentalConfiguratorFormController;});;

/* /sale_stock_renting/static/src/js/rental_qty_at_date_widget.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sale_stock_renting.QtyAtDateWidget',function(require){"use strict";const core=require('web.core');const QWeb=core.qweb;const Context=require('web.Context');const data_manager=require('web.data_manager');const time=require('web.time');const QtyAtDateWidget=require('sale_stock.QtyAtDateWidget');QtyAtDateWidget.include({async _onRentalGanttView(ev){ev.stopPropagation();const action=await data_manager.load_action('sale_renting.action_rental_order_schedule');const additional_context={restrict_renting_products:true};action.context=new Context(action.context,additional_context);action.domain=[['product_id','=',this.data.product_id.data.id]];return this.do_action(action);},_getContent(){if(!this.data.is_rental){return this._super();}
this.data.end_date=this.data.return_date.clone().add(this.getSession().getTZOffset(this.data.return_date),'minutes').format(time.getLangDateFormat());this.data.start_date=this.data.pickup_date.clone().add(this.getSession().getTZOffset(this.data.pickup_date),'minutes').format(time.getLangDateFormat());const $content=$(QWeb.render('sale_stock_renting.QtyDetailPopOver',{data:this.data,}));$content.on('click','.action_open_renting',this._onRentalGanttView.bind(this));return $content;},});});;

/* /sale_subscription/static/src/js/tours/sale_subscription.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sale_subscription.tour',function(require){"use_strict";var core=require('web.core');var tour=require('web_tour.tour');var _t=core._t;tour.register('sale_subscription_tour',{url:"/web",},[{trigger:'.o_app[data-menu-xmlid="sale_subscription.menu_sale_subscription_root"]',content:_t('Want recurring billing via subscription management ? Get started by clicking here'),position:'bottom',},{trigger:'.dropdown-toggle[data-menu-xmlid="sale_subscription.menu_sale_subscription_config"]',content:_t('Configure your subscription templates here'),position:'bottom',},{trigger:'.o_menu_entry_lvl_2[data-menu-xmlid="sale_subscription.menu_template_of_subscription"]',content:_t('Click here to create <b>your first subscription template</b>'),position:'top',},{trigger:'.o-kanban-button-new',extra_trigger:'.o_subscription_kanban',content:_t('Let\'s create your first subscription template.'),position:'bottom',width:200,},{trigger:'div.oe_title input',extra_trigger:'.o_form_editable',content:_t('Enter a name for this template.<br/><i>(e.g. eLearning Yearly)</i>'),position:'right',width:200,},{trigger:'select.field_rule_type',extra_trigger:'.o_form_editable',content:_t('Choose the recurrence for this template.<br/><i>(e.g. 1 time per Year)</i>'),position:'right',width:200,},{trigger:'.o_form_button_save',content:_t('Save this template and the modifications you\'ve made to it.'),position:'bottom',},{trigger:'.dropdown-toggle[data-menu-xmlid="sale_subscription.menu_sale_subscription"]',content:_t('Let\'s go to the catalog to create our first subscription product'),position:'bottom',},{trigger:'.o_menu_entry_lvl_2[data-menu-xmlid="sale_subscription.menu_sale_subscription_product"]',content:_t('Create your first subscription product here'),position:'top',},{trigger:'.o_list_button_add',content:_t('Go ahead and create a new product'),position:'right',width:200,},{trigger:'input.o_field_widget[name="name"]',content:_t('Choose a product name.<br/><i>(e.g. eLearning Access)</i>'),position:'right',width:200,},{trigger:'li.page_sales a',extra_trigger:'.o_form_editable',content:_t('Link your product to a subscription template in this tab'),position:'top',},{trigger:'.o_field_widget.field_sub_template_id',extra_trigger:'.o_form_editable',content:_t('Select your newly created template. Every sale of this product will generate a new subscription!'),position:'top',},{trigger:'.o_form_button_save',content:_t('Save and you\'re all set!<br/>Simply sell this product to create a subscription automatically or create a subscription manually!'),position:'right',width:400,},]);});;

/* /snailmail_account_followup/static/src/js/followup_form_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('snailmail_account_followup.FollowupFormController',function(require){"use strict";var FollowupFormController=require('account_followup.FollowupFormController');FollowupFormController.include({renderButtons:function(){this._super.apply(this,arguments);this.$buttons.on('click','.o_account_followup_send_letter_button',this._onSendLetter.bind(this));},updateButtons:function(){if(!this.$buttons){return;}
this._super.apply(this,arguments);var followupLevel=this.model.localData[this.handle].data.followup_level;if(followupLevel.send_letter){this.$buttons.find('button.o_account_followup_send_letter_button').removeClass('btn-secondary').addClass('btn-primary');}else{this.$buttons.find('button.o_account_followup_send_letter_button').removeClass('btn-primary').addClass('btn-secondary');}},_update:function(){this.updateButtons();return this._super.apply(this,arguments);},_onSendLetter:function(){var self=this;this.model.doSendLetter(this.handle);this.updateButtons();var res_id=this.model.get(this.handle,{raw:true}).res_id;this.do_action('snailmail_account_followup.followup_send',{additional_context:{active_ids:[res_id]},on_close:function(){self.trigger_up('reload');}});},});});;

/* /snailmail_account_followup/static/src/js/followup_form_model.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('snailmail_account_followup.FollowupFormModel',function(require){"use strict";var FollowupFormModel=require('account_followup.FollowupFormModel');FollowupFormModel.include({doSendLetter:function(handle){var level=this.localData[handle].data.followup_level;if(level&&level.send_letter){level.send_letter=false;}},});});;

/* /website_sale_dashboard/static/src/js/website_sale_dashboard_view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('website_sale_dashboard.WebsiteSaleDashboardView',function(require){"use strict";var DashboardView=require('web_dashboard.DashboardView');var viewRegistry=require('web.view_registry');var WebsiteSaleDashboardController=require('website_sale_dashboard.WebsiteSaleDashboardController');var WebsiteSaleDashboardView=DashboardView.extend({config:_.extend({},DashboardView.prototype.config,{Controller:WebsiteSaleDashboardController}),});viewRegistry.add('website_sale_dashboard',WebsiteSaleDashboardView);return WebsiteSaleDashboardView;});;

/* /website_sale_dashboard/static/src/js/website_sale_dashboard_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('website_sale_dashboard.WebsiteSaleDashboardController',function(require){"use strict";var core=require('web.core');var DashboardController=require('web_dashboard.DashboardController');var qweb=core.qweb;var WebsiteSaleDashboardController=DashboardController.extend({renderButtons:function($node){this.$buttons=$('<div>');this.$buttons.append(qweb.render("website.GoToButtons",{widget:this}));if($node){this.$buttons.appendTo($node);}},});return WebsiteSaleDashboardController;});;

/* /sale_subscription_dashboard/static/src/js/sale_subscription_dashboard.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sale_subscription_dashboard.dashboard',function(require){'use strict';var AbstractAction=require('web.AbstractAction');var core=require('web.core');var datepicker=require('web.datepicker');var Dialog=require('web.Dialog');var field_utils=require('web.field_utils');var session=require('web.session');var time=require('web.time');var utils=require('web.utils');var web_client=require('web.web_client');var Widget=require('web.Widget');var relational_fields=require('web.relational_fields');var StandaloneFieldManagerMixin=require('web.StandaloneFieldManagerMixin');var ajax=require('web.ajax');var WarningDialog=require('web.CrashManager').WarningDialog;var FieldMany2ManyTags=relational_fields.FieldMany2ManyTags;var _t=core._t;var QWeb=core.qweb;var DATE_FORMAT=time.getLangDateFormat();var FORMAT_OPTIONS={humanReadable:function(value){return Math.abs(value)>=1000;},minDigits:1,decimals:2,formatterCallback:function(str){return str;},};var sale_subscription_dashboard_abstract=AbstractAction.extend(StandaloneFieldManagerMixin,{jsLibs:['/web/static/lib/Chart/Chart.js',],hasControlPanel:true,events:{'click .js_foldable_trigger':'preventMenuFold','click .js_subscription_dashboard_date_filter':'handleDateSelection'},init:function(parent,action){this._super.apply(this,arguments);StandaloneFieldManagerMixin.init.call(this);this.$dateFilter=undefined;this.contract_templates=[];this.companies=[];this.tags=[];this.sales_team=[];this.dashboard_options={filter:'last_month',ranges:{this_quarter:{date_from:undefined,date_to:undefined},this_year:{date_from:undefined,date_to:undefined},last_quarter:{date_from:undefined,date_to:undefined},last_year:{date_from:undefined,date_to:undefined},this_month:{date_from:undefined,date_to:undefined},last_month:{date_from:undefined,date_to:undefined},}};},start:async function(){const[res,data]=await Promise.all([this._super(),this.fetch_data()]);this.render_dashboard();return res;},on_reverse_breadcrumb:function(){this.update_cp();web_client.do_push_state({action:this.main_dashboard_action_id});},load_action:function(view_xmlid,options){var self=this;options.on_reverse_breadcrumb=this.on_reverse_breadcrumb;if(options.push_main_state&&self.main_dashboard_action_id){options.pushState=false;}
return this.do_action(view_xmlid,options).then(function(){if(options.push_main_state&&self.main_dashboard_action_id){web_client.do_push_state({action:self.main_dashboard_action_id});}});},convert_dates:function(string_ranges){const ranges={};for(const element in string_ranges){ranges[element]={'date_from':moment(string_ranges[element].date_from),'date_to':moment(string_ranges[element].date_to)};}
return ranges;},on_update_options:function(){this.filters.template_ids=this.get_filtered_template_ids();this.filters.tag_ids=this.get_filtered_tag_ids();this.filters.sale_team_ids=this.get_filtered_sales_team_ids();var company_ids=this.get_filtered_company_ids();if(!company_ids||!company_ids.length){Dialog.alert(this,_t('Select at least one company.'),{title:_t('Warning'),});return;}
var self=this;return self._rpc({route:'/sale_subscription_dashboard/companies_check',params:{company_ids:company_ids,context:session.user_context},},{shadow:true}).then(function(response){if(response.result===true){self.currency_id=response.currency_id;self.filters.company_ids=company_ids;self.$('.o_content').empty();self.render_dashboard();}else{Dialog.alert(self,response.error_message,{title:_t('Warning'),});}});},get_filtered_template_ids:function(){var $contract_inputs=this.$searchview.find(".o_contract_template_filter.selected");return _.map($contract_inputs,function(el){return $(el).data('id');});},get_filtered_tag_ids:function(){var $tag_inputs=this.$searchview.find(".o_tags_filter.selected");return _.map($tag_inputs,function(el){return $(el).data('id');});},get_filtered_company_ids:function(){if(this.companies&&this.companies.length===1){return[this.companies[0].id];}else{var $company_inputs=this.$searchview.find(".o_companies_filter.selected");return _.map($company_inputs,function(el){return $(el).data('id');});}},get_filtered_sales_team_ids:function(){var $sales_team_inputs=this.$searchview.find(".o_sales_team_filter.selected");return _.map($sales_team_inputs,function(el){return $(el).data('id');});},render_filters:function(){var self=this;if(this.contract_templates.length||this.companies.length||this.tags.length||this.sales_team.length){self.$searchview=$(QWeb.render("sale_subscription_dashboard.dashboard_option_filters",{widget:this}));}
this.$searchview.on('click','.js_tag',function(e){e.preventDefault();$(e.target).toggleClass('selected');});_.each(this.filters.template_ids,function(id){self.$searchview.find('.o_contract_template_filter[data-id='+id+']').addClass('selected');});_.each(this.filters.tag_ids,function(id){self.$searchview.find('.o_tags_filter[data-id='+id+']').addClass('selected');});_.each(this.filters.company_ids,function(id){self.$searchview.find('.o_companies_filter[data-id='+id+']').addClass('selected');});_.each(this.filters.sale_team_ids,function(id){self.$searchview.find('.o_sales_team_filter[data-id='+id+']').addClass('selected');});},update_cp:function(){const PeriodChange=this.$searchview&&this.dashboard_options.filter!==this.$searchview.find('.o_predefined_range.selected').data('filter');let def;if(!this.$searchview||PeriodChange){this.render_filters();this.$searchview.filter('.o_update_options').on('click',this.on_update_options);def=this.set_up_datetimepickers({});}
const self=this;Promise.resolve(def).then(function(){self.updateControlPanel({cp_content:{$searchview:self.$searchview,$buttons:self.$cpButton},});});},set_up_datetimepickers:function(datetimeContext){const dates_options={filter:this.dashboard_options.filter,date_from:this.start_date.format('YYYY-MM-DD'),date_to:this.end_date.format('YYYY-MM-DD'),};this.$dateFilter=$(QWeb.render("sale_subscription_dashboard.date_filter",dates_options));if(datetimeContext.salesman){this.$searchview.find('.o_subscription_dashboard_filter_date').append(this.$dateFilter);}else{this.$searchview.filter('.o_subscription_dashboard_filter_date').append(this.$dateFilter);}
const $dateTimePickers=this.$searchview.find('.js_subscription_dashboard_datetimepicker');const options={locale:moment.locale(),format:'L',icons:{date:"fa fa-calendar",},};const self=this;$dateTimePickers.each(function(){const name=$(this).find('input').attr('name');const defaultValue=$(this).data('default-value');$(this).datetimepicker(options);const dt=new datepicker.DateWidget(options);dt.replace($(this)).then(function(){dt.$el.find('input').attr('name',name);if(defaultValue){dt.setValue(moment(defaultValue));}});});this.$dateFilter.find('.js_format_date').each(function(key,dt){const date_value=$(dt).html();$(dt).html((new moment(date_value,'YYYY-MM-DD')).format('ll'));});this.$dateFilter.find('.js_foldable_trigger').click(function(event){$(this).toggleClass('o_closed_menu o_open_menu');self.$dateFilter.find('.o_foldable_menu[data-filter="'+$(this).data('filter')+'"]').toggleClass('o_closed_menu');});this.$searchview.find('[data-filter="'+this.dashboard_options.filter+'"]').addClass('selected');},preventMenuFold:function(e){e.stopPropagation();},handleDateSelection:function(e){this.dashboard_options.filter=$(e.currentTarget).data('filter');let error=false;if($(e.currentTarget).data('filter')==='custom'){const dateFrom=this.$searchview.find('.o_datepicker_input[name="date_from"]');const dateTo=this.$searchview.find('.o_datepicker_input[name="date_to"]');if(dateFrom.length>0){error=dateFrom.val()===""||dateTo.val()==="";this.start_date=field_utils.parse.date(dateFrom.val());this.end_date=field_utils.parse.date(dateTo.val());}else{error=dateTo.val()==="";this.end_date=field_utils.parse.date(dateTo.val());}}else if($(e.currentTarget).hasClass('o_predefined_range')){this.start_date=this.dashboard_options.ranges[this.dashboard_options.filter].date_from;this.end_date=this.dashboard_options.ranges[this.dashboard_options.filter].date_to;}
if(error){new WarningDialog(this,{title:_t("Odoo Warning"),},{message:_t("Date cannot be empty")}).open();}else{this.on_update_options();}},render_dashboard:function(){},fetch_data:function(){},format_number:function(value,symbol){value=value||0.0;value=utils.human_number(value);if(symbol==='currency'){return render_monetary_field(value,this.currency_id);}else{return value+symbol;}},});var sale_subscription_dashboard_main=sale_subscription_dashboard_abstract.extend({events:Object.assign({},sale_subscription_dashboard_abstract.prototype.events,{'click .on_stat_box':'on_stat_box','click .on_forecast_box':'on_forecast_box','click .on_demo_contracts':'on_demo_contracts','click .on_demo_templates':'on_demo_templates',}),init:function(parent,action){this._super.apply(this,arguments);this.main_dashboard_action_id=action.id;this.start_date=moment().subtract(1,'M').startOf('month');this.end_date=moment().subtract(1,'M').endOf('month');this.filters={template_ids:[],tag_ids:[],sale_team_ids:[],company_ids:[session.company_id],};this.defs=[];this.unresolved_defs_vals=[];},fetch_data:async function(){var self=this;const data=await this._rpc({route:'/sale_subscription_dashboard/fetch_data',params:{context:session.user_context},},{shadow:true},);this.stat_types=data.stat_types;this.forecast_stat_types=data.forecast_stat_types;this.currency_id=data.currency_id;this.contract_templates=data.contract_templates;this.tags=data.tags;this.companies=data.companies;this.has_mrr=data.has_mrr;this.has_template=data.has_template;this.sales_team=data.sales_team;this.dashboard_options.ranges=this.convert_dates(data.dates_ranges);},populateBoxes:function($stat_boxes,$forecast_boxes){var self=this;$stat_boxes.each(function(key,box){self.defs.push(new SaleSubscriptionDashboardStatBox(self,self.start_date,self.end_date,self.filters,self.currency_id,self.stat_types,box.getAttribute('name'),box.getAttribute('code'),self.has_mrr).replace($(box)));});$forecast_boxes.each(function(key,box){self.defs.push(new SaleSubscriptionDashboardForecastBox(self,self.end_date,self.filters,self.forecast_stat_types,box.getAttribute("name"),box.getAttribute("code"),self.currency_id,self.has_mrr).replace($(box)));});},on_reverse_breadcrumb:function(){this._super();var self=this;if(this.$main_dashboard){this.defs=[];if(this.unresolved_defs_vals.length){const $stat_boxes=this.$main_dashboard.find('.o_stat_box');const $forecast_boxes=this.$main_dashboard.find('.o_forecast_box');this.populateBoxes($stat_boxes,$forecast_boxes);}}else{this.render_dashboard();}},render_dashboard:function(){this.$main_dashboard=$(QWeb.render("sale_subscription_dashboard.dashboard",{has_mrr:this.has_mrr,has_template:this.has_template,stat_types:_.sortBy(_.values(this.stat_types),'prior'),forecast_stat_types:_.sortBy(_.values(this.forecast_stat_types),'prior'),start_date:this.start_date,end_date:this.end_date,}));this.$('.o_content').append(this.$main_dashboard);var $stat_boxes=this.$main_dashboard.find('.o_stat_box');var $forecast_boxes=this.$main_dashboard.find('.o_forecast_box');this.defs=[];this.populateBoxes($stat_boxes,$forecast_boxes);this.defs.push(this.update_cp());return Promise.all(this.defs);},store_unresolved_defs:function(){this.unresolved_defs_vals=[];var self=this;_.each(this.defs,function(v,k){if(v&&v.state!=="resolved"){self.unresolved_defs_vals.push(k);}});},on_stat_box:function(ev){ev.preventDefault();this.selected_stat=$(ev.currentTarget).attr('data-stat');this.store_unresolved_defs();var options={'stat_types':this.stat_types,'selected_stat':this.selected_stat,'start_date':this.start_date,'end_date':this.end_date,'contract_templates':this.contract_templates,'tags':this.tags,'companies':this.companies,'filters':this.filters,'currency_id':this.currency_id,'push_main_state':true,'sales_team':this.sales_team,'dashboard_options':this.dashboard_options,};this.load_action("sale_subscription_dashboard.action_subscription_dashboard_report_detailed",options);},on_forecast_box:function(ev){ev.preventDefault();var options={'forecast_types':this.forecast_types,'start_date':this.start_date,'end_date':this.end_date,'contract_templates':this.contract_templates,'tags':this.tags,'companies':this.companies,'filters':this.filters,'currency_id':this.currency_id,'push_main_state':true,'sales_team':this.sale_team_ids,};this.load_action("sale_subscription_dashboard.action_subscription_dashboard_report_forecast",options);},on_demo_contracts:function(ev){ev.preventDefault();this.load_action("sale_subscription.sale_subscription_action",{});},on_demo_templates:function(ev){ev.preventDefault();this.load_action("sale_subscription.sale_subscription_template_action",{});},});var sale_subscription_dashboard_detailed=sale_subscription_dashboard_abstract.extend({events:Object.assign({},sale_subscription_dashboard_abstract.prototype.events,{'click .o_detailed_analysis':'on_detailed_analysis',}),init:function(parent,action,options){this._super.apply(this,arguments);this.main_dashboard_action_id=options.main_dashboard_action_id;this.stat_types=options.stat_types;this.start_date=options.start_date;this.end_date=options.end_date;this.selected_stat=options.selected_stat;this.contract_templates=options.contract_templates;this.tags=options.tags;this.companies=options.companies;this.filters=options.filters;this.currency_id=options.currency_id;this.sales_team=options.sales_team;this.dashboard_options=options.dashboard_options;this.display_stats_by_plan=!_.contains(['nrr','arpu','logo_churn'],this.selected_stat);this.report_name=this.stat_types[this.selected_stat].name;},fetch_computed_stat:async function(){const data=await this._rpc({route:'/sale_subscription_dashboard/compute_stat',params:{stat_type:this.selected_stat,start_date:this.start_date.format('YYYY-MM-DD'),end_date:this.end_date.format('YYYY-MM-DD'),filters:this.filters,context:session.user_context,},},{shadow:true});this.value=data;},update_cp:function(){this.$cpButton=$(QWeb.render("sale_subscription_dashboard.detailed_analysis_btn",{stat_type:this.selected_stat,}));this._super.apply(this);},render_dashboard:function(){var self=this;return this.fetch_computed_stat().then(function(){self.$('.o_content').append(QWeb.render("sale_subscription_dashboard.detailed_dashboard",{selected_stat_values:_.findWhere(self.stat_types,{code:self.selected_stat}),start_date:self.start_date,end_date:self.end_date,stat_type:self.selected_stat,currency_id:self.currency_id,report_name:self.report_name,value:self.value,display_stats_by_plan:self.display_stats_by_plan,format_number:self.format_number,}));const defs=[];defs.push(self.render_detailed_dashboard_stats_history());defs.push(self.render_detailed_dashboard_graph());if(self.selected_stat==='mrr'){defs.push(self.render_detailed_dashboard_mrr_growth());}
if(self.display_stats_by_plan){defs.push(self.render_detailed_dashboard_stats_by_plan());}
defs.push(self.update_cp());return Promise.all(defs);});},render_detailed_dashboard_stats_history:function(){var self=this;self._rpc({route:'/sale_subscription_dashboard/get_stats_history',params:{stat_type:this.selected_stat,start_date:this.start_date.format('YYYY-MM-DD'),end_date:this.end_date.format('YYYY-MM-DD'),filters:this.filters,context:session.user_context,},},{shadow:true}).then(function(result){_.map(result,function(v,k,dict){dict[k]=Math.round(v*100)/100;});var html=QWeb.render('sale_subscription_dashboard.stats_history',{stats_history:result,stat_type:self.selected_stat,stat_types:self.stat_types,currency_id:self.currency_id,rate:self.compute_rate,get_color_class:get_color_class,value:Math.round(self.value*100)/100,format_number:self.format_number,});self.$('#o-stat-history-box').empty();self.$('#o-stat-history-box').append(html);});addLoader(this.$('#o-stat-history-box'));},render_detailed_dashboard_stats_by_plan:function(){var self=this;self._rpc({route:'/sale_subscription_dashboard/get_stats_by_plan',params:{stat_type:this.selected_stat,start_date:this.start_date.format('YYYY-MM-DD'),end_date:this.end_date.format('YYYY-MM-DD'),filters:this.filters,context:session.user_context,},},{shadow:true}).then(function(result){var html=QWeb.render('sale_subscription_dashboard.stats_by_plan',{stats_by_plan:result,stat_type:self.selected_stat,stat_types:self.stat_types,currency_id:self.currency_id,value:self.value,format_number:self.format_number,});self.$('.o_stats_by_plan').replaceWith(html);});addLoader(this.$('.o_stats_by_plan'));},compute_rate:function(old_value,new_value){return old_value===0?0:parseInt(100.0*(new_value-old_value)/old_value);},render_detailed_dashboard_graph:function(){addLoader(this.$('#stat_chart_div'));var self=this;self._rpc({route:'/sale_subscription_dashboard/compute_graph',params:{stat_type:this.selected_stat,start_date:this.start_date.format('YYYY-MM-DD'),end_date:this.end_date.format('YYYY-MM-DD'),points_limit:0,filters:this.filters,context:session.user_context,},}).then(function(result){load_chart('#stat_chart_div',self.stat_types[self.selected_stat].name,result,true);self.$('#stat_chart_div div.o_loader').hide();});},render_detailed_dashboard_mrr_growth:function(){addLoader(this.$('#mrr_growth_chart_div'));var self=this;self._rpc({route:'/sale_subscription_dashboard/compute_graph_mrr_growth',params:{start_date:this.start_date.format('YYYY-MM-DD'),end_date:this.end_date.format('YYYY-MM-DD'),points_limit:0,filters:this.filters,context:session.user_context,},},{shadow:true}).then(function(result){self.load_chart_mrr_growth_stat('#mrr_growth_chart_div',result);self.$('#mrr_growth_chart_div div.o_loader').hide();});},on_detailed_analysis:function(){var additional_context={};var view_xmlid='';if(this.selected_stat==='mrr'){additional_context={'search_default_subscription_end_date':moment(this.end_date).format('YYYY-MM-DD'),'search_default_subscription_start_date':moment(this.start_date).format('YYYY-MM-DD'),};view_xmlid="sale_subscription_dashboard.action_move_line_entries_report";}
else if(this.selected_stat==='nrr'||this.selected_stat==='net_revenue'){additional_context={};view_xmlid="account.action_account_invoice_report_all";}
this.load_action(view_xmlid,{additional_context:additional_context});},load_chart_mrr_growth_stat:function(div_to_display,result){if(!result.new_mrr){return;}
var labels=result.new_mrr.map(function(point){return moment(point[0],"YYYY-MM-DD",'en');});var datasets=[{label:_t('New MRR'),data:result.new_mrr.map(getValue),borderColor:'#26b548',fill:false,},{label:_t('Churned MRR'),data:result.churned_mrr.map(getValue),borderColor:'#df2e28',fill:false,},{label:_t('Expansion MRR'),data:result.expansion_mrr.map(getValue),borderColor:'#fed049',fill:false,},{label:_t('Down MRR'),data:result.down_mrr.map(getValue),borderColor:'#ffa500',fill:false,},{label:_t('Net New MRR'),data:result.net_new_mrr.map(getValue),borderColor:'#2693d5',fill:false,}];var $div_to_display=$(div_to_display).css({position:'relative',height:'20em'});$div_to_display.empty();var $canvas=$('<canvas/>');$div_to_display.append($canvas);var ctx=$canvas.get(0).getContext('2d');new Chart(ctx,{type:'line',data:{labels:labels,datasets:datasets,},options:{layout:{padding:{bottom:30},},maintainAspectRatio:false,tooltips:{mode:'index',intersect:false,},scales:{yAxes:[{scaleLabel:{display:true,labelString:'MRR',},type:'linear',ticks:{callback:formatValue,},}],xAxes:[{ticks:{callback:function(value){return moment(value).format(DATE_FORMAT);}},}],},}});},});var sale_subscription_dashboard_forecast=sale_subscription_dashboard_abstract.extend({events:{'change .o_forecast_input':'on_forecast_input','change input.growth_type':'on_growth_type_change',},init:function(parent,action,options){this._super.apply(this,arguments);this.main_dashboard_action_id=options.main_dashboard_action_id;this.start_date=options.start_date;this.end_date=options.end_date;this.contract_templates=options.contract_templates;this.tags=options.tags;this.companies=options.companies;this.filters=options.filters;this.currency_id=options.currency_id;this.sales_team=options.sales_team;this.values={};},willStart:function(){var self=this;return this._super().then(function(){return Promise.all([self.fetch_default_values_forecast('mrr'),self.fetch_default_values_forecast('contracts')]);});},render_dashboard:function(){this.$('.o_content').append(QWeb.render("sale_subscription_dashboard.forecast",{start_date:this.start_date,end_date:this.end_date,values:this.values,currency_id:this.currency_id,get_currency:this.get_currency,}));this.values.mrr.growth_type='linear';this.values.contracts.growth_type='linear';this.reload_chart('mrr');this.reload_chart('contracts');this.update_cp();},on_forecast_input:function(ev){var forecast_type=$(ev.target).data().forecast;var data_type=$(ev.target).data().type;this.values[forecast_type][data_type]=parseInt($(ev.target).val());this.reload_chart(forecast_type);},on_growth_type_change:function(ev){var forecast_type=$(ev.target).data().type;this.values[forecast_type].growth_type=this.$("input:radio[name=growth_type_"+forecast_type+"]:checked").val();if(this.values[forecast_type].growth_type==='linear'){this.$('#linear_growth_'+forecast_type).show();this.$('#expon_growth_'+forecast_type).hide();}
else{this.$('#linear_growth_'+forecast_type).hide();this.$('#expon_growth_'+forecast_type).show();}
this.reload_chart(forecast_type);},fetch_default_values_forecast:async function(forecast_type){const data=await this._rpc({route:'/sale_subscription_dashboard/get_default_values_forecast',params:{end_date:this.end_date.format('YYYY-MM-DD'),forecast_type:forecast_type,filters:this.filters,context:session.user_context,},},{shadow:true});this.values[forecast_type]=data;},reload_chart:function(chart_type){var computed_values=compute_forecast_values(this.values[chart_type].starting_value,this.values[chart_type].projection_time,this.values[chart_type].growth_type,this.values[chart_type].churn,this.values[chart_type].linear_growth,this.values[chart_type].expon_growth);this.load_chart_forecast('#forecast_chart_div_'+chart_type,computed_values);var content=QWeb.render('sale_subscription_dashboard.forecast_summary_'+chart_type,{values:this.values[chart_type],computed_value:parseInt(computed_values[computed_values.length-1][1]),currency_id:this.currency_id,format_number:this.format_number,});this.$('#forecast_summary_'+chart_type).replaceWith(content);},get_currency:function(){var currency=session.get_currency(this.currency_id);return currency.symbol;},format_number:function(value){value=utils.human_number(value);return render_monetary_field(value,this.currency_id);},load_chart_forecast:function(div_to_display,values){var labels=values.map(function(point){return point[0];});var datasets=[{data:values.map(getValue),backgroundColor:'rgba(38,147,213,0.2)',borderColor:'rgba(38,147,213,0.2)',borderWidth:3,pointBorderWidth:1,cubicInterpolationMode:'monotone',fill:'origin',}];var $div_to_display=this.$(div_to_display).css({position:'relative',height:'20em'});$div_to_display.empty();var $canvas=$('<canvas/>');$div_to_display.append($canvas);var ctx=$canvas.get(0).getContext('2d');new Chart(ctx,{type:'line',data:{labels:labels,datasets:datasets,},options:{layout:{padding:{bottom:30},},legend:{display:false,},maintainAspectRatio:false,tooltips:{mode:'index',intersect:false,},scales:{yAxes:[{type:'linear',ticks:{callback:formatValue,},}],xAxes:[{ticks:{callback:function(value){return moment(value).format(DATE_FORMAT);}},}],},}});},update_cp:function(){this.updateControlPanel({});},});var SaleSubscriptionDashboardStatBox=Widget.extend({template:'sale_subscription_dashboard.stat_box_content',init:function(parent,start_date,end_date,filters,currency_id,stat_types,box_name,stat_type,has_mrr){this._super(parent);this.start_date=start_date;this.end_date=end_date;this.filters=filters;this.currency_id=currency_id;this.stat_types=stat_types;this.box_name=box_name;this.stat_type=stat_type;this.tooltip=stat_types[stat_type].tooltip;this.has_mrr=has_mrr;this.chart_div_id='chart_div_'+this.stat_type;this.added_symbol=this.stat_types[this.stat_type].add_symbol;this.is_monetary=this.added_symbol==='currency';this.render_monetary_field=render_monetary_field;this.demo_values={'mrr':1000,'net_revenue':55000,'nrr':27000,'arpu':20,'arr':12000,'ltv':120,'logo_churn':7,'revenue_churn':5,'nb_contracts':50,};},start:async function(){const data=await this.compute_graph();const display_tooltip='<b>'+this.box_name+'</b><br/>'+_t('Current Value: ')+this.format_number(this.value);this.$el.tooltip({title:display_tooltip,trigger:'hover'});this.$('[data-toggle="popover"]').popover({trigger:'hover'});const options={has_mrr:this.has_mrr,format_number:this.format_number,value:this.value,demo_values:this.demo_values,stat_type:this.stat_type,currency_id:this.currency_id,added_symbol:this.added_symbol,};const $boxName=$(QWeb.render("sale_subscription_dashboard.box_name",options));this.$('.o_stat_box_card_amount').append($boxName);const $boxPerc=$(QWeb.render("sale_subscription_dashboard.box_trend",{color:this.color,perc:this.perc}));this.$('.o_trend').append($boxPerc);load_chart('#'+this.chart_div_id,false,this.computed_graph,false,!this.has_mrr);this.$('.o_loader').remove();},compute_graph:async function(){const data=await this._rpc({route:'/sale_subscription_dashboard/compute_graph_and_stats',params:{stat_type:this.stat_type,start_date:this.start_date.format('YYYY-MM-DD'),end_date:this.end_date.format('YYYY-MM-DD'),points_limit:30,filters:this.filters,context:session.user_context,},},{shadow:true},);this.value=data.stats.value_2;this.perc=data.stats.perc;this.color=get_color_class(data.stats.perc,this.stat_types[this.stat_type].dir);this.computed_graph=data.graph;},format_number:function(value,currency_id){value=utils.human_number(value);if((currency_id||this.is_monetary)&&this.added_symbol){this.currency_id=(currency_id)?currency_id:this.currency_id;return render_monetary_field(value,this.currency_id);}else{return value+this.added_symbol;}},});var SaleSubscriptionDashboardForecastBox=Widget.extend({template:'sale_subscription_dashboard.forecast_stat_box_content',init:function(parent,end_date,filters,forecast_stat_types,box_name,stat_type,currency_id,has_mrr){this._super(parent);this.end_date=end_date;this.filters=filters;this.currency_id=currency_id;this.forecast_stat_types=forecast_stat_types;this.box_name=box_name;this.stat_type=stat_type;this.has_mrr=has_mrr;this.added_symbol=this.forecast_stat_types[this.stat_type].add_symbol;this.is_monetary=this.added_symbol==='currency';this.chart_div_id='chart_div_'+this.stat_type;this.render_monetary_field=render_monetary_field;this.demo_values={'mrr_forecast':12000,'contracts_forecast':240,};},start:async function(){const data=await this.compute_numbers();const display_tooltip='<b>'+this.box_name+'</b><br/>'+_t('Current Value: ')+this.format_number(this.value);this.$el.tooltip({title:display_tooltip,trigger:'hover'});const options={has_mrr:this.has_mrr,format_number:this.format_number,value:this.value,demo_values:this.demo_values,stat_type:this.stat_type,currency_id:this.currency_id,added_symbol:this.added_symbol,};const $boxName=$(QWeb.render("sale_subscription_dashboard.box_name",options));this.$('.o_stat_box_card_amount').append($boxName);load_chart('#'+this.chart_div_id,false,this.computed_graph,false,!this.has_mrr);this.$('.o_loader').remove();},compute_numbers:async function(){const data=await this._rpc({route:'/sale_subscription_dashboard/get_default_values_forecast',params:{forecast_type:this.stat_type,end_date:this.end_date.format('YYYY-MM-DD'),filters:this.filters,context:session.user_context,},},{shadow:true},);this.computed_graph=compute_forecast_values(data.starting_value,data.projection_time,'linear',data.churn,data.linear_growth,0);this.value=this.computed_graph[this.computed_graph.length-1][1];},format_number:function(value,currency_id){value=utils.human_number(value);if((currency_id||this.is_monetary)&&this.added_symbol){this.currency_id=(currency_id)?currency_id:this.currency_id;return render_monetary_field(value,this.currency_id);}else{return value+this.added_symbol;}},});var sale_subscription_dashboard_salesman=sale_subscription_dashboard_abstract.extend({init:function(){this._super.apply(this,arguments);this.start_date=moment().startOf('month');this.end_date=moment().endOf('month');this.barGraph={};this.migrationDate=false;this.currentCompany=$.bbq.getState('cids')&&parseInt($.bbq.getState('cids').split(',')[0]);},willStart:function(){return Promise.all([this._super.apply(this,arguments),this.fetch_salesmen()]);},fetch_salesmen:function(){var self=this;return self._rpc({route:'/sale_subscription_dashboard/fetch_salesmen',params:{context:session.user_context,},}).then(function(result){self.salesman_ids=result.salesman_ids;self.salesman=result.default_salesman||[];self.currency_id=result.currency_id;self.migrationDate=moment(result.migration_date,'YYYY-MM-DD');self.dashboard_options.ranges=self.convert_dates(result.dates_ranges);},{shadow:true});},render_dashboard:function(){this.update_cp();this.$('.o_content').empty().append(QWeb.render("sale_subscription_dashboard.salesmen",{salesman_ids:this.salesman_ids,salesman:this.salesman,start_date:this.start_date,end_date:this.end_date,migration_date:this.migrationDate,}));if(!jQuery.isEmptyObject(this.salesman)){this.render_dashboard_additionnal();}},render_dashboard_additionnal:function(){var self=this;addLoader(this.$('#mrr_growth_salesman'));self._rpc({route:'/sale_subscription_dashboard/get_values_salesmen',params:{start_date:this.start_date.format('YYYY-MM-DD'),end_date:this.end_date.format('YYYY-MM-DD'),salesman_ids:this.salesman,context:session.user_context,},},{shadow:true}).then(function(result){var salespersons_statistics=result.salespersons_statistics;Object.keys(salespersons_statistics).forEach(element=>{var cur_salesman=self.salesman_ids.find(val=>val.id===Number(element));self.$('.o_salesman_loop').append(QWeb.render("sale_subscription_dashboard.salesman",{salesman:cur_salesman,}));self.render_section(cur_salesman,salespersons_statistics[Number(element)]);});$('.o_subscription_row').each(function(index,value){$(this).on('click',function(){var subscription_id=$(this).data().id;var model=$(this).data().model;var action={type:'ir.actions.act_window',res_model:model,res_id:subscription_id,views:[[false,'form']],};self.do_action(action);});});});},render_section:function(cur_salesman,salesman_data){addLoader(this.$('#mrr_growth_salesman_'+cur_salesman.id));this.barGraph[cur_salesman.id]=load_chart_mrr_salesman('#mrr_growth_salesman_'+cur_salesman.id,salesman_data,this.currency_id);this.$('#mrr_growth_salesman_'+cur_salesman.id+' div.o_loader').hide();var ICON_BY_TYPE={'churn':'o_red fa fa-remove','new':'o_green fa fa-plus','down':'o_red fa fa-arrow-down','up':'o_green fa fa-arrow-up',};_.each(salesman_data.contract_modifications,function(v){v.class_type=ICON_BY_TYPE[v.type];});const nCompanies=new Set([this.currentCompany].concat(salesman_data.contract_modifications.map(value=>value.company_id)).concat(salesman_data.nrr_invoices.map(value=>value.company_id))).size;var html_modifications=QWeb.render('sale_subscription_dashboard.contract_modifications',{modifications:salesman_data.contract_modifications,get_color_class:get_color_class,format_number:this.format_number,company_currency_id:this.currency_id,nCompanies:nCompanies,});this.$('#contract_modifications_'+cur_salesman.id).append(html_modifications);var html_nrr_invoices=QWeb.render('sale_subscription_dashboard.nrr_invoices',{invoices:salesman_data.nrr_invoices,company_currency_id:this.currency_id,format_number:this.format_number,nCompanies:nCompanies,});this.$('#NRR_invoices_'+cur_salesman.id).append(html_nrr_invoices);var html_summary=QWeb.render('sale_subscription_dashboard.salesman_summary',{mrr:salesman_data.net_new,nrr:salesman_data.nrr,company_currency_id:this.currency_id,format_number:this.format_number,});this.$('#mrr_growth_salesman_'+cur_salesman.id).before(html_summary);function load_chart_mrr_salesman(div_to_display,result,currency_id){var labels=[_t("New MRR"),_t("Churned MRR"),_t("Expansion MRR"),_t("Down MRR"),_t("Net New MRR"),_t("NRR")];var datasets=[{label:_t("MRR Growth"),data:[result.new,result.churn,result.up,result.down,result.net_new,result.nrr],backgroundColor:["#1f77b4","#ff7f0e","#aec7e8","#ffbb78","#2ca02c","#98df8a"],}];var $div_to_display=$(div_to_display).css({position:'relative',height:'16em'});$div_to_display.empty();var $canvas=$('<canvas class="canvas_'+cur_salesman.id+'"/>');$div_to_display.append($canvas);var ctx=$canvas.get(0).getContext('2d');ctx.currency_id=currency_id;let ChartValuePlugin={updated:false,afterDraw:function(chart){var ctx=chart.ctx;ctx.font=chart.config.options.defaultFontFamily;ctx.fillStyle=chart.config.options.defaultFontColor;var chartdatasets=chart.data.datasets;ctx.clearRect(50,-5,2000,20);Chart.helpers.each(chartdatasets.forEach(function(dataset,i){var meta=chart.controller.getDatasetMeta(i);Chart.helpers.each(meta.data.forEach(function(bar,index){var value=utils.human_number(dataset.data[index]);ctx.fillText(render_monetary_field(value,ctx.currency_id),bar._model.x,15);}),this);}),this);}};var barGraph=new Chart(ctx,{type:'bar',plugins:[ChartValuePlugin],data:{labels:labels,datasets:datasets,},options:{layout:{padding:{bottom:15,top:17},},legend:{display:false,},maintainAspectRatio:false,tooltips:{enabled:false,},},});return barGraph;}},format_number:function(value,currency_id){if(!currency_id){currency_id=this.currency_id;}
value=utils.human_number(value);return render_monetary_field(value,currency_id);},on_update_options:function(){var selected_salesman_id=Number(this.$searchview.find('option[name="salesman"]:selected').val());this.salesman=_.findWhere(this.salesman_ids,{id:selected_salesman_id});this.render_dashboard();},update_cp:function(){var self=this;self.$searchview=$(QWeb.render("sale_subscription_dashboard.salesman_searchview"));self.set_up_datetimepickers({salesman:true});self.$cpButton=$(QWeb.render("sale_subscription_dashboard.export"));self.$cpButton.on('click',function(){ajax.rpc('/web/dataset/call_kw/sale.subscription/print_pdf',{model:'sale.subscription',method:'print_pdf',args:[],kwargs:{},},{shadow:true}).then(function(result){for(var key in self.barGraph){var base64Image=self.barGraph[key].toBase64Image();base64Image='<img src="data:image/png;base64'+base64Image+'" alt="graphic" />';$(".o_salesmen_dashboard").find(".canvas_"+key).replaceWith(base64Image).html();}
var bannerContent=$(".o_subscription_dashboard_warning").text();$(".o_subscription_dashboard_warning").text('');result.data.body_html=$(".o_salesmen_dashboard").html();$(".o_subscription_dashboard_warning").text(bannerContent);var doActionProm=self.do_action(result);return doActionProm;});});self.$searchview.on('click','.o_update_options',this.on_update_options);this.updateControlPanel({cp_content:{$searchview:this.$searchview,$buttons:this.$cpButton,},});var domainList=[];if(self.many2manytags){var values=[];for(let index=0;index<self.many2manytags.value.res_ids.length;index++){values.push(self.salesman_ids.find(val=>val.id===self.many2manytags.value.res_ids[index]));}
self.salesman=values;}
self.salesman_ids.forEach(saleman=>{domainList.push(saleman.id);});let def=self.model.makeRecord('ir.actions.act_window',[{name:'model',relation:'res.users',type:'many2many',domain:[['id','in',domainList]]}]);Promise.all([def]).then(function(recordID){var record=self.model.get(recordID);var options={mode:'edit',};self.many2manytags=new FieldMany2ManyTags(self,'model',record,options);self.many2manytags.nodeOptions.create=false;if(Object.keys(self.salesman).length>0){self.many2manytags._addTag(self.salesman);}
self._registerWidget(recordID,'model',self.many2manytags);self.many2manytags.appendTo(self.$searchview.find('.salesman_tags'));});},});function addLoader(selector){var loader='<span class="fa fa-3x fa-spin fa-spinner fa-pulse"/>';selector.html("<div class='o_loader'>"+loader+"</div>");}
function formatValue(value){var formatter=field_utils.format.float;return formatter(value,undefined,FORMAT_OPTIONS);}
function getValue(d){return d[1];}
function compute_forecast_values(starting_value,projection_time,growth_type,churn,linear_growth,expon_growth){var values=[];var cur_value=starting_value;for(var i=1;i<=projection_time;i++){var cur_date=moment().add(i,'months');if(growth_type==='linear'){cur_value=cur_value*(1-churn/100)+linear_growth;}
else{cur_value=cur_value*(1-churn/100)*(1+expon_growth/100);}
values.push({'0':cur_date,'1':cur_value,});}
return values;}
function load_chart(div_to_display,key_name,result,show_legend,show_demo){if(show_demo){result=[{"0":"2015-08-01","1":10},{"0":"2015-08-02","1":20},{"0":"2015-08-03","1":29},{"0":"2015-08-04","1":37},{"0":"2015-08-05","1":44},{"0":"2015-08-06","1":50},{"0":"2015-08-07","1":55},{"0":"2015-08-08","1":59},{"0":"2015-08-09","1":62},{"0":"2015-08-10","1":64},{"0":"2015-08-11","1":65},{"0":"2015-08-12","1":66},{"0":"2015-08-13","1":67},{"0":"2015-08-14","1":68},{"0":"2015-08-15","1":69},];}
var labels=result.map(function(point){return point[0];});var datasets=[{label:key_name,data:result.map(function(point){return point[1];}),backgroundColor:"rgba(38,147,213,0.2)",borderColor:"rgba(38,147,213,0.8)",borderWidth:3,pointBorderWidth:1,cubicInterpolationMode:'monotone',fill:'origin',}];var $div_to_display=$(div_to_display).css({position:'relative'});if(show_legend){$div_to_display.css({height:'20em'});}
$div_to_display.empty();var $canvas=$('<canvas/>');$div_to_display.append($canvas);var ctx=$canvas.get(0).getContext('2d');new Chart(ctx,{type:'line',data:{labels:labels,datasets:datasets,},options:{layout:{padding:{bottom:10},},legend:{display:show_legend,},maintainAspectRatio:false,tooltips:{enabled:show_legend,intersect:false,},scales:{yAxes:[{scaleLabel:{display:show_legend,labelString:show_legend?key_name:'',},display:show_legend,type:'linear',ticks:{callback:field_utils.format.float,},}],xAxes:[{display:show_legend,ticks:{callback:function(value){return moment(value).format(DATE_FORMAT);}},}],},}});}
function render_monetary_field(value,currency_id){var currency=session.get_currency(currency_id);if(currency){if(currency.position==="after"){value+=currency.symbol;}else{value=currency.symbol+value;}}
return value;}
function get_color_class(value,direction){var color='o_black';if(value!==0&&direction==='up'){color=(value>0)&&'o_green'||'o_red';}
if(value!==0&&direction!=='up'){color=(value<0)&&'o_green'||'o_red';}
return color;}
core.action_registry.add('sale_subscription_dashboard_main',sale_subscription_dashboard_main);core.action_registry.add('sale_subscription_dashboard_detailed',sale_subscription_dashboard_detailed);core.action_registry.add('sale_subscription_dashboard_forecast',sale_subscription_dashboard_forecast);core.action_registry.add('sale_subscription_dashboard_salesman',sale_subscription_dashboard_salesman);return{sale_subscription_dashboard_main:sale_subscription_dashboard_main,sale_subscription_dashboard_detailed:sale_subscription_dashboard_detailed,sale_subscription_dashboard_salesman:sale_subscription_dashboard_salesman,sale_subscription_dashboard_forecast:sale_subscription_dashboard_forecast};});;

/* /sale_subscription_dashboard/static/src/js/action_sale_subscription_dashboard_dl.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sale_subscription_dashboard.ActionManager',function(require){"use strict";var ActionManager=require('web.ActionManager');var framework=require('web.framework');var session=require('web.session');ActionManager.include({_executeSubscriptionDashboardDownloadAction:function(action){var self=this;framework.blockUI();return new Promise(function(resolve,reject){session.get_file({url:'/salesman_subscription_reports',data:action.data,success:resolve,error:(error)=>{self.call('crash_manager','rpc_error',error);reject();},complete:framework.unblockUI,});});},_handleAction:function(action,options){if(action.type==='ir_actions_sale_subscription_dashboard_download'){return this._executeSubscriptionDashboardDownloadAction(action,options);}
return this._super.apply(this,arguments);},});});;

/* /sale_timesheet/static/src/js/project_overview.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sale_timesheet.project_overview',function(require){"use strict";var qweb=require('web.qweb');var viewRegistry=require('web.view_registry');const Controller=qweb.Controller.extend({events:_.extend({},qweb.Controller.prototype.events,{'click .project_overview_foldable':'_onFoldToggle',}),_onFoldToggle(ev){const{model,resId}=ev.target.dataset;const shouldOpen=ev.target.classList.contains('fa-caret-right');if(model==='sale.order'&&shouldOpen){this._openSaleOrder(resId);}
else if(model==='sale.order.line'&&shouldOpen){this._openSaleOrderLine(resId);}
else{const targetClass=`.${model.replace(/\./g, '_')}_${resId || 'None'}`;this.$(targetClass).hide();}
$(ev.target).toggleClass('fa-caret-right');$(ev.target).toggleClass('fa-caret-down');},_openSaleOrder(id){id=id||'None';const targetClass=`.sale_order_${id}`;this.$(`.o_timesheet_forecast_sale_order_line${targetClass}`).show();this.$(`.o_timesheet_forecast_hr_employee${targetClass}`).hide();this.$(`.o_timesheet_forecast_sale_order_line${targetClass} .fa`).removeClass('fa-caret-down');this.$(`.o_timesheet_forecast_sale_order_line${targetClass} .fa`).addClass('fa-caret-right');},_openSaleOrderLine(id){id=id||'None';const targetClass=`.sale_order_line_${id}`;this.$(`.o_timesheet_forecast_hr_employee${targetClass}`).show();},});var ProjectOverview=qweb.View.extend({withSearchBar:true,searchMenuTypes:['filter','favorite'],config:_.extend({},qweb.View.prototype.config,{Controller:Controller,}),});viewRegistry.add('project_overview',ProjectOverview);});;

/* /sale_timesheet/static/src/js/sale_project_kanban_controller.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('sale_timesheet.sale_project_kanban_controller',function(require){"use strict";var core=require('web.core');var ProjectKanbanController=require('project.project_kanban');var session=require('web.session');var QWeb=core.qweb;var SaleProjectKanbanController=ProjectKanbanController.include({events:_.extend({},ProjectKanbanController.prototype.events,{'click .o_create_sale_order':'_onCreateSaleOrder'}),willStart:async function(){const _super=this._super.bind(this);await this._showCreateSOButton();return _super(...arguments);},_showCreateSOButton:async function(){var self=this;this.activeProjectIds=this.initialState.context.active_ids;if(!this.activeProjectIds||this.activeProjectIds.length!==1){this.showCreateSaleOrder=false;return;}
var canCreateSO=await session.user_has_group('sales_team.group_sale_salesman');if(canCreateSO){await this._rpc({model:'project.project',method:'search_count',args:[[["id","in",this.activeProjectIds],["bill_type","=","customer_project"],["sale_order_id","=",false],["allow_billable","=",true],["allow_timesheets","=",true],]],}).then(function(projectCount){self.showCreateSaleOrder=projectCount!==0;});}else{this.showCreateSaleOrder=false;}},renderButtons:function($node){this._super.apply(this,arguments);this.$saleButtons=$(QWeb.render('SaleProjectKanbanView.buttons'));var state=this.model.get(this.handle,{raw:true});var createHidden=this.is_action_enabled('group_create')&&state.isGroupedByM2ONoColumn||!this.showCreateSaleOrder;this.$saleButtons.toggleClass('o_hidden',createHidden);this.$saleButtons.appendTo(this.$buttons);},updateButtons:async function(){if(!this.$buttons){return;}
this._super.apply(this,arguments);await this._showCreateSOButton();var state=this.model.get(this.handle,{raw:true});var createHidden=this.is_action_enabled('group_create')&&state.isGroupedByM2ONoColumn||!this.showCreateSaleOrder;this.$buttons.find('.o_create_sale_order').toggleClass('o_hidden',createHidden);},_onCreateSaleOrder:function(ev){ev.preventDefault();this.do_action('sale_timesheet.project_project_action_multi_create_sale_order',{additional_context:{'active_id':this.activeProjectIds&&this.activeProjectIds[0],'active_model':"project.project",},on_close:async()=>await this.reload()});},});return SaleProjectKanbanController;});;

/* /saas_demo/static/js/saas_demo.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('saas_demo.saas_demo',function(require){'use strict';var core=require('web.core');var QWeb=core.qweb;var dummyDependency=require('web_enterprise.ExpirationPanel');var AppSwitcher=require('web_enterprise.AppSwitcher');AppSwitcher.include({enterprise_expiration_check:function(){return true;},start:function(){var self=this;self.show_demo_alert();return this._super.apply(this,arguments);},show_demo_alert:function(){$(QWeb.render('DemoAlert',{})).insertAfter(this.$('.o_menu_search'));}});function studio(parent,action){var edit_action=action.context.params.edit_action;var webclient=parent.webclient;webclient.action_manager.do_load_state({_push_me:false,action:edit_action},true).then(function(){var ac=webclient.action_manager.get_inner_action();if(ac){var menu_id=webclient.menu.action_id_to_primary_menu_id(ac.get_action_descr().id);if(menu_id){core.bus.trigger('change_menu_section',menu_id);}
parent.trigger_up('click_studio_mode');}});}
core.action_registry.add('saas_demo_studio',studio);});;

/* /industry_fsm_sale/static/src/js/fsm_product_quantity.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('industry_fsm_sale.fsm_product_quantity',function(require){"use strict";var FieldInteger=require('web.basic_fields').FieldInteger;var core=require('web.core');var field_registry=require('web.field_registry');var qweb=core.qweb;var _t=core._t;var FSMProductQty=FieldInteger.extend({description:_t("FSM Product Quantity"),template:"FSMProductQuantity",events:{'click .o_target_to_set':'_onKanbanTargetClicked',},init:function(parent,name,record,options){this._super.apply(this,arguments);if(record.context.hide_qty_buttons){this.isReadonly=true;}},_valueChange:function(target_name,value){var target_name=target_name;var target_value=value;if(isNaN(target_value)){this.do_warn(false,_t("Please enter an integer value"));}else{var changes={};changes[target_name]=parseInt(target_value);;this.trigger_up('field_changed',{dataPointID:this.dataPointID,changes:changes,});}},_onKanbanTargetClicked:function(e){var self=this;var $target=$(e.currentTarget);var target_name=$target.attr('name');var target_value=$target.attr('value');if(this.isReadonly){return;}
var $input=$('<input/>',{type:"text",class:'o_input oe_inline d-inline-block text-center',style:"width: 40px; font-size: 24px",name:target_name});if(target_value){$input.attr('value',target_value);}
$input.on('keyup input',function(e){if(e.which===$.ui.keyCode.ENTER){$input.blur();}});$input.on('blur',function(){self._valueChange(target_name,$input.val());});$input.replaceAll($target).focus().select();},_renderReadonly:function(){this.$el.html(qweb.render('FSMProductQuantity',{qty:this.recordData.fsm_quantity}));},});field_registry.add('fsmProductQuantity',FSMProductQty);return{FSMProductQty:FSMProductQty,};});;

/* /industry_fsm_sale/static/src/js/kanban_view/model.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('industry_fsm_sale.ProductKanbanModel',function(require){"use strict";const KanbanModel=require('web.KanbanModel');return KanbanModel.extend({async save(recordID,options){const record=this.localData[recordID];const changes=record._changes;if(changes.fsm_quantity!==undefined){const quantity=changes.fsm_quantity;delete changes.fsm_quantity;const changedFields=await Promise.all([this._super(...arguments),this._saveFSMQuantity(record,quantity),]);await this._fetchRecord(record);return changedFields.flat();}
return this._super(...arguments);},async _saveFSMQuantity(record,quantity){const action=await this._rpc({model:'product.product',method:'set_fsm_quantity',args:[record.data.id,quantity],context:record.getContext(),});if(typeof action==='object'){await new Promise((resolve)=>{this.do_action(action,{on_close:resolve});});}
return['fsm_quantity'];},});});;

/* /industry_fsm_sale/static/src/js/kanban_view/view.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define('industry_fsm_sale.ProductKanbanView',function(require){"use strict";const KanbanView=require('web.KanbanView');const KanbanModel=require('industry_fsm_sale.ProductKanbanModel');const viewRegistry=require('web.view_registry');const ProductKanbanView=KanbanView.extend({config:_.extend({},KanbanView.prototype.config,{Model:KanbanModel,}),});viewRegistry.add('fsm_product_kanban',ProductKanbanView);});;

/* /industry_fsm_sale/static/src/js/tours/industry_fsm_sale_tour.js defined in bundle 'point_of_sale.pos_assets_backend' */
odoo.define("sale_industry_fsm.tour",function(require){"use strict";var tour=require('web_tour.tour');require('industry_fsm.tour');var core=require('web.core');var _t=core._t;var fsmStartStepIndex=_.findIndex(tour.tours.industry_fsm_tour.steps,function(step){return(step.id==='fsm_start');});tour.tours.industry_fsm_tour.steps.splice(fsmStartStepIndex+1,0,{trigger:'button[name="action_fsm_view_material"]',extra_trigger:'button[name="action_timer_stop"]',content:_t('Record the material you used for the intervention.'),position:'bottom',},{trigger:".o-kanban-button-new",content:_t('Create a new product.'),position:'right',},{trigger:'input.o_field_char',content:_t('Choose a name for your product <i>(e.g. Bolts, Screws, Boiler...).</i>'),position:'right',},{trigger:".o_form_button_save",content:_t("Save your product."),position:"bottom",},{trigger:".breadcrumb-item:not(.active):last",extra_trigger:".btn-primary",content:_t("Use the breadcrumbs to <b>go back to your products list</b>."),position:"right",},{trigger:".oe_kanban_action:contains('+')",extra_trigger:'.o_fsm_material_kanban',content:_t('Add a product by clicking on it.'),position:'right',},{trigger:".breadcrumb-item:not(.active):last",extra_trigger:'.o_fsm_material_kanban',content:_t("Use the breadcrumbs to <b>go back to your task</b>."),position:"right"});var fsmCreateInvoiceStepIndex=_.findIndex(tour.tours.industry_fsm_tour.steps,function(step){return(step.id==='fsm_invoice_create');});tour.tours.industry_fsm_tour.steps.splice(fsmCreateInvoiceStepIndex+1,0,{trigger:".o_statusbar_buttons > button:contains('Create Invoice')",content:_t("Invoice your time and material to your customer."),position:"bottom"},{trigger:".modal-footer button[id='create_invoice_open'].btn-primary",extra_trigger:".modal-dialog.modal-lg",content:_t("Invoice your time and material to your customer or ask for a down payment first."),position:"bottom"});});